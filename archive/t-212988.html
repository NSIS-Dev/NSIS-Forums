<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Creating multiple installers with one script?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Creating multiple installers with one script? NSIS Discussion" />
	
	<title> Creating multiple installers with one script? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Creating multiple installers with one script?</div>
<hr />
<div class="pda"><a href="t-212988.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212988">Creating multiple installers with one script?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">StephenM</div><div class="date">12th April 2005, 15:18</div></div><div class="posttext">Hello all,<br />
<br />
I was curious if it is possible to have a single script that could grab each seperate file from a directory and make a simple installer for each one?<br />
<br />
For an example, there is a folder with 600 files inside.<br />
Rather than create 600 seperate scripts for each file,<br />
just have one script that can iterate through each file<br />
and output a corresponding installer.<br />
<br />
Has this already been done?<br />
<br />
If anyone could point me in the right direction, it would<br />
be most helpful!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th April 2005, 15:23</div></div><div class="posttext">What I would do, is create an NSIS installer which reads from your folder of files and writes a temporary NSI script for that file, compiles it, and so on and so forth.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StephenM</div><div class="date">12th April 2005, 15:32</div></div><div class="posttext">Thanks for the quick reply!<br />
<br />
I am quite new to NSIS development - if you<br />
could also highlight any particular important<br />
functions I will need to use or a sample<br />
script, that would be v. helpful!<br />
<br />
I wouldn't even know where to start with making<br />
temp scripts that could then be sent for<br />
compilation itself!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th April 2005, 15:45</div></div><div class="posttext">This is a minimal script you can compile. Put the generated exe in the parent folder of the folder that contains all your files, then run it!<br />
Change the !define to the name of your folder first.<br />
<br />
<br />
OutFile GenerateInstallers.exe<br />
<br />
!define FileDir &quot;Files&quot;<br />
<br />
Function .onInit<br />
 ClearErrors<br />
 FindFirst $R0 $R1 &quot;$EXEDIR\${FileDir}\*.*&quot;<br />
<br />
 # Read file name<br />
 Loop:<br />
 IfErrors Done<br />
  StrCmp $R1 . Next<br />
  StrCmp $R1 .. Next<br />
<br />
  # Get file name w/o ext<br />
  StrCpy $R2 $R1 -4<br />
<br />
  # Write temp script<br />
  FileOpen $R3 &quot;$EXEDIR\Installer.nsi&quot; w<br />
  FileWrite $R3 'OutFile &quot;$R2.exe&quot;$\r$\n'<br />
  FileWrite $R3 'Page Directory$\r$\n'<br />
  FileWrite $R3 'Page InstFiles$\r$\n'<br />
  FileWrite $R3 'Section$\r$\n'<br />
  FileWrite $R3 'File &quot;/oname=$$INSTDIR\$R1&quot; &quot;${FileDir}\$R1&quot;$\r$\n'<br />
  FileWrite $R3 'SectionEnd$\r$\n'<br />
  FileClose $R3<br />
<br />
  # Compile temp script<br />
  ExecWait '&quot;${NSISDIR}\makensis.exe&quot; &quot;$EXEDIR\Installer.nsi&quot;'<br />
<br />
  Next:<br />
  ClearErrors<br />
  FindNext $R0 $R1<br />
 Goto Loop<br />
<br />
 Done:<br />
 FindClose $R0<br />
<br />
 # Delete temp script<br />
 Delete &quot;$EXEDIR\Installer.nsi&quot;<br />
 Abort<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StephenM</div><div class="date">12th April 2005, 19:18</div></div><div class="posttext">Thats great! Thank you - I've modified the script to<br />
what I need but thank you v. much!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StephenM</div><div class="date">12th April 2005, 19:33</div></div><div class="posttext">Just an extra question to go with this.<br />
If I were to have subfolders inside the<br />
main folder with the files inside, would<br />
anyone be able to direct me to a loop<br />
code that could iterate through each one<br />
of the folders, return back to the parent<br />
folder and continue on with more folders?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th April 2005, 21:06</div></div><div class="posttext">I've got a function that just does that which isn't a fixed one (ie I change it to do all sorts of things). This one is closer to home though - it writes the file names it finds to a text file (which is almost what you need!)<br />
You should be able to modify the main parts (ie FileWrite) to what you need.<br />
<br />
 Function GetFilesRecursive<br />
  Push $R1<br />
  Push $R2<br />
  Push $R3<br />
  Push $R4<br />
<br />
  StrCpy $R3 1<br />
<br />
  Push &quot;&quot;<br />
<br />
  nextDir:<br />
    Pop $R4<br />
    IntOp $R3 $R3 - 1<br />
    ClearErrors<br />
<br />
    FindFirst $R1 $R2 &quot;$DirPath$R4\*.*&quot;<br />
    checkLoop:<br />
       IfFileExists &quot;$DirPath$R4\$R2\*.*&quot; +3<br />
          FileWrite $R0 '$\r$\n$${SE-OutPath} &quot;$OutputPath$R4&quot;$\r$\n'<br />
       Goto checkDone<br />
       FindNext $R1 $R2<br />
       IfErrors 0 checkLoop<br />
    checkDone:<br />
    FindClose $R1<br />
<br />
    FindFirst $R1 $R2 &quot;$DirPath$R4\*.*&quot;<br />
<br />
    nextFile:<br />
      StrCmp $R2 &quot;.&quot; gotoNextFile<br />
      StrCmp $R2 &quot;..&quot; gotoNextFile<br />
<br />
      IfFileExists &quot;$DirPath$R4\$R2\*.*&quot; 0 notDir<br />
          IntOp $R3 $R3 + 1<br />
          Push &quot;$R4\$R2&quot;<br />
          Goto gotoNextFile<br />
<br />
      notDir:<br />
          FileWrite $R0 '$${SE-File} &quot;$DirPath$R4\$R2&quot; &quot;$R2&quot;$\r$\n'<br />
<br />
  gotoNextFile:<br />
    FindNext $R1 $R2<br />
    IfErrors 0 nextFile<br />
<br />
    FindClose $R1<br />
<br />
    StrCmp $R3 0 0 nextDir<br />
<br />
  Pop $R4<br />
  Pop $R3<br />
  Pop $R2<br />
  Pop $R1<br />
 FunctionEnd<br />
<br />
Edit: That gives me an idea for a new project. One that works similar to FindFirst, FindNext and FindClose, except that it loops through a folder recursively.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StephenM</div><div class="date">13th April 2005, 10:09</div></div><div class="posttext">Wow !!<br />
<br />
That is a really good script!<br />
<br />
Definitely not one for the faint-hearted.<br />
<br />
I've tried combining the two scripts you have<br />
generously helped with but am currently struggling<br />
to make it work.<br />
<br />
I know its cheeky to ask but is it possible you<br />
can help with this step as well?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th April 2005, 11:18</div></div><div class="posttext">I think Instructor has made a recursive find function in one of his script headers. I'm not entirely sure and I can't check here at college. You can find such things at the archive (http://nsis.sf.net/archive)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StephenM</div><div class="date">15th April 2005, 10:41</div></div><div class="posttext">Thanks for giving such great help.<br />
<br />
Just on the last hurdle now. I've modified<br />
the first script you wrote out but I am<br />
just wanting to integrate some file existence<br />
checking.<br />
<br />
I've done the PageEx code in a seperate installer<br />
script so I know that works fine but when trying<br />
to FileWrite the commands into your script, the<br />
final installer exe's for each file do not appear.<br />
<br />
<br />
OutFile GenerateInstallers.exe<br />
<br />
!define FileDir &quot;Database&quot;<br />
<br />
Function .onInit<br />
 ClearErrors<br />
 FindFirst $R0 $R1 &quot;$EXEDIR\${FileDir}\*.*&quot;<br />
<br />
 # Read file name<br />
 Loop:<br />
 IfErrors Done<br />
  StrCmp $R1 . Next<br />
  StrCmp $R1 .. Next<br />
<br />
  # Get file name w/o ext<br />
  StrCpy $R2 $R1 -4<br />
<br />
  # Write temp script<br />
  FileOpen $R3 &quot;$EXEDIR\Installer.nsi&quot; w<br />
  FileWrite $R3 'OutFile &quot;$EXEDIR\${FileDir}\$R2.exe&quot;$\r$\n'<br />
  <br />
  FileWrite $R3 'XPStyle on$\r$\n'<br />
  FileWrite $R3 'SetFont &quot;Verdana&quot; 8$\r$\n'<br />
  <br />
  FileWrite $R3 'InstallDir &quot;$PROGRAMFILES\test\test&quot;$\r$\n'<br />
  FileWrite $R3 'InstallDirRegKey HKLM &quot;Software\test&quot; &quot;Install_Dir&quot;$\r$\n'<br />
<br />
  FileWrite $R3 'PageEx Directory$\r$\n'<br />
  FileWrite $R3 'PageCallbacks &quot;&quot; &quot;&quot;checkFileExistence'<br />
  FileWrite $R3 'PageExEnd'<br />
  <br />
  FileWrite $R3 'Page instfiles$\r$\n'  <br />
    <br />
  FileWrite $R3 'Function checkFileExistence'<br />
    FileWrite $R3 'IfFileExists &quot;$INSTDIR\tester.exe&quot; +3'<br />
    FileWrite $R3 'MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Please install the database to a valid folder&quot;'<br />
    FileWrite $R3 'Abort'<br />
  FileWrite $R3 'FunctionEnd'<br />
<br />
  FileWrite $R3 'Section$\r$\n'<br />
  <br />
  FileWrite $R3 'File &quot;/oname=$$INSTDIR\${FileDir}\$R1&quot; &quot;${FileDir}\$R1&quot;$\r$\n'<br />
  FileWrite $R3 'SectionEnd$\r$\n'<br />
  FileClose $R3<br />
<br />
  # Compile temp script<br />
  ExecWait '&quot;${NSISDIR}\makensis.exe&quot; &quot;$EXEDIR\Installer.nsi&quot;'<br />
<br />
  Next:<br />
  ClearErrors<br />
  FindNext $R0 $R1<br />
 Goto Loop<br />
<br />
 Done:<br />
 FindClose $R0<br />
<br />
 # Delete temp script<br />
 Delete &quot;$EXEDIR\Installer.nsi&quot;<br />
 Abort<br />
FunctionEnd<br />
<br />
Section<br />
SectionEnd<br />
<br />
<br />
Any idea what could be causing the problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StephenM</div><div class="date">15th April 2005, 11:17</div></div><div class="posttext">Silly me.<br />
<br />
Forgot to put $\r$\n for the new file writes <br />
<br />
Don't worry.<br />
<br />
Thanks for all the help!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>