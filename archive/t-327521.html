<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" $INSTDIR confusing on localized Win7, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  $INSTDIR confusing on localized Win7 NSIS Discussion" />
	
	<title> $INSTDIR confusing on localized Win7 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  $INSTDIR confusing on localized Win7</div>
<hr />
<div class="pda"><a href="t-327521.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327521">$INSTDIR confusing on localized Win7</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">knahrvorn</div><div class="date">18th February 2011, 07:08</div></div><div class="posttext">I have a script which uses<br />
InstallDir &quot;$PROGRAMFILES\MyProgramName&quot;<br />
and<br />
Page instfiles<br />
and is thereafter refers to $INSTDIR for installation and creating a start menu shortcut. So far no problems; my program (in Java) is packed into an installer and is being installed and runs with no problems.<br />
<br />
However, today I tried the installer on a Windows 7 system, which was originally installed in English, but now has been set to Danish. This means that &quot;C:\Program Files&quot; is now &quot;C:\Programmer&quot; instead, and apparently that confuses the installer made by my script.<br />
<br />
During the install, the installer suggests installation to &quot;C:\Program Files\MyProgramName&quot;, and if I just select Next, my program is installed without errors. However, the installed shortcut in the start menu refers to &quot;C:\Program Files\MyProgramName&quot;, which makes Java complain that the path is not found.<br />
<br />
If, in the installer, I choose to &quot;Browse&quot; my way into &quot;C:\Programmer&quot; (which IS shown in the directory list), I still get &quot;C:\Program Files&quot; as the destination folder in the main install window. If I manually type in &quot;C:\Programmer\MyProgramName&quot;, the program is (again) installed without errors, and this time it starts.<br />
<br />
What is REALLY weird, I think, is that if I open a command prompt in Win7, it reports that only &quot;C:\Program Files&quot; exists, and the Win7 GUI detects only &quot;C:\Programmer&quot;.<br />
<br />
So, since I'm not very used to the Windows environment, my question is: Is this normal behaviour from Windows? If so, how do I refer to &quot;C:\Programmer&quot; from an NSIS script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">18th February 2011, 08:25</div></div><div class="posttext">C:\Programmer is a diaplay name but not the folder name. You would understand it clearly if you are using a Chinese, Japanese or Korean Windows OS. On Windows XP, some folder names has translated to system's language. The desktop folder path is &quot;C:\Documents and Settings\Adminstrator\桌面&quot; on Simplified Chinese Edition and &quot;C:\Documents and Settings\Adminstrator\Desktop&quot; on English one. But on Windows 7, the desktop folder names of all languanges are the same one: C:\Users\Adminstrator\Desktop, you can only see different display names among OSes of different languages. For example, the Favorites folder of Winows XP is shown as &quot;收藏夹&quot; but the folder name is Favorites, and the Desktop folder on Windows 7 is shown as &quot;桌面&quot; and the folder name is still Desktop, etc. The value of $PROGRAMFILES in NSIS is get from Windows API such as SHGetSpecialFolderPath (http://msdn.microsoft.com/en-us/library/bb762204.aspx), so on the same system, the path is always the same. I thought that the problem is not the path being incorrect, maybe other reasons.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">knahrvorn</div><div class="date">18th February 2011, 09:22</div></div><div class="posttext">jiake, thank you for the explanation. So it IS expected behaviour from Windows, and as &quot;Program Files&quot; is still the actual directory name, I am indeed receiving the correct path through $INSTDIR. So far, so good.<br />
<br />
The strange thing, for me, is now why a shortcut that I create with the following command:<br />
<br />
CreateShortCut &quot;$SMPROGRAMS\${PROGRAMNAME}.lnk&quot; &quot;java&quot; &quot;main.MyProgramName&quot; &quot;&quot; &quot;&quot; SW_SHOWNORMAL &quot;&quot; &quot;Program description&quot;<br />
<br />
which results in a shortcut like the one on the attached screenshot, is triggering a file not found exception in Java (though the file does exist)...<br />
<br />
java.io.FileNotFoundException: C:\Program%20Files\MyProgramName\filename.ext (Den angivne sti blev ikke fundet)<br />
<br />
Perhaps because Windows seems to translate &quot;Program Files&quot; into &quot;Program%20Files&quot;? Nah, that shouldn't matter, should it? Besides, I had this working on an English language system where both actual directory name and display name was &quot;Program Files&quot;, with no changes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th February 2011, 12:36</div></div><div class="posttext">Things like %20 do not work for folder names, they're only used for internet URLs.<br />
<br />
Your problem isn't very clear, but it seems to be related to java, not NSIS. You may have to supply a proper path to java, with quote marks. Otherwise, ask java support?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">knahrvorn</div><div class="date">18th February 2011, 15:09</div></div><div class="posttext">MSG, thank you for your reply. I am trying to figure out if this *is* related to Java or to NSIS (or to Windows, for what I knew).<br />
<br />
It does indeed seem as if this is an issue with Java instead of NSIS. As far as I understand NSIS, I am already supplying properly quoted path to the java executable. But perhaps I don't understand it correctly? So in order to rule out NSIS, here's what I do when I create the start menu item:<br />
<br />
SetOutPath &quot;$INSTDIR&quot;<br />
in order to set a &quot;current path&quot; from which to run the java executable.<br />
(I even tried with SetOutPath &quot;$\&quot;$INSTDIR$\&quot;&quot; which didn't seem to make any difference)<br />
<br />
then:<br />
CreateShortCut &quot;$SMPROGRAMS\${PROGRAMNAME}.lnk&quot; &quot;java&quot; &quot;main.MyProgramName&quot; &quot;&quot; &quot;&quot; SW_SHOWNORMAL &quot;&quot; &quot;Program description&quot;<br />
<br />
where the first argument is, of course, the name of the shortcut. The next one is the name of the java executable. The next one, the arguments sent to the java exec, is the name of my program with a path relative to the current path as set by SetOutPath.<br />
<br />
So, in other words, if I'm not making anything wrong here(?), I know the issue is with Java instead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th February 2011, 15:17</div></div><div class="posttext">How about:<br />
<br />
CreateShortCut &quot;$SMPROGRAMS\${PROGRAMNAME}.lnk&quot; &quot;java&quot; `&quot;$INSTDIR\main.MyProgramName&quot;` &quot;&quot; &quot;&quot; SW_SHOWNORMAL &quot;&quot; &quot;Program description&quot;<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>