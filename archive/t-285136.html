<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Section with options, howto?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Section with options, howto? NSIS Discussion" />
	
	<title> Section with options, howto? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Section with options, howto?</div>
<hr />
<div class="pda"><a href="t-285136.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=285136">Section with options, howto?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">gurzixo</div><div class="date">17th January 2008, 14:53</div></div><div class="posttext">Dear All,<br />
<br />
While this is not my first nsis script, I think I have not grabbed the full NSIS spirit yet..., and I am ckoking on this seemingly very simple problem:<br />
<br />
My install script needs an user-selectable section, with an user-selectable option. By default, this option is checked or not depending on the value of a registry key. Obviously, if the section is not selected, the option should be grayed out. The action of this section (if selected) is something like:<br />
&quot;execwait myprog.exe -myoption&quot; or &quot;execwait myprog&quot; depending if the option is checked or not.<br />
<br />
I tried using sections inside sections (does not work), then SectionGroups. But I have not been able to to get a consistent  checking logic.<br />
<br />
Any help would be *really* welcome!<br />
<br />
Michel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">17th January 2008, 15:29</div></div><div class="posttext">Something like this I guess,<br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
<br />
Section &quot;MyProg&quot; sec1<br />
#<br />
SectionEnd<br />
<br />
Section /o &quot;MyOption&quot; sec2<br />
#<br />
SectionEnd<br />
<br />
Function .onSelChange<br />
SectionGetFlags ${sec1} $R0<br />
IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
<br />
${If} $R0 == ${SF_SELECTED}<br />
    !insertmacro ClearSectionFlag ${sec2} ${SF_RO}<br />
${ElseIf} $R0 != ${SF_SELECTED}<br />
    !insertmacro UnSelectSection ${sec2}<br />
    !insertmacro SetSectionFlag ${sec2} ${SF_RO}<br />
${EndIf}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gurzixo</div><div class="date">17th January 2008, 15:44</div></div><div class="posttext">Thanks a lot, Red Wine for your fast++ answer! At least I have now a working solution.<br />
<br />
But could it be possible to have &quot;MyOption&quot; indented, like when using SectionGroup? This makes sense, as MyOption is a MyProg option, not an install option.<br />
<br />
Again thanks,<br />
<br />
Michel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">17th January 2008, 16:04</div></div><div class="posttext">SectionGroup /e &quot;MyProg&quot;<br />
Section &quot;&quot; sec1<br />
#<br />
SectionEnd<br />
<br />
Section /o &quot;MyOption&quot; sec2<br />
#<br />
SectionEnd<br />
SectionGroupEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gurzixo</div><div class="date">17th January 2008, 17:57</div></div><div class="posttext">Red Wine, You rock!<br />
<br />
As this could be of great use for the next newbie, I have created a new wiki page here: http://nsis.sourceforge.net/Simple_script:section_with_option<br />
<br />
Again thanks,<br />
<br />
Michel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">17th January 2008, 19:01</div></div><div class="posttext">You're welcome :)<br />
<br />
Url submitted by the user gurzixo (http://nsis.sourceforge.net/Simple_script:section_with_option)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vlad-mal</div><div class="date">5th March 2008, 12:59</div></div><div class="posttext">Originally posted by Red Wine <br />
Something like this I guess,<br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
<br />
Section &quot;MyProg&quot; sec1<br />
#<br />
SectionEnd<br />
<br />
Section /o &quot;MyOption&quot; sec2<br />
#<br />
SectionEnd<br />
<br />
Function .onSelChange<br />
SectionGetFlags ${sec1} $R0<br />
IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
<br />
${If} $R0 == ${SF_SELECTED}<br />
    !insertmacro ClearSectionFlag ${sec2} ${SF_RO}<br />
${ElseIf} $R0 != ${SF_SELECTED}<br />
    !insertmacro UnSelectSection ${sec2}<br />
    !insertmacro SetSectionFlag ${sec2} ${SF_RO}<br />
${EndIf}<br />
FunctionEnd  <br />
<br />
That is interesting solution.<br />
If there is a lot similar &quot;slaved&quot; sections, then code will be like this:<br />
<br />
!Include &quot;MUI.nsh&quot;<br />
 <br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
 <br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
 <br />
Name &quot;Section with options&quot;<br />
OutFile &quot;test.exe&quot;<br />
 <br />
 <br />
SectionGroup /e &quot;MyProg&quot;<br />
 <br />
Section &quot;Common&quot; common<br />
SectionEnd<br />
 <br />
Section /o &quot;Option1&quot; opt1<br />
SectionEnd<br />
<br />
Section /o &quot;Option2&quot; opt2<br />
SectionEnd<br />
<br />
Section /o &quot;Option3&quot; opt3<br />
SectionEnd<br />
;...<br />
;...etc.<br />
;...<br />
Section /o &quot;OptionN&quot; optN<br />
SectionEnd<br />
<br />
 <br />
SectionGroupEnd<br />
 <br />
Function .onSelChange<br />
SectionGetFlags ${common} $R0<br />
IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
 <br />
${If} $R0 == ${SF_SELECTED}<br />
    !insertmacro ClearSectionFlag ${opt1} ${SF_RO}<br />
    !insertmacro ClearSectionFlag ${opt2} ${SF_RO}<br />
    !insertmacro ClearSectionFlag ${opt3} ${SF_RO}<br />
;...<br />
;...etc<br />
;...<br />
    !insertmacro ClearSectionFlag ${optN} ${SF_RO}<br />
<br />
${ElseIf} $R0 != ${SF_SELECTED}<br />
    !insertmacro UnSelectSection ${opt1}<br />
    !insertmacro SetSectionFlag ${opt1} ${SF_RO}<br />
<br />
    !insertmacro UnSelectSection ${opt1}<br />
    !insertmacro SetSectionFlag ${opt2} ${SF_RO}<br />
<br />
    !insertmacro UnSelectSection ${opt3}<br />
    !insertmacro SetSectionFlag ${opt3} ${SF_RO}<br />
;...<br />
;...etc<br />
;...<br />
    !insertmacro UnSelectSection ${optN}<br />
    !insertmacro SetSectionFlag ${optN} ${SF_RO}<br />
		<br />
${EndIf}<br />
FunctionEnd<br />
<br />
<br />
<br />
A question: how to iterate across all sections from &quot;opt1&quot; to &quot;optN&quot; to avoid &quot;Copy/Paste&quot; in code?<br />
<br />
Thanks.<br />
<br />
<br />
/* Sorry for my poor English. */</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vlad-mal</div><div class="date">5th March 2008, 15:00</div></div><div class="posttext">Solution:<br />
As sinse section indexes is sequential, it possible simple iterate them from first section (&quot;Common&quot;) till &lt;Section Group End&gt; flag is occured:<br />
<br />
<br />
Function ReCheckSection<br />
 <br />
 Var /Global fNextSection<br />
 Var /Global IsSelected<br />
<br />
 Pop $fNextSection<br />
<br />
 SectionGetFlags $fNextSection $IsSelected<br />
 IntOp $IsSelected $IsSelected &amp; ${SF_SELECTED}<br />
<br />
 IntOp $fNextSection $fNextSection + 1<br />
<br />
 ${DoUntil} ${SectionIsSectionGroupEnd} $fNextSection <br />
 <br />
	${If} $IsSelected == ${SF_SELECTED}<br />
    !insertmacro ClearSectionFlag $fNextSection ${SF_RO}<br />
  ${ElseIf} $R0 != ${SF_SELECTED}<br />
    !insertmacro UnSelectSection $fNextSection<br />
    !insertmacro SetSectionFlag $fNextSection ${SF_RO}<br />
  ${EndIf}<br />
<br />
  IntOp $fNextSection $fNextSection + 1<br />
${LoopUntil} ${SectionIsSectionGroupEnd} $fNextSection<br />
	<br />
<br />
<br />
FunctionEnd<br />
<br />
<br />
Function .onSelChange<br />
<br />
; First section:<br />
Push ${common}	<br />
Call ReCheckSection	<br />
	<br />
FunctionEnd<br />
<br />
<br />
<br />
Thanks a lot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vlad-mal</div><div class="date">5th March 2008, 15:06</div></div><div class="posttext">Just in case, full source code:<br />
<br />
<br />
!Include &quot;MUI.nsh&quot;<br />
 <br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
 <br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
 <br />
Name &quot;Section with options&quot;<br />
OutFile &quot;test.exe&quot;<br />
 <br />
 <br />
SectionGroup /e &quot;MyProg&quot;<br />
 <br />
Section &quot;Common&quot; common<br />
SectionEnd<br />
 <br />
Section /o &quot;Option1&quot; opt1<br />
SectionEnd<br />
<br />
Section /o &quot;Option2&quot; opt2<br />
SectionEnd<br />
<br />
Section /o &quot;Option3&quot; opt3<br />
SectionEnd<br />
;...<br />
;...etc.<br />
;...<br />
Section /o &quot;OptionN&quot; optN<br />
SectionEnd<br />
<br />
 <br />
SectionGroupEnd<br />
 <br />
<br />
<br />
Function ReCheckSection<br />
 <br />
 Var /Global fNextSection<br />
 Var /Global IsSelected<br />
<br />
 Pop $fNextSection<br />
<br />
 SectionGetFlags $fNextSection $IsSelected<br />
 IntOp $IsSelected $IsSelected &amp; ${SF_SELECTED}<br />
<br />
 IntOp $fNextSection $fNextSection + 1<br />
<br />
 ${DoUntil} ${SectionIsSectionGroupEnd} $fNextSection <br />
 <br />
  ${If} $IsSelected == ${SF_SELECTED}<br />
    !insertmacro ClearSectionFlag $fNextSection ${SF_RO}<br />
  ${ElseIf} $R0 != ${SF_SELECTED}<br />
    !insertmacro UnSelectSection $fNextSection<br />
    !insertmacro SetSectionFlag $fNextSection ${SF_RO}<br />
  ${EndIf}<br />
<br />
  IntOp $fNextSection $fNextSection + 1<br />
${LoopUntil} ${SectionIsSectionGroupEnd} $fNextSection<br />
	<br />
<br />
<br />
FunctionEnd<br />
<br />
<br />
Function .onSelChange<br />
Push ${common}	<br />
Call ReCheckSection	<br />
	<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>