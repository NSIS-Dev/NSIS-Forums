<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Plugin / ExDLL question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Plugin / ExDLL question NSIS Discussion" />
	
	<title> Plugin / ExDLL question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Plugin / ExDLL question</div>
<hr />
<div class="pda"><a href="t-211184.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211184">Plugin / ExDLL question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Arrby</div><div class="date">23rd March 2005, 20:36</div></div><div class="posttext">Am making a plugin and in looking at ExDLL I see the exdll definition:<br />
<br />
#define EXDLL_INIT()           {  \<br />
        g_stringsize=string_size; \<br />
        g_stacktop=stacktop;      \<br />
        g_variables=variables; }<br />
<br />
The function def in exdll.c looks like:<br />
void __declspec(dllexport) myFunction(HWND hwndParent,<br />
                                  int string_size, <br />
                                  char *variables,<br />
                                  stack_t **stacktop,<br />
                                  extra_parameters *extra)<br />
<br />
What are the &quot;extra_parameters&quot; and can they be used?<br />
I.e. how would they get set in the plugin function call?<br />
<br />
Clarification would be Appreciated!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">23rd March 2005, 21:09</div></div><div class="posttext">In exdll.h:<br />
<br />
typedef struct {<br />
  int autoclose;<br />
  int all_user_var;<br />
  int exec_error;<br />
  int abort;<br />
  int exec_reboot;<br />
  int reboot_called;<br />
  int XXX_cur_insttype; // deprecated<br />
  int XXX_insttype_changed; // deprecated<br />
  int silent;<br />
  int instdir_error;<br />
  int rtl;<br />
  int errlvl;<br />
} exec_flags;<br />
<br />
typedef struct {<br />
  exec_flags *exec_flags;<br />
  int (__stdcall *ExecuteCodeSegment)(int, HWND);<br />
} extra_parameters;<br />
<br />
I guess some behave of the installer is passed though this param? :weird:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Arrby</div><div class="date">23rd March 2005, 21:30</div></div><div class="posttext">DOH!, thx Joelito.<br />
<br />
Hmmm dont see it or the ExecuteCodeSegment function defined in there ever being referenced. Must be for &quot;future enhancements&quot; or something.<br />
<br />
Follow up question: how do most people handle variable number of parms to a plugin, include the number of parms as the last parm on the call statement itself?<br />
<br />
I.E. DllName::FunctionName &quot;parm1&quot; &quot;parm2&quot; ... &quot;parmN&quot; &quot;N&quot;<br />
or something.<br />
<br />
I am thinking &quot;bad&quot; things happens if you pop more parms that were pushed in the call??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">23rd March 2005, 21:54</div></div><div class="posttext">how do most people handle variable number of parms to a plugin, include the number of parms as the last parm on the call statement itself?<br />
<br />
I don't know everyone else but I use popstring from exdll.h, as many times I need a param to be passed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saivert</div><div class="date">23rd March 2005, 22:00</div></div><div class="posttext">The popstring function included with the ExDLL framework just returns 1 when no more data is located on the stack. So just keep popping until you get 1 in return from popstring.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Arrby</div><div class="date">23rd March 2005, 22:15</div></div><div class="posttext">Thx saivert and Joelito!:up: <br />
<br />
And to think... I actually DID study exdll.h pretty thououghly yesterday! :o Getting OLD I guess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saivert</div><div class="date">23rd March 2005, 22:21</div></div><div class="posttext">I guess if you take a look on the source code for exehead subproject of the source code for NSIS, you may get a hint about what the heck &quot;ExecuteCodeSegment&quot; is all about.<br />
<br />
My personal guess is that you can execute parts of the script from a plugin. Maybe execute a function?? It would be great if this was a possibility cos' then a plugin can call a script function directly instead of the usual routine of letting the control fall back to NSIS' main UI thread as InstallOptions does. And hooking special messages is also pretty ugly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Arrby</div><div class="date">23rd March 2005, 22:47</div></div><div class="posttext">Hmmm, my guess would be that its used as part of the actual NSIS event hadler itself, i.e. seems like its responding to various SendMessage(s) to handle callbacks, aborts, which page to show processing?, progress updates, etc.<br />
<br />
A bit beyond me at this point! I would need substantial  &quot;developer docs&quot; and lotsa time with the debugger to wend my way thru this!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th March 2005, 15:29</div></div><div class="posttext">Popping until the stack is empty is not a good idea. The stack might contain other things but parameters to your plug-in. Simply require the user to put an end marker such as &quot;--&quot; and pop until you find it.<br />
<br />
ExecuteCodeSegment executes NSIS code segement. You can use it to execute code pointers the user may pass as a parameter. For example, the user can use GetFunctionAddress to pass a function pointer. See my recently posted nsXML plug-in for an example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Arrby</div><div class="date">25th March 2005, 05:46</div></div><div class="posttext">Thx kichik, I was thinking the same.<br />
<br />
This *might* be a nice future feature: i.e. have an optional switch for plugins call statement /markstack and compiler would automatically push a &quot;stack marker&quot; before pushing the parms.  I realize I can just do that as you suggested but having a formal, well defined, stack marker, you could then recommend that it be used. You could even make it the default and add switch /nostackmarker to prevent the stack marker (possibly with a Setxxx attribute to define default behaviour for backwards compatability).<br />
Just a thought.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saivert</div><div class="date">25th March 2005, 15:01</div></div><div class="posttext">Yup yup! Nice idea. But I think the problem is more related to how people generally code their NSIS plugins. They use more stack items instead of using just the first string for all parameters.<br />
<br />
I like using just the first item and then pack all parameters options data in this one. Just like when you are passing parameters to a Win32 program, the program only gets one string to work with and has to parse this.<br />
With NSIS plugins we get a lot of strings (stack items) we must parse and that usually complicates things.<br />
<br />
Why not got for a &quot;-o1 -o2 --option3&quot; syntax instead of pushing hundreds of strings on the stack. The default size limit on strings in NSIS is 1024, and should be more than enough for most things. If neccessary you could pass a switch in the first string that tells the plugin to pop one more string in order to get more information.<br />
<br />
Why can't someone in the NSIS dev team write a programmers guide or something, so people can write code that conforms to some guidelines.<br />
<br />
EDIT: What bout my post??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th March 2005, 15:14</div></div><div class="posttext">Originally posted by Arrby <br />
Thx kichik, I was thinking the same.<br />
<br />
This *might* be a nice future feature: i.e. have an optional switch for plugins call statement /markstack and compiler would automatically push a &quot;stack marker&quot; before pushing the parms.  I realize I can just do that as you suggested but having a formal, well defined, stack marker, you could then recommend that it be used. You could even make it the default and add switch /nostackmarker to prevent the stack marker (possibly with a Setxxx attribute to define default behaviour for backwards compatability).<br />
Just a thought. <br />
<br />
Good idea. /END would be most suitable because a few plugins use that already (so they won't have to be recompiled)<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>