<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Dynamic setting of header text, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Dynamic setting of header text NSIS Discussion" />
	
	<title> Dynamic setting of header text [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Dynamic setting of header text</div>
<hr />
<div class="pda"><a href="t-204240.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=204240">Dynamic setting of header text</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Bobbie100</div><div class="date">8th January 2005, 05:19</div></div><div class="posttext">I am using the MUI and want to set the MUI_PAGE_HEADER_TEXT and MUI_PAGE_HEADER_SUBTEXT dynamically so that a different message is shown at the end of Uninstall page if not all the files are deleted (common if there are user specific files that are not deleted by the uninstaller). I have tried a few different things, but without success.<br />
<br />
In the MUI System.nsh file in macro MUI_FUNCTION_INSTFILESPAGE the call to MUI_ENDHEADER is immediately after MUI_PAGE_FUNCTION_CUSTOM LEAVE. This seems to exclude using the normal leave function to carry out any special setting of controls.<br />
<br />
Any ideas how I can achieve what I want WITHOUT creating a custom page? <br />
<br />
Bob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bobbie100</div><div class="date">8th January 2005, 13:09</div></div><div class="posttext">Solved by making a modified MUI System.nsh with the order of the calls to MUI_ENDHEADER and MUI_PAGE_FUNCTION_CUSTOM LEAVE reversed in the LEAVE function of MUI_FUNCTION_INSTFILESPAGE.<br />
<br />
Then added the following Leave function with a user variable UninstErrorFlag that indicates if there is an error during the uninstall.<br />
<br />
Function un.InstLeave<br />
  ${If} $UninstErrorFlag == True<br />
    ;Header text<br />
    StrCpy $MessageText &quot;Uninstallation Not Fully Completed&quot;<br />
    GetDlgItem $MUI_TEMP1 $HWNDPARENT 1037<br />
    SendMessage $MUI_TEMP1 ${WM_SETTEXT} 0 &quot;STR:$MessageText&quot;<br />
    ;Header sub-text<br />
    StrCpy $MessageText &quot;Some parts of ${MY_PROD} were not removed \<br />
      (see uninstall log for more details)&quot;<br />
    GetDlgItem $MUI_TEMP1 $HWNDPARENT 1038<br />
    SendMessage $MUI_TEMP1 ${WM_SETTEXT} 0 &quot;STR:$MessageText&quot;<br />
  ${EndIf}<br />
FunctionEndMaybe should consider reversing the order of the calls to MUI_ENDHEADER and MUI_PAGE_FUNCTION_CUSTOM LEAVE in the next update of the MUI to provide this additional flexibility. I can't see any downside.<br />
<br />
Anybody else got an opinion on this?<br />
<br />
Bob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th January 2005, 13:15</div></div><div class="posttext">You can use the MUI_HEADER_TEXT macro to set the header text.<br />
<br />
An easier solution to the entire problem would be setting MUI_UNTEXT_FINISH_TITLE and MUI_UNTEXT_FINISH_SUBTITLE to a variable. That variable can then be changed in the leave function before it is actually used by MUI_ENDHEADER.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bobbie100</div><div class="date">8th January 2005, 13:54</div></div><div class="posttext">kichik,<br />
<br />
Excuse me if I don't understand this (I'm a newbie), but are these changes to the MUI System.nsh?<br />
<br />
Bob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th January 2005, 14:00</div></div><div class="posttext">No, those are not changes to System.nsh. I copied the wrong define names. MUI_INSTFILESPAGE_FINISHHEADER_TEXT and MUI_INSTFILESPAGE_FINISHHEADER_TEXT are the two defines you need. Define those two right above the insertion of the uninstall instfiles macro. Instead of giving them real text, give them variables. In the leave function of the uninstall instfiles page, change those variables to the desired text.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bobbie100</div><div class="date">8th January 2005, 14:27</div></div><div class="posttext">That's brilliant! I had no idea you could !define to a variable, I'd assumed !define was only to a static value. It certainly isn't apparent from the documentation of !define.<br />
<br />
How widely can this be used to modify internal parameters of the MUI via the Pre Show and Leave functions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th January 2005, 15:47</div></div><div class="posttext">Well, a define is just a &quot;variable&quot; of the compiler. Before the script is actually compiled, it's replaced with its contents. So, if you had the following script:!define a Sec<br />
!define b &quot;tion ab&quot;<br />
!define c c<br />
${a}${b}${c}<br />
SectionEndIt will be translated to:Section abc<br />
SectionEndNothing stops you from using variables in the defines too. In this case, MUI_INSTFILESPAGE_FINISHHEADER_TEXT is eventually used like this:!insertmacro MUI_HEADER_TEXT &quot;${MUI_INSTFILESPAGE_FINISHHEADER_TEXT}&quot; \<br />
   &quot;${MUI_INSTFILESPAGE_FINISHHEADER_SUBTEXT}&quot;This translates to:!insertmacro MUI_HEADER_TEXT &quot;$0&quot; &quot;some subtext&quot;The text you've defined might be static, but SendMessage, which is used in the MUI_HEADER_TEXT macro, processes the text dynamically and replaces $0 with its current contents at runtime.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>