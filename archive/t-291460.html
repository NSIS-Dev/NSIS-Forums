<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MSI and AD rear their ugly heads again, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MSI and AD rear their ugly heads again NSIS Discussion" />
	
	<title> MSI and AD rear their ugly heads again [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MSI and AD rear their ugly heads again</div>
<hr />
<div class="pda"><a href="t-291460.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291460">MSI and AD rear their ugly heads again</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Downward FG</div><div class="date">8th May 2008, 09:05</div></div><div class="posttext">Hi all,<br />
<br />
I put together an installer with nsis thanks to much help from this forum.  It does loads of cool stuff like .NET upgrades and gac registration.  Everything worked great until it was decided that the app had to be deployable using Active Directory.  A look around this place revealed that I would have to do this seperately so I created an MSI in VS2005, it &quot;installs&quot; the nsis setup.exe and calls it as a custom action.  I edited the file using ORCA so the custom action would run with the right (elevated) permissions.  If I install on a machine with .NET 3 already there, everything is great.  If not, disaster.  My program installs fine, but all the extra stuff (.NET etc.) doesn't get there.  This stuff is installed using execwait calls, and the event log on the machine even tells me it has been installed (I can even see the progress bars though they fill up much too quickly).  I know this isn't nsis fault, as it works fine until it is wrapped in the msi, but if anyone has encountered anything similar, or thinks they know what I have done wrong, let me know.  <br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Downward FG</div><div class="date">8th May 2008, 09:50</div></div><div class="posttext">I think I found the problem, when checking through the logfile I see that the .NET installer exited with code 1618.  This code means, &quot;Another installation is already in progress. Complete that installation before proceeding with this install.&quot;<br />
<br />
I suspected this was the problem.  Any suggestions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th May 2008, 10:03</div></div><div class="posttext">It's probably because they both use MSI. Either MSI somehow has to know the NSIS installer is part of it, or the .NET installation should be done in the MSI itself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Downward FG</div><div class="date">8th May 2008, 10:15</div></div><div class="posttext">Thanks kichik,<br />
<br />
If it is just nsis then everything is fine, and nsis can call as many msi installers as it likes (as long as there is only one running at a given time), but because I have this dummy msi that calls nsis, which then calls other msis I'm in trouble.  The msi was going to be for adminstrators to use, with the nsis.exe available to single users, so if I get the msi to handle the .NET install I am going to end up with different dists and my boss will be unhappy.  Got to love impossible requirements.  I'm trying to see if I can defer the custom action or something.  No doubt this will cause a permissions problem.  It definately isn't an nsis issue, but if anyone has a suggestion I'd be glad to hear it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">EnCey</div><div class="date">9th May 2008, 07:40</div></div><div class="posttext">I had the same problems some weeks ago, I also had to create several MSI-NSIS installers.<br />
You could try to use a custom action tpye of +192, see http://msdn.microsoft.com/en-us/library/aa368071(VS.85).aspx for details.<br />
<br />
Your NSIS installer would be executed asynchronous, so the MSI can shut down and another MSI (e.g. .NET) can be called. <br />
The problem with this approach is that the msi is finished and installed before your NSIS installer, so if the user cancels NSIS you could have some inconsistencies.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Downward FG</div><div class="date">9th May 2008, 10:06</div></div><div class="posttext">Thanks,<br />
<br />
This sounds like it might work, in this case nsis is running silently so I don't need to worry about pesky users :)<br />
<br />
I'll give it a go and report back.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Downward FG</div><div class="date">15th May 2008, 12:23</div></div><div class="posttext">EnCey, I owe you a drink.  Great solution.  To all of you who are having difficulty with AD deployment, this is the way forward.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>