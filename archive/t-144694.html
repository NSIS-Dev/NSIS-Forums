<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Stack size limit, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Stack size limit NSIS Discussion" />
	
	<title> Stack size limit [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Stack size limit</div>
<hr />
<div class="pda"><a href="t-144694.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144694">Stack size limit</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bSecRes</div><div class="date">4th August 2003, 15:34</div></div><div class="posttext">I used #define NSIS_MAX_STRLEN 8192 in config.h and compiled with MS VC++. When I !insertmacro MUI_INSTALLOPTIONS_Read, only 1024 characters are on stack. Is there something in installoptions I need to change as well?<br />
<br />
Edit: <br />
Opening the ini file shows the whole string (&gt;1024) is in the state field... this is a listbox.<br />
Edit again: listitems not state, actual line is:<br />
!insertmacro MUI_INSTALLOPTIONS_Read $R6 &quot;Myini.ini&quot; &quot;Field $R0&quot; &quot;ListItems&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 15:37</div></div><div class="posttext">What's the value of ${NSIS_MAX_STRLEN}?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bSecRes</div><div class="date">4th August 2003, 15:51</div></div><div class="posttext">8192 and I'm actually only seeing 1019 characters on stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 20:19</div></div><div class="posttext">You are using the latest CVS version right? From what date?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th August 2003, 20:23</div></div><div class="posttext">I will try out my makensis copy once I have a response from other topic.<br />
I also have a custom page with a ListBox control which I can test on.<br />
<br />
This may help:<br />
Function TestStrLen<br />
Push $R0<br />
Push $R1<br />
 StrCpy $R0 &quot;&quot;<br />
loop:<br />
 StrCpy $R0 &quot;$R0|a&quot;<br />
 StrLen $R1 $R0<br />
  StrCmp $R1 8192 0 loop<br />
WriteINIStr &quot;$TEMP\ddayupdates\dialog.du&quot; &quot;Field 3&quot; &quot;ListItems&quot; &quot;$R0&quot;<br />
ReadINIStr $R1 &quot;$TEMP\ddayupdates\dialog.du&quot; &quot;Field 3&quot; &quot;ListItems&quot;<br />
 StrCmp $R1 $R0 0 +3<br />
  StrCpy $R0 &quot;test success&quot;<br />
Goto exit<br />
 StrLen $R1 $R0<br />
  StrCpy $R0 &quot;test fail: only $R1 strlen&quot;<br />
exit:<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd<br />
<br />
If $R0 is &quot;test success&quot; then the str of 8192 strlen was copied and retreaved from the ini file successfully.<br />
Else, &quot;test fail: only $R1 strlen&quot; with $R1 being the strlewn of retreaved str.<br />
<br />
Btw, on Win9x there are apparently limitations to strlen in the file?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bSecRes</div><div class="date">4th August 2003, 21:35</div></div><div class="posttext">Mon Aug  4 05:51:34<br />
This is on a W2K server.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2003, 21:46</div></div><div class="posttext">Works for me... Can you try the attached example (compiled version and a version you compile yourself) and also attach your test case?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bSecRes</div><div class="date">5th August 2003, 00:07</div></div><div class="posttext">Argh. The reason it appeared that the value was getting chopped was because of dumpstate. Dumpstate is compiled at 1024 -5 apparently. The reason why the later values in my list were not being removed is because the values had invisible EOL characters appeneded to them that caused the StrStr match to fail. Thanks for the help anyway. Gosh this was hard to troubleshoot. <br />
<br />
I'm attaching my sample script anyway; comments welcome.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Francis</div><div class="date">7th August 2003, 18:43</div></div><div class="posttext">Gah, sorry if it's Dumpstate's fault.<br />
<br />
Dumpstate is passed the maximum string length by NSIS, and barely uses it - Dumpstate just uses the NSIS buffers except when editing a string, where it will throw loud error messages at you if things get too long.<br />
<br />
But it sounds like there's a bug in there somewhere. I'll take a look as soon as I get the time (probably in about a day).<br />
<br />
Unless: is it possible that you've recompiled makensis but not the exehead stub, in which case the stock exehead will tell Dumpstate that maximum string length is 1024? (Somewhat doubtful, as I expect you'd end up crashing somewhere if this was the case).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bSecRes</div><div class="date">7th August 2003, 19:20</div></div><div class="posttext">I loaded the project in MS VC++ 6 and did a build all. Thanks for helping out though. Dumpstate is invaluable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Andrew Francis</div><div class="date">10th August 2003, 16:57</div></div><div class="posttext">Ok, think I've got it nailed. Turns out the problem is wsprintf (the sprintf built into kernel32.dll) not being able to write out more than about 1024 bytes. Of course, I figured this out after I restructured things to build the copy-to-clipboard string from the original data, rather than just reading everything out of the listbox - I thought the listbox was truncating stuff.<br />
<br />
Anyway, give this a go. Once I've actually tested it properly I'll update the dumpstate homepage and the NSIS archive.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bSecRes</div><div class="date">12th August 2003, 23:09</div></div><div class="posttext">Sorry for the slow reply, it works great! Thanks a ton, this is an essential tool.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">13th August 2003, 00:23</div></div><div class="posttext">I've updated the archive copy of dumpstate to 0.2.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>