<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Text File Search Help, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Text File Search Help NSIS Discussion" />
	
	<title> Text File Search Help [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Text File Search Help</div>
<hr />
<div class="pda"><a href="t-241952.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=241952">Text File Search Help</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">27th March 2006, 18:08</div></div><div class="posttext">Hello all.<br />
<br />
I need a hand with a text file search project I'm working on.  I want to be able to check text files for duplicate field ID numbers.  The ID number will always come 1 line after the term &quot;EditBox&quot; or &quot;CheckBox&quot;.  EditBox and CheckBox will always be the only item on their lines.  So for example:<br />
<br />
EditBox<br />
1<br />
<br />
EditBox<br />
2<br />
<br />
EditBox<br />
2<br />
<br />
EditBox<br />
3<br />
<br />
My plan was to read a text file until I get to either EditBox of CheckBox, then read the next line (ID Number) and check to see if it is already in my Array, if so, I'll note that ID number as a duplicate, and continue to check for others.  If it is not already in the Array, I'll add it, and again continue checking.<br />
<br />
I tried to do this using the &quot;LineRead&quot; function off the WIKI, reading every line, checking if it was EditBox or CheckBox, and if so reading the next line.  However this was very slow, as I'm sure this was not the best way to do this.  Most of the files I want to search will have between 4000-8000 lines of text.  I would like to be able to search of folder of 50-100 files in a few minutes or less.<br />
<br />
I just tried using AfrowUK's FileSearch function, and that is able to search a 9000 line file in a second or two, and give me the number of times EditBox appears, so I think all this can be done, just need a hand modifying one of these function for my purpose.  Any help would be much appreciated.  Thanks all.<br />
<br />
Jnuw</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th March 2006, 19:54</div></div><div class="posttext">If the LineRead function is slow then that probably means it loops through the entire file each function call to the line that you want.<br />
<br />
It really is easy to write your own function to read from a file. Using already existing functions in pieces or multiple times is not a good idea in this case. You need to write your own code so that it is as effecient as possible.<br />
<br />
Are you using NSISArray for this?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">28th March 2006, 06:27</div></div><div class="posttext">Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
!include &quot;TextFunc.nsh&quot;<br />
!insertmacro TrimNewLines<br />
<br />
Section<br />
	ClearErrors<br />
	FileOpen $0 &quot;C:\input.txt&quot; r<br />
	IfErrors end<br />
<br />
	loop:<br />
	FileRead $0 $1<br />
	IfErrors close<br />
	${TrimNewLines} &quot;$1&quot; $1<br />
	StrCmp $1 EditBox +2<br />
	StrCmp $1 CheckBox 0 loop<br />
<br />
	FileRead $0 $2<br />
	IfErrors close<br />
	${TrimNewLines} &quot;$2&quot; $2<br />
	#<br />
	MessageBox MB_OK &quot;$$1={$1}$\r$\n$$2={$2}&quot;<br />
	#<br />
	goto loop<br />
<br />
	close:<br />
	FileClose $0<br />
<br />
	end:<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th March 2006, 07:49</div></div><div class="posttext">If you want it to be even more efficient, you could remove the first TrimNewLines call and compare $1 to &quot;EditBox$\r$\n&quot; and &quot;CheckBox$\r$\n&quot;. This should be fine if you are sure the file will always contain Windows new lines (and not UNIX for example), but otherwise you can leave it in.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">29th March 2006, 16:43</div></div><div class="posttext">Hello guys.  Thanks for your help, sorry I have been slow to respond.  I found something very strange, at least to me.  I actually was using some very similar code to what Instructor posted, but mine took over 30 seconds to do what Instructor's could do in 2.5 seconds.<br />
<br />
So I copied Instructor's right into my script, and now his code took over 30 seconds.  What I found, is that running the same code using the MUI takes 33 seconds, where running it from a non-MUI exe takes only 3 seconds.  Here are the 2 nsi files:<br />
<br />
Name &quot;NoMUI&quot;<br />
OutFile &quot;NoMUI.exe&quot;<br />
<br />
!include &quot;TextFunc.nsh&quot;<br />
!insertmacro TrimNewLines<br />
<br />
Section<br />
	ClearErrors<br />
	FileOpen $0 &quot;test.txt&quot; r<br />
	IfErrors end<br />
<br />
	loop:<br />
	FileRead $0 $1<br />
	IfErrors close<br />
	StrCmp $1 &quot;EditBox$\r$\n&quot; +2<br />
	StrCmp $1 &quot;CheckBox$\r$\n&quot; 0 loop<br />
<br />
	FileRead $0 $2<br />
	IfErrors close<br />
	${TrimNewLines} &quot;$2&quot; $2<br />
        StrCpy $3 &quot;$3, $2&quot;<br />
	goto loop<br />
<br />
	close:<br />
	FileClose $0<br />
<br />
	end:<br />
	MessageBox MB_OK &quot;$3&quot;<br />
SectionEnd<br />
<br />
<br />
!include &quot;MUI.nsh&quot;<br />
<br />
!include &quot;TextFunc.nsh&quot;<br />
!insertmacro TrimNewLines<br />
<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
Name &quot;MUI&quot;<br />
OutFile &quot;MUI.exe&quot;<br />
<br />
Section &quot;&quot;<br />
<br />
	ClearErrors<br />
	FileOpen $0 &quot;test.txt&quot; r<br />
	IfErrors end<br />
<br />
	loop:<br />
	FileRead $0 $1<br />
	IfErrors close<br />
	StrCmp $1 &quot;EditBox$\r$\n&quot; +2<br />
	StrCmp $1 &quot;CheckBox$\r$\n&quot; 0 loop<br />
<br />
	FileRead $0 $2<br />
	IfErrors close<br />
	${TrimNewLines} &quot;$2&quot; $2<br />
        StrCpy $3 &quot;$3, $2&quot;<br />
	goto loop<br />
<br />
	close:<br />
	FileClose $0<br />
<br />
	end:<br />
	MessageBox MB_OK &quot;$3&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
I have attached these 2 NSI files, along with Test.txt which is a sample text file of 9000 lines, with the &quot;EditBox&quot; string intermingled within.  Let me know if I have something wrong, but this seems odd to me.  I would understand the MUI taking longer to load pages, but the section code shouldn't take longer to run should it?<br />
<br />
Thanks all!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th March 2006, 19:42</div></div><div class="posttext">The answer is:<br />
XPStyle on<br />
<br />
Put XPStyle on in the NonMUI script and you'll find that it then takes as long as the MUI script.<br />
To be honest though I'm really not sure why it takes longer with XPStyle on... I'll try some more things.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th March 2006, 19:51</div></div><div class="posttext">Ah here's the deal. It's because for every instruction it has to move the progress bar position. With XPStyle on due to the greater amount of visual stuff it takes that little time longer. Times it by how many lines you have in the text file times again by how many instructions exist in the loop and you'll get a great time increase!<br />
<br />
To fix this though is very easy :). Just move the entire code from within the Section into a seperate Function and Call the Function. You'll find that it now takes about 1 or 2 seconds because NSIS only has to move the progress bar once when it calls the function.<br />
<br />
I think this has uncovered the false 'myth' that NSIS code is extremely slow. It's not so it appears... it's the damn progress bar that we can't disable that is the culprit.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">29th March 2006, 19:55</div></div><div class="posttext">Afrow UK, yup, you got it.  I get the same results.  Nice work, thank you so much for your help on this one, I thought I was going crazy.  Thanks again!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th March 2006, 20:06</div></div><div class="posttext">Glad to be of service :)<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>