<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to make DLL Plugins, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to make DLL Plugins NSIS Discussion" />
	
	<title> How to make DLL Plugins [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to make DLL Plugins</div>
<hr />
<div class="pda"><a href="t-119184.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=119184">How to make DLL Plugins</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">prasanna</div><div class="date">27th December 2002, 12:11</div></div><div class="posttext">Hello All,<br />
<br />
I'm using NSIS for creating a setup.<br />
<br />
After reading the documents, I'm still not clear how to<br />
call any function in dll from .nsi file.<br />
<br />
If anybody having example of DLL  Plugin please do mail me<br />
at ppp_pras@yahoo.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th December 2002, 12:41</div></div><div class="posttext">Put your DLL in the Plugins directory or call PluginDir with the directory in which this plugin resides and then use DllNameWithOut.DllExtension::FunctionName.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prasanna</div><div class="date">27th December 2002, 12:56</div></div><div class="posttext">Hello kichik,<br />
<br />
Your reply helped me a lot.<br />
<br />
But now I am not getting how to pass the Arguments to the function.<br />
and get return datatypes.<br />
<br />
Please help me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th December 2002, 13:07</div></div><div class="posttext">Passing and getting parameters to and from the plug-in can be done in two ways. The first is using the NSIS stack (push and pop) the second is through the NSIS variables. You can access both from the plug-in using pushstring, popstring, getuservariable and setuservariable (all defined in ExDLL.h in Contrib\ExDLL).<br />
<br />
The preferred way is using the NSIS stack. To pass arguments to the plug-in use:<br />
<br />
PluginName::Function arg1 arg2 arg3<br />
<br />
The arguments will be pushed to the stack from right to left. The first time you call popstring in the plug-in you will get arg3 (you can push as many arguments as you want as long as there is enough memory ;)).<br />
<br />
To get the &quot;return value&quot; of the plug-in (preferably strings pushed by the plug-in) use Pop in NSIS:<br />
<br />
PluginName::Function arg1 arg2 arg3<br />
Pop $0<br />
<br />
The only data type NSIS knows is a string. If you want to convert the strings NSIS pushes on the stack you will have to use your own functions. You can find some in the other plug-ins written.<br />
<br />
Please reply to this thread next time instead of opening another one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prasanna</div><div class="date">28th December 2002, 10:30</div></div><div class="posttext">Hi All,<br />
<br />
Kichik you told me how to call any function from pluginn dll.<br />
<br />
See I'm trying to execute following code.<br />
After Testing Installation. It give error and says &quot;error log is being written&quot; <br />
<br />
1) Where is the error log?<br />
<br />
I'm trying to execute following code<br />
<br />
	StrCpy $R1 &quot;LFcl&quot;<br />
	StrCpy $R2 &quot;CeloxisCond&quot;<br />
	StrCpy $R3 &quot;C:\\CDK402a\\Common\\Bin\\C4.02\\jsync13.dll&quot;<br />
	CondMgr::CmInstallCreator $R1 &quot;1&quot;<br />
	CondMgr::CmSetCreatorName $R1 $R3<br />
	CondMgr::CmSetCreatorDirectory $R1 $R2<br />
	CondMgr::CmSetCreatorFile $R1 $R2<br />
	CondMgr::CmSetCreatorPriority $R1 &quot;1&quot;<br />
<br />
But it's not working<br />
<br />
Please help me in this regards.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th December 2002, 11:08</div></div><div class="posttext">NSIS has no such error message (&quot;error log is being written&quot;). Are you sure it comes from NSIS and not your plug-in? Are you sure you copied it right?<br />
Escaping the back-slashes in $R3 which is not needed in NSIS. I don't see anything wrong in this piece of code but that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prasanna</div><div class="date">28th December 2002, 13:00</div></div><div class="posttext">StrCpy $R1 &quot;LFcl&quot; <br />
CondMgr::CmInstallCreator $R1 1<br />
<br />
I can Compile NSIS script containing above lines. So there is no doubt that the file is there or not. Now when I click on Test Installer it runs my Executable(Installer). And at the point where I called that function it gives error <br />
as follows:<br />
-------------------------------------<br />
Installer.exe has generated errors and will be closed by Windows. You will need to restart the program.<br />
<br />
An error log is being created.<br />
<br />
------------------------------------<br />
Please guide me how to debug the error in such situation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th December 2002, 13:09</div></div><div class="posttext">If the error occurs when you call your plug-in the problem is in your plug-in. To make sure put a message box before and after the call to the plug-in. If the first one shows but the second doesn't it's your plug-in for sure. To debug your plug-in compile it in debug mode and debug... As I don't have the plug-in source I can't help you much there...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prasanna</div><div class="date">30th December 2002, 07:49</div></div><div class="posttext">HsCheckApiStatus prototype is :<br />
long WINAPI HsCheckApiStatus (void);<br />
<br />
HSAPI::HsCheckApiStatus<br />
Pop $0<br />
IntCmp $0 HSAPI::ERROR_HSAPI_HOTSYNC_NOT_FOUND hotsync_not_running<br />
IntCmp $0 HSAPI::ERROR_HSAPI_FAILURE hotsync_api_failure<br />
<br />
MessageBox MB_OK &quot;HOT SYNC.$0&quot;         <br />
return	<br />
<br />
hotsync_not_running:<br />
	MessageBox MB_OK &quot;HOT SYNC NOT RUNNING. PLEASE START HOTSYNC.&quot;<br />
        return<br />
hotsync_api_failure:<br />
	MessageBox MB_OK &quot;HOT SYNC API FAILURE&quot;<br />
        return<br />
-----------------------------------------------------------<br />
This is my api and this is how I have written code.<br />
Problem is it always goes to label <br />
&quot;HOT SYNC NOT RUNNING. PLEASE START HOTSYNC.&quot;<br />
<br />
How to deal with return types that are long or int?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prasanna</div><div class="date">30th December 2002, 09:33</div></div><div class="posttext">I'm writting a code in NSIS which deals with DLL plugins.<br />
The function has two arguments: the first one is an integer and the second is a char *.<br />
How does one pass Integer and String to that function? <br />
<br />
The function which I call returns an integer.<br />
How to get this integer value in variable? Pop documentation says it pops of a string. <br />
<br />
Can I use the return value (after getting it as described above) in IntCmp?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th December 2002, 14:38</div></div><div class="posttext">The prototype you used is wrong. The right prototype as mentioned in the ExDLL example is:<br />
void __declspec(dllexport) myFunction(HWND hwndParent, int string_size, char *variables, stack_t **stacktop);<br />
<br />
Data types:<br />
<br />
The only data type NSIS knows is a string. If you want to convert the strings NSIS pushes on the stack you will have to use your own functions. You can find some in the other plug-ins written. <br />
<br />
Same goes for what NSIS accepts... The only data type NSIS knows is strings which means you will have to convert your output to a string and push it on the stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prasanna</div><div class="date">31st December 2002, 05:41</div></div><div class="posttext">Hello kichik,<br />
<br />
Do you know which DLLs provide such fuctions. Please give me names of such DLL files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">31st December 2002, 13:46</div></div><div class="posttext">- contrib/nsexec.c uses wsprintf to convert ints to strings<br />
 - contrib/nsexec.c implements my_atoi to convert strings to ints<br />
 - contrib/advsplash.c uses wsprintf to convert ints to strings<br />
 - contrib/advsplash.c implements myatoi to convert strings to ints<br />
 - contrib/langdll.c implements myatoi to convert strings to ints<br />
 - contrib/nsisdl/util.cpp implements my_atoi to convert strings to ints (and also implements mini_memset and mini_memcpy)<br />
 - contrib/splash.c converts strings to ints using inline code (line 70)<br />
 - contrib/splash.c converts ints to strings using wsprintf<br />
 - contrib/system/source/plugin.c implements myitao, myitoa64, popint, pushint and copymem<br />
<br />
That should give you some idea what KiCHiK was on about.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>