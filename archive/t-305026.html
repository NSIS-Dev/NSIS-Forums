<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Can i use .onInstFailed for ignore button?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Can i use .onInstFailed for ignore button? NSIS Discussion" />
	
	<title> Can i use .onInstFailed for ignore button? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Can i use .onInstFailed for ignore button?</div>
<hr />
<div class="pda"><a href="t-305026.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305026">Can i use .onInstFailed for ignore button?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">healy76</div><div class="date">6th April 2009, 15:42</div></div><div class="posttext">Hi<br />
<br />
I have to change our Setup, but i don't know how can i do this. So i hope, anybody can help me.<br />
<br />
While installing any files, a error occurred sometimes<br />
( e.g. &quot;file can't extract&quot;). In the shown MessageBox is a &quot;Ignore&quot; button.  Can i remove this 'ignore' button?<br />
<br />
I would like to change the &quot;Completed&quot; Text, when any error messages occured while installing (4.8.1.10 CompletedText<br />
). But how can i get the button click event of the 'ignore' button. Can i use maybe the .onInstFailed?<br />
<br />
After the setup is finished i would like to set the text &quot;Completed with warnings&quot; or &quot;Completed with errors&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th April 2009, 01:41</div></div><div class="posttext">1. See: AllowSkipFiles<br />
2. Get a handle to that label (say, into $0) and use:<br />
SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:New Text on Label&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">healy76</div><div class="date">7th April 2009, 08:26</div></div><div class="posttext">Thank you very much for your reply. The first step i unterstand. This is what i'am looking for.<br />
<br />
But i don't understand step 2. Can you please explain this with more details?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th April 2009, 09:43</div></div><div class="posttext">Hmmm...<br />
<br />
One thing at a time...<br />
If you remove the Ignore button, the user only has two options left...<br />
A. Retry<br />
Which if they try again and again and it still fails, their only option is...<br />
B. Cancel<br />
<br />
Cancel will abort installation of any further files after that point.  When that happens, you still want to show a &quot;Completed with errors&quot; status?<br />
Sounds like a bad idea...<br />
<br />
Then back to your original question.. if you remove the Ignore button, how would you go about 'capturing' the effect of that Ignore button... it's not there to press? :)  Seems to me you'd want to keep that ignore button, then..<br />
<br />
So I'll just give example code for both scenarios...<br />
<br />
==================================================<br />
SCENARIO A: NO IGNORE BUTTON<br />
This code will simply change the status message to a user-friendly message instead of the last file-write error.<br />
The way this works is that -before- files are installed, it is assumed via a variable that the user -will- in fact abort the file installation.<br />
Then in the -very last- section, which contains no further instructions, that assumption is negated by changing the variable to indicate that the user did not abort file installation.<br />
After file installation, that variable is checked, and the status title changed accordingly.<br />
--------------------------------------------------<br />
<br />
!addplugindir &quot;.&quot;<br />
!addincludedir &quot;.&quot;<br />
<br />
!include &quot;nsDialogs.nsh&quot;<br />
!include &quot;winmessages.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
<br />
AllowSkipFiles off<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
Page InstFiles InstFilesPre InstFilesShow InstFilesPost<br />
<br />
Var UserAborted<br />
<br />
Function InstFilesPre<br />
	StrCpy $UserAborted 1<br />
FunctionEnd<br />
<br />
Function InstFilesShow<br />
FunctionEnd<br />
<br />
Section &quot;Files&quot;<br />
	SetOutPath &quot;$TEMP&quot;<br />
	    File &quot;MoreInfo.dll&quot;<br />
	    ; Locking that file so that we can force a file write error<br />
	    FileOpen $0 &quot;$TEMP\MoreInfo.dll&quot; &quot;r&quot;<br />
	    File &quot;MoreInfo.dll&quot;<br />
SectionEnd<br />
 <br />
Section &quot;-PostInstall&quot;<br />
   StrCpy $UserAborted 0<br />
SectionEnd<br />
<br />
Function InstFilesPost<br />
	${If} $UserAborted == 1<br />
		FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT   ; Inner dialog<br />
	    GetDlgItem $0 $0 0x3ee                  ; Status title<br />
	    SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:Installation aborted by user&quot;<br />
	    MessageBox MB_OK &quot;Installation aborted by user&quot;<br />
	${EndIf}<br />
FunctionEnd<br />
<br />
<br />
==================================================<br />
SITUATION B - Ignore button left intact.<br />
<br />
This is largely similar to Situation A, but this time we also track whether the user pressed the Ignore button.<br />
We can check this quite simply.  If the user pressed the Abort button, then no commands after the File command that threw the error will be processed.<br />
If the user pressed the Ignore button, then further commands -will- be processed.<br />
All that is left to do at that point is checking whether the File command threw an error - which we can do by checking the error flag. (IfErrors / ${If} ${Errors}).  Based on that, we can then set another variable indicating that there were errors that were ignored by the user.<br />
--------------------------------------------------<br />
<br />
!addplugindir &quot;.&quot;<br />
!addincludedir &quot;.&quot;<br />
<br />
!include &quot;nsDialogs.nsh&quot;<br />
!include &quot;winmessages.nsh&quot;<br />
!include &quot;logiclib.nsh&quot;<br />
<br />
AllowSkipFiles on<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
Page InstFiles InstFilesPre InstFilesShow InstFilesPost<br />
<br />
Var UserAborted<br />
Var UserIgnoredError<br />
<br />
Function InstFilesPre<br />
	StrCpy $UserAborted 1<br />
	StrCpy $UserIgnoredError 0<br />
FunctionEnd<br />
<br />
Function InstFilesShow<br />
FunctionEnd<br />
<br />
Section &quot;Files&quot;<br />
	SetOutPath &quot;$TEMP&quot;<br />
	    File &quot;MoreInfo.dll&quot;<br />
	    ; Locking that file so that we can force a file write error<br />
	    FileOpen $0 &quot;$TEMP\MoreInfo.dll&quot; &quot;r&quot;<br />
	    ClearErrors<br />
	    File &quot;MoreInfo.dll&quot;<br />
	    ${If} ${Errors}<br />
			StrCpy $UserIgnoredError 1<br />
			ClearErrors<br />
		${EndIf}<br />
SectionEnd<br />
 <br />
Section &quot;-PostInstall&quot;<br />
   StrCpy $UserAborted 0<br />
SectionEnd<br />
<br />
Function InstFilesPost<br />
	FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT   ; Inner dialog<br />
    GetDlgItem $0 $0 0x3ee                  ; Status title<br />
	${If} $UserAborted == 1<br />
	    SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:Installation aborted by user&quot;<br />
	    MessageBox MB_OK &quot;Installation aborted by user&quot;<br />
	${ElseIf} $UserIgnoredError == 1<br />
	    SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:Completed with user-ignored errors&quot;<br />
        MessageBox MB_OK &quot;Completed with user-ignored errors&quot;<br />
	${EndIf}<br />
FunctionEnd<br />
<br />
==================================================<br />
<br />
I hope that's more-or-less what you were looking for.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">healy76</div><div class="date">7th April 2009, 10:10</div></div><div class="posttext">Ohhh... Thanks a lot! Your &quot;SCENARIO B&quot; is great!!!<br />
<br />
My setups install ca 5000 files. So i have many many &quot;File &quot;MoreInfo.dll&quot; or &quot;File /r .\Files\*.*&quot; operations im my NSIS script. When i must write after every &quot;File&quot; operation your code &quot;${If} ${Errors}...&quot;  it was ... hm ... thick market. Apart from other operations e.g. WriteRegString, RegDLL, Delete ...<br />
<br />
Currently i will use your solution of scenario B. Thank you!<br />
<br />
In future it was very comfortable when NSIS contains a event (for example .onAnyErrorOccured). In this event i can change a Variable. At the end of the setup i could change the CompletedText.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th April 2009, 10:23</div></div><div class="posttext">Well you don't have to do it after -every- file command.<br />
<br />
You could do..<br />
<br />
ClearErrors<br />
File<br />
File<br />
File<br />
File<br />
File<br />
File<br />
File<br />
File<br />
${If} ${Errors}<br />
.. etc.<br />
<br />
And if any one of those File commands threw an error, that will still trigger.<br />
<br />
But you have to be very careful to check for other commands that may commonly set the Error flag without actually being a hard error.  E.g. DeleteRegValue will set the Error flag if the value you're trying to delete doesn't exist.  You're not very likely to care.. you just wanted the value gone and if it's not there to begin with - well, whatever.  But you'll still have to deal with that Error flag in some way.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th April 2009, 12:48</div></div><div class="posttext">oh... just to answer the subject of this thread: no.  .onInstFailed and .onInstSuccess only run at the very end of the installer - just before the window closes.  You can use that point to selectively clean up files, write things to the registry, etc. outside of regular installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">healy76</div><div class="date">8th April 2009, 10:10</div></div><div class="posttext">I have changed my scipt. It works fine. Thank you very much!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>