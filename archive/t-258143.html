<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Slow display for InstallOptions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Slow display for InstallOptions NSIS Discussion" />
	
	<title> Slow display for InstallOptions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Slow display for InstallOptions</div>
<hr />
<div class="pda"><a href="t-258143.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258143">Slow display for InstallOptions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">23rd October 2006, 15:36</div></div><div class="posttext">Hi,<br />
<br />
I am brand new to NSIS.<br />
<br />
But I have managed to write a little script in Modern UI format to deploy a few files and write a configuration file (my_app.ini file) accoding to values typed in a configuration window displayed by InstallOptions.<br />
<br />
My problem is that there is a delay in displaying that window. When I click next I see the title changing but it takes a few seconds before the window fields display (I am still with the previous window): I must be doing something wrong.<br />
<br />
Here are extracts of my code:<br />
 - in the Installer Pages<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
Page custom MailOptions<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
 - in the Main section<br />
    StrCpy $cfgINIfile &quot;$INSTDIR\${DS_XFRTFILES_DIR}\${DS_CONFIG_FILE}&quot;<br />
    WriteINIStr $cfgINIfile ${DS_CFG_MAIL_SECTION} ${DS_CFG_MAIL_EMAIL} $cfgEmail<br />
... (same for all the fields)<br />
    FlushINI $cfgINIfile<br />
<br />
<br />
 - I am in multi-languages, so in .onInit change the labels<br />
!insertmacro MUI_LANGDLL_DISPLAY<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;${DS_OPTION_FILE}&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;instOpt.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;$(MO_email)&quot;<br />
... (same for all the labels)<br />
<br />
 - MailOptions functions<br />
Function MailOptions<br />
<br />
  !insertmacro MUI_HEADER_TEXT &quot;$(MailOptionsTitle)&quot; &quot;$(MailOptionsSubTitle)&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;${DS_OPTION_FILE}&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgEmail &quot;${DS_OPTION_FILE}&quot; &quot;Field 2&quot; &quot;State&quot;<br />
... (same for all the fields)<br />
FunctionEnd<br />
<br />
<br />
<br />
Hopefully somebody will point out what I am doing wrong.<br />
Cheers,<br />
L@u</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">24th October 2006, 18:33</div></div><div class="posttext">Hi all,<br />
<br />
I still have a delay in the display of the extra panel defined by the InstallOption !<br />
I have invistigated a bit further and made a few changes.<br />
<br />
I have found that if I delete the lines to change the labels to the chosen language labels and I do not choose LZMA for the compression method, it is normal speed (quasi instantaneous).<br />
<br />
I could live without LZMA (although ideally I would lile to keep it), but I need to change the labels to the apropriate language.<br />
<br />
At the moment, I change the labels in the functions displaying the extra panel. It looks like this:<br />
<br />
<br />
Function MailOptions<br />
<br />
  !insertmacro MUI_HEADER_TEXT &quot;$(MailOptionsTitle)&quot; &quot;$(MailOptionsSubTitle)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;stp_opt.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;$(MO_email)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;stp_opt.ini&quot; &quot;Field 3&quot; &quot;Text&quot; &quot;$(MO_user)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;stp_opt.ini&quot; &quot;Field 6&quot; &quot;Text&quot; &quot;$(MO_pwd)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;stp_opt.ini&quot; &quot;Field 7&quot; &quot;Text&quot; &quot;$(MO_pop)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;stp_opt.ini&quot; &quot;Field 10&quot; &quot;Text&quot; &quot;$(MO_smtp)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;stp_opt.ini&quot; &quot;Field 11&quot; &quot;Text&quot; &quot;$(MO_port)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;stp_opt.ini&quot; &quot;Field 13&quot; &quot;Text&quot; &quot;$(MO_sendto)&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE   !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;stp_opt.ini&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgEmail &quot;stp_opt.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgUser &quot;stp_opt.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgPwd &quot;stp_opt.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgPop &quot;stp_opt.ini&quot; &quot;Field 8&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgSmtp &quot;stp_opt.ini&quot; &quot;Field 9&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgPort &quot;stp_opt.ini&quot; &quot;Field 12&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $cfgTo &quot;stp_opt.ini&quot; &quot;Field 14&quot; &quot;State&quot;<br />
FunctionEnd<br />
<br />
<br />
May be I should do it somewhere else to get a quicker display ?<br />
<br />
<br />
Thanks in advance for any help,<br />
L@u</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th October 2006, 20:31</div></div><div class="posttext">You should ReserveFile the INI file on the top of the script and also the InstallOptions.dll plug-in, as instructed in the MUI readme.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">25th October 2006, 09:16</div></div><div class="posttext">Thanks for your answer.<br />
I have now added the plugin which was missing for some reasons (I did have the ini file and language dialog) ... but that didn't change a thing: there's still a delay in displaying the option panel ! !<br />
<br />
Any other ideas ? ! ?<br />
<br />
Here is my Reserved file section:<br />
<br />
# Reserved Files<br />
ReserveFile &quot;stp_opt.ini&quot; ; My INI file for the Mail Options panel<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS ;InstallOptions plug-in<br />
!insertmacro MUI_RESERVEFILE_LANGDLL ;Language selection dialog<br />
ReserveFile &quot;${NSISDIR}\Plugins\AdvSplash.dll&quot;<br />
<br />
<br />
<br />
Cheers,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th October 2006, 17:15</div></div><div class="posttext">Where did you use ReserveFile? Is it on the very top of the script? It'd be simpler to tell what's wrong with the entire script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">26th October 2006, 11:16</div></div><div class="posttext">Hi,<br />
<br />
The files are reserved at the beginning of the script.<br />
<br />
In the attached zip file, I have included the two files, used to create the setup.exe file:<br />
  - setup.nsi<br />
  - setup_option.ini<br />
I have also added a dummy mail_files.vbs that will always display a &quot;Config OK !&quot; message, so you can run the install without any problems.<br />
The real one checks the config, setup scheduler jobs, and mail files to support team.<br />
<br />
Of course, you may use any file instead of setupFilesXfrt.exe<br />
<br />
<br />
Thanks again for any help,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th October 2006, 12:27</div></div><div class="posttext">There's no attachment. Try again. Notice the attachment is gone when you click Preview.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">26th October 2006, 12:51</div></div><div class="posttext">My mistake !<br />
<br />
I didn't notice the Preview problem.<br />
Here it is again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th October 2006, 13:02</div></div><div class="posttext">I get the same relative slowness with or without the writing of the LangStrings. If it's slower for you with the LangStrings, you can write them in .onGUIInit. The language tables are initialized at that point and it's only called once. Define to MUI_CUSTOMFUNCTION_GUIINIT to tell the MUI to call your custom .onGUIInit function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">26th October 2006, 14:33</div></div><div class="posttext">Houraa !<br />
<br />
Thanks a bunch ! !<br />
<br />
Yep, that did it  !<br />
<br />
BUT (they're always a but ;-) and I tend no to complain much about buts ;-) ! ), there's still a delay if I turn the LZMA compressions on (line 5 of the program) !<br />
If I comment out this line (then using the &quot;standard&quot; decompression) there is no delay as soon as I use LZMA, there is a delay again !<br />
<br />
Any ideas on that, anyone ?<br />
Although, it might seem not that important, but with my actual files, it's 150kb difference and with satellite connection, that makes a huge difference.<br />
<br />
<br />
Cheers,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th October 2006, 14:38</div></div><div class="posttext">I get the same delay with or without lzma. You are still talking about the custom page, right? The only compression related possible delay I can see is with .onInit and TheCompany.bmp which is not reserved.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">26th October 2006, 14:56</div></div><div class="posttext">Yes, I was talking about the custom page !<br />
<br />
And Yes, that did it! Still, I don't understand why not &quot;reserving&quot; the splash screen file which is used at the very beginning of the program will delay the display of the InstallOption (aka custom) page ? ! ?<br />
<br />
But thanks a lot !<br />
I am now an happy bunny !<br />
I suppose I should be grateful you came back from your 6 month &quot;walkabout&quot; just in time to fix my problems. ;-)<br />
<br />
Thanks again,</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>