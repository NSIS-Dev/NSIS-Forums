<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem deleting/writing file in system32, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem deleting/writing file in system32 NSIS Discussion" />
	
	<title> Problem deleting/writing file in system32 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem deleting/writing file in system32</div>
<hr />
<div class="pda"><a href="t-322817.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322817">Problem deleting/writing file in system32</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">spinky</div><div class="date">30th September 2010, 15:50</div></div><div class="posttext">Hey I am having a problem overwriting a .dll that is located in the system32 folder.  The thing is I can overwrite the file if I do the overwrite before I call a certain function I created.  Obviously then my function is screwing up my .nsi script but I don't know how.  Here is the function (it is for retrieving a version of a .dll file by passing a struct by reference):<br />
<br />
Function loadDll<br />
	Var /GLOBAL remDLL<br />
	<br />
	#create temp directory<br />
	SetOutPath $TEMP\<br />
	<br />
	#copy dll there<br />
	DetailPrint &quot;Copying my.dll to temporary directory...$TEMP&quot;<br />
	file &quot;..my.dll&quot;           <br />
	<br />
	 # allocate 12 bytes for struct<br />
	System::Alloc 12<br />
	<br />
	#Pop memory location of struct<br />
	Pop $0<br />
	<br />
	#initialize struct<br />
	System::Call &quot;*$0(i 0, i 0, i 0)&quot;	;Initialization		<br />
	<br />
	#Call getVersion in arpts.dll by reference with struct as argument<br />
	System::Call &quot;$TEMP\my.dll::getVersion(i r0)&quot;<br />
	<br />
	#Get values from struct and assign to registries <br />
	System::Call &quot;*$0(i.r1, i.r2, i.r3)&quot;<br />
	<br />
	# print values (test)<br />
	DetailPrint &quot;New Install DLL Version: $1 . $2 . $3&quot;<br />
	<br />
	#free<br />
	System::Free $0<br />
	<br />
	# allocate 12 bytes for struct<br />
	System::Alloc 12<br />
	<br />
	#Pop memory location of struct<br />
	Pop $4<br />
	<br />
	#initialize struct<br />
	System::Call &quot;*$4(i 0, i 0, i 0)&quot;	;Initialization		<br />
	<br />
	#Call getVersion in arpts.dll by reference with struct as argument<br />
	System::Call &quot;$INSTDIR\my.dll::getVersion(i r4)&quot;<br />
	<br />
	#Get values from struct and assign to registries 	 <br />
	System::Call &quot;*$4(i.r5, i.r6, i.r7)&quot;<br />
	<br />
	# print values (test)<br />
	DetailPrint &quot;Installed DLL Version: $5 . $6 . $7&quot;<br />
	<br />
	#free<br />
	System::Free $4<br />
	<br />
	#compare versions, if the same then Goto skip install<br />
	${If} $1 == $5<br />
		${If} $2 == $6<br />
			${If} $3 == $7<br />
				DetailPrint &quot;DLL versions the same, skipping install of my.dll...&quot;<br />
				StrCpy $remDLL &quot;0&quot;<br />
			${Else}<br />
				StrCpy $remDLL &quot;1&quot;<br />
				DetailPrint &quot;Overwriting my.dll...&quot;<br />
			${EndIf}<br />
		${EndIf}<br />
	${EndIf}<br />
FunctionEnd<br />
<br />
<br />
Any ideas as to why I am getting the error:<br />
<br />
&quot;Error opening file for writing&quot;<br />
<br />
C:\WINDOWS\system32\my.dll<br />
<br />
Thanks in advance,<br />
Brett</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">30th September 2010, 20:50</div></div><div class="posttext">I think you can't overwrite your installed dll because you implicitly loaded it to check its version. You can either unload it, or make a copy of it and check the version of that copy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spinky</div><div class="date">1st October 2010, 14:39</div></div><div class="posttext">Thanks for the help that was exactly the problem :).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>