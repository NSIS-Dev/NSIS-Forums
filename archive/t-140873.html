<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System::Call 'kernel32::GetTempPath..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System::Call 'kernel32::GetTempPath... NSIS Discussion" />
	
	<title> System::Call 'kernel32::GetTempPath... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System::Call 'kernel32::GetTempPath...</div>
<hr />
<div class="pda"><a href="t-140873.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140873">System::Call 'kernel32::GetTempPath...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">wandras</div><div class="date">2nd July 2003, 17:39</div></div><div class="posttext">Hi,<br />
<br />
I try to determine the temp path with the function GetTemPath of kernel32.dll (OS: Windows2000).<br />
<br />
Eg.:<br />
SetOutPath $SYSDIR<br />
StrCpy $0 ${NSIS_MAX_STRLEN}<br />
System::Call 'kernel32::GetTempPath(*i, t) i (r0, .r1) .r2'<br />
MessageBox MB_OK &quot;$0:$1:$2&quot;<br />
<br />
I get: 1024::error<br />
<br />
What could be wrong?<br />
<br />
THX:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">2nd July 2003, 17:57</div></div><div class="posttext">1. There two functions A(scii) and W (Unicode). You need first.<br />
2. Why you are using *i (pointer to int)? May be there is wrong tip in documentation somewhere?<br />
<br />
System::Call 'kernel32::GetTempPathA(i ${NSIS_MAX_STRLEN}, t .r1) i .r2'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">2nd July 2003, 18:00</div></div><div class="posttext">Why not use $TEMP?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wandras</div><div class="date">3rd July 2003, 22:45</div></div><div class="posttext">brainsucker,<br />
Thanks for the help. It works well with GetTempPathA.<br />
<br />
Lobo Lunar,<br />
I tried to use $TEMP, but realised that in Windows there are two TEMP variables defined. One for the current user (User variables) and one among the 'System variables'. I tried to get the second one. $TEMP returns the first one. After brainsucker's help it turned out that GetTempPathA returns the User variable TEMP as well. Finally<br />
ReadRegStr $1 HKLM &quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot; TEMP<br />
solved the problem, which returns the Sytem variable temp from the registry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">3rd July 2003, 22:54</div></div><div class="posttext">and if you script this:<br />
<br />
SetShellVarContext &quot;all&quot;<br />
MessageBox MB_OK $TEMP</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wandras</div><div class="date">3rd July 2003, 23:35</div></div><div class="posttext">SetShellVarContext works fine eg. with $DESKTOP, $STARTMENU, $SMPROGRAMS, SMSTARTUP or $QUICKLAUNCH<br />
$TEMP returns the current user's TEMP variable with SetShellVarContext &quot;all&quot; as well.<br />
Anyway, good idea with the above mentioned vars.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>