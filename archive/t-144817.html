<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" A little help would be appriciated, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  A little help would be appriciated NSIS Discussion" />
	
	<title> A little help would be appriciated [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  A little help would be appriciated</div>
<hr />
<div class="pda"><a href="t-144817.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144817">A little help would be appriciated</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th August 2003, 18:55</div></div><div class="posttext">Before installation of My NSIS program is it possible to check the version of an exisiting exe to see if its the correct version?<br />
<br />
I don't really mean by checking it through the Reg though, as this does not show the correct version info.<br />
<br />
The original game is version 1.0.0.0, there are two updates for this game which will change the version to 2.0.0.1 or 2.0.0.2<br />
<br />
I only want my NSIS program to install if the version is 2.0.0.2 otherwize you will get a message saying that you will need to update the game before you can install my NSIS program then quit<br />
<br />
If it is the correct version it will install normally<br />
<br />
At the momment My NSIS program checks the reg to see if the game is the correct version then installs<br />
<br />
using this bit of script<br />
<br />
Function .onInit<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\\Game software\\v1.0&quot; &quot;Version&quot;<br />
IntCmp $0 1 +1 +1 +3<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;WARNING: GAME needs to be updated to version 2.02.&quot;<br />
Abort<br />
FunctionEnd<br />
This is fine, but my NSIS program will install if the Games 2.01 update has been installed, which will bugger up the entire installation and make the game unplayable<br />
<br />
See in the Reg the &quot;version&quot; is either 1 for the original or 2 if either update has been added.<br />
<br />
Which makes checking the reg pointless<br />
<br />
Like I said the only real way to check this would be from the Games EXE as this shows the true version.<br />
<br />
Any help would be greatly appriciated plus showing me how the script should look<br />
<br />
Thanks in advance<br />
<br />
-Tony</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">5th August 2003, 18:58</div></div><div class="posttext">So you need to check the version information resource? It could be possible using the System plug-in or you can write your own plug-in.<br />
<br />
Is there no registry key / configuration file available with the version number?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th August 2003, 19:19</div></div><div class="posttext">Yes it shows the version number<br />
<br />
HKLM &quot;SOFTWARE\Game software\v1.0&quot; &quot;Version&quot; 1.0<br />
<br />
but if the game updates are applied it only shows to 2.0<br />
<br />
so even if the 2.01 patch is install my program will still install, which I don't want it to do<br />
<br />
Thats why I would like to check the exe which shows the exact version.<br />
<br />
As I'm new to all this I have no way of knowing how to write a plug-in or which commands to use if any<br />
<br />
sorry, just a thick noobie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 21:16</div></div><div class="posttext">NSIS plugins are usually written in C++/Delphi.<br />
If you do not know about creating you're own plugin, then the System plugin will do your job.<br />
<br />
You should also try using the SysInfo plugin (get on NSIS Archive) which can get the version of specified files.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">5th August 2003, 22:03</div></div><div class="posttext">I don't know how to use it though :( <br />
<br />
This is the reason, I'm asking for help<br />
<br />
Its not too much to ask</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 22:24</div></div><div class="posttext">http://nsis.sourceforge.net/archive/download.php?file=sysinfo.dll.zip<br />
<br />
Extract just the dll to your Plugins dir.<br />
<br />
Now, in your script use:<br />
sysinfo::GetFileVersion &quot;x:\path\to\exe&quot;<br />
Pop $0 ;file version<br />
<br />
If $0 is empty (&quot;&quot;) then try:<br />
sysinfo::GetFileVersionValue &quot;FileVersion&quot; &quot;x:\path\to\exe&quot;<br />
Pop $0 ;file version<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">6th August 2003, 03:10</div></div><div class="posttext">Thanks for pointing me in the right direction Afrow UK :)<br />
<br />
I figured out how to use the script you provided<br />
<br />
but the next bit was a liitle harder<br />
<br />
Function .onInit<br />
sysinfo::GetFileVersion &quot;x:\\path\to\\exe&quot;<br />
Pop $0<br />
StrCmp $0 &quot;2.0.0.2&quot; +3<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;The Game has not yet been updated to version 2.02.&quot;<br />
Abort<br />
FunctionEnd<br />
<br />
It was this bit StrCmp $0 &quot;2.0.0.2&quot; +3 that had me a little perplexed, it's taken me around 3 hrs just to figure that line out.<br />
<br />
Tried god knows how many differrent combinations of IntCmp, IntCmpU, StrCpy plus a few others, I was about to give up on it, when I came upon the combination above which works.<br />
<br />
So once again thanks :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 10:42</div></div><div class="posttext">Just a thought, what happens if 2.0.0.3 comes out.<br />
You're installer will think that the user has an older version.<br />
<br />
You should remove the dot (.) from the version, and use IntCmp instead.<br />
To remove the dots, use the StrReplace (http://nsis.sourceforge.net/archive/nsisweb.php?page=124&amp;instances=0,11,122) function:<br />
Push $0 ;input<br />
Push &quot;.&quot; ;to replace<br />
Push &quot;&quot; ;replace with nothing (remove)<br />
 Call StrReplace<br />
Pop $0<br />
IntCmp $0 2002 +3 0 +3<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;The Game has not yet been updated to version 2.02.&quot;<br />
Abort<br />
<br />
IntCmp works like this:<br />
IntCmp $0 2002 [goto if $0=2002] [goto if $0&lt;2002] [goto if $0&gt;2002]<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">6th August 2003, 13:29</div></div><div class="posttext">How about using the code Smile2Me created ages ago to compare dotted versions?<br />
<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=57</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteelCoder</div><div class="date">6th August 2003, 13:51</div></div><div class="posttext">If the executable has an actual 'version' resource in it (and it's maintained correctly), Couldn't you use GetDLLVersion?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ramon18</div><div class="date">6th August 2003, 15:40</div></div><div class="posttext">Yes, you can use GetDLLVersion, for example you can use the previous uninstall.exe version info, by detecting the file location through the registry and than decide if the update can run or not.<br />
<br />
good luck</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SteelCoder</div><div class="date">6th August 2003, 18:41</div></div><div class="posttext">Why not just compare the version of the file you are going to install verses the file that is installed? Just like upgrading a DLL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">6th August 2003, 20:19</div></div><div class="posttext">No chance of a update to 2.0.0.3 unless a miricale happens<br />
<br />
It's a oldish game<br />
<br />
The code know looks like this<br />
<br />
Function .onInit<br />
sysinfo::GetFileVersion &quot;x:\path\to\exe&quot; <br />
Pop $0<br />
Push $0 ;input<br />
Push &quot;.&quot; ;to replace<br />
Push &quot;&quot; ;replace with nothing (remove)<br />
Call StrReplace<br />
Pop $0<br />
IntCmp $0 2002 +3 0 +3<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;The Game has not yet been updated to version 2.02.&quot;<br />
Abort<br />
FunctionEnd<br />
<br />
With the StrReplace script underneath it<br />
<br />
Hope this is what you meant, it works anyhow thanks again :)<br />
<br />
Thanks again Afrow<br />
<br />
Sunjammer I looked at the code you suggested, thanks, but Afrow's code is fine.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>