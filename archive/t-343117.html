<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" newbie question: nsdialog example, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  newbie question: nsdialog example NSIS Discussion" />
	
	<title> newbie question: nsdialog example [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  newbie question: nsdialog example</div>
<hr />
<div class="pda"><a href="t-343117.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=343117">newbie question: nsdialog example</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cmirko</div><div class="date">13th March 2012, 13:45</div></div><div class="posttext">hi all, <br />
<br />
I'm trying to make an installer for my application, from examples and wiki I managed to make NSIS script which compiles and does the requested job, now I'm trying to add a simple dialog option which would give the user an option to put shortcuts on desktop and in quick launch (I know how to create shortcuts, but &quot;option screen&quot; is beyond me....<br />
<br />
Would someone experienced be willing to make an example how to accomplish this ?<br />
<br />
my script so far:<br />
<br />
; basic script template for NSIS installers<br />
;<br />
; Written by Philip Chu<br />
; Copyright (c) 2004-2005 Technicat, LLC<br />
;<br />
; This software is provided 'as-is', without any express or implied warranty.<br />
; In no event will the authors be held liable for any damages arising from the use of this software.<br />
 <br />
; Permission is granted to anyone to use this software for any purpose,<br />
; including commercial applications, and to alter it ; and redistribute<br />
; it freely, subject to the following restrictions:<br />
 <br />
;    1. The origin of this software must not be misrepresented; you must not claim that<br />
;       you wrote the original software. If you use this software in a product, an<br />
;       acknowledgment in the product documentation would be appreciated but is not required.<br />
 <br />
;    2. Altered source versions must be plainly marked as such, and must not be<br />
;       misrepresented as being the original software.<br />
 <br />
;    3. This notice may not be removed or altered from any source distribution.<br />
<br />
!define setup &quot;@Magic_Navigator_setup.exe&quot;<br />
 <br />
; change this to wherever the files to be packaged reside<br />
!define srcdir &quot;C:\Program Files\NSIS\test_magic\&quot;<br />
!define company &quot;BS&quot;<br />
!define prodname &quot;@Magic Navigator&quot;<br />
!define exec &quot;MagicNavigator.exe&quot;<br />
!define helpfile &quot;manual.pdf&quot;<br />
!define deinstall &quot;uninstall.exe&quot;<br />
; optional stuff<br />
 <br />
; text file to open in notepad after installation<br />
; !define notefile &quot;README.txt&quot;<br />
 <br />
; license text file<br />
; !define licensefile license.txt<br />
 <br />
; icons must be Microsoft .ICO files<br />
!define icon &quot;magic_ikona.ico&quot;<br />
!define deicon &quot;delete.ico&quot;<br />
 <br />
; installer background screen<br />
; !define screenimage background.bmp<br />
 <br />
; file containing list of file-installation commands<br />
; !define files &quot;files.nsi&quot;<br />
 <br />
; file containing list of file-uninstall commands<br />
; !define unfiles &quot;unfiles.nsi&quot;<br />
 <br />
; registry stuff<br />
 <br />
!define regkey &quot;Software\${company}\${prodname}&quot;<br />
!define uninstkey &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${prodname}&quot;<br />
!define regkey-UN &quot;Software\Siemens\Magic Navigator&quot;<br />
!define startmenu &quot;$SMPROGRAMS\${prodname}&quot;<br />
!define uninstaller &quot;uninstall.exe&quot;<br />
<br />
;--------------------------------<br />
 <br />
XPStyle on<br />
ShowInstDetails hide<br />
ShowUninstDetails hide<br />
 <br />
Name &quot;${prodname}&quot;<br />
Caption &quot;${prodname}&quot;<br />
 <br />
!ifdef icon<br />
Icon &quot;${icon}&quot;<br />
!endif<br />
 <br />
OutFile &quot;${setup}&quot;<br />
 <br />
SetDateSave on<br />
SetDatablockOptimize on<br />
CRCCheck on<br />
SilentInstall normal<br />
 <br />
InstallDir &quot;$PROGRAMFILES\${company}\${prodname}&quot;<br />
InstallDirRegKey HKLM &quot;${regkey}&quot; &quot;&quot;<br />
 <br />
!ifdef licensefile<br />
LicenseText &quot;License&quot;<br />
LicenseData &quot;${srcdir}\${licensefile}&quot;<br />
!endif<br />
 <br />
; pages<br />
; we keep it simple - leave out selectable installation types<br />
 <br />
!ifdef licensefile<br />
Page license<br />
!endif<br />
 <br />
; Page components<br />
Page directory<br />
Page instfiles<br />
 <br />
UninstPage uninstConfirm<br />
UninstPage instfiles<br />
 <br />
;--------------------------------<br />
 <br />
AutoCloseWindow false<br />
ShowInstDetails show<br />
 <br />
 <br />
!ifdef screenimage<br />
 <br />
; set up background image<br />
; uses BgImage plugin<br />
 <br />
Function .onGUIInit<br />
	; extract background BMP into temp plugin directory<br />
	InitPluginsDir<br />
	File /oname=$PLUGINSDIR\1.bmp &quot;${screenimage}&quot;<br />
 <br />
	BgImage::SetBg /NOUNLOAD /FILLSCREEN $PLUGINSDIR\1.bmp<br />
	BgImage::Redraw /NOUNLOAD<br />
FunctionEnd<br />
 <br />
Function .onGUIEnd<br />
	; Destroy must not have /NOUNLOAD so NSIS will be able to unload and delete BgImage before it exits<br />
	BgImage::Destroy<br />
FunctionEnd<br />
 <br />
!endif<br />
 <br />
; beginning (invisible) section<br />
Section<br />
 <br />
  WriteRegStr HKLM &quot;${regkey}&quot; &quot;Install_Dir&quot; &quot;$INSTDIR&quot;<br />
  ; write uninstall strings<br />
  WriteRegStr HKLM &quot;${uninstkey}&quot; &quot;DisplayName&quot; &quot;${prodname} (remove only)&quot;<br />
  WriteRegStr HKLM &quot;${uninstkey}&quot; &quot;UninstallString&quot; '&quot;$INSTDIR\${uninstaller}&quot;'<br />
 <br />
!ifdef filetype<br />
  WriteRegStr HKCR &quot;${filetype}&quot; &quot;&quot; &quot;${prodname}&quot;<br />
!endif<br />
 <br />
  WriteRegStr HKCR &quot;${prodname}\Shell\open\command\&quot; &quot;&quot; '&quot;$INSTDIR\${exec} &quot;%1&quot;'<br />
 <br />
!ifdef icon<br />
  WriteRegStr HKCR &quot;${prodname}\DefaultIcon&quot; &quot;&quot; &quot;$INSTDIR\${icon}&quot;<br />
!endif<br />
 <br />
  SetOutPath $INSTDIR<br />
 <br />
 <br />
; package all files, recursively, preserving attributes<br />
; assume files are in the correct places<br />
File /r /x install_script.nsi &quot;${srcdir}\&quot;<br />
<br />
!ifdef licensefile<br />
File /a &quot;${srcdir}\${licensefile}&quot;<br />
!endif<br />
 <br />
!ifdef notefile<br />
File /a &quot;${srcdir}\${notefile}&quot;<br />
!endif<br />
 <br />
!ifdef icon<br />
File /a &quot;${srcdir}\${icon}&quot;<br />
!endif<br />
 <br />
; any application-specific files<br />
!ifdef files<br />
!include &quot;${files}&quot;<br />
!endif<br />
 <br />
  WriteUninstaller &quot;${uninstaller}&quot;<br />
 <br />
SectionEnd<br />
 <br />
; create shortcuts<br />
Section<br />
 <br />
  CreateDirectory &quot;${startmenu}&quot;<br />
  SetOutPath $INSTDIR ; for working directory<br />
!ifdef icon<br />
  CreateShortCut &quot;${startmenu}\${prodname}.lnk&quot; &quot;$INSTDIR\${exec}&quot; &quot;&quot; &quot;$INSTDIR\${icon}&quot;<br />
!else<br />
  CreateShortCut &quot;${startmenu}\${prodname}.lnk&quot; &quot;$INSTDIR\${exec}&quot;<br />
!endif<br />
 <br />
!ifdef notefile<br />
  CreateShortCut &quot;${startmenu}\Release Notes.lnk &quot;$INSTDIR\${notefile}&quot;<br />
!endif<br />
 <br />
!ifdef helpfile<br />
  CreateShortCut &quot;${startmenu}\User manual.lnk &quot;$INSTDIR\${helpfile}&quot;<br />
!endif<br />
<br />
!ifdef deinstall<br />
CreateShortCut &quot;${startmenu}\uninstaller.lnk &quot;$INSTDIR\${deinstall}&quot; &quot;&quot; &quot;$INSTDIR\${deicon}&quot;<br />
!endif<br />
<br />
!ifdef website<br />
WriteINIStr &quot;${startmenu}\web site.url&quot; &quot;InternetShortcut&quot; &quot;URL&quot; ${website}<br />
 ; CreateShortCut &quot;${startmenu}\Web Site.lnk &quot;${website}&quot; &quot;URL&quot;<br />
!endif<br />
 <br />
!ifdef notefile<br />
ExecShell &quot;open&quot; &quot;$INSTDIR\${notefile}&quot;<br />
!endif<br />
 <br />
SectionEnd<br />
 <br />
 Section &quot;Quick Launch icon&quot; SecQuick<br />
  StrCmp $QUICKLAUNCH $TEMP +2<br />
    CreateShortcut &quot;$QUICKLAUNCH\@MagicNavigator.lnk&quot; &quot;$INSTDIR\${exec}&quot; &quot;&quot; &quot;$INSTDIR\${icon}&quot;<br />
SectionEnd<br />
<br />
; Uninstaller<br />
; All section names prefixed by &quot;Un&quot; will be in the uninstaller<br />
 <br />
UninstallText &quot;This will uninstall ${prodname}.&quot;<br />
 <br />
!ifdef icon<br />
UninstallIcon &quot;${icon}&quot;<br />
!endif<br />
 <br />
Section &quot;Uninstall&quot;<br />
 <br />
  DeleteRegKey HKLM &quot;${uninstkey}&quot;<br />
  DeleteRegKey HKLM &quot;${regkey}&quot;<br />
  DeleteRegKey HKCU &quot;${regkey-UN}&quot;<br />
  Delete &quot;${startmenu}\*.*&quot;<br />
  Delete &quot;$QUICKLAUNCH\@MagicNavigator.lnk&quot;<br />
  Delete &quot;${startmenu}&quot;<br />
  Delete &quot;$INSTDIR\*.*&quot;  <br />
  RMDir /r &quot;$INSTDIR\@Magic_Navigator_User_Manual_hr_files\&quot;<br />
  RMDir /r &quot;$INSTDIR\Config&quot;<br />
  RMDir /r &quot;$INSTDIR\WebHelp&quot;<br />
  RMDir /r &quot;$INSTDIR\imageformats&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
!ifdef licensefile<br />
Delete &quot;$INSTDIR\${licensefile}&quot;<br />
!endif<br />
 <br />
!ifdef notefile<br />
Delete &quot;$INSTDIR\${notefile}&quot;<br />
!endif<br />
 <br />
!ifdef icon<br />
Delete &quot;$INSTDIR\${icon}&quot;<br />
!endif<br />
 <br />
Delete &quot;$INSTDIR\${exec}&quot;<br />
 <br />
!ifdef unfiles<br />
!include &quot;${unfiles}&quot;<br />
!endif<br />
<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">13th March 2012, 15:36</div></div><div class="posttext">There are several ways how to do it:<br />
1) simple MessageBox with yes/no buttons askin &quot;Do you want to place shortcut of Your_Software on Desktop?&quot;<br />
or<br />
2) Create nsDialogs forms with two checkboxes - a) shortcuts on desktop b) in quick launch<br />
in dialog Leave function simply check whether boxes are checked -&gt; if yes then do the same as in 1<br />
<br />
P.S.: Use pastebin for huge scripts :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">13th March 2012, 15:43</div></div><div class="posttext">There's an excellent tutorial in the nsDialogs readme: http://nsis.sourceforge.net/Docs/nsDialogs/Readme.html<br />
<br />
And yes, please use pastebin or attachments for huge scripts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cmirko</div><div class="date">22nd March 2012, 14:06</div></div><div class="posttext">hi again, <br />
<br />
found some time to work on installer, so far I've got this &quot;code&quot;<br />
http://pastebin.com/Q5Gbh4BG<br />
<br />
GUI representation is OK but installer always writes shortcuts (not dependent on checkbox selection). <br />
<br />
thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">22nd March 2012, 14:44</div></div><div class="posttext">You should not create shortcuts in a page function, you should do it in a section. (Otherwise you're making changes to a system before the user has started the actual installation process!) Also, I've no idea what you're trying to accomplish by comparing $DESKTOP to $TEMP...  o__O<br />
<br />
Try this:<br />
http://pastebin.com/MN3uHy6h</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cmirko</div><div class="date">22nd March 2012, 15:03</div></div><div class="posttext">thanks mate, your example worked nicely (I had to change state &quot;0&quot; to &quot;1&quot;). as you can see the original thread title is truthful :), I'm a newbie and that comparison is not needed at all....<br />
<br />
cheers</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>