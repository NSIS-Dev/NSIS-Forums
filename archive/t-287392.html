<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Linefind text insert issue, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Linefind text insert issue NSIS Discussion" />
	
	<title> Linefind text insert issue [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Linefind text insert issue</div>
<hr />
<div class="pda"><a href="t-287392.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=287392">Linefind text insert issue</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">carlosfocker</div><div class="date">22nd February 2008, 19:03</div></div><div class="posttext">Has anyone else noticed that inserting text using linefind into a file doesn't work correctly anymore.  I figured it was just me so I ran the example in the documentation (Example4 (insert lines)) and found that it does not work as well.  It seems to occur only when you want to write to the file and output the changes to the same filename.  This did work before. I plan on looking into this but wanted to throw it out there to see if anyone noticed.  Any help would be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd February 2008, 19:15</div></div><div class="posttext">The first example works fine for me and the tests pass. What exactly doesn't work for you?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">carlosfocker</div><div class="date">22nd February 2008, 19:34</div></div><div class="posttext">Section<br />
	${LineFind} &quot;C:\a.log&quot; &quot;&quot; &quot;10&quot; &quot;Example4&quot;<br />
	IfErrors 0 +2<br />
	MessageBox MB_OK &quot;Error&quot;<br />
SectionEnd<br />
<br />
Function Example4<br />
	FileWrite $R4 &quot;---First Line---$\r$\n&quot;<br />
	FileWrite $R4 &quot;---Second Line ...---$\r$\n&quot;<br />
<br />
	Push $0<br />
FunctionEnd<br />
<br />
<br />
<br />
This code does not insert the the two lines into c:\a.log.    I ran the code and look in c:\a.log that I created before hand and nothing is inserted.  If I change the output to a2.log the text is inserted into a2.log.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd February 2008, 19:42</div></div><div class="posttext">Code works fine for me. It inserts those two lines of text right before the 10th line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">carlosfocker</div><div class="date">24th February 2008, 18:22</div></div><div class="posttext">I know why I was seeing the issue with the example.  If the file is completely empty it doesn't insert the text.  If there is an actual 10th line in the file it will insert.<br />
<br />
The thing I don't get is I had some functionality that used the linefind that worked and just stopped working.  It had a linefind call within a linefind (not sure if this matters) call.  Like this:<br />
<br />
<br />
<br />
Section test<br />
<br />
   ${LineFind} &quot;c:\file.txt&quot; &quot;c:\file.txt&quot; &quot;1:-1&quot; &quot;fileReplace&quot;<br />
<br />
SectionEnd<br />
<br />
Function fileReplace<br />
<br />
   ;String to search for<br />
   StrCpy $R0 &quot;test=&quot;<br />
<br />
   ${LineFind} &quot;c:\file.txt&quot; &quot;/NUL&quot; &quot;1:-1&quot; &quot;FindStringInString&quot;<br />
<br />
   ;String to insert<br />
   StrCpy $R0 &quot;test=test$\r$\n&quot;<br />
<br />
   ${LineFind} &quot;c:\file.txt&quot; &quot;&quot; &quot;$R1&quot; &quot;FileTextInsert&quot;<br />
<br />
   Push $0<br />
<br />
FunctionEnd<br />
<br />
;Writes the string provided in $R0<br />
function FileTextInsert<br />
<br />
     ;Write the specified string ($R0) to the file specified by linefind ($R4)<br />
     FileWrite $R4 $R0<br />
 <br />
     Push $0<br />
<br />
functionend<br />
<br />
;Searches a given string and assignes $R1 the line number where it was found + 1<br />
Function FindStringInString<br />
<br />
      ;$R9 is the path name return by locate.  It equals the path name for the current file that was found<br />
      ${TrimNewLines} '$R9' $R9              <br />
<br />
      ;Search the current line to see if specified value is there<br />
      ${WordFind} &quot;$R9&quot; &quot;$R0&quot; &quot;+1{&quot; $1<br />
<br />
    ;If string to search is not equal to output string then line was not found.<br />
    ${IfNot} $R9 == $1<br />
<br />
          ;Sets the $0 to contain a string that stops<br />
	  StrCpy $0 StopLineFind<br />
<br />
          ;Sets $R1 with the line number found<br />
	  StrCpy $R1 $R8<br />
<br />
          ;Increment $R1 to the next line number<br />
	  IntOp $R1 $R1 + 1<br />
<br />
    ${EndIf}<br />
<br />
    ;Search the next line<br />
    StrCpy $R9 &quot;$R9$\r$\n&quot;<br />
<br />
    Push $0<br />
<br />
FunctionEnd<br />
<br />
<br />
<br />
<br />
I have excluded some code to make it cleaner.  The problem I have is this code worked for me before and now it doesn't.  I was able to get it working by calling fileReplace directly.  I do realize that the way above is unnecessary and it isn't really necessary to fix.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>