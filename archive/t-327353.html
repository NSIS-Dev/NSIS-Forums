<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Custom finish page with iospecial.ini problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Custom finish page with iospecial.ini problem NSIS Discussion" />
	
	<title> Custom finish page with iospecial.ini problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Custom finish page with iospecial.ini problem</div>
<hr />
<div class="pda"><a href="t-327353.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327353">Custom finish page with iospecial.ini problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zbynour</div><div class="date">15th February 2011, 16:36</div></div><div class="posttext">Hello,<br />
I'm quite new to creeating custom finish page in NSIS installer and have a problem. The goal is to create three checkboxes on the finicsh page. I use NSIS MUI, so two checkboxes -- no problem (MUI_FINISHPAGE_RUN etc.). But three checkboxes requires custom page function. I've researched that I should write into iospecial.ini file in order to customize the finish page. But I'm not able to write there! I'm trying something like this:<br />
<br />
; ...<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE FinishPre<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE FinishLeave<br />
; ...<br />
!insertmacro MUI_PAGE_FINISH<br />
; ...<br />
Function FinishPre<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;4&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 4&quot; &quot;Type&quot; &quot;CheckBox&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 4&quot; &quot;Text&quot; &quot;&amp;Create Quicklaunch Shortcut&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 4&quot; &quot;Left&quot; &quot;120&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 4&quot; &quot;Right&quot; &quot;315&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 4&quot; &quot;Top&quot; &quot;130&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 4&quot; &quot;Bottom&quot; &quot;140&quot;<br />
  WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;1&quot;<br />
FunctionEnd<br />
<br />
Function FinishLeave<br />
  ReadINIStr $0 &quot;iospecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot;<br />
  MessageBox MB_OK &quot;FinishLeave function: $0&quot;<br />
FunctionEnd<br />
<br />
But it does nothing... Beterr to say, message box appears, functions called, but writing into ini file seems doesn't work.<br />
<br />
I appreciate any ideas, if you have... Thanks in advance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th February 2011, 17:10</div></div><div class="posttext">I assume you have put!define MUI_PAGE_CUSTOMFUNCTION_PRE FinishPre<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE FinishLeavejust before!insertmacro MUI_PAGE_FINISH, and nothing in between?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zbynour</div><div class="date">15th February 2011, 20:38</div></div><div class="posttext">It is part of bigger and more complex installer, so I posted only lines relevant for my problem. There is something between, of course. But all related to this I've posted above, I hope. Is there something missing? Maybe it is the problem...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">15th February 2011, 20:40</div></div><div class="posttext">You should !define the pre and leave functions immediately before you !insertmacro the finish page. Don't put anything in between.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zbynour</div><div class="date">16th February 2011, 10:21</div></div><div class="posttext">Yes, I have now this piece of code (nothing between !define pre and leave function and !insertmacto finish page):<br />
<br />
Function FinishPre<br />
	MessageBox MB_OK &quot;FinishPre function&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;6&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Type&quot; &quot;Label&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Text&quot; &quot;blah&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Left&quot; &quot;200&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Right&quot; &quot;250&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Top&quot; &quot;100&quot;<br />
	WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Bottom&quot; &quot;120&quot;<br />
FunctionEnd<br />
<br />
Function FinishLeave<br />
	Push $0<br />
	MessageBox MB_OK &quot;FinishLeave function&quot;<br />
	ReadINIStr $0 &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Text&quot;<br />
	MessageBox MB_OK &quot;field 6 text: $0&quot;<br />
	Pop $0<br />
FunctionEnd<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE FinishPre<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE FinishLeave<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
But it does nothing! In the leave function, my text 'blah' is red and also displayed in the messagebox, it's ok, but no label, nothing displayed on the finish page! (better to say, there is something, but no my label with text &quot;blah&quot;)<br />
<br />
I was looking for the file iospecial.ini in the $PLUGINSDIR, but there is no iospecial.ini file. Could it be the problem?<br />
<br />
Another thing -- I don't know which field number can I use -- is the field number important? It seems that iospecial.ini file which I write into is something different that iospecial.ini used by NSIS to create finish page...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th February 2011, 10:42</div></div><div class="posttext">If there's no iospecial.ini you're not looking properly, because you just said yourself that 'blah' is read from iospecial.ini without problems.<br />
<br />
Also, note that you should be using MUI1, not MUI2.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zbynour</div><div class="date">16th February 2011, 11:12</div></div><div class="posttext">Yes, text 'blah' is read in leave function, but not displayed on finish page, i.e. not used -- so I think I'm writing into some different iospecial.ini... Or any other thing? <br />
I was looking for iospecial.ini in the $PLUGINSDIR, i.e. in the temporary directory during installer is running.<br />
<br />
I include &quot;MUI2.nsh&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th February 2011, 11:43</div></div><div class="posttext">If you use MUI2 you need to be using nsDialogs not InstallOptions.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zbynour</div><div class="date">16th February 2011, 13:17</div></div><div class="posttext">So does it mean that MUI2 with InstallOptions sometimes works and sometimes not?<br />
I'm not author of whole this installer so I don't know some things, but InstallOptions worked well till now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th February 2011, 13:20</div></div><div class="posttext">No the point is MUI2 uses nsDialogs for its finish/welcome pages. Therefore there is no ioSpecial.ini. If you want to add to the finish/welcome pages, use nsDialogs.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zbynour</div><div class="date">16th February 2011, 15:34</div></div><div class="posttext">So I've tried to add something to the finish page but not succesful again..<br />
<br />
Var Label<br />
<br />
Function FinishPre<br />
	${NSD_CreateLabel} 50 50 100% 12u &quot;blah blah&quot;<br />
	Pop $Label<br />
FunctionEnd <br />
<br />
Function FinishLeave<br />
   # ...<br />
FunctionEnd <br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE FinishPre<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE FinishLeave<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
This code does nothing, exactly same as before (nothing added to the finish page).<br />
<br />
I suppose that in pre function, the dialog is already created and I should only modify already existing dialog, right? Or is it necessary to create brand new dialog by nsDialogs::Create ? I'm completly new to nsDialogs...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">16th February 2011, 15:54</div></div><div class="posttext">use MUI_PAGE_CUSTOMFUNCTION_SHOW instead of MUI_PAGE_CUSTOMFUNCTION_PRE.<br />
http://forums.winamp.com/showthread.php?t=309799</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zbynour</div><div class="date">17th February 2011, 12:04</div></div><div class="posttext">Yes, MUI_PAGE_CUSTOMFUNCTION_SHOW instead of MUI_PAGE_CUSTOMFUNCTION_PRE was also necessary. <br />
Now, with following piece of code, it works fine:<br />
<br />
Var Chbx<br />
<br />
Function FinishPageShow<br />
	${NSD_CreateCheckbox} 120u 129u 180 20 &quot;my checkbox...&quot;<br />
	Pop $Chbx<br />
	SetCtlColors $Chbx &quot;&quot; 0xffffff<br />
	${NSD_Check} $Chbx<br />
FunctionEnd<br />
<br />
Function FinishPageLeave<br />
	Push $0<br />
	${NSD_GetState} $Chbx $0<br />
	${If} $0 == ${BST_CHECKED}<br />
		; do something<br />
	${EndIf}<br />
	Pop $0<br />
FunctionEnd<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_SHOW FinishPageShow<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE FinishPageLeave<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
Thanks a lot, guys!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>