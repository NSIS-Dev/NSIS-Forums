<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Installing a Font - Help!!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Installing a Font - Help!! NSIS Discussion" />
	
	<title> Installing a Font - Help!! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Installing a Font - Help!!</div>
<hr />
<div class="pda"><a href="t-334260.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=334260">Installing a Font - Help!!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">gdollard</div><div class="date">31st August 2011, 14:25</div></div><div class="posttext">Hi All,<br />
I'm really stuck on this one. I have a script that installs two fonts, (Andale Mono and arialUnicode) on XP using InstallTTF from FontRegAdv.nsh.<br />
<br />
The odd behavior I get is when adnalemo is not installed on the machine the installer throws up a dialog saying &quot;Invalid File Handle 32&quot; and the font is not installed.<br />
<br />
However if I remove the arialUnicode font and run the installer it does install that font no problem!<br />
I'm puzzled as to why it has a problem with the Andale Mono font! Odd.<br />
<br />
I'm new to all this as I'm sure you'll realise from my problem!!<br />
<br />
here's the code:<br />
<br />
    strCpy $FONT_DIR $FONTS<br />
    !insertmacro InstallTTF &quot;$INSTDIR\Fonts\andalemo.ttf&quot; $FONTS<br />
    <br />
    !insertmacro InstallTTF '$INSTDIR\Fonts\arialUnicode.ttf' $FONTS<br />
    SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
<br />
The font files are in the same folder so I don't understand what's going wrong!<br />
<br />
Any help would be greatly appreciated!<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gdollard</div><div class="date">31st August 2011, 16:13</div></div><div class="posttext">any help at all folks? I'm at a loss here :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gdollard</div><div class="date">1st September 2011, 13:44</div></div><div class="posttext">thankfully I've managed to sort this myself...I'd be a long time waiting for it here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st September 2011, 20:47</div></div><div class="posttext">You're welcome for nothing. :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ttrebla</div><div class="date">29th November 2012, 09:14</div></div><div class="posttext">Hi, I'm having exactly the same problem here.<br />
<br />
gdollard, do you remember how did you solve it?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gdollard</div><div class="date">29th November 2012, 10:58</div></div><div class="posttext">hi Ttrebla, it's been a long time since I've looked at this but I think the problem was confined to XP machines and if memory serves I had to check for the existence of the the font on the target machine and remove it before 'installing' it again in the nsis script.<br />
Not very scientific I know but it seemed to work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PoRtAbLe_StEaLtH</div><div class="date">6th December 2012, 04:08</div></div><div class="posttext">Hi All,<br />
I'm really stuck on this one. I have a script that installs two fonts, (Andale Mono and arialUnicode) on XP using InstallTTF from FontRegAdv.nsh.<br />
<br />
The odd behavior I get is when adnalemo is not installed on the machine the installer throws up a dialog saying &quot;Invalid File Handle 32&quot; and the font is not installed.<br />
<br />
However if I remove the arialUnicode font and run the installer it does install that font no problem!<br />
I'm puzzled as to why it has a problem with the Andale Mono font! Odd.<br />
<br />
I'm new to all this as I'm sure you'll realise from my problem!!<br />
<br />
here's the code:<br />
<br />
    strCpy $FONT_DIR $FONTS<br />
    !insertmacro InstallTTF &quot;$INSTDIR\Fonts\andalemo.ttf&quot; $FONTS<br />
    <br />
    !insertmacro InstallTTF '$INSTDIR\Fonts\arialUnicode.ttf' $FONTS<br />
    SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
<br />
The font files are in the same folder so I don't understand what's going wrong!<br />
<br />
Any help would be greatly appreciated!<br />
<br />
Thanks.<br />
<br />
<br />
<br />
here's what i use:<br />
StrCpy $FontFolder &quot;$INSTDIR\MyApp&quot;<br />
System::Call &quot;gdi32::AddFontResource(t'$FontFolder')i .r2&quot;<br />
SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=1<br />
<br />
works for me on all systems.. <br />
haven't had a problem yet..<br />
if you have more than 1 font..<br />
use &quot;Find&quot; (first,next,close).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th December 2012, 09:10</div></div><div class="posttext">Timeout=1 seems a little short IMHO...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sols_HeG</div><div class="date">11th December 2012, 15:01</div></div><div class="posttext">hey there,<br />
i used the fonts-plugin to install my constum fonts, because INSTALLTTF made too much problems and work for me.<br />
<br />
Set the Outputpath to the System-Fontfolder<br />
System::Call 'shell32::SHGetSpecialFolderPathA(i $HWNDPARENT, t .r1, i ${CSIDL_FONTS}, i 0) i r0'<br />
SetOutPath $1<br />
<br />
Add the ttf and the Name of the Font to the Registry:<br />
WriteRegStr HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts&quot; &quot;Play Regular&quot; &quot;Play-Regular.ttf&quot;<br />
<br />
Then just use the registerFont Function of the fonts-Plugin:<br />
fonts::registerFont &quot;Play-Regular.ttf&quot;<br />
<br />
Hope this helps<br />
<br />
Greeting from Munich<br />
HeG<br />
<br />
<br />
Edit: Corrected the Call of the shell32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th December 2012, 15:17</div></div><div class="posttext">Don't mix t type and A/W suffix. b is not a type, Windows uses int for BOOL:<br />
System::Call 'shell32::SHGetSpecialFolderPath(i $HWNDPARENT,t.r1,i ${CSIDL_FONTS},i 0) i.r0'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sols_HeG</div><div class="date">11th December 2012, 15:44</div></div><div class="posttext">OOOk...<br />
just saw my fault....<br />
<br />
anyway, I hope that the correct part of my script will work ;)<br />
I'll correct my previous post, just as I correct my script at work.<br />
<br />
Greetings from Munich<br />
HeG</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>