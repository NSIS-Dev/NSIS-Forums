<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" KillProc plug-in is not working in x64 bit machines, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  KillProc plug-in is not working in x64 bit machines NSIS Discussion" />
	
	<title> KillProc plug-in is not working in x64 bit machines [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  KillProc plug-in is not working in x64 bit machines</div>
<hr />
<div class="pda"><a href="t-318977.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318977">KillProc plug-in is not working in x64 bit machines</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dhiraj3301</div><div class="date">6th May 2010, 11:44</div></div><div class="posttext">KillProc plug-in is not working in x64 bit machines<br />
<br />
I have written following code:<br />
<br />
StrCpy $0 &quot;Draw.exe&quot;<br />
   KillProc::FindProcesses<br />
    ${If} $0 &gt; 0<br />
	StrCpy $0 &quot;Draw.exe&quot;<br />
  	 KillProc::KillProcesses<br />
   ${Endif}<br />
<br />
this code is working fine on 32 bit machine,<br />
anyone can please suggest what to do for for killing process in x64 bit machine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th May 2010, 13:40</div></div><div class="posttext">Is the process a 32-bit process or a 64-bit one? What is $1 set to after calling KillProcesses?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dhiraj3301</div><div class="date">6th May 2010, 14:21</div></div><div class="posttext">it is 64 bit process<br />
<br />
process name is same but it is not able to find that process using <br />
KillProc::FindProcesses</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th May 2010, 16:11</div></div><div class="posttext">What is the value of $1 after the KillProcesses call?<br />
Does the plug-in kill 32-bit processes OK?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dhiraj3301</div><div class="date">7th May 2010, 04:37</div></div><div class="posttext">the value of $1 after the KillProcesses call is 0<br />
this plug in kill 32-bit machines processes sucessfully.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th May 2010, 09:38</div></div><div class="posttext">This is a problem with the EnumProcessModules API and 32-bit processes. It cannot enumerate modules of a 64-bit process when the caller is a 32-bit process, therefore it fails to find your process name. If you must kill your application (i.e. you cannot safely close it with WM_CLOSE for example) then you will need to write a 64-bit executable to do it that you execute with NSIS. Don't bother trying any other plug-ins either because the EnumProcessModules limitation is not plug-in specific.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Javarome</div><div class="date">2nd November 2010, 14:29</div></div><div class="posttext">I confirm the need for a 64 bit process killing ability. Anything planned about that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">2nd November 2010, 19:44</div></div><div class="posttext">Have you tried to use WMI? You should be able to query the processes (by name) and when you have the one you want to kill, call the Terminate method on the WMI process object.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Javarome</div><div class="date">11th February 2011, 11:14</div></div><div class="posttext">Yes WMI seems to be the recommended approach to implement it, but I was more expecting a support from NSIS (or a NSIS plugin).<br />
<br />
That said, I also found the EnumProcessModulesEx is your friend for listing both 32 and 64 bits processes, but with static linking issues however (not located in the same library since Win7).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th February 2011, 15:12</div></div><div class="posttext">As I've already said, EnumProcessModulesEx is no good when the calling process is 32-bit. It will return the same results as EnumProcessModules (MSDN states this too). The only way is to use WMI (or write a 64-bit app to do it).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chironex</div><div class="date">21st July 2011, 20:26</div></div><div class="posttext">I had the same problem and updated the code to use WMI as was suggested.<br />
<br />
http://chironexsoftware.com/blog/?p=34</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">8th January 2012, 23:30</div></div><div class="posttext">the documentation of this plugin is really poor<br />
KillProcWMI , is an NSIS plugin based on the original KillProc plugin. KillProcWMI uses WMI to acheive the same results, which avoids problems with 32bit processes not being able to kill 64 bit processes.<br />
<br />
All Code is freely provided, no guarantees or warranties about its quality, use at your own risk.<br />
<br />
Jared Allen.<br />
ChironexSoftware.com<br />
i have tried all options to get it working - failed<br />
<br />
tried it with &quot;killproc&quot;, &quot;killprocwmi&quot; with same filename...<br />
http://nsis.sourceforge.net/KillProc_plug-in<br />
<br />
anyone with a working example? (and file places to put in except \plugins)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th January 2012, 00:24</div></div><div class="posttext">Did you use the DLL he provided? http://www.chironexsoftware.com/downloads/KillProcWMI.zip<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">9th January 2012, 16:23</div></div><div class="posttext">ofc - thats why i wonder it does not work.<br />
the major problem is that i can not compile the file!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th January 2012, 18:38</div></div><div class="posttext">What do you mean it does not work? What do you mean you cannot compile the file? Please elaborate.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">9th January 2012, 21:01</div></div><div class="posttext">compiling<br />
KillProc::FindProcesses<br />
<br />
not compiling<br />
KillProcWMI::FindProcesses<br />
<br />
&gt; Invalid command: KillProcWMI::FindProcesses<br />
<br />
if i rename KillProcWMI.dll to KillProc.dll<br />
and use the regular Killproc syntax<br />
<br />
&gt; Invalid command: KillProc::FindProcesses<br />
<br />
bleh<br />
<br />
so what is the correct syntax?<br />
<br />
both dll are in \plugins</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th January 2012, 21:03</div></div><div class="posttext">There is only one function KillProcWMI::KillProc (if in doubt look at the source code, or look at the output from makensis which lists all plug-in functions).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">9th January 2012, 21:59</div></div><div class="posttext">omg how stupid ist that?<br />
ofc i can force terminating a thread but more polite is the option for user to end it manually<br />
so i try to find the process at first but there is no plugin for x64 which can do that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">14th January 2012, 16:24</div></div><div class="posttext">sorry, wont work here<br />
<br />
    StrCpy $0 &quot;filename.exe&quot;<br />
    KillProcWMI::KillProc<br />
<br />
any new hints for 64bit?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rapport12</div><div class="date">16th February 2012, 04:17</div></div><div class="posttext">I was successful using:<br />
<br />
KillProcWMI::KillProc &quot;ProcessName.exe&quot;<br />
<br />
In that way I guess it works more like the older KillProc Plug-in rather than the new one.  However, I was able to terminate a 64-bit process on Windows Server 2008 R2 using it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">16th February 2012, 21:12</div></div><div class="posttext">i will try next days, actually i still need WMIC to determine task and to kill it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>