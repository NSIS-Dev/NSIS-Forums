<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" uninstall: how to check if the application is running, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  uninstall: how to check if the application is running NSIS Discussion" />
	
	<title> uninstall: how to check if the application is running [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  uninstall: how to check if the application is running</div>
<hr />
<div class="pda"><a href="t-128743.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=128743">uninstall: how to check if the application is running</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">spiff_c99</div><div class="date">17th March 2003, 09:45</div></div><div class="posttext">Hi!<br />
<br />
Does anyone know how I can check if the application is running (or kill the task) before I can start the installer/uninstaller?<br />
<br />
(the application is only in the system tray viewable)<br />
<br />
regards<br />
spiff_c99</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th March 2003, 13:35</div></div><div class="posttext">That depends on your application. Usually you'll use FindWindow with your window's class name and if you get a good handle (check with IsWindow) then you'll know the application is running. To close it you'll have to send the right message using SendMessage which is usually WM_CLOSE (!include WinMessages.nsh to get it defined).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">linuxfreak</div><div class="date">17th March 2003, 16:50</div></div><div class="posttext">hy<br />
<br />
I have almost the same problem, but i am realy a newbie in this matter:<br />
<br />
I have running a process and i do not want to let the installer continue until the process was ended by the user.<br />
<br />
I think FindWindow will not work, because the application has no Window.<br />
<br />
The installer therefore has to check if the task is running and if so the installer has to abort!<br />
<br />
Is this possible??<br />
<br />
I would very much appreciate it if you could make me a example and tell me exactly where i have to insert it in the NSI-File.<br />
<br />
Thank you very much for your help.<br />
regards<br />
linuxfreak</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th March 2003, 19:11</div></div><div class="posttext">Not all windows are visible. Most application do have at least one window for processing messages. If the user must end this process on its own then there must be a window that receives messages. A tray icon requires a window. The best way to know how to close the application is to ask the author of the program or just sniff the window class with a program that shows you all of the available windows, which I can't find now. Maybe I'll write one of my own later ;)<br />
<br />
Anyway, the best way is to just ask the author, or if open source look the window creation code and see what window class is used. If it is open source and you have no idea about what to look for give me a link and I'll have a look.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">linuxfreak</div><div class="date">18th March 2003, 07:09</div></div><div class="posttext">hy kichik<br />
<br />
I have the information:<br />
<br />
ClassName: ThunderRT6FormDC<br />
WindowText: Share Spy<br />
<br />
I could get this information with Win32Spy 0.2 (http://www.gena01.com/win32spy/). Maybe this can help other users to find out their ClassNames.<br />
<br />
Here's the code i think i need:<br />
FindWindow $0 &quot;ThunderRT6FormDC&quot;<br />
    IntCmp $0 0 done<br />
    IsWindow $0 0 done<br />
<br />
done:<br />
Abort &quot;Installation aborted!&quot;<br />
<br />
But still i don't know where to paste it in the nsi-File. Also i suppose i need to insert a second &quot;goto&quot; in case the application is not running...<br />
<br />
Please help me! Thank you<br />
<br />
PS: I coded this program in Visual Basic 6.0 and I don't know how to change its ClassName. Does anyone has an idea? :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th March 2003, 11:25</div></div><div class="posttext">Function .onInit<br />
  again:<br />
    FindWindow $0 &quot;ThunderRT6FormDC&quot; &quot;Share Spy&quot;<br />
    IsWindow $0 0 done<br />
      MessageBox MB_ABORTRETRYIGNORE|MB_ICONSTOP &quot;Close Share Spy...&quot; \<br />
      IDRETRY again IDIGNORE done<br />
        Abort<br />
<br />
  done:<br />
FunctionEnd<br />
<br />
This code will try to find the window when the installer starts (.onInit) and if it finds will ask the user if to abort, ignore or retry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">18th March 2003, 11:59</div></div><div class="posttext">I think ThunderRT6FormDC is a generic VB6 name. It will close other apps too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th March 2003, 12:05</div></div><div class="posttext">But this one searches for the title too. It will be better of course to get your own class name, but I have no idea how to do that in VB6 ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">linuxfreak</div><div class="date">18th March 2003, 12:46</div></div><div class="posttext">@kichik<br />
perfect!! Thank you very much. This is exactly what i was looking for!!<br />
<br />
@Joost Verburg<br />
Altough the solution from kichik is perfect and nothing more must be done, i don't like this generic classname. I searched the whole web for a solution, but couln't find anything. So if you have any idea, i'd be very thankful for any hint!<br />
<br />
THX<br />
linuxfreak</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">18th March 2003, 17:38</div></div><div class="posttext">You can use a named mutex. CreateMutexA will return ERROR_ALREADY_EXISTS (which equals to decimal 183) if a mutex with the same name already exists anywhere in the system. So create a mutex with a certainly unique name in your application, and when your uninstaller can not create mutex with the same name, you can be sure - your application is running.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spiff_c99</div><div class="date">18th March 2003, 17:45</div></div><div class="posttext">Thank you very much! <br />
I could resolve my own problem with these answers.<br />
:up:<br />
<br />
@linuxfreak<br />
You can't edit the classname in Visualbasic.<br />
Visualbasic set the classname &quot;ThunderRT6FormDC&quot; <br />
during the compilation process.<br />
<br />
regards<br />
spiff_c99</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th March 2003, 15:55</div></div><div class="posttext">...or just sniff the window class with a program that shows you all of the available windows, which I can't find now. Maybe I'll write one of my own later ;)<br />
<br />
Later has come :)<br />
<br />
This one only works on Windows NT 4, 2000 and XP because it uses special API calls that are only available on those OSes to get the process EXE name. Maybe I'll create one that works with 9x too later... Comes with source code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">20th March 2003, 20:11</div></div><div class="posttext">Originally posted by kichik <br />
<br />
...or just sniff the window class with a program that shows you all of the available windows, which I can't find now. Maybe I'll write one of my own later...<br />
<br />
<br />
Later has come... This one only works on Windows NT 4, 2000 and XP because it uses special API calls that are only available on those OSes to get the process EXE name. Maybe I'll create one that works with 9x too later...<br />
<br />
<br />
<br />
What about the Spy++ or WinSight32, which come respectively with Microsoft and Borland software development tools? Both work under NT and 9x Windows families.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th March 2003, 20:23</div></div><div class="posttext">Spy++ only comes with the commercial package afaik. I don't know about WinSight32, but if it's the replacement of Spy++ for Borland then I guess it's not free either. Spy++ doesn't do what my application does, and if WinSight32 is the same then that goes for it too. This tool is designed only for this job, it's small, fast, and doesn't crash every two minutes like Spy++ (could be it just doesn't like me though :p).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">20th March 2003, 20:50</div></div><div class="posttext">Spy++ doesn't do what my application does<br />
Not sure :p<br />
<br />
...and doesn't crash every two minutes like Spy++<br />
I do not remember when Spy++ was crashing last time... Maybe past year.<br />
<br />
You right about the commercial packages, but I think most of this forum members have one of these.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th March 2003, 20:52</div></div><div class="posttext">Spy++ doesn't list the windows on the system and categorizes them according to their process, module and class unless it has some secret switch I don't know of.<br />
<br />
You'll be surprised how many of NSIS users don't have a commercial package...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">20th March 2003, 21:05</div></div><div class="posttext">Spy++ doesn't list the windows on the system and categorizes them according to their process, module and class unless it has some secret switch I don't know of. <br />
<br />
From this point of view you probably right with the exception that Spy++ DOES list the windows on the system. At the same time it can do many other wonderful things :)<br />
<br />
Perhaps I should take a look on Spy++ supplied with Visual Studio .NET</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th March 2003, 21:11</div></div><div class="posttext">Well, that is what this tool has been created for ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">31st August 2003, 02:59</div></div><div class="posttext">I've found that using the &quot;ThunderRT6FormDC&quot; window handle also closed the VB IDE if I was still coding, making a minor change to &quot;ThunderRT6Main&quot;<br />
<br />
Change this:<br />
FindWindow $0 &quot;ThunderRT6FormDC&quot; # Closes All VB Windows <br />
to this, where &quot;MR Tech Systray&quot; is the app title used:<br />
FindWindow $0 &quot;ThunderRT6Main&quot; &quot;MR Tech Systray&quot;  # Only closes specific app instance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ripcurlx</div><div class="date">14th May 2007, 11:54</div></div><div class="posttext">Hi,<br />
<br />
I tried to use your code snippet to check a running application but got while compiling the script following error:<br />
<br />
Invalid command: IDRETRY <br />
<br />
complete function<br />
<br />
<br />
Function un.onInit<br />
 !insertmacro MUI_UNGETLANGUAGE<br />
 again:<br />
    FindWindow $0 &quot;ApplicationClass&quot; &quot;WindowName&quot;<br />
    IsWindow $0 0 done<br />
      MessageBox MB_ABORTRETRYIGNORE|MB_ICONSTOP &quot;Close Application...&quot;<br />
      IDRETRY again IDIGNORE done<br />
        Abort<br />
<br />
  done: <br />
FunctionEnd<br />
<br />
Do I have to include a special library for this?<br />
<br />
cheers,<br />
<br />
Christoph</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">14th May 2007, 12:34</div></div><div class="posttext">Hi,ripcurlx.<br />
<br />
Error is caused by line-breaking mistake. A inattantive error? :)<br />
<br />
<br />
MessageBox MB_ABORTRETRYIGNORE|MB_ICONSTOP &quot;Close Application.&quot; \<br />
IDRETRY again IDIGNORE done</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ripcurlx</div><div class="date">15th May 2007, 09:42</div></div><div class="posttext">thx - itÂ´s always the same ;-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cnepveu</div><div class="date">6th November 2007, 20:32</div></div><div class="posttext">Hi,<br />
<br />
Concerning the FindWindow function, I understand it takes a class name and/or dialog caption.<br />
<br />
When the application you're trying to find is available in many languages, it's just not possible to use the dialog caption, unless someone would iterate through possible strings and hope to get one translation correct.<br />
<br />
Then for the class name, .NET class names tend to be a bit descriptive; e.g.: WindowsForms10.Window.8.app.0.378734a<br />
Now, I don't mean to suggest that I understand the representation of the .NET class name, but something makes me believe they're tightly coupled to all sort of version and build numbers from inside .NET. Heck, maybe rebuilding the application changes the said class name.<br />
<br />
Given my pessimistic view of FindWindow as a reliable way of finding if a said application is running, does anyone have an alternative ... better solution?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">6th November 2007, 20:40</div></div><div class="posttext">IMHO, the cleanest way to exit a running application while uninstalling is to send a DDE message to that application that tells it to Quit<br />
(if you're the author of the application, you might need to implement a DDE server, which is not too hard if you're using MFC)<br />
To send the DDE message in the uninstaller, you can use my nsisDDE plugin (http://wiz0u.free.fr/prog/nsisDDE)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">6th November 2007, 20:44</div></div><div class="posttext">you can also use it in the installer during an upgrade, to exit the application<br />
<br />
if your application is limited to one instance, you can also use DDE messages to bring the currently running application to the foreground<br />
<br />
It works perfectly well with Microsoft applications (like WinWord) that implements a DDE server.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cnepveu</div><div class="date">6th November 2007, 21:00</div></div><div class="posttext">Thanks for the info Wizou,<br />
<br />
I had tought DDE mechanism deprecated, but it seems still supported.<br />
<br />
I think I'll just create a dummy window in my app through WIN32 APIs RegisterClass and CreateWindow and then try to find THAT window from the NSIS script using ... FindWindow.<br />
:)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>