<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Closing DOS boxes, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Closing DOS boxes NSIS Discussion" />
	
	<title> Closing DOS boxes [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Closing DOS boxes</div>
<hr />
<div class="pda"><a href="t-103815.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=103815">Closing DOS boxes</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">5th September 2002, 23:50</div></div><div class="posttext">I have created a DOS batch file that calls (and passes the parameter %0 - the batch file name) to a utility created by NSIS, this utility does not stay open after finishing what it is doing, but in some systems the DOS box stays open. I have been including a PIF file that basically just has the &quot;Close on Exit&quot; option selected. Is there any way my NSIS-created utility can close the DOS box since it already knows the name of the batch file? I want to have a total of two files instead of three.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">6th September 2002, 00:39</div></div><div class="posttext">since you know the name of the batch file you can do a findwindow for that name. It will return the hwnd. You can then use SendMessage to send the WM_CLOSE command. I'll put together an example</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">6th September 2002, 00:50</div></div><div class="posttext">Thanks dselkirk. By the way, the name of the batch file is not always the same (just in case you are working on an example).<br />
<br />
Also someone told me if I have an exe (ie myapp.exe %0) as the last line of the batch file, the batch file won't close until the exe has closed. Is this always true? I made a test batch file which calls an exe, I then added a message box in the exe and when the batch file was run, the message box popped up, after a couple of seconds the DOS box closed by itself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">6th September 2002, 01:11</div></div><div class="posttext">how much work is this batch file doing?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">6th September 2002, 01:38</div></div><div class="posttext">Here is what the batch file may look like:<br />
====================<br />
@echo off<br />
cls<br />
<br />
goto batchcode<br />
[inisettings]<br />
configfile=config4.ini<br />
configtype=1<br />
configname=testing.123<br />
<br />
:batchcode<br />
copy %1 test.123<br />
utility.exe %0<br />
<br />
:end<br />
====================<br />
<br />
A third-party program calls this batch file and passes it some data as a parameter (copy %1 test.123). Then utility.exe is called passing it the name of the batch filename (with the %0 parameter). Utility.exe (made with NSIS 1.98) then reads the batch file values in the inisettings section. Finally utility.exe detects our application directory and launches our application passing it as parameters the values it read from the inisettings section. <br />
<br />
I have been dropping a Pif file with the &quot;Close on exit&quot; flag enabled. I want to close the DOS box without using a Pif file.<br />
<br />
I hope my explanation makes sense. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">6th September 2002, 02:46</div></div><div class="posttext">do you need any return from the batch file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">6th September 2002, 03:02</div></div><div class="posttext">What do you mean?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">6th September 2002, 14:24</div></div><div class="posttext">do you need to wait for the dos box to close to complete the task?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">6th September 2002, 14:58</div></div><div class="posttext">was just checking CVS and found a new contrib. nsExec. Heres the description. <br />
<br />
nsExec will execute command-line based programs and capture the output<br />
without opening a dos box.<br />
<br />
This could solve your problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th September 2002, 15:03</div></div><div class="posttext">But it is the batch program that executes NSIS here ;)<br />
If you ask me, there is nothing you can do with a batch file and can't do with NSIS. I think you should just move it all into the NSIS utility.exe file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">6th September 2002, 15:12</div></div><div class="posttext">the other option is to use an executer program which sets the title of the window. Then he can us findwindow to close it.<br />
Here's one: http://www.naughter.com/shelexec.html<br />
<br />
The best solution would be to have it in the utility.exe. No need to close anything.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">6th September 2002, 16:01</div></div><div class="posttext">Here's a smaller one. 14.5kb.<br />
<br />
shellexec file.bat<br />
<br />
it will launch the batch file. the window title will be that same as what you passed as the batch file. Now you can use findwindow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">6th September 2002, 20:12</div></div><div class="posttext">I still need to give it a try. The reason I don't just have NSIS do everything is because some of the third-party software requires us to use a batch file. I want the exe to be the same across all products, that means whatever changes between the products must come from a batch or ini file. My goal is to just use 2 files instead of 3.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">veekee</div><div class="date">9th September 2002, 12:25</div></div><div class="posttext">a little dll could be interessant to develop that would allow us to launch a DOS app without making a DOS windows visible ! I mean, if we want to use DOS commands that do not show anything, that could be great ! <br />
does anyone knows how to do that ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th September 2002, 13:24</div></div><div class="posttext">nsExec::Exec &quot;cmd /C copy c:\*.* d:\&quot;<br />
nsExec::ExecToLog &quot;cmd /C dir c:\&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">10th September 2002, 04:48</div></div><div class="posttext">If I understand correctly, using shellexec.exe would mean having to use 3 files: The batch file, the NSIS exe and shellexec. The whole idea was being able to close the DOS box (if possible) from within the NSIS executable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lion King</div><div class="date">10th September 2002, 05:43</div></div><div class="posttext">trystart utility.exe %0in your batch file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">10th September 2002, 06:08</div></div><div class="posttext">Does this work in all Win32 Systems?<br />
start utility.exe %0<br />
I just found something that may do the trick, it only mentions Win 95 so some testing under other operating systems is needed:<br />
<br />
Microsoft Knowledge Base Article - Q122514 (http://support.microsoft.com/default.aspx?scid=kb;en-us;Q122514)<br />
 <br />
Here is the relevant part:<br />
If you are running a batch file, you can close the MS-DOS window by adding the following lines to the end of the batch file: <br />
echo off<br />
cls</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lion King</div><div class="date">10th September 2002, 06:48</div></div><div class="posttext">Originally posted by cchian <br />
Does this work in all Win32 Systems?afaik yes<br />
test.batnotepadtest2.batstart notepadin the first example the box closes after you close notepad, in the second example the box closes immediately<br />
<br />
the msdn example is for 16 bit dos commandline apps that write output to the screen, command.com in win9x doesn't close the box in this case - that's why the fix<br />
cmd.exe always closes the box for both 16 and 32 bit commandline apps (fix unneeded)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th September 2002, 07:05</div></div><div class="posttext">I suggest you use ShellExec instead of start, it is the same and ShellExec doesn't show a dos command box for everything.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">13th September 2002, 12:28</div></div><div class="posttext">kichik, does the ExecShell support SW_HIDE? If it does then that cab solve the problem right there. no third file required.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th September 2002, 12:39</div></div><div class="posttext">Sure, you can use SW_SHOWMINIMIZED with ExecShell. Same as Sw_HIDE.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">13th September 2002, 17:20</div></div><div class="posttext">But doesn't SW_SHOWMINIMIZED still display the window. From what i understand the issue is that a dos window has just hasn't self closed. If we hide the window using SW_HIDE it won't matter if it hasn't closed yet. The simplest solution to the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th September 2002, 17:22</div></div><div class="posttext">You can't hide the window completly with WS_*, nsExec is the best solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">13th September 2002, 21:23</div></div><div class="posttext">does nsExec support environment variables</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th September 2002, 21:43</div></div><div class="posttext">What do you mean by &quot;support environment variables&quot;? If you mean nsExec::Exec &quot;%HOME%\asd.exe&quot; ExpandEnvStrings should do the trick.<br />
Just to make it clear:<br />
To run a DOS program use nsExec.<br />
To run every other program that doesn't have any dos box opened for it just use Exec, ExecWait or ExecShell.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">14th September 2002, 00:11</div></div><div class="posttext">but, what about batch files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">14th September 2002, 01:53</div></div><div class="posttext">batch files are dos programs, where's the problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">14th September 2002, 02:39</div></div><div class="posttext">How about reading the batch file using FileRead and execing each line if you don't create the batch file yourself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">14th September 2002, 08:31</div></div><div class="posttext">unfortunately that will only work if there are no tests/branches/other batch file specific commands in the batch file... nice idea tho, wouldn't have thought of it myself</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>