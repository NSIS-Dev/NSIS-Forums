<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Win64 and WinCE, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Win64 and WinCE NSIS Discussion" />
	
	<title> Win64 and WinCE [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Win64 and WinCE</div>
<hr />
<div class="pda"><a href="t-237699.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=237699">Win64 and WinCE</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">10th February 2006, 15:28</div></div><div class="posttext">Hi all,<br />
<br />
1) Can one create with NSIS installers that run on Windows 64 bits?<br />
2) What about Windows CE?<br />
<br />
Thanks,<br />
Viv</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th February 2006, 18:48</div></div><div class="posttext">Windows x64 supports 32-bit executables, so any installer you create will run on Windows x64. Windows CE is a different story. There are pages in the Wiki explaining how to install files to a PDA. For example:<br />
<br />
http://nsis.sourceforge.net/NSIS_for_Smartphone</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">12th February 2006, 02:26</div></div><div class="posttext">For your first question, I will elaborate on what kichik said...<br />
First off, Windows XP x64 does support using 32-bit installers, however, is unable to use NSIS to install 64-bit programs because the NSIS program itself must be 64-bit in order to identify correctly with Windows XP x64.... That can definitely be a problem, since programs that are 32-bit are redirected to &quot;C:\Program Files (x86)&quot; and 64-bit ones are directed to &quot;C:\Program Files&quot;... This means that if the installer is not 64-bit, it will identify the program wrong and install it in the wrong location. At the moment, NSIS is safe with very few people actually using x64. We need to be ready for Vista, which will start the x64 boom. If there are developers with Windows XP x64 machines, they need to start compiling 64-bit versions of NSIS and packaging them for distribution, or at least experimenting with it...<br />
For your second question, all I can tell you is that you would have to be very careful, since the subset of Win32 can really hurt many different programs trying to port to WinCE or run toward WinCE.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mgillespie</div><div class="date">13th February 2006, 10:08</div></div><div class="posttext">I don't believe this to be true.  There are quite a few 32bit installers, that correctly install x64 applications.  The installer does itself not need to be 64bit.<br />
<br />
Infact, there are major DISADVANTAGES to making NSIS 64bit.<br />
<br />
If you make a 64bit NSIS install, it will only install on x64, wheras a 32bit NSIS can detect x64, and install the appropiate binaries, so you can have a single EXE that distributes x86 and x64 binaries.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pharaoh Atem</div><div class="date">15th February 2006, 01:00</div></div><div class="posttext">You could build a single wrapper binary that is 32-bit that detects whether you are using a 32-bit or 64-bit OS, then extract the appropriate one (32-bit installer or 64-bit installer) and run it... Then when it completes installation, the wrapper deletes the install file... I believe this is better, because you will not require code to override Windows XP x64's capability to detect 32-bit/64-bit installers and redirect to appropriate install points.... I am not quite sure, but if you compile the compiler and the NSIS system to x64, then it will produce 64-bit installers.... I am not sure though....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">14th November 2006, 16:40</div></div><div class="posttext">I have a 32-bit program but would like to test it in a 64-bit environment.  However, the installer won't let me get that far.  How can I install this in 64-bit.  I rather not go to InstallShield route.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th November 2006, 18:39</div></div><div class="posttext">Windows x64 should be able to run 32-bit installers without any problem. What's exactly your problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">14th November 2006, 18:48</div></div><div class="posttext">Before the installer starts I get an error message complaining about not meeting requirements.  I do not have the error verbatim I was given a summary by somebody that uses our software out of the office.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th November 2006, 19:37</div></div><div class="posttext">NSIS has no built-in check for any requirements. It's probably your code that does that check.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">14th November 2006, 19:54</div></div><div class="posttext">My code does check for operating systems but I only deny Windows 95, 98, and Me.  <br />
<br />
2000 and above are approved.  i read the string is the same as 2003 server and i have no problems installing on 32-bit Win2k3 server.<br />
<br />
i googled around and i read somebody else having the same exact error...though i cant find the article now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th November 2006, 23:52</div></div><div class="posttext">Your code might not have the proper check. Upload the code for a review. If you can't, my only suggestion is that you use WinVer.nsh instead of whatever you have their right now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">15th November 2006, 13:27</div></div><div class="posttext">You could update to NSIS v2.21 at least.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">15th November 2006, 13:30</div></div><div class="posttext">Oh, before I forget, I might be good for you to know I CAN install on Win64 via my NSIS Win32 installer script.<br />
<br />
So at least you know it CAN be done, now only you have to find your defect in your script.... mybe it is a little reassuring to you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">15th November 2006, 13:41</div></div><div class="posttext">i use:<br />
Function GetWindowsVersion<br />
<br />
  Push $R0<br />
  Push $R1<br />
<br />
  ClearErrors<br />
<br />
  ReadRegStr $R0 HKLM \<br />
  &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
<br />
  IfErrors 0 lbl_winnt<br />
<br />
  ; we are not NT<br />
  ReadRegStr $R0 HKLM \<br />
  &quot;SOFTWARE\Microsoft\Windows\CurrentVersion&quot; VersionNumber<br />
<br />
  StrCpy $R1 $R0 1<br />
  StrCmp $R1 '4' 0 lbl_error<br />
<br />
  StrCpy $R1 $R0 3<br />
<br />
  StrCmp $R1 '4.0' lbl_win32_95<br />
  StrCmp $R1 '4.9' lbl_win32_ME lbl_win32_98<br />
<br />
  lbl_win32_95:<br />
    StrCpy $R0 '95'<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows 95 is not supported by the &quot; IDOK<br />
    Quit<br />
  Goto lbl_done<br />
<br />
  lbl_win32_98:<br />
    StrCpy $R0 '98'<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows 98 is not supported by the &quot; IDOK<br />
    Quit<br />
  Goto lbl_done<br />
<br />
  lbl_win32_ME:<br />
    StrCpy $R0 'ME'<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows Millennium Edition &quot; IDOK<br />
    Quit<br />
  Goto lbl_done<br />
<br />
  lbl_winnt:<br />
<br />
  StrCpy $R1 $R0 1<br />
<br />
  StrCmp $R1 '3' lbl_winnt_x<br />
  StrCmp $R1 '4' lbl_winnt_x<br />
<br />
  StrCpy $R1 $R0 3<br />
<br />
  StrCmp $R1 '5.0' lbl_winnt_2000<br />
  StrCmp $R1 '5.1' lbl_winnt_XP<br />
  StrCmp $R1 '5.2' lbl_winnt_2003 lbl_error<br />
<br />
  lbl_winnt_x:<br />
    StrCpy $R0 &quot;NT $R0&quot; 6<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows NT is not supported by &quot; IDOK<br />
    Quit<br />
  Goto lbl_done<br />
<br />
  lbl_winnt_2000:<br />
    Strcpy $R0 '2000'<br />
  Goto lbl_done<br />
<br />
  lbl_winnt_XP:<br />
     ReadRegDWORD $R5 HKLM &quot;SYSTEM\ControlSet001\Control\ProductOptions&quot; ProductSuite<br />
     StrCmp $R5 'Personal' home_error lbl_done<br />
<br />
  lbl_winnt_2003:<br />
    Strcpy $R0 '2003'<br />
  Goto lbl_done<br />
<br />
  home_error:<br />
     MessageBox MB_OK|MB_ICONSTOP &quot;Windows XP Home Edition is not supported   (this doesnt seem to work at all)&quot; IDOK<br />
     Quit<br />
 Goto lbl_done<br />
 <br />
  lbl_error:<br />
    Strcpy $R0 ''<br />
<br />
  lbl_done:<br />
     Pop $R1<br />
     Exch $R0<br />
FunctionEnd<br />
<br />
<br />
thsi is called here:<br />
Function .onInit<br />
  Call GetWindowsVersion<br />
<br />
<br />
i have not received the error from the end-user that is having this problems.  thats why i wanted to see if it was the script, not sure.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">15th November 2006, 13:42</div></div><div class="posttext">when i say it doesnt work at all for home i mean home detection doesnt work....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ti_dic</div><div class="date">15th November 2006, 21:00</div></div><div class="posttext">If it can be useful to somebody i have compiled nsis with the x64 compiler of the PSDK for Windows Server 2003 R2.<br />
<br />
Here the link to the x64 installer:<br />
http://cedric.arnault.free.fr/nsis/nsis-x64-build-setup.exe<br />
<br />
The system plugin isn't fully operationnal, because of the new calling convention used in win64.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th November 2006, 20:47</div></div><div class="posttext">Afrow's version plug-in (http://nsis.sourceforge.net/GetVersion_(Windows)_plug-in) can tell you if you're using Home or not. Use it along with WinVer.nsh instead of the current test you have. It calls a defined API that is documented to return exactly that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">16th November 2006, 20:53</div></div><div class="posttext">how do i include winver.nsh.  i just downloaded the latest version of NSIS compiler.  i betcha that is why it wasnt working on the 64-bit systems.  i was using 2.16 i believe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">16th November 2006, 20:57</div></div><div class="posttext">it seems i can just do strcmp by using afrow's function right? <br />
<br />
or i use afrows function to detect if it is xp and if it is xp detect if it is pro/home, so i can deny/allow it to install.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th November 2006, 10:07</div></div><div class="posttext">To include WinVer.nsh, simply use !include. 2.16 should have been working with Windows x64, that's not the reason. It just didn't have WinVer.nsh which is a better way to detect the Windows version.!include WinVer.nsh<br />
# ...<br />
${If} ${IsWinXP}<br />
# use afrow's plug-in here<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">17th November 2006, 13:44</div></div><div class="posttext">And I imagine i can use the same idea for denying 95, 98, and Me?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th November 2006, 13:50</div></div><div class="posttext">Yes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">17th November 2006, 14:24</div></div><div class="posttext">I currently don't have access to all the OS's right now to test, but did i use this correctly?<br />
<br />
<br />
<br />
Function .onInit<br />
<br />
<br />
${If} ${IsWinXP}<br />
   # use afrow's plug-in here<br />
   GetVersion::WindowsType<br />
   Pop $R0<br />
   StrCmp $R0 &quot;Home&quot; xp_home_error go_away<br />
${EndIf}<br />
<br />
xp_home_error:<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows XP Home Edition is not supported&quot; IDOK<br />
    Quit<br />
    <br />
${If} ${IsWin95}<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows 95 is not supported&quot; IDOK<br />
    Quit<br />
${EndIf}<br />
<br />
${If} ${IsWin98}<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows 98 is not supported&quot; IDOK<br />
    Quit<br />
${EndIf}<br />
<br />
${If} ${IsWinMe}<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows Millennium Edition is not supported&quot; IDOK<br />
    Quit<br />
${EndIf}<br />
<br />
${If} ${IsWinNT4}<br />
    MessageBox MB_OK|MB_ICONSTOP &quot;Windows NT is not supported&quot; IDOK<br />
    Quit<br />
${EndIf}<br />
<br />
..... rest of install code....<br />
<br />
....then diff files copy....<br />
<br />
  ${If} ${IsWinXP}<br />
  Goto section_xp<br />
  ${EndIf}<br />
<br />
  ${If} ${IsWin2000}<br />
  Goto section_2000<br />
  ${EndIf}<br />
<br />
...then the rest of the code and wraps up</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th November 2006, 14:36</div></div><div class="posttext">Yes, it seems correct.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">17th November 2006, 14:41</div></div><div class="posttext">thanks very much kichik for all your help and patience.  :-)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>