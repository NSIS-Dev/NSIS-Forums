<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" IE doesn't load after install on Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  IE doesn't load after install on Vista NSIS Discussion" />
	
	<title> IE doesn't load after install on Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  IE doesn't load after install on Vista</div>
<hr />
<div class="pda"><a href="t-314836.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=314836">IE doesn't load after install on Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">amoneriot</div><div class="date">24th November 2009, 19:14</div></div><div class="posttext">Hello All,<br />
I'm a relative newbie to NSIS but I love it already and have dabbled in it enough to fix all the UAC and signing issues I was having. But now, this one issue is eating up my time and I can't get any direction on what to look out for. The following code snippet works fine on XP and Win7 but doesn't work on Vista. It's supposed to load IE with a website but it doesn't work on Vista only. I went through the forum and it doesn't look like it's been discussed before. I tried using exec instead of execshell as well. What could I be doing wrong here ? Is there anything I can try ? Really appreciate some pointers at this point.<br />
<br />
Function .onInstSuccess<br />
    Push $0<br />
    ReadRegStr $0 HKCR &quot;InternetExplorer.Application\CLSID&quot; &quot;&quot;<br />
    ReadRegStr $0 HKCR &quot;CLSID\$0\LocalServer32&quot; &quot;&quot;<br />
    ExecShell &quot;open&quot; &quot;$0&quot; &quot;http://www.google.com/&quot; SW_SHOWNORMAL<br />
	UAC::Unload<br />
    Pop $0<br />
FunctionEnd<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">24th November 2009, 19:26</div></div><div class="posttext">Why is there a call to the UAC plugin there? If you are using that, ExecShell is not the correct ting to use. Also, you probably don't want to use the open verb, try a empty string</div></div><hr />


<div class="post"><div class="posttop"><div class="username">amoneriot</div><div class="date">24th November 2009, 19:54</div></div><div class="posttext">The example tutorial on UAC talked about releasing the UAC plugin on successful installation, which is why there's a cleanup call there. <br />
This same code works fine for XP and win7. why wouldn't it work for Vista ? Anyways, I took your suggestion and tried calling ExecShell with an empty string and that didn't make a difference. Previously, I had tried using exec as well but that didn't work as well. If execshell isn't the correct thing to work and exec doesn't work, what else should I be trying ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">24th November 2009, 20:53</div></div><div class="posttext">well, for one thing, if you are using the uac plugin, you should call the uac version of execshell. But why would you want to force IE on your users, just specify the url as the command, no need to hunt for the .exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">amoneriot</div><div class="date">24th November 2009, 22:04</div></div><div class="posttext">I'm installing a toolbar for IE, which is why I need to have IE load up. I tried using UAC::exec as well as nsexec::exec but it didn't make any difference. Details in the new sample code below. I hope I got the arguments right. The worst part of all this is that the errorlevel isn't set, which tells me that the function should have worked. Could this be a real bug for which we need a bugfix ? I can't think of trying anything else. Does exec, execshell, etc. work with IE 7.0 on Vista ?<br />
<br />
Function .onInstSuccess<br />
    Push $0<br />
    ReadRegStr $0 HKCR &quot;InternetExplorer.Application\CLSID&quot; &quot;&quot;<br />
    ReadRegStr $0 HKCR &quot;CLSID\$0\LocalServer32&quot; &quot;&quot;<br />
    ;ExecShell &quot;open&quot; &quot;$0&quot; &quot;http://www.msn.com/&quot; SW_SHOWNORMAL<br />
	;UAC::Exec '' '&quot;$0 http://www.msn.com/&quot;' '' ''	<br />
	nsExec::Exec '&quot;$0&quot; http://www.msn.com/'	<br />
	UAC::Unload<br />
    Pop $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th November 2009, 01:02</div></div><div class="posttext">On my system (Vista Home Premium x64) the reg value for LocalServer32 has &quot;%ProgramFiles%\Internet Explorer\iexplore.exe&quot;. You probably need to ExpandEnvStrings (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.7) before the nsExec::Exec call.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">25th November 2009, 07:18</div></div><div class="posttext">well, if you want to force IE, you could use the supported COM interface for automating IE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">amoneriot</div><div class="date">25th November 2009, 18:39</div></div><div class="posttext">Thanks a lot for your suggestions. I made some progress finally. nsexec::exec seems to work, but with the side effect that when my installer doesn't quit until IE quits. Is there a way to fix that ? Also note the syntax with which nsexec worked. There are no double quotes around the variable.<br />
<br />
	ExpandEnvStrings $1 &quot;$0&quot;<br />
	nsExec::Exec '$1 http://www.oneriot.com/install_failed'	<br />
<br />
If I do the following, nsexec will not work. <br />
<br />
	ExpandEnvStrings $1 &quot;$0&quot;<br />
	nsExec::Exec '&quot;$1&quot; http://www.oneriot.com/install_failed'	<br />
<br />
why is that so ? that's what the examples say I should be doing, but that doesn't work. Also, why did nsexec work on Vista, but not exec or uac::exec or execshell which worked just as I wanted on XP and win7 ? I could use some learning here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">25th November 2009, 19:37</div></div><div class="posttext">The Exec command fails with the quotes because the reg value already has quotes around it and you end up with two sets of quotes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">amoneriot</div><div class="date">25th November 2009, 19:40</div></div><div class="posttext">Thanks a lot for your help. I think all this time my real issue was that I didn't understand well how variables were supposed to be used. Not that I understand them fully now, but I'm learning a lot. Sorry for getting you thinking about something completely different than where the problem was. Maybe my execshell will now work as I had planned.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">25th November 2009, 20:38</div></div><div class="posttext">I just created http://nsis.sourceforge.net/Open_URL_in_Internet_Explorer_using_COM_automation , you could try that for a non hacky solution</div></div><hr />


<div class="post"><div class="posttop"><div class="username">amoneriot</div><div class="date">8th December 2009, 20:21</div></div><div class="posttext">I tried this on Win7 IE8 and it didn't work. I cut-pasted the code there as it is and then tried to call it using uac::execcodesegment but didn't work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th December 2009, 15:09</div></div><div class="posttext">var ie = new ActiveXObject(&quot;InternetExplorer.Application&quot;);<br />
ie.Navigate(&quot;http://www.msn.com&quot;);<br />
ie.visible = true;<br />
<br />
put that in a .js file and execute it with wscript.exe (code taken from http://msdn.microsoft.com/en-us/library/bb250462%28VS.85%29.aspx) If that does not work, blame MS</div></div><hr />


<div class="post"><div class="posttop"><div class="username">podnuh</div><div class="date">10th December 2009, 14:39</div></div><div class="posttext">Presumably your installer is running with elevated privileges (because you are using the UAC plug-in). That means that when you start IE (using the methods you have been describing) it is also running with elevated privileges (because it inherits the privileges of the process that start it). This is something that you probably don't want to do, and which may be contributing to your problems with Vista. <br />
<br />
Since you are using the UAC plug-in, you should use the UAC::Exec function to start IE with the same privileges as the user who originally invoked your installer. In order to satisfy yourself that the UAC::Exec function works, as a start I would suggest calling UAC::Exec with exactly the same syntax described in the instructions and with the path for IE hard coded as follows (Notice the use of both single and double quotes in the command):<br />
<br />
  UAC::Exec '' '&quot; C:\Program Files\Internet Explorer\iexplore.exe &quot;' '' ''<br />
<br />
You are correct to dynamically look up the correct path for IE. But your first step should be to verify that the UAC:Exec function works (and it should). After that, you can add additional layers of complexity to find where the breakdown is occurring.<br />
<br />
I hope this helps.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>