<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problems with FileRead at end of the file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problems with FileRead at end of the file NSIS Discussion" />
	
	<title> Problems with FileRead at end of the file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problems with FileRead at end of the file</div>
<hr />
<div class="pda"><a href="t-118250.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=118250">Problems with FileRead at end of the file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rarefluid</div><div class="date">17th December 2002, 21:38</div></div><div class="posttext">Once again...<br />
I read a textfile with $\r$\n at the end of every line in a loop.<br />
When i get to the end, the last string isn't read. The string is empty &quot;&quot; because i got to the end of the file.<br />
So my idea was to get the position of the last read and then read from there to the end of the file to avoid the &quot;&quot; string, but it doesn't work. Heres the code maybe you have an idea...<br />
$9 is the filehandle<br />
<br />
<br />
   FileSeek $9 0 &quot;END&quot; $R8<br />
   FileSeek $9 0<br />
unDOloop:<br />
      FileSeek $9 0 &quot;CUR&quot; $R9     ;get file position<br />
      FileRead $9 $2              ;Read string from file<br />
      StrCmp $2 &quot;&quot; end            ;If end of file is reached, exit procedure<br />
      StrCpy $R0 $2 3             ;Get first letters and do function accordingly<br />
      StrCmp $R0 $R1 &quot;&quot; unDOloop  ;if not type of change stated in $R1, seek further<br />
      call un.restore_changes     ;if this is the right thing, restore values (string already in $2)<br />
      goto unDOloop               ;and loop till end of the file<br />
end:<br />
   ;MessageBox MB_OK|MB_TOPMOST|MB_ICONINFORMATION &quot;Last Fileposition : $R9$\r$\nLenght of file : $R8$\r$\nString is $2&quot; 0 0<br />
   FileSeek $9 $R9             ;we've read past the end of the file, so get back to start of string<br />
   IntOp $R8 $R8 - $R9         ;get length till EOF-1<br />
   Intop $R8 $R8 - 1<br />
   FileRead $9 $2 $R8          ;read last string in file<br />
   StrCmp $2 &quot;&quot; exit           ;If still end of file, exit procedure<br />
   StrCpy $R0 $2 3             ;Get first letters and do function accordingly<br />
   StrCmp $R0 $R1 &quot;&quot; exit      ;if not type of change stated in $R1, exit<br />
   call un.restore_changes     ;restore values (string already in $2)<br />
exit:<br />
 <br />
<br />
KIM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th December 2002, 22:09</div></div><div class="posttext">The string is empty &quot;&quot; because i got to the end of the file. <br />
What's wrong with that? What are you tring to do?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rarefluid</div><div class="date">17th December 2002, 22:12</div></div><div class="posttext">What does NSIS do when I try to read a string from the file and get to the end of the file?<br />
The documentation says it returns an empty string, not the string till EOF...<br />
Or am I wrong...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th December 2002, 22:17</div></div><div class="posttext">It actually says:<br />
If the end of file is read and no more data is available, the output string will be empty, and the error flag will be set.<br />
<br />
This means you won't get the error flag and an empty string if there is still some data left in the buffer. You can safely read until you get an empty string and the error flag knowing that you will get all the data in the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rarefluid</div><div class="date">17th December 2002, 22:23</div></div><div class="posttext">Ok, i understood it in a different way...<br />
Thanks.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>