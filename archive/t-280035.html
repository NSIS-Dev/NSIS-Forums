<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Getting localized name of &quot;NT AUTHORITY\System&quot;, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Getting localized name of &quot;NT AUTHORITY\System&quot; NSIS Discussion" />
	
	<title> Getting localized name of &quot;NT AUTHORITY\System&quot; [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Getting localized name of &quot;NT AUTHORITY\System&quot;</div>
<hr />
<div class="pda"><a href="t-280035.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=280035">Getting localized name of &quot;NT AUTHORITY\System&quot;</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">vulps</div><div class="date">26th October 2007, 13:46</div></div><div class="posttext">Hello<br />
<br />
We have customers with different locale settings.<br />
<br />
We need to use &quot;NT AUTHORITY\System&quot; user for a service  <br />
but it is localized for different locales.<br />
I searhed about it and found that its SID is<br />
<br />
S-1-5-18.<br />
<br />
and tried using its sid to get localized name, but couldnt succeed it.<br />
<br />
What I tried is (code by kichik)<br />
<br />
System::Call &quot;*(&amp;i1 0, &amp;i4 0, &amp;i1 5) i.r0&quot;<br />
# System::Call &quot;advapi32::AllocateAndInitializeSid(i r0, i 2, i 32 , i 544, i 0, i 0, i 0, i 0, i 0, i 0, *i .r1)&quot;<br />
  ; commented one works<br />
System::Call &quot;advapi32::AllocateAndInitializeSid(i r0, i 2, i 18   , i 0, i 0, i 0, i 0, i 0, i 0, i 0, *i .r1)&quot;<br />
System::Free $0<br />
System::Call advapi32::ConvertSidToStringSid(ir1,*t.R0)<br />
DetailPrint &quot;sid $R0&quot;<br />
StrCpy $R0 ${NSIS_MAX_STRLEN}<br />
System::Call &quot;advapi32::LookupAccountSid(i 0, i r1, t .r0, *i R0, t .r2, *i R0, *i .r3)&quot;<br />
System::Call &quot;advapi32::FreeSid(i r1)&quot;<br />
DetailPrint &quot; Result $0&quot;<br />
<br />
I tried it for different acounts, it works<br />
currently it doesnt work for special groups that mentioned below<br />
http://support.microsoft.com/kb/163846<br />
<br />
I think problem is having 3 numeric part, it works with 4 digit part sids like S-1-5-32-544 <br />
<br />
also I got usefull information from thread<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=243303<br />
<br />
thanks for help<br />
Selim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">26th October 2007, 14:03</div></div><div class="posttext">Whe you change the SID value from S-1-5-32-544 to S-1-5-18 you also have to change the second parameter of AllocateAndInitializeSid from 2 to 1: System::Call &quot;advapi32::AllocateAndInitializeSid(i r0, i 1, i 18 , i 0, i 0, i 0, i 0, i 0, i 0, i 0, *i .r1)&quot;<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vulps</div><div class="date">26th October 2007, 16:01</div></div><div class="posttext">Yess it works :)<br />
I appreciate your help. Thank you very much.<br />
<br />
But to my surprise,It just returns SYSTEM as the user name.<br />
<br />
But I need indeed first part.<br />
<br />
&quot;NT Authority\System&quot;  because that was the first part <br />
changes by locales (French, German etc.)<br />
<br />
You have any idea?<br />
I think I need to query &quot;System&quot; users group.<br />
<br />
Selim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vulps</div><div class="date">30th October 2007, 14:00</div></div><div class="posttext">I got the &quot;NT AUTHORITY&quot; part with same code.<br />
it is loaded into register 2<br />
just add to the end of code on first post.<br />
<br />
DetailPrint &quot; Result $2&quot;<br />
<br />
This gets localised name for &quot;nt authority&quot;<br />
<br />
Selim</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>