<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Create a script to install a hardware driver, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Create a script to install a hardware driver NSIS Discussion" />
	
	<title> Create a script to install a hardware driver [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Create a script to install a hardware driver</div>
<hr />
<div class="pda"><a href="t-212433.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212433">Create a script to install a hardware driver</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">juniorbr</div><div class="date">6th April 2005, 15:27</div></div><div class="posttext">HI<br />
As I can create a script to install a new hardware driver in the windows xp and windows 2000<br />
<br />
Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nusenucontesto</div><div class="date">6th May 2005, 12:11</div></div><div class="posttext">hi man,<br />
<br />
im using ExecWait &quot;rundll32.exe advpack.dll,LaunchINFSection my.inf,DefaultInstall&quot;<br />
<br />
to install a inf(driver) for a network connection,<br />
<br />
im also using ExecWait &quot;rundll32.exe SysDM.cpl,InstallDevice_RunDLL NetTrans&quot;<br />
<br />
to add a protocol, there are many other, for install a printer, for ex.<br />
<br />
<br />
i think u should look for &quot;rundll32 stuff&quot;.<br />
<br />
i have no idea on linux :P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">billym</div><div class="date">2nd December 2005, 00:07</div></div><div class="posttext">here is what I use for all driver installations. You may have to tweak it to account for installing driver applications but it generally works for 9x-2003. This also has a modified version of drvsetup.nsh.<br />
<br />
***drivertest.nsi***<br />
<br />
!include &quot;winver.nsh&quot;<br />
!include &quot;drvsetup.nsh&quot;<br />
<br />
Name &quot;drivertest&quot;<br />
OutFile &quot;drivertest.exe&quot;<br />
SilentInstall silent<br />
<br />
Function .onInit<br />
SetOutPath $INSTDIR\Drivers<br />
File /nonfatal /r &quot;.\Drivers\*.*&quot;<br />
!insertmacro InstallUpgradeDriver &quot;$INSTDIR\Drivers&quot; &quot;$INSTDIR\Drivers\DriverInf.inf&quot; &quot;Vendor&amp;DeviceIDInfofromDeviceListSectionofInf&quot;<br />
FunctionEnd<br />
<br />
Section<br />
Sectionend<br />
<br />
***drvsetup.nsh***<br />
<br />
!define sysUpdateDriverForPlugAndPlayDevices &quot;newdev::UpdateDriverForPlugAndPlayDevices(i, t, t, i, *i) i&quot;<br />
!define ERROR_NO_SUCH_DEVINST -536870389<br />
 <br />
!define sysSetupCopyOEMInf &quot;setupapi::SetupCopyOEMInf(t, t, i, i, i, i, *i, t) i&quot;<br />
!define SPOST_NONE 0<br />
!define SPOST_PATH 1<br />
!define SPOST_URL 2<br />
!define SP_COPY_DELETESOURCE 0x1<br />
!define SP_COPY_REPLACEONLY 0x2<br />
!define SP_COPY_NOOVERWRITE 0x8<br />
!define SP_COPY_OEMINF_CATALOG_ONLY 0x40000<br />
<br />
Function InstallUpgradeDriver<br />
 <br />
 Pop $R0 ; HID<br />
 Pop $R1 ; INFPATH<br />
 Pop $R2 ; INFDIR<br />
 <br />
 Call GetWindowsVersion<br />
 Pop $R3 ; Windows Version<br />
 ;DetailPrint 'Windows Version: $R3'<br />
 StrCmp $R3 '2000' lbl_upgrade<br />
 StrCmp $R3 'XP' lbl_upgrade<br />
 StrCmp $R3 '2003' lbl_upgrade<br />
 DetailPrint &quot;Windows $R3 doesn't support automatic driver updates.&quot;<br />
 <br />
 ; Upgrade the driver if the device is already plugged in<br />
 Goto lbl_noupgrade<br />
lbl_upgrade:<br />
 System::Get '${sysUpdateDriverForPlugAndPlayDevices}'<br />
 Pop $0<br />
 StrCmp $0 'error' lbl_noapi<br />
 DetailPrint &quot;Updating the driver...&quot;<br />
 ; 0, HID, INFPATH, 0, 0<br />
 Push $INSTDIR ; Otherwise this function will swallow it, dunno why<br />
 System::Call '${sysUpdateDriverForPlugAndPlayDevices}?e (0, R0, R1, 0, 0) .r0'<br />
 Pop $1 ; last error<br />
 Pop $INSTDIR<br />
 IntCmp $0 1 lbl_done<br />
 IntCmp $1 ${ERROR_NO_SUCH_DEVINST} lbl_notplugged<br />
 <br />
 DetailPrint &quot;Driver update has failed. ($R3:$0,$1)&quot;<br />
 Goto lbl_noupgrade<br />
lbl_notplugged:<br />
 DetailPrint &quot;The device is not plugged in, cannot update the driver.&quot;<br />
 Goto lbl_noupgrade<br />
lbl_noapi:<br />
 DetailPrint &quot;Your Windows $R3 doesn't support driver updates.&quot;<br />
 <br />
lbl_noupgrade:<br />
 ; Pre-install the driver<br />
 System::Get '${sysSetupCopyOEMInf}'<br />
 Pop $0<br />
 StrCmp $0 'error' lbl_inoapi<br />
 DetailPrint &quot;Installing the driver...&quot;<br />
 ; INFPATH, INFDIR, SPOST_PATH, &quot;&quot;, 0, 0, 0, 0<br />
 System::Call '${sysSetupCopyOEMInf}?e (R1, R2, ${SPOST_PATH}, 0, 0, 0, 0, 0) .r0'<br />
 Pop $1 ; last error<br />
 IntCmp $0 1 lbl_nodriver<br />
 DetailPrint 'Driver pre-installation has failed with error #$1 ($R3)'<br />
 Goto lbl_done<br />
lbl_inoapi:<br />
 DetailPrint &quot;Your Windows $R3 doesn't support driver pre-installation.&quot;<br />
lbl_nodriver:<br />
lbl_done:<br />
<br />
StrCmp $R3 '95' lbl_forcescan<br />
StrCmp $R3 '98' lbl_forcescan<br />
StrCmp $R3 'ME' lbl_forcescan<br />
StrCmp $R3 '2000' lbl_skipscan<br />
StrCmp $R3 'XP' lbl_skipscan<br />
StrCmp $R3 '2003' lbl_skipscan<br />
 	lbl_forcescan:<br />
	Delete &quot;$WINDIR\INF\drvdata.bin&quot;<br />
	Delete &quot;$WINDIR\INF\drvidx.bin&quot;<br />
	StrCpy $1 &quot;&quot;<br />
 	System::Get 'setupapi::CM_Locate_DevNodeA(*i .r0, t r1, i r2) i .r3'<br />
 	Pop $0<br />
 	StrCmp $0 'error' lbl_noapi1<br />
	System::Call 'setupapi::CM_Locate_DevNodeA(*i .r0, t r1, i r2) i .r3'<br />
	System::Call 'setupapi::CM_Reenumerate_DevNode(i r0, i r4) i .r5'<br />
	Goto lbl_done1<br />
	lbl_noapi1:<br />
	ClearErrors<br />
	ExecWait &quot;$WINDIR\rundll.exe setupx.dll,dibuilddriverindex&quot;<br />
	IfErrors 0 +2<br />
	ExecWait &quot;$WINDIR\rundll32.exe setupx.dll,dibuilddriverindex&quot;<br />
	lbl_done1:<br />
lbl_skipscan:<br />
	SetPluginUnload manual<br />
	System::Free 0<br />
FunctionEnd<br />
<br />
!macro InstallUpgradeDriver infdir infpath hwid<br />
	Push &quot;${infdir}&quot;<br />
	Push &quot;${infpath}&quot;<br />
	Push &quot;${hwid}&quot;<br />
	Call InstallUpgradeDriver<br />
	Sleep 1000<br />
!macroend</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>