<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" spaning disks, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  spaning disks NSIS Discussion" />
	
	<title> spaning disks [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  spaning disks</div>
<hr />
<div class="pda"><a href="t-157524.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=157524">spaning disks</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dougburton0721</div><div class="date">25th November 2003, 06:48</div></div><div class="posttext">I am having a hard time getting this to work right.<br />
<br />
Section &quot;Maximum Force CHD Image&quot;<br />
<br />
;Installation of MAXFORCE CHD<br />
<br />
MessageBox MB_OKCANCEL &quot;Insert M.A.M.E. 0.77 Disk 16 (Maxforce disk 1) and Press 'OK' to install.   WARNING!!!:  THE AUTOMATIC INSTALLATION OF THIS FILE TEMPORARILY MAY REQUIRE APPROXIMATELY 3 GB's OF FREE DISK SPACE.  THE FINAL SIZE WILL BE APPROXIMATELY 1.08 GB's AFTER AUTO-CLEANUP&quot; IDCANCEL FINISH2<br />
<br />
MessageBox MB_OKCANCEL &quot;If you do not have enough disk space to install Maximum Force using this installer, you can manually copy the files and extract them with a program such as Winrar.  Press OK to continue&quot; IDCANCEL FINISH2<br />
; Set output path to the installation directory.<br />
  SetOutPath $INSTDIR\TEMP<br />
  ; Put file there<br />
  CopyFiles &quot;$EXEDIR\MAXFORCE\*.*&quot; &quot;$INSTDIR\TEMP&quot;<br />
<br />
MessageBox MB_OKCANCEL &quot;Insert M.A.M.E. 0.77 Disk 17 (Maxforce disk 2, WarGods &amp; Killer Instinct 2) and Press 'OK' &quot; IDCANCEL FINISH2<br />
; Set output path to the installation directory.<br />
  SetOutPath $INSTDIR\TEMP<br />
  ; Put file there<br />
  CopyFiles &quot;$EXEDIR\COPYING.EMX&quot; &quot;$INSTDIR\TEMP&quot;<br />
  CopyFiles &quot;$EXEDIR\COPYING.RSX&quot; &quot;$INSTDIR\TEMP&quot;<br />
  CopyFiles &quot;$EXEDIR\EMX.DLL&quot; &quot;$INSTDIR\TEMP&quot;<br />
  CopyFiles &quot;$EXEDIR\EMX.EXE&quot; &quot;$INSTDIR\TEMP&quot;<br />
  CopyFiles &quot;$EXEDIR\RAR32.EXE&quot; &quot;$INSTDIR\TEMP&quot;<br />
  CopyFiles &quot;$EXEDIR\RARFILES.LST&quot; &quot;$INSTDIR\TEMP&quot;<br />
  CopyFiles &quot;$EXEDIR\RSX.EXE&quot; &quot;$INSTDIR\TEMP&quot;<br />
  CopyFiles &quot;$EXEDIR\MAXFORCE\*.*&quot; &quot;$INSTDIR\TEMP&quot;<br />
EXECWAIT &quot;$INSTDIR\TEMP\rar32.exe e *.rar&quot;<br />
SetOutPath $INSTDIR\ROMS\MAXFORCE<br />
SetFileAttributes &quot;$INSTDIR\ROMS\MAXFORCE&quot; NORMAL<br />
CopyFiles &quot;$INSTDIR\TEMP\MAXFORCE.CHD&quot; &quot;$INSTDIR\ROMS\MAXFORCE&quot;<br />
*****************errors out******************<br />
SetFileAttributes &quot;$INSTDIR\TEMP\*.*&quot; NORMAL<br />
SetFileAttributes &quot;$INSTDIR\TEMP&quot; NORMAL<br />
RMDir /r &quot;$INSTDIR\TEMP&quot;<br />
FINISH2:<br />
SectionEnd<br />
<br />
the setup.exe file is on disk 1, and being run from the cd.  After it copies the files over, I get an error message that the wrong volume disk is in the drive then it errors out.  Any ideas on how to correct.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th November 2003, 07:05</div></div><div class="posttext">Have you copied setup.exe to a local directory? Keeping a program from a CD-ROM running and getting the CD-ROM out usually brings trouble. You should first copy setup.exe to $TEMP and run it from there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougburton0721</div><div class="date">25th November 2003, 07:13</div></div><div class="posttext">I am really new when it comes to programming.  Do have the code to do this?  Also wouldn't that cause problems with the CopyFiles $exedir as now it would be pointing to where the setup file is now instead of the cd?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th November 2003, 07:26</div></div><div class="posttext">I don't know any full example that does that. But it's not that complicated, you'll live :)<br />
<br />
To get the EXE name you can parse $CMDLINE or simply use:<br />
<br />
System::Call &quot;Kernel32::GetModuleFileName(i 0, t .r0, i ${NSIS_MAX_STRLEN})&quot;<br />
<br />
This line will put the EXE's path in $0.<br />
<br />
After you have the path of the setup EXE, you simply copy it to $TEMP and execute it with a special command line parameter that will let it know that it is no longer on the CD. Something like /NOCD should do the trick.<br />
<br />
$EXEDIR would indeed be different, so you should send that too in the command line.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougburton0721</div><div class="date">25th November 2003, 07:37</div></div><div class="posttext">so to copy it over, and execute it you would have something like this:<br />
<br />
System::Call &quot;Kernel32::GetModuleFileName(i 0, t .r0, i ${NSIS_MAX_STRLEN})&quot; <br />
CopyFile &quot;$0\setup.exe&quot; &quot;$Instdr\temp1&quot;<br />
Exec &quot;$InstDr\temp1\setup.exe&quot; /NOCD</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th November 2003, 07:41</div></div><div class="posttext">GetModuleFileName returns the full path, including the executable name, which you can't trust to be setup.exe. I'd make sure $INSTDIR\temp1 exists first. Also, the Exec line is wrong and doesn't include $EXEDIR. You shold use:<br />
<br />
System::Call &quot;Kernel32::GetModuleFileName(i 0, t .r0, i ${NSIS_MAX_STRLEN})&quot;<br />
CreateDirectory $INSTDIR\temp1<br />
CopyFile &quot;$0&quot; &quot;$INSTDIR\temp1&quot;<br />
Exec '&quot;$InstDr\temp1\setup.exe&quot; /NOCD $EXEDIR'<br />
<br />
You should also parse the command line ($CMDLINE) for /NOCD and $EXEDIR. If it's there, no need to respawn the installer again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougburton0721</div><div class="date">25th November 2003, 08:10</div></div><div class="posttext">Forgive me for being stupid,  but how would I parse the $cmdline?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th November 2003, 08:13</div></div><div class="posttext">Search the Archive for $CMDLINE, it contains some examples.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">27th November 2003, 12:22</div></div><div class="posttext">I have written a script that does what you need:<br />
on the first launch the installer copies itself to<br />
the HD, launches the installer file from<br />
the HD and exits.<br />
<br />
Example script is attached.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougburton0721</div><div class="date">27th November 2003, 17:34</div></div><div class="posttext">Thanks Cosmic66<br />
<br />
Quick question,  does the code make $R2 be the cd-rom drive directory?  ie cd-rom is e:\ and so is $R2?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougburton0721</div><div class="date">28th November 2003, 06:12</div></div><div class="posttext">I've just about got it all figured out now.  The only problem I am having,  is when I add the new code in, which copies the setup over to the hard drive and runs it from there,  it skips my section on having it ask the person where to install the files,  along with what files they want to install.  It goes directly into copying all the files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cosmic66</div><div class="date">29th November 2003, 11:30</div></div><div class="posttext">I have downloaded your script and when I compile and run it,<br />
it shows component and directory page (I'm using MakeNSIS v2.0b4).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougburton0721</div><div class="date">30th November 2003, 03:42</div></div><div class="posttext">I was running MakeNSIS v2.0b3.  So I downloaded verion 2.0b4,  recompiled the script.  Tested it, and all is well.  Thanks for all your help,  especially your script cosmic66.  Works great.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>