<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" trouble with StrCmp and labels, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  trouble with StrCmp and labels NSIS Discussion" />
	
	<title> trouble with StrCmp and labels [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  trouble with StrCmp and labels</div>
<hr />
<div class="pda"><a href="t-252656.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252656">trouble with StrCmp and labels</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cjones</div><div class="date">4th August 2006, 20:03</div></div><div class="posttext">I'm trying to detect if Windows Media Encoder is installed and if not I want to kick it off. <br />
<br />
Here's the code I put together and the error I'm getting. I'm at a loss why it doesn't work, then again, I've only playing with this for a few hours. <br />
<br />
StrCmp &quot;$0&quot; &quot;1&quot; equal=installWME, nonequal=<br />
Invalid command: :installWME<br />
<br />
Section &quot;WME&quot;<br />
        Call IsWMEInstalled<br />
        Pop $0<br />
        StrCmp $0 1 installWME<br />
        <br />
        :installWME<br />
        ExecWait '&quot;$INSTDIR\WMEncoder.exe&quot;'<br />
        <br />
SectionEnd<br />
<br />
Function IsWMEInstalled<br />
   Push $0<br />
   Push $1<br />
   <br />
   ReadRegStr $1 HKLM SOFTWARE\Classes\CLSID\{632B606B-BBC6-11D2-A329-006097C4E476} &quot;&quot;<br />
   Push $1<br />
   Exch $1<br />
   Pop $1<br />
   IfFileExists $1 0 noWME<br />
   StrCpy $0 0<br />
   <br />
   noWME:<br />
   StrCpy $0 0<br />
   Goto done<br />
   <br />
   done:<br />
   Pop $1<br />
   Exch $0<br />
   <br />
 FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th August 2006, 20:07</div></div><div class="posttext">It's the other way around. It's `installWME:`, not `:installWME:`. Use the LogicLib (http://nsis.sourceforge.net/Docs/Chapter2.html#2.3.5.1) instead, it's much simpler.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cjones</div><div class="date">6th August 2006, 19:01</div></div><div class="posttext">Thanks, that fixed it. Here's the next problem. I'm using the standard .NET detection script that is in the help file. When I call it in the following section it runs both         found.NETFramework: and no.NETFramework. Any idea what I'm doing wrong? <br />
<br />
I'm also checking to see if Windows Media Encoder is installed and it doesn't matter if it's installed or not, it fires off the label to start the install. <br />
<br />
Section &quot;DotNet&quot;<br />
        Call IsDotNETInstalled<br />
        Pop $0<br />
        StrCmp $0 1 found.NETFramework no.NETFramework<br />
<br />
        found.NETFramework:<br />
        MessageBox MB_OK &quot;.NET is already installed&quot;<br />
        Pop $0<br />
<br />
        no.NETFramework:<br />
        MessageBox MB_OK &quot;Microsoft .NET 1.1 is required. Taking you there to download it.&quot;<br />
        ExecShell &quot;open&quot; &quot;http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=262D25E3-F589-4842-8157-034D1E7CF3A3&quot;<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2006, 19:03</div></div><div class="posttext">Follow the code through... What happens when you reach the label &quot;no.NETFramework&quot;... it shows the MessageBox, Pop's $0 (why?) and then what? Continues to run the code after the label &quot;no.NETFramework&quot;. You need to jump over the code with a Goto instruction.<br />
<br />
Or, like kichik has already said, use LogicLib. It really is much easier.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cjones</div><div class="date">7th August 2006, 21:22</div></div><div class="posttext">Gotcha, that fixed it. <br />
The thing that is really killing me is this Push, Pop thing. I'm use to setting variables and then pulling the values. <br />
<br />
Now I'm getting an error when I run the installer that says Installer corrupted, invalid opcode.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2006, 11:57</div></div><div class="posttext">That happens if you try and Pop or Shift when there's nothing on the stack. The code you've posted above will cause that error if there's only one stack item because you've got two Pop's. You don't even need the second one. Why is it there?<br />
Have you removed it?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th August 2006, 16:35</div></div><div class="posttext">Pop doesn't do that. Only a bad Exch or an invalid Reboot opcode trigger that message.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2006, 16:55</div></div><div class="posttext">Not sure why I said them. Getting confused with my array plugin :S<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>