<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" What field to check in my StartMenuLeave function?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  What field to check in my StartMenuLeave function? NSIS Discussion" />
	
	<title> What field to check in my StartMenuLeave function? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  What field to check in my StartMenuLeave function?</div>
<hr />
<div class="pda"><a href="t-140253.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140253">What field to check in my StartMenuLeave function?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Lilla</div><div class="date">27th June 2003, 01:49</div></div><div class="posttext">MUI 1.65, I updated via CVS this morning. Win98SE here.<br />
<br />
I am using the logic of the StartMenu.nsi and I build on that.<br />
My StartMenuLeave function is shown below.<br />
<br />
My problem is that I don't know where to find the folder name entered (or selected) by the user. MUI_STARTMENUPAGE_VARIABLE contains the previous value entered (or selected) by the user.<br />
<br />
This is my first Leave function, and I cannot find the answer. <br />
<br />
; validate the Start Menu folder entered (or selected) by the user<br />
Function StartMenuLeave<br />
  MessageBox MB_OK &quot;at1  MUI_STARTMENUPAGE_VARIABLE = ${MUI_STARTMENUPAGE_VARIABLE}&quot; ;debug<br />
  <br />
  StrCmp ${MUI_STARTMENUPAGE_VARIABLE} &quot;${MUI_PRODUCT}&quot; PathGood<br />
  StrCmp ${MUI_STARTMENUPAGE_VARIABLE} &quot;&quot; PathBad<br />
  <br />
  Push ${MUI_STARTMENUPAGE_VARIABLE}<br />
  Call GetFileName ; get last part of path<br />
  Pop $R0 ;$R0 is now &quot;last part of path&quot; <br />
  StrCmp $R0 &quot;${MUI_PRODUCT}&quot; PathGood<br />
  PathBad:<br />
  MessageBox MB_OK|MB_ICONSTOP &quot;Problem with folder name. The Start Menu folder (or sub-folder) must be ${MUI_PRODUCT}&quot;<br />
      Abort ; stay on page<br />
  PathGood:<br />
FunctionEnd<br />
<br />
Thank you,<br />
Lilla</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">27th June 2003, 03:18</div></div><div class="posttext">Exacly which part of the script is not working?  I compiled the script and it seemed to behave properly unless I/m missing something.<br />
<br />
Could you post your script to see if there is some problem with it.<br />
<br />
Vytautas<br />
<br />
NOTE: You can also use the $9 variable to access the selected forder.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lilla</div><div class="date">27th June 2003, 05:02</div></div><div class="posttext">Steps to reproduce the problem:<br />
<br />
1. Add my function to StartMenu.nsi, along with this line<br />
!define MUI_CUSTOMFUNCTION_STARTMENU_LEAVE StartMenuLeave<br />
<br />
2. Compile and Run.<br />
<br />
3. When the start menu page is displayed, change the default Start Menu Folder. For example, if 'Modern UI test' is displayed, change it to 'Modern UI test #2'. Then press the Next button.<br />
<br />
4. Observe now, the message displayed in StartMenuLeave function.<br />
The message says:<br />
  &quot;at1  MUI_STARTMENUPAGE_VARIABLE = Modern UI test&quot;, or<br />
  &quot;at1  MUI_STARTMENUPAGE_VARIABLE = &lt;empty&gt;&quot; if you are running it for the first time. Or, <br />
  &quot;at1  MUI_STARTMENUPAGE_VARIABLE = &lt;value from last run&gt;&quot;<br />
 <br />
Observe the problem: what is displayed IS NOT WHAT YOU JUST TYPED INTO THE FIELD!<br />
<br />
Conclusion: the function is not using the variable that contains the field the user entered.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">27th June 2003, 06:04</div></div><div class="posttext">OK, This is a newly introduced bug, e.g. this script works fine with the CSV(2003-06-24) but not with the CSV(2003-06-27).  Sorry I didn't check this before.  Its up to the DEV Team to fix this bug.<br />
<br />
Vytautas :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lilla</div><div class="date">27th June 2003, 06:31</div></div><div class="posttext">That sounds right. A few days ago I reported a problem with 'Abort' in Leave function. The 'Abort' problem was fix, and then this new problem showed up.<br />
<br />
Perhaps this information will help the developers know where to look.<br />
<br />
Thanks,<br />
Lilla</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">27th June 2003, 12:25</div></div><div class="posttext">The custom function now uses the real leave function, which is being called before the StartMenu plug-in quits (you should be able to abort). We'll have a look at it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">27th June 2003, 14:26</div></div><div class="posttext">Originally posted by Joost Verburg <br />
The custom function now uses the real leave function, which is being called before the StartMenu plug-in quits (you should be able to abort). We'll have a look at it.  Joost aborting is not the problem, its that the StartMenu plug-in has not set the MUI_STARTMENUPAGE_VARIABLE when the leave function is called.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th June 2003, 14:45</div></div><div class="posttext">MUI_STARTMENUPAGE_VARIABLE is set after StartMenu quits. The MUI leave function is now called from the real leave function and not after StartMenu quits, thus the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HarryPlotter</div><div class="date">29th November 2007, 14:04</div></div><div class="posttext">Is it possible, that this bug (described 06-27-2003 05:02 AM) appears again in version 2.33?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th November 2007, 17:11</div></div><div class="posttext">As I said, the variable is set only after the StartMenu plug-in quits. If you want to get the value in the leave callback function, you must manually retrieve it using GetDlgItem and ${WM_GETTEXT}.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HarryPlotter</div><div class="date">2nd December 2007, 22:41</div></div><div class="posttext">Wow, there had been some mantraps, but I've solved the problem.<br />
Thank you for your hint kichik.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>