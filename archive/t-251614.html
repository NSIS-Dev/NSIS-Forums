<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Variables and userinput (Arrays), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Variables and userinput (Arrays) NSIS Discussion" />
	
	<title> Variables and userinput (Arrays) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Variables and userinput (Arrays)</div>
<hr />
<div class="pda"><a href="t-251614.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=251614">Variables and userinput (Arrays)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">The Glimmerman</div><div class="date">21st July 2006, 10:56</div></div><div class="posttext">:igor:  noob warning :D <br />
<br />
Hi there.<br />
<br />
I'm a little bit confused here. :)<br />
I have a custompage with +/- 15 userinput boxes and checkboxes. After filling in the info and clicking next the info must be checked and executed. (username,computername, password etc etc) I now have a lot of <br />
<br />
ReadINIStr $var1<br />
ReadINIStr $var2<br />
ReadINIStr $var3<br />
 <br />
and a lot of functions when de variables are declared. I've read something about arrays (NSISArray.dll). But i try to understand (the logica)how it works. Is it even possible to get all the userinput (state) in on array and how to implement it with the variables and functions.<br />
I hope someone will and can explain me how it works<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">21st July 2006, 12:12</div></div><div class="posttext">Create an array (using the Array Plugin (http://nsis.sourceforge.net/Array_plug-in)) then read each value from your INI file to the NSIS stack and feed the value to the array, for example using a macro:!macro ReadINIValues ARRAY NUMBER_OF_VALUES<br />
  !define Index &quot;Line${__LINE__}&quot;<br />
  NSISArray::New /NOUNLOAD ${ARRAY} ${NUMBER_OF_VALUES} 2<br />
  StrCpy $0 1<br />
  StrCpy $9 ${NUMBER_OF_VALUES}<br />
  IntOp $9 $9 + 1<br />
<br />
 ${Index}_Start:<br />
  StrCmp $0 $9 ${Index}_End<br />
  ReadINIStr $1 &quot;&lt;your_ini_file&gt;&quot; &quot;&lt;your_section&gt;&quot; &quot;&lt;your_field_$0&gt;&quot;<br />
  NSISArray::Write /NOUNLOAD ${ARRAY} $0 &quot;$1&quot;<br />
  IntOp $0 $0 + 1<br />
  Goto ${Index}_Start<br />
<br />
 ${Index}_End:<br />
  NSISArray::FreeUnusedMem /NOUNLOAD<br />
  !undef Index<br />
!macroEnd<br />
Call the macro using for example!insertmacro ReadINIValues UserValues 10in order to feed values to the array.<br />
To read values from the array, use their index number. For exampleNSISArray::Read /NOUNLOAD UserValues 5<br />
Pop $0will read the 5th value from the array and place it in $0. You can then use the value in any of your other functions/sections.<br />
<br />
Don't forget to delete the array object when you're done:NSISArray:: Delete /NOUNLOAD UserValues<br />
<br />
Hope this helps<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">The Glimmerman</div><div class="date">21st July 2006, 14:38</div></div><div class="posttext">Thanx CF<br />
<br />
I hope you or someone else can help me with one thing.<br />
I got this<br />
<br />
<br />
ReadINIStr $1 &quot;test.ini&quot; &quot;State&quot; &quot;Field $0&quot;<br />
<br />
 <br />
and then this to test<br />
<br />
<br />
!insertmacro ReadINIValues UserValues 10<br />
<br />
NSISArray::Debug /NOUNLOAD UserValues<br />
<br />
NSISArray::Read /NOUNLOAD UserValues 1<br />
Pop $0<br />
MessageBox MB_OK &quot;$0&quot;<br />
NSISArray::Read /NOUNLOAD UserValues 2<br />
Pop $1<br />
MessageBox MB_OK &quot;$1&quot;<br />
<br />
<br />
The last code is in a function (leave)<br />
But there is nothing in the array.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">21st July 2006, 14:45</div></div><div class="posttext">Your ReadINIStr syntax is wrong. Should beReadINIStr $1 &quot;test.ini&quot; &quot;Field $0&quot; &quot;State&quot;<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">The Glimmerman</div><div class="date">21st July 2006, 16:26</div></div><div class="posttext">:o <br />
Last time I hope.<br />
<br />
What am I doing wrong<br />
<br />
<br />
!include &quot;LogicLib.nsh&quot;<br />
!include &quot;MUI.nsh&quot;<br />
<br />
OutFile &quot;Test.exe&quot;<br />
<br />
  Var FieldName<br />
<br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  !insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
!macro ReadINIValues ARRAY NUMBER_OF_VALUES<br />
  !define Index &quot;Line${__LINE__}&quot;<br />
  NSISArray::New /NOUNLOAD ${ARRAY} ${NUMBER_OF_VALUES} 2<br />
  StrCpy $0 1<br />
  StrCpy $9 ${NUMBER_OF_VALUES}<br />
  IntOp $9 $9 + 1<br />
<br />
 ${Index}_Start:<br />
  StrCmp $0 $9 ${Index}_End<br />
  ReadINIStr $1 &quot;$PLUGINSDIR\test.ini&quot; &quot;Field $0&quot; &quot;State&quot;<br />
  NSISArray::Write /NOUNLOAD ${ARRAY} $0 &quot;$1&quot;<br />
;  MessageBox MB_OK &quot;$1&quot;<br />
  IntOp $0 $0 + 1<br />
  Goto ${Index}_Start<br />
<br />
  ${Index}_End:<br />
  NSISArray::FreeUnusedMem /NOUNLOAD<br />
  !undef Index<br />
!macroEnd<br />
<br />
  Page custom GetSettings SetSettings<br />
<br />
  Function .onInit<br />
InitPluginsDir<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;test.ini&quot;<br />
FunctionEnd<br />
<br />
Section &quot;-hidden section&quot;<br />
SectionEnd<br />
<br />
Function GetSettings<br />
InstallOptionsEx::initDialog /NOUNLOAD &quot;$PLUGINSDIR\test.ini&quot;<br />
InstallOptionsEx::Show<br />
FunctionEnd<br />
<br />
Function SetSettings<br />
!insertmacro ReadINIValues UserValues 5<br />
NSISArray::Read /NOUNLOAD UserValues 3<br />
Pop $0<br />
Strcpy $FieldName $0<br />
MessageBox MB_OK &quot;$FieldName or $0&quot;<br />
FunctionEnd<br />
<br />
<br />
I attached the files</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">21st July 2006, 18:30</div></div><div class="posttext">Actually, my bad: We feed data to the array starting at Index 1 but we should start at Index 0. This should work:!include &quot;LogicLib.nsh&quot;<br />
!include &quot;MUI.nsh&quot;<br />
<br />
OutFile &quot;Test.exe&quot;<br />
<br />
  Var FieldName<br />
<br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
  !insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
!macro ReadINIValues ARRAY NUMBER_OF_VALUES<br />
!define Index &quot;Line${__LINE__}&quot;<br />
NSISArray::New /NOUNLOAD &quot;${ARRAY}&quot; ${NUMBER_OF_VALUES} 2<br />
StrCpy $0 1<br />
StrCpy $2 0<br />
StrCpy $9 ${NUMBER_OF_VALUES}<br />
IntOp $9 $9 + 1<br />
<br />
${Index}_Start:<br />
StrCmp $0 $9 ${Index}_End<br />
ReadINIStr $1 &quot;$PLUGINSDIR\test.ini&quot; &quot;Field $0&quot; &quot;State&quot;<br />
NSISArray::Write /NOUNLOAD ${ARRAY} $2 &quot;$1&quot;<br />
IntOp $0 $0 + 1<br />
IntOp $2 $2 + 1<br />
Goto ${Index}_Start<br />
<br />
${Index}_End:<br />
NSISArray::FreeUnusedMem /NOUNLOAD<br />
!undef Index<br />
!macroend<br />
<br />
  Page custom GetSettings SetSettings<br />
<br />
Function .onInit<br />
InitPluginsDir<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;test.ini&quot;<br />
FunctionEnd<br />
<br />
Section &quot;-hidden section&quot;<br />
SectionEnd<br />
<br />
Function GetSettings<br />
InstallOptionsEx::initDialog /NOUNLOAD &quot;$PLUGINSDIR\test.ini&quot;<br />
InstallOptionsEx::Show<br />
FunctionEnd<br />
<br />
Function SetSettings<br />
!insertmacro ReadINIValues &quot;UserValues&quot; &quot;5&quot;<br />
NSISArray::Read /NOUNLOAD UserValues 3<br />
Pop $0<br />
Strcpy $FieldName $0<br />
MessageBox MB_OK &quot;$FieldName or $0&quot;<br />
FunctionEnd<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">The Glimmerman</div><div class="date">21st July 2006, 19:31</div></div><div class="posttext">:up: <br />
<br />
It worked. Thx CF.<br />
<br />
I'm gonna implement this in my script.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>