<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Can't open file for writing -- Error began when I switched to MUI, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Can't open file for writing -- Error began when I switched to MUI NSIS Discussion" />
	
	<title> Can't open file for writing -- Error began when I switched to MUI [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Can't open file for writing -- Error began when I switched to MUI</div>
<hr />
<div class="pda"><a href="t-255526.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255526">Can't open file for writing -- Error began when I switched to MUI</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">15th September 2006, 07:04</div></div><div class="posttext">I had my installer working fine, and then I switched to MUI. Now I get a mysterious write error for a reason I can't figure out.<br />
<br />
I set the installation directory as<br />
<br />
InstallDir $PROGRAMFILES\jRAM <br />
<br />
Then I execute the following in my main installer Section:<br />
<br />
SetOutPath $INSTDIR<br />
SetOverwrite on<br />
File &quot;..\..\JRAM Build\setup\readme.txt&quot;<br />
<br />
When the installer comes to this point, it reports &quot;Error openeing file for writing: c\Program Files\jRam&quot;<br />
<br />
This is indeed where I want to extract the file to, and the directory exists and I have write privileges for it. The file exists in the source location indicated also, and it can be read.<br />
<br />
This worked fine before I put the MUI code in, and I can't see anything I changed that can be causing me to not be able to write files to the installation directory, especially since it's clear that the installer knows the correct path to the installation directory.<br />
<br />
I've attached the entire script for context.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">15th September 2006, 07:07</div></div><div class="posttext">Attachment didn't post for some reason. Here it is.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th September 2006, 12:17</div></div><div class="posttext">The second parameter to MUI_PAGE_STARTMENU should be $StartMenuGroup, not $INSTDIR. The way you have it now, it writes the selected start menu folder name into $INSTDIR, which is, of course, an invalid directory path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">16th September 2006, 06:49</div></div><div class="posttext">Thanks, kichik. That was the problem. I see now how I misunderstood the documentation.<br />
<br />
However, I'm still having trouble with the switch to MUI. I'm having problems creating shortcut icons, and I seem to have traced it to a faulty value being set for $StartMenuGroup by the MUI Start Menu macro.<br />
<br />
I use the following to set the variable for the Start Menu Group selected during the install dialog<br />
<br />
insertmacro MUI_PAGE_STARTMENU install_page_1 $StartMenuGroup<br />
<br />
This variable should be set to the filepath selected by the user. Using DetailPrint, I find that it is actually set to<br />
<br />
c\Documents and Settings\Mark\Start Menu\Programs\jRAM<br />
<br />
Note that the &quot;:&quot; is missing after the &quot;C&quot;<br />
<br />
The result is then that the installer gives error message &quot;Failed to create shortcut&quot; for each Start Menu shortcut. I also get in my Start Menu Programs folder the following  folder with subfolders:<br />
<br />
 c\Documents and Settings\Mark\Start Menu\Programs\jRAM<br />
<br />
This is apparently caused by the<br />
<br />
CreateDirectory $StartMenuGroup<br />
<br />
command, but why the folder gets created in the Start Menu is beyond me. But apparently the failure to create the shortcuts is caused by the missing &quot;:&quot;.<br />
<br />
I can certainly write a function to insert the &quot;:&quot;, but I'm wondering if I'm missing something. I didn't find a bug report about this, and it seems doubtful I'm the first one to find it.<br />
<br />
I attached my script file once again, as I made some changes from the last post, to account for the fact that $StartMenuGroup contains the entire path when using MUI, while with the function I was using previously (still in the script, but not called) it only contained the last segment of the path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">16th September 2006, 09:02</div></div><div class="posttext">I was able to make it work by massaging the value returned by the MUI Start Menu macro. See attached file.<br />
<br />
I would like some input on whether or not I should enter a bug against the MUI Start Menu macro.<br />
<br />
I'm also a bit concerned about something that happened in the process. Not sure why, but one of the times I ran the uninstaller in an earler version of the script, I saw a rather disturbing log entry:<br />
<br />
Delete on Reboot: c:\Documents and Settings\Mark\Start Menu\Programs<br />
<br />
I'm afraid to reboot my system now, lest I lose all my start menu icons. I looked around in the registry and couldn't see a key that indicates this action will be taken on reboot. But I'm not sure where to look. Can someone please tell me where in the registry I should check to make sure this delete doesn't happen on reboot?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th September 2006, 09:30</div></div><div class="posttext">The problem is with MUI_STARTMENUPAGE_DEFAULTFOLDER. You've set it to the complete path instead of just the folder name. It shouldn't contain $SMPROGRAMS.<br />
<br />
To find out which files are to be deleted on reboot, use PendMoves (http://www.sysinternals.com/Utilities/PendMoves.html).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">16th September 2006, 16:56</div></div><div class="posttext">Thanks again kichik. SIlly overisght on my part. Thankls also for the recco on Penmoves. However, I'm a bit stumped there as well. PenMoves doesn't seem to have a capability to remove files from pending backup, it just reports them. I looked in the registry in the place that PendMoves says the pending moves and delets are, and I don't have that key. PendMoves, however, does show several items that are pending delete. I searched for some of these in the registry, and I only find them in<br />
<br />
HKEY_USERS\S-1-5-21-1604011929-4138158259-2085843710-1009\Software\Microsoft\Windows\ShellNoRoam\MUICache<br />
<br />
I have value names under this key that match the names of files that PendMoves says are to be deleted on reboot.<br />
<br />
Should I delete these values? Delete the entire MUICache key to be safe?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th September 2006, 17:11</div></div><div class="posttext">The MUICache is not related. PendMoves simply reads the PendingFileRenameOperations key. So if it gives you output, the key is there.<br />
<br />
But you don't have to worry so much about it. The files listed there do need to be deleted. If some bug somewhere caused the start menu folder to get in that list (though I'm not so sure it can even delete non-empty directories), simply backup that folder and reboot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">16th September 2006, 17:26</div></div><div class="posttext">Found the key and removed it. I was looking in the subkeys in the left pane and overlooking the keys in the right pane next to the values. Using Find is better than browsing. After deleting the key, PendMoves reports no pending file moves.<br />
<br />
Thanks again for all your help.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>