<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstaller crash, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstaller crash NSIS Discussion" />
	
	<title> Uninstaller crash [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstaller crash</div>
<hr />
<div class="pda"><a href="t-275306.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275306">Uninstaller crash</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MrTact</div><div class="date">2nd August 2007, 23:50</div></div><div class="posttext">Hi, I am having a really weird error, and I'm stuck trying to figure out why. Any uninstaller that gets generated by my script crashes after executing the first command. What I'm looking for are suggestions how to go about debugging this. For instance, is there a way to get hold of the map data for au_.exe so I can use the postmortem debugger? Anyone have any other suggestions?<br />
<br />
Thanks for any thoughts on this subject.<br />
<br />
TimK.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">3rd August 2007, 04:59</div></div><div class="posttext">Post a sample of your script if you don't mind.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">3rd August 2007, 16:16</div></div><div class="posttext">Make sure you don't run the uninstaller from the root of any drive as this is not valid installation location (and the uninstaller is normally created in the installation location).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MrTact</div><div class="date">20th August 2007, 21:39</div></div><div class="posttext">OK, I have figured out _what_ is causing this problem, but not _why_ it is causing it.<br />
<br />
I am using a custom build of makensis.exe, to which I have added support for an additional callback called &quot;.onProgress&quot; (patch file is attached). The changes don't seem all that significant, but I'm clearly shifting a pointer somewhere, because installers compiled with this change integrated into a recent CVS sync have all kinds of weird errors -- the wrong default string populating the &quot;where to install&quot; textbox, for instance.<br />
<br />
What I don't get is *why* this is disrupting memory this way. It seems like this change would be pretty harmless, since the callback func pointers are stored into a TinyGrowBuf rather than any kind of fixed size memory structure. I figure I'm missing either an initialization of some kind, or there's code somewhere that relies on the buffers holding the callback pointers to be a fixed size that is not traversing far enough. Be darned if I can find anything like either of those, though.<br />
<br />
If anyone who is familiar with the inner workings of makensis can point out what I'm doing wrong, I'd be extremely grateful.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th August 2007, 21:47</div></div><div class="posttext">Sounds like you recompiled only makensis.exe and not the stubs. Rebuild everything once you apply the patch.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MrTact</div><div class="date">21st August 2007, 21:24</div></div><div class="posttext">Thanks for the quick reply -- that was definitely *a* problem. I did a clean and a full rebuild and that fixed the problems with the installer. Unfortunately, the uninstaller crash resurfaced as a result.<br />
<br />
Back to the drawing board . . .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st August 2007, 21:33</div></div><div class="posttext">Debugging the stubs is a bit problematic because makensis.exe actually edits them prior to appending the data and so PDB files are invalid (though windbg probably has some method to force-load PDBs). But map files are present in the build folder and are still valid as only sections below the code are edited.<br />
<br />
But simply debugging the crash showed the problem, which was also my first guess once I looked a bit more into the code. progress_bar_step is zero. The first thing the debugger says is &quot;Integer divide-by-zero&quot;. If progress_bar_len is smaller than 8, progress_bar_step will be zero.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MrTact</div><div class="date">22nd August 2007, 06:14</div></div><div class="posttext">Brilliant! And also, obvious. I should have looked at the divide ops in the patch &amp; protected against potential div by zero.<br />
<br />
Thanks so much for your help!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>