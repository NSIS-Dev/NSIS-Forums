<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with NSIS RunAs plug-in requesting administrator permission, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with NSIS RunAs plug-in requesting administrator permission NSIS Discussion" />
	
	<title> Problem with NSIS RunAs plug-in requesting administrator permission [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with NSIS RunAs plug-in requesting administrator permission</div>
<hr />
<div class="pda"><a href="t-340253.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=340253">Problem with NSIS RunAs plug-in requesting administrator permission</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">amitgatech</div><div class="date">5th January 2012, 14:59</div></div><div class="posttext">0<br />
down vote<br />
favorite<br />
1<br />
share [fb]<br />
share [tw]<br />
I am quite new with NSIS. I am trying to request administrator permissions in order to run the installer, as it messes around a bit with registries. My problem with &quot;RequestExecutionLevel&quot; and &quot;MULTIUSER_EXECUTIONLEVEL&quot; is that they both absolutely block any non-Admin user from opening the installer, even when selecting &quot;Run as Administrator&quot; in the context menu. I have tried using the RunAs DLL, but I have not found a single thread as to what to put in the $command variable passed to &quot;RunAsW&quot; function.<br />
<br />
Here is my (pretty hacked-up) code:<br />
<br />
     StrCpy $0 0<br />
     StrCpy $1 &quot;&quot;<br />
     System::Call 'RunAs::GetAdministrators(w r1, *i .r0) i .r2 ? u'<br />
     System::Alloc 64<br />
     Pop $4<br />
     StrCpy $4 $2<br />
     StrCpy $5 &quot;&quot;<br />
     loop:<br />
          IntCmp $0 0 endloop<br />
          System::Call '*$4(w .r3)'<br />
          StrCpy $5 &quot;$5|$3&quot;<br />
    endloop:<br />
    System::Free $4   ; we free the memory used by the array<br />
    StrCpy $5 &quot;$5&quot; &quot;&quot; 1<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;Settings.ini&quot; &quot;Field 1&quot; &quot;ListItems&quot; $5<br />
     !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;Settings.ini&quot;<br />
     !insertmacro MUI_INSTALLOPTIONS_READ $1 &quot;UserPass&quot; &quot;Field 1&quot; &quot;State&quot;<br />
     !insertmacro MUI_INSTALLOPTIONS_READ $2 &quot;Settings.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
     StrCpy $3 &quot;%%LOGONSERVER%%&quot;<br />
     StrCpy $3 0<br />
     StrCpy $4 0<br />
     System::Call 'RunAs::RunAsW(w r1, w r2, w r3, *w .r4) i .r0 ? u'<br />
     MessageBox MB_OK $0<br />
     IntCmp $0 1 success<br />
     Quit<br />
     success:<br />
     !insertmacro MUI_LANGDLL_DISPLAY<br />
A lot of it is just guess work and trial and error. (btw - I also tried running through a loop to get all Administrators, but it seems the DLL was intended only for 32-bit machines, so...).<br />
<br />
Anyway, my question is:<br />
<br />
Does anybody know of a way (using &quot;RunAs&quot; or otherwise) to open a dialog requesting Username and password, check the credentials and continue with the installation only if they check out?<br />
<br />
Also, I know there is a way to set up an installer so that it comes with that nice shield icon on it that lets users know that Admin permission will be requested. Does anybody know how to do that?<br />
<br />
Any help would be very much appreciated, as this is the only thing currently preventing the deployment of my app.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th January 2012, 19:16</div></div><div class="posttext">Did you just C&amp;P the question from Stackoverflow? Did you look at the answer I posted there?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>