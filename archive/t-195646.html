<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Devilishly cunning new problem re nsExec::Exec, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Devilishly cunning new problem re nsExec::Exec NSIS Discussion" />
	
	<title> Devilishly cunning new problem re nsExec::Exec [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Devilishly cunning new problem re nsExec::Exec</div>
<hr />
<div class="pda"><a href="t-195646.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=195646">Devilishly cunning new problem re nsExec::Exec</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">5th October 2004, 10:19</div></div><div class="posttext">OK, I _had_ it working where I unzipped a zip file and captured the output of the unzip program so I could log the files extracted like so:<br />
<br />
!macro MACRONAME UNZIP FILE PATH<br />
ExpandEnvStrings $0 &quot;%COMSPEC%&quot;  <br />
nsExec::Exec '&quot;$0&quot; /C ${UNZIP} ${PATH} -o ${FILE} &gt;&gt; &quot;$INSTDIR\filelist.log&quot;'<br />
!macroend<br />
<br />
I'd call it with: <br />
!insertmacro MACRONAME &quot;C:\temp\unzip.exe&quot; &quot;warfile.war&quot; &quot;-dwardirectory&quot;<br />
<br />
All fine. The moment I try and change the directory the unzip program is in however:<br />
<br />
!insertmacro MACRONAME &quot;$INSTDIR\temp\unzip.exe&quot; &quot;warfile.war&quot; &quot;-dwardirectory&quot;<br />
<br />
And it does absolutely nothin. Doesn't unzip, certainly doesn't log anything. Any ideas? I don't really know what info to give...I'm on Windows XP, NSIS version 2.01<br />
<br />
Cheers guys<br />
<br />
Rob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">5th October 2004, 10:42</div></div><div class="posttext">I should add - it unzips fine if I remove the command line append, ie:<br />
<br />
nsExec::Exec '$0 /C ${UNZIP} ${PATH} -o ${FILE}'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">5th October 2004, 10:50</div></div><div class="posttext">you might probably prefer the ExtractDLL (http://nsis.sourceforge.net/archive/viewpage.php?pageid=77) over using an external program. should also solve your problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">5th October 2004, 10:57</div></div><div class="posttext">Ooh interesting! Quick q rather than me having to hunt around the docs - where do i unzip it to?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">5th October 2004, 11:28</div></div><div class="posttext">Having looked, I assume I put ExtractDLL.dll in the plugins dir, and the rest in a folder called ...\Contrib\ExtractDLL. So I do this:<br />
<br />
Push &quot;$INSTDIR\dir\webapp.war&quot;<br />
Push &quot;$INSTDIR\dir\webapp\&quot;<br />
CallInstDLL ExtractDLL extract<br />
<br />
This just creates a file called &quot;webapp&quot; which is precisely 0 bytes big. Any chance of it extracting to a directory?<br />
<br />
Cheers<br />
<br />
Rob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">5th October 2004, 15:03</div></div><div class="posttext">Bump!<br />
<br />
I really don't see what's wrong here. If I even log the thing i'm chucking into nsExec and then paste the log line into a command prompt it works beautifully:<br />
<br />
C:\WINDOWS\system32\cmd.exe /C &quot;C:\Program Files\C-Evolution\robtest\temp\unzip.exe&quot; -dcevolution-client -o cevolution-client.war &gt;&gt; &quot;C:\Program Files\C-Evolution\robtest\filelist.log&quot;<br />
<br />
But nsExec just hates it with a passion.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">5th October 2004, 15:25</div></div><div class="posttext">I think I've narrowed it down. It doesn't like it when unzip.exe's path has a space in it (e.g. Program Files).<br />
<br />
Not sure whether this is a problem with cmd.exe or nsExec, anyone know?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th October 2004, 18:58</div></div><div class="posttext">You might need more quotes around your strings:<br />
<br />
nsExec::Exec '$0 /C &quot;${UNZIP}&quot; &quot;${PATH}&quot; -o &quot;${FILE}&quot;'<br />
<br />
Like you have said, if the path contains a space, it will become two arguments rather than the one, and so you should use quotes to declare it as one.<br />
<br />
Oh and if I were you, I wouldn't use ExtractDLL. While I was using it to uncompress around 200 Zip's (for updating games) ExtractDLL wouldn't decompress about 25% of the Zip's and Unzip / WinZip would, thus now I use unzip.exe.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th October 2004, 09:02</div></div><div class="posttext">Yeah I agree ExtractDLL seems slightly suspect in terms of it doing what I'd expect it to do each time.<br />
<br />
However I am trying all combinations of quoting and not quoting, and I'm not sure what the difference is. The behaviour changes ONLY when I use the append output '&gt;&gt;' operator, as thought as soon as I use that then spaces in paths become a problem.<br />
<br />
Also extracting out the sample you give would make for an unusual command:<br />
<br />
&quot;C:\Program Files\unzip.exe&quot; &quot;-ddirectory&quot; -o &quot;file.war&quot;<br />
<br />
Like, some unzip.exe arguments quoted and some not? And would I quote the bits after the '&gt;&gt;'?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">6th October 2004, 09:03</div></div><div class="posttext">As I said, if I LogText the exact input I give to nsExec, and then paste that logged text into a command line, it works perfectly from the command line.<br />
<br />
Here's the line:<br />
<br />
C:\WINDOWS\system32\cmd.exe /C &quot;C:\Program Files\C-Evolution\robtest\temp\unzip.exe&quot; -dcevolution-client -o cevolution-client.war &gt;&gt; &quot;C:\Program Files\C-Evolution\robtest\filelist.log&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th October 2004, 14:49</div></div><div class="posttext">cmd.exe and command.com might also expect 8.3 file names. Paths with spaces might not be valid. I'm pretty sure it doesn't work with command.com.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>