<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problems with 64-bit, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problems with 64-bit NSIS Discussion" />
	
	<title> Problems with 64-bit [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problems with 64-bit</div>
<hr />
<div class="pda"><a href="t-264834.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=264834">Problems with 64-bit</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">lrobinot</div><div class="date">1st February 2007, 13:29</div></div><div class="posttext">Hello,<br />
<br />
I'am trying to create an installer with NSIS (2.23) that will install a software on Windows XP, Windows XP 64-bit, Vista and Vista 64-bit.<br />
<br />
I have problems with x64.nsh, here is my tests:<br />
<br />
<br />
!include &quot;LogicLib.nsh&quot;<br />
!include &quot;x64.nsh&quot;<br />
                                                                                                                                    <br />
OutFile &quot;nsis_test.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\Company\Product&quot;<br />
                                                                                                                                    <br />
Section<br />
  ${If} ${RunningX64}<br />
    DetailPrint &quot;Running X64=1&quot;<br />
  ${Else}<br />
    DetailPrint &quot;Running X64=0&quot;<br />
  ${Endif}<br />
                                                                                                                                    <br />
  DetailPrint &quot;=== Default ===&quot;<br />
  DetailPrint &quot;SYSDIR=$SYSDIR&quot;<br />
  DetailPrint &quot;INSTDIR=$INSTDIR&quot;<br />
  DetailPrint &quot;PROGRAMFILES=$PROGRAMFILES&quot;<br />
                                                                                                                                    <br />
  DetailPrint &quot;=== After Disable ===&quot;<br />
  ${DisableX64FSRedirection}<br />
                                                                                                                                    <br />
  DetailPrint &quot;SYSDIR=$SYSDIR&quot;<br />
  DetailPrint &quot;INSTDIR=$INSTDIR&quot;<br />
  DetailPrint &quot;PROGRAMFILES=$PROGRAMFILES&quot;<br />
                                                                                                                                    <br />
  DetailPrint &quot;=== After Enable ===&quot;<br />
  ${EnableX64FSRedirection}<br />
                                                                                                                                    <br />
  DetailPrint &quot;SYSDIR=$SYSDIR&quot;<br />
  DetailPrint &quot;INSTDIR=$INSTDIR&quot;<br />
  DetailPrint &quot;PROGRAMFILES=$PROGRAMFILES&quot;<br />
SectionEnd<br />
<br />
<br />
After compiling and running the resulting test_nsis.exe, I obtain this result on 64-bit plateforms :<br />
<br />
<br />
Running X64=1<br />
=== Default ===<br />
SYSDIR=C:\WINDOWS\system32<br />
INSTDIR=C:\Program Files (x86)\Company\Product<br />
PROGRAMFILES=C:\Program Files (x86)<br />
=== After Disable ===<br />
SYSDIR=C:\WINDOWS\system32<br />
INSTDIR=C:\Program Files (x86)\Company\Product<br />
PROGRAMFILES=C:\Program Files (x86)<br />
=== After Enable ===<br />
SYSDIR=C:\WINDOWS\system32<br />
INSTDIR=C:\Program Files (x86)\Company\Product<br />
PROGRAMFILES=C:\Program Files (x86)<br />
Completed<br />
<br />
<br />
I would have expected<br />
<br />
<br />
Running X64=1<br />
=== Default ===<br />
SYSDIR=C:\WINDOWS\SysWOW64<br />
INSTDIR=C:\Program Files (x86)\Company\Product<br />
PROGRAMFILES=C:\Program Files (x86)<br />
=== After Disable ===<br />
SYSDIR=C:\WINDOWS\system32<br />
INSTDIR=C:\Program Files\Company\Product<br />
PROGRAMFILES=C:\Program Files<br />
=== After Enable ===<br />
SYSDIR=C:\WINDOWS\SysWOW64<br />
INSTDIR=C:\Program Files (x86)\Company\Product<br />
PROGRAMFILES=C:\Program Files (x86)<br />
Completed<br />
<br />
<br />
As test_nsis.exe is a 32-bit executable running on a 64-bit OS.<br />
<br />
Am I wrong ?<br />
<br />
If I am wrong what is the solution to get PROGRAMFILES with the right path if I need to install 32-bit executables, and the 64-bit executables ??<br />
<br />
Thank you very much for any answer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lrobinot</div><div class="date">1st February 2007, 13:48</div></div><div class="posttext">After finding<br />
<br />
http://nsis.cvs.sourceforge.net/nsis/NSIS/Include/x64.nsh?r1=1.4&amp;r2=1.5<br />
<br />
I changed my test script to :<br />
<br />
<br />
!include &quot;LogicLib.nsh&quot;<br />
!include &quot;x64.nsh&quot;<br />
                                                                                                                                    <br />
OutFile &quot;nsis_test.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\Company\Product&quot;<br />
                                                                                                                                    <br />
Section<br />
  ${If} ${RunningX64}<br />
    DetailPrint &quot;Running X64=1&quot;<br />
  ${Else}<br />
    DetailPrint &quot;Running X64=0&quot;<br />
  ${Endif}<br />
                                                                                                                                    <br />
  DetailPrint &quot;=== Default ===&quot;<br />
  SetOutPath &quot;$SYSDIR&quot;<br />
  File /oname=SYSDIR_1.tmp test.nsi<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  File /oname=INSTDIR_1.tmp test.nsi<br />
  SetOutPath &quot;$PROGRAMFILES&quot;<br />
  File /oname=PROGRAMFILES_1.tmp test.nsi<br />
                                                                                                                                    <br />
  ${DisableX64FSRedirection}<br />
  DetailPrint &quot;=== After Disable ===&quot;<br />
  SetOutPath &quot;$SYSDIR&quot;<br />
  File /oname=SYSDIR_2.tmp test.nsi<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  File /oname=INSTDIR_2.tmp test.nsi<br />
  SetOutPath &quot;$PROGRAMFILES&quot;<br />
  File /oname=PROGRAMFILES_2.tmp test.nsi<br />
                                                                                                                                    <br />
  ${EnableX64FSRedirection}<br />
  DetailPrint &quot;=== After Enable ===&quot;<br />
  SetOutPath &quot;$SYSDIR&quot;<br />
  File /oname=SYSDIR_3.tmp test.nsi<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  File /oname=INSTDIR_3.tmp test.nsi<br />
  SetOutPath &quot;$PROGRAMFILES&quot;<br />
  File /oname=PROGRAMFILES_3.tmp test.nsi<br />
SectionEnd<br />
<br />
<br />
but all the files are created in the same directories...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">1st February 2007, 14:04</div></div><div class="posttext">$PROGRAMFILES is constant, not variable, and the question is when it is initialized. AFAIK good place to disable redirection and get correct constant value is .onInit. May be you can use %ProgramFiles% later instead of $PROGRAMFILES (not tested).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lrobinot</div><div class="date">1st February 2007, 17:19</div></div><div class="posttext">Originally posted by Takhir <br />
$PROGRAMFILES is constant, not variable, and the question is when it is initialized. AFAIK good place to disable redirection and get correct constant value is .onInit. May be you can use %ProgramFiles% later instead of $PROGRAMFILES (not tested). <br />
<br />
Thank you very much, by using dynamic variables, I can install files in the right directories...<br />
<br />
Now I have a new problem, accessing the right registry hive!<br />
<br />
While reading this forum, I saw a thread about writing system calls to read registry hive in 64-bit and another one about a patch :<br />
<br />
http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1627457&amp;group_id=22049&amp;atid=373087<br />
<br />
Do I have to rewrite all my scripts to use macro for 64-bit registry reading/writing, or can I wait for the inclusion of the pacth ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th February 2007, 13:08</div></div><div class="posttext">For now, you'd have to use the macro. You could make a macro of your own that'd wrap that macro, so once the patch is applied, you only have to change one line of code.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>