<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" $INSTDIR removes the colon in path, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  $INSTDIR removes the colon in path NSIS Discussion" />
	
	<title> $INSTDIR removes the colon in path [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  $INSTDIR removes the colon in path</div>
<hr />
<div class="pda"><a href="t-354048.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=354048">$INSTDIR removes the colon in path</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">topshoeter</div><div class="date">2nd January 2013, 15:33</div></div><div class="posttext">Hi,<br />
<br />
I retrieve a path from the registry to $INSTDIR. If the path is for example D:\Folder (sans quotes) then no problem. BUT, if the path is contained within quotes as in &quot;C:\Program Files&quot; then NSIS removes the colon!<br />
Retrieving first to a variable (correct path) and then assigning it to $INSTDIR also removes the colon. <br />
The path does exists and there is nothing before the quote. This must be a bug surely.<br />
Please help?<br />
Gerry.<br />
NSIS 2.46</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd January 2013, 18:48</div></div><div class="posttext">What is the exact string retrieved from registry?<br />
ReadRegStr $0 HKLM foo\bar path<br />
MessageBox mb_ok &quot;$0&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">2nd January 2013, 20:22</div></div><div class="posttext">Some of the path variables are special, use a register...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">topshoeter</div><div class="date">4th January 2013, 10:59</div></div><div class="posttext">Hi,<br />
<br />
Thanks for the replies, but I still can't get it to work.<br />
HKLM &quot;Software\Folder&quot; &quot;Location&quot; contains &quot;D:\Temp&quot; (with quotes)<br />
<br />
ReadRegStr  $R0 HKLM &quot;Software\Folder&quot; &quot;Location&quot;<br />
$R0 contains D:\Temp<br />
<br />
StrCpy $INSTDIR $R0<br />
$INSTDIR contains D\Temp (sans colon)<br />
<br />
Any ideas?<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th January 2013, 11:04</div></div><div class="posttext">Hmm. Could it be that the regstring contains a fullwidth colon, that the $INSTDIR variable sanitization code cannot handle? Try writing a new string D:\Temp to the registry before reading it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">topshoeter</div><div class="date">4th January 2013, 11:08</div></div><div class="posttext">I get it now. Paths with imbedded spaces are never surrounded by quotes in the registry. NSIS sees a colon as an illegal character.<br />
<br />
Sorry for wasting your time!<br />
Gerry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">4th January 2013, 11:31</div></div><div class="posttext">Paths with imbedded spaces are never surrounded by quotes in the registry. <br />
<br />
They are sometimes, depends on the key and which program wrote the entry. (Paths that can be executed are often quoted, HKCR\txtfile\shell\open\command etc)<br />
<br />
NSIS sees a colon as an illegal character.<br />
<br />
<br />
It is only legal as the second character when copied into the NSIS $*path variables...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">topshoeter</div><div class="date">4th January 2013, 11:41</div></div><div class="posttext">Spaces in file names! Come back DOS, all is forgiven :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">5th January 2013, 17:52</div></div><div class="posttext">a rare bug? i never ever had such issue here with : or spaces in path names - even quoted or not.<br />
either your code or your environment is corrupted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">topshoeter</div><div class="date">6th January 2013, 14:07</div></div><div class="posttext">Hi Brummelchen,<br />
<br />
I don't think it is a bug, or that my code/installation is corrupt, more ignorance on my part. The situation was this. I was running a test and needed a path in the registry which I entered manually. The path was going to be used in a cmd file to be run subsequently with “ExecWait” so the quotes were necessary.  Because there were spaces in the path I (wrongly) entered the path in the registry enclosed in quotes. This resulted in the colon being stripped when reading into $INSTDIR. After removing the quotes in the registry path $INSTDIR contained the correct path including the spaces. I now place the quotes around the path when building my command line.<br />
<br />
Regards.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">6th January 2013, 14:52</div></div><div class="posttext">ok, i see. look this works if you dont have it <br />
<br />
ExecWait '&quot;$PATH\7zg.exe&quot; x &quot;$otherpath\data.7z&quot; -o&quot;$INSTDIR&quot;' $R9<br />
<br />
when i read out unknown path i trim them before working on them, example:<br />
  ${If} $INSTDIR == &quot;&quot;<br />
    ${registry::Read} &quot;$UNINSTALLREG&quot; &quot;InstallLocation&quot; $R9 $R7<br />
    ${IfNot} $R7 == &quot;&quot;<br />
    ${AndIfNot} $R9 == &quot;&quot;<br />
      Push $R9<br />
        Call Trim<br />
      Pop $R9<br />
      StrCpy $INSTDIR $R9<br />
    ${EndIf}<br />
  ${EndIf}<br />
<br />
Function Trim<br />
  ; Trim<br />
  ;   Removes leading &amp; trailing whitespace from a string<br />
  ; Usage:<br />
  ;   Push {var}<br />
  ;     Call Trim<br />
  ;   Pop  {var}<br />
<br />
  Exch $R1 ; Original string<br />
  Push $R2<br />
  Loop:<br />
    StrCpy $R2 &quot;$R1&quot; 1<br />
    StrCmp $R2 &quot; &quot;      TrimLeft<br />
    StrCmp $R2 &quot;$\&quot;&quot;    TrimLeft<br />
    StrCmp $R2 &quot;$\'&quot;    TrimLeft<br />
    StrCmp $R2 &quot;\&quot;      TrimLeft<br />
    StrCmp $R2 &quot;/&quot;      TrimLeft<br />
    StrCmp $R2 &quot;;&quot;      TrimLeft<br />
    StrCmp $R2 &quot;,&quot;      TrimLeft<br />
    StrCmp $R2 &quot;&lt;&quot;      TrimLeft<br />
    StrCmp $R2 &quot;&gt;&quot;      TrimLeft<br />
    StrCmp $R2 &quot;$\r&quot;    TrimLeft<br />
    StrCmp $R2 &quot;$\n&quot;    TrimLeft<br />
    StrCmp $R2 &quot;	&quot; TrimLeft ; this is a tab.<br />
    GoTo Loop2<br />
  TrimLeft:	<br />
    StrCpy $R1 &quot;$R1&quot; &quot;&quot; 1<br />
    Goto Loop<br />
<br />
  Loop2:<br />
    StrCpy $R2 &quot;$R1&quot; 1 -1<br />
    StrCmp $R2 &quot; &quot;      TrimRight<br />
    StrCmp $R2 &quot;$\&quot;&quot;    TrimRight<br />
    StrCmp $R2 &quot;$\'&quot;    TrimRight<br />
    StrCmp $R2 &quot;\&quot;      TrimRight<br />
    StrCmp $R2 &quot;/&quot;      TrimRight<br />
    StrCmp $R2 &quot;;&quot;      TrimRight<br />
    StrCmp $R2 &quot;,&quot;      TrimRight<br />
    StrCmp $R2 &quot;&lt;&quot;      TrimRight<br />
    StrCmp $R2 &quot;&gt;&quot;      TrimRight<br />
    StrCmp $R2 &quot;$\r&quot;    TrimRight<br />
    StrCmp $R2 &quot;$\n&quot;    TrimRight<br />
    StrCmp $R2 &quot;	&quot; TrimRight ; this is a tab<br />
    GoTo Done<br />
  TrimRight:	<br />
    StrCpy $R1 &quot;$R1&quot; -1<br />
    Goto Loop2<br />
<br />
  Done:<br />
  Pop $R2<br />
  Exch $R1<br />
FunctionEnd<br />
<br />
this blows code a bit but i have several routines like that.<br />
<br />
path in registry in quotes are in most cases only needed when a parameter is added, windows itself is capable to handle. if you work in a batch environment (commandline) you need to add always quotes eg. dir /on &quot;c:\program files\&quot; to avoid errors.<br />
<br />
@=&quot;c:\my.exe&quot;<br />
<br />
@=&quot;\&quot;c:\my.exe\&quot; \&quot;%1\&quot;&quot;<br />
<br />
$\&quot; adds a quote within a string (nsis)<br />
<br />
if you work with nsis commandline parameters you have to determine wether they are in quotes or not - nsis wiki contains some examples.<br />
<br />
HTH</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>