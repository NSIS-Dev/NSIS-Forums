<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS execute *.bat or *.exe, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS execute *.bat or *.exe NSIS Discussion" />
	
	<title> NSIS execute *.bat or *.exe [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS execute *.bat or *.exe</div>
<hr />
<div class="pda"><a href="t-306404.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306404">NSIS execute *.bat or *.exe</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">H-Block</div><div class="date">15th May 2009, 15:01</div></div><div class="posttext">Hallo, <br />
i try to explain my problem.<br />
I want to execute a .bat file from to installer, that attach a database to a SQLEXPRESS 2005. The Same with the .exe file.<br />
<br />
Here is the .bat content:<br />
sqlcmd -U user -P pw -S %computername%\test -Q &quot;sp_attach_db 'test','%Programfiles%\Microsoft SQL Server\MSSQL.1\MSSQL\Data\test.mdf','%Programfiles%\Microsoft SQL Server\MSSQL.1\MSSQL\Data\test_log.ldf'&quot;<br />
<br />
Now my problem when I execute the .bat or exe file self it works. When I execute it from the installer not.<br />
<br />
Help me please.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">15th May 2009, 17:29</div></div><div class="posttext">How do you call the bat file?<br />
<br />
You can use the MSSQL OLEDB plug-in to attach the database as well (usefull if you have to do more than just attaching).<br />
http://nsis.sourceforge.net/MSSQL_OLEDB_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">H-Block</div><div class="date">18th May 2009, 06:52</div></div><div class="posttext">Okay i tried it with MSSQL OLEDB.<br />
Login into SQLEXPRESS Works but then came &quot;Quary Failed&quot;.Why?<br />
<br />
Here the script:<br />
NSIS<br />
SetOutPath &quot;$Temp&quot;<br />
File &quot;D:\db_connect.sql&quot;<br />
ReadRegStr $R3 HKLM &quot;SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName&quot; &quot;ComputerName&quot;<br />
   MSSQL_OLEDB::SQL_Logon &quot;$R3\SQLEXPRESS&quot; &quot;SA&quot; &quot;TEST&quot;<br />
   MSSQL_OLEDB::SQL_Execute &quot;$Temp\db_connect.sql&quot;<br />
   MSSQL_OLEDB::SQL_Logout<br />
<br />
db_connect.sql<br />
sp_attach_db 'test','%Programfiles%\Microsoft SQL Server\MSSQL.1\MSSQL\Data\test.mdf','%Programfiles%\Microsoft SQL Server\MSSQL.1\MSSQL\Data\test_log.ldf'<br />
<br />
Thank you for your help<br />
<br />
Okay I found my problem i used MSSQL_OLEDB::SQL_Execute and not MSSQL_OLEDB::SQL_ExecuteScript. But now came &quot;Error initializing script&quot;. Why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">18th May 2009, 07:21</div></div><div class="posttext">Try following as your sql scriptUSE [master]<br />
GO<br />
CREATE DATABASE [test] ON<br />
( FILENAME = N'%Programfiles%\Microsoft SQL Server\MSSQL.1\MSSQL\Data\test.mdf' ),<br />
( FILENAME = N'%Programfiles%\Microsoft SQL Server\MSSQL.1\MSSQL\Data\test_log.ldf' )<br />
FOR ATTACH<br />
GO</div></div><hr />


<div class="post"><div class="posttop"><div class="username">H-Block</div><div class="date">18th May 2009, 08:34</div></div><div class="posttext">Thank you for your fast answer.<br />
I tried your code but it doesn't work.<br />
There is the same error. Error initializing script.<br />
When I testing it with the Example from MSSQL_OLEDB the Error is:<br />
Extract: test.sql<br />
Loggin on to SQL server Notebook\test<br />
0<br />
Logon successfull<br />
0<br />
SQL State: 0x00000000 - Native: 0 - Message:  <br />
1<br />
Query Failed<br />
0<br />
SQL State: 0x80040e14 - Native: 0 - Message: Wrong Syntax in the near of '\'. <br />
1<br />
Error getting rowset<br />
1<br />
Error getting rowset<br />
0<br />
SQL State: 0x00000000 - Native: 0 - Message:  <br />
0<br />
Script executed successfully<br />
0<br />
SQL State: 0x00000000 - Native: 0 - Message:  <br />
0<br />
Microsoft SQL Server 2005 - 9.00.1399.06 (Intel X86) <br />
	Oct 14 2005 00:33:37 <br />
	Copyright (c) 1988-2005 Microsoft Corporation<br />
	Express Edition on Windows NT 5.1 (Build 2600: Service Pack 3)<br />
<br />
2<br />
No more data<br />
0<br />
SQL State: 0x00000000 - Native: 0 - Message:  <br />
Completed<br />
<br />
When I connect to the SQL server over cmd--&gt; sqlcmd<br />
and paste your code it works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">H-Block</div><div class="date">18th May 2009, 09:38</div></div><div class="posttext">Okay I found my problem and fixed it.<br />
Now I have another Problem. I want to create a user with this script:<br />
MSSQL_OLEDB::SQL_Execute &quot;CREATE LOGIN test WITH PASSWORD = '123456';USE testdb;CREATE USER test FOR LOGIN test WITH DEFAULT_SCHEMA = dbo;Exec sp_addrolemember'db_owner','test'&quot;<br />
<br />
Login into server is okay. Have I anything vorgotten?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">18th May 2009, 09:50</div></div><div class="posttext">Okay I found my problem and fixed it. How did you solve it?<br />
Now I have another Problem. I want to create a user with this script: MSSQL_OLEDB::SQL_Execute &quot;CREATE LOGIN test WITH PASSWORD = '123456';USE testdb;CREATE USER test FOR LOGIN test WITH DEFAULT_SCHEMA = dbo;Exec sp_addrolemember'db_owner','test'&quot; Login into server is okay. Have I anything vorgotten? You can pass only one SQL command to MSSQL_OLEDB::SQL_Execute.<br />
Use this instead:MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;CREATE LOGIN test WITH PASSWORD = '123456'&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;USE testdb&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;CREATE USER test FOR LOGIN test WITH DEFAULT_SCHEMA = dbo&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;Exec sp_addrolemember 'db_owner','test'&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">H-Block</div><div class="date">18th May 2009, 10:37</div></div><div class="posttext">Okay Thank you it Works.<br />
Here is the code I used.<br />
<br />
For SQLEXPRESS install:<br />
Function ExistsMSDE<br />
   ExecWait &quot;$Temp\SQL.EXE -q /norebootchk /qb reboot=ReallySuppress addlocal=all instancename=SQLEXPRESS SCCCHECKLEVEL=IncompatibleComponents:1;MDAC25Version:0 ERRORREPORTING=1 SQLAUTOSTART=1 SAPWD=test SECURITYMODE=SQL DISABLENETWORKPROTOCOLS=0&quot;<br />
   Sleep 10000 ; wait for a 10 seconds<br />
FunctionEnd<br />
<br />
For Database:<br />
ReadRegStr $R3 HKLM &quot;SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName&quot; &quot;ComputerName&quot; <br />
MSSQL_OLEDB::SQL_Logon &quot;$R3\SQLEXPRESS&quot; &quot;sa&quot; &quot;test&quot;<br />
MSSQL_OLEDB::SQL_Execute &quot;CREATE DATABASE [DB_name] ON ( FILENAME = N'$Programfiles\Microsoft SQL Server\MSSQL.1\MSSQL\Data\DB.mdf' ),( FILENAME = N'$Programfiles\Microsoft SQL Server\MSSQL.1\MSSQL\Data\DB_log.ldf' ) FOR ATTACH GO&quot;<br />
MSSQL_OLEDB::SQL_Logout<br />
<br />
For User:<br />
ReadRegStr $R3 HKLM &quot;SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName&quot; &quot;ComputerName&quot;    MSSQL_OLEDB::SQL_Logon &quot;$R3\SQLEXPRESS&quot; &quot;sa&quot; &quot;test&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;CREATE LOGIN user WITH PASSWORD = 'PW'&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;USE DB_name&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;CREATE USER user FOR LOGIN user WITH DEFAULT_SCHEMA= dbo_owner&quot;<br />
MSSQL_OLEDB::SQL_Execute /NOUNLOAD &quot;Exec sp_addrolemember 'db_owner', 'user'&quot;<br />
MSSQL_OLEDB::SQL_Logout<br />
<br />
Thank you for your fast Help.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>