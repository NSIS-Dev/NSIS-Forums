<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" &quot;????&quot; in APPDATA path for non unicode (hebrew) windows username, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  &quot;????&quot; in APPDATA path for non unicode (hebrew) windows username NSIS Discussion" />
	
	<title> &quot;????&quot; in APPDATA path for non unicode (hebrew) windows username [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  &quot;????&quot; in APPDATA path for non unicode (hebrew) windows username</div>
<hr />
<div class="pda"><a href="t-291961.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291961">&quot;????&quot; in APPDATA path for non unicode (hebrew) windows username</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">18th May 2008, 13:54</div></div><div class="posttext">Hi everyone,<br />
Installer doesn't want to work when windows username is in non-unicode language (specifically, Hebrew).<br />
<br />
Assuming I can't use the unicode version of nsis compiler:<br />
<br />
Environment: Windows XP, username is in Hebrew. In Regional settings I deliberately didn't set hebrew as the language for non-unicode applications.<br />
<br />
Problem: In paths such as $APPDATA, NSIS replaces the user name with question marks.<br />
<br />
Hint: The command line tool (command, not cmd) displays a short path with a number instead of the hebrew username (see image).<br />
<br />
How can I get this number programmatically? Is there another solution to the question marks problem, without using unicode-nsis?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">18th May 2008, 14:35</div></div><div class="posttext">You can try...<br />
<br />
<br />
4.9.3.9 GetFullPathName<br />
[/SHORT] user_var(output) path_or_file<br />
Assign to the user variable $x, the full path of the file specified. If the path portion of the parameter is not found, the error flag will be set and $x will be empty. If /SHORT is specified, the path is converted to the short filename form.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">18th May 2008, 15:29</div></div><div class="posttext">Nope. It fails for hebrew username. Succeeds for english username. :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th May 2008, 19:32</div></div><div class="posttext">NSIS doesn't use Unicode and so it can only handle non-Unicode paths. You can use the Unicode version:<br />
<br />
http://www.scratchpaper.com/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">19th May 2008, 12:40</div></div><div class="posttext">it's a great solution but i can't use it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">govind_gk</div><div class="date">22nd May 2008, 07:35</div></div><div class="posttext">Originally posted by kichik <br />
NSIS doesn't use Unicode and so it can only handle non-Unicode paths. You can use the Unicode version:<br />
<br />
http://www.scratchpaper.com/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">22nd May 2008, 16:23</div></div><div class="posttext">Maybe NSIS can put the short filename in the variable when the full one in Unicode?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd May 2008, 18:14</div></div><div class="posttext">That's what the API provides and once you get question marks, you can't safely convert it to a short name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">25th May 2008, 08:41</div></div><div class="posttext">I coded a C/C++ solution last week and now calling it from my installer. This is the important part of the function:<br />
<br />
<br />
// csidl is int value for some user folder.<br />
<br />
TCHAR path[256];<br />
memset(path, 0, 256);<br />
if (!SHGetSpecialFolderPathW(NULL, path, csidl, FALSE)) return FALSE;<br />
	<br />
TCHAR shortPath[256];<br />
memset(shortPath, 0, 256);<br />
if (!GetShortPathNameW(path, shortPath, 256)) return FALSE;<br />
<br />
char asciiShortPath[256];<br />
memset(asciiShortPath, 0, 256);<br />
strcpy(asciiShortPath, ATL::CT2A(shortPath));<br />
<br />
<br />
I could only make it work using the unicode version of SHGetSpecialFolderPath and GetShortPathName, and only then converting to ANSI.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>