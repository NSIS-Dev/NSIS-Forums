<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" .DLL Call/PLUGINSDIR - File wont delete on Installer Exit., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  .DLL Call/PLUGINSDIR - File wont delete on Installer Exit. NSIS Discussion" />
	
	<title> .DLL Call/PLUGINSDIR - File wont delete on Installer Exit. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  .DLL Call/PLUGINSDIR - File wont delete on Installer Exit.</div>
<hr />
<div class="pda"><a href="t-306797.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306797">.DLL Call/PLUGINSDIR - File wont delete on Installer Exit.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Blinker</div><div class="date">27th May 2009, 17:10</div></div><div class="posttext">Hi all - first off, thanks for all the hard-work and effort in creating a fantastic installer package. I love it! <br />
<br />
I'm working on an installer that makes numerous calls to a .DLL that I've written that contains a lot of proprietary stuff. I've extracted the .DLL into the PLUGINSDIR, in hopes that when the installer dies, the .DLL disappears.<br />
<br />
After running various tests - the .DLL still remains in the PLUGINSDIR after the installer has exited.<br />
<br />
Is it possible there is an open file handler to the .DLL prior to the &quot;DELETE PLUGINSDIR&quot; call?<br />
<br />
How can I ensure the handle is released prior to the folder being removed?<br />
<br />
I've seen some code-snippets while searching the forum - I've tried a few, but I'm not having any luck - what do you recommend?<br />
<br />
I believe one call I was using was System:Free 0 or something along those lines (sorry, dont have the code handy).<br />
<br />
Suggestions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th May 2009, 20:05</div></div><div class="posttext">Try changing the working directory to something other than $PLUGINSDIR with SetOutPath. However, if the dll remains then it sounds like a problem with the dll. Can you manually delete it after calling it?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Blinker</div><div class="date">27th May 2009, 20:27</div></div><div class="posttext">Originally posted by Afrow UK <br />
Try changing the working directory to something other than $PLUGINSDIR with SetOutPath. However, if the dll remains then it sounds like a problem with the dll. Can you manually delete it after calling it? <br />
<br />
I never really change to the PLUGINSDIR in my script, but I took your suggestion and did a SetOutPath to $TEMP for kicks at the end of the script to see what that would do... MySetup.DLL remained in the plugins dir - the rest of the files that were used by the setup.exe disappeared.<br />
<br />
Here's the jist of what I'm doing, some code removed:<br />
<br />
<br />
  ; Initialize our plugin directory<br />
  InitPluginsDir<br />
<br />
  File /oname=$PLUGINSDIR\MySetup.DLL &quot;${CLIENT_INSTALL_PATH}\work\Utilities\MySetup.dll&quot;<br />
<br />
  System::Call '$PLUGINSDIR\MySetup::Function1(t &quot;$INSTDIR&quot;, t r0r0, i r1r1 ) i .r2'<br />
<br />
<br />
  System::Call '$PLUGINSDIR\MySetup::Function2(t &quot;$INSTDIR&quot;, t r0r0, i r1r1 ) i .r2'<br />
<br />
<br />
  System::Call '$PLUGINSDIR\MySetup::Function3(t &quot;$INSTDIR&quot;, t r0r0, i r1r1 ) i .r2'<br />
<br />
  SetOutPath &quot;$TEMP&quot;<br />
<br />
<br />
<br />
Does &quot;System&quot; have a handle on that .DLL that hasn't been released?<br />
<br />
I tried to Delete the .DLL after one of the calls - it wouldn't go anywhere.. am I missing something?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th May 2009, 21:15</div></div><div class="posttext">add &quot;?u&quot; at the end of the last call</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Blinker</div><div class="date">27th May 2009, 21:20</div></div><div class="posttext">Originally posted by Anders <br />
add &quot;?u&quot; at the end of the last call  <br />
<br />
That did the trick..  Is there a single call that will tell &quot;System&quot; to release the/all the handle(s)?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>