<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MUI LangString bug?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MUI LangString bug? NSIS Discussion" />
	
	<title> MUI LangString bug? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MUI LangString bug?</div>
<hr />
<div class="pda"><a href="t-147907.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=147907">MUI LangString bug?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">G_J</div><div class="date">2nd September 2003, 12:55</div></div><div class="posttext">Hi,<br />
<br />
I'm using a MUI multi-lingual installer.<br />
onInit uses !insertmacro MUI_LANGDLL_DISPLAY to present the user with a list of languages, after which $LANGUAGE gets populated.<br />
Later on within the onInit function I am checking whether the application being installed is already present and running. If so, MessageBox is used to request the user to close it, so that it could be upgraded smoothly. There is a loop that ensures that the user really closes the application before proceeding.<br />
The problem is that the MessageBox text is multilingual and thus references $(AppIsRunningMessage), which is a LangString defined previously for each applicable language. However, there seems to be a bug in which the $() always returns the English version of the message regardless of the value of $LANGUAGE. I am using LangStrings and $() successfully in other areas of the installer, the problem reported here occurs only in the onInit, yet I cannot rewrite the installer to do the MessageBox elsewhere. <br />
<br />
Please let me know if there is a fix for this or a good workaround.<br />
<br />
Thanks,<br />
 GJ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd September 2003, 12:58</div></div><div class="posttext">The language you set in .onInit isn't really set until .onInit ends. Therefore the language NSIS found most fit would be used for any LangString in .onInit. You can show the message in .onGUIInit or in a custom page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">G_J</div><div class="date">2nd September 2003, 15:50</div></div><div class="posttext">Hi Kichik,<br />
<br />
Thanks for the swift response. It's strange that $() doesn't work in .onInit because if I dump the value of $LANGUAGE itself during .onInit (e.g. in a MessageBox) I see that it does get set after the user selects the installation language. Strange. Anyway, I was able to work around the problem by displaying the MessageBox in my custom Upgrade page. But then I had to use 'Quit' instead of 'Abort' to stop installation if the user wanted to. Quick question: are there harmful side-effects that Quit has, compared to an Abort during .onInit (e.g. is it possible that temp files won't be deleted, the plugins folder won't get cleaned, etc)?<br />
<br />
Another remaining issue is that I am doing the same thing in the uninstall, i.e. checking if the app is running and asking the user to close it if so, before proceeding. Here I populate $LANGUAGE myself from the registry in un.onInit (first thing) but again I see that $() doesn't work on LangStrings in un.onInit. This is very unfortunate.<br />
I can't use un.onGUIInit because the compiler complains that it already exists. Is there something else I can do without rewriting my uninstall completely? <br />
<br />
Thanks,<br />
  Gilad</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd September 2003, 15:57</div></div><div class="posttext">$LANGUAGE is set in .onInit, but NSIS re-reads it only after .onInit. Quit doesn't have any side-effects I know of. The plug-ins directory is deleted and the bzip2 temporary file is deleted once closed anyway. Unless you put something out of $PLUGINSDIR, I don't think there should be any problem with Quit. Though I think it would be nicer for the user to click his way out of there, giving him time to see the message.<br />
<br />
Because the MUI itself uses .onGUIInit and un.onGUIInit you should define a certain define to tell it to call your own function from its .onGUIInit. See the MUI readme for more information.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">G_J</div><div class="date">2nd September 2003, 21:31</div></div><div class="posttext">Hi Kichik,<br />
<br />
Thanks. I have it working well now, in the install and uninstall. You have been extremely helpful. I have another question, but I will submit it separately to keep the forum organized.<br />
<br />
  GJ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">3rd January 2005, 17:43</div></div><div class="posttext">OK.<br />
I understand all. But inside .onInit and un.onInit I call MessageBox with &quot;YES/NO&quot; and if user press &quot;Yes&quot; -&gt; abort installation/uninstallation. How can I do it (with multilangauge messagebox text)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th January 2005, 15:49</div></div><div class="posttext">Your only option is comparing $LANGUAGE to language ids and displaying the correct message. If you use the LogicLib, it shouldn't be too complicated.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>