<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to set the installation directory depending on a choice user made earlier ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to set the installation directory depending on a choice user made earlier ? NSIS Discussion" />
	
	<title> How to set the installation directory depending on a choice user made earlier ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to set the installation directory depending on a choice user made earlier ?</div>
<hr />
<div class="pda"><a href="t-262773.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262773">How to set the installation directory depending on a choice user made earlier ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ontrack16</div><div class="date">31st December 2006, 14:38</div></div><div class="posttext">A user can select either installation locally or on a network.<br />
<br />
When the user selects local, the install dir should be by default eg C:\Install.<br />
When the user selects network, the install dir should be by defalt eg F:\Install.<br />
<br />
When I call the Directory page however, I can't get to set the right default installation directory.<br />
<br />
The directory page uses InstallDir and I can't change the value of that InstallDir from inside a section/function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">31st December 2006, 14:51</div></div><div class="posttext">The directory page uses InstallDir and I can't change the value of that InstallDir from inside a section/function.<br />
You can't do that. InstallDir means the suggested default directory that installer adds on directory page.<br />
It'd change once users hit the browse button and specify another directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ontrack16</div><div class="date">31st December 2006, 15:06</div></div><div class="posttext">I think I got it.<br />
There was already a topic with title : &quot;overwrite default InstallDir&quot;<br />
<br />
I will use the same technique.<br />
Sorry for asking the same question twice.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">31st December 2006, 15:22</div></div><div class="posttext">If you want to show a suggested dir on directory page different than the one specified with InstallDir then you should do something like this:<br />
Name &quot;My Application&quot;<br />
OutFile test.exe<br />
LicenseData '${NSISDIR}\License.txt'<br />
LicenseBkColor 0xFFFFFF<br />
InstallDir '$PROGRAMFILES\$(^name)'<br />
<br />
!include winmessages.nsh<br />
<br />
Page License<br />
Page Components<br />
Page Directory '' dir_show<br />
Page InstFiles<br />
<br />
Section &quot;boo&quot;<br />
######<br />
SectionEnd<br />
<br />
Function dir_show<br />
<br />
FindWindow $R1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $R2 $R1 '1019'<br />
ExpandEnvStrings $R0 '%USERPROFILE%'<br />
SendMessage $R2 ${WM_SETTEXT} 1 'STR:$R0\$(^name)'<br />
GetDlgItem $R2 $HWNDPARENT 1<br />
System::Call &quot;user32::SetFocus(i R2)i&quot;<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">1st January 2007, 12:03</div></div><div class="posttext">When the user selects local, the install dir should be by default eg C:\Install.<br />
When the user selects network, the install dir should be by defalt eg F:\Install.<br />
You're able to achieve this only in Function .onInit.<br />
However you must use messageboxes to interact with users since there is no GUI yet.<br />
EXAMPLE:<br />
Name &quot;My Application&quot;<br />
OutFile test.exe<br />
LicenseData '${NSISDIR}\License.txt'<br />
LicenseBkColor 0xFFFFFF<br />
InstallDir '$PROGRAMFILES\$(^name)'<br />
<br />
Page License<br />
Page Components<br />
Page Directory<br />
Page InstFiles<br />
<br />
Section &quot;boo&quot;<br />
;;;;;;;;;<br />
SectionEnd<br />
<br />
Function .onInit<br />
  StrCpy $0 0<br />
  EnumRegKey $1 HKCU Network $0<br />
  StrCmp $1 &quot;&quot; end ;there is no network drive mapped<br />
  ;found mapped drive(s) ask user if install either on local or network<br />
  MessageBox MB_ICONQUESTION|MB_YESNO \<br />
  &quot;Install on local or Network drive?$\n$\n\<br />
  Either select Yes for local or No for network&quot; IDYES end ;user selection is local installation<br />
<br />
  EnumRegKey $1 HKCU Network $0<br />
  StrCpy '$R0' '$1:'<br />
  IntOp $0 $0 + 1<br />
  EnumRegKey $1 HKCU Network $0<br />
  StrCmp $1 &quot;&quot; done ;there is only one mapped net drive we shall use this<br />
<br />
  StrCpy $0 0<br />
<br />
loop: ;find all available network drives and promt user to select one<br />
  EnumRegKey $1 HKCU Network $0<br />
  StrCpy '$R0' '$1:'<br />
  IntOp $0 $0 + 1<br />
  EnumRegKey $1 HKCU Network $0<br />
  StrCmp $1 &quot;&quot; last<br />
  MessageBox MB_YESNO|MB_ICONQUESTION \<br />
  &quot;Install on $R0 network drive?$\n$\n\<br />
  Select Yes to install on $R0, No to select another drive&quot; IDYES done<br />
  goto loop<br />
<br />
last:<br />
  MessageBox MB_YESNO|MB_ICONQUESTION \<br />
  &quot;Last network drive found $R0 install here?$\n$\n\<br />
  Select Yes to install on $R0, No to start over&quot; IDYES done<br />
  StrCpy $0 0<br />
  goto loop<br />
<br />
done:<br />
  StrCpy '$INSTDIR' '$R0\$(^name)'<br />
<br />
end:<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>