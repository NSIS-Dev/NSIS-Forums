<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System plugin NSIS Discussion" />
	
	<title> System plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System plugin</div>
<hr />
<div class="pda"><a href="t-106294.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=106294">System plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">21st September 2002, 03:11</div></div><div class="posttext">General purpose of this plugin is to allow you to call any DLL functions (for ex. kernel32.dll-&gt;GetDiskFreeSpaceExA) from within NSIS script. Some additional functionality... Coming, at least... :)<br />
<br />
Read LastComments.txt and System.txt. MSVC++7.0 required to compile (or project conversion). Compiled dll and example script included...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st September 2002, 09:06</div></div><div class="posttext">Word of warning, this will only work with a certain number of parameters because the NSIS code only allows a fixed number. I *believe* someone just increased this limit slightly but it's still a low number (it used to be somewhere around 5 or 6). Also, invisibly behind the scenes NSIS is entitled to use some of these slots itself, off the top of my head I can't remember if the current implementation of plugin calls uses any or not but I think it's likely that it does and so you have even less args that you can pass to a called function via this plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">21st September 2002, 13:06</div></div><div class="posttext">... :-( ) ...<br />
<br />
Certain number of parameters???? 5-6? What parameters do you mean? <br />
<br />
Calls to external dll's thru System Plugin uses the stack to pass the parameters (at least control ones, other are specified by format). And I thought NSIS have un-sized stack, am I right? Yes, I just looked at source code, it creates and disposes elements at runtime using GlobalAlloc and GlobalFree. To plugin stack passed by pointer too, so there mustn't be any problems with CallInstDll. The dll::proc just pushes params to stack, so no problems here too. Surely, you meant something other?<br />
<br />
By the way: in the worst case this is not a problem too, user can pass allowed number of arguments thru stack and place others to $/$R variables, he just need to specify this by ParamID.<br />
<br />
For example, the MessageBox: the case of passing all args thru stack (takes all args from stack, and places result to $R0):<br />
<br />
System::FullCall 33 &quot;Example 1&quot; &quot;Just something&quot; 0 &quot;ssss?annnn&quot; &quot;user32.dll?MessageBoxA?iissi&quot; <br />
<br />
And the case of passing args thru variables:<br />
<br />
StrCpy $R1 &quot;Just something&quot;<br />
StrCpy $R2 &quot;Example1&quot;<br />
StrCpy $R3 33<br />
System::FullCall &quot;nbcd?annnn&quot; &quot;user32.dll?MessageBoxA?iissi&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st September 2002, 14:44</div></div><div class="posttext">Yeah it uses the stack to pass variables, but in the code I think the variables to a command keyword are packed into an opcode structure which is stored in the installer exe and then acted upon at install time. This opcode structure stacks up the args it knows about then calls the plugin. So if the opcode structure doesn't have enough space for all of your args they won't get stacked... that is unless someone changed the code recently.<br />
<br />
-- Sunjammer</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">21st September 2002, 16:15</div></div><div class="posttext">Checked the NSIS code once again: argument pushes are separate entrys (EW_PUSHPOP), just like EW_REGISTERDLL which calls proc itself.<br />
<br />
P.S. Thanx for you care!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st September 2002, 17:19</div></div><div class="posttext">Hmm I'm sure I replied to earlier saying that the code has indeed changed and I was/am wrong :).. However my system or the board ate my post it seems :P<br />
<br />
I also said that after thinking about it for a while I think you're right about the order of the arguments, especially in the case where you are dealing with a printf like function (or anything else that uses the first arg as a means of saying how many more args there will be).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">brainsucker</div><div class="date">21st September 2002, 19:52</div></div><div class="posttext">1. :) You've posted that message to another thread (&quot;Feature request')...<br />
2. Cool... Now I have an ally! :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>