<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" I am confused with reading ini value, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  I am confused with reading ini value NSIS Discussion" />
	
	<title> I am confused with reading ini value [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  I am confused with reading ini value</div>
<hr />
<div class="pda"><a href="t-270224.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270224">I am confused with reading ini value</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">26th April 2007, 18:33</div></div><div class="posttext">On my custom page has two checkboxes which are checked by default.<br />
code Like these:<br />
<br />
ReserveFile &quot;ConfigurationPage.ini&quot;<br />
Page custom ShowConfigurationPage ValidateConfigurationPage<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
<br />
Function .onInit<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;ConfigurationPage.ini&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE  'ConfigurationPage.ini' 'Field 2' 'Text' &quot;'  Allow all user.'&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE  'ConfigurationPage.ini' 'Field 3' 'Text' &quot;'  Automatically install upgrades'&quot;<br />
FuctionEnd<br />
<br />
<br />
Function ShowConfigurationPage<br />
   strcpy $EnableFlag 1<br />
   !insertmacro MUI_HEADER_TEXT &quot;$(PRODUCT_CONFIGURATION_TITLE)&quot; &quot;$(PRODUCT_CONFIGURATION_SUBTITLE)&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;ConfigurationPage.ini&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_SHOW<br />
FunctionEnd<br />
<br />
Function ValidateConfigurationPage<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $ChooseOption &quot;ConfigurationPage.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
  ${if} $ChooseOption == 2<br />
    ;  !insertmacro MUI_INSTALLOPTIONS_READ $op2 &quot;ConfigurationPage.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
      ReadIniStr $op2 '$PLUGINSDIR\ConfigurationPage.ini' 'Field 2' 'State'<br />
      ${if} $op2 == &quot;0&quot;<br />
  ;          !insertmacro MUI_INSTALLOPTIONS_WRITE 'ConfigurationPage.ini' 'Field 2' 'State' '0'<br />
            WriteIniStr '$PLUGINSDIR\ConfigurationPage.ini' 'Field 2' 'State' '1'<br />
      ${else}<br />
            ; !insertmacro MUI_INSTALLOPTIONS_WRITE 'ConfigurationPage.ini' 'Field 2' 'State' '1'<br />
            WriteIniStr '$PLUGINSDIR\ConfigurationPage.ini' 'Field 2' 'State' '0'<br />
      ${endif}<br />
      abort<br />
  ${elseif} $ChooseOption == 3<br />
      ReadIniStr $op3 '$PLUGINSDIR\ConfigurationPage.ini' 'Field 3' 'State'<br />
      ;!insertmacro MUI_INSTALLOPTIONS_READ $op3 'ConfigurationPage.ini' 'Field 3' 'State'<br />
      ${if} $op3 == &quot;0&quot;<br />
           ; !insertmacro MUI_INSTALLOPTIONS_WRITE 'ConfigurationPage.ini' 'Field 3' 'State' '0'<br />
            WriteIniStr '$PLUGINSDIR\ConfigurationPage.ini' 'Field 3' 'State' '1'<br />
            MessageBox MB_OK|MB_ICONEXCLAMATION &quot;If you disable this service, the performance of ${PRODUCT_NAME} will degrade, $\nand upgrades to the software will be disabled.&quot; /SD IDOK<br />
      ${else}<br />
             ;!insertmacro MUI_INSTALLOPTIONS_WRITE 'ConfigurationPage.ini' 'Field 3' 'State' '1'<br />
             WriteIniStr '$PLUGINSDIR\ConfigurationPage.ini' 'Field 3' 'State' '0'<br />
      ${endif}<br />
      abort<br />
  ${endif}<br />
FunctionEnd<br />
<br />
My ini file:<br />
[Settings]<br />
NumFields=4<br />
<br />
[Field 1]<br />
Type=GroupBox<br />
Text=Settings<br />
Left=1<br />
Right=289<br />
Top=25<br />
Bottom=83<br />
<br />
[Field 2]<br />
Type=CheckBox<br />
Left=10<br />
Right=213<br />
Top=44<br />
Bottom=52<br />
State=1<br />
Flags=NOTIFY<br />
Text= <br />
<br />
[Field 3]<br />
Type=CheckBox<br />
Left=10<br />
Right=204<br />
Top=60<br />
Bottom=68<br />
State=1<br />
Flags=NOTIFY<br />
Text= <br />
<br />
<br />
[Field 4]<br />
Type=Label<br />
Text=Note: It is highly recommended.<br />
Left=0<br />
Right=295<br />
Top=3<br />
Bottom=17<br />
<br />
<br />
Questions:<br />
1. since the the checkboxes are checked by default, how come the state I read  on &quot;page Leave&quot; function (ValidateConfigurationPage) is always 0, it's supposed to be 1?????<br />
2. !insertmacro MUI_INSTALLOPTIONS_WRITE  and ReadInistr : they are equivalent???? or something different between them?<br />
3. if user unchecked the checkbox, should I write the value back to ini file, I found I can read the value correctly no matter i write(didn't) value back to ini file, what's going on when write the ini file? it will write to the ini file under $PLUGINSDIR\myinifile.ini or something else?<br />
4. is anything wrong with my code?<br />
<br />
your answer is appreciated!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">27th April 2007, 00:22</div></div><div class="posttext">I'm not sure I can answer your question specifically, but I can see one problem:<br />
In the page's leave function, you are setting the INI value different to the page's actual state.  If you are going to change the INI file, you should also set the state of the control to match using a SendMessage command.  (But, I'm not real sure that's what you want in this example.  In looking at the logic in your code, I'm not real clear about what it is you are really trying to accomplish.)<br />
<br />
  AFAIK, the 2 functions are the same, but for consistency, it's best to use one or the other.  (I'd use the MUI functions just because it seems more appropriate.)<br />
<br />
 you don't need to write anything; the InstallOptions.DLL takes care of that for you.  All you need to do is read the value to find out what the user picked.  (The only excpetion to this would be if you are trying to control one page control based on an event.  See the example script ${NSISDIR}\Examples\InstallOptions\testnotify.nsi to see how this is done.)<br />
<br />
 see my first comment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesKiller</div><div class="date">27th April 2007, 00:25</div></div><div class="posttext">thanks a lot. that's helpful.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th April 2007, 15:06</div></div><div class="posttext">MUI_INSTALLOPTIONS_READ/WRITE just prefix $PLUGINSDIR onto the INI file name to make it a full path whereas you must specify $PLUGINSDIR with Read/WriteINIStr.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>