<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS Navigate through functions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS Navigate through functions NSIS Discussion" />
	
	<title> NSIS Navigate through functions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS Navigate through functions</div>
<hr />
<div class="pda"><a href="t-248851.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=248851">NSIS Navigate through functions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fistos</div><div class="date">16th June 2006, 03:51</div></div><div class="posttext">Hello,<br />
<br />
 <br />
<br />
I am trying to setup an NSIS installer that reboots during the middle of my installation, then when the PC is rebooted the program will automatically continue the installation then when its finished it will pop-up the FINISH page.<br />
<br />
 <br />
<br />
I have succesfully managed to write my installer to the registry, with an argument so it could launch on the next reboot with the following code:<br />
<br />
 <br />
<br />
Function CPAGEFINISH<br />
<br />
 <br />
<br />
IfRebootFlag 0 noreboot<br />
<br />
 <br />
<br />
  !define MUI_FINISHPAGE_NOAUTOCLOSE<br />
<br />
  !define MUI_FINISHPAGE_TITLE &quot;Installation Half-Done&quot;<br />
<br />
  !define MUI_FINISHPAGE_TEXT &quot;The installation is not complete but needs to reboot before going \<br />
<br />
                               on.  Do you want to reboot now or wait until later to finish this?&quot;<br />
<br />
  !define MUI_FINISHPAGE_TEXT_REBOOTNOW &quot;Reboot now&quot;<br />
<br />
  !define MUI_FINISHPAGE_TEXT_REBOOTLATER &quot;I want to manually reboot later&quot;<br />
<br />
 <br />
<br />
  StrCpy $varRebootNext 1<br />
<br />
 <br />
<br />
  System::Call 'kernel32::GetModuleFileNameA(i 0, t .R0, i 1024) i r1'<br />
<br />
  ;$R0 will contain the installer filename<br />
<br />
  WriteRegStr HKLM Software\Microsoft\Windows\CurrentVersion\Run &quot;SurfsUpDS&quot; &quot;$R0 /STAGE2&quot;<br />
<br />
  <br />
<br />
I have no idea how to make my program start from a specific Section after the PC is rebooted. I've tried the GetParameters and goto, but it never worked.<br />
<br />
 I would like to have something like that:<br />
<br />
 <br />
Function .onInit<br />
<br />
 <br />
<br />
         Call GetParameters<br />
<br />
         Pop $R1<br />
<br />
         ${if} $R0 == &quot;STAGE2&quot;<br />
<br />
         goto SectionAFTERREBOOT<br />
<br />
 <br />
<br />
 <br />
<br />
I know this code won't work but I would like to do something similar.<br />
<br />
 <br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">16th June 2006, 06:52</div></div><div class="posttext">I am not sure how to go to a specific section, but if you wanted to run something from your .onInit, I was thinking that this should work: write a flag somewhere on the system registry before rebooting, read this flag during .onInit and if it exists then go to a specific point within your .onInit. The flag could be a number, incremented for every reboot, so you could redirect the installer to a different section every time (if you want say to restart more than once). You could also define some parameter and then setup your sections conditionally so that they would not be executed upon reboot. Something like this:<br />
.onInit<br />
ClearErrors<br />
ReadRegValue $0 HKLM &quot;Software\&lt;YourKey&gt;&quot; &quot;Flag&quot;<br />
IfErrors &lt;label_if_not_reboot&gt;<br />
StrCmp $0 1 &lt;label_if_reboot_1&gt;<br />
StrCmp $0 2 &lt;label_if_reboot_2&gt;<br />
<br />
...<br />
<br />
&lt;label_if_reboot&gt;<br />
StrCpy $Parameter 1<br />
...<br />
<br />
Section &lt;SomeName&gt;<br />
${If} $Parameter 0<br />
&lt;things to do before reboot&gt;<br />
...<br />
${Else}<br />
&lt;things to do after reboot&gt;<br />
...<br />
${EndIf}Hope this helps<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">17th June 2006, 07:10</div></div><div class="posttext">Let's say for sake of argument the $Value variable holds the value you pass to it.  And using your example, let's say a value of &quot;Stage2&quot; means we want to go to run section.<br />
<br />
This might be the code:<br />
<br />
InstType &quot;normal&quot;<br />
InstType &quot;Stage2&quot;<br />
<br />
Section -Norm<br />
	SectionIn 1<br />
	### This section would be the start of the install<br />
	MessageBox MB_OK &quot;You are in section '-Norm'.&quot;<br />
SectionEnd<br />
<br />
Section -Stage2<br />
	SectionIn 2<br />
	### This section would be executed only when stage 2 is done<br />
	MessageBox MB_OK &quot;you are in section '-Stage2'.&quot;<br />
SectionEnd<br />
<br />
Function .onInit<br />
	### Determine if this is a normal or Stage2 by looking <br />
	### Set the value of $Value<br />
	Call GetParameters<br />
	Pop $Value<br />
	### Then, just compare the value and act accordingly<br />
	StrCmp $Value &quot;Stage2&quot; SetStage2 SetNormal<br />
	<br />
	SetStage2:<br />
	SetCurInstType 1<br />
	Goto end<br />
	<br />
	SetNormal:<br />
	SetCurInstType 0<br />
	<br />
	end:<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>