<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SetOverwrite ifnewer not working ... why?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SetOverwrite ifnewer not working ... why? NSIS Discussion" />
	
	<title> SetOverwrite ifnewer not working ... why? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SetOverwrite ifnewer not working ... why?</div>
<hr />
<div class="pda"><a href="t-246105.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=246105">SetOverwrite ifnewer not working ... why?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">aekalman</div><div class="date">13th May 2006, 08:37</div></div><div class="posttext">Hi All.<br />
<br />
I've been working NSIS for a while and have built an installer that works for me except for the fact that ifnewer does not appear to work for me. This is with NSIS v2.06 in Win98 and Win2k.<br />
<br />
I think I have setup the SetOverwrite command properly, and I invoke it with the ifnewer argument. However, a test I recently did showed that it doesn't work, and I really want to know why / want to know how to fix it. Perhaps someone can help?<br />
<br />
My test:  <br />
<br />
1) Build &amp; run installer, installs file d:\path\fileA to c:\path\fileA.<br />
<br />
2) Edit d:\path\fileA (add some text).<br />
<br />
3) Re-build and run installer.<br />
<br />
5) View c:\path\fileA. It's still the old fileA. not the new one that has the added text.<br />
<br />
Isn't this wrong? Shouldn't the ifnewer attribute force the new fileA (from d:\path\fileA) to overwrite the old fileA (in c:\path\fileA)?<br />
<br />
I've attached the relevant part of the build window.<br />
<br />
Note that I do want ifnewer, not the default (on), for certain files.<br />
<br />
Please please please someone show me what I've been doing wrong ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">13th May 2006, 18:11</div></div><div class="posttext">I did a quick test and it works fine.<br />
Is it possible that an error occured when trying to extract the file to c:\path\?  (Have you tried looking for the error flag?)<br />
<br />
Here's the code I used in my test:<br />
Name &quot;test&quot;<br />
outfile &quot;Test File Overwrite.exe&quot;<br />
ShowInstDetails show<br />
<br />
page instfiles<br />
<br />
Section<br />
	CreateDirectory &quot;C:\temp\NSIS_TEST\installdir&quot;<br />
	SetOutPath &quot;C:\temp\NSIS_TEST\installdir&quot;<br />
	SetOverwrite ifnewer<br />
	File &quot;C:\temp\NSIS_TEST\sample01.txt&quot;<br />
SectionEnd<br />
<br />
<br />
The sample file 'sample01.txt' is just a simple text file.<br />
Here are the steps I used:[list=1]<br />
 edit the sample01 file located in the folder with the NSI script.  Added the text &quot;old file&quot;.  Closed and saved changes.<br />
 Compiled and ran the install.  Checked to see that the sample file was installed to the proper directory.<br />
 edited the sample01 file (located in the same folder as my NSI script) and changed the text to &quot;new file&quot;.  Closed and saved.<br />
 Recompiled the script and ran the install.<br />
 Checked the sample01 file in my install directory.  Found that it was the newer file as expected.<br />
[/list=1]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aekalman</div><div class="date">14th May 2006, 03:08</div></div><div class="posttext">Hi Comperio.<br />
<br />
Thanks for the reply -- for some reason I'm having difficulty reaching (only) the Winamp site. Hence the delay in responding.<br />
<br />
I don't know how to check for an error. I watched the installer screen and it said nothing (neither &quot;skipped&quot; nor otherwise) for that file. How do I look for the error? I haven't been able to find it in the help file ...<br />
<br />
Here's the code I use (some sections deleted for clarity). I have a sneaking suspicion that maybe due to nesting or something it's not working. But the build results that I posted in the original posting ought to indicate that the ifnewer attribute is reaching the right place ...<br />
<br />
!macro Section_Compiler sdcode tdcode tname<br />
<br />
	SectionGroup &quot;!${tname}&quot; GRP_SEC_${sdcode}<br />
<br />
    !ifdef Pro<br />
    ${Makefile_Files} &quot;Pro Makefile Files&quot;  PRO_MAK  ${SALVO_SRC_DIR} &quot;ifnewer&quot; &quot;pro-makefile&quot;  ${sdcode} ${tdcode}<br />
    !endif<br />
       <br />
    !ifdef Lite<br />
    Section -RemoveInc${sdcode}<br />
    FileWrite $UninstLog &quot;$INSTDIR\${SUB_DIR}$\r$\n&quot;<br />
    SectionEnd<br />
    Section -RemoveLib${sdcode}<br />
    FileWrite $UninstLog &quot;$INSTDIR\${SUB_DIR}$\r$\n&quot;<br />
    SectionEnd<br />
    Section -RemoveSrc${sdcode}<br />
    FileWrite $UninstLog &quot;$INSTDIR\${SUB_DIR}$\r$\n&quot;<br />
    SectionEnd<br />
    !endif<br />
    <br />
<br />
	SectionGroupEnd<br />
<br />
!macroend<br />
!define Section_Compiler &quot;!insertmacro Section_Compiler&quot;<br />
<br />
<br />
!macro Makefile_Files description  ID subdir mode filename sdcode tdcode<br />
<br />
	Section &quot;${description}&quot; SEC_SALVO_${ID}_${sdcode}<br />
<br />
	SetOverwrite &quot;${mode}&quot;<br />
<br />
	${redef} SUB_DIR ${subdir}\Make\${tdcode}<br />
<br />
	!include &quot;files\${sdcode}\salvo-files-${filename}.nsh&quot;<br />
<br />
	SectionEnd<br />
<br />
!macroend<br />
!define Makefile_Files &quot;!insertmacro Makefile_Files&quot;<br />
and it's invoked e.g. like this:<br />
${Section_Compiler} KCARM   KCARM    &quot;Keil ARM Development Tools -- CARM&quot;Thanks for your help -- I really need it on this one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aekalman</div><div class="date">14th May 2006, 03:40</div></div><div class="posttext">So I did some more testing -- ifnewer works in some places in my installer, but not in others. The Makefile example is one where it does not work, but here's one where it does (the file is named tut5.c). By &quot;it works&quot; I mean that I do see the new file in the installdir, and when the installer is running, I get an &quot;extract: 100%&quot; message.<br />
<br />
Here's the code for a file that does end up being updated if it's newer in the installer:<br />
<br />
!macro Section_Compiler sdcode tdcode tname<br />
<br />
	SectionGroup &quot;!${tname}&quot; GRP_SEC_${sdcode}<br />
<br />
    !ifdef Lite<br />
    ${Example_Files}  &quot;Lite Example Files&quot;  LITE_EX  ${SALVO_EX_DIR}  &quot;ifnewer&quot; &quot;lite-ex&quot;       ${sdcode} ${tdcode}<br />
	!endif<br />
       <br />
    !ifdef Lite<br />
    Section -RemoveInc${sdcode}<br />
    FileWrite $UninstLog &quot;$INSTDIR\${SUB_DIR}$\r$\n&quot;<br />
    SectionEnd<br />
    Section -RemoveLib${sdcode}<br />
    FileWrite $UninstLog &quot;$INSTDIR\${SUB_DIR}$\r$\n&quot;<br />
    SectionEnd<br />
    Section -RemoveSrc${sdcode}<br />
    FileWrite $UninstLog &quot;$INSTDIR\${SUB_DIR}$\r$\n&quot;<br />
    SectionEnd<br />
    !endif<br />
    <br />
<br />
	SectionGroupEnd<br />
<br />
!macroend<br />
!define Section_Compiler &quot;!insertmacro Section_Compiler&quot;<br />
<br />
<br />
!macro Example_Files description  ID subdir mode filename sdcode tdcode<br />
<br />
	Section &quot;${description}&quot; SEC_SALVO_${ID}_${sdcode}<br />
<br />
	SetOverwrite &quot;${mode}&quot;<br />
<br />
	${redef} SUB_DIR ${subdir}<br />
<br />
	!include &quot;files\${sdcode}\salvo-files-${filename}.nsh&quot;<br />
<br />
	SectionEnd<br />
<br />
!macroend<br />
!define Example_Files &quot;!insertmacro Example_Files&quot;And here are the files that actually hold the source files in question: tut5.c ${SetOutPath}    &quot;$INSTDIR\${SUB_DIR}\Luminary_LM3S1XX\Luminary_DK-LM3S1XX\RVMDK\Tut\Tut5&quot;<br />
${File}   &quot;${FILES_DIR}\${SUB_DIR}\&quot; &quot;Luminary_LM3S1XX\Luminary_DK-LM3S1XX\RVMDK\Tut\Tut5\tut5.c&quot;<br />
and Makefile:${SetOutPath} &quot;$INSTDIR\${SUB_DIR}&quot;<br />
<br />
; Compiler-specific Makefiles<br />
${File}   &quot;${FILES_DIR}\${SUB_DIR}\&quot; &quot;Makefile&quot;Now I see the pattern  -- those files that do work with ifnewer  have a &quot;more explicit&quot; argument to SetOutPath -- i.e. the argument is not just variables. Where the argument to SetOutPath is only variables (which is where I need ifnewer to work most desperately), ifnewer doesn't work. Can you reproduce this problem in your example with a var argument to SetOutPath?<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">14th May 2006, 06:58</div></div><div class="posttext">hmmm.. mine is still OK.  But, I'm still a a bit confused about your script.  Look at these lines of code:<br />
<br />
${SetOutPath} &quot;$INSTDIR\${SUB_DIR}&quot;<br />
<br />
; Compiler-specific Makefiles<br />
${File}   &quot;${FILES_DIR}\${SUB_DIR}\&quot; &quot;Makefile&quot;<br />
<br />
<br />
The curly braces indicate either compile-time constants (using !define) or macro parameters.  Since those lines of code are not in a macro (at least not that I can see), I assume they must be !defines.  If so, that means that &quot;${FILES_DIR}\${SUB_DIR}&quot; can only be referencing compile-time variables which cannot change at runtime.  (Did you perhaps mean to use &quot;$FILES_DIR\$SUB_DIR\&quot; instead?)<br />
<br />
I may just be missing the big picture.  Perhaps it might help if you could attach a complete example script that includes all the macros and defines.  (Sorry for not being much help.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aekalman</div><div class="date">14th May 2006, 07:18</div></div><div class="posttext">Sorry -- I should have said that the final files in my example that reference tut5.c and Makefile are the *.nsh files that are included in the Example_Files and Makefile_Files macros ... therefore they are in a macro.<br />
<br />
E.g.!include &quot;files\${sdcode}\salvo-files-${filename}.nsh&quot;means that this line in the Example_Files macro is replaced with ${SetOutPath}    &quot;$INSTDIR\${SUB_DIR}\Luminary_LM3S1XX\Luminary_DK-LM3S1XX\RVMDK\Tut\Tut5&quot;<br />
${File}   &quot;${FILES_DIR}\${SUB_DIR}\&quot; &quot;Luminary_LM3S1XX\Luminary_DK-LM3S1XX\RVMDK\Tut\Tut5\tut5.c&quot;at compile time.<br />
<br />
SUB_DIR, FILES_DIR, etc. are in fact defined constants.<br />
<br />
There are so many files involved (this NSIS installer supports a whole bunch of different configurations -- all similar in nature, just with different files, all driven by different !defines depending on what we're building) that I don't think anything I can attach will be complete. If it's incomplete but includes all the associated files, will it be of use to you?<br />
<br />
To be honest I'm not sure I fully understand the nuances of the compile-time and run-time variables. But the files are always installed to the right place, so I think my overall configuration is roughly correct. That's why I don't understand why ifnewer is failing me.<br />
<br />
Does the fact that these lines are in a macro change things / mean that I'm doing something wrong with ifnewer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aekalman</div><div class="date">14th May 2006, 07:20</div></div><div class="posttext">So the net result (at least, mu intended result) is !macro Example_Files description  ID subdir mode filename sdcode tdcode<br />
<br />
	Section &quot;${description}&quot; SEC_SALVO_${ID}_${sdcode}<br />
<br />
	SetOverwrite &quot;${mode}&quot;<br />
<br />
	${redef} SUB_DIR ${subdir}<br />
<br />
	${SetOutPath}    &quot;$INSTDIR\${SUB_DIR}\Luminary_LM3S1XX\Luminary_DK-LM3S1XX\RVMDK\Tut\Tut5&quot;<br />
        ${File}   &quot;${FILES_DIR}\${SUB_DIR}\&quot; &quot;Luminary_LM3S1XX\Luminary_DK-LM3S1XX\RVMDK\Tut\Tut5\tut5.c&quot;<br />
<br />
	SectionEnd<br />
<br />
!macroend<br />
!define Example_Files &quot;!insertmacro Example_Files&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aekalman</div><div class="date">14th May 2006, 07:24</div></div><div class="posttext">I PM'd you re the files ...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>