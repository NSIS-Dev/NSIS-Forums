<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Read util output, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Read util output NSIS Discussion" />
	
	<title> Read util output [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Read util output</div>
<hr />
<div class="pda"><a href="t-251919.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=251919">Read util output</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Kerzh</div><div class="date">25th July 2006, 17:30</div></div><div class="posttext">Hi guys.<br />
<br />
I have an external VB6 console util that make some actions return code to OS and writes to standard output.<br />
I need to run it from NSIS in async mode beacuse it updates NSIS GUI (moves progress bar and writes to log).<br />
<br />
At the end of the work i generate leave page event and come to leave callback function of my custom page. Can i get here error code and output of my util?<br />
<br />
Or write these data to file is the only solution?<br />
<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th July 2006, 17:37</div></div><div class="posttext">Try ExecDos plugin (search Wiki).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kerzh</div><div class="date">26th July 2006, 09:56</div></div><div class="posttext">ExecDos can't return util's output.<br />
<br />
Am I right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2006, 10:12</div></div><div class="posttext">Yeh, I'm afraid you are. It can only log the standard out to a text file, but from my experience that only happens when the process has finished.<br />
With nsExec, you can capture the output on the NSIS stack, but it puts all the output into one stack item (which is only 1024 characters), rather than one line per stack item.<br />
<br />
All I can suggest is that you convert your code to C/C++ and use it in a plugin, which you can run the code under a separate thread (unless you can do that in VB6).<br />
See Control\ExDll\exdll.c in the NSIS source distribution for an example.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">26th July 2006, 10:44</div></div><div class="posttext">ExecDos can put output to file, so if you need 'live' output - just add fflush(NULL) after line 195 in execDos.c and rebuild dll. Or do this on end-of-line chars (\n) only instead of every char.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kerzh</div><div class="date">26th July 2006, 11:16</div></div><div class="posttext">And after that i can pop output from nsis stack?<br />
Or log file is neccessary anyway?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">26th July 2006, 11:47</div></div><div class="posttext">The best way for you is to re-write this part of code and to add pushstring on every \n instead of WriteFile.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kerzh</div><div class="date">26th July 2006, 13:54</div></div><div class="posttext">Works fine thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2006, 13:55</div></div><div class="posttext">Ideally this could be a new feature for the DLL. It can be very useful.<br />
<br />
To prevent the opcode error (to many Pops when the stack is empty) something like this should work:<br />
<br />
Push &quot;/start&quot;<br />
# call plugin with async<br />
Pop $0 # handle<br />
<br />
Loop:<br />
Pop $1 # stack item<br />
StrCmp $1 &quot;/end&quot; Done<br />
StrCmp $1 &quot;/start&quot; 0 +4<br />
Push &quot;/start&quot;<br />
Sleep 100<br />
Goto Loop<br />
<br />
# Do somthing here with $1.<br />
<br />
Goto Loop<br />
Done:<br />
<br />
The plugin will have to put &quot;/end&quot; on the stack when the process finishes otherwise you will get an infinite loop.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kerzh</div><div class="date">26th July 2006, 17:47</div></div><div class="posttext">In my case, i put all output to the one stack item and popping it<br />
<br />
Pop $0 ; cmd result<br />
Pop $1 ; cmd output<br />
<br />
$1 can contain '\n' symbols and it semms to work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2006, 18:32</div></div><div class="posttext">Be careful with that one. If your output length exceeds 1023 characters it will be truncated. If not then you needn't worry :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">26th July 2006, 19:43</div></div><div class="posttext">OK - non empty lines go to stack with /TOSTACK option http://nsis.sourceforge.net/ExecDos_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2006, 22:41</div></div><div class="posttext">Lovely :)<br />
My code is a bit stupid. You could just Push &quot;/stop&quot; before calling the plugin and when that item is Popped you know you're done.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>