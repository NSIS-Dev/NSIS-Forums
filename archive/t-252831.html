<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Internal compiler error while compiling a script, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Internal compiler error while compiling a script NSIS Discussion" />
	
	<title> Internal compiler error while compiling a script [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Internal compiler error while compiling a script</div>
<hr />
<div class="pda"><a href="t-252831.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252831">Internal compiler error while compiling a script</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">8th August 2006, 09:56</div></div><div class="posttext">Hello,<br />
I have a problem compiling a script.<br />
When I've started the process it compresses the files but after 3 hours the following error appears:<br />
http://img145.imageshack.us/img145/9854/nsiserrorod4.jpg<br />
<br />
Perhaps somebody knows a solution.<br />
<br />
Phiffi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Truth Unknown</div><div class="date">8th August 2006, 10:11</div></div><div class="posttext">I'm also gettig this error, I've tried replacing the file it stops on.<br />
<br />
Internal compiler error #12345: error mmapping file (1967843348, 33554432) is out of range.<br />
<br />
Note: you may have one or two (large) stale temporary file(s)<br />
left in your temporary directory (Generally this only happens on Windows 9x).<br />
<br />
I'm using version 2.19 of NSIS.<br />
<br />
EDIT: Should have searched first even when this topic was on the first page. Seems NSIS cant use more than 2.0 GB of data.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">8th August 2006, 14:08</div></div><div class="posttext">Oh no. Not more than 2GB? But I have to compile 12GB!<br />
Do you know what to do in this case?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2006, 14:36</div></div><div class="posttext">You'll have to include it outside the installer in a compressed file and use ZipDLL to uncompress the file or 7za.exe from www.7-zip.org if you wish to use 7z (LZMA).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">8th August 2006, 14:54</div></div><div class="posttext">All right, I downloaded the 7z program but what do I have to do now? The script is ready. Do I have to add something to this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2006, 15:00</div></div><div class="posttext">You need to add code to extract the 7za.exe executable at run time to $PLUGINSDIR and then run it from there with nsExec::ExecToLog on your 7z file(s).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">9th August 2006, 13:28</div></div><div class="posttext">Could you please tell me which code I have to use and where to add this?<br />
Perhaps a step-by-step description for noobs.<br />
My knowledge isn't very big in scripting.<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th August 2006, 14:02</div></div><div class="posttext">Use File to extract 7za.exe to $PLUGINSDIR.<br />
Use nsExec::ExecToLog to execute 7za.exe under a Section with the correct parameters to extract the files from the 7z file.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">9th August 2006, 17:59</div></div><div class="posttext">Well, the only exe-Files I have are 7z.exe; 7zFM.exe and 7zG.exe.<br />
And where do I have to use &quot;File&quot;? Do you mean the &quot;File&quot; in MakeNSISW? http://img456.imageshack.us/img456/6386/filedr2.jpg<br />
I don't know which program to use for this operation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th August 2006, 18:01</div></div><div class="posttext">7za.exe is the standalone command-line version of 7-Zip, which you can download from the website.<br />
<br />
You have written some NSIS code haven't you?<br />
I mean File as in the NSIS instruction?<br />
Look at the NSIS manual!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">9th August 2006, 18:53</div></div><div class="posttext">I found the file command:<br />
File /oname=$PLUGINSDIR\7za.exe 7za.exe<br />
Is this correct?<br />
But I don't know which parameters I have to use for the plugin.<br />
nsExec::ExecToLog '&quot;${NSISDIR}\7za.exe&quot; /CMDHELP'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">10th August 2006, 05:54</div></div><div class="posttext">Once you extract the file using the file command, then you launch it with nsEXEC.  The purpose of nsEXEC is to run a command-line program, but redirect its output so that you don't see the ugly command window appear.<br />
<br />
My suggestion would be to experiment with 7za to determine the proper parameters you'll need.  Once you've determined that, then run the same command using nsEXEC.  The command should look something like this:<br />
<br />
nsExec::ExecToLog /OEM '&quot;$PLUGINSDIR\7za.exe&quot; [-options]'<br />
<br />
The [-options] part is the command line options you need.  (If you are having problems with this, you should consult your 7-zip help manual or try browsing the 7-zip SourceForge Project Site (http://sourceforge.net/projects/sevenzip/))  Just don't forget to include any paths in quotes (as shown above and for any folder paths you might need to include as parameters.)<br />
<br />
Also, it would be extremely helpful for you too to take the time to lean NSIS a bit better.  There's plenty of documentation in the NSIS help (as Afrow suggests) plus more examples/documentation in the NSIS directories.  Plus, you can also use the search option of this forum.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">10th August 2006, 10:20</div></div><div class="posttext">I searched the 7z help and found the command to extract an archive.<br />
nsExec::ExecToLog /OEM '&quot;$PLUGINSDIR\7za.exe&quot; [-e]'<br />
But how do I proceed.<br />
In the script I created multiple sections to be later able to choice what to install but now I have to use 7z archives instead of the files is that right?<br />
<br />
My script looks like that:<br />
Section &quot;Half-Life 2 (erforderlich)&quot; SEC01<br />
  SetOutPath &quot;$INSTDIR\bin&quot;<br />
  SetOverwrite try<br />
  File &quot;NEUER ORDNER\bin\AdminServer.dll&quot;<br />
  File &quot;NEUER ORDNER\bin\bsppack.dll&quot;<br />
<br />
I have to pack all files in one archive and add this in the script, right?:<br />
Section &quot;Half-Life 2 (erforderlich)&quot; SEC01<br />
  SetOutPath &quot;$INSTDIR\bin&quot;<br />
  SetOverwrite try<br />
  File /oname=$PLUGINSDIR\7za.exe<br />
  nsExec::ExecToLog /OEM '&quot;$PLUGINSDIR\7za.exe&quot; [7za &lt;a&gt; [&lt;-m{LZMA}&gt;] &lt;Half-Life2.7z&gt; [&lt;file_names&gt;...]'<br />
<br />
I used -m{LZMA} for compression method LZMA and the parameter &lt;a&gt; to add files to an archive. But I don't know if I can add a complete directory on &lt;file_names&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2006, 10:39</div></div><div class="posttext">You don't actually put &lt; or &gt; in there!<br />
Open up the 7-Zip manual in the Start menu and it has complete details about the command line version (mine does anyway).<br />
<br />
Why are you adding files to the archive? You're meant to be extracting them! I think you've got the wrong end of the stick. You compress your files into a 7z file with 7-Zip, include that file with your installer and extract it at run time to $INSTDIR with 7za. Remember, this code is executed at run time when the user runs the installer, not when you compile the installer.<br />
<br />
The -m switch does not set the type of compression. -t does that. You don't actually need -t though, because 7za will detect the archive type for you.<br />
<br />
nsExec::ExecToLog /OEM '&quot;$PLUGINSDIR\7za.exe&quot; x &quot;$EXEDIR\Half-Life2.7z&quot; -o&quot;$INSTDIR&quot;'<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">10th August 2006, 12:12</div></div><div class="posttext">Ok, I think I get it now.<br />
I have to compile the archive with these commands:<br />
<br />
Section &quot;Half-Life 2 (erforderlich)&quot; SEC01<br />
SetOutPath &quot;$INSTDIR&quot;<br />
SetOverwrite try<br />
File &quot;7za.exe&quot;<br />
File &quot;Half-Life2.7z&quot;<br />
nsExec::ExecToLog /OEM '&quot;$PLUGINSDIR\7za.exe&quot; x &quot;$EXEDIR\Half-Life2.7z&quot; -o&quot;$INSTDIR&quot;'<br />
<br />
Remember, this code is executed at run time when the user runs the installer, not when you compile the installer. <br />
Means this line &quot;nsExec::ExecToLog...&quot; mustn't stand in the script? <br />
<br />
Thank you for your patience describing these things to me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2006, 12:59</div></div><div class="posttext">You can't have<br />
File &quot;Half-Life2.7z&quot;<br />
in there, because you said it's 12GB. NSIS installers can't be over 2GB.<br />
<br />
No, it doesn't. nsExec::ExecToLog is a run time instruction. Compile time instructions begin with a !<br />
My point was that your code would create the 7z archive at run time, when you want to extract from it.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">10th August 2006, 13:26</div></div><div class="posttext">The files in Half-Life2.7z are just a part of the whole installation and their size is 3.1 GB uncomprimized. Therefore I have to comprimize it with 7zip that the file is smaller than 2 GB. But does it matter that the whole installation-exe would be bigger than 2 GB or one file mustn't be bigger than 2 GB?<br />
<br />
How can I add the run time instruction to the script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2006, 13:54</div></div><div class="posttext">Anything within Sections or Functions are executed at run time.<br />
The NSIS installer executable can't be over 2GB. I'm not sure if the files that can be compressed into the installer need to be under 2GB as well.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">10th August 2006, 14:10</div></div><div class="posttext">That means I can't add any files into the exe because it would become too big but I can add the install-exe and the 7z files in one folder and tell the install-exe to unpack the 7z files into the install directory with this commands:<br />
<br />
Section &quot;Half-Life 2 (erforderlich)&quot; SEC01<br />
SetOutPath &quot;$INSTDIR&quot;<br />
SetOverwrite try<br />
File &quot;7za.exe&quot;<br />
nsExec::ExecToLog /OEM '&quot;$PLUGINSDIR\7za.exe&quot; x &quot;$EXEDIR\Half-Life2.7z&quot; -o&quot;$INSTDIR&quot;'<br />
<br />
But is it okay if I just add the 7za.exe to the install-exe. I mean the users of this installer doesn't have 7za.exe or NSIS.<br />
Perhaps I just change the path of 7za.exe into:<br />
<br />
nsExec::ExecToLog /OEM '&quot;$INSTDIR\7za.exe&quot; x &quot;$EXEDIR\Half-Life2.7z&quot; -o&quot;$INSTDIR&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2006, 14:15</div></div><div class="posttext">It'd be better to just extract 7za.exe to $PLUGINSDIR because $PLUGINSDIR is deleted when the installer is closed. Plus, 7za.exe is 300+ KB so you might as well compress it. Make sure you have &quot;SetCompressor /solid lzma&quot; in your script.<br />
<br />
By the way, $PLUGINSDIR isn't the NSIS\Plugins folder! It's a temporary folder created at run time in $TEMP.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">10th August 2006, 14:28</div></div><div class="posttext">The right decision would be:<br />
<br />
SetOutPath &quot;$PLUGINSDIR&quot;<br />
SetOverwrite try<br />
File &quot;7za.exe&quot;<br />
nsExec::ExecToLog /OEM '&quot;$PLUGINSDIR\7za.exe&quot; x &quot;$EXEDIR\Half-Life2.7z&quot; -o&quot;$INSTDIR&quot;'<br />
<br />
Okay?<br />
<br />
Another problem: How can I add icons to my shortcuts?<br />
<br />
  CreateShortCut &quot;$SMPROGRAMS\Half-Life 2.lnk&quot; &quot;$INSTDIR\Half-Life 2.bat&quot;<br />
  CreateShortCut &quot;$DESKTOP\Half-Life 2.lnk&quot; &quot;$INSTDIR\Half-Life 2.bat&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2006, 14:30</div></div><div class="posttext">Yes.<br />
Just make sure you put InitPluginsDir before SetOutPath just in case $PLUGINSDIR has not yet been created.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th August 2006, 14:31</div></div><div class="posttext">See CreateShortcut in the manual.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">14th August 2006, 02:02</div></div><div class="posttext">Like this:<br />
<br />
CreateShortCut &quot;$SMPROGRAMS\Half-Life 2.lnk&quot; &quot;$INSTDIR\Half-Life 2.bat&quot; &quot;&quot; &quot;$INSTDIR\youricon.ico&quot;<br />
CreateShortCut &quot;$DESKTOP\Half-Life 2.lnk&quot; &quot;$INSTDIR\Half-Life 2.bat&quot; &quot;&quot; &quot;$INSTDIR\yourprog.exe&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Phiffi</div><div class="date">14th August 2006, 12:17</div></div><div class="posttext">Thank you all for your great help.<br />
The installer-exe runs perfectly and the icons for the shortcuts too!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>