<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Path, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Path NSIS Discussion" />
	
	<title> Path [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Path</div>
<hr />
<div class="pda"><a href="t-335716.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335716">Path</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sethradio</div><div class="date">7th October 2011, 23:14</div></div><div class="posttext">How do you make an NSIS installer ad the installation directory to the Windows PATH environment variable?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">7th October 2011, 23:19</div></div><div class="posttext">The default environment variables for the current user are stored at:<br />
HKEY_CURRENT_USER\Environment<br />
<br />
For the system (all users) they are stored at:<br />
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment<br />
<br />
You can use NSIS' registry functions to read the current value of &quot;PATH&quot;, add your directory to it and write the new value back.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sethradio</div><div class="date">8th October 2011, 23:11</div></div><div class="posttext">Could you show me some example code please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">9th October 2011, 01:56</div></div><div class="posttext">You should start here:<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2<br />
<br />
Maybe try like this:<br />
ReadRegStr $0 HKCU &quot;Environment&quot; &quot;Path&quot;         #read current PATH into $0<br />
StrCpy $0 &quot;C:\SomePath;$0&quot;                      #prepend your path to the current PATH value<br />
WriteRegStr HKCU &quot;Environment&quot; &quot;Path&quot; '$0'      #write back the new PATH<br />
<br />
(Note that the new PATH may become effective only after a reboot)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sethradio</div><div class="date">11th October 2011, 20:01</div></div><div class="posttext">Thanks!! You really are a major dude!!:D I didn't know environment variables were stored in the registry. I need to read up on the registry documentation in the NSIS users manual.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th October 2011, 20:09</div></div><div class="posttext">This is not a good idea:<br />
<br />
A) Why fill the global path with your crap, there is a total limit, what if all apps did this? It is possible to add per application path info in the registry under &quot;App Paths&quot;<br />
<br />
B) Using normal NSIS strings to manipulate global variables is a very bad idea, if the user has a %path% longer than 1024 you will corrupt their setup!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sethradio</div><div class="date">11th October 2011, 22:56</div></div><div class="posttext">I will only use this if I am writing a command line tool. This allows users of a program to not have to type the full path to the executable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">11th October 2011, 23:03</div></div><div class="posttext">I will only use this if I am writing a command line tool. This allows users of a program to not have to type the full path to the executable.<br />
<br />
You should at least ask the user whether he wants your tool to be added to his PATH.<br />
<br />
As an alternative you can add a shortcut to the Startmenu that opens a console with your tool added to the PATH, instead of adding your tool to the PATH globally. Many applications, like Visual Studio or GIT, use this technique.<br />
<br />
The command for the Startmenu shortcut could be something like:<br />
%comspec% /k &quot;&quot;$INSTDIR\setpath.bat&quot;&quot;<br />
<br />
And the &quot;setpath.bat&quot; could be created on-the-fly by the installer and should look like:<br />
@echo off<br />
echo Setting up environment for Super Duper Tool...<br />
set &quot;PATH=C:\Path To Your Tool;%PATH%&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sethradio</div><div class="date">16th November 2011, 03:34</div></div><div class="posttext">How do I remove the install path from the environment variable in the uninstaller?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">16th November 2011, 12:01</div></div><div class="posttext">Option 1:<br />
Backup the &quot;old&quot; path at install time. Restore it at un-install time. Chnages that have been made since install will be lost!<br />
<br />
Option 2:<br />
Read the current PATH at un-install time and use string functions to find &quot;your&quot; path in the current PATH. If found, remove only that part and write the modified PATH back. Harder to do than Option 1, but no changes made by other apps will  be lost. However this solution again has the problem that &quot;standard&quot; NSIS can not cope with strings longer than 1024 characters!<br />
<br />
Option 3:<br />
Avoid  modifying the global PATH environment variable from the very beginning, as has been suggested before in this thread. No problem with un-install and no NSIS string limitations. Probably the cleanest solution that you can go for...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sethradio</div><div class="date">22nd November 2011, 01:00</div></div><div class="posttext">I know I shouldn't use nsis string functions to edit the pah variable at this point. But for the sake of it, how could you use string function to find the install path?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">22nd November 2011, 10:42</div></div><div class="posttext">I know I shouldn't use nsis string functions to edit the pah variable at this point. But for the sake of it, how could you use string function to find the install path?<br />
<br />
You don't have to.<br />
<br />
At install time, simply save your $INSTDIR to some (unique) registry key of your own.<br />
<br />
At un-install time, read that registry key. No string manipulations will be required.<br />
<br />
And, as on Windows the MAX_PATH is 260, the 1024 characters of an NISIS string are sufficient - for a single path.<br />
<br />
(Actually the uninstaller will already have $INSTDIR set to the path it was started from)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>