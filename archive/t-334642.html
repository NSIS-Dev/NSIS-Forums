<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Get return-statement of a executed batch., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Get return-statement of a executed batch. NSIS Discussion" />
	
	<title> Get return-statement of a executed batch. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Get return-statement of a executed batch.</div>
<hr />
<div class="pda"><a href="t-334642.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=334642">Get return-statement of a executed batch.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fyaa</div><div class="date">11th September 2011, 20:19</div></div><div class="posttext">Hello,<br />
<br />
I'm relatively new to working with the NSIS Installer. Most features are easy to handle and I get a success, but there is one thing which I didn't get a solution for.. I've been trying since yesterday morning, so hopefully you can help me with it ;).<br />
<br />
After installing files to the install-directory, I have to start a Batch-file with parameters to do some operations.<br />
So I do either<br />
<br />
ExpandEnvStrings $0 %COMSPEC%<br />
ExecWait '&quot;$0&quot; /C &quot;$SOMEDIRECTORY\my.bat&quot; &quot;quotedparameter&quot; parameter2 parameter3' $0<br />
MessageBox MB_OK &quot;Exit code $0&quot;<br />
<br />
or<br />
<br />
ExpandEnvStrings $0 %COMSPEC%<br />
ExecDos::exec '&quot;$0&quot; /C &quot;$SOMEDIRECTORY\my.bat&quot; &quot;quotedparameter&quot; parameter2 parameter3' '' &quot;$EXEDIR\stdout.txt&quot;<br />
Pop $0<br />
MessageBox MB_OK &quot;Exit code $0&quot;<br />
<br />
<br />
..but nothing works like I supposed.<br />
With option 1 I get a 1 whatever I do on input.<br />
With option 2 I get always a -.<br />
<br />
When I start the batch exclusively, it returns either &quot;OK&quot; or &quot;ERROR&quot;.<br />
This &quot;State&quot; I have to return to my NSIS installer. Depending on it the Installer will throw an Error in a MessageBox or continue.<br />
<br />
So, how am I supposed to do this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th September 2011, 20:33</div></div><div class="posttext">Batch file exit codes are problematic. Are you using exit %somenumber% in your batch file?<br />
<br />
ExecWait uses the exit code for the comspec process (Internally cmd.exe will call ExitProcess() with some number and that is the number you get)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">12th September 2011, 07:42</div></div><div class="posttext">Please post your .bat file - or at least the most important part of it - that one which returns OK or ERROR. Use pastebin for this purpose :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th September 2011, 10:20</div></div><div class="posttext">You may be better off just translating the batch file into NSIS code.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fyaa</div><div class="date">12th September 2011, 20:08</div></div><div class="posttext">Hello again,<br />
<br />
thanks for your anwsers.<br />
It would be easier if I could modify the batch-filem but it's a batch file from an oracle database, so I can't modify it.<br />
As an input I give this batch an tcl-file so that I can put an output like &quot;OK&quot;, &quot;ERROR&quot; or something else.<br />
<br />
Maybe I can encapsulate this propriate batch-file with a custom one and throw some error level depending on the output of the .. batch-file.<br />
<br />
Like:<br />
<br />
Call path/to/batch.bat tclskript.tcl input1 input2.. or write this output to a variable?..<br />
if %variable% == &quot;OK&quot; (<br />
  Exit /B 1<br />
) else (<br />
 Exit /B 0<br />
)<br />
<br />
.. or something like this.<br />
<br />
But I'm neither experienced in batch-programming nor in NSIS-scripting/programming.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fyaa</div><div class="date">15th September 2011, 10:58</div></div><div class="posttext">Well it works now:<br />
<br />
Just use:<br />
<br />
<br />
FileOpen $0 &quot;$TEMP\test.bat&quot; w<br />
FileWrite $0 &quot;SET OUTPUT=$\n&quot;<br />
FileWrite $0 &quot;FOR /F $\&quot;tokens=*$\&quot; %%R IN ('$\&quot;PATH\TO\my.bat$\&quot;') DO SET OUTPUT=%%R$\n&quot;<br />
FileWrite $0 &quot;IF %OUTPUT%==OK ($\n&quot;<br />
FileWrite $0 &quot;  exit /B 1$\n&quot;<br />
FileWrite $0 &quot;) ELSE ($\n&quot;<br />
FileWrite $0 &quot;  exit /B 0$\n&quot;<br />
FileWrite $0 &quot;)$\n&quot;<br />
FileClose $0<br />
<br />
<br />
With:<br />
<br />
ExpandEnvStrings $0 %COMSPEC%<br />
ExecDos::exec /NOUNLOAD /ASYNC '&quot;$0&quot; /C &quot;$TEMP\test.bat&quot;'<br />
Pop $0<br />
ExecDos::wait $0<br />
Pop $0<br />
<br />
you have the errorcode in $0. So it's in this example either 1 oder 0 and you can react on it using ${if}.<br />
<br />
:)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>