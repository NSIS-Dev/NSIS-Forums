<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Odd AccessControl error, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Odd AccessControl error NSIS Discussion" />
	
	<title> Odd AccessControl error [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Odd AccessControl error</div>
<hr />
<div class="pda"><a href="t-288367.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288367">Odd AccessControl error</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">12th March 2008, 13:38</div></div><div class="posttext">I'm using the AccessControl plugin to set the rights on a data directory set up by my installer. The directory is freshly-created and known to exist, so the user running install will be its &quot;CREATOR OWNER&quot; and should have authority to set the access.<br />
<br />
However, I'm occasionally -- not always, but I haven't spotted a trend -- getting error &quot;22&quot; returned. Looking at the source for the plugin I see that errors are usually textual, and that &quot;22&quot; doesn't seem to be one of them!<br />
<br />
Here's the code snippet:<br />
<br />
    ; create the data directory<br />
    ClearErrors<br />
    CreateDirectory &quot;$MBDir&quot;<br />
<br />
    ${If} ${Errors}<br />
      Abort &quot;Can't create MessageBase directory $MBDir&quot;<br />
    ${EndIf}<br />
<br />
    ; Set access permissions on $MBDir -- read write accessible by all users<br />
    ; We have to use &quot;(S-1-1-0)&quot; instead of &quot;World&quot; or &quot;(WD)&quot; for Win2k<br />
    ClearErrors<br />
    AccessControl::GrantOnFile &quot;$MBDir&quot; &quot;(S-1-1-0)&quot; &quot;GenericRead + GenericWrite + DeleteChild&quot;<br />
    pop $0<br />
<br />
    ${If} $0 != &quot;&quot;<br />
       MessageBox MB_OK &quot;Error $0 granting access to $MBDir &quot;<br />
    ${EndIf}<br />
<br />
The message I'm getting in the message box is typically something like &quot;Error 22 granting access to E:\MyApp\Data &quot;. The directory name is correct, and the directory has been created.<br />
<br />
Can anyone tell me what this actually means? I take it I am calling the plugin correctly, and that GrantOnFile is meant to be usable on directories as well as normal files?<br />
<br />
The Windows error code 22 is ERROR_BAD_COMMAND which is documented as meaning &quot;The device does not recognize the command&quot;. I believe that's normally returned by IOCtl-type calls to devices, and not by access control APIs.<br />
<br />
I'm testing this on XP64, BTW, but it's intended to be usable on all NT-class systems.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th March 2008, 11:26</div></div><div class="posttext">AccessControl does not push anything to the stack if there were no errors. Therefore your value in $0 is coming from a stack item that was already on the stack before you called the plug-in.<br />
<br />
I will change this in the next version.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">13th March 2008, 16:05</div></div><div class="posttext">Originally posted by Afrow UK <br />
AccessControl does not push anything to the stack if there were no errors. Therefore your value in $0 is coming from a stack item that was already on the stack before you called the plug-in.<br />
<br />
I will change this in the next version.<br />
<br />
OK, thanks, Stu ... that makes sense.<br />
<br />
What's the best workaround? Is there any other indication of an error -- way to tell whether anything has been pushed onto the stack -- apart from calling pop?<br />
<br />
I could do something like:<br />
<br />
ClearErrors<br />
Push &quot;OK&quot;<br />
AccessControl::GrantOnFile &quot;$MBDir&quot; &quot;(S-1-1-0)&quot; &quot;GenericRead + GenericWrite + DeleteChild&quot;<br />
pop $0<br />
<br />
${If} $0 != &quot;OK&quot;<br />
   MessageBox MB_OK &quot;Error $0 granting access to $MBDir &quot;<br />
   pop $0   ; remove the &quot;OK&quot;<br />
${EndIf}<br />
<br />
Can you think of anything better?<br />
<br />
Cheers,<br />
 Daniel.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th March 2008, 18:23</div></div><div class="posttext">That is what I was doing until I decided to start updating the plug-in myself.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>