<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Override &lt;Cancel&gt; button action?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Override &lt;Cancel&gt; button action? NSIS Discussion" />
	
	<title> Override &lt;Cancel&gt; button action? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Override &lt;Cancel&gt; button action?</div>
<hr />
<div class="pda"><a href="t-268158.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268158">Override &lt;Cancel&gt; button action?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">21st March 2007, 19:09</div></div><div class="posttext">Hi all,<br />
<br />
There *has* to be a thread that has this already, but for the life of me, I cannot find it!<br />
<br />
What I want to do, is change the &lt;Cancel&gt; button to be &lt;Skip&gt; instead.<br />
<br />
I was able to change the text of the button just fine.<br />
<br />
But I am unable to figure out how to get the *action* of the button to not act like &lt;Cancel&gt; but instead to act like something else, or to call a special function instead...<br />
<br />
I even tried tossing in a hook into &quot;.onUserAbort&quot;, which kinda works, but not really.<br />
I suspect there is a much easier way to do this, but I just cannot figure it out...<br />
<br />
Any thoughts? Suggestions?<br />
<br />
Thanks!<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st March 2007, 19:25</div></div><div class="posttext">Post a sample code where &quot;.onUserAbort&quot; does not work as you expect it to do.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">21st March 2007, 19:37</div></div><div class="posttext">Hi Red Wine,<br />
<br />
Okay.<br />
I am using UMUI, which allows me to define a custom function for abort.<br />
(I suspect MUI does too)<br />
<br />
I do:<br />
!define MUI_CUSTOMFUNCTION_ABORT &quot;CustomAbort&quot;<br />
<br />
The function I use is:<br />
<br />
Function CustomAbort<br />
   ${If} &quot;$CANCEL_IS_REALLY_SKIP&quot; == &quot;1&quot;<br />
      Abort<br />
   ${Endif}<br />
<br />
   ${If} &quot;$CANCEL_IS_REALLY_SKIP&quot; != &quot;1&quot;<br />
      !ifdef MUI_FINISHPAGE_ABORTWARNINGCHECK<br />
        StrCmp $MUI_NOABORTWARNING &quot;1&quot; mui.quit<br />
      !endif<br />
<br />
     MessageBox MB_YESNO|MB_ICONEXCLAMATION &quot;Are you sure you want to quit ${APP_NAME}?&quot; IDYES mui.quit<br />
<br />
      Abort<br />
      mui.quit:<br />
    ${Endif}<br />
FunctionEnd<br />
<br />
<br />
I have 2 problems with doing this...<br />
<br />
1) &quot;Abort&quot; just returns without bailing. I need it to either call my &quot;Show&quot; or &quot;Leave&quot; function for that InstallOption/custom page.<br />
This would allow me to &quot;skip&quot; over the current page, if needed.<br />
If I do nothing in there, the Installer quits with no message, which I guess we should expect.<br />
<br />
2) The harder part.<br />
I need to keep track whether the page they are on wants the &quot;cancel&quot; to act like a real &lt;Cancel&gt; button or it should act like a &lt;Skip&gt; button...<br />
<br />
Or maybe this can be solved by doing a GETTEXT off the button when in my custom abort function?<br />
<br />
Thanks!<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st March 2007, 19:57</div></div><div class="posttext">I don't understand sorry...<br />
Is it a custom page the page you want to skip?<br />
If so things are easier, because after the plugin call you pop from stack &quot;back&quot; &quot;cancel&quot; or &quot;success&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">21st March 2007, 20:09</div></div><div class="posttext">Hi Red Wine,<br />
<br />
Yes this is all in a custom page (using InstallOptions).<br />
<br />
I just now added a lame check in my &quot;CustomAbort&quot; function to see if the &lt;Cancel&gt; button has text &quot;cancel&quot; or &quot;Skip &gt;&quot;<br />
<br />
By doing this:<br />
<br />
    GetDlgItem $1 $HWNDPARENT 2<br />
    StrCpy $4 &quot;&quot;<br />
    System::Call &quot;user32::SendMessage(i,i,i,i)i (r1,${WM_GETTEXT}, 10,t.r3).r4&quot;<br />
<br />
    ${If} &quot;$3&quot; == &quot;Skip &gt;&quot;<br />
        Abort<br />
    ${Endif}<br />
<br />
<br />
This works.<br />
<br />
So now when I click on &quot;Skip &gt;&quot; (ie, the &lt;Cancel&gt; button renamed), my script does that &quot;Abort&quot; above.<br />
This is good.<br />
<br />
Now, how do I notify the &quot;custom&quot; page that the user pressed &lt;Skip&gt; ?<br />
We return an &quot;Abort&quot;, but how do I get this?<br />
If I return an &quot;Abort&quot;, does my &quot;Leave&quot; custom function get called?<br />
<br />
Thanks again for your quick responses!<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st March 2007, 20:24</div></div><div class="posttext">You don't really need this:<br />
GetDlgItem $1 $HWNDPARENT 2<br />
StrCpy $4 &quot;&quot;<br />
System::Call &quot;user32::SendMessage(i,i,i,i)i (r1,${WM_GETTEXT}, 10,t.r3).r4&quot;<br />
<br />
${If} &quot;$3&quot; == &quot;Skip &gt;&quot;<br />
Abort<br />
${Endif}<br />
Actually it's the custom page who notifies you which button is pressed, try this:<br />
InstallOptions::Dialog &quot;$PLUGINSDIR\custom.ini&quot;<br />
pop $0<br />
messagebox mb_ok &quot;$0&quot;<br />
Also review the documentation would be a good idea. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">21st March 2007, 20:34</div></div><div class="posttext">Hi Red Wine,<br />
<br />
I think I am not describing the situation right. =)<br />
<br />
In my Installer, I need the &lt;cancel&gt; button to sometimes act like a real &quot;cancel&quot; button, ie, bail out of the Installer.<br />
<br />
But there are a couple &quot;custom&quot; pages where I need to override the &lt;cancel&gt; button, and its actions.<br />
<br />
Since the &lt;Cancel&gt; button seems to be a &quot;global&quot; thing, where if the user presses it, it always calls the global<br />
&quot;onUserAbort&quot; function.<br />
<br />
Because of this, I need to determine whether the current &quot;cancel&quot; button is really &lt;Cancel&gt;, or is overridden with a &lt;Skip&gt; instead.<br />
<br />
If its a &lt;Cancel&gt;, It should bail like it normally should.<br />
However, if its a &lt;Skip&gt;, I need to *not* bail, but instead, do some custom stuff, and then skip to the next page. (ie, almost like they pressed &lt;Next&gt;).<br />
<br />
I am able to trap the &lt;Skip&gt; in the global &quot;onUserAbort&quot; function, and instead of doing an &quot;Abort&quot;, I now do a &quot;Return&quot;.<br />
<br />
This allows me to do the Pop after the SHOW like you suggest, and I get &quot;cancel&quot;.<br />
<br />
This is good.<br />
<br />
But it seems like no matter what I do after this Pop,<br />
the Installer always wants to quit!<br />
I don't want it to quit, but instead, shift to the next dialog...<br />
(ie, it should act like the user pressed &lt;Next&gt;)<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st March 2007, 20:52</div></div><div class="posttext">I got it now, the plugin return won't help because is called after the function .onuserabort, but this seems to work<br />
!define CUST_INI &quot;$PLUGINSDIR\custom.ini&quot;<br />
<br />
var page_id<br />
<br />
InstallDir &quot;$EXEDIR&quot;<br />
outfile 'test.exe'<br />
<br />
page custom CreateCustom LeaveCustom<br />
page components <br />
page directory<br />
page instfiles<br />
<br />
section boo<br />
<br />
sectionend<br />
<br />
Function .onInit<br />
InitPluginsDir<br />
WriteINIStr &quot;${CUST_INI}&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;1&quot;<br />
WriteINIStr &quot;${CUST_INI}&quot; &quot;field 1&quot; &quot;type&quot; &quot;text&quot;<br />
WriteINIStr &quot;${CUST_INI}&quot; &quot;field 1&quot; &quot;left&quot; &quot;50&quot;<br />
WriteINIStr &quot;${CUST_INI}&quot; &quot;field 1&quot; &quot;right&quot; &quot;-50&quot;<br />
WriteINIStr &quot;${CUST_INI}&quot; &quot;field 1&quot; &quot;top&quot; &quot;40&quot;<br />
WriteINIStr &quot;${CUST_INI}&quot; &quot;field 1&quot; &quot;bottom&quot; &quot;52&quot;<br />
WriteINIStr &quot;${CUST_INI}&quot; &quot;field 1&quot; &quot;state&quot; &quot;sample text&quot;<br />
FunctionEnd<br />
<br />
Function CreateCustom<br />
StrCpy $page_id &quot;custom&quot;<br />
push $0<br />
InstallOptions::Dialog &quot;${CUST_INI}&quot;<br />
pop $0<br />
pop $0<br />
FunctionEnd<br />
<br />
function LeaveCustom<br />
StrCpy $page_id &quot;&quot;<br />
functionend<br />
<br />
function .onuserabort<br />
StrCmp $page_id &quot;custom&quot; 0 end<br />
SendMessage $HWNDPARENT &quot;0x408&quot; &quot;1&quot; &quot;&quot;<br />
abort<br />
end:<br />
functionend<br />
Also take a look here,<br />
<br />
http://nsis.sourceforge.net/Go_to_a_NSIS_page</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">21st March 2007, 21:07</div></div><div class="posttext">Bingo!<br />
<br />
That is *exactly* what I was looking for.<br />
That URL is perfect!<br />
It works exactly like I wanted it to.<br />
<br />
Thanks again!<br />
Scott</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>