<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help with my custom page (droplist), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help with my custom page (droplist) NSIS Discussion" />
	
	<title> Need help with my custom page (droplist) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help with my custom page (droplist)</div>
<hr />
<div class="pda"><a href="t-259279.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259279">Need help with my custom page (droplist)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">10th November 2006, 16:26</div></div><div class="posttext">Hi,<br />
I've created a custom page.<br />
<br />
http://cs-erweiterungen.de/Picture.jpg<br />
<br />
On the custom page the user can insert his steam ID/IP or a name. When he has insert his steam ID/IP or name he must choose which type it is.<br />
<br />
It's for define an Admin. One can define 3 Admins. <br />
<br />
The first &quot;admin code&quot; works fine but I've a problem with the 2 others.. when one choose the type of Admin in the droplist it isn't work. In the &quot;users.ini&quot; file are further the words Flag1 or Flag2.<br />
<br />
Could you help me?<br />
<br />
; Password Page<br />
Function Steam_IDPage<br />
!insertmacro SectionFlagIsSet ${Section2} ${SF_SELECTED} ShowPage SkipPage<br />
ShowPage:<br />
<br />
GetDlgItem $R0 $HWNDPARENT 2<br />
EnableWindow $R0 0|1 # 0=hide, 1=show<br />
GetDlgItem $R0 $HWNDPARENT 3<br />
EnableWindow $R0 0|1 # 0=hide, 1=show<br />
!insertmacro MUI_HEADER_TEXT &quot;Konfiguration des Erweiterungs System&quot; &quot;Tragen Sie die Administratoren ein.&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;steam_id.ini&quot;<br />
<br />
SkipPage:<br />
<br />
FunctionEnd<br />
<br />
Function .OnGUIEnd<br />
Call CopyFlag<br />
FunctionEnd<br />
<br />
; Copy Flag<br />
!macro REPLACE_FLAG1 SOURCE<br />
<br />
Push &quot;Flag1&quot;             #-- text to be replaced  within the &quot; &quot;<br />
Push &quot;${SOURCE}&quot;             #-- replace with anything within the &quot; &quot;<br />
Push all                      #-- replace all occurrences <br />
Push all                      #-- replace all occurrences <br />
Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in <br />
Call AdvReplaceInFile         #-- Call the Function<br />
<br />
goto done3<br />
!macroend<br />
<br />
; Copy Flag<br />
!macro REPLACE_FLAG2 SOURCE<br />
<br />
Push &quot;Flag2&quot;             #-- text to be replaced  within the &quot; &quot;<br />
Push &quot;${SOURCE}&quot;             #-- replace with anything within the &quot; &quot;<br />
Push all                      #-- replace all occurrences <br />
Push all                      #-- replace all occurrences <br />
Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in <br />
Call AdvReplaceInFile         #-- Call the Function<br />
<br />
goto done3<br />
!macroend<br />
<br />
; Copy Flag<br />
!macro REPLACE_FLAG3 SOURCE<br />
<br />
Push &quot;Flag3&quot;             #-- text to be replaced  within the &quot; &quot;<br />
Push &quot;${SOURCE}&quot;             #-- replace with anything within the &quot; &quot;<br />
Push all                      #-- replace all occurrences <br />
Push all                      #-- replace all occurrences <br />
Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in <br />
Call AdvReplaceInFile         #-- Call the Function<br />
<br />
goto done3<br />
!macroend<br />
<br />
; Copy Flag<br />
Function CopyFlag<br />
<br />
;1<br />
Push $R0<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\steam_id.ini&quot; &quot;Field 12&quot; &quot;State&quot;<br />
<br />
StrCmp $R0 &quot;Steam ID&quot; 0 notSteamID1<br />
!insertmacro REPLACE_FLAG1 ce<br />
notSteamID1:<br />
<br />
StrCmp $R0 &quot;IP&quot; 0 notIP1<br />
!insertmacro REPLACE_FLAG1 de<br />
notIP1:<br />
<br />
StrCmp $R0 &quot;Name&quot; 0 done1<br />
!insertmacro REPLACE_FLAG1 be<br />
done1:<br />
<br />
;2<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\steam_id.ini&quot; &quot;Field 13&quot; &quot;State&quot;<br />
<br />
StrCmp $R0 &quot;Steam ID&quot; 0 notSteamID2<br />
!insertmacro REPLACE_FLAG2 ce<br />
notSteamID2:<br />
<br />
StrCmp $R0 &quot;IP&quot; 0 notIP2<br />
!insertmacro REPLACE_FLAG2 de<br />
notIP2:<br />
<br />
StrCmp $R0 &quot;Name&quot; 0 done2<br />
!insertmacro REPLACE_FLAG2 be<br />
done2:<br />
<br />
;3<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\steam_id.ini&quot; &quot;Field 14&quot; &quot;State&quot;<br />
<br />
StrCmp $R0 &quot;Steam ID&quot; 0 notSteamID3<br />
!insertmacro REPLACE_FLAG3 ce<br />
notSteamID3:<br />
<br />
StrCmp $R0 &quot;IP&quot; 0 notIP3<br />
!insertmacro REPLACE_FLAG3 de<br />
notIP3:<br />
<br />
StrCmp $R0 &quot;Name&quot; 0 done3<br />
!insertmacro REPLACE_FLAG3 be<br />
done3:<br />
<br />
Pop $R0<br />
FunctionEnd<br />
<br />
LangString NoSteam_ID ${LANG_GERMAN} &quot;Bitte geben Sie eine Steam_ID ein!&quot;<br />
<br />
; Page Leave Feautures<br />
Function PageLeaveSteam_ID<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $R0 &quot;steam_id.ini&quot; &quot;Field 7&quot; &quot;State&quot;<br />
${If} $R0 != &quot;&quot;<br />
Push &quot;steamid1&quot;             #-- text to be replaced  within the &quot; &quot;<br />
Push &quot;$R0&quot;                    #-- replace with anything within the &quot; &quot;<br />
Push all                      #-- replace all occurrences<br />
Push all                      #-- replace all occurrences<br />
Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in<br />
Call AdvReplaceInFile         #-- Call the Function<br />
${EndIf}<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $R0 &quot;steam_id.ini&quot; &quot;Field 8&quot; &quot;State&quot;<br />
${If} $R0 != &quot;&quot;<br />
Push &quot;steamid2&quot;             #-- text to be replaced  within the &quot; &quot;<br />
Push &quot;$R0&quot;                    #-- replace with anything within the &quot; &quot;<br />
Push all                      #-- replace all occurrences<br />
Push all                      #-- replace all occurrences<br />
Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in<br />
Call AdvReplaceInFile         #-- Call the Function<br />
${EndIf}<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $R0 &quot;steam_id.ini&quot; &quot;Field 9&quot; &quot;State&quot;<br />
${If} $R0 != &quot;&quot;<br />
Push &quot;steamid3&quot;             #-- text to be replaced  within the &quot; &quot;<br />
Push &quot;$R0&quot;                    #-- replace with anything within the &quot; &quot;<br />
Push all                      #-- replace all occurrences<br />
Push all                      #-- replace all occurrences<br />
Push $INSTDIR\cstrike\addons\amxmodx\configs\users.ini      #-- file to replace in<br />
Call AdvReplaceInFile         #-- Call the Function<br />
${EndIf}<br />
<br />
ReadIniStr $0 '$PLUGINSDIR\steam_id.ini' 'Field 12' 'State'<br />
strcmp $0 '' error ok<br />
error:<br />
MessageBox MB_OK &quot;Bitte wÃ¤hlen Sie einen 'Admintyp' aus!&quot;<br />
abort<br />
ok:<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">10th November 2006, 22:25</div></div><div class="posttext">Hi!<br />
<br />
What exactly is not working? You can't use the droplist box?<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">11th November 2006, 10:14</div></div><div class="posttext">Yes, right my problem ist that the code from the droplist number 2 and 3 are not working.<br />
<br />
I've extract the code now.<br />
<br />
Thanks for your help. I hope you understand my problem :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">11th November 2006, 11:10</div></div><div class="posttext">Hi Speedy!<br />
<br />
The script reads &quot;state&quot; of the wrong sections.<br />
I suggest using <br />
<br />
!define CMB_ADMINTYP1 &quot;Field 5&quot;<br />
:<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\steam_id.ini&quot; &quot;${CMB_ADMINTYP1}&quot; &quot;State&quot;<br />
<br />
<br />
If you change your dialog, you only have to change the definitions in one place.<br />
<br />
These are the correct ReagINIStr:<br />
<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\steam_id.ini&quot; &quot;Field 10&quot; &quot;State&quot;<br />
:<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\steam_id.ini&quot; &quot;Field 11&quot; &quot;State&quot;<br />
:<br />
ReadINIStr $R0 &quot;$PLUGINSDIR\steam_id.ini&quot; &quot;Field 12&quot; &quot;State&quot;<br />
<br />
I suggest not using goto in your REPLACE_FLAGx macros. They are wrong, because they jump to done3 which is after the third instruction set.<br />
<br />
Just a question:<br />
<br />
What is the purpose of Pop in there?<br />
<br />
done3:<br />
<br />
Pop $R0 ; &lt;&lt;--<br />
FunctionEnd<br />
<br />
<br />
Ok, with these hints the script should work.<br />
<br />
To improve the readability of your script, you might create the macros in this manner:<br />
<br />
!macro REPLACE FLAG SOURCE<br />
  Push &quot;${FLAG}&quot;             #-- text to be replaced  within <br />
  Push &quot;${SOURCE}&quot;             #-- replace with anything   <br />
  Push all                      #-- replace all occurrences <br />
  Push all                      #-- replace all occurrences <br />
  Push $INSTDIR\Test.txt       #-- file to replace in <br />
  Call AdvReplaceInFile         #-- Call the Function<br />
!macroend<br />
<br />
With this change you could remove two macros.<br />
<br />
Ok, hope this helps.<br />
<br />
Have a nice day!<br />
<br />
Tschuess!<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">11th November 2006, 13:17</div></div><div class="posttext">Thanks a lot Bruno :)<br />
<br />
It works fine. Only one further question.<br />
<br />
Is it possible when user writes something in Field 8, in Field 11 must be also choosed the &quot;Admintyp&quot;... <br />
<br />
and when he writes something in Field  9, in Field 10 must be choosed the &quot;Admintyp&quot;?<br />
<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">11th November 2006, 21:53</div></div><div class="posttext">Hi Speedy!<br />
<br />
Yes of course!<br />
<br />
Just add code to your validate script (PageLeaveSteam_ID): Read every value and decide whether everything is alright. If not, tell the user why and call Abort. This will leave the dialog as it is. The user edits the entries and tries again.<br />
<br />
Have a nice day!<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">12th November 2006, 11:27</div></div><div class="posttext">Hi,<br />
I've tried now to create this code but I don't understand how I can make this code that he checks values between two Fields:<br />
<br />
I tried this but it's completely wrong^^:<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $R1 &quot;steam_id.ini&quot; &quot;Field 8&quot; &quot;State&quot;<br />
strcmp $R0 '' $R1 error ok<br />
error:<br />
MessageBox MB_OK|MB_ICONINFORMATION &quot;$(NoAdmin)&quot;<br />
Abort<br />
ok:<br />
<br />
Could you write me an example please :)?<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">12th November 2006, 12:25</div></div><div class="posttext">Hi Speedy!<br />
<br />
Here's a draft how it could look like.<br />
<br />
<br />
ReadIniStr $0 '$PLUGINSDIR\steam_id.ini' 'Field 12' 'State'<br />
ReadIniStr $1 '$PLUGINSDIR\steam_id.ini' 'Field 7' 'State'<br />
<br />
${Unless} $1 == '' ; if not<br />
  ${If} $0 == ''<br />
    MessageBox MB_OK &quot;Bitte wÃ¤hlen Sie einen 'Admintyp' aus!&quot;<br />
    Abort<br />
  ${EndIf}<br />
${EndIf}<br />
<br />
<br />
LogicLib is very useful. Here you'll find some information:<br />
http://nsis.sourceforge.net/LogicLib<br />
and in the Examples\LogicLib.nsi too.<br />
<br />
Have a nice day!<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">12th November 2006, 20:11</div></div><div class="posttext">Hey thanks :) !<br />
<br />
Works perfect</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>