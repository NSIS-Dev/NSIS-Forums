<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem System plugin on win98, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem System plugin on win98 NSIS Discussion" />
	
	<title> Problem System plugin on win98 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem System plugin on win98</div>
<hr />
<div class="pda"><a href="t-278214.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=278214">Problem System plugin on win98</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">2nd October 2007, 14:43</div></div><div class="posttext">I have a problem. I list scheduled tasks and GPF on win98. It works fine on win2k/xp.<br />
<br />
<br />
!define GUIDTask &quot;{148BD520-A2AB-11CE-B11F-00AA00530503}&quot;<br />
!define GUIDITask &quot;{148BD524-A2AB-11CE-B11F-00AA00530503}&quot;<br />
!define GUIDTaskScheduler &quot;{148BD52A-A2AB-11CE-B11F-00AA00530503}&quot;<br />
!define GUIDITaskScheduler &quot;{148BD527-A2AB-11CE-B11F-00AA00530503}&quot;<br />
!define GUIDITaskTrigger  &quot;{148BD52B-A2AB-11CE-B11F-00AA00530503}&quot;<br />
!define GUIDIPersistFile &quot;{0000010b-0000-0000-C000-000000000046}&quot;<br />
<br />
SetPluginUnload  alwaysoff<br />
System::Call &quot;ole32::CoCreateInstance(g '${GUIDTaskScheduler}', i 0, i 11, g '${GUIDITaskScheduler}', *i .R1) i.R9&quot;<br />
IntCmp $R9 0 0 End<br />
; ITaskScheduler-&gt;Enum(IEnumWorkItem)<br />
System::Call '$R1-&gt;5(*i .R2) i.R9'<br />
; IUnknown-&gt;Release()    <br />
System::Call '$R1-&gt;2() i' ; release Task Scheduler object<br />
IntCmp $R9 0 0 End<br />
ciklus0:<br />
; read tasks<br />
System::Call '$R2-&gt;3(i 5, *i .r3, *i .r4) i .r9'<br />
; if no more task<br />
IntCmp $4 0 folyt0<br />
ciklus1:<br />
System::Call '*$3(w .r8)'<br />
; task name<br />
DetailPrint &quot;$8&quot;<br />
folyt1:<br />
System::Call &quot;ole32::CoTaskMemFree(i r8)&quot;<br />
IntOp $3 $3 + 4<br />
Intop $4 $4 - 1<br />
IntCmp $4 0 ciklus0 <br />
GoTo ciklus1<br />
<br />
folyt0:<br />
; IUnknown-&gt;Release()    <br />
System::Call '$R2-&gt;2() i'  ; release Enum Work Item object<br />
  <br />
End:<br />
; last plugin call must not have /NOUNLOAD so NSIS will be able to delete the temporary DLL<br />
SetPluginUnload manual<br />
; do nothing<br />
System::Free 0<br />
<br />
<br />
What is the wrog?<br />
When I change<br />
System::Call '*$3(w .r8)' -&gt; System::Call '*$3(t .r8)'<br />
than I get first letter of task.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">2nd October 2007, 14:58</div></div><div class="posttext">Are you sure the task scheduler on 98 uses the same COM stuff as NT5? IIRC it first came out in the win95 plus pack, might not be the same codebase as the one used on NT</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">2nd October 2007, 15:08</div></div><div class="posttext">Yes, I sure. I try sample C++ program from MS, and works fine on Win9x/2k/XP.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">2nd October 2007, 15:35</div></div><div class="posttext">offtopic: CoTaskMemFree(i r8) doesnt look right to me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd October 2007, 19:06</div></div><div class="posttext">The problem seems to be the way you handle the array returned by IEnumWorkItems::Next. You completely ignore the fact it's an array of string pointers and treat like a direct string pointer. You also free just the array and not all the strings in it as specified in MSDN.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">2nd October 2007, 19:50</div></div><div class="posttext">OK, I understand you. But than how can I read names of scheduled tasks?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">3rd October 2007, 10:15</div></div><div class="posttext">I solve the problem. :)<br />
I wrote a plugin with this function.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>