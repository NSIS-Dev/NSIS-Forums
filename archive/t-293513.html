<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to handle replacing files which are in use?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to handle replacing files which are in use? NSIS Discussion" />
	
	<title> How to handle replacing files which are in use? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to handle replacing files which are in use?</div>
<hr />
<div class="pda"><a href="t-293513.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293513">How to handle replacing files which are in use?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">richiebabes</div><div class="date">23rd June 2008, 19:18</div></div><div class="posttext">I created an NSIS install script that works unless a certain application is running which is part of the install. What is the best way to handle this?<br />
<br />
I.e. let's say myexecutable.exe is in the list of files I want to install but when the user installs they have an older version running and myexecutable.exe is running.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd June 2008, 20:38</div></div><div class="posttext">This is a macro I use to replace on reboot:<br />
  !macro InstallOnReboot Source Destination<br />
    SetFileAttributes `${Destination}` NORMAL<br />
    File `/oname=${Destination}.new` `${Source}`<br />
    Delete /rebootok `${Destination}`<br />
    Rename /rebootok `${Destination}.new` `${Destination}`<br />
  !macroend<br />
Usage:<br />
  !insertmacro InstallOnReboot localfile.exe $SYSDIR\outfile.exe<br />
The SetFileAttributes fixes a problem we found with files set to hidden+system (they were not always replaced).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">richiebabes</div><div class="date">23rd June 2008, 20:52</div></div><div class="posttext">OK, I figured out how to use this and it works... but the only problem is that it requires a reboot. Is there no way we can ask the user to nicely close down the application before proceeding with the install?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">richiebabes</div><div class="date">23rd June 2008, 21:40</div></div><div class="posttext">Like you know, a handy window saying &quot;The following applications need to be closed down before installation can continue. Please close them and click Retry to continue, or you will be sent to the fires of hell for the weekend&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd June 2008, 21:47</div></div><div class="posttext">Sure, http://nsis.sf.net/LockedList_plug-in<br />
You can use the AddModule function and give it the path to your application.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">richiebabes</div><div class="date">23rd June 2008, 22:17</div></div><div class="posttext">Awesome, thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">richiebabes</div><div class="date">23rd June 2008, 22:57</div></div><div class="posttext">Is it possible to only show the locked files page if there are actually files to be closed? If there are none I'd really like to just skip past it...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th June 2008, 10:11</div></div><div class="posttext">This would be a good addition. I'll add that option when I am next free (may be at the weekend).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">richiebabes</div><div class="date">25th June 2008, 21:55</div></div><div class="posttext">Good stuff. If I have any spare time (rofl) I can look into it too now I am getting the hang of this NSIS stuff.<br />
<br />
Just want to say, after being plagued with using InstallShield the last couple of years, NSIS is a wonderful breath of fresh air!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">20th January 2009, 18:22</div></div><div class="posttext">coming from...<br />
http://forums.winamp.com/showthread.php?postid=2476542#post2476542<br />
( WINAMP.COM | Forums &gt; Developer Center &gt; NSIS Discussion &gt; How do we overwrite a running file )<br />
<br />
Originally posted by Afrow UK <br />
This is a macro I use to replace on reboot:<br />
<br />
Could that easily be adapted to try the File method first, then check for the Error flag, and only use the .new-extraction/delete/rename on reboot -if- the File method failed?<br />
I think that in the end, the result would be the same, but the number of file interactions would presumably go down?  Any caveats with that thought?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>