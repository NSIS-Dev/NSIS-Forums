<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SetOverwrite, IfErrors &amp; File space calculation issue, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SetOverwrite, IfErrors &amp; File space calculation issue NSIS Discussion" />
	
	<title> SetOverwrite, IfErrors &amp; File space calculation issue [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SetOverwrite, IfErrors &amp; File space calculation issue</div>
<hr />
<div class="pda"><a href="t-122357.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=122357">SetOverwrite, IfErrors &amp; File space calculation issue</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">22nd January 2003, 09:19</div></div><div class="posttext">I've been trying to get this working for a little while now and here is what I've come up with:<br />
<br />
Situation:<br />
- my VB app downloads and runs nsis installer via shellexecute as an upgrade<br />
- installer/app have a timing issue and needs the first error &quot;Can't Overwrite&quot; msg back in order for the app to finish the shellexecute and unload itself<br />
<br />
Fix:<br />
  SetOverwrite try<br />
<br />
  File mrsystray.exe ; might still be in use or unloading<br />
<br />
  IfErrors 0 NoError<br />
    Sleep 100<br />
    File mrsystray.exe<br />
  NoError:<br />
<br />
Problem:<br />
Though the installer is still very small, the required file space is reported as doubled of what you really need.<br />
<br />
Question:<br />
Is there anyway of adding a /dontadd or /ignoresize to the File command or like with the AddSize add a SubstractSize<br />
<br />
In the meantime I'm using AddSize -252 but the size of my app changes from build to build.  Tried using the FileSizeNew (http://forums.winamp.com/showthread.php?s=&amp;threadid=94683&amp;highlight=get+file+size) script but it returned the amount in bytes and could really get it to compile.<br />
<br />
Any suggestions would be grateful, thanks.<br />
<br />
Mel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">22nd January 2003, 10:42</div></div><div class="posttext">Since AddSize -252 does propably exactly the same as SubstractSize would do, I assume that you want disable that NSIS calculates the size of the files and then add the real size.<br />
<br />
By the way, maybe it's a bug that NSIS reports more bytes than it should have. Please post your script as an attachment for reviewing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">22nd January 2003, 10:49</div></div><div class="posttext">Script in question.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">22nd January 2003, 11:12</div></div><div class="posttext">I can't find any errors, maybe KiCHiK can.<br />
But don't forget to reset the SetOverwrite with 'SetOverwrite on' after you have copied the problem-file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">22nd January 2003, 14:57</div></div><div class="posttext">Basically if I had overwrite on, it would hang, then it would timeout prompting to abort/retry/fail, remember mrsystray.exe is calling the installer waiting for a shellexecute return code (finished, timedout, error) and then it will proceed, now since it timesout generating an error my app proceeds to unload itself, allowing the IfErrors to take over and replace the exe.<br />
<br />
But I do agree that the file space used is a bug or could be remedied by adding a /dontcalcsize or something to the File command.<br />
<br />
Thanks,<br />
<br />
Mel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd January 2003, 15:00</div></div><div class="posttext">When you extract the file twice it will take twice the space, no bug or error there. You can either make it in one loop, put the second file command in a function or use the dynamic compiling from the FAQ.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">22nd January 2003, 15:01</div></div><div class="posttext">I meant AFTER the installer tried to copy the mrsystray.exe file, you should write 'SetOverwrite on' again for the next few files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">22nd January 2003, 15:04</div></div><div class="posttext">Can you point me to an example of a loop?<br />
<br />
I'll set it back to on thanks.<br />
<br />
Also where can I get an FAQ on how to use the Modern stuff?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd January 2003, 15:09</div></div><div class="posttext">again: ClearErrors<br />
File mrsystray.exe<br />
IfErrors 0 NoErrors<br />
  Sleep 500<br />
  Goto again<br />
NoErrors<br />
<br />
There is no FAQ about the MUI yet, but if you ask here someone will surely answer you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrtech</div><div class="date">22nd January 2003, 15:13</div></div><div class="posttext">Great thanks I'll give this a try.<br />
<br />
Melmo</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>