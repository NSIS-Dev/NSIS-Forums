<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Upgrading versions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Upgrading versions NSIS Discussion" />
	
	<title> Upgrading versions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Upgrading versions</div>
<hr />
<div class="pda"><a href="t-305824.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305824">Upgrading versions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">engsoft</div><div class="date">28th April 2009, 18:21</div></div><div class="posttext">Hi, <br />
<br />
I have a couple of questions that I'm hoping someone could answer for me. We are still using version 2.01 of The NSIS. If we upgrade to the latest version will we have to update our scripts or will they run under the newer version? <br />
<br />
Second using the 2.01 I'm building an update to one of our programs. When it's installed over an older version the icon for the desktop and start menu don't update to the newer icon. <br />
If I change the display settings in XP or Vista then the icon updates. Is there a way to force Windows to update the icon? <br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th April 2009, 20:18</div></div><div class="posttext">Some minor mods may be needed, like it would be recommended that you switch to MUI2.nsh<br />
<br />
Why not install on another machine and try compiling from there?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engsoft</div><div class="date">29th April 2009, 17:26</div></div><div class="posttext">Thanks for the info I set up the newer version on another machine. <br />
<br />
In regards to this question,<br />
<br />
When it's installed over an older version the icon for the desktop and start menu don't update to the newer icon.<br />
If I change the display settings in XP or Vista then the icon updates. Is there a way to force Windows to update the icon? <br />
<br />
I've read somethings about the RefreshShellIcons <br />
<br />
Is this the only way to do this? If it is what is the syntax to force a refresh of a desktop and start menu icon?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th April 2009, 21:30</div></div><div class="posttext">From Examples\makensis.nsi (the NSIS install script):<br />
<br />
!define SHCNE_ASSOCCHANGED 0x8000000<br />
!define SHCNF_IDLIST 0<br />
<br />
System::Call 'Shell32::SHChangeNotify(i ${SHCNE_ASSOCCHANGED}, i ${SHCNF_IDLIST}, i 0, i 0)'<br />
<br />
Edit: Similar code at:<br />
http://nsis.sourceforge.net/Refresh_shell_icons<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engsoft</div><div class="date">29th April 2009, 21:59</div></div><div class="posttext">I can't get it to work for some reason. <br />
<br />
Is there anything else I'd need to have in the script for it to work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th April 2009, 22:42</div></div><div class="posttext">Are you pointing to an ico file or an exe file?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th April 2009, 22:52</div></div><div class="posttext">Please try this code as well:<br />
<br />
  !define SPI_SETNONCLIENTMETRICS 42<br />
  ClearErrors<br />
  ReadRegStr $R0 HKCU `Control Panel\Desktop\WindowMetrics` `Shell Icon Size`<br />
  IfErrors 0 +2<br />
  StrCpy $R0 32<br />
  IntOp $R1 $R0 + 1<br />
  WriteRegStr HKCU `Control Panel\Desktop\WindowMetrics` `Shell Icon Size` $R1<br />
  SendMessage ${HWND_BROADCAST} ${WM_SETTINGCHANGE} ${SPI_SETNONCLIENTMETRICS} 0 /TIMEOUT=10000<br />
  WriteRegStr HKCU `Control Panel\Desktop\WindowMetrics` `Shell Icon Size` $R0<br />
  SendMessage ${HWND_BROADCAST} ${WM_SETTINGCHANGE} ${SPI_SETNONCLIENTMETRICS} 0 /TIMEOUT=10000<br />
<br />
<br />
Edit: if not using MUI, make sure you !include WinMessages.nsh.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>