<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Partial String Match During Uninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Partial String Match During Uninstall NSIS Discussion" />
	
	<title> Partial String Match During Uninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Partial String Match During Uninstall</div>
<hr />
<div class="pda"><a href="t-311202.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=311202">Partial String Match During Uninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">31st August 2009, 22:20</div></div><div class="posttext">How do I do a partial string match during an uninstallation routine?  <br />
<br />
We make a software product and now we have released a &quot;viewer&quot; version, which is a stripped down version of the main thing.  Only issue is, there is one common icon on the desktop.  <br />
<br />
Typically they shouldn't co-exist, but I allow it anyway by doing something like this:<br />
<br />
<br />
Function .onInit<br />
  ReadRegStr $R0 HKLM \<br />
  &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\NeatoTek&quot; \<br />
  &quot;UninstallString&quot;<br />
  StrCmp $R0 &quot;&quot; goahead<br />
  MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION \<br />
  &quot;NeatoTek 1.2 is already installed. $\n$\nClick `OK` to continue the \<br />
  installation of the NeatoTek 1.2 Viewer or `Cancel` to cancel this installation.&quot; \<br />
  IDOK goahead<br />
  Abort<br />
<br />
<br />
goahead:<br />
FunctionEnd<br />
<br />
<br />
I adapted code from the uninstall if found before start routine actually.<br />
<br />
But in the uninstall portion:<br />
<br />
<br />
${If} $nt == &quot;no&quot;<br />
  ; function here<br />
  Delete &quot;$DESKTOP\Common Icon.lnk&quot;<br />
  ${EndIf}<br />
<br />
<br />
I originally did a global var but since uninstall is an entirely different scope that didn't work.  I wanted to use the same code below, and I am sure it would work, but I rather use the Display Name part of the registry, but for some reason, our product has the version number in it, whilst it also being in Display Version.  Since we have released several released already too late for that change, but I rather use Display Name on the top portion too since I have a generic version in there, i rather output the var itself reads so i dont have to keep changing this with each release.  <br />
<br />
So my question is, how do i do the strcmp on that &quot;Foobar 500&quot; as display name and just search for foobar. The viewer has two words followed by the number, the full version I believe has one word with the number.<br />
<br />
Any help is appreciated.  I know I wrote a lot, but I think I confused things more than necessary so I hope I didnt!<br />
<br />
thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">31st August 2009, 22:58</div></div><div class="posttext">I'm not sure what you want exactly, but if you want the DisplayName without the DisplayVersion you can use the WordReplace function from the WordFunc Header, like${WordReplace} &quot;$DisplayName&quot; &quot; $DisplayVersion&quot; &quot;&quot; &quot;+&quot; $R0<br />
<br />
Or if you just want to check if a string contains another string, you can use${WordFind} &quot;$nt&quot; &quot;foobar&quot; &quot;#&quot; $R0<br />
${If} $R0 &gt; 0<br />
  ; function here<br />
  Delete &quot;$DESKTOP\Common Icon.lnk&quot;<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">31st August 2009, 23:11</div></div><div class="posttext">I figured my full story was more confusing what I want.<br />
<br />
To summarise and make it more clear.<br />
<br />
Our company produces a product that requires software to run it.  It generates special kind of files.<br />
<br />
If one did not own the equipment, but is interested in examining the data our devices produce they can get the free <br />
viewer.<br />
<br />
Lets call this Foobar Viewer 100.<br />
So in its DisplayName portion of the Uninstall in the registry, we get &quot;Foobar Viewer 100&quot;.<br />
<br />
If the enduser does own our equipment, Lets call this now Neato 100.  So its uninstall displayname parameter is now Neato 100.<br />
<br />
What I am trying to accomplish is two fold.<br />
<br />
During the installation of the Viewer, it determines if the full version is there by examining the value of Neato in this case.<br />
<br />
Because a user can have Version say 1-infinity (since there will always be a newer version), I want to determine if they have Neato installed, under displayName.<br />
<br />
However, since Neato and Foobar both share a common application that has a shortcut on the desktop, when one uninstalls the viewer (foobar), and if Neato is already installed, i don't want its icon to be removed.  since both are sharing the same function, except in two different spots, I am trying to just find the name.  <br />
<br />
For now, I don't care what happens to the viewer if a user uninstalls the full version.  Right now, however, my logic works, the appropiate icons stay/remove how i want them to do so, though i have to say If &quot;Neato 100&quot; else kind of deal.<br />
<br />
I hope this did not make things more confusing but after reading and rereading this, I think this makes more sense.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">1st September 2009, 00:02</div></div><div class="posttext">I suggest doing a partial string copy (up to where the number begins) and then check that portion.<br />
strcpy $1 &quot;Foobar Viewer 100&quot;<br />
strcpy $1 $1 -4   # truncate 4 characters<br />
${If} $1 == &quot;Foobar Viewer&quot;<br />
MessageBox MB_OK &quot;It works&quot;<br />
${Else}<br />
${Endif}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">1st September 2009, 14:29</div></div><div class="posttext">Fantastic mate, thanks so much!<br />
<br />
I reckon when we get to version 1000 the program will be called something else, I hope!<br />
<br />
Actually, I think we will go with the full version (the number above is a build number, the full version is 6.3.100)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">1st September 2009, 17:01</div></div><div class="posttext">Well, as I mentioned above you can use the WordFind macro from the WordFunc library, so that it is independant of whatever version you have:strcpy $1 &quot;Foobar Viewer 100&quot;<br />
${WordFind} &quot;$1&quot; &quot;Foobar Viewer&quot; &quot;#&quot; $R0<br />
${If} $R0 &gt; 0<br />
  Delete &quot;$DESKTOP\Common Icon.lnk&quot;<br />
${EndIf}</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>