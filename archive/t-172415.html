<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" alternative for FindWindow, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  alternative for FindWindow NSIS Discussion" />
	
	<title> alternative for FindWindow [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  alternative for FindWindow</div>
<hr />
<div class="pda"><a href="t-172415.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172415">alternative for FindWindow</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">7th March 2004, 15:19</div></div><div class="posttext">hey.<br />
<br />
i need to detect if a game is running, that my installer want's to modify.<br />
FindWindow won't work, because the window-caption includes date-information, which is impossible for me to get on any other system than my own.<br />
but i know the .exe-name.<br />
is there any other possibility?<br />
i need to detect the running state, warn the user with a messagebox, and exit the game, if the user clicks on 'yes'.<br />
i know how to do the last thing with SendMessage, but i don't know how to detect the window.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 16:29</div></div><div class="posttext">It might set a mutex or you can write a plug-in that gets the list of processes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">7th March 2004, 16:31</div></div><div class="posttext">It might set a mutex ...<br />
and that means ... ? :)<br />
<br />
... or you can write a plug-in that gets the list of processes.<br />
yes, i could, if i'd know how. someone other may do this. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">7th March 2004, 19:05</div></div><div class="posttext">another possibility:<br />
is there an api-call availiable to get the window-class of a thread, by his filename?<br />
or some calls one by one to do this job?<br />
so it would look like that:<br />
System::&lt;something&gt;<br />
&lt;something other&gt;<br />
FindWindow &lt;something&gt;<br />
u know what i mean?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 19:08</div></div><div class="posttext">You can search for a class name using FindWindow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th March 2004, 18:18</div></div><div class="posttext">You can use Process Explorer (sysinternals) to c if the program creates a mutex...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">8th March 2004, 19:16</div></div><div class="posttext">@joost:<br />
what i mean, is, that the FindWindow command needs the window-caption to find the window-class.<br />
but the caption is variable. the only constant is the filename.<br />
so, i need a command, that gets the window-caption (or class) from the filename.<br />
<br />
@anders:<br />
i already asked: what is a mutex?<br />
and i don't know c very well, too less to write a plugin or something similar.<br />
<br />
so, if there's an api-call, that i can use with the system-plugin, it'd be very nice :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MindlessOath</div><div class="date">8th March 2004, 20:49</div></div><div class="posttext">cant u just use findwindow and then just find the first few letters to determain the info you need, and leave out the date info?  <br />
<br />
in regular programming, thats how i would do it.<br />
<br />
also seeing the process list would work to find the exe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">8th March 2004, 21:03</div></div><div class="posttext">hmm, tried it already, but didn't work :)<br />
and, yes, through the taskmanager, _I_ could get the name, but the installer has to do this himself.<br />
or, joost, what do u say, is there any possibility to use wildcards, or just parts of the name?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">11th March 2004, 17:27</div></div><div class="posttext">hmm, as i saw this archive page (http://nsis.sourceforge.net/archive/viewpage.php?pageid=386), i thougt that might be work for me too, in a slightly different way.<br />
how could i detect and perhaps shutdown a task by it's mutex?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">26th March 2004, 11:54</div></div><div class="posttext">FindWindow()<br />
GetWindowThreadProcessId()<br />
GetModuleFileNameEx()<br />
<br />
But if this is your game, you can set window user_data<br />
SetWindowLong(hDlg, GWL_USERDATA, YOUR_PROG_ID);<br />
<br />
This is my macro<br />
<br />
!macro TerminateMgr<br />
<br />
  loop:<br />
    FindWindow $1 &quot;#32770&quot; &quot;&quot; 0 $1<br />
    IntCmp $1 0 done<br />
    IsWindow $1 0 done<br />
    System::Call &quot;user32.dll::GetWindowLong(i r1, i -21) i.r0&quot;<br />
    IntCmpU $0 0x4d475201 0 loop loop<br />
    SendMessage $1 0x0010 0 0<br />
    Sleep 600<br />
    goto loop<br />
  done:<br />
<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 17:09</div></div><div class="posttext">thank u very much!<br />
i'll try that immidiately.<br />
but which code do i have to customize for my application?<br />
and what does your macro detect? the filename or the window-caption, like FindWindow?<br />
<br />
another thing i found while searching the inet:<br />
http://eric.aling.***********/PB/tips/pbtip41.htm<br />
<br />
this may help too.<br />
<br />
and, no, it's not my game.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th March 2004, 17:41</div></div><div class="posttext">This macro gives you all top level window handles<br />
<br />
!macro FindWin<br />
<br />
loop:<br />
FindWindow $1 GAME_WINDOW_CLASS &quot;&quot; 0 $1<br />
IntCmp $1 0 done<br />
IsWindow $1 0 done<br />
<br />
#insert here 2 WIN API calls<br />
#GetWindowThreadProcessId() - this gives you process ID for $1 window handle<br />
#GetModuleFileNameEx() - gives path\file for process ID.<br />
#both like System::Call ... - appendix C of NSIS help<br />
<br />
# next sends WM_CLOSE to window found - may be you don't need this. And WM_CLOSE may not terminate any application<br />
SendMessage $1 0x0010 0 0<br />
<br />
# if few games are running and 1 sec to finish game<br />
<br />
Sleep 1000<br />
goto loop<br />
done:<br />
<br />
!macroend<br />
<br />
I wrote macro (above) to terminate my program both on install and uninstall.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th March 2004, 17:44</div></div><div class="posttext">And you can get game window class (string instead of GAME_WINDOW_CLASS I used above) using MS VS tool Spy++ for example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 17:52</div></div><div class="posttext">erm, that's the problem:<br />
the GAME_WINDOW_CLASS is variable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 18:12</div></div><div class="posttext">attached the current development state of my function to check for a running game.<br />
any help with the api-calls would be appreciated.<br />
maybe some of our freaks here know some answers, like kichik or lobo-lunar?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 18:20</div></div><div class="posttext">sorry, i forgot onething:<br />
you need to copy the attached dll to your nsis/plugins folder.<br />
<br />
(it's no txt, but dll's can't be attached directly. just rename)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th March 2004, 19:41</div></div><div class="posttext">GAME_WINDOW_CLASS is not script variable, it's a window class name :) For example Windows Notepad main window class is &quot;Notepad&quot;, Internet Explorer Window - &quot;CabinetWClass&quot;. If you don't know how to get game window class name (or this may vary), use <br />
FindWindow $1 &quot;&quot; &quot;&quot; 0 $1<br />
instead and check up all top level windows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 20:27</div></div><div class="posttext">yes, but that's the point!!!<br />
from version to version, the window-class name of the game changes!<br />
that's just what i ment. i don't know the complete name.<br />
<br />
/edit:<br />
ok, got it, but how do i get all the window-class names?<br />
the first 13 chars of the title are constant, that may help.<br />
<br />
/edit2:<br />
i'm sorry, i didn't read your posts carefully enough.<br />
this would work:<br />
GetWindowThreadProcessId()<br />
GetModuleFileNameEx()<br />
but could you tell me the correct syntax for these functions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atsuk</div><div class="date">27th March 2004, 20:57</div></div><div class="posttext">if you just need to close active program, then you could use:<br />
KillProcDLL::KillProc &quot;game.exe&quot;<br />
information about it:<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=271</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 21:03</div></div><div class="posttext">hmm, that's a very nice thing.<br />
<br />
but, i first wanted to pop-up a messagebox, to ask the user.<br />
so, that's not the perfect solution for me. i want to do the steps, that this dll does, myself with nsis.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atsuk</div><div class="date">27th March 2004, 21:04</div></div><div class="posttext">no problem:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 21:09</div></div><div class="posttext">can you help me with the syntax of these commands?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atsuk</div><div class="date">27th March 2004, 21:14</div></div><div class="posttext">i think it should work..just edited my own script a little<br />
<br />
Function &quot;close&quot;<br />
  MessageBox MB_YESNO|MB_ICONQUESTION|MB_DEFBUTTON1 &quot;wanna close?&quot; IDNO cancel<br />
  KillProcDLL::KillProc &quot;game.exe&quot;<br />
   goto +2<br />
   cancel:<br />
    DetailPrint &quot;you prefered not to close program&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th March 2004, 21:17</div></div><div class="posttext">but the messagebox should only come up, if the process is really running. so, i can't use the dll. i'll have to check for the process myself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">28th March 2004, 10:51</div></div><div class="posttext">i found the following function, that imho may be the solution:<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/winui/windowsuserinterface/windowing/windowclasses/windowclassreference/windowclassfunctions/getwindowlong.asp<br />
but i always get errors with the attached code.<br />
could someone help me out with the correct syntax?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">28th March 2004, 10:54</div></div><div class="posttext">forgot the attachment ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">28th March 2004, 11:04</div></div><div class="posttext">finally, i got it working!!!!!<br />
attached the complete script to get all the classnames of every open window.<br />
<br />
i'll post it at the archive later.<br />
hope, it'll help other people too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">30th March 2004, 18:17</div></div><div class="posttext">ok, i postet the interesting part of my final solution at the nsis-archive. check it out here (http://nsis.sourceforge.net/archive/viewpage.php?pageid=460).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th February 2006, 20:10</div></div><div class="posttext">Updated Wiki Page (http://nsis.sourceforge.net/Enhanced_FindWindow_for_variable_window_class_names)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mæster</div><div class="date">23rd June 2006, 03:34</div></div><div class="posttext">The solution above with the window class name (or a part of it) wont work for me, because the app i search for is a vb6 program and those have all the same window class name 'ThunderRT6FormDC'. So this class name leads not to a unique program.<br />
<br />
Is there a way to have an enhanced FindWindow function which   works with only a part of the window title? The window title of my program consists of a known and a unknown part, so the classic FindWindow function (which needs the exact window title) wont work.<br />
<br />
Greets,<br />
M.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">23rd June 2006, 06:42</div></div><div class="posttext">http://nsis.sourceforge.net/FCT_plug-in</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>