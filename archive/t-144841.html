<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Backup Files at install if file exsits..?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Backup Files at install if file exsits..? NSIS Discussion" />
	
	<title> Backup Files at install if file exsits..? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Backup Files at install if file exsits..?</div>
<hr />
<div class="pda"><a href="t-144841.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144841">Backup Files at install if file exsits..?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 22:47</div></div><div class="posttext">When installing stuff, some files might get overwritten on the end user's pc. Is there a way to make the installer move files to be overwritten to a backup folder, so at uninstall, all is as if the installer never was installed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th August 2003, 23:21</div></div><div class="posttext">It can be hard to do this.<br />
<br />
Example:<br />
 CreateDirectory &quot;$INSTDIR\backup&quot;<br />
IfFileExists &quot;$INSTDIR\file.txt&quot; 0 +2<br />
 Rename &quot;$INSTDIR\file.txt&quot; &quot;$INSTDIR\backup\file.txt&quot;<br />
<br />
SetOutPath $INSTDIR<br />
File &quot;file.txt&quot;<br />
<br />
Then for uninstall, just do<br />
CopyFiles &quot;$INSTDIR\backup\*.*&quot; &quot;$INSTDIR\*.*&quot;<br />
RMDir /r &quot;$INSTDIR\backup&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">5th August 2003, 23:36</div></div><div class="posttext">Ok I get the idea.. thx m8.. u r a plain old dude of knowleg ;)<br />
<br />
This is my file as it is of now, but I can't get it to uninstall right. All it sais is &quot;Copy failed&quot;. Anyone how can see what's wrong?<br />
<br />
UninstallText &quot;This will uninstall xes ${version}${build}. Hit next to continue.&quot;<br />
Section &quot;Uninstall&quot;<br />
  SetAutoClose false<br />
  ReadRegStr $R0 HKLM Software\x-systems\xes InstallDir<br />
    CopyFiles $R0\cstrike\xes_backup\*.* $R0\cstrike\*.*<br />
  RMDir /r $R0\cstrike\xes_backup<br />
  RMDir /r $R0\cstrike\xes<br />
  RMDir /r $SMPROGRAMS\x-systems\xes<br />
  RMDir $SMPROGRAMS\x-systems<br />
  DeleteRegKey HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems\xes<br />
  DeleteRegKey /ifempty HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems<br />
  DeleteRegKey HKLM Software\x-systems\xes<br />
  DeleteRegKey /ifempty  HKLM Software\x-systems<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 08:58</div></div><div class="posttext">I'v tryed to make the uninstaller reinstall the overwritten files by doing this:<br />
<br />
UninstallText &quot;This will uninstall xes ${version}${build}. Hit next to continue.&quot;<br />
Section &quot;Uninstall&quot;<br />
  SetAutoClose false<br />
  ReadRegStr $INSTDIR HKLM Software\x-systems\xes InstallDir<br />
    IfFileExists &quot;$INSTDIR\cstrike\xes_backup\autoexec.cfg&quot; +1 +2<br />
      Rename &quot;$INSTDIR\cstrike\xes_backup\autoexec.cfg&quot; &quot;$INSTDIR\cstrike\autoexec.cfg&quot;<br />
  RMDir /r $INSTDIR\cstrike\xes_backup<br />
  RMDir /r $INSTDIR\cstrike\xes<br />
  RMDir /r $SMPROGRAMS\x-systems\xes<br />
  RMDir $SMPROGRAMS\x-systems<br />
  DeleteRegKey HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems\xes<br />
  DeleteRegKey /ifempty HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems<br />
  DeleteRegKey HKLM Software\x-systems\xes<br />
  DeleteRegKey /ifempty HKLM Software\x-systems<br />
SectionEnd<br />
<br />
But in the details window this is all that is shown:<br />
<br />
Remove folder: D:\Half-Life\cstrike\xes_backup<br />
Remove folder: D:\Half-Life\cstrike\xes<br />
Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems\xes<br />
Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems<br />
Completed<br />
<br />
Any ideas folks?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 10:48</div></div><div class="posttext">Whats wrong?<br />
<br />
Write/ReadRegStr's or any form of INI/Reg management in NSIS is not shown in the LogWindow.<br />
Why would the user want to see that kind of stuff - the LogWindow is to show management of file movement/extraction.<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 11:11</div></div><div class="posttext">Your first examble didn't work, it just wrote &quot;Copy files from ?:\blah\more blah\*.* to ?:\new blah -&gt; Copy failed.<br />
<br />
Originally posted by Afrow UK <br />
Then for uninstall, just do<br />
CopyFiles &quot;$INSTDIR\backup\*.*&quot; &quot;$INSTDIR\*.*&quot;<br />
RMDir /r &quot;$INSTDIR\backup&quot;<br />
<br />
-Stu <br />
<br />
So I tryed to make it like this:<br />
<br />
IfFileExists &quot;$INSTDIR\cstrike\xes_backup\autoexec.cfg&quot; +1 +2 <br />
Rename &quot;$INSTDIR\cstrike\xes_backup\autoexec.cfg&quot; &quot;$INSTDIR\cstrike\autoexec.cfg&quot;<br />
<br />
But it still doesn't work. The files that are backed up, are not reinstalled at uninstall.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 11:57</div></div><div class="posttext">Try using my code with:<br />
<br />
CopyFiles &quot;$INSTDIR\backup\*.*&quot; &quot;$INSTDIR&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 12:06</div></div><div class="posttext">Sorry Afrow but I think you need to do some more sleeping ;P<br />
<br />
Your first examble didn't work, it just wrote &quot;Copy files from ?:\blah\more blah\*.* to ?:\new blah -&gt; Copy failed. <br />
<br />
<br />
<br />
Originally posted by Afrow UK <br />
Then for uninstall, just do <br />
CopyFiles &quot;$INSTDIR\backup\*.*&quot; &quot;$INSTDIR\*.*&quot; <br />
RMDir /r &quot;$INSTDIR\backup&quot; <br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:14</div></div><div class="posttext">My method is far better than the method you are trying to achieve.<br />
Firstly, you are backing up the files - thats fine, but on uninstall, why copy a single file back when you can copy them all back in one go.<br />
<br />
E.g.<br />
#Install<br />
Rename &quot;C:\blah1.txt&quot; &quot;C:\backup\blah1.txt&quot;<br />
Rename &quot;C:\blah2.txt&quot; &quot;C:\backup\blah2.txt&quot;<br />
Rename &quot;C:\blah3.txt&quot; &quot;C:\backup\blah3.txt&quot;<br />
<br />
#Uninstall<br />
CopyFiles &quot;C:\backup\blah1.txt&quot; &quot;C:\blah1.txt&quot;<br />
CopyFiles &quot;C:\backup\blah2.txt&quot; &quot;C:\blah2.txt&quot;<br />
CopyFiles &quot;C:\backup\blah3.txt&quot; &quot;C:\blah3.txt&quot;<br />
<br />
The uninstall bit is pointless and a waste of code.<br />
A simple<br />
CopyFiles &quot;C:\backup\*.*&quot; &quot;C:\&quot;<br />
Will do them all in one go.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:17</div></div><div class="posttext">It can be hard to do this. <br />
<br />
Example: <br />
CreateDirectory &quot;$INSTDIR\backup&quot; <br />
IfFileExists &quot;$INSTDIR\file.txt&quot; 0 +2 <br />
Rename &quot;$INSTDIR\file.txt&quot; &quot;$INSTDIR\backup\file.txt&quot; <br />
<br />
SetOutPath $INSTDIR <br />
File &quot;file.txt&quot; <br />
<br />
Then for uninstall, just do <br />
CopyFiles &quot;$INSTDIR\backup\*.*&quot; &quot;$INSTDIR&quot;<br />
RMDir /r &quot;$INSTDIR\backup&quot; <br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 12:30</div></div><div class="posttext">This is what happens when I try your method:<br />
<br />
Copy to D:\Half-Life\cstrike\xes\*.*<br />
Copy failed<br />
Remove folder: D:\Half-Life\cstrike\xes_backup<br />
Remove folder: D:\Half-Life\cstrike\xes<br />
Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems\xes<br />
Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems<br />
Completed<br />
<br />
And the problem is this: Copy to D:\Half-Life\cstrike\xes\*.*. For some reason it puts a \xes\ folder in the $INSTDIR or where ever, I don't know. This is the code I have in the script:<br />
  CopyFiles &quot;$INSTDIR\xes_backup\*.*&quot; &quot;$INSTDIR\*.*&quot;<br />
<br />
I might add that it delets the folders and removes the reg's and shortcuts and so on..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:38</div></div><div class="posttext">I've already told you twice:<br />
CopyFiles &quot;$INSTDIR\xes_backup\*.*&quot; &quot;$INSTDIR\*.*&quot;<br />
should be<br />
CopyFiles &quot;$INSTDIR\xes_backup\*.*&quot; &quot;$INSTDIR&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 12:40</div></div><div class="posttext">Yes I know.. it still makes no difference :(<br />
<br />
Copy to D:\Half-Life<br />
Copy failed<br />
Remove folder: D:\Half-Life\cstrike\xes_backup<br />
Remove folder: D:\Half-Life\cstrike\xes<br />
Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems\xes<br />
Remove folder: C:\Documents and Settings\Administrator\Start Menu\Programs\x-systems<br />
Completed</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:43</div></div><div class="posttext">Can you show the exact script like it is now?<br />
<br />
Btw, how many files are you backing up?<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 12:45</div></div><div class="posttext">I don't know how to attach..? About 10-13 files plus the folder tree they are in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:48</div></div><div class="posttext">I mean the uninstall code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 12:49</div></div><div class="posttext">UninstallText &quot;This will uninstall xes ${version}${build}. Hit next to continue.&quot;<br />
Section &quot;Uninstall&quot;<br />
  SetAutoClose false<br />
  ReadRegStr &quot;$INSTDIR&quot; HKLM Software\x-systems\xes InstallDir<br />
  CopyFiles &quot;$INSTDIR\xes_backup\&quot; &quot;$INSTDIR\cstrike\&quot;<br />
  RMDir /r &quot;$INSTDIR\cstrike\xes_backup&quot;<br />
  RMDir /r &quot;$INSTDIR\cstrike\xes&quot;<br />
  RMDir /r $SMPROGRAMS\x-systems\xes<br />
  RMDir $SMPROGRAMS\x-systems<br />
  DeleteRegKey HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems\xes<br />
  DeleteRegKey /ifempty HKLM Software\Microsoft\Windows\CurrentVersion\Uninstall\x-systems<br />
  DeleteRegKey HKLM Software\x-systems\xes<br />
  DeleteRegKey /ifempty HKLM Software\x-systems<br />
SectionEnd<br />
<br />
The &quot;$INSTDIR\cstrike\&quot; was just an atempt to find the error.. I'v tryed &quot;$INSTDIR&quot;, &quot;$INSTDIR\&quot;, &quot;$INSTDIR\*.*&quot; and so on and on....<br />
It just returns &quot;Copy faild&quot; :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:55</div></div><div class="posttext">CopyFiles &quot;$INSTDIR\xes_backup\*.*&quot; &quot;$INSTDIR&quot; should work fine.<br />
<br />
If you are only backing up 1 file then you could use your code:<br />
<br />
IfFileExists &quot;$INSTDIR\xes_backup\autoexec.cfg&quot; 0 +3<br />
 Delete &quot;$INSTDIR\autoexec.cfg&quot;<br />
 Rename &quot;$INSTDIR\xes_backup\autoexec.cfg&quot; &quot;$INSTDIR\autoexec.cfg&quot;<br />
RMDir &quot;$INSTDIR\xes_backup&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:56</div></div><div class="posttext">How about this:<br />
CopyFiles &quot;$INSTDIR\xes_backup\*.*&quot; &quot;$INSTDIR\*&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 12:56</div></div><div class="posttext">If the file is already there, does CopyFiles not overwritte it?<br />
<br />
How about this: <br />
CopyFiles &quot;$INSTDIR\xes_backup\*.*&quot; &quot;$INSTDIR\*&quot;<br />
<br />
Nop didn't change a thing.. damn one should think that the NSIS team would have made a better uninstall function.. or some more up-2-date documentation ;P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 12:58</div></div><div class="posttext">Yes, unless the file is open or being used.<br />
<br />
You could do a<br />
Delete &quot;$INSTDIR\autoexec.cfg&quot;<br />
before hand.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th August 2003, 13:01</div></div><div class="posttext">I think this now is a better method.<br />
It allows more control over the files...<br />
<br />
IfFileExists &quot;$INSTDIR\xes_backup\autoexec.cfg&quot; 0 +3 <br />
Delete &quot;$INSTDIR\autoexec.cfg&quot; <br />
Rename &quot;$INSTDIR\xes_backup\autoexec.cfg&quot; &quot;$INSTDIR\autoexec.cfg&quot;<br />
<br />
IfFileExists &quot;$INSTDIR\xes_backup\blah.txt&quot; 0 +3 <br />
Delete &quot;$INSTDIR\blah.txt&quot; <br />
Rename &quot;$INSTDIR\xes_backup\blah.txt&quot; &quot;$INSTDIR\blah.txt&quot;<br />
 <br />
RMDir &quot;$INSTDIR\xes_backup&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tatsudoshi</div><div class="date">6th August 2003, 13:07</div></div><div class="posttext">YES! If there is a file with the same name as the target file as in the Rename label is doesn't move it! *hint* put in documentation *hint* :)<br />
<br />
Thx Afrow.. now it does what I want it to.. thx alot m8 :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>