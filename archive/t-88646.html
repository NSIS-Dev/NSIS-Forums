<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Passing name of a batch file as a parameter, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Passing name of a batch file as a parameter NSIS Discussion" />
	
	<title> Passing name of a batch file as a parameter [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Passing name of a batch file as a parameter</div>
<hr />
<div class="pda"><a href="t-88646.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=88646">Passing name of a batch file as a parameter</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">23rd May 2002, 23:03</div></div><div class="posttext">I must call my NSIS setup.exe file from within a batch file and I need to assign to a variable the name of the batch file that called setup.exe<br />
<br />
Alternatively I could place the name of the file (or a parameter) after setup.exe (as in the sample batch file below) and somehow I would like to assign that file/parameter to a variable. I tried using the GetParameters sample listed in Functions.htm, but have not been able to figure it out.<br />
<br />
Thanks<br />
<br />
<br />
MyFile.bat<br />
------------------------<br />
Setup.exe TestMode<br />
------------------------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sdbarker</div><div class="date">24th May 2002, 00:56</div></div><div class="posttext">in your batchfile:<br />
<br />
setup.exe /Dcaller=%0<br />
<br />
and then you should have ${caller} defined as you batchfile name.<br />
<br />
untested, but it should work.<br />
<br />
-Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">24th May 2002, 03:30</div></div><div class="posttext">Scott or anyone,<br />
<br />
Can you provide some more details? I have not been able to figure it out yet.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">24th May 2002, 08:36</div></div><div class="posttext">/D is only for the compiler, not for the installer.<br />
<br />
Can't you do it without this batch file? Maybe the installer can take over the functions of the batchfile. Else, write a small txt file to $TEMP and let the installer read it. Or use the registry...<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th May 2002, 11:56</div></div><div class="posttext">I agree with Hendri, everything that can be done with a batch can be done with NSIS. If you still want to do it with the batch file you sohuld call setup.exe like this:<br />
setup.exe %0<br />
<br />
And in NSIS:<br />
Call GetParameters<br />
Pop $1<br />
MessageBox MB_OK $1<br />
<br />
You will see that $1 now contains the paramters you sent to setup.exe which is the name of the batch file. If $1 does not contain the path to the batch file you can always add $EXEDIR to it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">24th May 2002, 18:38</div></div><div class="posttext">Thanks for the suggestions guys, I will try them soon. I am using NSIS to create a utility to perform certain things. This file needs to be called by third-party software and usually they specify it must be a batch file, that is why I am having the batch file call my NSIS file.<br />
I want the NSIS file to look for some values in the calling batch file, that is why I need the utility to find out the name of the batch file. I don't want to create a different exe for each product so I want to be able to read the variables from an external file which in this case would be in the batch file itself (If I can read the values from the batch file, I only need to have two files instead of three).<br />
Now I just need to figure out how to read a batch as if it was an ini file.<br />
<br />
Carlos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">29th May 2002, 23:10</div></div><div class="posttext">Hi,<br />
<br />
Using the unmodified &quot;GetParameters&quot; code in Functions.htm and Kichik's suggestion, I am able to get the name and full path of the calling batch file. Is there a way to just get the name of the calling batch file without it's path?<br />
<br />
Carlos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">30th May 2002, 07:42</div></div><div class="posttext">Modify the code of GetParent to not cut the first part but the last part from the full path. Eg.:<br />
Function GetParentMod <br />
  Exch $0 ; old $0 is on top of stack<br />
  Push $1<br />
  Push $2<br />
  StrCpy $1 -1<br />
  loop:<br />
    StrCpy $2 $0 1 $1<br />
    StrCmp $2 &quot;&quot; exit<br />
    StrCmp $2 &quot;\&quot; exit<br />
    IntOp $1 $1 - 1<br />
  Goto loop<br />
  exit:<br />
    IntOp $1 $1 + 1     ;modified<br />
    StrCpy $0 $0 &quot;&quot; $1  ;modified<br />
    Pop $2<br />
    Pop $1<br />
    Exch $0 ; put $0 on top of stack, restore $0 to original value<br />
FunctionEnd<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">31st May 2002, 01:17</div></div><div class="posttext">Thanks Hendri, I tried the modified Function GetParentMod and it works great under Win95, but when tested under Win 2000, for some strange reason it adds a &quot; at the end of the calling file name (ie: mybatch.bat&quot;).<br />
<br />
Carlos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">31st May 2002, 07:43</div></div><div class="posttext">I don't see the reason why this would happen, but you can always check for this and delete the &quot; if necessary:; Put string<br />
StrCpy $0 'C:\My docs\prob.exe&quot;'<br />
MessageBox MB_OK $0<br />
; Perform check<br />
StrCpy $1 $0 &quot;&quot; -1<br />
StrCmp $1 '&quot;' 0 Done<br />
StrCpy $0 $0 -1<br />
Done:<br />
MessageBox MB_OK $0<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cchian</div><div class="date">1st June 2002, 06:19</div></div><div class="posttext">Great! It now works properly under Win 2000. I still need to test it under a variety of systems. Many thanks to Hendri and those who provided suggestions.<br />
<br />
Carlos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">1st June 2002, 08:46</div></div><div class="posttext">Thx Carlos.<br />
-Hendri.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>