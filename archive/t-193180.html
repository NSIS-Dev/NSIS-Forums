<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Weird System.dll problem..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Weird System.dll problem... NSIS Discussion" />
	
	<title> Weird System.dll problem... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Weird System.dll problem...</div>
<hr />
<div class="pda"><a href="t-193180.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=193180">Weird System.dll problem...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JeronimoColon</div><div class="date">11th September 2004, 07:30</div></div><div class="posttext">If I call an API by itself it works, but if I call the same API followed by a second API the first API fails. :weird: <br />
<br />
What's even stranger is if I call the first API and then DetailPrint a random variable the first API fails. :weird: <br />
<br />
------------------------------------------------<br />
Ex. 1: Uncomment Second API to make fail.<br />
------------------------------------------------<br />
!define APPNAME &quot;Detect New Devices&quot;<br />
!define APPNAMEANDVERSION &quot;Detect New Devices 1.0&quot;<br />
<br />
Name &quot;${APPNAMEANDVERSION}&quot;<br />
InstallDir &quot;$PROGRAMFILES\Detect New Devices&quot;<br />
OutFile &quot;DetectNewDevices.exe&quot;<br />
<br />
!include &quot;MUI.nsh&quot;<br />
<br />
!define MUI_ABORTWARNING<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!insertmacro MUI_RESERVEFILE_LANGDLL<br />
<br />
Section &quot;Detect New Devices&quot; Section1<br />
	SetOverwrite on<br />
	SetOutPath $INSTDIR<br />
	Call GetDevNode<br />
SectionEnd<br />
<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
	!insertmacro MUI_DESCRIPTION_TEXT ${Section1} &quot;&quot;<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
Function GetDevNode<br />
	SetPluginUnload alwaysoff<br />
  StrCpy $1 &quot;&quot;<br />
	System::Call 'setupapi::CM_Locate_DevNodeA(*i .r0, *t r1r1, i r2r2) i .r3'<br />
	;System::Call 'setupapi::CM_Reenumerate_DevNode(*i r0r0, i r4r4) i .r5'<br />
  DetailPrint &quot;Var0: $0&quot;<br />
  DetailPrint &quot;Var1: $1&quot;<br />
  DetailPrint &quot;Var2: $2&quot;<br />
  DetailPrint &quot;Ret Val: $3&quot;<br />
<br />
  SetPluginUnload manual<br />
  System::Free 0<br />
FunctionEnd<br />
------------------------------------------------<br />
Ex. 2: Uncomment DetailPrint &quot;Weird: $5&quot; to make fail<br />
------------------------------------------------<br />
!define APPNAME &quot;Detect New Devices&quot;<br />
!define APPNAMEANDVERSION &quot;Detect New Devices 1.0&quot;<br />
<br />
Name &quot;${APPNAMEANDVERSION}&quot;<br />
InstallDir &quot;$PROGRAMFILES\Detect New Devices&quot;<br />
OutFile &quot;DetectNewDevices.exe&quot;<br />
<br />
!include &quot;MUI.nsh&quot;<br />
<br />
!define MUI_ABORTWARNING<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!insertmacro MUI_RESERVEFILE_LANGDLL<br />
<br />
Section &quot;Detect New Devices&quot; Section1<br />
	SetOverwrite on<br />
	SetOutPath $INSTDIR<br />
	Call GetDevNode<br />
SectionEnd<br />
<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
	!insertmacro MUI_DESCRIPTION_TEXT ${Section1} &quot;&quot;<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
Function GetDevNode<br />
	SetPluginUnload alwaysoff<br />
  StrCpy $1 &quot;&quot;<br />
	System::Call 'setupapi::CM_Locate_DevNodeA(*i .r0, *t r1r1, i r2r2) i .r3'<br />
  DetailPrint &quot;Var0: $0&quot;<br />
  DetailPrint &quot;Var1: $1&quot;<br />
  DetailPrint &quot;Var2: $2&quot;<br />
  DetailPrint &quot;Ret Val: $3&quot;<br />
<br />
	;DetailPrint &quot;Weird: $5&quot;<br />
  SetPluginUnload manual<br />
  System::Free 0<br />
FunctionEnd<br />
------------------------------------------------<br />
<br />
An help on this would be greatly appreciated.<br />
<br />
Thanks.<br />
<br />
jc3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th September 2004, 10:54</div></div><div class="posttext">CM_Locate_DevNode takes a string as the second parameter, not a pointer to a string. CM_Reenumerate_DevNode takes an integer (handle, DEVINST) as the first parameter, not a pointer to an integer.<br />
<br />
You should check the return values, it's the first call that fails, not the second.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JeronimoColon</div><div class="date">12th September 2004, 00:30</div></div><div class="posttext">Thank you for your reply.<br />
<br />
EDITED<br />
I'm still having problems with this, but it looks like it something machine specific where It's working when it shouldn't but isn't when it should.<br />
<br />
I had the change to try this on another PC today and it works properly, but works in the reverse on my laptop.<br />
<br />
Go figure.<br />
<br />
Thanks again.<br />
<br />
jc3</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>