<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ifdef environment variable, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ifdef environment variable NSIS Discussion" />
	
	<title> ifdef environment variable [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ifdef environment variable</div>
<hr />
<div class="pda"><a href="t-215760.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=215760">ifdef environment variable</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">akineko</div><div class="date">12th May 2005, 01:48</div></div><div class="posttext">Hello,<br />
<br />
I have been using NSIS for years but I only used a very basic script (and that was good enough for me).<br />
<br />
Now, my new nsi script is also simple except one requirement:<br />
If a certain environment variable is set, then use it as<br />
a root path. If not, a fallback path is used as a root path.<br />
<br />
Assume the environment variable I'm interested in is &quot;NSIS&quot;.<br />
I tried the following (and many variants):<br />
<br />
!define NSIS $%NSIS%<br />
  <br />
!ifdef NSIS<br />
  InstallDir $NSIS\foo\bar<br />
!else<br />
  InstallDir C:\NSIS\foo\bar<br />
!endif<br />
<br />
//<br />
<br />
It generated a warning and it didn't work.<br />
Obviously I'm doing something stupid. But I couldn't<br />
find any example that checks if the environment is set.<br />
Of course, if I only use InstallDir C:\NSIS\foo\bar, then everything works fine.<br />
<br />
Any suggestions, comments are greatly appreciated!<br />
<br />
Best regards,<br />
Aki Niimura</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th May 2005, 08:16</div></div><div class="posttext">If the variable does not exist the define will be defined as $%NSIS%, without the variable expanded.<br />
<br />
Try this:<br />
!define NSIS $%NSIS%<br />
!define &quot;NSIS_CHECK_${NSIS}&quot;<br />
<br />
!ifndef NSIS_CHECK_$%NSIS%<br />
  InstallDir $%NSIS%\foo\bar<br />
!else<br />
  InstallDir C:\NSIS\foo\bar<br />
!endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">akineko</div><div class="date">12th May 2005, 08:55</div></div><div class="posttext">Hello Joost Verburg,<br />
<br />
Thank you for your prompt response.<br />
I tried but it didn't work as I hoped.<br />
<br />
Now I realized a bigger problem.<br />
I want to check the environment variable not at compilation but at the time when the installer is being executed.<br />
Using !ifdef ... !else ... !endif clause is evaluated at compilation not at installation.<br />
<br />
Probably this means I need to modify $INSTDIR value using StrCpy or something.<br />
<br />
This seems beyond my poor understanding of NSIS tool but I will try tomorrow. I'm sleepy now.<br />
<br />
Using an environment variable is a common trick in Unix but it seems not common to Windows Apps. <br />
<br />
Aki-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th May 2005, 10:11</div></div><div class="posttext">If you want to check it during runtime, it's a lot simpler. Simply use ReadEnvStr or ExpandEnvStrings and check if you got a valid value or not. An invalid value would probably be an empty string. You will indeed have to copy the new value into $INSTDIR using StrCpy. You can do that in .onInit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">akineko</div><div class="date">13th May 2005, 04:50</div></div><div class="posttext">Hello,<br />
<br />
Thank you for the suggestions.<br />
Finally I made my .nsi script do as I intended.<br />
<br />
&gt; If you want to check it during runtime, it's a lot simpler. <br />
<br />
Yes, indeed.<br />
All tricks are (1) Use .onInit Function (2) Environment<br />
variable is &quot;&quot; if not set.<br />
<br />
I'm very glad this is over now.<br />
<br />
Thank you for providing a wonderful tool.<br />
<br />
Best regards,<br />
Aki Niimura</div></div><hr />


<div class="post"><div class="posttop"><div class="username">max_nowak</div><div class="date">11th February 2013, 16:15</div></div><div class="posttext">For all who are interested in validating whether a environment variable is defined or not at compile time, here is what worked for me:<br />
<br />
Function .onInit	#compile time validation<br />
<br />
  !define VERSION $%VERSION%<br />
  !define DOLLAR &quot;$&quot;<br />
   <br />
  !if ${VERSION} == &quot;${DOLLAR}%Version%&quot;<br />
	!error &quot;environment variable 'VERSION' not defined!&quot;<br />
  !endif<br />
Since ${VERSION} and $%VERSION% would always be the same, also when the environment variable is not defined, you simply define the &quot;$&quot; separately and concatenate them again in the static comparison. Otherwise the expression $%VERSION% always gonna be replaced by the value of the environment variable.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>