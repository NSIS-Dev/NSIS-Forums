<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS2.0b1 bug with InstallDir, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS2.0b1 bug with InstallDir NSIS Discussion" />
	
	<title> NSIS2.0b1 bug with InstallDir [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS2.0b1 bug with InstallDir</div>
<hr />
<div class="pda"><a href="t-125369.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125369">NSIS2.0b1 bug with InstallDir</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">17th February 2003, 10:51</div></div><div class="posttext">i got a script that queries the registry for the path of some software. since i upgraded to b1, i get the following bug:<br />
<br />
instead of displaying C:\Program Files\Software, it leaves the &quot;:&quot; and displays C\Program Files\Software instead.<br />
ReadRegStr $3 HKLM \<br />
              &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\Winamp3&quot; \<br />
              &quot;UninstallString&quot;<br />
StrCmp $3 &quot;&quot; Winamp2Check StripPath3<br />
<br />
Winamp2Check:<br />
ReadRegStr $2 HKLM \<br />
              &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\Winamp&quot; \<br />
              &quot;UninstallString&quot;<br />
StrCmp $2 &quot;&quot; End StripPath2<br />
<br />
StripPath3:<br />
      StrCpy $INSTDIR $3<br />
      Call StripPath<br />
      Goto End<br />
please help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th February 2003, 13:28</div></div><div class="posttext">Can you please attach the entire script so I can see StripPath too?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dirtydingus</div><div class="date">17th February 2003, 17:43</div></div><div class="posttext">This seems to be similar to the $EXEDIR bug (http://forums.winamp.com/showthread.php?s=&amp;threadid=125405) I just reported, although the $EXEDIR bug only occurs when $EXEDIR is the root of a drive.<br />
<br />
DD</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">19th February 2003, 11:40</div></div><div class="posttext">;StripPath function by Frank Nagel<br />
Function StripPath<br />
  Push $8<br />
  Push $9<br />
  StrCmp $INSTDIR &quot;&quot; fin<br />
<br />
    StrCpy $8 $INSTDIR 1 0 ; get firstchar<br />
    StrCmp $8 '&quot;' &quot;&quot; getparent <br />
      ; if first char is &quot;, let's remove &quot;'s first.<br />
      StrCpy $INSTDIR $INSTDIR &quot;&quot; 1<br />
      StrCpy $8 0<br />
      rqloop:<br />
        StrCpy $9 $INSTDIR 1 $8<br />
        StrCmp $9 '&quot;' rqdone<br />
        StrCmp $9 &quot;&quot; rqdone<br />
        IntOp $8 $8 + 1<br />
        Goto rqloop<br />
      rqdone:<br />
      StrCpy $INSTDIR $INSTDIR $8<br />
    getparent:<br />
    ; the uninstall string goes to an EXE, let's get the directory.<br />
    StrCpy $8 -1<br />
    gploop:<br />
      StrCpy $9 $INSTDIR 1 $8<br />
      StrCmp $9 &quot;&quot; gpexit<br />
      StrCmp $9 &quot;\&quot; gpexit<br />
      IntOp $8 $8 - 1<br />
      Goto gploop<br />
    gpexit:<br />
    StrCpy $INSTDIR $INSTDIR $8<br />
<br />
    <br />
  fin:<br />
  Pop $9<br />
  Pop $8<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th February 2003, 16:01</div></div><div class="posttext">This function is no longer useful. I don't know which part exactly ruins it but the first part is useless because NSIS takes care of the quotes now and the second part does nothing but copying $INSTDIR to $INSTDIR. You can safely remove that function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">19th February 2003, 17:11</div></div><div class="posttext">but my registry entry points to an .EXE file, but i just need the path</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th February 2003, 17:34</div></div><div class="posttext">OK. What you need to do is to first parse the install directory you get from the registry first and only then copy it to $INSTDIR. The problem is that $INSTDIR is automatically corrected and therefore can neveer contain any invalid data such as what you insert into it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>