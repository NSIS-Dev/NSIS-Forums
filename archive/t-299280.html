<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MultiUser support and InstallDir, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MultiUser support and InstallDir NSIS Discussion" />
	
	<title> MultiUser support and InstallDir [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MultiUser support and InstallDir</div>
<hr />
<div class="pda"><a href="t-299280.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=299280">MultiUser support and InstallDir</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Richard_P</div><div class="date">28th October 2008, 19:08</div></div><div class="posttext">Hello,<br />
<br />
I have 2 issues with using MultiUser.nsh and setting installation directory:<br />
<br />
1. Command line parameter /D is ignored when using macro MULTIUSER_INIT. Path from parameter /D is overriden by MULTIUSER_INSTALLMODE_INSTDIR_x defines for setting INSTDIR. I need parameter /D to have highest priority.<br />
<br />
2. When string from registry is found by defines MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_x, MultiUser support sets INSTDIR including file name. This is different behavior from InstallDirRegKey, that removes file name.<br />
<br />
It's simple to workaround the second issue, but don't know how to solve the first one.<br />
<br />
Thanks for any help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">28th October 2008, 21:06</div></div><div class="posttext">I haven't played with MultiUser (haven't really had a need).  But, if I'm reading the documnetation correctly, the install directory is set by defining MULTIUSER_INSTALLMODE_INSTDIR before using !insertmacro MULTIUSER_INIT.  (Hopefully, that's right.)<br />
<br />
If so, here's something you might try:<br />
!include LogicLib.nsh<br />
!include FileFunc.nsh<br />
!insertmacro GetParameters<br />
!insertmacro GetOptions<br />
var MyInstDir<br />
...<br />
<br />
Function .onInit<br />
   ${GetParameters} $0<br />
   ${GetOptions} &quot;$0&quot; &quot;\D&quot; $1<br />
   ${If} &quot;$1&quot; == &quot;&quot;<br />
      ; no command line, so set default dir here:<br />
      StrCpy $MyInstDir &quot;C:\default_Directory&quot;<br />
   ${Else}<br />
      StrCpy $MyInstDir &quot;$1&quot;<br />
   ${EndIf}<br />
   !define MULTIUSER_INSTALLMODE_INSTDIR &quot;$MyInstDir&quot;<br />
   !insertmacro MULTIUSER_INIT<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Richard_P</div><div class="date">29th October 2008, 10:41</div></div><div class="posttext">Thanks, I got it. I used custom parameter /INSTDIR instead of native /D, that can't be extracted by GetParameters (see documentation for Variables, $CMDLINE).<br />
<br />
!define MULTIUSER_INSTALLMODE_INSTDIR &quot;MyAppDefaultDir&quot;<br />
!define MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_KEY &quot;MyAppRegKey&quot;<br />
!include &quot;MultiUser.nsh&quot;<br />
<br />
!include FileFunc.nsh<br />
!insertmacro GetParameters<br />
!insertmacro GetOptions<br />
Var cmdLineInstallDir<br />
<br />
Function .onInit<br />
  ${GetParameters} $0<br />
  ClearErrors<br />
  ${GetOptions} '$0' &quot;/INSTDIR=&quot; $1<br />
  IfErrors +2<br />
  StrCpy $cmdLineInstallDir $1<br />
  ClearErrors<br />
<br />
  !insertmacro MULTIUSER_INIT<br />
<br />
  StrCmp $cmdLineInstallDir &quot;&quot; +2<br />
  StrCpy $INSTDIR $cmdLineInstallDir<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">29th October 2008, 19:44</div></div><div class="posttext">Originally posted by Richard_P <br />
Thanks, I got it. I used custom parameter /INSTDIR instead of native /D, that can't be extracted by GetParameters (see documentation for Variables, $CMDLINE).<br />
 <br />
Good catch!  (Goes to show I don't mess with that too often, huh?  ;) )<br />
<br />
I'm glad you got it to work!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>