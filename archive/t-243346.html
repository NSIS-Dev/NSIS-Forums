<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" LZMA - BCJ Filter Patch, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  LZMA - BCJ Filter Patch NSIS Discussion" />
	
	<title> LZMA - BCJ Filter Patch [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  LZMA - BCJ Filter Patch</div>
<hr />
<div class="pda"><a href="t-243346.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=243346">LZMA - BCJ Filter Patch</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">lkj</div><div class="date">13th April 2006, 10:42</div></div><div class="posttext">http://www.7-zip.org/alpha/nsis216bcj-2.zip<br />
<br />
Patch features:<br />
<br />
1) Updating for LZMA SDK 4.37.<br />
2) BCJ filter before LZMA compressing.<br />
<br />
BCJ filter allows to increase compression ratio for x86 executables on 6-8%.<br />
BCJ filter converts CALL and JUMP instructions from relative offsets to <br />
absolute addresses, so such data become more compressible.<br />
<br />
How to use<br />
----------<br />
<br />
You can specify <br />
  SetCompressorFilter 1<br />
or<br />
  SetCompressorFilter 0<br />
<br />
If you specify &quot;SetCompressorFilter 1&quot;, LZMA encoder uses BCJ filter.<br />
<br />
Example:<br />
<br />
  SetCompressor /solid lzma<br />
  SetCompressorDictSize 8<br />
  SetCompressorFilter 1<br />
<br />
---<br />
Igor Pavlov<br />
http://www.7-zip.org</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th April 2006, 13:50</div></div><div class="posttext">Wow nice work!<br />
I'll do some benchmarks later :] I'll also try and get hold of kichik and let him know.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">13th April 2006, 18:01</div></div><div class="posttext">Do you have to use the /solid flag to use the BCJ filter? In other words, will this work?<br />
<br />
SetCompressor lzma<br />
SetCompressorFilter 1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">13th April 2006, 18:21</div></div><div class="posttext">When will 7zip be able to open nsis-lzma files?<br />
Total Commander can do the most with plugin (search forum),<br />
but not all of them and then it extract damaged files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th April 2006, 20:35</div></div><div class="posttext">This basic installer crashes when ran:<br />
<br />
Name &quot;Testing&quot;<br />
OutFile &quot;testing.exe&quot;<br />
<br />
!include MUI.nsh<br />
<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
Section<br />
SectionEnd<br />
<br />
<br />
Windows XP.<br />
Put old makensis and stubs back and it doesn't crash anymore.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ggf</div><div class="date">27th April 2006, 00:34</div></div><div class="posttext">Originally posted by Afrow UK <br />
This basic installer crashes when ran  [...]  Put old makensis and stubs back and it doesn't crash anymore. <br />
<br />
LZMA and Bzip2 work fine but the installer crashes if SetCompressor is Zlib. <br />
The patch is already used in 7-zip saving 40KB.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd May 2006, 12:00</div></div><div class="posttext">Igor, thank you for your patch.<br />
<br />
The zlib crash probably happens because of the second parameter passed to inflate. Try using #ifdef NSIS_COMPRESS_USE_LZMA around that change to make it take affect only for lzma. You could also simply use the old zlib stub.<br />
<br />
As far as I can tell, it'll work better without solid compression. It seems to use the filter on the entire compressed block and not on a file by file base. This happens because the filter is set in the compressor itself and not when the file is added outside of the compressor.<br />
<br />
The filter's location also makes it work only for lzma and not other compressions. This is why I'd rather keep this as a patch for now. Igor said he won't update it for newer versions, but the changes are simple enough to work for future versions. I don't think there'll be any large scale change that'll render this patch invalid in the near future.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>