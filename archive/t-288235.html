<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Improve NSIS unpacking, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Improve NSIS unpacking NSIS Discussion" />
	
	<title> Improve NSIS unpacking [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Improve NSIS unpacking</div>
<hr />
<div class="pda"><a href="t-288235.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288235">Improve NSIS unpacking</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">********</div><div class="date">10th March 2008, 13:39</div></div><div class="posttext">Is it possible to improve unpacking algorithm for NSIS installers in 7-Zip tool to restore original path relative to installdir directory? I understand that some paths are dynamically calculated, but are they calculated at compile time or during installation?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th March 2008, 20:33</div></div><div class="posttext">I don't understand what you're asking for. The compression algorithm used and the paths where files are extracted are completely unrelated. Could you provide an example for clarity?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th March 2008, 21:50</div></div><div class="posttext">Paths can depend on variables that are set at run-time. In such cases it's impossible to obtain a location from installer file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">********</div><div class="date">2nd September 2008, 12:06</div></div><div class="posttext">Originally posted by kichik <br />
I don't understand what you're asking for. <br />
I often use 7-Zip to get a file or two from my old NSIS installations for testing. Recently I decided to implement some automation for extracting these files. With ordinary archive, filepath relative to InstallDir is enough to get the file out of distribution. With NSIS it is not true.<br />
<br />
One improvement is to detect when one file is added to several directories. <br />
<br />
  SetOutPath $INSTDIR<br />
  File example1.nsi<br />
  SetOutPath $INSTDIR\Kewl<br />
  File example1.nsi<br />
<br />
In archive listing there will be only one entry of example1.nsi at root.<br />
<br />
I understand that some paths are dynamically calculated at runtime, but these are rare. Most paths depends on unconditional combination of static strings that can be calculated relative to InstallDir at compile time. For example, when two strings are unconditionally assigned static values in some block and concatenated afterwards then resulting string is also static. I.e.<br />
<br />
  StrCpy $mydir &quot;$INSTDIR\Kewl&quot;<br />
  SetOutPath $mydir<br />
  File example2.nsi<br />
<br />
This could create &quot;Kewl\example2.nsi&quot; entry inside archive instead of &quot;$[32]\example2.nsi&quot;  Here is &quot;unconditional assignment&quot; - $mydir is initialized as constant and there is no branching that could make it contain different value until it is used in SetOutPath.<br />
<br />
If the function receives only the same string variable that is written only once during script lifetime with the same constant value then this parameter to function can also be calculated as constant.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2008, 11:57</div></div><div class="posttext">So you're suggesting a static analysis of the code to remove redundant assignments and parameter passing? It's a great feature and I do plan for it with the nobjs branch. That said, it's far from a simple task and has much more use at optimization rather than making file extraction easier for external applications. I suggest you find a better solution for keeping your original files rather than modifying the installer or compiler's behavior. It's out of their scope.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">********</div><div class="date">5th September 2008, 12:50</div></div><div class="posttext">Yes, I think it can be called static analysis and I am glad you considered it a great feature. The idea of marking bundled file paths as being static or dynamic is just a single use case, but it would be nice to see it at least partially working. NSIS in not an SFX archiver, of course, and extracting files from an installer is more like occasional feature, but it also appeared very useful feature in my case.  =)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>