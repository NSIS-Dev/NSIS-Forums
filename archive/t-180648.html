<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Excel Add-ins, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Excel Add-ins NSIS Discussion" />
	
	<title> Excel Add-ins [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Excel Add-ins</div>
<hr />
<div class="pda"><a href="t-180648.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=180648">Excel Add-ins</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jbaylor</div><div class="date">20th May 2004, 18:41</div></div><div class="posttext">I used NSIS a few years ago to distribute an application and it worked very well.  Now I am working on a small Excel add-in for a customer to distribute to their clients.  I have become reacquainted with the scripting language and have learned about the modern UI (it looks great!).  The only thing I am having trouble with is on the Microsoft end, registering the add-in.  Has anyone done this with NSIS before?<br />
<br />
Thanks,<br />
Jeff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th May 2004, 19:46</div></div><div class="posttext">I think you'll have to write to HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\Excel\Addins</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jbaylor</div><div class="date">20th May 2004, 20:44</div></div><div class="posttext">Thank you for your suggestion.  I will give it a try and let you know how it goes.<br />
<br />
Jeff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">routing</div><div class="date">26th October 2004, 15:40</div></div><div class="posttext">Hi Jbaylor,<br />
<br />
 would you email me your script about excel add-in?<br />
I have the same question.<br />
I appreciate it very much.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jbaylor</div><div class="date">26th October 2004, 21:50</div></div><div class="posttext">I spent a few hours working on it and decided that I was spending more money than it was worth.  I decided to just popup a CHM file with step-by-step instructions and images to guide the user through the final steps by hand (go to [Tools][Add-Ins], etc.).  I investigated other add-ins and could not find a better way.  If your add-in is COM based you should be able to use a registry approach, but I needed to keep the macros in VBA.<br />
<br />
If anyone else has a solution, I am still very interested.  I ran out of patience with it though.<br />
<br />
Best of luck.<br />
<br />
Regards,<br />
<br />
Jeff Baylor<br />
bConverged.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">routing</div><div class="date">29th October 2004, 19:07</div></div><div class="posttext">My Add-ins works with .msi. But if I use nullsoft, it doesn't work. The registry shows that there is no different (the key is same) of both packages.  I spent a week working on it and did not get solution. Who can help me?<br />
I appreciate it very much.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jbaylor</div><div class="date">29th October 2004, 20:19</div></div><div class="posttext">Unless your add-in is COM-based, I do not think there is a registry solution.  I spent a lot of time adding VBA add-ins and then diffing my registry and was not finding an answer.  I am sure there is a way to do it, there are installation products that claim to, but I have not managed it yet.  The path I started down which seemed to have the most potential was to write a COM app that would start an Excel process in the background and register it programmatically.  I only allotted a fixed number of hours to the project and installing the add-in was taking up more time than writing it, so I stopped.  If it is important to have the install done programmatically, I would write a C++ app that does it for you and call it from NSIS.<br />
<br />
Good luck,<br />
<br />
Jeff Baylor<br />
bConverged.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">routing</div><div class="date">29th October 2004, 20:44</div></div><div class="posttext">Jeff,<br />
Yes. My add-in is COM-based. I also want to have the install done programmatically.<br />
Thank you very much for your quickly response.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jbaylor</div><div class="date">29th October 2004, 21:48</div></div><div class="posttext">Check out these MS help pages.  They may point you in the right direction.<br />
<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/modcore/html/deovrLoadingExcelAddin.asp<br />
http://support.microsoft.com/default.aspx?scid=kb;EN-US;q280290<br />
<br />
There is also a registry key which MS claims will have the add-ins listed.  I suspect that this is only used for COM add-ins.  I currently have three VBA add-ins loaded and this is empty.<br />
<br />
HKEY_CURRENT_USER\Software\Microsoft\Office\10.0\Excel\Add-in Manager<br />
<br />
Regards,<br />
Jeff Baylor<br />
bConverged.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">routing</div><div class="date">2nd November 2004, 15:12</div></div><div class="posttext">Jeff, Thank you so much for your help.<br />
<br />
I still have trouble in NSIS.<br />
I wrote my Add-In in .NET 2003 with C#.<br />
It works well with .msi installer created by .NET 2003.<br />
I want to use NSIS to create an installer of it.<br />
However, the NSIS installer does not work ( there is no tool bar of my Add-In in Office application. I could see the tool bar if I used .msi installer.).<br />
I'm wondering if I miss something in building NSIS installer. I added the key in NSIS script. I checked the registry. The key existed in registry. Could anyone give me some suggestions?<br />
<br />
I appreciate it very much.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kc311man</div><div class="date">9th March 2005, 20:39</div></div><div class="posttext">I think I got it. There's like 5 different places where UIDs are used to identify your plugin. My registry entries in NSIS ended up looking like this:<br />
-----------------------------------------------------<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect&quot; &quot;FriendlyName&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect&quot; &quot;Description&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegDWORD HKCU &quot;Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect&quot; &quot;LoadBehavior&quot; &quot;00000003&quot;<br />
  WriteRegDWORD HKCU &quot;Software\Microsoft\Office\Outlook\Addins\COMAddin.Connect&quot; &quot;CommandLineSafe&quot; &quot;00000000&quot;<br />
  <br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}&quot; &quot;&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Implemented Categories\{40FC6ED5-2438-11CF-A3DB-080036F12502}&quot; &quot;&quot; &quot;&quot;<br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32&quot; &quot;&quot; &quot;$INSTDIR\COMAddin.dll&quot;<br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32&quot; &quot;ThreadingModel&quot; &quot;Apartment&quot;<br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\ProgID&quot; &quot;&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Programmable&quot; &quot;&quot; &quot;&quot;<br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\TypeLib&quot; &quot;&quot; &quot;{CDC4D4CA-F710-42B3-A53E-4139A271AE24}&quot;<br />
  WriteRegStr HKCR &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\VERSION&quot; &quot;&quot; &quot;1.0&quot;<br />
  WriteRegStr HKCR &quot;COMAddin.Connect&quot; &quot;@&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegStr HKCR &quot;COMAddin.Connect\Clsid&quot; &quot;@&quot; &quot;{44408B38-B310-4BC9-9275-084BE741D1E5}&quot;<br />
  WriteRegStr HKCR &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0&quot; &quot;&quot; &quot;COMAddin&quot;<br />
  WriteRegStr HKCR &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\0\win32&quot; &quot;&quot; &quot;$INSTDIR\COMAddin.dll&quot;<br />
  WriteRegStr HKCR &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\FLAGS&quot; &quot;&quot; &quot;0&quot;<br />
  WriteRegStr HKCR &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\HELPDIR&quot; &quot;&quot; &quot;$INSTDIR&quot;<br />
  <br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}&quot; &quot;&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Implemented Categories\{40FC6ED5-2438-11CF-A3DB-080036F12502}&quot; &quot;&quot; &quot;&quot;<br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32&quot; &quot;&quot; &quot;$INSTDIR\COMAddin.dll&quot;<br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\InprocServer32&quot; &quot;ThreadingModel&quot; &quot;Apartment&quot;<br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\ProgID&quot; &quot;&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\Programmable&quot; &quot;&quot; &quot;&quot;<br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\TypeLib&quot; &quot;&quot; &quot;{CDC4D4CA-F710-42B3-A53E-4139A271AE24}&quot;<br />
  WriteRegStr HKLM &quot;CLSID\{44408B38-B310-4BC9-9275-084BE741D1E5}\VERSION&quot; &quot;&quot; &quot;1.0&quot;<br />
  WriteRegStr HKLM &quot;SOFTWARE\Classes\COMAddin.Connect&quot; &quot;&quot; &quot;COMAddin.Connect&quot;<br />
  WriteRegStr HKLM &quot;SOFTWARE\Classes\COMAddin.Connect\Clsid&quot; &quot;&quot; &quot;{44408B38-B310-4BC9-9275-084BE741D1E5}&quot;<br />
  WriteRegStr HKLM &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0&quot; &quot;&quot; &quot;COMAddin&quot;<br />
  WriteRegStr HKLM &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\0\win32&quot; &quot;&quot; &quot;$INSTDIR\COMAddin.dll&quot;<br />
  WriteRegStr HKLM &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\FLAGS&quot; &quot;&quot; &quot;0&quot;<br />
  WriteRegStr HKLM &quot;TypeLib\{CDC4D4CA-F710-42B3-A53E-4139A271AE24}\1.0\HELPDIR&quot; &quot;&quot; &quot;$INSTDIR&quot;<br />
-----------------------------------------------------<br />
Hope This Helps - Ryan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kc311man</div><div class="date">23rd June 2005, 21:06</div></div><div class="posttext">The previous post is wrong but I figured it out finally! Basically, you just register the dll and then you add a few registry entries under  HKCU\Software\Microsoft\Office\Outlook\Addins\<br />
<br />
The code looks like this:<br />
-------------------------------------------------------<br />
  Exec 'regsvr32.exe /s &quot;$INSTDIR\MyCOMAddIn.dll&quot;'<br />
<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect&quot; &quot;FriendlyName&quot; &quot;MyCOMAddIn.Connect&quot;<br />
  WriteRegStr HKCU &quot;Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect&quot; &quot;Description&quot; &quot;MyCOMAddIn&quot;<br />
  WriteRegDWORD HKCU &quot;Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect&quot; &quot;LoadBehavior&quot; &quot;00000003&quot;<br />
  WriteRegDWORD HKCU &quot;Software\Microsoft\Office\Outlook\Addins\MyCOMAddIn.Connect&quot; &quot;CommandLineSafe&quot; &quot;00000000&quot;<br />
-----------------------------------------------<br />
You would replace MyCOMAddIn with whatever you set your PROGID to be in your dll.<br />
<br />
Sorry about the confusion - Ryan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsierra</div><div class="date">17th March 2006, 01:39</div></div><div class="posttext">I also spent a lot of time looking for a solution.  I was finally able to piece something together using a couple of simple VBS scripts and the nsExec plugin.  I wrote one VB script to enable the plugin and another to disable the plugin.  Here are the basic lines of VBS that enable the AddIn:<br />
  Set objXL = WScript.CreateObject(&quot;Excel.Application&quot;)<br />
  objXL.AddIns(&quot;Addin Name&quot;).Installed = True<br />
  objXL.Quit<br />
<br />
The .NSI has something like this:<br />
  ;Copy the XLA Installer<br />
  File &quot;${XLA_INSTALLER}&quot;<br />
<br />
  ;Execute the installer<br />
  nsExec::Exec '&quot;$SYSDIR\wscript.exe&quot; &quot;$INSTDIR\${XLA_INSTALLER}&quot;'<br />
<br />
  ;Delete the installer<br />
  Delete &quot;$INSTDIR\${XLA_INSTALLER}&quot;<br />
<br />
I've attached a zip with the .NSI script and the two VB scripts.  To use it just modify the constants at the top of the .NSI file.  I hope this helps someone some day.  :)  I know I was having the hardest time finding any help on it, so I wanted to be sure to document my solution somewhere.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dgp</div><div class="date">26th April 2006, 19:37</div></div><div class="posttext">I also recently tackled this problem. I looked into using a VBA installer to avoid having to tackle the Excel Add-in Manager registry mess. However, I was concerned that the VBA solution would not be robust. Default Office 2003 security settings will not even ask the user if they want to enable macros (VBA) so there's a good chance that the VBA code would not run. <br />
<br />
I came up with the attached script to work with the registry and install the Add-in (I hope attaching scripts is acceptable in this forum?). This is my first installer script - it's not pretty but it seems to do the job. Any advice on improving the script is appreciated. I should mention that this is for installing a VBA Add-in, the registry keys are different for installing a COM Add-in.<br />
<br />
PS: Also posting to microsoft.public.excel.programming newsgroup since I've seen this question asked several times without an adequate answer. <br />
<br />
Dave</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsierra</div><div class="date">20th June 2006, 16:04</div></div><div class="posttext">dgp's solution works great!  A much more elegant solution than what I did, by creating some vbs files to do the installation.   Thanks for posting your .nsi!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jsinnreich</div><div class="date">26th February 2009, 13:44</div></div><div class="posttext">Thanks dgp for the registration code.  <br />
<br />
One follow-up question, does anyone have any good suggestions on how to determine the Add-ins folder, where to extract the VBA add-in I'm installing?  On XP and 2000 machines, it's C:\Documents &amp; Settings\user\Application Data\Microsoft\Addins\, on Vista machines it's C:\Users\user\AppData\Roaming\Microsoft\Addins\.  Is there anything like a &quot;$ADDINDIR&quot; system-defined directory, or do I have to code it manually?<br />
<br />
Thanks,<br />
Jon</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>