<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Custom InstType, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Custom InstType NSIS Discussion" />
	
	<title> Custom InstType [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Custom InstType</div>
<hr />
<div class="pda"><a href="t-279052.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279052">Custom InstType</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">localmatters</div><div class="date">15th October 2007, 22:09</div></div><div class="posttext">I'm looking to allow the end user the ability to select install types from the drop down list OR enable them to select the sections from the component list.  The selection from the drop down corresponds to the section checked in the component list...they're one and the same (you can liken it to a 1-1 relationship).  So, I've included the custom insttype, and used the logic from the one-section.nsi example.  This works fine, except I really don't need the &quot;Custom&quot; option appearing in the insttype drop down list.  How do I remove this value and still have the user do EITHER/OR: EITHER select from the drop down list OR check the section from the components box?  I am aware that I can just have the drop down list and eliminate the component list, but the client desires to have both available.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th October 2007, 00:06</div></div><div class="posttext">Selection in the components tree is disabled when you use InstType /NOCUSTOM. You can hack around this by setting the Custom text to nothing or even removing it from the drop down by sending CB_DELETESTRING.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">localmatters</div><div class="date">16th October 2007, 15:37</div></div><div class="posttext">Thanks for your prompt response.  Your first suggestion is an option I can use, however, I'd rather your second suggestion.  It's cleaner.  The only thing is, I'm not sure how to go about sending the CB_DELETESTRING message out for the drop down combo box.  Do you have an example I can work with?  I attempted the following in the .onInit function, but it failed to render correct results:<br />
-----------------------------------<br />
Push $R0<br />
<br />
FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $R0 $R0 1017<br />
SendMessage $R0 ${CB_DELETESTRING} -1 &quot;STR:Custom&quot;<br />
<br />
Pop $R0<br />
------------------------------------<br />
What am I doing wrong?  Appreciate your help in this regard.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th October 2007, 22:41</div></div><div class="posttext">That piece of code should work, only it should be called when the dialog is visible and not in .onInit. You should call it in the show callback function of the components page. Try MessageBox'ing $R0 to make sure you get the correct handle. You can also hide the window using ShowWindow to verify.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">localmatters</div><div class="date">17th October 2007, 16:26</div></div><div class="posttext">I just can't get this to work...I appear to be retrieving the incorrect item_id.  How do I get the correct item_id of the combo box?  Plus, how do I get to the &quot;show&quot; callback function of the components page?  Once again, thanks for your help in this matter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th October 2007, 19:53</div></div><div class="posttext">You're using the correct control identifier. But that won't help you if you're not calling it in the proper context which is the show callback function. If you don't call it from there, the dialog and the control itself don't even exist.<br />
<br />
I'll assume you're using the MUI and therefore you need MUI_PAGE_CUSTOMFUNCTION_SHOW.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">localmatters</div><div class="date">17th October 2007, 20:57</div></div><div class="posttext">Thanks!  That helps...one thing though, when do I declare this function?  After !define MUI_STARTMENUPAGE statement and before !define MUI_FINISHPAGE_NOREBOOTSUPPORT?  I inserted it before the below and got a compile error.<br />
<br />
;--------------------------------<br />
;Modern UI Configuration<br />
<br />
  !define MUI_WELCOMEPAGE<br />
  !define MUI_COMPONENTSPAGE<br />
  !define MUI_DIRECTORYPAGE<br />
  !define MUI_STARTMENUPAGE<br />
  !define MUI_FINISHPAGE_NOREBOOTSUPPORT<br />
  !define MUI_ABORTWARNING<br />
  !define MUI_UNINSTALLER<br />
  !define MUI_UNCONFIRMPAGE<br />
;  !define MUI_COMPONENTSPAGE_NODESC<br />
<br />
<br />
  <br />
;--------------------------------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th October 2007, 21:01</div></div><div class="posttext">As the Modern UI readme states, right before inserting the components page macro.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">localmatters</div><div class="date">17th October 2007, 21:28</div></div><div class="posttext">The thing is I don't have &quot;!insertmacro MUI_PAGE_COMPONENTS&quot; macro inserted anywhere in my NSI file...(I inherited this file from an ex-developer).  Therefore, I attempted the below:<br />
<br />
;--------------------------------<br />
;Modern UI Configuration<br />
<br />
  !define MUI_WELCOMEPAGE<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW delete_customstring<br />
<br />
	Function delete_customstring<br />
	  Push $R0<br />
	<br />
	  FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	  GetDlgItem $R0 $R0 1017<br />
	  SendMessage $R0 ${CB_DELETESTRING} -1 &quot;STR:Custom&quot;<br />
	  <br />
	  Pop $R0<br />
	FuncionEnd<br />
  !define MUI_COMPONENTSPAGE<br />
  !define MUI_DIRECTORYPAGE<br />
  !define MUI_STARTMENUPAGE<br />
  !define MUI_FINISHPAGE_NOREBOOTSUPPORT<br />
  !define MUI_ABORTWARNING<br />
  !define MUI_UNINSTALLER<br />
  !define MUI_UNCONFIRMPAGE<br />
  ;!define MUI_COMPONENTSPAGE_NODESC<br />
;--------------------------------<br />
<br />
and still got a compile error.  The version of Nullsoft I have is 2.0b3.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th October 2007, 21:37</div></div><div class="posttext">2.0b3? That's older than me... :)<br />
<br />
You'd have to look in your version's readme file for the definition of this function or upgrade.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">localmatters</div><div class="date">18th October 2007, 16:27</div></div><div class="posttext">Kichik:<br />
<br />
Thanks a bunch for all your help!  I finally got it to work!  This is what was needed (the SendMessage wparam parameter needs the index of the item to be deleted from the combo box):<br />
------------------------------<br />
;Modern UI Configuration<br />
<br />
  !define MUI_WELCOMEPAGE	<br />
  !define MUI_COMPONENTSPAGE<br />
  !define MUI_CUSTOMFUNCTION_COMPONENTS_SHOW myCustomFunc<br />
<br />
	Function myCustomFunc<br />
	  Push $R0<br />
	<br />
	  FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	  GetDlgItem $R0 $R0 1017<br />
	  ;ShowWindow $R0 ${SW_HIDE}<br />
<br />
	  SendMessage $R0 ${CB_DELETESTRING} 3 &quot;STR:Custom&quot;<br />
	  <br />
	  Pop $R0<br />
	FunctionEnd<br />
<br />
-----------------------------<br />
<br />
Once again, thanks for helping me see the light at the end of the tunnel.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>