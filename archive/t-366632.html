<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" While Loop not working as expected..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  While Loop not working as expected... NSIS Discussion" />
	
	<title> While Loop not working as expected... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  While Loop not working as expected...</div>
<hr />
<div class="pda"><a href="t-366632.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=366632">While Loop not working as expected...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">17th July 2013, 20:51</div></div><div class="posttext">Hi,<br />
<br />
I've been working with NSIS for quite some time now and rarely ran into an issue which left me totally clueless. In fact this forum and the documentation solved pretty much all questions so far.<br />
<br />
With this one though I am out of ideas. All the variables are defined in an external NSH file which is being included, that worked like a charm so far.<br />
<br />
My input variables are...<br />
<br />
!define PRODUCT_TYPE &quot;ABC&quot;<br />
<br />
!define DISTRIB_WEBSITES_ABC &quot;3&quot;<br />
<br />
!define DISTRIB_WEBSITE1_TXT_ABC &quot;Website Title 1&quot;<br />
!define DISTRIB_WEBSITE1_URL_ABC &quot;http://www.example1.com&quot;<br />
!define DISTRIB_WEBSITE2_TXT_ABC &quot;Website Title 2&quot;<br />
!define DISTRIB_WEBSITE2_URL_ABC &quot;http://www.example2.com&quot;<br />
!define DISTRIB_WEBSITE3_TXT_ABC &quot;Website Title 3&quot;<br />
!define DISTRIB_WEBSITE3_URL_ABC &quot;http://www.example3.com&quot;<br />
<br />
<br />
The PRODUCT_TYPE defined varies depending on which installer I want to compile, the remaining variables are static - though the number of links varies hence the following while loop...<br />
<br />
<br />
  StrCpy $R1 &quot;${DISTRIB_WEBSITES_${PRODUCT_TYPE}}&quot;<br />
  ${While} $R1 &gt; 0<br />
    WriteIniStr &quot;$SMPROGRAMS\${PRODUCT_NAME} ${PRODUCT_TYPE}\Links\${DISTRIB_WEBSITE$R1_TXT_${PRODUCT_TYPE}}.url&quot; &quot;InternetShortcut&quot; &quot;URL&quot; &quot;${DISTRIB_WEBSITE$R1_URL_${PRODUCT_TYPE}}&quot;<br />
    IntOp $R1 $R1 - 1<br />
  ${EndWhile}<br />
<br />
<br />
...once I run this NSIS instead of creating the LNKs with the proper text/url comes up with literally my variable name as TXT and URL.<br />
<br />
&quot;${DISTRIB_WEBSITE1_TXT_ABC}.LNK&quot; &gt; &quot;http://${DISTRIB_WEBSITE1_URL_ABC}&quot;<br />
&quot;${DISTRIB_WEBSITE2_TXT_ABC}.LNK&quot; &gt; &quot;http://${DISTRIB_WEBSITE2_URL_ABC}&quot;<br />
&quot;${DISTRIB_WEBSITE3_TXT_ABC}.LNK&quot; &gt; &quot;http://${DISTRIB_WEBSITE3_URL_ABC}&quot;<br />
<br />
Since the numbers are there I can assume that my loop works fine but why doesn't it put the proper details in as text/url? Do I have a general brain fart here and this an issue of the while loop working different between compile time and installation?<br />
<br />
P.S.: To clarify, I am running NSIS 3.0a1 - worth testing the old versions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">17th July 2013, 22:19</div></div><div class="posttext">You're using a variable ($R1) in a define name (${DISTRIB_WEBSITE$R1_TXT_${PRODUCT_TYPE}}).<br />
That's not going to work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">17th July 2013, 22:21</div></div><div class="posttext">Got an idea/hint on how to do this instead?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">17th July 2013, 22:21</div></div><div class="posttext">I think the best approach for you is using an array, filled with websites and titles.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">17th July 2013, 22:29</div></div><div class="posttext">Defines are not variables, they are symbols replaced with their value at compile time. And variables are set at runtime. So ${something_$R1} can't have a defined value and the compiler treats it as a string with a variable in it.<br />
There was a question about the same problem recently and a solution was suggested; it may be worth implementing if you have lots of defines to process:<br />
http://forums.winamp.com/showthread.php?t=365124<br />
<br />
[Edit] You got the answer while I was writing mine. Sorry jpderuiter, I didn't see your posts; that's twice already. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">18th July 2013, 16:11</div></div><div class="posttext">Thank you aerDNA for the elaboration, using a batchfile IMO is anything but a clean approach. For the meanwhile I will to stick to hard coding those lines - thanks to both of you for the comments.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">18th July 2013, 16:41</div></div><div class="posttext">Another possibility: a txt file with the list. Extract at runtime and read lines in a loop.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>