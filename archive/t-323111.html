<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecWait issue, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecWait issue NSIS Discussion" />
	
	<title> ExecWait issue [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecWait issue</div>
<hr />
<div class="pda"><a href="t-323111.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=323111">ExecWait issue</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">13th October 2010, 12:17</div></div><div class="posttext">Im new to NSIS and following is my issue.<br />
<br />
Im having two different path directory for client and server so im using custom variables to save the path instead of $INSTDIR.<br />
 <br />
while installation im checking whether any previous version exists and if exists im calling uninstaller to uninstall using ExecWait as follows.<br />
<br />
ExecWait '$G4 _?=$INSTDIR'<br />
<br />
<br />
Steps :<br />
-------<br />
<br />
1.exe executed.<br />
2.prev version found.<br />
3.uninstaller is triggered.<br />
4.installer is disabled and uninstaller is active.<br />
5.i shifted my focus to installer and clicked &quot;NEXT&quot; . Result : NO change in the installer since it is disabled.<br />
6.i proceeded with uninstallation.<br />
7.After Uninstallation , Installer becomes active.<br />
8.I found installer has skipped one page since i clicked &quot;NEXT&quot; when it was disabled.<br />
<br />
<br />
<br />
why does the page is being skipped? How to avoid it??<br />
<br />
I tried searching for this issue in forum but couldnt find. if the issue is addressed already let me know the link. else please help me to find a solution. Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">13th October 2010, 13:08</div></div><div class="posttext">not sure why this is happening, but you could disable (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.4) the next button for the time the uninstaller is active.<br />
<br />
you can actually copy&amp;paste the first two lines of given example.. (next=1, cancel=2, back=3)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">13th October 2010, 14:13</div></div><div class="posttext">Thanks for the response. im not able to understand which example your are talking about. could u give me the sample code to disable the next button. thanks once again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vankaa</div><div class="date">13th October 2010, 15:02</div></div><div class="posttext">Click his &quot;disable&quot; and you can read what you need.<br />
<br />
GetDlgItem $0 $HWNDPARENT 1 &lt;---- 1-next<br />
EnableWindow $0 0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">13th October 2010, 18:00</div></div><div class="posttext">thanks Yathosho and Vankaa for the respose.<br />
<br />
The code disabled NEXT button. but still if i click on it, after uninstallation once it enters back to the installation i find it skips pages according to total number of clicks on NEXT (disabled) button. <br />
<br />
some one do me a favour. using MUI create a sample nsi in which u call another installer and try clicking on the NEXT button when the installer is not in active mode and let me know whether u too face the same issue. Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th October 2010, 18:09</div></div><div class="posttext">Please submit a bug report. For now, try using a Banner (see NSIS\Docs). You could also try putting some Sleep statements after as well.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Netsurfer24</div><div class="date">14th October 2010, 13:32</div></div><div class="posttext">Please submit a bug report.<br />
I don't think that it is a bug. I guess it has more to do with the fact that the mouse clicks are being &quot;queued&quot; during the ExecWait. And as the button is re-enabled afterwards the previous clicks are now being processed.<br />
<br />
<br />
The code disabled NEXT button. but still if i click on it, after uninstallation once it enters back to the installation i find it skips pages according to total number of clicks on NEXT (disabled) button.<br />
Yes, see above for the possible reason.<br />
<br />
I am doing quite the same (uninstall previous version during install) as you do. IMO you have a fault in your concept. Calling the uninstaller directly from one of the installer pages is generally a bad idea. What if the user cancel the installation afterwards?<br />
<br />
I added a separate topmost hidden section from where I call the uninstaller (if needed). You can control this e.g. by using<br />
SectionSetFlags ${&lt;name_of_your_section&gt;} ${SF_SELECTED}<br />
depending on a variable's value or whatever.<br />
<br />
<br />
Good luck &amp; success<br />
<br />
Gunther</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th October 2010, 13:38</div></div><div class="posttext">I don't think that it is a bug. I guess it has more to do with the fact that the mouse clicks are being &quot;queued&quot; during the ExecWait. And as the button is re-enabled afterwards the previous clicks are now being processed.<br />
<br />
Yes that much is pretty obvious. I'd still regard this as a bug though because it is unexpected/undocumented behaviour.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Netsurfer24</div><div class="date">14th October 2010, 13:43</div></div><div class="posttext">I'd still regard this as a bug though because it is unexpected/undocumented behaviour.<br />
Sorry, but I disagree. This is pretty much the normal Windows behaviour. It has nothing to do with NSIS.<br />
If you want to change it you have to &quot;manipulate&quot; the mouse handling of Windows. But as I suggested, IMHO there is no need for this.<br />
<br />
Gunther</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th October 2010, 13:53</div></div><div class="posttext">This is not default Windows behaviour. I'm not sure how you got that idea. It will occur if you block the message thread for a window. In NSIS's case it still processes WM_PAINT but does not process anything else. It could be modified to process other window messages (thus eat them up) but not take any action.<br />
<br />
Edit: However I definitely agree that use of ExecWait outside a section for long processes (and especially uninstallers) is definitely not a good idea.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">14th October 2010, 14:06</div></div><div class="posttext">Thanks Afro and Netsurfer for your suggestion. Thanks once again Afro for your active participation in the forum and for immediate response on the issues.<br />
<br />
1. Just to confirm it is a BUG i asked others to check whether they too face the same issue <br />
   Do you face the same issue?? If yes , tell me the right procedure to report a BUG.<br />
<br />
2. As discussed above that usage of ExecWait outside long processes is not good idea.<br />
   I'll  make a note of it.<br />
<br />
I have a situation where user need to uninstall the previous version before proceeding. I'll try to edit the current scenario.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">14th October 2010, 14:09</div></div><div class="posttext">Netsurfer i'll try to make utilize of the concept and the code given by you.Thanks.<br />
<br />
SectionSetFlags ${&lt;name_of_your_section&gt;} ${SF_SELECTED}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Netsurfer24</div><div class="date">14th October 2010, 14:27</div></div><div class="posttext">Stu,<br />
This is not default Windows behaviour. I'm not sure how you got that idea. It will occur if you block the message thread for a window. In NSIS's case it still processes WM_PAINT but does not process anything else. It could be modified to process other window messages (thus eat them up) but not take any action.<br />
Hmmm ..., I thought it is the WM_NOTIFY Message which is responsible for the mouse clicks and as it is not disabled cause you disable a button in window ...<br />
But I am pretty shure that you have a much deeper knowledge of these things than I have - so if you it is a bug then it is bug.<br />
<br />
<br />
<br />
I have a situation where user need to uninstall the previous version before proceeding. I'll try to edit the current scenario.<br />
And the user may cancel/ abort the installation after this? What happened then - the user ends up with no installation at all? The previous one already uninstalled and the new one not installed?<br />
<br />
At another place in my installer I solved this issue (don't want the user to click around) by hiding the whole installer window and only showing a banner during the process. Maybe this works for you, too?<br />
<br />
Gunther</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">14th October 2010, 14:47</div></div><div class="posttext">And the user may cancel/ abort the installation after this? What happened then - the user ends up with no installation at all? The previous one already uninstalled and the new one not installed? By Netsurfer24<br />
<br />
In uninstaller section i have a message box which will ask for the confirmation.<br />
so only after confirmation it ll proceed to uninstall. <br />
<br />
After that i check my registry <br />
<br />
<br />
ReadRegStr $G4 ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot;<br />
${if} $G4 != ''&quot; <br />
<br />
if the registry is not null i assume it has not uninstalled and i call the same page by a goto condition to start of the page.<br />
<br />
I know there must be some better way to call the page again like  Call RelGotoPage . Im working on it :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">14th October 2010, 14:49</div></div><div class="posttext">I have two radio button on the page<br />
<br />
1.Add/Reinstall ( which will uninstall and proceed with installation )<br />
2.Uninstall ( does only uninstallation )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pravin</div><div class="date">15th October 2010, 08:29</div></div><div class="posttext">Bug raised .Artifact ID: 3087924</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>