<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Alternate install folder after selection, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Alternate install folder after selection NSIS Discussion" />
	
	<title> Alternate install folder after selection [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Alternate install folder after selection</div>
<hr />
<div class="pda"><a href="t-311214.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=311214">Alternate install folder after selection</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">1st September 2009, 02:05</div></div><div class="posttext">Is there a straightforward way to provide a user the ability to select a different installation folder if the one he chooses in the Location page already exists?<br />
<br />
It's simple to detect if the folder exists after he clicks Install but I'd like to be able to inform him (with a pop-up?) that the folder exists and give him the option to overwrite its contents, select a new folder or abort.  I'd prefer it if selecting a new folder was on a Location page, this time with a blank field instead of the default.<br />
<br />
If there isn't a straightforward way, is there any code I can grab to do the job?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">1st September 2009, 14:53</div></div><div class="posttext">you can handle all of this in the leave callback function for the directory page</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">1st September 2009, 19:37</div></div><div class="posttext">Sorry to be dense but this is unfamiliar territory for me so a one liner doesn't have enough info.<br />
<br />
In System.nsh's !macro MUI_PAGE_DIRECTORY I see a list of PageCallbacks. This included the DirectoryLeave_ I believe you are referring to.<br />
<br />
I read the info on nsis.sourceforge.net/Docs/System/System.html#callback but it left me scratching my head.  I played with some of the Example code but didn't get any apparent results.  I still don't know:<br />
o How to call the DirectoryLeave callback<br />
o How to set up the parameter list<br />
o How to use any return info to cause the directory page to be regenerated.<br />
<br />
I'd appreciate any help on this to get me going.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kchernock</div><div class="date">1st September 2009, 20:27</div></div><div class="posttext">; Select Install Directory Page<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE preDirectory<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE leaveDirectory<br />
!define MUI_DIRECTORYPAGE_VERIFYONLEAVE<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
Function preDirectory<br />
<br />
FunctionEnd<br />
<br />
Function leaveDirectory<br />
  ;This is where you validate if the folder already exists<br />
  ;If so, present message to user if they want to overwrite<br />
  ;If yes, do nothing<br />
  ;If no abort<br />
  ;the abort command will return the user to the destination selection screen<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kchernock</div><div class="date">1st September 2009, 20:33</div></div><div class="posttext">What I have been unable to figure out is how to change the path presented to the user when returning to the destination selection screen.  It returns the user with the field populated with the value that was just rejected.  How do we return the value to some type of default<br />
<br />
ie:<br />
Default ($INSTDIR) is set to C:\Program Files\Xyz<br />
User fills browses to C:\Recycler, which fails the validation<br />
After notifying the user that C:\Recycler is not an allowable destination, how do we change the path back to C:\Program Files\Xyz?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">11th September 2009, 21:15</div></div><div class="posttext">In the Pre callback function of the directory page, store $INSTDIR in a global variable, like $OriginalINSTDIR.<br />
In the Leave callback function, check if the user gave a valid path, and if not:FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $R0 $0 1019<br />
SendMessage $R0 ${WM_SETTEXT} 0 &quot;STR:$OriginalINSTDIR&quot;<br />
Abort</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kchernock</div><div class="date">14th September 2009, 16:02</div></div><div class="posttext">Thanks, this works perfectly and is exactly what I was looking for</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>