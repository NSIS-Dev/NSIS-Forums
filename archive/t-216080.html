<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Some questions about macro InstallLib, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Some questions about macro InstallLib NSIS Discussion" />
	
	<title> Some questions about macro InstallLib [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Some questions about macro InstallLib</div>
<hr />
<div class="pda"><a href="t-216080.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=216080">Some questions about macro InstallLib</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">playwin2</div><div class="date">15th May 2005, 16:57</div></div><div class="posttext">Hi,<br />
<br />
Some questions about macro InstallLib:<br />
<br />
(Q1:)Why the case1 gives troubles when case2 operates smoothly?<br />
<br />
case1<br />
------<br />
<br />
; HM NIS Edit Wizard helper defines<br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\MyApp.exe&quot;<br />
.....<br />
.....<br />
<br />
!include &quot;Library.nsh&quot;<br />
.....<br />
.....<br />
<br />
InstallDir &quot;$PROGRAMFILES\MyApp&quot;<br />
InstallDirRegKey HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
....<br />
<br />
Var ALREADY_INSTALLED<br />
Var IsPresent<br />
<br />
Function .onInit<br />
....<br />
;Check if product already installed...<br />
  ReadRegStr $IsPresent HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot;<br />
....<br />
FunctionEnd<br />
<br />
Section -System<br />
 StrCmp $IsPresent &quot;&quot; +2 0<br />
    StrCpy $ALREADY_INSTALLED 1<br />
<br />
 !define LIBRARY_COM<br />
<br />
 !insertmacro InstallLib REGDLLTLB $ALREADY_INSTALLED REBOOT_NOTPROTECTED \<br />
 &quot;E:\MyDLLS\MyDll.dll&quot; &quot;$INSTDIR\MyDll.dll&quot; &quot;$INSTDIR&quot;<br />
SectionEnd<br />
<br />
Section APP<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
;... other app. files here...<br />
<br />
.....<br />
SectionEnd<br />
<br />
<br />
case2<br />
------<br />
Only the following line is different, all other things are same as case1:<br />
<br />
 !insertmacro InstallLib REGDLLTLB $ALREADY_INSTALLED REBOOT_NOTPROTECTED \<br />
 &quot;E:\MyDLLS\MyDll.dll&quot; &quot;$SYSDIR\MyDll.dll&quot; &quot;$SYSDIR&quot;<br />
<br />
<br />
There is no problem with case2.<br />
In case of case1, the (-)system section fails (actually skipped as the log says...), when the installer is ruuning for the first time. However on 2nd time (or 3rd, 4th...etc.) it behave correctly. So what's gone wrong in 1st. time?<br />
<br />
(Q2:)What to do if I have to install and uninstall both COM and NO-COM dlls at the same time?<br />
<br />
------------<br />
NSIS:2.0.6<br />
OS:Win98SE<br />
------------<br />
<br />
Thanks,<br />
playwin2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th May 2005, 20:39</div></div><div class="posttext">You must create $INSTDIR before you try to install DLLs in it. Use SetOutPath or CreateDirectory.<br />
<br />
To use the InstallLib macro for COM for some DLLs and for non-COM for others, simply define LIBRARY_COM before calling InstallLib that installs COM DLLs and undefine it before call InstallLib that installs non-COM DLLs. For example:!define LIBRARY_COM<br />
!insertmacro InstallLib ... com.dll<br />
!insertmacro InstallLib ... com2.dll<br />
!undef LIBRARY_COM<br />
!insertmacro InstallLib ... noncom.dll<br />
!insertmacro InstallLib ... noncom2.dll<br />
!define LIBRARY_COM<br />
!insertmacro InstallLib ... com3.dll</div></div><hr />


<div class="post"><div class="posttop"><div class="username">playwin2</div><div class="date">17th May 2005, 22:52</div></div><div class="posttext">Thank you.<br />
<br />
For the 1st. part, if I got you right, that you are saying that if target dir. is not $INSTDIR, then only I can skip the creation of $INSTDIR for dlls. Okay I will keep that in mind.<br />
<br />
Thanks again,<br />
playwin2</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>