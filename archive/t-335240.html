<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Windows 7 registry startup problem., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Windows 7 registry startup problem. NSIS Discussion" />
	
	<title> Windows 7 registry startup problem. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Windows 7 registry startup problem.</div>
<hr />
<div class="pda"><a href="t-335240.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335240">Windows 7 registry startup problem.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">uixza</div><div class="date">25th September 2011, 22:09</div></div><div class="posttext">I am using NSIS and I use WriteRegStr to make my program startup when windows starts. It works fine on Win XP and in Win 7 as admin (haven't tested Vista), but in Win 7 with a normal user the registry key doesn't get added, I don't get any UAC windows or anything like that, the key just doesn't get added into the registry.<br />
<br />
I use this on the .nsi:<br />
<br />
WriteRegStr HKEY_CURRENT_USER &quot;Software\Microsoft\Windows\CurrentVersion\Run&quot; &quot;ProgramName.exe&quot; &quot;$APPDATA\MyProgramFolder\ProgramName.exe&quot;<br />
<br />
How can I make it work on Win 7 with a normal user?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">25th September 2011, 22:36</div></div><div class="posttext">You don't need elevated rights for writing to the HKEY_CURRENT_USER branch, I think. But if you added &quot;RequestExecutioLevel admin&quot; to your installer (or did not use &quot;RequestExecutioLevel&quot; at all), then your installer will get elevated when it is started. For &quot;restricted&quot; (no-admin) user accounts this means that UAC will ask for Admin login credentials when the installer is run. The installer will then run under the Admin account. So in this situation HKEY_CURRENT_USER will probably refer to the Admin's registry key, instead of the registry key of the &quot;restricted&quot; user who originally ran the installer. You can't use HKEY_LOCAL_MACHINE to add your app to the Autostart for all users?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">uixza</div><div class="date">25th September 2011, 23:45</div></div><div class="posttext">I use RequestExecutionLevel   user, shouldn't I be able to write that reg key? (without UAC prompt)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">26th September 2011, 00:04</div></div><div class="posttext">I use RequestExecutionLevel   user, shouldn't I be able to write that reg key? (without UAC prompt)<br />
<br />
If you explicitly use &quot;RequestExecutionLevel user&quot; your installer won't be elevated.<br />
<br />
You still should be able to write to the HKEY_CURRENT_USER branch (because that key doesn't require special permissions) and, as no elevation takes place, that key should refer to the account of the user who ran the installer.<br />
<br />
I think you should monitor the installer with ProcessMonitor (http://technet.microsoft.com/en-us/sysinternals/bb896645) and check whether the Registry access fails (and why).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">26th September 2011, 00:15</div></div><div class="posttext">The following code works for me:<br />
http://pastie.org/private/8r3wdvbj9krxbwksoxaa<br />
<br />
Tested with an Admin account and with a limited (guest) account, on Windows 7.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th September 2011, 10:22</div></div><div class="posttext">You might find UAC is blocking writing to that registry key to prevent malware. On Windows 7, many keys are protected in the same way (changing the ACL has no effect). The only way to safely write to these keys is from a Windows service (SYSTEM account).<br />
<br />
How about putting a shortcut to your program in $SMSTARTUP instead. Your user will receive a UAC prompt when the application runs if UAC is enabled though.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>