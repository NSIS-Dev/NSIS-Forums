<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How NSIS handles OS language?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How NSIS handles OS language? NSIS Discussion" />
	
	<title> How NSIS handles OS language? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How NSIS handles OS language?</div>
<hr />
<div class="pda"><a href="t-244530.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244530">How NSIS handles OS language?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">LRaiz</div><div class="date">25th April 2006, 01:32</div></div><div class="posttext">Hello,<br />
<br />
I am a NSIS newbie and would like some guidance regarding handling of OS language. My installer is written using MUI and at the moment works only in English. It checks and if necessary installs .NET 2.0 but since I handle only English version of .NET I would like to make sure and abort the installer on in case of non-English OS. Do I need to code this logic by hand (and detect OS Language in .onInit) or NSIS engine would do me a favor and automatically abort installation on non-English OS?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th April 2006, 17:39</div></div><div class="posttext">http://forums.winamp.com/showthread.php?s=&amp;threadid=187878&amp;highlight=get+operating+system+language<br />
Edit: Ok that is wrong information.<br />
<br />
Use the MoreInfo plugin:<br />
http://nsis.sourceforge.net/MoreInfo_plug-in<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LRaiz</div><div class="date">25th April 2006, 18:53</div></div><div class="posttext">Thanks for the suggestion but I am not sure if MoreInfo::GetOSUserinterfaceLanguage answers my question.<br />
<br />
According to plug-in documentation this function returns  GUI Language suitable for NSIS that is determined by the algorithm -<br />
<br />
When the installer starts up it goes through these steps to select the interface language:<br />
<br />
   1. Get user's default Windows OS GUI language<br />
   2. Find a perfect match for the langauge<br />
   3. If there is no perfect match, find a primary language match<br />
   4. If there is no match, use the first language defined in the script (make sure your first language is a common one like English)<br />
   5. If the langauge variable $LANGUAGE has changed during .onInit, NSIS goes through steps 2 to 4 again, as in the case of this plugin.<br />
<br />
As you can see the outcome of a chosen language is never un-expected.<br />
<br />
But in reality I don't want steps 4-5. My installer has only one language - &quot;English&quot;, so step 4 will always guarantee that I will get it. However I don't want to install English .NET 2.0 on non-English computer. That would seriously mess up user machine. Is there an easy way to force installer to abort on non-English machine or do I have to implement it from scratch?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th April 2006, 21:13</div></div><div class="posttext">System::Call `kernel32::GetUserDefaultUILanguage() i.s`<br />
 Pop $R0 # $R0 == 1033<br />
<br />
Either use GetUserDefaultUILanguage (as shown) or GetSystemDefaultUILanguage.<br />
<br />
Edit: Note that this function does not exist on Windows 95 or NT. http://support.microsoft.com/default.aspx?scid=http://support.microsoft.com:80/support/kb/articles/q181/6/04.asp&amp;NoWebContent=1<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LRaiz</div><div class="date">25th April 2006, 21:18</div></div><div class="posttext">Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vpupkin</div><div class="date">15th November 2012, 17:05</div></div><div class="posttext">Why don't NSIS use GetSystemDefaultLCID for language selection? Most software does that to detect correct language for systems with English UI and non-English locale. NSIS fails here.<br />
<br />
Nevermind, found an easy way to achieve this:<br />
<br />
Function .onInit<br />
  ; Language detection<br />
  System::Call 'kernel32::GetSystemDefaultLangID() i.a'<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>