<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Creating a Shortcut using an Environment Variable in the Target field - possible bug?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Creating a Shortcut using an Environment Variable in the Target field - possible bug? NSIS Discussion" />
	
	<title> Creating a Shortcut using an Environment Variable in the Target field - possible bug? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Creating a Shortcut using an Environment Variable in the Target field - possible bug?</div>
<hr />
<div class="pda"><a href="t-202074.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=202074">Creating a Shortcut using an Environment Variable in the Target field - possible bug?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">EricVogl</div><div class="date">14th December 2004, 17:51</div></div><div class="posttext">Hi all,<br />
<br />
I'm using an environment variable in the CreateShortCut function's second argument (target.file) as the path for the target file.  The function succeeds; however, when I examine the shortcut it appends &quot;C:\&quot; to the beginning of the target field string.<br />
<br />
For example, define the environment variable FOO to be &quot;C:\some_path&quot;<br />
<br />
Create a script:<br />
CreateShortCut &quot;$DESKTOP\foo.lnk&quot; &quot;%FOO%\some_exe.exe&quot;<br />
<br />
This will create a shortcut on the desktop with a target field defined as<br />
&quot;C:\%FOO%\some_exe.exe&quot;<br />
<br />
which resolves to &quot;C:\C:\some_path\some_exe.exe&quot;<br />
<br />
If I were to remove the extra &quot;C:\&quot;, the shortcut will work fine.<br />
<br />
To create the environment variables, I'm using the sample code found on the NSIS website.  This code is working fine.  The environment variables are properly being created and deleted on uninstall.  I've also tried this with manually created environment variables.<br />
<br />
I've tried to work around this problem by setting the &quot;Start In&quot; folder (ie. the working directory) to the directory defined in %FOO%.<br />
<br />
SetOutPath &quot;%FOO%&quot;<br />
CreateShortCut &quot;$DESKTOP\foo.lnk&quot; &quot;some_exe.exe&quot;<br />
<br />
However, the shortcut fails to create at run time, presumably because it is not a fully qualified path name (even though the working directory is defined to the directory where the program resides).<br />
<br />
Any idea why the extra &quot;C:\&quot; is being appended?  I looked quickly through the NSIS source code and I can't see where NSIS is possibly appending this.  I assume it must be Windows doing this when the ShellLink object is passed parameters in exec.c line 990 (NSIS v2.01).  Maybe the code should be setting the working directory before it is setting the path (then maybe the workaround would work)?<br />
<br />
Thanks for any help,<br />
Eric</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th December 2004, 19:37</div></div><div class="posttext">It seems to do it when it the environment variable can't be found. Make sure you set the variable for the current process too. There is an Archive page with such an example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">EricVogl</div><div class="date">14th December 2004, 19:55</div></div><div class="posttext">Thanks kichik.  That did the trick.  Strange behavior for the failure case though.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>