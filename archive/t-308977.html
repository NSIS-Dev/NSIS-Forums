<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" EnumUsersReg works in (XP) SP2 but not in SP3, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  EnumUsersReg works in (XP) SP2 but not in SP3 NSIS Discussion" />
	
	<title> EnumUsersReg works in (XP) SP2 but not in SP3 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  EnumUsersReg works in (XP) SP2 but not in SP3</div>
<hr />
<div class="pda"><a href="t-308977.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308977">EnumUsersReg works in (XP) SP2 but not in SP3</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ronca</div><div class="date">29th July 2009, 00:01</div></div><div class="posttext">I am trying to add a registry key for all current LOCAL users (no domain). It works in Windows XP SP2 but not in SP3.<br />
<br />
What gives?<br />
<br />
My Windows XP SP3 test machine has NOTHING installed and has only two logon accounts defined: 'Admin' (administrator account) and 'Limited' (limited account).<br />
<br />
I visually inspected the registry:<br />
<br />
1. When logged in as Admin I can see its own HKU hive and the HKU hives of some other predefined accounts (probably the Local System, Local Service and Network Service SIDs) - but I cannot see the HKU hive of Limited.<br />
<br />
2. When logged in as Limited, I can see the HKU hive of Limited but not Admin's (this is OK, this is expected and desired).<br />
<br />
This means that the &quot;problem&quot; is not really in EnumUsersReg but in Windows XP SP3.<br />
<br />
This is probably a security improvement (thus &quot;problem&quot; in double quotation marks) but for me this is a real problem as it renders EnumUsersReg useless and meaningless for what I am trying to achieve.<br />
<br />
Is there a workaround for this?<br />
<br />
Suggestions? Ideas?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2009, 01:29</div></div><div class="posttext">You aren't going to see the Limited hive when on Admin unless you are logged into Limited at the same time.<br />
<br />
Anyway, EnumUsersReg uses the RegLoadKey API to load the account hives into HKEY_USERS and that API requires the SE_RESTORE_NAME and SE_BACKUP_NAME privileges, both of which are only available to users which have administrator privileges.<br />
<br />
Sure you aren't just trying to run your install from a limited account?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ronca</div><div class="date">29th July 2009, 03:24</div></div><div class="posttext">Originally posted by Afrow UK <br />
Sure you aren't just trying to run your install from a limited account?<br />
I am 100% sure. I can tell you, however, that your question prompted me to double-check again and I discovered something interesting about 'Admin': It is not the &quot;Built-in account for administering the computer/domain&quot;. The built-in administrator account is named 'Administrator' and it is a member of one group only, the built-in 'Administrators'.<br />
<br />
'Admin', on the other hand, is a member of two built-in groups: 'Administrators' and 'Users'. <br />
<br />
'Limited' is a member of one group only, the built-in 'Users'.<br />
<br />
Does this mean that a &quot;true&quot; administrator cannot belong to both 'Users' and 'Administrators' at the same time? <br />
<br />
<br />
Originally posted by Afrow UK <br />
You aren't going to see the Limited hive when on Admin unless you are logged into Limited at the same time. <br />
But in SP2 it worked without being logged into Limited at the same time. Can you explain this?<br />
<br />
<br />
Originally posted by Afrow UK <br />
Anyway, EnumUsersReg uses the RegLoadKey API to load the account hives into HKEY_USERS and that API requires the SE_RESTORE_NAME and SE_BACKUP_NAME privileges, both of which are only available to users which have administrator privileges.<br />
If a user has administrator privileges and uses the the RegLoadKey API to load the account hives into HKEY_USERS, does that create the &quot;effect&quot; of that account being logged in?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2009, 12:30</div></div><div class="posttext">The Users group will list all users of a local machine including Administrator users. I'm assuming this is XP Professional and not XP Home?<br />
<br />
When a user logs in it loads their registry hive to HKEY_USERS. This is what EnumUsersReg does too except of course HKEY_CURRENT_USER remains the same.<br />
<br />
You should put in a MessageBox after the call to LookupPrivilegeValue to see what $R0 is. It should be 0 on failure.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Netsurfer24</div><div class="date">24th September 2010, 10:23</div></div><div class="posttext">You should put in a MessageBox after the call to LookupPrivilegeValue to see what $R0 is. It should be 0.<br />
See: http://msdn.microsoft.com/en-us/library/aa379180%28v=VS.85%29.aspx<br />
Return Value<br />
<br />
If the function succeeds, the function returns nonzero.<br />
<br />
If the function fails, it returns zero. To get extended error information, call GetLastError.<br />
Gunther</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th September 2010, 11:06</div></div><div class="posttext">Post edited.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ronca</div><div class="date">24th September 2010, 16:04</div></div><div class="posttext">Wow. This was very long ago. I remember I solved the problem eventually but I don't remember exactly how. I think I placed SetShellVarContext current just before running EnumUsersReg and that solved the problem.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>