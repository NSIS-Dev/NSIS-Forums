<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Delete a specific registry data, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Delete a specific registry data NSIS Discussion" />
	
	<title> Delete a specific registry data [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Delete a specific registry data</div>
<hr />
<div class="pda"><a href="t-341386.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=341386">Delete a specific registry data</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Acid_Attack</div><div class="date">29th January 2012, 14:28</div></div><div class="posttext">Hi,<br />
<br />
I need to delete a specific registry data inside a value, but not the whole value.<br />
The problem is this:<br />
When the user uninstall there are files that can't be deleted, and therefore we use  /REBOOTOK<br />
but if the user re-installed the program before he restarted the machine and then he did the restart, the pending-to-be-deleted-files will be deleted and the program won't work.<br />
<br />
For this reason, we want on installation to look inside:<br />
HKLM\SYSTEM\ControlSet\Control\Session Manager &quot;PendingFileRenameOperations&quot;<br />
<br />
This key contains the value-data ​​to be deleted after reboot.<br />
But we need to look for the specific value-data and to delete only it and not the whole value (the value contains other files to be deleted)!<br />
<br />
Any idea how to do this ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd February 2012, 16:26</div></div><div class="posttext">I believe that is a REG_MULTI_SZ which you can read and write using the Registry plug-in.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">2nd February 2012, 17:18</div></div><div class="posttext">If you rename the file(s) that the uninstaller was unable to delete, then the new files added by the installer won't get deleted by the reboot. (Renaming the files might or might not work, depending upon why you are unable to delete them).<br />
<br />
You can try moving the files to a temporary directory if you want to make the install folder look like they were deleted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd February 2012, 17:51</div></div><div class="posttext">You can try moving the files<br />
you cant move them while they are marked for delete on reboot.<br />
thats one reason they are marked for - in use!<br />
<br />
&quot;PendingFileRenameOperations&quot;<br />
is a long string sometimes &gt;1024 - so you need the long string special build from nsis.<br />
oh, my watcher limits outout to 730 token, afair this is due the line breaks inbetween that value</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">2nd February 2012, 18:33</div></div><div class="posttext">I'll have to accept your statement that files listed in PendingFileRenameOperations are locked from being moved, but the code in my installer does it like this:${If} ${FileExists} C:\Ipls\dlls\*.*<br />
	SetOutPath C:\IPLS		; set current dir to prevent deleting C:\Ipls<br />
	RMDir /r C:\Ipls		; don't keep any old files or folders<br />
	${If} ${FileExists} C:\Ipls\dlls\*.*<br />
		; something has held up the folder: rename it to allow fresh files<br />
		Rename C:\Ipls\dlls C:\Ipls\dlls.prev<br />
		RMDir /r /REBOOTOK C:\Ipls\dlls.prev<br />
		${If} ${FileExists} C:\Ipls\dlls.prev\*.*<br />
			Push &quot;C:\Ipls\dlls.prev will be deleted after reboot.&quot;<br />
			Call ErrorLog<br />
		${EndIf}<br />
	${EndIf}<br />
	ClearErrors<br />
${EndIf}Notice that I don't use the /REBOOTOK switch until after I've tried to remove the files once. Before that logic was added there were always a couple of dlls that wouldn't get deleted. The code above works for us. Now those stubborn files are in a different directory and are safe from the reboot delete.<br />
<br />
Here's a second place I do the same thing:Rename C:\Lockit $Temp\Lockit<br />
RMDir /r /REBOOTOK $Temp\Lockit<br />
${If} ${FileExists} $Temp\Lockit\*.*<br />
	Push &quot;$Temp\Lockit will be deleted after reboot.&quot;<br />
	Call ErrorLog<br />
${EndIf}<br />
There are always a couple of files in that folder that can't get deleted (dlls used by Windows Explorer and the Logon process). The code above works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd February 2012, 21:37</div></div><div class="posttext">similar to mine <br />
http://forums.winamp.com/showthread.php?t=340940</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>