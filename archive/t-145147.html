<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSISdl macros, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSISdl macros NSIS Discussion" />
	
	<title> NSISdl macros [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSISdl macros</div>
<hr />
<div class="pda"><a href="t-145147.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=145147">NSISdl macros</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2003, 16:10</div></div><div class="posttext">I was using NSISdl to download multiple files throughout my installer, so I figured that it would be easier to make a macro (with error/success/cancel messages and all) without having to repeat the same code so many times (in different functions/sections).<br />
<br />
I've attached it below, any suggestions, comments, or changes would be much appreciated.<br />
<br />
I'm not sure if there are any similar macros to my ones, but it would be cool if it was included with NSIS :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">8th August 2003, 16:16</div></div><div class="posttext">Looks nice. Maybe think of something better instead of run-time URL splitting.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2003, 16:20</div></div><div class="posttext">It fitted what I needed, but what woud you mean by that?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">8th August 2003, 16:49</div></div><div class="posttext">You are splitting parameters on run-time, that adds size to the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2003, 17:31</div></div><div class="posttext">How would I be able to go about this?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th August 2003, 21:48</div></div><div class="posttext">Ok, so I should use !system, and split the string on compile time, rather than on runtime. Will this work?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">14th August 2003, 22:22</div></div><div class="posttext">That's indeed better.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th August 2003, 22:59</div></div><div class="posttext">Ok, I have no idea how to use !system, or split a string on compile time (using NSIS script)<br />
<br />
Help would be much appreciated.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">15th August 2003, 00:23</div></div><div class="posttext">Is difficult to explain. [EDITED]Have to be much changes in your macros, is too much confuse. I don't make a better function now because I don't have a &quot;my computer&quot; (using only public computers).<br />
<br />
Is better look the new version of function &quot;Detect System Language&quot; that I will launch tomorrow, I will use macros to don't use any space when you don't need the function and some other useful great features...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th August 2003, 11:02</div></div><div class="posttext">The simplest way would probably be letting the user push the URLs instead of supplying them as an argument to the macro. Use something like:<br />
<br />
START_URLS<br />
Push url<br />
Push url2<br />
...<br />
END_URLS<br />
<br />
START_URLS should push a certain string that will specify the end of the URLs list.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th August 2003, 11:07</div></div><div class="posttext">That's a great idea Kichik!<br />
Very simple solution that is much better than current.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th August 2003, 11:57</div></div><div class="posttext">I've got this working, but have had problems.<br />
I'm popping NSISdl's return value from the stack, which is coinciding with the urls on the stack.<br />
Using Pop in some places made the Invalid opcode error appear, so I replaced some with Exch (NSISdl return value pop and URLS pop)<br />
<br />
It seems to work now, but it would be nice if somone could check the script for me:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th August 2003, 12:25</div></div><div class="posttext">Invalid opcode error is caused by Exch, not Pop. It happens if Exch is called and the stack is empty/not large enough. I don't think there should be any problem with NSISdl pushing stuff on the stack as long as you pop them all.<br />
<br />
You can also use the pushed items for NSISdl instead of popping and pushing them back.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th August 2003, 12:32</div></div><div class="posttext">Well, I was having the Invalid opcode when Popping NSISdl's return value before Pushing the variable (or somthing) onto the stack first.<br />
I knew it was the Pop because I placed messagebox before and after it; only the one before it would appear and then the error.<br />
<br />
I think that it looks ok and it must be working ok - it definately gets hold of &quot;urls_start&quot; on the stack after trying all urls.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th August 2003, 12:33</div></div><div class="posttext">Wait, placing two fake urls in screws it up (doesn't get to &quot;urls_start&quot;)<br />
<br />
I'll find out why...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th August 2003, 12:37</div></div><div class="posttext">Ok you are right, it's actually the Exch at the end of the script causing it.<br />
Why is this, and how can I fix it?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th August 2003, 12:40</div></div><div class="posttext">I've ended up using this to fix it:<br />
  Push $R0<br />
  Exch $R0<br />
<br />
Everything works great now.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th August 2003, 12:41</div></div><div class="posttext">It happens if Exch is called and the stack is empty/not large enough. For example, calling Exch when the stack is empty will trigger this error message. This will too:<br />
<br />
Push a<br />
Push b<br />
Exch 2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th August 2003, 12:41</div></div><div class="posttext">Here is latest script:<br />
<br />
Removed SplitString function<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>