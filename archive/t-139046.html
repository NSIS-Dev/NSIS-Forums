<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Is it possible to do a search and replace on certain files?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Is it possible to do a search and replace on certain files? NSIS Discussion" />
	
	<title> Is it possible to do a search and replace on certain files? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Is it possible to do a search and replace on certain files?</div>
<hr />
<div class="pda"><a href="t-139046.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=139046">Is it possible to do a search and replace on certain files?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">14th June 2003, 22:37</div></div><div class="posttext">I've just finished compiling a project consisting of 9,113 files. 79 of them have to be configured during installation in order for the applications to launch and function correctly.<br />
<br />
A few of the most common customizations needed are...<br />
<br />
1. Absolute system paths.<br />
2. End User Profile.<br />
4. etc...<br />
<br />
My question is, is NSIS able to perform a search and replace for a marker within a file; marker names of @@marker@@ or %%marker%% or &lt;marker&gt;...<br />
<br />
I would like to add a *few* custom screens which will ask for this information. A user should enter the correct information and upon hitting the submit button the value in the field replaces the markers in the files...<br />
<br />
Some files will have more than 30 markers... Some are the same while some are different.<br />
<br />
I am currently using HM NIS Edit 1.3 and I believe this to be an awesome application with incredible potential. A very good port of the Inno setup wizard and a very interesting .ini form designer.<br />
<br />
I haven't the slightest clue though about how to implement the form created in the .ini to appear in a brand new modern user interface. To cover this problem with a cherry on top I haven't the slightest clue about how to map markers in files (if possible).<br />
<br />
I checked the installoption example and it looks interesting but it leaves me hanging because the truth is I haven't the slightest clue to building an installer with NSIS. Another fact is, it gets even more complicated in trying to port the example from a tiny user interface to a modern user interface...<br />
<br />
Can someone please write a guide on this feature for everyone to benefit from? Can someone be kind enough to help me a little further with this by providing a simpler example which works with the MUI? Also, if replacing markers is a possibility can someone please be kind enough to help in providing some steps to acheiving this?<br />
<br />
I just applied for a sourceforge account and would make thanks to anyone who helps me with this regardless of whether it gets accepted or not. Much appreciation and thanks for anyone who reads this entire post :)<br />
<br />
Thank you for your time</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">14th June 2003, 22:55</div></div><div class="posttext">Well for the search part use the instruction &quot;IfFileExists&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th June 2003, 23:27</div></div><div class="posttext">If you haven't the slightest clue about NSIS you should start with the tutorial ;) Open makensis.htm in your NSIS directory or go to http://nsis.sf.net/Docs and start reading.<br />
<br />
To show custom designed pages with the MUI see the Examples\Modern UI\InstallOptions.nsi example.<br />
<br />
To replace markers in the file see useful functions section in The Archive (http://nsis.sf.net/archive/), it contains more than one function that matches your request.<br />
<br />
Have I missed anything? :)<br />
<br />
Oh yes, of course... Welcome to the forum :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">15th June 2003, 13:20</div></div><div class="posttext">Thank you kichik :)<br />
<br />
I know sometimes we all need a kick in the right direction so I went to sleep to help clear my mind. This morning I got your message and I said I can do this!<br />
<br />
I think I did but have a question...<br />
<br />
I added four custom dialog boxes... They all seem to atleast appear without problems. The script builds flawlessly. I had a little trouble with the concept of giving the custom windows titles but I figured it out...<br />
<br />
It all looks good but how I am duplicating these functions have me a little concerned. I am incrementing them... RabbitHole, RabbitHole1, RabbitHole2, etc...<br />
<br />
One value which is staying the same across all functions and which hasn't presented a problem yet is the &quot;Push $R0&quot; and &quot;Pop $R0&quot;... Should I increment them too (e.g. &quot;Push $R1&quot; &quot;Pop$R1)?<br />
<br />
Thank you so much, I think I made it harder than it was but thanks so much for the kick in the right direction :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th June 2003, 17:50</div></div><div class="posttext">The best way to understand Push Pop and Exch is to look at functions on the nsis archive.<br />
That is how I understood Exch (using multiple Exch's to get multiple values from off the stack)<br />
Push is used to save variables and then those variables can be used within the script.<br />
Using Pop at the ens of the script returns the varianbles to the same value as before the function was called.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th June 2003, 18:04</div></div><div class="posttext">There is a tutorial in The Archive about the stack (Push, Pop and Exch). The short version is you don't need to change $R0 to $R1, etc. But you should read the tutorial to know better.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">15th June 2003, 18:54</div></div><div class="posttext">Ok, I feel I accomplished a lot. Thank you to everyone with the wise words of wisdom for me.<br />
<br />
Now basically, I am chasing just one prize in which I feel involves more than what I have in mind. I've created the four INI files I need, and have customized (*only the appearance*) of all the INI files in preparation to *collect* the required user input.<br />
<br />
The script builds and runs perfectly. Here is an example of what I am trying to do. I looked at the archive but need either a simpler solution or a simpler example.<br />
<br />
1. The First INI file collects the users name, age and number.<br />
2. I have a text file which needs this information fed into it dynamically before the install finishes.<br />
3. The markers appear more than once in the same text file...<br />
<br />
In other words, the collected information from the customized .ini screen needs to replace markers in the text file...<br />
<br />
I know I can build from a simpler example as I have dozens and dozens of markers and files. Can someone please provide a very simple example on how to find and replace markers by collecting information from a .ini file *AND* getting it to replace markers in a text file?<br />
<br />
The information does *not* need to be validated...<br />
<br />
Someone please help me out, thank you for your time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th June 2003, 19:07</div></div><div class="posttext">Most archive pages contain examples. Take this one (http://nsis.sourceforge.net/archive/nsisweb.php?page=318&amp;instances=0,11,311) for example.<br />
<br />
To read the values from the INI file use ReadIniStr or the MUI_INSTALLOPTIONS_READ macro if you're using the MUI (double check on this name, I'm not sure it's the right one).<br />
<br />
To combine both, lets assume you've read the INI value into $0 then you use something like Push $0 or just put $0 at the right position according to the example of the function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">15th June 2003, 19:16</div></div><div class="posttext">I just want to say thanks Kichik :) I haven't quite got the time at the moment but it is on my priority list to check it out in a few hours.<br />
<br />
I am currently speaking with a very good programmer at the moment. I will let you know how things go as I am not afraid of messing with the code.<br />
<br />
Thanks again and btw, I am using the MUI... I hope it works :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">15th June 2003, 21:15</div></div><div class="posttext">I found the ReadIniStr in the scripting reference but couldn't find MUI_INSTALLOPTIONS_READ -OR- StrReplace -OR- StrReplace.nsh...<br />
<br />
Assuming so far ReadIniStr is a step in the right direction how exactly would I apply it to my script? Does it go above or below sections? Above or below functions?<br />
<br />
Also this is how the references refers to it<br />
<br />
-----------------------------------------------------<br />
user_var(output) ini_filename section_name entry_name<br />
-----------------------------------------------------<br />
<br />
I have an INI file named UserProfile.INI I don't see any sections in it but do see fields... I assume the entry_name is something like text=...<br />
<br />
I assume I apply the above code into my script in this manner...<br />
<br />
-----------------------------------------------------------<br />
user_var(output) UserProfile.INI [Field 1] Text=<br />
-----------------------------------------------------------<br />
<br />
True or False?<br />
<br />
I hope this is indeed a step in the right direction. I just need to know where it gets placed and the format of the string.<br />
<br />
Thank you for any help on this :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th June 2003, 21:29</div></div><div class="posttext">For information about the Modern UI and its macro's, see Contrib\Modern UI\Readme.html.<br />
<br />
MUI_INSTALLOPTIONS_READ automatically uses the plug-ins directory (it just makes it a little easier). The plug-ins directory (a temporary directory) is the place where the Modern UI stores the INI files (extracted using MUI_INSTALLOPTIONS_EXTRACT).<br />
<br />
The section name is &quot;Field 1&quot;, the entry name is &quot;Text&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th June 2003, 21:29</div></div><div class="posttext">StrReplace is in the Archive too, use the search link on the top right corner of the screen.<br />
<br />
MUI_INSTALLOPTIONS_READ is indeed the right name of the macro. Search for it in the MUI readme (Appendix D or something like that in the documentation).<br />
<br />
You've almost got it right regarding ReadIniStr. It goes like this:<br />
<br />
[section]<br />
entry=value<br />
<br />
ReadIniStr should be used like this:<br />
<br />
ReadINIStr $var Path\to\inifile.ini &quot;section name without the brackets&quot; &quot;entry name without the equal sign&quot;<br />
<br />
For example:<br />
<br />
ReadINIStr $0 &quot;$PLUGINSDIR\myIni.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
<br />
You should use it wherever you want to use the value. If you want to use the text replacement functions in sections then you should read it in the section and then use it. It's recommended that use it in the sections because those are executed after the user clicks Install. If you execute them before that they will replace the text before the user actually gave his/her permission to install the program.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">15th June 2003, 22:33</div></div><div class="posttext">I am trying my fastest to learn as much as possible and keep at this thread while it is still hot.<br />
<br />
I believe the MUI_INSTALLOPTIONS_READ works in conjunction with the MUI_INSTALLOPTIONS_WRITE and will only work in replacing variables located in the INI itself? Not sure just asking...<br />
<br />
Or, are the two following pieces of code the same thing, except one is more enhanced and/or user friendly in regards to building a MUI?<br />
<br />
-----------------------------------------------------------------<br />
ReadINIStr $0 &quot;$PLUGINSDIR\myIni.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
-----------------------------------------------------------------<br />
-----------------------------------------------------------------<br />
!insertmacro MUI_INSTALLOPTIONS_READ $VAR &quot;ioFile.ini&quot; &quot;Field 1&quot; &quot;Value Name&quot;<br />
-----------------------------------------------------------------<br />
<br />
On the MUI line is $VAR equal to $0? I assume I replace the &quot;ioFile.ini&quot; on the MUI line with &quot;myIni.ini&quot;...<br />
<br />
In the end using the MUI line is best in regards to building a MUI or should I stick with ReadINIStr and will it work?<br />
<br />
Heres is the modified line for the MUI<br />
<br />
-----------------------------------------------------------------<br />
!insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;myIni.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
-----------------------------------------------------------------<br />
<br />
Is this correct and is using the MUI line more advised than using ReadINIStr in building an MUI?<br />
<br />
I suare a thousand times all of your help is really appreciated. Thank you to everyone for their knowledge and expertise in this field.<br />
<br />
Best Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th June 2003, 22:41</div></div><div class="posttext">!insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;myIni.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
<br />
is the correct way. $var doesn't mean anything, it was just a place holder. The line above does exactly the same thing as:<br />
<br />
ReadINIStr $0 &quot;$PLUGINS\myIni.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
<br />
The MUI macro is just an easier, more future safe (in case MUI_INSTALLOPTIONS_EXTRACT will change) version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 11:31</div></div><div class="posttext">I am really trying but to be honest I am getting really annoyed and this whole project is quite sickening at the install stage. :igor:<br />
<br />
No offense, no slap in the face, I believe NSIS is awesome, I thank everyone so much for their time, its just making me feel so dumb. <br />
<br />
I read and reread the StrReplace and ReplaceInFile steps at the archive. I re-reread them and still cannot get it to work... Even if I do get it to work, this only proves it'll get harder as now I have to somehow get it to work in accepting the values on the customized screen to applying those values in over 79 files...<br />
<br />
I am stuck in mud at the moment... Here is my sad attempt at simply trying to get the ReplaceInFile to work following the ReplaceInFile instructions...<br />
<br />
I copied both scripts &quot;StrReplace &amp; ReplaceInFile&quot; from the archive and applied the NSH extension and have dropped them in my include folder.<br />
<br />
I applied the following snippet directly beneath !include &quot;MUI.nsh&quot; located right at the very top of my script...<br />
----------------------------<br />
!include StrReplace.nsh<br />
!include ReplaceInFile.nsh<br />
----------------------------<br />
<br />
I made a build and got two warnings... I surrounded them in quotes and I still got the two warnings...<br />
----------------------------<br />
!include &quot;StrReplace.nsh&quot;<br />
!include &quot;ReplaceInFile.nsh&quot;<br />
----------------------------<br />
<br />
Here is the warning...<br />
------------------------------------------------------------------<br />
2 warnings:<br />
  Name: specified multiple times, wasting space (macro:MUI_LANGUAGEFILE_NSISCOMMAND:2)<br />
  install function &quot;RIF&quot; not referenced - zeroing code (57-105) out<br />
------------------------------------------------------------------<br />
<br />
I create the builds early to try and keep track of what is going wrong and where... I know I should probably get a warning but its really to test and see where the building process will stop or mess up...<br />
<br />
The rest of the snippet states this is all I have left to work with but it doesn't tell me exactly where to apply it... I feel I tried everywhere but feel dumb because I know I didn't... I just tried in so many other places instead...<br />
<br />
------------------------------------------------------------------<br />
[...]<br />
!insertmacro ReplaceInFile SOURCE_FILE SEARCH_TEXT REPLACEMENT<br />
------------------------------------------------------------------<br />
<br />
What is this [...]? The build stops there completely... I'll remove it and work with the rest of it...<br />
<br />
I created a test file named misc.ini located in the NSIS directory.<br />
------------------------------------------------------------------<br />
!insertmacro ReplaceInFile &quot;misc.ini&quot; &quot;crackdown&quot; &quot;crack up and fall down&quot;<br />
------------------------------------------------------------------<br />
<br />
Creating the build leaves me with one warning...<br />
------------------------------------------------------------------<br />
1 warning:<br />
  Name: specified multiple times, wasting space (macro:MUI_LANGUAGEFILE_NSISCOMMAND:2)<br />
------------------------------------------------------------------<br />
<br />
Running the build goes smooth until the actual installing phase... a little dialog box always pops up and says &quot;C:\thy documents\thy files\prob&quot;<br />
<br />
Talk about irritating... I cannot get around it... There is no C:\thy... on my system... I hit OK...<br />
<br />
I go and check the file and it did indeed replace crackdown... Just three questions though...<br />
<br />
1. How do I get around my last warning... I don't like it...<br />
2. How do I prevent that little irritating dialog box from popping up?<br />
3. How do I begin to map collected information from a customized screen to an actual file?<br />
<br />
Sorry for my long post, I am simply trying my best *not* to state &quot;it doesn't work, please help&quot; and letting you know what I've tried.<br />
<br />
Thank you for your time</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th June 2003, 11:40</div></div><div class="posttext">Did you add a &quot;Name&quot; command to your script? The Modern UI adds one automatically (based on MUI_PRODUCT and MUI_VERSION), so you should not add one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 12:06</div></div><div class="posttext">Hello Joost Verburg,<br />
<br />
I am not really sure. I created a script using the HM Wizard and then began building from their... So far I managed to include two customized screens in which pop up first... I don't think I added an extra name...<br />
<br />
I've attached the actual 4kb zip file I am working with. Hopefully maybe you or anyone can look it over and tell me where is it I am going wrong so far... Every file in the zip is just sort of my class room files... I am not trying to expand on it until I know how to do it comfortably...<br />
<br />
Thank you for your time :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 12:07</div></div><div class="posttext">Sorry, I previewed my post and then the attachment didn't attach... Here it is now... Thank you again :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th June 2003, 12:48</div></div><div class="posttext">The problem is that you've copied into the nsh files the entire example scripts and not only the functions. That is why you've got all of those warnings, weird messages and weird dialogs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 13:06</div></div><div class="posttext">On the ReplaceInFile the instructions clearly state to do that. In short it said &quot;I suggest you save the following macro and the function together in one file...&quot;<br />
<br />
I did that for both files. I just noticed though in the StrReplace file (thanks Kichik) the probable lines which caused for the dialog box and errors you were referring too.<br />
<br />
Delete this from StrReplace?<br />
----------------------------------------------------<br />
outfile StrReplace.exe<br />
name StrReplace<br />
<br />
section<br />
  Push &quot;C:\my documents\my files\prob&quot; ;original string<br />
  Push &quot;\m&quot; ;needs to be replaced<br />
  Push &quot;\th&quot; ;will replace wrong characters<br />
  Call StrReplace<br />
  Pop $0<br />
  MessageBox MB_OK $0<br />
sectionend<br />
----------------------------------------------------<br />
<br />
I did and it builds just fine... No errors, no dialog boxes... Sorry, sometimes you work so hard and start to over look the obvious...<br />
<br />
OK, so now to help complete my task in its entirety... Can you or someone please be kind enough to show me an example on how to use the <br />
StrReplace &amp; the ReplaceInFile to work with collecting information from the user and then applying it to certain files?<br />
<br />
Am I close or still far away on this?<br />
<br />
Please, I am just trying to make my project easier on end users.<br />
<br />
The custom screens will collect information that is to replace markers located in 79 files... Please just show me an example on one file?<br />
<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">16th June 2003, 13:38</div></div><div class="posttext">On the ReplaceInFile the instructions clearly state to do that. In short it said &quot;I suggest you save the following macro and the function together in one file...&quot; Yes but it doesn't say copy the example scripts like KiCHiK suggests you've done.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th June 2003, 13:44</div></div><div class="posttext">&quot;Following function and macro...&quot; apply to that page, not to the StrReplace page. You only need the function from the StrReplace page, nothing else.<br />
<br />
You're close, you don't need an example. There are enough examples in those archive pages. Just use ReadINIStr / MUI_INSTALLOPTIONS_READ as instructed above and then insert the replace in file macro like instructed in the archive page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 13:56</div></div><div class="posttext">I admitted to my mistake in the 2nd paragraph of my last reply. I admitted I undoubtedly overlooked it. I publicly apologize for any confusion I may have caused.<br />
<br />
My greatest concern is collecting information from a custom screen and then applying that collected information into certain files.<br />
<br />
Please show me an example...<br />
<br />
I understand replacing markers in files using the ReplaceInFile method but that would make absolutely no sense and be completely barabic to even waste everyones time if I could predict the values...<br />
<br />
My point is, how do I get the collected value to dynamically replace the ReplaceInFile value? If it easy and anyone thinks this is a piece of cake, I ask to please help me and show me an example.<br />
<br />
I do not understand (I really don't) how to dynamically replace the ReplaceInFile value... Please, I really don't know how to do it. Please show me an example.<br />
<br />
Please show me an example. Please. Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th June 2003, 14:02</div></div><div class="posttext">Open Examples\Modern UI\InstallOptions.nsi and put this in line number 87:<br />
<br />
!insertmacro ReplaceInFile &quot;$INSTDIR\myfile.ini&quot; &quot;@marker@&quot; &quot;${TEMP}&quot;<br />
<br />
This will replace every @marker@ in $INSTDIR\myfile.ini with 0 or 1 according to the checkbox selection on custom page number 3 (ioC.ini).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 14:54</div></div><div class="posttext">I had to add the !includes at top... I created a myfile.ini... I put your code on line 87 and all that happens is all occurences of the @marker@ in myfile.ini are replaced with nothing... no 0 or 1. But all occurences of @marker@ are deleted...<br />
<br />
I am losing it... I don't wish to be a professional installer, I just want to package up my project and make it easier on end users... I think to be flat out honest taking this route with NSIS is a route I will ultimately regret...<br />
<br />
No one get me wrong, I thank anyone who says hello on this post... Just everyone has either a short changed answer or everyone so far thinks I am a geek at building installations and don't have the time to better explain an example to me as if I were a child...<br />
<br />
I think I achieved a lot but it seems I will go no where fast as this is more than complicated and I am simply too frustrated with it. I am pretty certain if I were a geek and took up building installations with NSIS at MIT I'd probably consider NSIS to be a 5 star program.<br />
<br />
Unfortunately I am no professional lingo artist in this field and am really beginning not to care anymore for it...<br />
<br />
Truth is I really do wish to proceed but I feel no one really wants to truly help rather than make a post...<br />
<br />
I know I regret saying this already but I figure I will rant my frustrations without acting too much like a kid about it... I feel a little better now... No one has to help me anymore on this... Though it would be nice...<br />
<br />
Here is a wish rather than a request... Can a GOD take my zip package from a few post ago and fix it so that it does as I've been asking... Can the GOD please post it back here for everyone who might need it one day to benefit from?<br />
<br />
Thank you, I am still just frustrated, forgive me...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th June 2003, 17:59</div></div><div class="posttext">It's really simple...<br />
<br />
Section &quot;Replace @marker@&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_READ $0 myIni.ini &quot;Field 4&quot; &quot;State&quot;<br />
!insertmacro ReplaceInFile &quot;$INSTDIR\myotherfile.ini&quot; &quot;@marker@&quot; &quot;$0&quot; <br />
SectionEnd<br />
<br />
Do whatever you want with it. I have no time to write the script for you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 22:00</div></div><div class="posttext">I am sincerely sorry for my earlier attitude between the lines. I am certain we've all been their at one point. I am not stupid but really felt if it was as simple as Kichiks last post someone should have just said to me &quot;work with this&quot;...<br />
<br />
Kichik it works flawlessly, across all screens, on all fields, on all the test files I've so far worked with. It really works as I hoped it would. It is perfect.<br />
<br />
I have just one more question I feel could just provide the icing on the cake for me. It seems I get all of these .old files as part of the installtion. I read they were supposed to be deleted but it seems they just go in as part of the installation and stay there...<br />
<br />
How do I prevent them from being a part of the installation or from staying in the package after install?<br />
<br />
Thank you so much, sorry for my attitude, Kichik, you certainly have a place in my thank you credits.<br />
<br />
Thanks again and sorry for my rant.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th June 2003, 22:21</div></div><div class="posttext">Maybe you can make a batch file to remove 'em before you generate the installer, or you can use Delete after installing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">16th June 2003, 22:29</div></div><div class="posttext">I can create a batch file with orders to erase files but is it possible to have the installer do it automatically?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th June 2003, 11:42</div></div><div class="posttext">Replace these lines in the RIF function:<br />
<br />
Delete &quot;$2.old&quot;           ; go away, Sire<br />
Rename &quot;$2&quot; &quot;$2.old&quot;       ; step aside, Ma'am<br />
<br />
with:<br />
<br />
Delete $2<br />
<br />
and you will have no .old files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 12:50</div></div><div class="posttext">Kichik, that last line of code takes care of the .old files as requested. Thank you so much for everything. Sorry for breaking earlier :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 17:07</div></div><div class="posttext">I know in my last post I said I have just one more question *but* I have just one more and I promise once this is solved my search and replace mission is over and I will move on.<br />
<br />
I have many markers in my files in which require to be replaced with an absolute path (e.g. @@AbsolutePath@@). I was hoping I could take the absolute path from the &quot;Destination Folder&quot; field at the install location screen.<br />
<br />
The trick though is not just getting the path from the &quot;Destination Folder&quot; but also reverting its &quot;\&quot; with &quot;/&quot;... I can get the user to enter this information manually but was hoping I could do it for them automatically.<br />
<br />
So the Destination Folder looks like this...<br />
C:\Program Files\My Application<br />
<br />
But, when the user clicks install all markers in my files will then look like this...<br />
C:/Program Files/My Application<br />
<br />
I am really hoping this is not too hard. Please help me with just this last bit of code and I will be out of everyones hair in regards to search and replace.<br />
<br />
Thank you so much as this is so important to me to get this last task out of the way.<br />
<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th June 2003, 18:10</div></div><div class="posttext">Always search the Archive :)<br />
<br />
Here it is: http://nsis.sourceforge.net/archive/viewpage.php?pageid=136</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 18:49</div></div><div class="posttext">Thank you Joost,<br />
<br />
I insert this piece into my NSIS project script?<br />
Push String to do replacement in (haystack)<br />
Push String to replace (needle)<br />
Push Replacement<br />
Call StrRep<br />
Pop $R0 result<br />
<br />
And it is the below function I will save as an NSI script in my projects directory?<br />
<br />
; Push $filenamestring (e.g. 'c:\this\and\that\filename.htm')<br />
; Push &quot;\&quot;<br />
; Call StrSlash<br />
; Pop $0<br />
; $0 == 'c:/this/and/that/filename.htm'<br />
Function StrSlash<br />
  Exch $R3 ; $R3 = needle (&quot;\&quot; or &quot;/&quot;)<br />
  Exch<br />
  Exch $R1 ; $R1 = String to replacement in (haystack)<br />
  Push $R2 ; Replaced haystack<br />
  Push $R4 ; $R4 = not $R3 (&quot;/&quot; or &quot;\&quot;)<br />
  Push $R6<br />
  Push $R7 ; Scratch reg<br />
  StrCpy $R2 &quot;&quot;<br />
  StrLen $R6 $R1<br />
  StrCpy $R4 &quot;\&quot;<br />
  StrCmp $R3 &quot;/&quot; loop<br />
  StrCpy $R4 &quot;/&quot;  <br />
loop:<br />
  StrCpy $R7 $R1 1<br />
  StrCpy $R1 $R1 $R6 1<br />
  StrCmp $R7 $R3 found<br />
  StrCpy $R2 &quot;$R2$R7&quot;<br />
  StrCmp $R1 &quot;&quot; done loop<br />
found:<br />
  StrCpy $R2 &quot;$R2$R4&quot;<br />
  StrCmp $R1 &quot;&quot; done loop<br />
done:<br />
  StrCpy $R3 $R2<br />
  Pop $R7<br />
  Pop $R6<br />
  Pop $R4<br />
  Pop $R2<br />
  Pop $R1<br />
  Exch $R3<br />
FunctionEnd<br />
<br />
Can you please explain besides doing the above how I tie this into getting the value of the install directory and then applying that value to markers located through out various files?<br />
<br />
I really am no geek but would very much like to use the NSIS installer as it allows me the freedom to customize the installation for end users. I believe it is very powerful...<br />
<br />
Just how do I get the Directory Folder installation value, change all the &quot;\&quot; with &quot;/&quot; and then apply that value to markers through out the installation?<br />
<br />
Please help me on this last task... I could ask the end user for the value but I trust NSIS to do it better.<br />
<br />
Thank you for your help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th June 2003, 19:54</div></div><div class="posttext">Example:Push $INSTDIR<br />
Push &quot;\&quot;<br />
Call StrSlash<br />
Pop $0<br />
;Now $R0 contains the $INSTDIR with forward slashes</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 20:05</div></div><div class="posttext">Thank you so much Joost,<br />
<br />
Before I run into error I just wish to confirm before moving ahead. Do I apply both codes...<br />
<br />
The original snippet<br />
Push String to do replacement in (haystack)<br />
Push String to replace (needle)<br />
Push Replacement<br />
Call StrRep<br />
Pop $R0 result<br />
<br />
Your Snippet<br />
Push $INSTDIR<br />
Push &quot;\&quot;<br />
Call StrSlash<br />
Pop $0<br />
;Now $R0 contains the $INSTDIR with forward slashes<br />
<br />
or just your snippet instead?<br />
<br />
Also do I save the function to an NSH and use it the same way I use the other files &quot;StrReplace.nsh&quot; and &quot;ReplaceInFile.nsh&quot;?<br />
<br />
Thank you so much for your patience with me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th June 2003, 20:13</div></div><div class="posttext">There other ones are macro's. You don't have to use a macro for this one.<br />
<br />
Use my snippet. Your snippet is for the generic replacer (read the page again).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 20:36</div></div><div class="posttext">OK, I just need to confirm this before I find myself doing loops.<br />
<br />
I use your snippet, not the other one. I save the function to a StrRep.nsh file in my project folder...<br />
<br />
OK, once this is all done, how do I say replace this marker @@AbsolutePath@@ with $INSTDIR and your &quot;SNIPPET&quot;, provided I've got the above mentioned solution correct so far?<br />
<br />
Once I know a little more about the last step, I feel I can move ahead with experiment, otherwise I know I will simply be asking the same question in just a few moments.<br />
<br />
I really am no geek and need to take it just a little slow. I hope you understand. I absolutely appreciate all the help you're giving me, I just need to know the best last step...<br />
<br />
How to replace @@AbsolutePath@@ with $INSTDIR and your &quot;SNIPPET&quot;?<br />
<br />
Thank you so much for your time I undoubtedly appreciate it all very much.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th June 2003, 21:10</div></div><div class="posttext">Just use the variable ($0 in my example). Like kichik said:<br />
<br />
!insertmacro ReplaceInFile &quot;$INSTDIR\myotherfile.ini&quot; &quot;@marker@&quot; &quot;$0&quot; <br />
<br />
So you have to put the last snippet above this code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 21:29</div></div><div class="posttext">I just tried the following code...<br />
<br />
; This snippet should help in replacing the Absolute system paths by replacing &quot;\&quot; with &quot;/&quot;.<br />
Push $INSTDIR<br />
Push &quot;\&quot;<br />
Call StrSlash<br />
Pop $0<br />
;Now $R0 contains the $INSTDIR with forward slashes<br />
!insertmacro ReplaceInFile &quot;$INSTDIR\crash.txt&quot; &quot;@AbsolutePath@&quot; &quot;$0&quot;<br />
<br />
But it keeps stopping at &quot;Push $INSTDIR&quot; with the following error &quot;Error: Can't add entry, no section or function is open!&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 21:34</div></div><div class="posttext">I've also tried the following<br />
Section &quot;Replace @AbsolutePath@&quot;<br />
; This snippet should help in replacing the Absolute system paths by replacing &quot;\&quot; with &quot;/&quot;.<br />
Push $INSTDIR<br />
Push &quot;\&quot;<br />
Call StrSlash<br />
Pop $0<br />
;Now $R0 contains the $INSTDIR with forward slashes<br />
!insertmacro ReplaceInFile &quot;$INSTDIR\crash.txt&quot; &quot;@AbsolutePath@&quot; &quot;$0&quot;<br />
SectionEnd<br />
<br />
But I end up with the following error...<br />
Adding plug-ins initializing function... Done!<br />
Error: resolving install function &quot;StrSlash&quot; in section &quot;Replace @AbsolutePath@&quot; (5)<br />
Note: uninstall functions must begin with &quot;un.&quot;, and install functions must not<br />
Error - aborting creation process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">17th June 2003, 22:08</div></div><div class="posttext">I solved it Joost! I forgot to insert the !include... Excellent, Thank you so much for your time :) Everyone will get a thank you in my credits :)<br />
<br />
Thank you for putting up with me with so far<br />
<br />
Thanks again</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>