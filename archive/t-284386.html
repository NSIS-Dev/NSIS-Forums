<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help running a batch file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help running a batch file NSIS Discussion" />
	
	<title> Need help running a batch file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help running a batch file</div>
<hr />
<div class="pda"><a href="t-284386.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=284386">Need help running a batch file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">4th January 2008, 21:02</div></div><div class="posttext">I want to launch my Java app via a batch file using NSIS once the installer has finished. <br />
I've tested the batch file from the command line and it works fine.<br />
<br />
I've tried the following using NSIS:<br />
<br />
<br />
..<br />
...<br />
<br />
!define MUI_FINISHPAGE_RUN<br />
!define MUI_FINISHPAGE_RUN_TEXT &quot;Launch Zang&quot; <br />
!define MUI_FINISHPAGE_RUN_FUNCTION &quot;LaunchZang&quot;<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
...<br />
...<br />
...<br />
<br />
Function LaunchZang<br />
  ReadEnvStr $0 COMSPEC<br />
  nsExec::Exec  '$0 /c &quot;$INSTDIR\client\startZang.bat&quot;'<br />
FunctionEnd<br />
<br />
<br />
The problem is that the app launches but doesn't get any further than the splash screen it just hangs there.<br />
<br />
I do not wish to see a command window and have therefore used nsExec.<br />
<br />
Any ideas would be greatly appreciated.<br />
<br />
Regards<br />
<br />
Paul g</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th January 2008, 01:07</div></div><div class="posttext">Make sure you have the correct working directory set first with SetOutPath.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">5th January 2008, 16:46</div></div><div class="posttext">Hi<br />
<br />
Thanks for the reply, I can't test that until i'm back to work on Monday morning.<br />
<br />
I'm not sure that is the problem though. On the MUI_FINISHPAGE I have four check boxes, one of those is to launch the app, the second to show a README doc and the other two are for shortcuts.<br />
<br />
My Finish page looks like this:<br />
<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE CreateControls<br />
!define MUI_PAGE_CUSTOMFUNCTION_SHOW SetControlColours<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE DisplayQuickLaunchAndDesktopIcon<br />
!define MUI_FINISHPAGE_SHOWREADME<br />
!define MUI_FINISHPAGE_SHOWREADME_TEXT &quot;Show release notes&quot;<br />
!define MUI_FINISHPAGE_SHOWREADME_FUNCTION ShowReleaseNotes<br />
!define MUI_FINISHPAGE_RUN<br />
!define MUI_FINISHPAGE_RUN_TEXT &quot;Launch Zang&quot;<br />
!define MUI_FINISHPAGE_RUN_FUNCTION &quot;LaunchZang&quot;<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
<br />
and the 2 functions that launches the app and dislays the README stuff.<br />
<br />
<br />
Function LaunchZang<br />
  ReadEnvStr $0 COMSPEC<br />
  nsExec::Exec  '$0 /c &quot;$INSTDIR\client\startZang.bat&quot;'<br />
FunctionEnd<br />
<br />
Function ShowReleaseNotes<br />
  ExecShell &quot;open&quot; &quot;$INSTDIR\README.txt&quot;<br />
FunctionEnd<br />
<br />
<br />
The function ShowReleaseNotes works, but LaunchZang does not as previously explained. <br />
<br />
What I don't understand is why does one work and the other doesn't. If I was in an incorrect working directory as you suspect then surely both would fail.<br />
<br />
Regards<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th January 2008, 20:27</div></div><div class="posttext">If your app uses relative paths then the working directory would need to be set correctly. Running notepad does not have the same dependency, although in theory if you went to File&gt;Open in notepad, you'd find that it would open in the working folder you had set when you ran notepad.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">5th January 2008, 21:04</div></div><div class="posttext">I'll give that a go on Monday.<br />
<br />
Thanks Stu.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">7th January 2008, 12:23</div></div><div class="posttext">Hi<br />
<br />
Setting SetOutPath has worked and the application now launches. <br />
<br />
<br />
Function LaunchZang<br />
  SetOutPath &quot;$INSTDIR\client&quot; ;new line<br />
  ReadEnvStr $0 COMSPEC<br />
  nsExec::Exec  '$0 /c &quot;$INSTDIR\client\startZang.bat&quot;'<br />
FunctionEnd<br />
<br />
<br />
<br />
However, the finish page of the installer does not go away it just turns completely white.<br />
<br />
It seems like the installer for whatever reason cannot end.<br />
<br />
Any ideas what may be causing this.<br />
<br />
Regards<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">7th January 2008, 12:53</div></div><div class="posttext">Hi<br />
<br />
As I'm having difficulties running a bat file I thought I would you the same line of code from the .bat file and use Exec instead.<br />
<br />
<br />
Function LaunchZang<br />
  SetOutPath &quot;$INSTDIR\client&quot;<br />
  Exec '&quot;..\jre_v6\bin\javaw.exe&quot; -cp .\BrowserLauncher2-10rc4.jar;.\Connected.jar;.\flickrapi-1.0b4.jar;.\jdic.jar;.\jh.jar;.\jregex1.2_01.jar;.\JSON.jar;.\mail.jar com.kc.pm.PhoneManager -Xmx210m'<br />
FunctionEnd<br />
<br />
<br />
This works perfect on my development machine, however, when I come to install the .exe on a new laptop the application does not launch from the finish page. You can only launch it from the shorcuts (Desktop &amp; quicklaunch).<br />
<br />
Any ideas?<br />
<br />
Regards<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th January 2008, 13:15</div></div><div class="posttext">The path $INSTDIR\jre_v6\bin\javaw.exe is correct?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">7th January 2008, 13:40</div></div><div class="posttext">Absolutely, I know for sure because the javaw.exe is in the process list.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th January 2008, 15:30</div></div><div class="posttext">Try using ExecWait with the extra exit code parameter and see what the exit code is.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">7th January 2008, 16:41</div></div><div class="posttext">Just to clarify, the following function displays 0.<br />
<br />
<br />
Function LaunchZang<br />
  SetOutPath &quot;$INSTDIR\client&quot;<br />
  ExecWait '&quot;..\jre_v6\bin\javaw.exe&quot; -cp .\BrowserLauncher2-10rc4.jar;.\Connected.jar;.\flickrapi-1.0b4.jar;.\jdic.jar;.\jh.jar;.\jregex1.2_01.jar;.\JSON.jar;.\mail.jar com.kc.pm.PhoneManager -Xmx210m' $0<br />
  MessageBox MB_OK &quot;return value $0&quot;<br />
FunctionEnd<br />
<br />
<br />
The app launches but the installer does not close. Even when you click the finish button on the installer nothing happens. I have to kill the app, after that I get the error value of 0, then I get the README notes appear, only then does the installer close.<br />
<br />
The version of NSIS I am using is 3.34 (e.g. the latest)<br />
<br />
Regards Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th January 2008, 17:21</div></div><div class="posttext">ExecWait as the instruction suggests executes the command and waits for it to finish. There's no reason why ExecWait would work but Exec wouldn't...<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">7th January 2008, 17:36</div></div><div class="posttext">Well all I can tell you is that it works fine on my development machine Both Exec and ExecWait. However, if I take the .exe and do an install on a new machine (e.g. a laptop) then it fails on both accounts.<br />
<br />
I don't know what I am going to do! It's the same script for both machines. Do you have any further suggestions?<br />
<br />
Regards<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th January 2008, 17:39</div></div><div class="posttext">Feel free to send me your script and I shall take a look.<br />
My E-mail address is on my web page: http://www.afrowuk.co.uk<br />
<br />
Edit: Or attach here of course.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">7th January 2008, 18:06</div></div><div class="posttext">Thanks for that, I have already mailed it.<br />
<br />
Cheers<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th January 2008, 19:30</div></div><div class="posttext">Ok looking at the script, the command line exceeds MAX_PATH. Not sure if that matters but try putting \\?\ in front of the executable path.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">8th January 2008, 10:22</div></div><div class="posttext">Thanks,<br />
 <br />
I may have found the problem. Our Java application has DLL dependencies. These DLLs are put onto the system path. On my development machine this path is always set. When I do a build these DLLs are incorporated into the installer and the system path is set accordingly. When the application is launched from the finish page it it not picking up the path to the DLLs that I've included in the system path.<br />
<br />
Providing I do not launch from the finish page and the installer finishes naturally the Desktop icon and Quick launch icon work perfectly because they start in a new process and pickup the system path.<br />
<br />
Can can I launch from the finish page and pickup the system path? This will solve this issue.<br />
<br />
Regards<br />
<br />
Paul</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th January 2008, 13:04</div></div><div class="posttext">This topic might help:<br />
http://forums.winamp.com/showthread.php?threadid=273924<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgg1</div><div class="date">10th January 2008, 23:48</div></div><div class="posttext">Thanks,<br />
<br />
Sorry for the late reply but I got rail roaded into something else at work.<br />
<br />
Anyway, I have read the topic that you recommended. I have used Kichik's script which can be found here: http://nsis.sourceforge.net/Path_Manipulation<br />
<br />
I've added the additional code as per the topic. However, what is KEY_QUERY_VALUE defined as? The compiler is moaning and just ignores that line.<br />
<br />
Any ideas?<br />
<br />
Regards<br />
<br />
Paul</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>