<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Complex s/w updater question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Complex s/w updater question NSIS Discussion" />
	
	<title> Complex s/w updater question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Complex s/w updater question</div>
<hr />
<div class="pda"><a href="t-188208.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=188208">Complex s/w updater question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">memph</div><div class="date">29th July 2004, 17:14</div></div><div class="posttext">Hi,<br />
<br />
 I've got to create an application updater which is able to update an existing installation over http with the following requirements:<br />
<br />
 - It has update a file if the local version is older than the remote one<br />
 - It has to download a file if it does not exists locally.<br />
<br />
I think I've got to make a &quot;versioning&quot; file which contains some version number for all files. It could contain a line for each file, containing the filename (including the relative path) and a version number. This versioning file would have a local and a remote copy and the difference between these files would tell which files shall I replace or download.<br />
<br />
 Because the number of the files in question may vary, and quite large, I believe I cannot rely making an INI file (though it would be so easy :( ) and read it via ReadIniStr, since I don't know all the filenames and there's no iterator in NSIS AFAIK.<br />
 I think if creating a small 'diff' plugin which would do the task, however before digging into plugin creation I thought I ask you if there's another, easier to do this.<br />
<br />
Regards,<br />
<br />
Memph<br />
<br />
P.S.:<br />
BTW, is it possible to use C++ STL classes in an NSIS plugin?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2004, 17:40</div></div><div class="posttext">The easiest thing would be to do it in these steps:<br />
<br />
1. Download a file off HTTP containing latest version using NSISdl plugin.<br />
2. Compare it to the last version which should exist in registry.<br />
3. If versions differ, write new version to registry.<br />
4. Download new file using NSISdl (if versions differ).<br />
<br />
To see if a file exists, use IfFileExists &quot;file&quot; jumpto_ifexists jumpto_ifnotexists<br />
So, if the file does not exist, use NSISdl to grab the file!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">memph</div><div class="date">30th July 2004, 08:45</div></div><div class="posttext">Hi Afrow UK,<br />
<br />
 The file you're talking about is the version file I mentioned? Then how would you do the comparison? By reading the file line by line and checking the a value - data pair in the registry if it already exists and is lower than the one in the file?<br />
<br />
Regards,<br />
<br />
Zoltan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 12:11</div></div><div class="posttext">Well, it doesn't have to check if the version value is higher or lower than the one in the registry. If it's not the same then obviously the user has an older version (because he can't have an older version than the server!)<br />
<br />
Ass for the version file, it would be easiest to use an INI file.<br />
E.g.<br />
[Version]<br />
Latest=1.0.0.2<br />
<br />
In your script, simply use<br />
ReadINIStr $R0 &quot;downloaded\file.ini&quot; &quot;Version&quot; &quot;Latest&quot;<br />
<br />
With INI files, I also added other stuff in there including news of what's in the latest release which was listed in a IO textarea!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 12:13</div></div><div class="posttext">Oh and btw, the program I'm talking about (written with NSIS 2.0b CVS) you can see screenshots here (http://dynamic5.gamespy.com/~ddc/site/dev_ddayupdater.shtml).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">memph</div><div class="date">30th July 2004, 12:55</div></div><div class="posttext">So the version file contains a version number (so the updater cand check if an update is needed), and a ListBox whose Text contains the list of the files that have changed since the last version..<br />
What if the a user missed update?<br />
<br />
Regards,<br />
<br />
Memph</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">30th July 2004, 13:07</div></div><div class="posttext">@Afrow UK: Wow, the &quot;download filters&quot; and &quot;download options&quot; dialogs are made mixing Banner plugin w/ InstallOptions. You even tried to put the pictures in the background, that means, you tried to bypass NSIS limitations to make that. That's great (only looking at it, I didn't test it because I don't play the game, sorry).<br />
<br />
@memph: I have a suggestion: <br />
<br />
- Put the date when the file was modified for every file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 13:54</div></div><div class="posttext">The dialogue is actually an extracted NSIS exe without<br />
WS_MINIMIZEBOX, WS_CAPTION and WS_SYSMENU.<br />
Good ol' Resource Hacker.<br />
<br />
I made that about a year ago now. It still amazes me how much I put into it (the game I made it for is pretty dead now.)<br />
<br />
The code was pretty advanced. It updated itself as well as the game I made it for. It also checked for file differences (size to be exact) for updating as well as non existent files and game dll's.<br />
<br />
Edit: Not to mention it even had random BMP's on the side, plus messages on the task-bar. It also downloaded Zip files and extracted them to the correct folders for you!!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">30th July 2004, 14:06</div></div><div class="posttext">The game I made it for is pretty dead now.<br />
<br />
Oh yeah, that's for sure. The problem is that I do for one that's even older than your game. I don't even play it because it's boring.<br />
<br />
The code was pretty advanced. It updated itself as well as the game I made it for. It also checked for file differences (size to be exact) for updating as well as non existent files and game dll's.<br />
<br />
Probably you're using CVS from a site, isn't it?<br />
<br />
[quote]Not to mention it even had random BMP's on the side, plus messages on the task-bar.[\quote]<br />
<br />
Doesn't these BMP consume much size?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 15:02</div></div><div class="posttext">The whole download was one exe of about 2.5mb. The random BMP's consisted of about 5 different ones that were in the exe (uncompressed to temp).<br />
<br />
No CVS. Just a basic file which would be downloaded and parsed which contained download URL's, download info, download versions etc.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">memph</div><div class="date">30th July 2004, 16:24</div></div><div class="posttext">Afrow,<br />
<br />
 Could you please post the download INI? May be I'll get the clue.<br />
<br />
Regards,<br />
<br />
Memph</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2004, 16:33</div></div><div class="posttext">As far as I know, the server that hosted the TXT (INI) file is no longer running.<br />
<br />
However, the secondary TXT file with other information is still on my ISP webspace: http://myweb.tiscali.co.uk/imker/ddayupdater/du_objects.txt<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">memph</div><div class="date">30th July 2004, 17:24</div></div><div class="posttext">Thanks<br />
<br />
Memph</div></div><hr />


<div class="post"><div class="posttop"><div class="username">solwolf</div><div class="date">27th September 2006, 07:48</div></div><div class="posttext">Currently running into the same problem.  Here are the steps i have in my logic.<br />
<br />
1. !define homeurl &quot;http://www.somewebsite.com/downloads/&quot;<br />
<br />
2. use Inetload (http://nsis.sourceforge.net/InetLoad_plug-in)  to download update.ini<br />
<br />
3. Read in each line of the file and parse the 2 into differnt variables $R0 &amp; $R1 (for example)  $R0 == File name  $R1 == timestamp of modified date.<br />
<br />
4. do a IfFileExists on the $R0 if so timestamp it and store in in $R2 if not jump to HomeUrl$R0 (see step 1)using inetload<br />
<br />
5. strCmp $R1 $R2 &quot;&quot; HomeUrl$R0 (using inetload)<br />
<br />
***********<br />
I created a php page that dynamically searches the server where the files are located and does a timestamp to the file and stores in a txt then i rename it after i am done to an ini.  (for some reason couldn't write to ini) *see attachment for my ini file*<br />
<br />
I read in the line by line and i tried parsing and it works but it seems to never get out of my parsing loop. and i have been stuck at that point for couple days really rattling my brain.<br />
<br />
<br />
If you guys could point me in the right direction to how i can read from a ini file (dynamically) and parse line into 2 sections and pop them to 2 different variables?  Your help would greatly be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zbd</div><div class="date">8th November 2006, 04:38</div></div><div class="posttext">I really wouldn't have a clue...but<br />
what if you wrote the filename to one line and then the timestamp on the next line... no idea if this would be useful</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Striker53</div><div class="date">24th March 2007, 13:25</div></div><div class="posttext">Hey, could anyone give me an example how the *.nsi should looks?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>