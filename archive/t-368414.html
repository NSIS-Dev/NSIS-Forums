<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS Develop, Deploy 32 bit applications to 64 bit Windows?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS Develop, Deploy 32 bit applications to 64 bit Windows? NSIS Discussion" />
	
	<title> NSIS Develop, Deploy 32 bit applications to 64 bit Windows? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS Develop, Deploy 32 bit applications to 64 bit Windows?</div>
<hr />
<div class="pda"><a href="t-368414.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=368414">NSIS Develop, Deploy 32 bit applications to 64 bit Windows?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">anderci</div><div class="date">8th August 2013, 15:55</div></div><div class="posttext">I think I am close.  For 32 bit I can install, run and uninstall.<br />
For 64 bit (Win7 x64) I can install, run but uninstall only the application, not the data.<br />
x64 requires two 'install directories', one for the app and one for any data created by the app (including its .ini file)  In addition to the $INSTDIR variable, I defined another: $DATADIR <br />
What am I missing?<br />
Here are parts of the script that almost works:<br />
  var /GLOBAL DATADIR				<br />
   :<br />
   :<br />
Function dir_pge_txt_dest<br />
	${If} ${AtLeastWinVista}<br />
		!define $MUI_DIRECTORYPAGE_TEXT_DESTINATION &quot;Setup will install ${MUI_PRODUCT} ${MUI_VERSION} in the Following folder. To install in a difFerent folder, click Browse and select another Folder. Click Install to start the installation.  It is imperative to install into the C:\Users\Public\... folder structure! &quot;<br />
	${EndIf}<br />
FunctionEnd  <br />
<br />
Function .onVerifyInstDir<br />
    ${If} ${RunningX64}					<br />
    ${Else}<br />
		StrCpy $DATADIR $INSTDIR<br />
    ${EndIf}					        <br />
FunctionEnd <br />
   :<br />
   :<br />
   :<br />
  !define MUI_WELCOMEPAGE  <br />
  !define MUI_LICENSEPAGE<br />
  !define MUI_DIRECTORYPAGE<br />
<br />
  !define MUI_ABORTWARNING<br />
  !define MUI_UNINSTALLER<br />
  !define MUI_UNCONFIRMPAGE<br />
  !define MUI_FINISHPAGE <br />
  <br />
Function .onInit<br />
  ${If} ${AtLeastWinVista}<br />
    ${If} ${RunningX64}					<br />
      StrCpy $INSTDIR &quot;$PROGRAMFILES32\Clark_Anderson\${MUI_FILE}&quot;<br />
      StrCpy $DATADIR &quot;C:\Users\Public\Clark_Anderson\${MUI_FILE}&quot;<br />
    ${Else}					            <br />
       StrCpy $INSTDIR &quot;C:\Users\Public\Clark_Anderson\${MUI_FILE}&quot;<br />
       StrCpy $DATADIR &quot;C:\Users\Public\Clark_Anderson\${MUI_FILE}&quot;   <br />
    ${EndIf}					       <br />
  ${Else}<br />
    StrCpy $INSTDIR &quot;$PROGRAMFILES\Clark_Anderson\${MUI_FILE}&quot;<br />
    StrCpy $DATADIR &quot;$PROGRAMFILES\Clark_Anderson\${MUI_FILE}&quot;    <br />
  ${EndIf}<br />
FunctionEnd  <br />
   :<br />
   :<br />
   :<br />
Section &quot;Sample Data Files (Optional: Recommended for starting)&quot;<br />
  SectionIn 2<br />
 SetOutPath &quot;$DATADIR\DataBases&quot;<br />
   :<br />
   :<br />
SectionEnd<br />
<br />
Section &quot;Uninstall&quot;<br />
   :<br />
   :<br />
   :<br />
   :<br />
;Delete Files <br />
  Delete &quot;$INSTDIR\*.*&quot;    					<br />
  Delete &quot;$DATADIR\Reports\Templates\*.*&quot;    <br />
  Delete &quot;$DATADIR\Reports\*.*&quot;    			<br />
  Delete &quot;$DATADIR\DataBases\*.*&quot;    		<br />
  Delete &quot;$DATADIR\ExpImport\*.*&quot;    		<br />
  Delete &quot;$DATADIR\*.*&quot;    					<br />
 <br />
;Remove the installation directory<br />
  RMDir /r &quot;$INSTDIR&quot;<br />
  RMDir /r &quot;$DATADIR\Reports\Templates\*.*&quot;    <br />
  RMDir /r &quot;$DATADIR\Reports\*.*&quot;    			<br />
  RMDir /r &quot;$DATADIR\DataBases\*.*&quot;    		<br />
  RMDir /r &quot;$DATADIR\ExpImport\*.*&quot;    		<br />
  RMDir /r &quot;$DATADIR&quot;<br />
 <br />
;Delete Start Menu Shortcuts<br />
  Delete &quot;$DESKTOP\${MUI_PRODUCT}.lnk&quot;<br />
  Delete &quot;$SMPROGRAMS\${MUI_PRODUCT}\*.*&quot;<br />
  RmDir  &quot;$SMPROGRAMS\${MUI_PRODUCT}&quot;<br />
 <br />
;Delete Uninstaller And Unistall Registry Entries<br />
  DeleteRegKey HKEY_LOCAL_MACHINE &quot;SOFTWARE\${MUI_PRODUCT}&quot;<br />
  DeleteRegKey HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}&quot;  <br />
 <br />
SectionEnd<br />
   :<br />
   :</div></div><hr />


<div class="post"><div class="posttop"><div class="username">anderci</div><div class="date">9th August 2013, 13:30</div></div><div class="posttext">I tried changing   ShowUninstDetails &quot;nevershow&quot;   to   &quot;show&quot;  or  show<br />
<br />
The details went by so fast I could not hope to read them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th August 2013, 15:41</div></div><div class="posttext">${If} ${AtLeastWinVista}<br />
!define $MUI_DIRECTORYPAGE_TEXT_DESTINATION &quot;Set...&quot;<br />
${EndIf}<br />
Will not work, !define will always be set.<br />
<br />
You should not treat x64 like this, why do you think it needs its own data dir. If there is a need for a data dir then all versions of NT need it.<br />
<br />
If you are installing a 64bit application and/or driver then you need to check, if not you should try to treat it the same as 32bit Windows...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">anderci</div><div class="date">10th August 2013, 13:02</div></div><div class="posttext">Thank you for responding.<br />
My applications are all 32 bit.<br />
The quoted segment is a residual form earlier in my learning curve.  I guess it does nothing?  I do not see the full text anywhere.  <br />
I probably should remove the entire Function dir_pge_txt_dest .<br />
<br />
I do not have any other instances of trying to enclose a !define phrase within logic.<br />
<br />
My primary difficulty is that the uninstall if RunningX64 does not delete the $DATADIR files and folders.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">anderci</div><div class="date">12th August 2013, 13:21</div></div><div class="posttext">My choice of title for this thread hid my real question, so I have moved my question to a new thread:  http://forums.winamp.com/showthread.php?t=368666</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>