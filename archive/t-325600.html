<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Windows 7 Start Menu, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Windows 7 Start Menu NSIS Discussion" />
	
	<title> Windows 7 Start Menu [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Windows 7 Start Menu</div>
<hr />
<div class="pda"><a href="t-325600.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=325600">Windows 7 Start Menu</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">6th January 2011, 11:28</div></div><div class="posttext">I thought my installer was working correctly but I have just noticed some strange behaviour in Windows 7<br />
<br />
If I install it as a user it allows me to uninstall fine, removes the startmenu items.  But if I install as an admin and try and uninstall as a user it asks me to elevate and then leaves the icons in the start menu.<br />
<br />
Which plugin or example should I be looking at the resolve my Windows 7 issues?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">6th January 2011, 14:17</div></div><div class="posttext">My installer is real simple, It just dumps some files into a folder in Program Files and doesn't use any registry entries at all.<br />
<br />
I have added this section<br />
<br />
Section<br />
SetShellVarContext all<br />
CreateDirectory &quot;$SMPROGRAMS\mypack&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\mypack\myprog.lnk&quot; &quot;$INSTDIR\myprog.exe&quot;<br />
CreateShortCut &quot;$DESKTOP\myprog.lnk&quot; &quot;$INSTDIR\myprog.exe&quot;<br />
SectionEnd<br />
<br />
As far as I am aware this should create the Start Menu items and the Desktop icon for all users, but it is not :(<br />
<br />
Am I doing things right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">6th January 2011, 14:45</div></div><div class="posttext">Use requestexecutionlevel admin to request admin access in the manifest, and then use userInfo::getAccountType in .onInit and un.onInit to verify that you have admin access.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">6th January 2011, 15:14</div></div><div class="posttext">Are there any more arguments to use with...<br />
<br />
Function .oninit<br />
userInfo::getAccountType<br />
FunctionEnd<br />
<br />
and<br />
<br />
Function un.onInit<br />
userInfo::getAccountType<br />
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you want to completely remove $(^Name) and all of its components?&quot; IDYES +2<br />
  Abort<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th January 2011, 19:15</div></div><div class="posttext">Yes, you actually need to check the result, http://nsis.pastebin.com/63tS3AS2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">10th January 2011, 13:24</div></div><div class="posttext">After much messing I have decided to go with the template you created a while ago at http://www.nsis.pastebin.com/PmiY8DuZ<br />
<br />
This works for me and resolves the issue I have been having, only one more problem though I was wondering if you could help with.<br />
<br />
I wanted to have a pre-defined Start Menu folder, currently when you get to the Start Menu page is just displays 'Product Name'<br />
<br />
I want it to automatically display 'Company Name/Product Name'<br />
<br />
I have messed about with MUI_STARTMENUPAGE_DEFAULTFOLDER but this just seems to break the installer, can you point me in the right direction?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th January 2011, 13:42</div></div><div class="posttext">I have messed about with MUI_STARTMENUPAGE_DEFAULTFOLDER but this just seems to break the installer, can you point me in the right direction?<br />
<br />
Break how? ( / could be a problem, try \ )<br />
<br />
The only problem with nested folders is deleting them.<br />
<br />
If I add !define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;test\test2&quot; to the top of my script, it works fine, but I need<br />
${If} $SMDir != &quot;&quot;<br />
	###TODO: Delete &quot;$SMPrograms\$SMDir\${APPNAME}.lnk&quot;<br />
	ClearErrors<br />
	${Do}<br />
		RMDir &quot;$SMPrograms\$SMDir&quot;<br />
		StrCpy $SMDir &quot;$SMDir\..&quot;<br />
		${IfThen} ${Errors} ${|} ${Break} ${|}<br />
	${Loop} <br />
${EndIf}<br />
to delete the folders</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">10th January 2011, 15:14</div></div><div class="posttext">All working now, thanks for all the help :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">11th January 2011, 10:09</div></div><div class="posttext">I've just spotted one last issue, because I have set the folder using....<br />
<br />
!define MULTIUSER_INSTALLMODE_INSTDIR &quot;Company Name\Product Name\Version&quot;<br />
<br />
When it comes to uninstalling, RMDir &quot;$INSTDIR&quot; only seems to delete the Version folder, the Company Name\ Product Name folder stays<br />
<br />
Help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th January 2011, 12:18</div></div><div class="posttext">Use the same code that Anders posted for that too.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">11th January 2011, 12:56</div></div><div class="posttext">Which particular code?  The one from the pastebin link or the ammendment he posted a few replies back?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">11th January 2011, 13:41</div></div><div class="posttext">So am I right in thinking I can just add to this section instead of creating a whole new one for INSTdir?<br />
<br />
!insertmacro ReadUninstData $SMDir SMDir<br />
${If} $SMDir != &quot;&quot;<br />
	###TODO: Delete &quot;$SMPrograms\$SMDir\${APPNAME}.lnk&quot;<br />
	    Delete &quot;$SMPrograms\$SMDir\${APPNAME}.lnk&quot;<br />
	    Delete &quot;$SMPrograms\$SMDir\Uninstall.lnk&quot;<br />
	    Delete &quot;$DESKTOP\programlink.lnk&quot;<br />
    ClearErrors<br />
    ${Do}<br />
        RMDir &quot;$SMPrograms\$SMDir&quot;<br />
        StrCpy $SMDir &quot;$SMDir\..&quot;<br />
        ${IfThen} ${Errors} ${|} ${Break} ${|}<br />
    ${Loop}<br />
<br />
${EndIf}<br />
DeleteRegKey SHCTX &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${REGUINSTKEY}&quot;<br />
Delete &quot;$INSTDIR\uninstall.exe&quot;<br />
RMDir &quot;$INSTDIR&quot;<br />
RMDir &quot;$PROGRAMFILES\Company Name\Product Name&quot;<br />
RMDir &quot;$PROGRAMFILES\Company Name&quot;<br />
messageBox MB_OK &quot;$PROGRAMFILES\${MULTIUSER_INSTALLMODE_INSTDIR}&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th January 2011, 14:25</div></div><div class="posttext">You could do it that way but that's not recursive. If you change $INSTDIR your code will no longer work. Up to you really.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">11th January 2011, 14:43</div></div><div class="posttext">Sorry to sound daft but I am struggling to adapt that code to work for the Current User install directory instead of SMDir which it currently does</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th January 2011, 16:11</div></div><div class="posttext">StrCpy $R0 $INSTDIR<br />
ClearErrors<br />
${Do}<br />
  RMDir $R0<br />
  ${IfThen} ${Errors} ${|} ${Break} ${|}<br />
  StrCpy $R0 `$R0\..`<br />
${Loop}Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">11th January 2011, 16:26</div></div><div class="posttext">Thanks for that, everything seems to be working!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th January 2011, 18:11</div></div><div class="posttext">I updated the samples with a general function for this, get it from http://sn.im/1tmfzt</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>