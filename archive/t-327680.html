<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" CopyFiles [size_of_files_in_kb], media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  CopyFiles [size_of_files_in_kb] NSIS Discussion" />
	
	<title> CopyFiles [size_of_files_in_kb] [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  CopyFiles [size_of_files_in_kb]</div>
<hr />
<div class="pda"><a href="t-327680.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327680">CopyFiles [size_of_files_in_kb]</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dcbrewster</div><div class="date">21st February 2011, 21:43</div></div><div class="posttext">Compilation Problem - not execution problem.<br />
<br />
I cannot get the CopyFiles command to accept the optional parameter of [size_of_files_in_kb]. I have tried every combination of syntax that I can think of but no go. When I replace the &quot;${DIRSIZE}&quot; variable on the command line with a value such as 100 or &quot;100&quot;, the compile works fine.<br />
<br />
Any suggestions?<br />
<br />
<br />
<br />
Script Extract<br />
<br />
Function .onInit<br />
  ${GetSize} &quot;$EXEDIR\corrected&quot; &quot;/S=1K&quot; $0 $1 $2                                ;Get Directory Size<br />
  !define DIRSIZE $0                                                             ;Save Directory Size<br />
  MessageBox MB_OK &quot;Size is ${DIRSIZE} Kb&quot;<br />
  IfErrors 0 End                                                                 ;Errors?<br />
  MessageBox MB_ICONSTOP &quot;Error:$\n$\nFiles not found.&quot;      			 ;Message To User<br />
  Abort                                                                          ;Abort Installation<br />
<br />
End:<br />
FunctionEnd<br />
<br />
Section &quot;MainSection&quot; SEC01<br />
  SetOutPath &quot;$INSTDIR&quot;                                                          ;Set/Confirm Destination<br />
  SetOverwrite ON                                                                ;Overwrite Files<br />
  CopyFiles /SILENT &quot;$EXEDIR/corrected/*.*&quot; &quot;$INSTDIR&quot; &quot;${DIRSIZE}&quot;              ;Copy files<br />
SectionEnd<br />
<br />
<br />
<br />
BTW: Looks like the NSIS Help file needs to be corrected.<br />
NSIS Help File<br />
[/SILENT] [/FILESONLY] filespec_on_destsys destination_path [size_of_files_in_kb]<br />
<br />
<br />
HM NSIS Editor Prompt<br />
[/SILENT] [/FILESONLY] source_path destination_path [size_of_files_in_kb]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">21st February 2011, 23:30</div></div><div class="posttext">Everyone has the same confusion: Variables assigned to defined constants don't do what they expect. In this case you are telling the compiler that the number of KB that will be used for the copy is &quot;$0&quot;. That is not a value the compiler can handle. You need to put the actual size in your source, don't try to do it at runtime, that doesn't work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dcbrewster</div><div class="date">22nd February 2011, 00:41</div></div><div class="posttext">Thanks, but I don't know the size of the files to be copied. The files are outside the installation routine.<br />
<br />
The two other copyfiles parameters accept variables but not the third?<br />
Without the size parameter the Install Directory dialog will show 0 disk requirements.<br />
I get the proper size via getsize but can't tell the user.<br />
<br />
Dave</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">22nd February 2011, 06:17</div></div><div class="posttext">It sounds like you are looking for SectionSetSize (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.13.7). Make sure you move the .onInit function in your code... the sections have to be declared before you reference the section ids.<br />
Section &quot;MainSection&quot; SEC01<br />
SetOutPath &quot;$INSTDIR&quot; ;Set/Confirm Destination<br />
SetOverwrite ON ;Overwrite Files<br />
CopyFiles /SILENT &quot;$EXEDIR/corrected/*.*&quot; &quot;$INSTDIR&quot; ;Copy files<br />
SectionEnd<br />
<br />
Function .onInit<br />
${GetSize} &quot;$EXEDIR\corrected&quot; &quot;/S=1K&quot; $0 $1 $2 ;Get Directory Size<br />
SectionSetSize ${SEC01} $0<br />
MessageBox MB_OK &quot;Size is $0 Kb&quot;<br />
IfErrors 0 End ;Errors?<br />
MessageBox MB_ICONSTOP &quot;Error:$\n$\nFiles not found.&quot; ;Message To User<br />
Abort ;Abort Installation<br />
End:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dcbrewster</div><div class="date">22nd February 2011, 06:40</div></div><div class="posttext">demiller9,<br />
<br />
SectionSetSize did the job. Always more to learn.<br />
<br />
Thanks for your help.<br />
<br />
Dave</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>