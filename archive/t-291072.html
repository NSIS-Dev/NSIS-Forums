<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" WMI plug-in, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  WMI plug-in NSIS Discussion" />
	
	<title> WMI plug-in [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  WMI plug-in</div>
<hr />
<div class="pda"><a href="t-291072.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291072">WMI plug-in</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">l0k1</div><div class="date">30th April 2008, 15:14</div></div><div class="posttext">Attached plugin supports wmi request from MS API call.<br />
I have included script sample.<br />
<br />
For now it can retrieve :<br />
<br />
 * OS Name <br />
 * OS Version<br />
 * AntiVirus Name<br />
 * FireWall Name<br />
 * CPU Name<br />
 * Desktop resolution<br />
 * Any information if you provide correct parameters<br />
<br />
Any suggestion are welcomed.<br />
<br />
More info could be found at the NSIS Wiki plugin page <br />
http://nsis.sourceforge.net/WmiInspector_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l0k1</div><div class="date">6th May 2008, 14:59</div></div><div class="posttext">I've just added <br />
<br />
* SQL Version</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l0k1</div><div class="date">6th May 2008, 15:02</div></div><div class="posttext">Forgot to join file :o</div></div><hr />


<div class="post"><div class="posttop"><div class="username">l0k1</div><div class="date">31st July 2008, 14:30</div></div><div class="posttext">Added :<br />
<br />
*UserName<br />
*ShortUserName<br />
*UserSID<br />
<br />
to retrieve user name and SID from registry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">27th April 2009, 07:09</div></div><div class="posttext">I'm very much a newbie to NSIS. I have two questions regarding this plugin:-<br />
<br />
1 <br />
I can't get the examples to work I get an error:-<br />
<br />
&quot;WmiInspector::Request&quot;<br />
<br />
I am guessing that it is something to do with where I place the plugin files which I assume are WmiInspector.vcproj, WmiInspector.cpp and WmiInspector.sln? Can anyone advise?<br />
<br />
<br />
2 <br />
The WMI call I want to replicate in NSIS is contained in the following:-<br />
<br />
Set objWMISvc = GetObject( &quot;winmgmts:\\&quot; &amp; strComputerName &amp; &quot;\root\cimv2&quot; )<br />
Set colItems = objWMISvc.ExecQuery( &quot;Select * from Win32_ComputerSystem&quot;, , 48 )<br />
For Each objItem in colItems<br />
    strComputerDomain = objItem.Domain<br />
    If objItem.PartOfDomain Then<br />
        WScript.Echo &quot;Computer Domain: &quot; &amp; strComputerDomain<br />
    Else<br />
        WScript.Echo &quot;Workgroup: &quot; &amp; strComputerDomain<br />
    End If<br />
Next<br />
<br />
<br />
I am unsure how to go about this and would be grateful for some pointers.<br />
<br />
Charlie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th April 2009, 13:07</div></div><div class="posttext">Those files you mention are for the source code. You just need to put the DLL file in the NSIS\Plugins folder<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">27th April 2009, 13:41</div></div><div class="posttext">Thanks for the speedy response. I open the zip at http://nsis.sourceforge.net/WmiInspector_plug-in and the only files there are:-<br />
<br />
TestWmiInspector.exe<br />
TestWmiInspector..nsi<br />
WmiInspector.cpp<br />
WmiInspector.vcproj<br />
WmiInspector.sln<br />
<br />
No DLL. Same for the files attached to this message.<br />
<br />
Charlie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th April 2009, 14:10</div></div><div class="posttext">Looks like l0k1 forgot to put the actual plugin in the Zip!<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">27th April 2009, 15:05</div></div><div class="posttext">So I'm not going mad after all then :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">27th April 2009, 15:12</div></div><div class="posttext">Is there a way of tracking it down?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th April 2009, 15:51</div></div><div class="posttext">You will need to build the plugin yourself using Visual Studio. If you are using Windows XP or 2000 you can build with Visual Studio Express Editions C++ 2008 and the Windows Server 2003 PSDK.<br />
<br />
http://www.microsoft.com/Express/<br />
http://www.microsoft.com/downloads/details.aspx?FamilyID=0baf2b35-c656-4969-ace8-e4c0c0716adb&amp;displaylang=en<br />
<br />
I cannot build for you as I am running Windows Vista (I can only install the Windows Server 2008 PSDK).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">28th April 2009, 06:35</div></div><div class="posttext">Hmm uncharted territory for me but I'll give it a go. The blurb on http://www.microsoft.com/Express/ tells me I also need the Microsoft MSDN Express Library. Presumably that's correct. Could you give me pointers what I do when I have these all installed?<br />
<br />
Charlie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgiusto</div><div class="date">28th April 2009, 11:37</div></div><div class="posttext">Hello,<br />
the .zip file CONTAINS the .dll<br />
Please double check that you don't have it.<br />
Regards<br />
  Stefano</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">28th April 2009, 11:42</div></div><div class="posttext">Nope when I click on any of the zips I just get the five files listed:-<br />
<br />
TestWmiInspector.exe<br />
TestWmiInspector..nsi<br />
WmiInspector.cpp<br />
WmiInspector.vcproj<br />
WmiInspector.sln<br />
<br />
What URL are you using?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">28th April 2009, 11:44</div></div><div class="posttext">Hang on I have just cleared my cache and the second link on this thread does indeed now show the DLL Grrrrrrrrrrrrrrrrrrrr.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th April 2009, 11:57</div></div><div class="posttext">The file on the Wiki does not contain the dll.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">28th April 2009, 12:12</div></div><div class="posttext">That would fit with the cache problem I hit as it was the first one I opened.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">6th May 2009, 18:07</div></div><div class="posttext">I am trying to capture the domain or the computer using:-<br />
<br />
WmiInspector::Request &quot;CIMV2&quot; &quot;Win32_OperatingSystem&quot; &quot;Domain&quot;<br />
<br />
gives me an error whereas:-<br />
<br />
WmiInspector::Request &quot;CIMV2&quot; &quot;Win32_OperatingSystem&quot; &quot;Caption&quot;<br />
<br />
works fine yet both values are stings. Am I missing something here?<br />
<br />
Also how do I recover a boolean value - in particular the WMI value &quot;PartOfDomain&quot;<br />
<br />
Can anyone give me some pointers?<br />
<br />
Charlie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th May 2009, 21:36</div></div><div class="posttext">Domain and PartOfDomain are not in Win32_OperatingSystem; they are in Win32_ComputerSystem.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">southcot</div><div class="date">7th May 2009, 07:41</div></div><div class="posttext">Aha so often the answer to something that has bugged me for days proves to be frustatingly simple. Thanks for the help on all of this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lamprizzle</div><div class="date">28th September 2009, 20:01</div></div><div class="posttext">Hey l0k1, I noticed the plugin doesn't support any WMI calls that return an array of ints...<br />
<br />
WmiInspector::Request &quot;CIMV2&quot; &quot;Win32_SystemEnclosure&quot; &quot;ChassisTypes&quot;<br />
; see http://msdn.microsoft.com/en-us/library/aa394474(VS.85).aspx<br />
<br />
Internally, I need to handle the case where var.vt is VT_ARRAY|VT_I4, but I haven't figured that out yet.  Have you?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kriiC</div><div class="date">16th January 2010, 10:24</div></div><div class="posttext">how can i read all values (not just one) from request? How can i add loop to walk throw all values?<br />
---<br />
And there is problem with Unicode NSIS. i compiled with ANSI NSIS and its ok, Unicode NSIS gives me request return in chinese ot smth</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougcvc</div><div class="date">19th September 2010, 20:12</div></div><div class="posttext">Im not sure if its possible to read through all results using this plug in but i created a macro based on the wmic command that reads through all results.<br />
<br />
Download WMI.nsh attached to this post and see the following file as an example:<br />
<br />
<br />
<br />
Name WMI<br />
OutFile WMI.exe<br />
RequestExecutionLevel Admin<br />
OutFile &quot;fileread.exe&quot; <br />
<br />
!include WMI.nsh<br />
!include LogicLib.nsh<br />
Section &quot;&quot;<br />
<br />
${GetWMI} root\CIMV2 Win32_DiskDrive model callback_Function<br />
${GetWMI} root\CIMV2 Win32_NetworkAdapter name callback_Function<br />
${GetWMI} root\CIMV2 Win32_UserAccount name callback_Function<br />
SectionEnd<br />
<br />
Function callback_Function<br />
#$R0 = result number, $R1 = total results, $R2 = result name<br />
detailprint &quot;$R0/$R1=$R2&quot;<br />
FunctionEnd<br />
<br />
<br />
Usage ${GetWMI} namespace classes property callback_Function<br />
<br />
In the callback function results are $R0 = result number, $R1 = total results, $R2 = Result name.<br />
<br />
Theres a WMI code creator tool which is useful for finding out the namespaces, classes , and properties which can be downloaded here <br />
<br />
http://www.microsoft.com/downloads/en/details.aspx?FamilyID=2cc30a64-ea15-4661-8da4-55bbc145c30e&amp;displaylang=en</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2010, 18:14</div></div><div class="posttext">Please make a Wiki page. Also I would recommend wrapping your header in:<br />
<br />
!ifndef __WMI_Included__<br />
!define __WMI_Included__<br />
...<br />
!endif<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dougcvc</div><div class="date">28th September 2010, 19:27</div></div><div class="posttext">created a wiki page here (http://nsis.sourceforge.net/WMI_header).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>