<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Working Installation CompletionTime function (uses NSISdt), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Working Installation CompletionTime function (uses NSISdt) NSIS Discussion" />
	
	<title> Working Installation CompletionTime function (uses NSISdt) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Working Installation CompletionTime function (uses NSISdt)</div>
<hr />
<div class="pda"><a href="t-140427.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=140427">Working Installation CompletionTime function (uses NSISdt)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 19:13</div></div><div class="posttext">This is a new script to show the start and finish (completion) time for the installation process.<br />
I was wondering if somone could help test it for me, just to be sure that there's nothing naff!<br />
<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=11&amp;instances=0<br />
<br />
Also, could the old &quot;Report Installation Time at End&quot; script on the Archive be removed, or blocked out, because that one does not work correctly (sometimes outputs minus values!)<br />
<br />
Thanks<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th June 2003, 19:27</div></div><div class="posttext">Is better use System.dll, because have an old bug in it (it adds +1 hour when is winter here - Brazil).<br />
<br />
It works, but is not better to give user the chance to customize the result string, using more pops to pop the hour, minute and second?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 19:37</div></div><div class="posttext">Originally posted by deguix <br />
Is better use System.dll, because have an old bug in it (it adds +1 hour when is winter here - Brazil).<br />
<br />
It works, but is not better to give user the chance to customize the result string, using more pops to pop the hour, minute and second?   <br />
<br />
Yes that's a good idea! Will get onto that now.<br />
About the 1 hour thing...<br />
I was getting that too!<br />
Is that my script or NSISdt?<br />
<br />
Edit:<br />
Added extra &quot;output mode&quot;<br />
So, how would I get the 3 times (hours,mins,secs) using System, just like I have done with NSISdt (if that fixes the hour problem?)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th June 2003, 19:46</div></div><div class="posttext">NSISdt! Use this code to get all you need to use with System Plugin:<br />
<br />
  System::Call '*(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) i .r1'<br />
  System::Call 'kernel32::GetLocalTime(i) i(r1)'<br />
  System::Call '*$1(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2)(.r6, .r5, .r4,, .r3, .r2, .r1,)'<br />
<br />
;$1 = seconds<br />
;$2 = minutes<br />
;$3 = hours<br />
;$4 = day<br />
;$5 = month<br />
;$6 = year<br />
<br />
(Based on &quot;Get Local Time&quot; function, see my signature)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 19:49</div></div><div class="posttext">Thanks!<br />
Is there a way to chop it down to just 3 variables (hours,mins,secs)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th June 2003, 19:56</div></div><div class="posttext">More one: the function have to calculate the days, months and years too, i.e. when I start the installation at 11:59 PM and end at 12:00 AM, will show negative numbers. So you have to remove the week day and miliseconds. I edited my previous post to it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 20:05</div></div><div class="posttext">This will make things a lot harder.<br />
I think I know how to fix it though...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 20:13</div></div><div class="posttext">Try now: http://nsis.sourceforge.net/archive/nsisweb.php?page=339&amp;instances=0,11<br />
Notice the new Push.<br />
<br />
I've added a few lines in to notice the change in hours/mins/secs etc.<br />
I cannot test it right now (on a PC without NSIS)<br />
<br />
I have a feeling there's something else that needs changing...<br />
<br />
Also, I'm stall using NSISdt until I can use System to get just hours (in 24 hour format), mins and seconds.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th June 2003, 20:19</div></div><div class="posttext">To remove temporary the days, months and years remove .r4, .r5 and .r6 to don't use the variables $4, $5 and $6 (and preserve commas)! The hours using the code above are in 24h format too.<br />
<br />
Have something wrong now with your function, are giving &quot;24 hours, 60 mins, 60 secs&quot;. And is better to use the first version, not use anymore that additional push, because I forgot that can use &quot;StrCpy&quot; to customize the strings...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 20:40</div></div><div class="posttext">Ok.<br />
I will attempt to repair the function any minute now (when the other pc is free!)<br />
Is it possible to get the day of the year usung System too?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 20:48</div></div><div class="posttext">Ok.<br />
System::Call '*(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) i .r1' <br />
System::Call 'kernel32::GetLocalTime(i) i(r1)' <br />
System::Call '*$1(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) (, .r1, .r2, .r3,,,,,)'<br />
detailprint &quot;&gt;&gt;$3:$2:$1&quot;<br />
Output is: &quot;&gt;&gt;28:6:6&quot;<br />
<br />
What's wrong?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th June 2003, 20:49</div></div><div class="posttext">Not. Have only to use milisecond, second, minute, hour, day, day of week (in number), month, year. But can make a function for it!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 20:50</div></div><div class="posttext">I don't understand :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th June 2003, 21:12</div></div><div class="posttext">I said no, and the only things that you can use with GetLocalTime API are: milisecond, second, minute, hour, day, day of week (in number), month and year. But you can make a function that does it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 21:15</div></div><div class="posttext">Originally posted by deguix <br />
I said no, and the only things that you can use with GetLocalTime are: milisecond, second, minute, hour, day, day of week (in number), month, year. But you can make a function that does it. <br />
<br />
Oh, I see!<br />
So, whats up with the strange output I am getting?<br />
<br />
With System I get 6 seconds, 6 minutes, and 28 hours for the current time!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th June 2003, 21:25</div></div><div class="posttext">Wow, I'm blind, I do not saw that post. This is the right one code:<br />
<br />
  System::Call '*(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2) i .r1'<br />
  System::Call 'kernel32::GetLocalTime(i) i(r1)'<br />
  System::Call '*$1(&amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2, &amp;i2)(,,,, .r3, .r2, .r1,)'<br />
<br />
(I only inverted the position)<br />
<br />
I fixed the code above, now is the RIGHT one! Tested and retested...:up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th June 2003, 22:43</div></div><div class="posttext">Works great now!<br />
I ended up removing the option to only display seconds or minutes and seconds.<br />
The reason is because;<br />
if the installation took 1 min, 1 sec, then the completion time would be &quot;1 sec.&quot;!<br />
<br />
I could repair this, but it starts to get messy...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">29th June 2003, 00:30</div></div><div class="posttext">I read this thread quickly, but doesn't this (http://nsis.sourceforge.net/archive/nsisweb.php?page=109&amp;instances=0,11) do the completion time?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2003, 09:19</div></div><div class="posttext">Ok, I will check this out a bit more.<br />
When I tested, I was getting negative results.<br />
<br />
Now, however, it seems to be working...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2003, 09:28</div></div><div class="posttext">I'll remove mine, because your's is better!<br />
Would you like me to transfer your's to my function, with added functionality like &quot;Output Options&quot; where it simply displays Hours, Mins, or Seconds (3|2|1).<br />
<br />
I will write the value ($R9) to the temp file and read it at the end so that $R9 does not get messed around with during the installation (like had happened to me)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2003, 09:48</div></div><div class="posttext">This new function is good - it only uses 3 variables!<br />
Here's what I ended up with...<br />
<br />
Usage 1:<br />
# place this at the start of the first section<br />
Push start ;signifies to start counting.<br />
Push 0 ;output mode (for finish only)<br />
 Call CompletionTime<br />
Pop $0 ;output (0 at start)<br />
<br />
Usage 2:<br />
# place this at the end of the last section<br />
Push finish ;signifies to finish &amp; output completion time<br />
Push 1 ;output mode (1=secs|2=mins|3=hours)<br />
 Call CompletionTime<br />
Pop $0 ;output (depends on output mode)<br />
<br />
The Function:<br />
Function CompletionTime<br />
# // Original script by n0On3.<br />
# \\ Added Output Options, and Function style by Afrow UK.<br />
Exch $R0 ;output mode<br />
Exch<br />
Exch $R1 ;start|finish<br />
Push $R2<br />
<br />
     WriteINIStr &quot;$TEMP\completion_time.tmp&quot; &quot;Mode&quot; &quot;Value&quot; &quot;$R0&quot;<br />
<br />
  StrCpy $R2 0<br />
<br />
StrCmp $R1 start 0 finish<br />
  SetDetailsPrint &quot;none&quot;<br />
   GetTempFileName $R0<br />
    GetFileTime $R0 $R1 $R2<br />
     Delete $R0<br />
<br />
     WriteINIStr &quot;$TEMP\completion_time.tmp&quot; &quot;Time&quot; &quot;Value&quot; &quot;$R2&quot;<br />
<br />
  SetDetailsPrint &quot;both&quot;<br />
Goto exit<br />
<br />
finish:<br />
  SetDetailsPrint &quot;none&quot;<br />
   GetTempFileName $R0<br />
    GetFileTime $R0 $R1 $R2<br />
     Delete $R0<br />
<br />
     ReadINIStr $R0 &quot;$TEMP\completion_time.tmp&quot; &quot;Time&quot; &quot;Value&quot;<br />
<br />
  IntOp $R2 $R2 - $R0<br />
  IntOp $R2 $R2 / 10000000<br />
<br />
     ReadINIStr $R0 &quot;$TEMP\completion_time.tmp&quot; &quot;Mode&quot; &quot;Value&quot;<br />
<br />
      StrCmp $R0 1 +6 ;time in secs<br />
      StrCmp $R0 2 0 +3<br />
       IntOp $R2 $R2 / 60 ;time in mins<br />
       Goto +3<br />
      StrCmp $R0 3 0 +2<br />
       IntOp $R2 $R2 / 60 ;time in mins<br />
<br />
     Delete &quot;$TEMP\completion_time.tmp&quot;<br />
  SetDetailsPrint &quot;both&quot;<br />
<br />
exit:<br />
  StrCpy $R0 $R2<br />
<br />
Pop $R2<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2003, 13:28</div></div><div class="posttext">Just found a small problem, fixed it.<br />
Would you put this with your script or shall I put it over mine (on archive)?<br />
The Function:<br />
Function CompletionTime<br />
# // Original script by n0On3.<br />
# \\ Added Output Options, and Function style by Afrow UK.<br />
Exch $R0 ;output mode<br />
Exch<br />
Exch $R1 ;start|finish<br />
Push $R2<br />
<br />
     WriteINIStr &quot;$TEMP\completion_time.tmp&quot; &quot;Mode&quot; &quot;Value&quot; &quot;$R0&quot;<br />
<br />
  StrCpy $R2 0<br />
<br />
StrCmp $R1 start 0 finish<br />
  SetDetailsPrint &quot;none&quot;<br />
   GetTempFileName $R0<br />
    GetFileTime $R0 $R1 $R2<br />
     Delete $R0<br />
<br />
     WriteINIStr &quot;$TEMP\completion_time.tmp&quot; &quot;Time&quot; &quot;Value&quot; &quot;$R2&quot;<br />
<br />
  SetDetailsPrint &quot;both&quot;<br />
Goto exit<br />
<br />
finish:<br />
  SetDetailsPrint &quot;none&quot;<br />
   GetTempFileName $R0<br />
    GetFileTime $R0 $R1 $R2<br />
     Delete $R0<br />
<br />
     ReadINIStr $R0 &quot;$TEMP\completion_time.tmp&quot; &quot;Time&quot; &quot;Value&quot;<br />
<br />
  IntOp $R2 $R2 - $R0<br />
  IntOp $R2 $R2 / 10000000<br />
<br />
     ReadINIStr $R0 &quot;$TEMP\completion_time.tmp&quot; &quot;Mode&quot; &quot;Value&quot;<br />
<br />
      StrCmp $R0 1 +6 ;time in secs<br />
      StrCmp $R0 2 0 +3<br />
       IntOp $R2 $R2 / 60 ;time in mins<br />
       Goto +4<br />
      StrCmp $R0 3 0 +3<br />
       IntOp $R2 $R2 / 60 ;time in mins<br />
       IntOp $R2 $R2 / 60 ;time in hours<br />
<br />
     Delete &quot;$TEMP\completion_time.tmp&quot;<br />
  SetDetailsPrint &quot;both&quot;<br />
<br />
exit:<br />
  StrCpy $R0 $R2<br />
<br />
Pop $R2<br />
Pop $R1<br />
Exch $R0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2003, 14:24</div></div><div class="posttext">Ok, the &quot;Report Installation Time At The End&quot; script only works on installation processes that take less than 60 seconds.<br />
My process (map compile) took around 3345 seconds, and the script (above) reported the installation time as -87 seconds!<br />
<br />
I will keep my script, and add extra functionality for use in long processes.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2003, 20:36</div></div><div class="posttext">I think the final release is out now...<br />
I re-wrote the script, to make it tidier (and it is too!)<br />
<br />
The Output Options is back too, and works perfectly.<br />
The script still only works up to 24 hours (or before the next day)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">30th June 2003, 02:14</div></div><div class="posttext">mmmm... I'll try to make it work for more than 60 seconds...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st July 2003, 14:49</div></div><div class="posttext">Originally posted by n0On3 <br />
mmmm... I'll try to make it work for more than 60 seconds...  <br />
<br />
I think it's 60 seconds...<br />
Just put Sleep 61000 to see what happens.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>