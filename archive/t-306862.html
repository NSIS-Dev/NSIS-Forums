<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSISdl and Antivirus delay, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSISdl and Antivirus delay NSIS Discussion" />
	
	<title> NSISdl and Antivirus delay [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSISdl and Antivirus delay</div>
<hr />
<div class="pda"><a href="t-306862.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306862">NSISdl and Antivirus delay</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Chestnut</div><div class="date">29th May 2009, 13:10</div></div><div class="posttext">Hi<br />
<br />
I'm using a simple method to download a rar file and extract it using NSISdl and nsExec::ExecToLog. Worked great so far but I found a situation where it seems the antivirus installed on the target machine is locking the file a bit too long and thus, the installer doesn't find it where it should be.<br />
<br />
Some lines<br />
<br />
NSISdl::download 'http://www.xxx.com/file.rar' 'C:\install\file.rar'<br />
...<br />
...<br />
nsExec::ExecToLog '&quot;C:\install\unrar.exe&quot; x -y &quot;C:\install\file.rar&quot; &quot;C:\install&quot;'<br />
<br />
When looking in the folder, the file is not there so the unrar attempt fails. But the file was downloaded, the installer is doing his thing and showing the progression of the download.<br />
<br />
What told me that the antivirus might be the critter is when I ask the client to manually download the rar file (90Mb) and save it in the destination folder (so that the installer wouldn't need to download it). We noticed that the antivirus took a 10 seconds or so after the download before putting the file in the folder.<br />
<br />
This has happened only on a few setups and the antivirus was NOD32 in this case. No message or anything from it. My installer downloads 2 different files sometimes and the second file did not have a problem but it is much smaller so maybe the AV took no time to scan it and put it in the destination folder.<br />
<br />
Not much to add I'm afraid and didn't find much of a workaround and since it only happened once for 1 client, I can live with the trouble for now but if someone had the same issue and found a solution, I'm open to suggestions.<br />
<br />
;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th May 2009, 17:04</div></div><div class="posttext">You just need a For loop to loop 10-20 times with a Sleep 1000 and if the file is found, break out of the loop. After the loop if the file is not found then something must be wrong (show an error or something).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">29th May 2009, 17:15</div></div><div class="posttext">You can use a loop with IfFileExists.<br />
Like:NSISdl::download 'http://www.xxx.com/file.rar' 'C:\install\file.rar'<br />
...<br />
...<br />
loop:<br />
(Maybe set a limit and/or delay here)<br />
IfFileExists &quot;C:\install\file.rar&quot; install loop <br />
install:<br />
nsExec::ExecToLog '&quot;C:\install\unrar.exe&quot; x -y &quot;C:\install\file.rar&quot; &quot;C:\install&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chestnut</div><div class="date">29th May 2009, 17:21</div></div><div class="posttext">Yes and thanks to both of you, just fiddling now to find the right syntax as to set the limit so that it doesn't infinite loop.<br />
<br />
But until then, this is the temporary lines I came up with (until the occasion presents itself with the client the problem occurs).<br />
<br />
<br />
  loop:<br />
    sleep 500<br />
    IFFileExists &quot;C:\install\file.rar&quot; +2 +1<br />
      goto loop<br />
  nsExec::ExecToLog ...etc...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th May 2009, 17:24</div></div><div class="posttext">Much cleaner:<br />
<br />
${For} $R0 1 20<br />
  ${If} ${FileExists} `C:\install\file.rar`<br />
    ${Break}<br />
  ${EndIf}<br />
  Sleep 1000<br />
${Next}<br />
${Unless} ${FileExists} `C:\install\file.rar`<br />
  MessageBox MB_OK `Error!`<br />
  Abort<br />
${EndUnless}<br />
<br />
It may take more lines of code, but at the end of the day, we read old code more than we write code.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>