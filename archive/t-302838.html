<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support? NSIS Discussion" />
	
	<title> nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support?</div>
<hr />
<div class="pda"><a href="t-302838.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302838">nsDialogs, NSD_CreateBitmap, NSD_SetImage - JPEG support?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th February 2009, 10:34</div></div><div class="posttext">Okay, I just ran into a bit of a stumbling block upgrading to the latest-and-greatest NSIS; using InstallOptionsEx has a drop-in no longer works when using MUI.  I can work around it by using an older MUI header file, but I realize that eventually I'll have to move even this mammoth script over to nsDialogs.<br />
<br />
However, that presents the next stumbling block.. I tried setting a JPG as a bitmap's image in the past and just again now and... I don't get any image.  If I specify a BMP, things are fine.<br />
What am I missing?  Is there any way - no matter how contrived - to use a JPG directly for an nsDialogs bitmap control?<br />
<br />
We're using JPEG files not just within the installer to cut down on size, but also for downloaded content.<br />
<br />
I did think this was covered in the forums before, but I couldn't find anything among the noise in a search for the two rather common keywords.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2009, 14:17</div></div><div class="posttext">You could probably replace the LoadImage call in nsDialogs.nsh with a call to OleLoadPicturePath and then get the image handle from the interface this function returns.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th February 2009, 15:28</div></div><div class="posttext">hehe.. well the &quot;you&quot; part in there is putting a lot of (misplaced) confidence in me - but I'll have a peek through MSDN and the System docs :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">6th February 2009, 16:18</div></div><div class="posttext">This may help http://nsis.sourceforge.net/Embedded_Banner<br />
You can also search for jpeg on NSIS main page http://nsis.sourceforge.net/Main_Page</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th February 2009, 16:51</div></div><div class="posttext">yeah, unfortunately the various banner/etc. plugins all have their sets of limitations.. e.g.<br />
- not within a dialog<br />
- fixed place within a dialog<br />
- not clickable<br />
<br />
All I really need is basically what kichik wrote... which I *think* I can figure out... except I'm stuck (at least) at...<br />
riid (in parameter) Reference to the identifier of the interface describing the type of interface pointer to return in ppvRet.<br />
...which I mostly see as using 'IID_IPicture' in examples - but where on earth that particular ID is coming from.. *puzzles*</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th February 2009, 17:09</div></div><div class="posttext">IID_IPicture is a guid, {7BF80980-BF32-101A-8BBB-00AA00300CAB} i think, so:<br />
<br />
g &quot;{7BF80980-BF32-101A-8BBB-00AA00300CAB}&quot;, and the pointer to the COM object param should look something like: *i .r0<br />
<br />
Remember when working with COM objects, you need to figure out the correct offset in the vtable when calling methods on COM objects</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th February 2009, 17:21</div></div><div class="posttext">see http://source.winehq.org/source/include/stdole2.idl#L303 ...and remember, 0,1 and 2 are IUnknown, so the first method in IPicture is 3 (The system.dll readme has example code for calling COM objects)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th February 2009, 19:06</div></div><div class="posttext">whhooooo... blimey.  Nope, in way over my head - will give it another stab after the weekend :)<br />
( getting an error 128 from the output of the 'e' option... of course finding the user-friendly message for code 128 is another circle of hell altogether )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th February 2009, 19:22</div></div><div class="posttext">128=ERROR_WAIT_NO_CHILDREN and that makes no sense, maybe you should post some of your code</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2009, 19:26</div></div><div class="posttext">You can use err.exe (http://kernelmustard.com/2007/10/09/the-return-of-errexe/) to get information on pretty much every error code in Windows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th February 2009, 19:37</div></div><div class="posttext">Originally posted by kichik <br />
You can use err.exe (http://kernelmustard.com/2007/10/09/the-return-of-errexe/) to get information on pretty much every error code in Windows.  <br />
<br />
except its 404</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th February 2009, 19:43</div></div><div class="posttext">got off the vpn, but if I recall correctly - and yes, I know it's utterly wrong... even if I'm remembering and piecing this together right...<br />
<br />
<br />
System::Call 'oleaut32::OleLoadPicturePath(&quot;path to bmp file&quot;, , , ,g &quot;long guid thing&quot;, *i .r0) i.r1 ? e'<br />
<br />
<br />
which I think means...<br />
using the System plugin's Call routine,<br />
make a call to from oleaut32.dll's OleLoadPicturePath procedure<br />
with the arguments...<br />
- path or URL to the file<br />
- null<br />
- null<br />
- null<br />
- the guid<br />
- create a new 'pointer' which will hold the result, stick the pointer in $0<br />
- stick the result of the call itself in $1<br />
- get any error message, stick that on the stack<br />
<br />
====<br />
<br />
As for that err.exe thing - sounds useful, so I googled...<br />
http://www.microsoft.com/downloads/details.aspx?familyid=be596899-7bb8-4208-b7fc-09e02a13696c&amp;displaylang=en<br />
<br />
( says Exchange but a MSDN blog noted that it'll do the Win32 errors as well )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th February 2009, 19:52</div></div><div class="posttext">you need the types for every param, t for text (or w for wide strings) and i for DWORD/pointers</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th February 2009, 08:41</div></div><div class="posttext">cool, thanks - I'll review and try again monday :)<br />
I guess that means I have to explicitly use 'n' for null (instead of just leaving the parameter blank) as well</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">7th February 2009, 14:21</div></div><div class="posttext">no, you can do &quot;i,i,i&quot; without specifying the actual value, or &quot;i0,i0,i0&quot; to show intent</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th February 2009, 15:01</div></div><div class="posttext">alright, just poking at this offline a bit more...<br />
<br />
I *think* I've got the picture interface bit working, then...<br />
<br />
System::Call 'oleaut32::OleLoadPicturePath(w &quot;&lt;path&gt;&quot;, i 0, i 0, i 0, g &quot;{7BF80980-BF32-101A-8BBB-00AA00300CAB}&quot;, *i .r0) i .r1 ? e'<br />
<br />
It returns a pointer/reference/thing to the interface, the result is zero (which I think  means 'ok') and no error code is returned (well, also zero).<br />
<br />
So now would come the time to get some data out of that interface.  Instead of jumping straight into the deep that is the image handle, I figured I'd get the width of the bitmap first.<br />
<br />
However, I then of course get stuck again :)<br />
<br />
System::Call '$0-&gt;6(i .r0) i .r1 ? e'<br />
<br />
6 = getWidth, as far as the VTable is concerned;<br />
http://msdn.microsoft.com/en-us/library/ms680761(VS.85).aspx<br />
At first I thought I was supposed to just call it as '-&gt;6()' and thus have the result in $1 .  That crashes, though.  However, specifying an out variable (i.r3) as a parameter doesn't do much either;<br />
<br />
System::Call '$0-&gt;6(i .r3) i .r1 ? e' ; 6 = getWidth<br />
Pop $2<br />
; [$3][$1][$2] = [0][-2147467261][80]<br />
<br />
Of course, that error code ($2 - 80) doesn't make sense.. again.  But I might be reading err.exe's output wrong.<br />
<br />
Anyway, I tried ::Get as well, but that got me an error DMLERRsomethingorother ..<br />
<br />
I'll poke at it some more later -_-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">7th February 2009, 15:09</div></div><div class="posttext">the argument is a pointer to a OLE_XSIZE_HIMETRIC (whatever that is, lets hope its 4 bytes) so:<br />
<br />
System::Call '$0-&gt;6(*i.r3)i.r1'<br />
<br />
also, you can't use ?e with COM, you must check the return value, 0 = ok (in most cases, could be 1 (S_FALSE) also, negative numbers are errors, when you see them in the output from err.exe, they are the codes starting with S_ or E_ )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">7th February 2009, 15:26</div></div><div class="posttext">Function pre<br />
nsDialogs::Create 1018<br />
Pop $0<br />
${NSD_CreateBitmap} 0 0 100% 100% &quot;&quot;<br />
pop $9<br />
<br />
!define IID_IPicture {7BF80980-BF32-101A-8BBB-00AA00300CAB}<br />
!define ImagePath &quot;$PICTURES\BuddyJesus.jpg&quot;<br />
var /GLOBAL pIPicture1 ;lets save it in a var so some other code does not overwrite it (I'm assuming you have a complicated page with lots of code)<br />
System::Call 'oleaut32::OleLoadPicturePath(w &quot;${ImagePath}&quot;, i 0, i 0, i 0, g &quot;${IID_IPicture}&quot;, *i .r0)i.r1'<br />
${If} $1 == 0<br />
	StrCpy $pIPicture1 $0 ;save pointer for later, we can't release it now because the image handle needs to stay valid<br />
	System::Call &quot;$0-&gt;3(*i.r0)i.r1&quot; ;IPicture-&gt;get_Handle<br />
	;might want to check $1 here before setting image<br />
	SendMessage $9 ${STM_SETIMAGE} ${IMAGE_BITMAP} $0<br />
${EndIf}<br />
<br />
nsDialogs::Show<br />
${IfThen} $pIPicture1 &lt;&gt; 0 ${|} System::Call &quot;$pIPicture1-&gt;2()&quot;  ${|} ;Release<br />
<br />
FunctionEnd<br />
<br />
page custom pre<br />
<br />
<br />
if you need to resize the actual image control to fit the image, you need to call width and height and convert from himetric to pixels, I'm sure google can help out</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">8th February 2009, 11:49</div></div><div class="posttext">Thanks!<br />
<br />
Nope - don't think I would've gotten that far on monday - maybe on wednesday.  I did get to the 'oh, dur, it's not a number' point *pats self on back*. I'll be going through your changes and try to grok it.. gotta get a handle on the belly of this (powerful) beast.<br />
<br />
Thanks again!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">9th February 2009, 10:57</div></div><div class="posttext">Alright - spent some time sunday to turn it into a header file, it's in the wiki (along with a new nsDialogs category), stuck it in the production script and voila... works beautifully - thanks again!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th February 2009, 20:36</div></div><div class="posttext">Thanks for creating the nsDialogs category. It was really long due. All those other examples are really useful too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">14th February 2009, 00:45</div></div><div class="posttext">Originally posted by kichik <br />
Thanks for creating the nsDialogs category. It was really long due. All those other examples are really useful too. <br />
<br />
No problem - we've been using NSIS for our installer for several years now and I like to contribute back wherever I can.<br />
<br />
I just added a new page with some more minor snippets and created a some topics for a few other bits, that I hope will be helpful to other (budding) nsDialogs users;<br />
http://nsis.sourceforge.net/NsDialogs_FAQ<br />
<br />
I don't know for sure these are FAQ items per se, but they were things that I ran into or simply wondered about while moving over to nsDialogs.<br />
<br />
Have to move on to some file-finding bits and pieces now, though, but part of that will involve nsDialogs again - will post the result of that as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zirnevis</div><div class="date">11th July 2010, 07:56</div></div><div class="posttext">got off the vpn, but if I recall correctly - and yes, I know it's utterly wrong... even if I'm remembering and piecing this together right...<br />
<br />
<br />
System::Call 'oleaut32::OleLoadPicturePath(&quot;path to bmp file&quot;, , , ,g &quot;long guid thing&quot;, *i .r0) i.r1 ? e'<br />
<br />
<br />
which I think means...<br />
using the System plugin's Call routine,<br />
make a call to from oleaut32.dll's OleLoadPicturePath procedure<br />
with the arguments...<br />
- path or URL to the file<br />
- null<br />
- null<br />
- null<br />
- the guid<br />
- create a new 'pointer' which will hold the result, stick the pointer in $0<br />
- stick the result of the call itself in $1<br />
- get any error message, stick that on the stack<br />
<br />
====<br />
<br />
<br />
<br />
<br />
Thanks a lot for the nice piece of code, it helped me a lot<br />
<br />
however I was wondering how do I add border to the image?<br />
<br />
Regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th July 2010, 12:42</div></div><div class="posttext">however I was wondering how do I add border to the image?<br />
Using an image editor such as Paint?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th July 2010, 16:23</div></div><div class="posttext">You could also just add SS_BLACKFRAME, SS_WHITEFRAME or SS_GRAYFRAME to the style.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">11th July 2010, 18:06</div></div><div class="posttext">You could also just add SS_BLACKFRAME, SS_WHITEFRAME or SS_GRAYFRAME to the style.<br />
<br />
No, I think these will replace the content of the static/ control with a simple (filled) rectangle.<br />
<br />
You should rather add the WS_BORDER style</div></div><hr />


<div class="post"><div class="posttop"><div class="username">baby123</div><div class="date">6th January 2013, 14:26</div></div><div class="posttext">Here is the solution published special for this THREAD.<br />
<br />
http://nsis.sourceforge.net/NsDialogs_SetImageOLE</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>