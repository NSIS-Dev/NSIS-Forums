<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" FCT and closing application, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  FCT and closing application NSIS Discussion" />
	
	<title> FCT and closing application [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  FCT and closing application</div>
<hr />
<div class="pda"><a href="t-272756.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=272756">FCT and closing application</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">GenRabbit</div><div class="date">13th June 2007, 10:22</div></div><div class="posttext">I have tested this cript, it a modified script of the one coming with FCT;<br />
<br />
!define APP_NAME fct<br />
!define WND_CLASS &quot;Outlook Express Browser Class&quot;<br />
!define CLASS_PART &quot;Browser Class&quot;<br />
!define WND_TITLE &quot;Dice100lient&quot;<br />
!define TITLE_PART &quot;Express&quot;<br />
!define termMsg &quot;Installer cannot stop running ${WND_TITLE}.$\nClick YES to terminate application.&quot;<br />
<br />
!include WinMessages.nsh<br />
<br />
Name &quot;${APP_NAME}&quot;<br />
OutFile &quot;${APP_NAME}.exe&quot;<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
  <br />
<br />
; sync termination<br />
#    fct::fct /WC '#32770' /UDATA 0x4d475200<br />
    fct::fct /WT '${WND_TITLE}' /TIMEOUT 2000 /QUESTION '${termMsg}'<br />
<br />
    Pop $0<br />
    MessageBox MB_OK &quot;Still Alive Count = $0&quot;<br />
<br />
SectionEnd<br />
<br />
My problem here is that it seems like it never finds my application.<br />
Ive written a visual basic program with autoupdate. The update is patch is nsis made. The problem with it is that the installer script is finished running before the APP has managed to shutdown.<br />
<br />
So is there a easy way to make FCT or something identical check if an app is still running and if so wait for it to stop?<br />
<br />
What this WND_Class and CLASS_Part is I have no idea, all I know is where the app is running from and that is named Dice100Client.exe<br />
<br />
The Count returns 0 as its running.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2007, 14:06</div></div><div class="posttext">You sure &quot;Dice100lient&quot; is correct?<br />
It has to be identical to the actual window title (or use /WTP to specify just part of the title).<br />
<br />
The class name is a unique name for windows, which should be used over window titles in case the title differs over different languages.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th June 2007, 14:07</div></div><div class="posttext">You sure &quot;Dice100lient&quot; is correct?<br />
It has to be identical to the actual window title (or use /WTP to specify just part of the title).<br />
<br />
The class name is a unique name for windows, which should be used over window titles in case the title differs over different languages.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GenRabbit</div><div class="date">13th June 2007, 22:41</div></div><div class="posttext">Thanks Stu, you spotted what I couldn't see. A C was all the difference infront of lient. Now it workes.<br />
But is it possible with FCT to detect if a program is running and then just wait until it terminates?<br />
Because the VB program exits when it has downloaded the update and executed it.<br />
<br />
It should not throw up any messagebox, just wait until it exits, then continue.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">14th June 2007, 05:17</div></div><div class="posttext">The wiki has a function FindProcess (http://nsis.sourceforge.net/FindProcess) you can use in a loop: ${Do}<br />
  ${FindProcess} &quot;Dice100Update.exe&quot; $0<br />
  Sleep 200<br />
${Loop} ${While} $0 &lt;&gt; 0Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GenRabbit</div><div class="date">14th June 2007, 22:10</div></div><div class="posttext">Many Thanks for the tip Demiller9. Its just what I'm looking for. Added it to my script. But now I get a new problem that puzzles me.<br />
<br />
Invalid command: ${WordFind}<br />
!include: error in script: &quot;C:\Program Files (x86)\NSIS\Include\FindProcess.nsh&quot; on line 58<br />
Error in script &quot;E:\Project Dice100\InstallMaker\Dice100Updaterscript.nsi&quot; on line 9 -- aborting creation process<br />
<br />
Why is it stopping at ${WordFind}. The script is copied straight from the Wiki and these are in the script;<br />
<br />
 !include LogicLib.nsh<br />
 !include WordFunc.nsh<br />
<br />
Here is the offending line;<br />
<br />
  ${WordFind} '$2' ',' 'E/$1' $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th June 2007, 22:33</div></div><div class="posttext">You're missing !insertmacro WordFind after !include.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GenRabbit</div><div class="date">14th June 2007, 23:41</div></div><div class="posttext">Thanks. Added it and gort this error message;<br />
<br />
Error: can't change compressor after data already got compressed or header already changed!<br />
Error in script &quot;E:\Project Dice100\InstallMaker\Dice100Updaterscript.nsi&quot; on line 29 -- aborting creation process<br />
<br />
line 01 to 29 in my install script<br />
<br />
############################################################################################<br />
#      NSIS Installation Script created by NSIS Quick Setup Script Generator v1.09.18<br />
#               Entirely Edited with NullSoft Scriptable Installation System                <br />
#              by Vlasis K. Barkas aka Red Wine red_wine@freemail.gr Sep 2006               <br />
############################################################################################<br />
!include Library.nsh<br />
!include &quot;WordFunc.nsh&quot;<br />
!insertmacro WordFind<br />
!include LogicLib.nsh<br />
!include &quot;FindProcess.nsh&quot;<br />
!define APP_NAME &quot;Dice100&quot;<br />
!define COMP_NAME &quot;TwistedMind&quot;<br />
!define VERSION &quot;1.1.0.17&quot;<br />
!define COPYRIGHT &quot;GenRabbit&quot;<br />
!define DESCRIPTION &quot;Application&quot;<br />
!define INSTALLER_NAME &quot;E:\Project Dice100\InstallMaker\Dice100Update_101017.exe&quot;<br />
!define MAIN_APP_EXE &quot;Dice100Client.exe&quot;<br />
!define INSTALL_TYPE &quot;SetShellVarContext current&quot;<br />
######################################################################<br />
<br />
VIProductVersion  &quot;${VERSION}&quot;<br />
VIAddVersionKey &quot;ProductName&quot;  &quot;${APP_NAME}&quot;<br />
VIAddVersionKey &quot;CompanyName&quot;  &quot;${COMP_NAME}&quot;<br />
VIAddVersionKey &quot;LegalCopyright&quot;  &quot;${COPYRIGHT}&quot;<br />
VIAddVersionKey &quot;FileDescription&quot;  &quot;${DESCRIPTION}&quot;<br />
VIAddVersionKey &quot;FileVersion&quot;  &quot;${VERSION}&quot;<br />
<br />
######################################################################<br />
SetCompressor ZLIB<br />
<br />
Strange, I can't find &quot;SetCompressor&quot; anywhere else..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">15th June 2007, 01:05</div></div><div class="posttext">Error: can't change compressor after data already got compressed or header already changed!That is because the 'include &quot;FindProcess.nsh&quot;' was ahead of the 'SetCompressor' statement. There are two functions in the FindProcess file, and they might have been buffered for the default compressor already. Move the include down after you do the SetCompressor ZLIB (or move the SetCompressor up) and it should clear the error.<br />
<br />
I'll update the wiki page to show the !insertMacro WordFind, too. I created that page late last night from a larger script that used that function and forgot to include that 'insertmacro'.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GenRabbit</div><div class="date">15th June 2007, 01:59</div></div><div class="posttext">Thanks again, moved the Setcompressor in the start, and voila, no more a problem. Then added;<br />
<br />
${Do}<br />
  ${FindProcess} &quot;Dice100Update.exe&quot; $0<br />
  Sleep 200<br />
${Loop} ${While} $0 &lt;&gt; 0<br />
<br />
This would not compile.<br />
<br />
Changed it to<br />
<br />
${Do}<br />
  ${FindProcess} &quot;$PROGRAMPATH\Dice100Client.exe&quot; $0<br />
  Sleep 200<br />
${LoopUntil} $0 &lt;&gt; 0<br />
<br />
and it runs in infinite loop. I can't get out of without using alt+ctrl+del.<br />
<br />
Also tried with just Dice100Client.exe as process. But runs in infinite loops either if Dice100Client.exe runs or not.<br />
<br />
Any idea why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">15th June 2007, 06:23</div></div><div class="posttext">But runs in infinite loops either if Dice100Client.exe runs or not.<br />
Any idea why? Yes. I should have tested it better. My application needed to wait for two processes, and the function I posted expected to find a comma in the list. I fixed it (in the wiki too) by changing the 'StrCpy $2 $0' at line 30 to add a comma: StrCpy $2 &quot;$0,&quot; <br />
<br />
Also, the loop should read  ${Do}<br />
    ${FindProcess} &quot;Dice100Client.exe&quot; $0<br />
    Sleep 200<br />
  ${LoopWhile} $0 &lt;&gt; 0Don't include the path, and the loop repeats while $0 is true, so it should be LoopWhile.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">GenRabbit</div><div class="date">15th June 2007, 10:29</div></div><div class="posttext">Thank you all. Now it works great.<br />
Excellent script Demillier9, any chance in future it will include the chance to check if the appname runs from a certain location too?<br />
<br />
Anyway now the script seems to run like it supposed too.  Thanks again all.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>