<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" File /oname usage, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  File /oname usage NSIS Discussion" />
	
	<title> File /oname usage [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  File /oname usage</div>
<hr />
<div class="pda"><a href="t-165009.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=165009">File /oname usage</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mdm</div><div class="date">15th January 2004, 19:27</div></div><div class="posttext">I am having trouble using File to write one file to $SYSDIR. When I hard code a file name, no problem; the errors occur when I use variables. <br />
<br />
A usage that I found in the NSIS directory is: <br />
/Contrib/AdvSplash/Example.nsi:10:        File /oname=$PLUGINSDIR\splash.bmp &quot;${NSISDIR}\Contrib\Makensisw\logo.bmp&quot;. <br />
<br />
The manual states &quot;...When using the /oname= switch, only one file can be specified, and the file name can contain variables...&quot;<br />
<br />
So my usage is: <br />
1. 	File /oname=$0 &quot;SysDLLs\$0&quot;<br />
OR<br />
2.	StrCpy ${MISSING_DLL} $0<br />
        File /oname=$0 &quot;SysDLLs\${MISSING_DLL}&quot;<br />
<br />
and on both compiler error is: <br />
&quot;File: &quot;SysDLLs\$R5&quot; -&gt; no files found.<br />
Usage: File [/nonfatal] [/a] ([/r] filespec [...]|/oname=outfile one_file_only)&quot;<br />
($R5 for MISSING_DLL; usage #2 or substitute $0 in message for usage #1)<br />
<br />
mdm</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">15th January 2004, 20:27</div></div><div class="posttext">your fault is, that the /oname switch must be set on compile-time. but $0 isnt set on compile-time. therefore the error occurs. the filename can only contain constant variables, set by !define or by nsis on compile-time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mdm</div><div class="date">15th January 2004, 21:01</div></div><div class="posttext">That seems kind of silly...let me understand you: <br />
I can use a variable, but only one that is set at compile time and not<br />
!define VAR_NAME $R5<br />
so I can set it later...hmmm:(<br />
<br />
I am verifying 18 different systemdll files in $SYSDIR. Any suggestions on alternatives to:<br />
IfFileExists $SYSDIR\$0 present absent<br />
present:<br />
DetailPrint &quot;$0 present in $SYSDIR$\n&quot;<br />
goto exit<br />
absent:         #start comparing with all 18 file names:<br />
StrCmp $0 &quot;file_1.dll&quot; 0 file1<br />
....<br />
StrCmp $0 &quot;file_18.dll&quot; 0 file18<br />
goto exit<br />
file1:<br />
File /oname=&quot;file_1.dll&quot; &quot;file_1.dll&quot;<br />
goto exit<br />
....<br />
file18:<br />
File /oname=&quot;file_18.dll&quot; &quot;file_18.dll&quot;<br />
goto exit<br />
....<br />
exit:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th January 2004, 22:57</div></div><div class="posttext">That is incorrect Comm@nder21. Of cource /oname is a run-time setting, otherwise it would be quite useless.<br />
<br />
The fault you are making is that the file location is a compile-time setting.<br />
<br />
The compiler has to know the location of the file on the compiler system, otherwise it can't include anything.<br />
<br />
Example of correct usage:<br />
<br />
File /oname=$0 &quot;file.dll&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mdm</div><div class="date">15th January 2004, 23:07</div></div><div class="posttext">Yes, that is the usage. It is unfortunate that I can't use variables for both arguments. Any further suggestions would be welcome also!<br />
<br />
thanks, <br />
mdm</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th January 2004, 23:22</div></div><div class="posttext">You don't seem to get the difference between compile-time and run-time. <br />
<br />
How could it allow you to use run-time variables when it has to include a file on the compiler system? You can use compile-time defined symbols.<br />
<br />
If you have 18 different compile-time files you will have to include 18 file commands. However you can crete a macro that does all the checks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">16th January 2004, 14:18</div></div><div class="posttext">oh, i'm sorry.<br />
i've confounded the two parameters '/oname=targetfilename' and 'originalfilename'<br />
<br />
i ment just, what u said.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mdm</div><div class="date">16th January 2004, 14:31</div></div><div class="posttext">got it, thanks for your help<br />
mdm</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MysticHead</div><div class="date">16th December 2004, 16:07</div></div><div class="posttext">Originally posted by Joost Verburg <br />
<br />
If you have 18 different compile-time files you will have to include 18 file commands. However you can crete a macro that does all the checks.  <br />
<br />
this post mentions using !defines instead of variables, which I finally get (I think..) and I just wanted to clarify the last part. <br />
So, if I'm using !defines like so:<br />
<br />
!define FILE1 &quot;D:\stuff\myfile.txt&quot;<br />
!define FILE2 &quot;D:\stuff\nxtOne.txt&quot;<br />
<br />
The only way I've been able to use  these defines with the File command is like this:<br />
<br />
File ${FILE1}<br />
File ${FILE2}<br />
<br />
So what would the macro Joost is talking about do? Check to see if a  file needs to be backed up or whatever else you wanted to do before installing the file?<br />
 <br />
Or is there some way you could call the File command using defines inside a macro? So you could have a  loop to go through all 18 of your defines? <br />
<br />
I tried to do some nested stuff where I was creating the string &quot;${FILE1}&quot; but that's failing because I'm still storing that string in a variable, which the File command can't see... <br />
<br />
So, if you've got 18 Files to install - you need to use 18 File commands, even if you are using defines? End of Story right?<br />
<br />
thanks for the clarification, I've been going around and around on this trying to get some sort of trickery that I thought I'd seen somewhere on these boards, but I've just ended up confusing myself..<br />
<br />
 -marc</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th December 2004, 20:57</div></div><div class="posttext">You cannot loop through defines unfortunately as they are around on compile-time not run-time.<br />
So yes you have to insert X File commands.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MysticHead</div><div class="date">16th December 2004, 21:34</div></div><div class="posttext">thanks much. <br />
<br />
 -marc</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>