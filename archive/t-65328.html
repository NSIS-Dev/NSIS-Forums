<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Another bug in NSIS 1.64 ???, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Another bug in NSIS 1.64 ??? NSIS Discussion" />
	
	<title> Another bug in NSIS 1.64 ??? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Another bug in NSIS 1.64 ???</div>
<hr />
<div class="pda"><a href="t-65328.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=65328">Another bug in NSIS 1.64 ???</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">11th November 2001, 10:17</div></div><div class="posttext">My last thread was about reading textfiles.<br />
It appeared that there might be a bug in FileRead,<br />
because I tried to use the errorflag to escape from<br />
a reading loop, but that did not work.<br />
<br />
Actually, I'm trying to write an installation that will<br />
add some lines to a startup (text)file.<br />
At Uninstall, these lines should be deleted from that<br />
file of course. So I've written a procedure that will<br />
read the file untill the end (thx Dave!!!) and I will<br />
write this line into another temp file unless the line<br />
corresponds to the line added by the Install. (Lateron I<br />
delete the original file and rename the tempfile).<br />
<br />
But I discovered that if there is no EndOfLine (&quot;$\r$\n&quot;)<br />
at the last line of the file, then FileWrite will write a<br />
string to file with the last character repeated a lot of times:<br />
<br />
Hi, my name is Smile2Meeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee<br />
(and more, in total 1024 characters)<br />
<br />
Is this a bug??? How to avoid it???<br />
<br />
Or: How to delete these lines from the file more easily???<br />
<br />
Does anyone know???<br />
<br />
Tell me please, thx, Hendri (:( Smile2Me)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">11th November 2001, 14:39</div></div><div class="posttext">I'm thinking that the problem above is still caused<br />
by the same bug I encountered previously: FileRead<br />
does not handle a EOF properly if it occurs before<br />
an EOL (is my opinion, Justin help me, please!)<br />
<br />
The reason: the strings I write to a new file are<br />
produced by FileRead, so that should be the cause.<br />
<br />
Code so far:<br />
function &quot;copyandleaveout&quot;<br />
FileOpen $0 &quot;ReadingFile&quot; &quot;r&quot;<br />
FileOpen $1 &quot;WritingFile&quot; &quot;w&quot;<br />
loop:<br />
FileRead $0 $2<br />
StrCmp $2 &quot;&quot; Exit<br />
StrCmp $2 &quot;This line should be left out$\r$\n&quot; loop<br />
FileWrite $1 $2<br />
Goto loop<br />
Exit:<br />
FileClose $0<br />
FileClose $1<br />
FunctionEnd<br />
<br />
and this produces a textfile without the line that should be<br />
left out, but the last line of the produced text file is really<br />
weird (see above), e.g.:<br />
Hi, my name is Smile2Meeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee<br />
where the original file had as a last line:<br />
Hi, my name is Smile2Me<br />
<br />
So there seems to bee something wrong with FileRead,<br />
because it does not generate the right string if EOF<br />
is encountered and certainly not a proper error if I<br />
try to read the file after EOF. (I used an IfErrors<br />
construction before to escape from the loop, but it<br />
actually did not escape from the loop, so I had to close<br />
the UnInstall using Ctrl+Alt+Del...)<br />
<br />
Justin (or anyone), does this sound familiar to you???<br />
Am I doing something wrong or did I discover a bug???<br />
<br />
<br />
Tell me, greetz, Hendri (:( Smile2Me).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">11th November 2001, 17:14</div></div><div class="posttext">This makensis should have both problems fixed.<br />
<br />
Justin, code changed is if (!ReadFile(h,&amp;c,1,&amp;dw,NULL) || dw!=1) break; in exec.c<br />
<br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">11th November 2001, 18:39</div></div><div class="posttext">Thx Dave!!!<br />
<br />
Greetz, Hendri :D</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>