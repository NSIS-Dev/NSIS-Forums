<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need a Wait statement...?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need a Wait statement...? NSIS Discussion" />
	
	<title> Need a Wait statement...? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need a Wait statement...?</div>
<hr />
<div class="pda"><a href="t-193673.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=193673">Need a Wait statement...?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">michaelmross</div><div class="date">15th September 2004, 21:27</div></div><div class="posttext">This must be a very common situation, so forgive me. I have a function that tests if the application being installed is already running:<br />
<br />
    FindWindow $0 &quot;ThunderRT6FormDC&quot; &quot;TaskTracker&quot;<br />
    IsWindow $0 0 done<br />
       Messagebox MB_OK|MB_ICONSTOP &quot;Please exit TaskTracker before proceeding.&quot;<br />
       Abort<br />
<br />
The problem is I don't want to Abort. I want to Wait till the user closes the running app. How can I do this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">15th September 2004, 21:46</div></div><div class="posttext">Will a loop help you?<br />
<br />
loop:<br />
FindWindow $0 &quot;ThunderRT6FormDC&quot; &quot;TaskTracker&quot;<br />
IsWindow $0 0 done<br />
Messagebox MB_OK|MB_ICONSTOP &quot;Please exit TaskTracker before proceeding.&quot;<br />
Goto loop<br />
done:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">michaelmross</div><div class="date">16th September 2004, 12:13</div></div><div class="posttext">If that worked the way I expected, wouldn't it just show the message again the moment it was dismissed until the app was closed? (However, for some reason, it doesn't do that - it still terminates.) But anyway, what I would want to happen is to go back one page to Choose Install Location and not have the message reappear unless the user clicked Install again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">16th September 2004, 13:25</div></div><div class="posttext">You can use NSIS Sleep in the loop.<br />
<br />
Another way - WaitForSingleObject and other Win API calls with System plugin - VB sample from http://support.microsoft.com/default.aspx?scid=kb;EN-US;176391 below:<br />
<br />
hWindow = FindWindow(vbNullString, &quot;Calculator&quot;)<br />
hThread = GetWindowThreadProcessId(hWindow, lProcessId)<br />
hProcess = OpenProcess(SYNCHRONIZE, 0&amp;, lProcessId)<br />
lngReturnValue = PostMessage(hWindow, WM_CLOSE, 0&amp;, 0&amp;)<br />
lngResult = WaitForSingleObject(hProcess, INFINITE)<br />
<br />
If you don't want to send wm_close - modify this code to NSIS script, add MessageBox, loop, change INFINITE and so on...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">16th September 2004, 14:21</div></div><div class="posttext">Oh, I was thinking the MessageBox would tell them to close the other window. Then they would close it and click OK on the install message which would then retest and see that the window was closed and allow them to continue.<br />
It sounds like what you should do now is make that function get hit when the user leaves that dialog and then stay on that dialog if the user still has that window open and display the message. Look up Page or Modern UI about leave functions. Abort is what you want in that case. Or attach your script and I can help you out.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">michaelmross</div><div class="date">17th September 2004, 14:04</div></div><div class="posttext">OK, I tried the following:<br />
<br />
!define MUI_DIRECTORYPAGE_VERIFYONLEAVE LeaveFunction<br />
.  .  .<br />
Function LeaveFunction<br />
<br />
     FindWindow $0 &quot;ThunderRT6FormDC&quot; &quot;TaskTracker&quot;<br />
    IsWindow $0 0 done<br />
       Messagebox MB_OK|MB_ICONSTOP &quot;Please exit TaskTracker before proceeding.&quot;<br />
       Abort<br />
done:<br />
<br />
FunctionEnd<br />
<br />
...and I get a compile warning:<br />
1 warning:<br />
  install function &quot;LeaveFunction&quot; not referenced - zeroing code (306-311) out.<br />
<br />
Thanks for your offer... here is my attached script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">17th September 2004, 17:08</div></div><div class="posttext">Looks like it's not picking it up. Put the !define line just above the !insertmacro for the page you want to add the leave function for. I'm actually not sure where you wanted it so I just used MUI_PAGE_DIRECTORY in my example.<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE &quot;LeaveFunction&quot;<br />
!insertmacro MUI_PAGE_DIRECTORY</div></div><hr />


<div class="post"><div class="posttop"><div class="username">michaelmross</div><div class="date">17th September 2004, 21:00</div></div><div class="posttext">Thanks. That does exactly what I wanted. When Install is clicked, the message comes up, and when it's dismissed the installer state is unchanged.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>