<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" What's wrong with my Custom Page?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  What's wrong with my Custom Page? NSIS Discussion" />
	
	<title> What's wrong with my Custom Page? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  What's wrong with my Custom Page?</div>
<hr />
<div class="pda"><a href="t-300008.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=300008">What's wrong with my Custom Page?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">17th November 2008, 01:06</div></div><div class="posttext">I have been trying to find the cause of the problem in my script - to no avail.<br />
<br />
I have a script that works well. But now I want to add to it a custom page that prompts the user to select a folder. Here is the function for that page:<br />
<br />
<br />
<br />
Var varSelectedFolder  ; global var - defined before any section, page or function<br />
<br />
LangString PAGE_TITLE ${LANG_ENGLISH} &quot;Title&quot;<br />
LangString PAGE_SUBTITLE ${LANG_ENGLISH} &quot;Subtitle&quot;<br />
<br />
Function PageDirSelect<br />
  !insertmacro MUI_HEADER_TEXT $(PAGE_TITLE) $(PAGE_SUBTITLE)<br />
<br />
  nsDialogs::SelectFolderDialog /NOUNLOAD &quot;Select Folder&quot; &quot;$DOCUMENTS&quot;<br />
  Pop $varSelectedFolder	;where selected folder string is returned<br />
<br />
  ; Check A Folder Has Been Selected<br />
  ${If} $varSelectedFolder == &quot;error&quot;<br />
    MessageBox MB_OK &quot;You must select a folder a folder. Aborting.&quot;<br />
    Abort ; Cancel Installation<br />
  ${Else}<br />
  ${EndIf}<br />
 <br />
  nsDialogs::Show<br />
FunctionEnd<br />
<br />
<br />
The custom page is simply inserted between the version checking (custom) page and the MUI_PAGE_INSTFILES.<br />
<br />
!ifdef VER_MAJOR &amp; VER_MINOR &amp; VER_REVISION &amp; VER_BUILD<br />
  Page custom PageReinstall PageLeaveReinstall<br />
!endif<br />
  Page custom PageDirSelect <br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !insertmacro MUI_PAGE_FINISH<br />
 <br />
 <br />
Again, when I comment out the Page custom line, the script works and finishes fine.<br />
<br />
But with the Page custom code, the script never reaches the finish page!<br />
<br />
This is beyond me. Clearly there is something wrong that I am doing in the custom page function (PageDirSelect). But what is it?<br />
<br />
That function is so simple... I am lost.:confused: <br />
<br />
Any help, clue or insight would be deeply appreciated.<br />
<br />
Thanks!<br />
<br />
P.S. Is it possible that I need a leave function for this custom page? Must I have a leave function even when a page is that simple? (if so, why?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nsnb</div><div class="date">17th November 2008, 18:39</div></div><div class="posttext">Thanks to LoRd_MuldeR, the mystery has been solved: It turns out that the last line in the function (nsDialogs::Show) is the one responsible for ruining everything.<br />
<br />
I commented it out and all works now as desired.<br />
<br />
Now, my question is one of understanding: Why?<br />
<br />
Why, when using nsDialogs::Create in the custom page function, nsDialogs::Show is mandatory, while when using nsDialogs::SelectFolderDialog, nsDialogs::Show must not be used?<br />
<br />
Is it because nsDialogs::SelectFolderDialog contains both create() and show() calls?<br />
<br />
If so, why would a second show() call would be so devastating to the entire .nsi script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">17th November 2008, 20:11</div></div><div class="posttext">It's probably because the folder and file browse dialogs are not actually part of the custom page.  They are actually separate windows.<br />
<br />
Think about it: <br />
Normally you wouldn't expect to see a folder browse dialog until you click a &quot;browse&quot; button. <br />
<br />
Therefore, you'd probably want to put it in an onclick function of a button instead of the create function.  <br />
<br />
Usually, you do this with text box and a browse button.  When someone clicks the button and selects a file or folder, you just send a message to update the contents of the text box.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">18th November 2008, 01:03</div></div><div class="posttext">It seems nsDialogs::SelectFolderDialog is a stand-alone function that runs independent of nsDialogs::Create and nsDialogs::Show. Also, as already state by Comperio, that function doesn't actually create a custom page, but shows a popup dialog. The call to nsDialogs::SelectFolderDialog will NOT return, until the user has selected a folder (or has aborted). So there's no need (and no sense) in calling the nsDialogs::Show function after the folder dialog is already done.<br />
<br />
In fact it shouldn't even be necessary to call nsDialogs::SelectFolderDialog from a custom page function...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>