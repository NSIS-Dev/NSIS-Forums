<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" FileWrite Question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  FileWrite Question NSIS Discussion" />
	
	<title> FileWrite Question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  FileWrite Question</div>
<hr />
<div class="pda"><a href="t-262083.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262083">FileWrite Question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th December 2006, 16:02</div></div><div class="posttext">Perhaps it is something obvious that I can't get it, though the forum search did not quite help me.<br />
The question is this:<br />
While the FileRead successfully stores in the variable an empty line, the FileWrite assumes that the variable is empty so does not add the empty line to the new file. Examine the example below for details as it become complicated to explain it.<br />
If I don't execute TrimNewLines then the text reproduced correctly in the new text file, but no in the log window where I can see the symbols of return and new line.<br />
If I do execute TrimNewLines then the text displayed correctly in the log window (with empy lines where they exist) but the filewrite does not catch the empty line stored into the variable, so I have to add $\r$\n in order to reproduce the original text structure.<br />
Eh!<br />
!include TextFunc.nsh<br />
!insertmacro TrimNewLines<br />
<br />
showinstdetails show<br />
OutFile licopy.exe<br />
<br />
Section<br />
SetDetailsPrint none<br />
IfFileExists '$EXEDIR\LicenseCopy.txt' 0 +2<br />
Delete '$EXEDIR\LicenseCopy.txt'<br />
FileOpen $0 &quot;${NSISDIR}\license.txt&quot; r ; file to read<br />
FileOpen $R2 '$EXEDIR\LicenseCopy.txt' w ; file to write<br />
SetDetailsPrint listonly<br />
<br />
start:<br />
FileRead $0 $1<br />
StrCmp $1 '' end<br />
;${TrimNewLines} '$1' '$1'<br />
;StrCmp $1 '' 0 +2<br />
;FileWrite $R2 '$\r$\n$\r$\n'<br />
FileWrite $R2 '$1'<br />
FileSeek $R2 '0' END<br />
DetailPrint '$1'<br />
goto start<br />
<br />
end:<br />
SetDetailsPrint none<br />
FileClose $0<br />
FileClose $R2<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">19th December 2006, 16:39</div></div><div class="posttext">well, you have a solution, so where's the problem? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th December 2006, 16:47</div></div><div class="posttext">I have a solution as you said, but, is this the right one?<br />
I mean this is the way supposed to act FileWrite or am I missing something?<br />
And if this is the way, there is a why.<br />
Why FileWrite is not able to manage the empty line that is stored in $var from FileRead? :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">19th December 2006, 17:02</div></div><div class="posttext">hmm, i'm wondering if i misunderstood something.<br />
<br />
i changed your loop a bit and came with this, plz test:<br />
<br />
FileOpen $0 &quot;${NSISDIR}\license.txt&quot; r ; file to read<br />
FileOpen $R0 '$EXEDIR\LicenseCopy.txt' w ; file to write<br />
SetDetailsPrint listonly<br />
<br />
ClearErrors<br />
loop:<br />
FileRead $0 $1 ${NSIS_MAX_STRLEN}<br />
IfErrors end<br />
FileWrite $R0 '$1'<br />
DetailPrint '$1'<br />
Goto loop<br />
<br />
end:<br />
SetDetailsPrint none<br />
FileClose $0<br />
FileClose $R0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th December 2006, 17:19</div></div><div class="posttext">It does exactly the same with my code.<br />
Again the FileWrite does not handle the empty line stored in $1 from FileRead.:-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">20th December 2006, 17:06</div></div><div class="posttext">Someone plz?!<br />
Someone to explain me why while we are in a loop the FileWrite assumes that the variable $1 has no string, when actually once the variable has not string the loop is terminated. This means that the FileRead detects the empty line as string and it stores it on variable $1, though, the FileWrite does not detect it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">20th December 2006, 17:22</div></div><div class="posttext">no, that code works fine for me.<br />
<br />
the loop i posted above works by 100% fine for me, the file is copied 1:1, just the output in the install log window is crappy.<br />
<br />
therefore you'll need to use trimnewlines just for display the license text:<br />
<br />
FileOpen $0 &quot;${NSISDIR}\license.txt&quot; r ; file to read<br />
FileOpen $R0 '$EXEDIR\LicenseCopy.txt' w ; file to write<br />
SetDetailsPrint listonly<br />
<br />
ClearErrors<br />
loop:<br />
FileRead $0 $1 ${NSIS_MAX_STRLEN}<br />
IfErrors end<br />
FileWrite $R0 '$1'<br />
${TrimNewLines} '$1' $2<br />
DetailPrint '$2'<br />
Goto loop<br />
<br />
end:<br />
SetDetailsPrint none<br />
FileClose $0<br />
FileClose $R0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">20th December 2006, 17:33</div></div><div class="posttext">Mine too, works 100% just the output in the install log window is crappy.<br />
If I use TrimNewLines the log window is perfect with the empty lines since FileRead detects these empty lines, though, FileWrite assumes that the variable has no string and therefore the LicenseCopy.txt does not reproduced 100% like the way it is reproduced in log window. In other words DetailPrint and FileWrite they share the same variable at the same time to print the stored string, but, they export different results.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">20th December 2006, 20:07</div></div><div class="posttext">yes, detailprint and filewrite work different regarding line breaks.<br />
<br />
but with the code i posted, it works with neither crappy output to the log window nor wrong license file output.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">20th December 2006, 20:24</div></div><div class="posttext">Thanks for the feedback :-)<br />
Well, this is what I'm talking about since I opened this thread. Why FileWrite has different behaviour. I know it's easy to add TrimNewLines either by your way or by my way (examine the script on the top of the thread and uncomment those three lines). Just wanted to know if this happens for some particular reason. That's all. Again thanks a lot for your support :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">22nd December 2006, 15:23</div></div><div class="posttext">you're welcome :)<br />
<br />
i guess, if you want to understand why they work different, you should have a look at the source and find out, through which windows api calls the commands do their work.<br />
<br />
this should give us more information :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">22nd December 2006, 16:49</div></div><div class="posttext">Originally posted by Comm@nder21 <br />
you're welcome :)<br />
<br />
i guess, if you want to understand why they work different, you should have a look at the source and find out, through which windows api calls the commands do their work.<br />
<br />
this should give us more information :) <br />
LOL you're right! Certainly I had to do that before. Blame on me!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 12:43</div></div><div class="posttext">The difference between DetailPrint and FileWrite is that FileWrite writes exactly what you tell it to. DetailPrint writes one line and adds a line break. If you give FileWrite an empty string, it'll write nothing at all. If you give it a string parsed by TrimNewLines, it won't write a line break and you'll get many lines concatenated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">29th December 2006, 13:08</div></div><div class="posttext">I think I got it. Allow me to explain it as I understand it.<br />
In order to operate with accuracy, FileRead parses the empty string, so we're able to keep looping. Parses nothing when there is no string, so we're getting out of the loop.<br />
Contrariwise, when the empty string is parsed, FileWrite assumes that there is nothing to write, so if we want to reproduce the line break there is no need for TrimNewLines, otherwise, we do TrimNewLines and then manually add line break where and when it is necessary.<br />
<br />
Are these right?<br />
<br />
Thanks a lot!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2006, 13:44</div></div><div class="posttext">That's about right. Though I wouldn't say FileWrite parses anything. But that's just details.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>