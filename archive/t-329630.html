<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to close firefox in nsis?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to close firefox in nsis? NSIS Discussion" />
	
	<title> How to close firefox in nsis? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to close firefox in nsis?</div>
<hr />
<div class="pda"><a href="t-329630.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=329630">How to close firefox in nsis?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">13th April 2011, 21:05</div></div><div class="posttext">Here is what I did to close firefox,<br />
<br />
  FindWindow $0 'MozillaWindowClass' ''<br />
		<br />
  ${If} $0 &lt;&gt; 0<br />
  SendMessage $0 ${WM_CLOSE} 0 0<br />
  ${EndIf}<br />
<br />
But it doesn't work. How can I achieve that? Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th April 2011, 22:12</div></div><div class="posttext">!include LogicLib.nsh<br />
loop:<br />
FindWindow $0 &quot;MozillaUIWindowClass&quot;<br />
${If} $0 &lt;&gt; 0<br />
	SendMessage $0 0x0112 0xF060 0	<br />
	Sleep 250<br />
	goto loop<br />
${EndIf}<br />
<br />
If firefox has &quot;confirm close with multiple tabs open&quot;, who knows what will happen, you might want to limit the loop to 50 retries or so...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">13th April 2011, 23:07</div></div><div class="posttext">!include LogicLib.nsh<br />
loop:<br />
FindWindow $0 &quot;MozillaUIWindowClass&quot;<br />
${If} $0 &lt;&gt; 0<br />
	SendMessage $0 0x0112 0xF060 0	<br />
	Sleep 250<br />
	goto loop<br />
${EndIf}<br />
<br />
If firefox has &quot;confirm close with multiple tabs open&quot;, who knows what will happen, you might want to limit the loop to 50 retries or so...<br />
Thanks for your reply. It doesn't work. FindWindow $0 &quot;MozillaUIWindowClass&quot; always set $0 to zero. Any further ideas? Thank you very much!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th April 2011, 00:46</div></div><div class="posttext">It worked when I tested it (Firefox 3.6) The class name is a internal thing and could change between releases. Use http://catch22.net/software/winspy to find the class name</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th April 2011, 11:28</div></div><div class="posttext">Firefox 4 is just called MozillaWindowClass.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">14th April 2011, 15:35</div></div><div class="posttext">It worked when I tested it (Firefox 3.6) The class name is a internal thing and could change between releases. Use http://catch22.net/software/winspy to find the class name<br />
It works in firefox 3.6 but it doesn't work in firefox 4 even though I use class name &quot;MozillaWindowClas&quot; for firefox 4(I find out this name by using Spy++). Any idea why it doesn't work in firefox 4?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">14th April 2011, 15:37</div></div><div class="posttext">Firefox 4 is just called MozillaWindowClass.<br />
<br />
Stu<br />
Yes, you are right.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th April 2011, 16:36</div></div><div class="posttext">well, the message is WM_SYSCOMMAND + SC_CLOSE so it should work, but you could try WM_CLOSE as well, and if both fail, bring out the big hammer and call DestroyWindow with the system plugin...<br />
<br />
(But why not just ask the user to close firefox? They might want to save bookmarks etc)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">14th April 2011, 17:34</div></div><div class="posttext">well, the message is WM_SYSCOMMAND + SC_CLOSE so it should work, but you could try WM_CLOSE as well, and if both fail, bring out the big hammer and call DestroyWindow with the system plugin...<br />
<br />
(But why not just ask the user to close firefox? They might want to save bookmarks etc)<br />
I tried both  WM_SYSCOMMAND + SC_CLOSE and WM_CLOSE in Firefox 4. They don't work. If you like, you can try them in Firefox 4 too. It won't take much time if you already tried it in Firefox 3.6. They just simply don't work. <br />
Could you give me an example how to use DestroyWindow with the system plugin? Thanks a lot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th April 2011, 18:08</div></div><div class="posttext">!include LogicLib.nsh<br />
StrCpy $1 0<br />
loop:<br />
FindWindow $0 &quot;MozillaUIWindowClass&quot;<br />
${IfThen} $0 = 0 ${|} FindWindow $0 &quot;MozillaWindowClass&quot; ${|}<br />
${If} $0 &lt;&gt; 0<br />
	SendMessage $0 0x0112 0xF060 0<br />
	<br />
	Sleep 500<br />
	IntOp $1 $1 + 1<br />
	IntCmp $1 25 &quot;&quot; loop<br />
${EndIf}<br />
<br />
This works in both 3.6 and 4 on XP (In my non standard FF configuration), but like I said, you should ask the user, not close the windows on your own.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">14th April 2011, 18:56</div></div><div class="posttext">!include LogicLib.nsh<br />
StrCpy $1 0<br />
loop:<br />
FindWindow $0 &quot;MozillaUIWindowClass&quot;<br />
${IfThen} $0 = 0 ${|} FindWindow $0 &quot;MozillaWindowClass&quot; ${|}<br />
${If} $0 &lt;&gt; 0<br />
	SendMessage $0 0x0112 0xF060 0<br />
	<br />
	Sleep 500<br />
	IntOp $1 $1 + 1<br />
	IntCmp $1 25 &quot;&quot; loop<br />
${EndIf}<br />
<br />
This works in both 3.6 and 4 on XP (In my non standard FF configuration), but like I said, you should ask the user, not close the windows on your own.<br />
I know there is &quot;confirm close&quot; dialog in firefox when the user closes firefox. Right now, I just could not trigger this dialog no matter what I do. Do you have any idea how to achieve that? Thanks a lot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th April 2011, 20:30</div></div><div class="posttext">I think you should change your strategy. Ask the user to close Firefox themselves. You can either do this with your own code (similar to what we use in this topic) or use a plug-in such as LockedList.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">14th April 2011, 22:16</div></div><div class="posttext">I think you should change your strategy. Ask the user to close Firefox themselves. You can either do this with your own code (similar to what we use in this topic) or use a plug-in such as LockedList.<br />
<br />
Stu<br />
So should I just call MessageBox MB_OK &quot;Please Close Firefox&quot; in the script? Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smurge</div><div class="date">14th April 2011, 22:46</div></div><div class="posttext">i think yes!<br />
<br />
i would never install a program that will automatically taskkill my firefox.exe!<br />
<br />
Take a look at that LockedList plugin as Afrow UK suggested.<br />
What you have to use depends on your purpose/program. but never kill a task on the user system unasked !!!<br />
<br />
bye</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th April 2011, 00:31</div></div><div class="posttext">You don't just have to have a message box. Using FindWindow you can detect whether Firefox has been closed or not and keep asking them to close Firefox until FindWindow returns 0. Using LockedList has more features of course.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JohnChen</div><div class="date">15th April 2011, 19:35</div></div><div class="posttext">You don't just have to have a message box. Using FindWindow you can detect whether Firefox has been closed or not and keep asking them to close Firefox until FindWindow returns 0. Using LockedList has more features of course.<br />
<br />
Stu<br />
I don't quite get what you meant. Without using message box, how can I &quot;keep asking them to close Firefox&quot;? I should have some way to inform the users of closing the firefox, right? Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">15th April 2011, 21:12</div></div><div class="posttext">He means that you have not to show this messegebox always. You can use the &quot;find firefox window&quot; checkup to show the messagebox only if firefox is open.<br />
<br />
!include LogicLib.nsh <br />
StrCpy $1 0 <br />
loop: <br />
FindWindow $0 &quot;MozillaUIWindowClass&quot; <br />
${IfThen} $0 = 0 ${|} FindWindow $0 &quot;MozillaWindowClass&quot; ${|} <br />
${If} $0 &lt;&gt; 0 <br />
MessageBox MB_OK|MB_ICONSTOP|MB_TOPMOST|MB_SETFOREGROUND &quot;Close Firefox now and press ok to continue.&quot;  <br />
goto loop <br />
${EndIf} <br />
 <br />
<br />
cheers</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">20th April 2011, 09:40</div></div><div class="posttext">I know there is &quot;confirm close&quot; dialog in firefox when the user closes firefox. Right now, I just could not trigger this dialog no matter what I do. Do you have any idea how to achieve that? Thanks a lot.<br />
<br />
You should create a new profile: firefox.exe -P<br />
and create a new profile for testing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Squirre1</div><div class="date">20th April 2011, 17:22</div></div><div class="posttext">Would it not achieve the same affect to do the following...<br />
    !insertmacro logme ${INSTLOG} &quot;Locating and terminating running firefox.exe processes&quot; b<br />
    ${nsProcess::FindProcess} &quot;firefox.exe&quot; $0<br />
    ${If} $0 == '0'<br />
      !insertmacro logme ${INSTLOG} &quot;- Running Process Found: firefox.exe&quot; l<br />
      !insertmacro logme ${INSTLOG} &quot;- Terminating Process: firefox.exe&quot; l<br />
      ${nsProcess::KillProcess} &quot;firefox.exe&quot; $0<br />
      !insertmacro logme ${INSTLOG} &quot;- Terminate Process Returned Code: $0&quot; l<br />
    ${Else}<br />
      !insertmacro logme ${INSTLOG} &quot;- Running Process Not Found: firefox.exe&quot; l<br />
    ${EndIf}<br />
<br />
<br />
Disregard the logme macros, that is a making of my own... Depends on what you are trying to accomplish though, but this is what I use.<br />
<br />
http://nsis.sourceforge.net/NsProcess_plugin<br />
<br />
Squirre1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th April 2011, 22:57</div></div><div class="posttext">That will not work if and when they make an official 64-bit build of Firefox. FindWindow is safer (when you have a class name).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mrphantuan</div><div class="date">22nd April 2011, 03:05</div></div><div class="posttext">Firefox 4 is just called MozillaWindowClass.<br />
<br />
<br />
<br />
<br />
<br />
<br />
_________________<br />
noi that fami (http://www.noithat-fami.net),noi that 190 (http://www.noithat190.net.vn)|</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>