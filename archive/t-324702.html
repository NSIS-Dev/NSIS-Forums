<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Cant get macro to run!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Cant get macro to run! NSIS Discussion" />
	
	<title> Cant get macro to run! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Cant get macro to run!</div>
<hr />
<div class="pda"><a href="t-324702.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=324702">Cant get macro to run!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">8th December 2010, 15:50</div></div><div class="posttext">Hi all,<br />
<br />
I have been battling for a while with this one and have decided to strip it back to basics....<br />
I have been following the page at http://nsis.sourceforge.net/Macro_vs_Function<br />
<br />
In my Function.onInit I have....<br />
<br />
!macro Hello<br />
  DetailPrint &quot;Hello world&quot;<br />
!macroend<br />
<br />
Then I have.....<br />
<br />
Function tester<br />
!insertmacro Hello<br />
FunctionEnd<br />
<br />
Lower down in my code, when I run it it doesn't display the Hellow World box, it's probably me being daft but can anyone point out my error?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">8th December 2010, 15:53</div></div><div class="posttext">Why do you define in the macro in your .onInit function?<br />
<br />
Usually you would define the macro before all your functions and sections. And then insert the macro in some function or section.<br />
<br />
(Just a side note: Macros don't &quot;run&quot;. They are inserted/expanded in-place, at the moment when your installer is built)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">8th December 2010, 16:02</div></div><div class="posttext">Hi,<br />
<br />
I put the macro there as I couldn't find anywhere to tell me where to put it!  I have now put it outside of my oninit so it looks like this....<br />
<br />
;Page Variables<br />
Function .onInit<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS &quot;intro.ini&quot; &quot;intro&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS &quot;softselect.ini&quot; &quot;softselect&quot;<br />
FunctionEnd<br />
<br />
!macro Hello<br />
  DetailPrint &quot;Hello world&quot;<br />
!macroend<br />
<br />
It still is not displaying the message though :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">8th December 2010, 16:07</div></div><div class="posttext">Okay, let me make this clear again:<br />
<br />
1. Define your macro using &quot;!macro ... !macroend&quot; before anything else and outside any function/section.<br />
<br />
2. Then insert your macro, using &quot;!insertmacro&quot; at the desired place, which can be in a function or a section, for example.<br />
<br />
3. Inserting a macro basically means that the macro code will be copied to that place.<br />
<br />
4. If you inserted the macro into some function, that code won't execute until the enclosing function is called. If you inserted the macro into some section, that code won't be executed until the enclosing section is executed.<br />
<br />
<br />
Try like:<br />
<br />
OutFile test.exe<br />
Name &quot;Test&quot;<br />
<br />
!macro Hello<br />
  MessageBox MB_OK &quot;Hello world&quot;<br />
!macroend<br />
<br />
Function .onInit<br />
  !insertmacro Hello<br />
FunctionEnd<br />
<br />
Section<br />
  [Your installer section here]<br />
SectionEnd<br />
<br />
<br />
Which is 100% equivalent to:<br />
<br />
Function .onInit<br />
  MessageBox MB_OK &quot;Hello world&quot;<br />
FunctionEnd<br />
<br />
Section<br />
  [Your installer section here]<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">8th December 2010, 16:29</div></div><div class="posttext">Thanks for clarifying things for me, seems I am getting mixed up with commands<br />
<br />
  MessageBox MB_OK &quot;Hello world&quot;<br />
<br />
VS<br />
<br />
DetailPrint &quot;Hello world&quot;<br />
<br />
I was expecting Hello World to pop up in a box with DetailPrint, which it obviously won't do.<br />
<br />
Thanks for steering me in the right direction :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">8th December 2010, 16:39</div></div><div class="posttext">DetailPrint, as the name implies, writes to the installation details box...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">starfighter5</div><div class="date">8th December 2010, 16:42</div></div><div class="posttext">My mistake.....<br />
<br />
On a secondary note, when using the code below<br />
<br />
Function tester<br />
!insertmacro test<br />
FunctionEnd<br />
<br />
Gives me<br />
<br />
install function &quot;tester&quot; not referenced - zeroing code out<br />
<br />
Do I need to reference the function elsewhere?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">8th December 2010, 17:01</div></div><div class="posttext">Well, you insert (copy) your macro into a custom function named &quot;tester&quot; here.<br />
<br />
But apparently you never call that function!<br />
<br />
The special .onInit function is called automatically on startup, but &quot;normal&quot; functions are not.<br />
<br />
NSIS is smart and will &quot;zero out&quot; (ignore) functions that are never called ;)<br />
<br />
<br />
Try adding something like:<br />
<br />
Section<br />
  DetailPrint &quot;Now calling the function...&quot;<br />
  Call tester<br />
SectionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>