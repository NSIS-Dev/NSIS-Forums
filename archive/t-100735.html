<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Why no WriteEnvStr instruction ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Why no WriteEnvStr instruction ? NSIS Discussion" />
	
	<title> Why no WriteEnvStr instruction ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Why no WriteEnvStr instruction ?</div>
<hr />
<div class="pda"><a href="t-100735.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=100735">Why no WriteEnvStr instruction ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">trevisev</div><div class="date">20th August 2002, 18:25</div></div><div class="posttext">I tried to read and write environment variables (under Windows NT 4) with NSIS (I use the 1.99).<br />
I found the instruction ReadEnvStr to read them, and it works very well. But there is no instruction to write it directly. :cry:<br />
<br />
So I used WriteRegStr to set directly the variables in the Windows registry (HKCU/Environment). But Windows does not care about the changes. I have to go to the Windows environment variables dialog, then select OK to make it work. Rebooting the computer work too. But both of the solutions are not convenient... :(<br />
<br />
Is there a way to write an environment variable and make it work with NSIS ?  :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th August 2002, 18:31</div></div><div class="posttext">Have a look here (http://www.clantpa.co.uk/nsis/wiki/index.php/Path). This script should help you understand how to do it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trevisev</div><div class="date">21st August 2002, 20:58</div></div><div class="posttext">Thank's a lot. It works well !<br />
<br />
But it's boring to write code for both Windows 9x (or ME) and NT. I'll see if I can write a function to do that...<br />
<br />
Let's sum up:<br />
For Windows 95 or ME, to change environment variables, you have to modify autoexec.bat<br />
For Windows NT, just modify it into the registry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st August 2002, 21:02</div></div><div class="posttext">Yep, that's how it works... But why rewrite? Just copy my code and change &quot;Path&quot; to whatever variable you want to set, or better yet, make it a function variable (using the stack). Don't forget to call RefreshEnv.exe on NT so you won't have to reboot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbareis</div><div class="date">22nd August 2002, 10:18</div></div><div class="posttext">Hi,<br />
<br />
While the code is quite good (and I know given the language it took a lot of work and probably swearing) it only handles the &quot;PATH&quot; environment variable.<br />
<br />
I too would like some code for this...<br />
<br />
I need to update the PATH, some PATH like environment variables and also simpler environment variables (set text). This sort of stuff should really be in the NSIS EXE.<br />
<br />
Bye,<br />
Dennis</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd August 2002, 10:32</div></div><div class="posttext">Why should it be in the EXE if you can do it with the script? It is not that complicated...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbareis</div><div class="date">22nd August 2002, 10:49</div></div><div class="posttext">Originally posted by kichik <br />
Why should it be in the EXE if you can do it with the script? It is not that complicated... <br />
<br />
Hi,<br />
<br />
For something thats not that complicated there seems to be a severe lack of code to be downloaded, and not just in this area...<br />
<br />
I could do it but there is just too few hours in the day to do everything...<br />
<br />
My 2 cents worth,<br />
Dennis</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd August 2002, 10:56</div></div><div class="posttext">Severe lack? It does exactly what you want! All you have to do is to change &quot;PATH&quot; to whatever you want it to be or make it a pushed argument to the function... Do you want me to write it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">22nd August 2002, 11:37</div></div><div class="posttext">Originally posted by dbareis This sort of stuff should really be in the NSIS EXE.That's like saying that in the C language the input/output instructions should be part of the language. However, they're not, they're something implemented in C that you can &quot;include&quot;. Surely you can put KiCHiK's stuff into functions/macros in NSIS in a .nsh file or whatever and &quot;include&quot; them and hey voila you have a similar solution to that in C and no need for bloating the compiler.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd August 2002, 12:33</div></div><div class="posttext">Here it is, enjoy :D<br />
<br />
Attachment removed. Newer version below.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trevisev</div><div class="date">22nd August 2002, 18:14</div></div><div class="posttext">I meant I my first post, to write a function that accept as arguments:<br />
- the environment variable to consider<br />
- the action to do on it (ie: delete or write new value)<br />
and the function would do everything needed for Windows 9x and NT OS.<br />
<br />
Indeed, that's not very complicated from your sources...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MoNKi</div><div class="date">22nd August 2002, 20:17</div></div><div class="posttext">kichik y think there is an error in your code but i'm not sure:<br />
<br />
In function WriteEnvStr:<br />
<br />
<br />
StrCpy $2 $WINDIR 2 ; Copy drive of windows (c:)<br />
FileOpen $2 &quot;$1\autoexec.bat&quot; a<br />
<br />
<br />
should be<br />
<br />
<br />
StrCpy $2 $WINDIR 2 ; Copy drive of windows (c:)<br />
FileOpen $2 &quot;$2\autoexec.bat&quot; a<br />
              ^</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd August 2002, 20:20</div></div><div class="posttext">Indeed. Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">YtseJam</div><div class="date">22nd August 2002, 20:27</div></div><div class="posttext">Did you update the SourceForge thingie? I'd check by myself by I can't be arsed to do so with this Dial-up plus I'm about to go to the Air-port. (ITALY! WEE!)<br />
<br />
See ya' next week kichik. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd August 2002, 20:29</div></div><div class="posttext">What does this script has to do with SourceForge CVS?<br />
<br />
Have fun in Italy :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">paul_snoop</div><div class="date">27th August 2002, 14:57</div></div><div class="posttext">Exactly what I was looking for, thanks very much Kichik :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>