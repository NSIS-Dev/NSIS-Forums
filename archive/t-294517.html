<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Syntax question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Syntax question NSIS Discussion" />
	
	<title> Syntax question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Syntax question</div>
<hr />
<div class="pda"><a href="t-294517.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294517">Syntax question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">patelb</div><div class="date">14th July 2008, 22:23</div></div><div class="posttext">I have this in my uninstall section:<br />
<br />
Section &quot;Uninstall&quot;<br />
   !include &quot;$instdir\unifilelist.nsh&quot;<br />
SectionEnd<br />
<br />
I keep getting this error though:<br />
!include: could not find: &quot;$instdir\unifilelist.nsh&quot;<br />
<br />
The file is in the $instdir, if I remove $instdir and put in a hardcoded value everything works.<br />
<br />
For example this works:<br />
Section &quot;Uninstall&quot;<br />
   !include &quot;c:\somefolder\unifilelist.nsh&quot;<br />
SectionEnd<br />
<br />
How do I include variables in that !include directive?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">14th July 2008, 22:51</div></div><div class="posttext">&quot;!include&quot; is a preprocessor command, evaluated at compile time. But $INSTDIR is a variable, which will have a value only at runtime, when the installer is executed. You shouldn't mix that up! Define a symbol instead! Try like this:<br />
<br />
!define uninstfile &quot;c:\somefolder\unifilelist.nsh&quot;<br />
<br />
...<br />
<br />
Section &quot;Uninstall&quot;<br />
  !include &quot;${uninstfile}&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">patelb</div><div class="date">14th July 2008, 23:02</div></div><div class="posttext">But the file will be inside the install directory, and since the install directory will be different with each install is there a way to make this whole process dynamic?<br />
<br />
I cant do this either because it still gives me the same error:<br />
!define unfiles &quot;$instdir\unifilelist.nsh&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">14th July 2008, 23:14</div></div><div class="posttext">You can't include a .nsh file from the user's install directory! That's because the &quot;!include&quot; instruction is a preprocessor command that will be evaluated at the moment when you *compile* the installer! It will *not* be evaluated when the user runs the installer/uninstaller, like normal installer instructions. Therefore the &quot;!include&quot; command requires a path to some file on your local machine, which needs to be present at the moment when you *compile* your installer. Hope that is clear now!<br />
<br />
BTW: The same applies to all preprocessor commands. Those can be easily identified, because they start with a &quot;!&quot; character ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">patelb</div><div class="date">14th July 2008, 23:18</div></div><div class="posttext">Ok that makes sense.  What is norm in this situation then?  If people use a list of files to build the uninstall section, do they just hard code where that file will reside?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">14th July 2008, 23:24</div></div><div class="posttext">Originally posted by patelb <br />
Ok that makes sense.  What is norm in this situation then?  If people use a list of files to build the uninstall section, do they just hard code where that file will reside?  <br />
<br />
Either that, or you load the file names from a plain text file at *runtime* like this:<br />
<br />
Section &quot;Uninstall&quot;<br />
  ClearErrors<br />
  FileOpen $0 &quot;$INSTDIR\files.lst&quot; r<br />
  IfErrors done<br />
<br />
  Loop:<br />
    FileRead $0 $1<br />
    IfErrors LoopEnd<br />
    Delete &quot;$1&quot;<br />
    Goto Loop<br />
  LoopEnd:<br />
<br />
  FileClose $0<br />
  done:<br />
SectionEnd<br />
<br />
The &quot;files.lst&quot; would need to look like:<br />
<br />
C:\Program Files\Foobar Deluxe\File1.foo<br />
C:\Program Files\Foobar Deluxe\File2.foo<br />
C:\Program Files\Foobar Deluxe\File3.foo<br />
...<br />
<br />
The &quot;files.lst&quot; must be generated during install...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">patelb</div><div class="date">14th July 2008, 23:29</div></div><div class="posttext">Very clever!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">14th July 2008, 23:51</div></div><div class="posttext">Nevertheless, in most cases you will be fine with:<br />
<br />
Section &quot;Uninstall&quot;<br />
  RMDir /r /REBOOTOK &quot;$INSTDIR&quot;<br />
SectionEnd<br />
<br />
The variable $INSTDIR will contain the install directory selected by the user at *runtime* and it is available in both, the installer and uninstaller. The uninstaller code above will simply remove the entire Install folder including all files and subdirectories. Also all files added *after* install would be erased...<br />
<br />
For an advanced solution have a look at:<br />
http://nsis.sourceforge.net/Advanced_Uninstall_Log_NSIS_Header</div></div><hr />


<div class="post"><div class="posttop"><div class="username">patelb</div><div class="date">14th July 2008, 23:58</div></div><div class="posttext">I thought this was unsafe:<br />
<br />
_http://forums.winamp.com/showthread.php?s=&amp;threadid=289986</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">15th July 2008, 00:06</div></div><div class="posttext">Well, I'd say it's safe. In the uninstaller $INSTDIR will contain the path where the &quot;Uninstall.exe&quot; is located. That should be the Install folder of your application, otherwise your Uninstall.exe is mislocated! So as long as you don't expect the user to store any important files within your Install folder, it should be save to erase the $INSTDIR folder at uninstall. More subtle solutions can be implement using $INSTDIR, like &quot;Delete $INSTDIR\Bin\*.exe&quot;, instead of deleting the entire $INSTDIR folder. And if you want an advanced solution, see the link from my previous post...<br />
<br />
BTW: Are Hyperlinks in my posts visible to other users? :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">patelb</div><div class="date">15th July 2008, 00:30</div></div><div class="posttext">I can see them</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">15th July 2008, 00:39</div></div><div class="posttext">Good :)<br />
<br />
Also keep in mind that when you store *full* paths during install, the Uninstaller would fail horrible if the user renamed or moved the installer folder! Therefore I would use $INSTDIR in my uninstaller to avoid such problem. Even if you want to store all files in a text file and read that text file during uninstall, I would *not* use full paths (as shown in my example above). I would store paths *relative* to the $INSTDIR folder, so when the user moves or renames the Install folder, your uninstaller still works...<br />
<br />
Section &quot;Uninstall&quot;<br />
  ClearErrors<br />
  FileOpen $0 &quot;$INSTDIR\files.lst&quot; r<br />
  IfErrors done<br />
<br />
  Loop:<br />
    FileRead $0 $1<br />
    IfErrors LoopEnd<br />
    Delete &quot;$INSTDIR\$1&quot; ; &lt;- SEE HERE<br />
    Goto Loop<br />
  LoopEnd:<br />
<br />
  FileClose $0<br />
  done:<br />
SectionEnd<br />
<br />
File1.foo<br />
File2.foo<br />
Data\File3.foo<br />
Data\File4.foo<br />
Data\Stuff\File5.foo<br />
...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">patelb</div><div class="date">15th July 2008, 00:41</div></div><div class="posttext">That &quot;looping&quot; solution you gave me earlier, on the fileread command its reading the line break also.  So the delete command is not working properly.  Is there like a chomp function in nsis that will fix this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">15th July 2008, 00:44</div></div><div class="posttext">See &quot;NSIS\Docs\StrFunc\StrFunc.txt&quot; for info ;)<br />
<br />
Look out for ${StrTrimNewLines} :D<br />
<br />
<br />
<br />
Fixed code should look like:<br />
!include &quot;StrFunc.nsh&quot;<br />
${StrTrimNewLines}<br />
<br />
Section &quot;Uninstall&quot;<br />
  ClearErrors<br />
  FileOpen $0 &quot;$INSTDIR\files.lst&quot; r<br />
  IfErrors done<br />
<br />
  Loop:<br />
    FileRead $0 $1<br />
    IfErrors LoopEnd<br />
    ${StrTrimNewLines} $2 &quot;$1&quot; ; &lt;- Remove carriage returns<br />
    Delete &quot;$INSTDIR\$2&quot;<br />
    Goto Loop<br />
  LoopEnd:<br />
<br />
  FileClose $0<br />
  done:<br />
SectionEnd<br />
<br />
files.lst:<br />
File1.foo<br />
File2.foo<br />
Data\File3.foo<br />
Data\File4.foo<br />
Data\Stuff\File5.foo<br />
...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>