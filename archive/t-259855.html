<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" All users, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  All users NSIS Discussion" />
	
	<title> All users [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  All users</div>
<hr />
<div class="pda"><a href="t-259855.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259855">All users</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">f1nn</div><div class="date">18th November 2006, 13:59</div></div><div class="posttext">Hi <br />
<br />
I am installing my app first by checking the user has admin rights and if so proceeding with the install. the application works well if it is the admin logged on to windows XP. However when I change users to just an ordinary user as the application is loading I get the Windows error dialog box appearing. The normal one asking the user to send mesaage to microsoft. The application exits when I cancel the error box. Can anyone help me understand what may be causing this. I use the setShellContextVar all to set the application to all users. Any advice would be great as I dont fully understand what is causing this.<br />
<br />
<br />
Many thanks :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th November 2006, 14:14</div></div><div class="posttext">What exactly does the dialog box say? Click on &quot;more details&quot; and post the details here. Also post the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">f1nn</div><div class="date">20th November 2006, 12:33</div></div><div class="posttext">HI Kichik,<br />
Thanks for the reply I have attached a folder with two images of the error boxs. The section were I set it for all users is as follows I am new to this so would be thankful if you can show me if I am going wrong<br />
<br />
Thanks<br />
<br />
Section Acc_type<br />
<br />
	ClearErrors<br />
	UserInfo::GetName<br />
	IfErrors Win9x<br />
	Pop $0<br />
	UserInfo::GetAccountType<br />
	Pop $1<br />
	StrCmp $1 &quot;Admin&quot; 0 +2<br />
	;	MessageBox MB_OK 'User &quot;$0&quot; is in the Administrators group'<br />
		Goto Alluser<br />
	StrCmp $1 &quot;Power&quot; 0 +2<br />
	;	MessageBox MB_OK 'User &quot;$0&quot; is in the Power Users group'<br />
		Goto Alluser<br />
	StrCmp $1 &quot;User&quot; 0 +2<br />
	;	MessageBox MB_OK 'User &quot;$0&quot; is just a regular user'<br />
		Goto WrongPrivalage<br />
	StrCmp $1 &quot;Guest&quot; 0 +3<br />
	;	MessageBox MB_OK 'User &quot;$0&quot; is a guest'<br />
		Goto WrongPrivalage<br />
	MessageBox MB_OK &quot;Unknown error The installer will quit please contact your Administrator&quot;<br />
        Quit<br />
        ;Goto done<br />
<br />
	Win9x:<br />
		# This one means you don't need to care about admin or<br />
		# not admin because Windows 9x doesn't either The installer will quit<br />
		# if this error is thrown<br />
		MessageBox MB_OK &quot;Error! This DLL can't run under Windows 9x! \<br />
                Your System does not meet Minimum requirements&quot;<br />
                Quit<br />
<br />
        WrongPrivalage:<br />
        MessageBox MB_OK &quot;You do not have the correct privilages to install software on this machine. Contact you Network administrator\<br />
        $\nIf you are not part of a network reset your user account to allow you Administrator privilages&quot;<br />
        Quit  ; Wrong privilages quit the installer<br />
<br />
       Alluser:<br />
       SetShellVarContext all<br />
       <br />
         SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">f1nn</div><div class="date">20th November 2006, 12:40</div></div><div class="posttext">sorry here are the error images</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st November 2006, 18:40</div></div><div class="posttext">Is riverdocs.exe your installer? If so, try a vanilla version of NSIS instead of a privately built version. If that really solves the problem, I'd need a full script reproducing this problem and the build options you've used so I can fix the incompatibility with VS2005.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">f1nn</div><div class="date">22nd November 2006, 12:33</div></div><div class="posttext">Hi Kichik,<br />
Riverdocs.exe is the installer and I am usign a standard MUI setup script. I have found that it is a permissions problem, If the install folder C:\Program Files\ MY APP is read only this causes the problem. If it is not read only it appears to be ok. I have been trying to setFileAttributes to set the attributes to normal what I am trying to doing is, using the NSIS get parent function get the Riverdocs folder as the parent, if I check this $R0 is C:\Program Files\Riverdocs I then use the getfile Attributes command like this ${GetFileAttributes} &quot;C:\Program Files\RiverDocs&quot; &quot;ALL&quot; $Var Then I am hoping to use setfileAttributes $var normal I thought I could have just used the setfileattributes command with out the getfileattributes. would that be OK. When I use the getfilesattributes command I get the error invalid command. I have used !include &quot;FileFunc.nsh&quot;<br />
would that be right? or do I need to insert anything else. I am proberly not using thse commands right and have tryed to follow them to the letter from the help documentation so can you explain where I am going wrong. It is not the best solution to make the folder writable rather than read only but should work as a temporary fix, would apprecipate your help on this,<br />
<br />
Many thanks<br />
<br />
N</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd November 2006, 18:01</div></div><div class="posttext">I'm sorry, I have misread your original post. You said it was your program that crashed when switching to a normal user and not the installer.<br />
<br />
That's a problem with your program which probably tries to write the Program Files directory and doesn't check for failure. When running under a normal user, you can't write to that folder and shouldn't be able to. You shouldn't set the permissions to enable this. Instead, you should modify your program so it uses the Application Data directory. To get that directory, use SHGetSpecialFolderLocation (http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/functions/shgetspecialfolderlocation.asp?frame=true) or SHGetFolderPath (http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/reference/functions/shgetfolderpath.asp?frame=true) with shfolder.dll (http://www.microsoft.com/downloads/release.asp?releaseid=30340).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>