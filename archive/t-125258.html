<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Detect Free RAM?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Detect Free RAM? NSIS Discussion" />
	
	<title> Detect Free RAM? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Detect Free RAM?</div>
<hr />
<div class="pda"><a href="t-125258.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125258">Detect Free RAM?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">16th February 2003, 16:11</div></div><div class="posttext">How can we detect free RAM in the end-user machine? :weird:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th February 2003, 17:49</div></div><div class="posttext">System does it again :D<br />
<br />
System::Alloc 32<br />
Pop $1<br />
System::Call &quot;Kernel32::GlobalMemoryStatus(i) v (r1)&quot;<br />
System::Call &quot;*$1(&amp;i4 .r2, &amp;i4 .r3, &amp;i4 .r4, \<br />
  &amp;i4 .r5, &amp;i4 .r6, &amp;i4.r7, &amp;i4 .r8, &amp;i4 .r9)&quot;<br />
System::Free $1<br />
DetailPrint &quot;Structure size (useless): $2 Bytes&quot;<br />
DetailPrint &quot;Memory load: $3%&quot;<br />
DetailPrint &quot;Total physical memory: $4 Bytes&quot;<br />
DetailPrint &quot;Free physical memory: $5 Bytes&quot;<br />
DetailPrint &quot;Total page file: $6 Bytes&quot;<br />
DetailPrint &quot;Free page file: $7 Bytes&quot;<br />
DetailPrint &quot;Total virtual: $8 Bytes&quot;<br />
DetailPrint &quot;Free virtual: $9 Bytes&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">16th February 2003, 17:55</div></div><div class="posttext">thanks !!!!<br />
<br />
:eek: didnÂ´t know that trick :eek:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">liquidmotion</div><div class="date">16th February 2003, 19:26</div></div><div class="posttext">in mirc, just type /stat :)<br />
<br />
oh wait, you need moo.dll :P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">17th February 2003, 01:07</div></div><div class="posttext">Ok, try everything..... but how can we convert to MB in Nsis,<br />
because the $4 return in Bytes ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th February 2003, 13:23</div></div><div class="posttext">This one for example:<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=78</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">17th February 2003, 21:14</div></div><div class="posttext">jejeje...yeah...IntOp... does it !!!!<br />
<br />
Thanks :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">18th February 2003, 04:50</div></div><div class="posttext">I love system.dll.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">testtube</div><div class="date">6th February 2008, 08:01</div></div><div class="posttext">Old thread but I was trying to figure out how to determine how to detect the amount of system memory at install time and came across this via google.<br />
<br />
This was very useful and got me on the right track.  Most of our install targets are 64 bit systems so I needed a solution that could handle this (not 32 bit integer limited) and found I needed to use GlobalMemoryStatusEX (http://msdn2.microsoft.com/en-us/library/aa366589(VS.85).aspx)  instead of GlobalMemoryStatus (http://msdn2.microsoft.com/en-us/library/aa366586(VS.85).aspx) .  One key difference is that the structure passed to GlobalMemoryStatusEx, MEMORYSTATUSEX (http://msdn2.microsoft.com/en-us/library/aa366770(VS.85).aspx), must have the structure size set (This isn't necessary with GlobalMemoryStatus and MEMORYSTATUS (http://msdn2.microsoft.com/en-us/library/aa366772(VS.85).aspx).  If anyone's interested here's the code I used:<br />
<br />
<br />
  ## allocate<br />
  System::Alloc 64<br />
  Pop $0<br />
  ## set<br />
  # GlobalMemoryStatusEx requires structure size to set in <br />
  # MEMORYSTATUSEX instance passed in as argument<br />
  System::Call &quot;*$0(i 64, i 0, l 0, l 0, l 0, l 0, l 0, l 0, l 0)&quot;<br />
  ## call<br />
  System::Call &quot;Kernel32::GlobalMemoryStatusEx(i r0)&quot;<br />
  ## get<br />
  System::Call &quot;*$0(i.r1, i.r2, l.r3, l.r4, l.r5, l.r6, l.r7, l.r8, l.r9)&quot;<br />
  ## free<br />
  System::Free $0<br />
  ## print<br />
  DetailPrint &quot;Structure size: $1 bytes&quot;<br />
  DetailPrint &quot;Memory load: $2%&quot;<br />
  DetailPrint &quot;Total physical memory: $3 bytes&quot;<br />
  DetailPrint &quot;Free physical memory: $4 bytes&quot;<br />
  DetailPrint &quot;Total page file: $5 bytes&quot;<br />
  DetailPrint &quot;Free page file: $6 bytes&quot;<br />
  DetailPrint &quot;Total virtual: $7 bytes&quot;<br />
  DetailPrint &quot;Free virtual: $8 bytes&quot;<br />
  DetailPrint &quot;Free extended virtual: $9 bytes&quot;<br />
<br />
<br />
I thought this might save someone some time.<br />
<br />
I apologize it it's poor etiquette to dredge up old threads.  Every forum seems to have different rules...<br />
<br />
edit:<br />
The URLs posted above were function and structure names with links to Microsoft's MSDN docs.  Right now all I see is &quot;URL submitted by user&quot;  Sorry if this makes the post unreadable..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2008, 19:38</div></div><div class="posttext">You should add this code to the Wiki page:<br />
http://nsis.sourceforge.net/Determining_free_memory_using_the_System_plugin<br />
<br />
And here are the links again so everyone can read them.<br />
<br />
First link to GlobalMemoryStatusEx:<br />
http://msdn2.microsoft.com/en-us/library/aa366589(VS.85).aspx<br />
<br />
Second link to GlobalMemoryStatus:<br />
http://msdn2.microsoft.com/en-us/library/aa366586(VS.85).aspx<br />
<br />
Third link to MEMORYSTATUSEX:<br />
http://msdn2.microsoft.com/en-us/library/aa366770(VS.85).aspx<br />
<br />
Fourth link to MEMORYSTATUS:<br />
http://msdn2.microsoft.com/en-us/library/aa366772(VS.85).aspx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">testtube</div><div class="date">7th February 2008, 23:08</div></div><div class="posttext">Just a heads up...<br />
<br />
If you are going to manipulate values returned from the output of GlobalMemoryStatusEX use Math::Script instead of IntOp.  IntOp functionality appears to be limited to signed 4 byte integers...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">7th February 2008, 23:42</div></div><div class="posttext">the system plugin has Int64Op</div></div><hr />


<div class="post"><div class="posttop"><div class="username">testtube</div><div class="date">7th February 2008, 23:54</div></div><div class="posttext">the system plugin has Int64Op <br />
<br />
Excellent! Math::Script seemed a little too heavy weight for my needs...<br />
<br />
Also, you may want to change your sig to Int64Op $PostCount $PostCount + 1 as your post count reaches  2^(32-1)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">qwerty53</div><div class="date">11th February 2008, 19:45</div></div><div class="posttext">on 64bit The following code <br />
  System::Alloc 32<br />
  Pop $1<br />
  System::Call &quot;Kernel32::GlobalMemoryStatus(i) v (r1)&quot;<br />
  System::Call &quot;*$1(&amp;i4 .r2, &amp;i4 .r3, &amp;i4 .r4, &amp;i4 .r5, \<br />
                    &amp;i4 .r6, &amp;i4.r7, &amp;i4 .r8, &amp;i4 .r9)&quot;<br />
  System::Free $1<br />
  <br />
  ; $5 =&gt; Free RAM<br />
  ; $4 =&gt; Total RAM<br />
  IntOp $R5 $5 / 1048576 ; 1048576 = 1024*1024, or MegaX<br />
  IntOp $R4 $4 / 1048576 ; 1048576 = 1024*1024, or MegaX<br />
  MessageBox MB_OK &quot;R5: $R5   5: $5   R4: $R4   4: $4&quot;<br />
<br />
gives this (also picture attached):<br />
R5: -813  5: -852815872  R4: -256  4: -269082624<br />
<br />
the real total memory is: 3.75GB of RAM<br />
<br />
How do I make this work for a 64 bit system?<br />
if pissible hoe to make one coade to work for both 64bit and 32bit?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">testtube</div><div class="date">12th February 2008, 04:04</div></div><div class="posttext">Have you read the entire thread?  I would guess &quot;no&quot;...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">qwerty53</div><div class="date">12th February 2008, 17:22</div></div><div class="posttext">Hi,<br />
Sorry for not reading the thread :-).<br />
So after this code:<br />
<br />
System::Alloc 64<br />
  Pop $0<br />
  ## set<br />
  # GlobalMemoryStatusEx requires structure size to set in <br />
  # MEMORYSTATUSEX instance passed in as argument<br />
  System::Call &quot;*$0(i 64, i 0, l 0, l 0, l 0, l 0, l 0, l 0, l 0)&quot;<br />
  ## call<br />
  System::Call &quot;Kernel32::GlobalMemoryStatusEx(i r0)&quot;<br />
  ## get<br />
  System::Call &quot;*$0(i.r1, i.r2, l.r3, l.r4, l.r5, l.r6, l.r7, l.r8, l.r9)&quot;<br />
  ## free<br />
  System::Free $0<br />
  <br />
  MessageBox MB_OK &quot;TotalRAM: $3  FreeRAM: $4&quot;<br />
  IntOp $vTotalRAMtemp $3 * 1<br />
  IntOp $vTotalRAM $vTotalRAMtemp / 1<br />
  <br />
  <br />
  MessageBox MB_OK &quot;TotalRAM: $vTotalRAM&quot;<br />
  ; $4 =&gt; Free RAM<br />
  ; $3 =&gt; Total RAM<br />
  <br />
  IntOp $vTotalRAM $3 / 1048576 ; 1048576 = 1024*1024, or MegaX<br />
  IntOp $vFreeRAM $4 / 1048576 ; 1048576 = 1024*1024, or MegaX<br />
  MessageBox MB_OK &quot;vTotalRAM: $vTotalRAM&quot;<br />
<br />
<br />
on a 64 bit machine I get: -262776<br />
if I printout the $3 it gives the right value in bytes: 4025884672.<br />
in fact I get negative number even if I do $3 +1<br />
<br />
thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">testtube</div><div class="date">12th February 2008, 17:58</div></div><div class="posttext">In posts subsequent to the GlobalMemoryStatusEX post you'll find that you need to use System::Int64Op to do 64 bit math.<br />
<br />
My code looks like:<br />
<br />
<br />
  System::Alloc 64<br />
  Pop $0<br />
  System::Call &quot;*$0(i 64)&quot;<br />
  System::Call &quot;Kernel32::GlobalMemoryStatusEx(i r0)&quot;<br />
  System::Call &quot;*$0(i, i, l.r1, l, l, l, l, l, l)&quot;<br />
  System::Free $0<br />
  ; convert bytes to megabytes<br />
  System::Int64Op $1 / 1048576<br />
  Pop $1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">qwerty53</div><div class="date">12th February 2008, 20:05</div></div><div class="posttext">THANKS ALOT!!!!!!!!!!!!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>