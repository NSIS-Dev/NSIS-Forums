<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstall info and MultiUser.nsh, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstall info and MultiUser.nsh NSIS Discussion" />
	
	<title> Uninstall info and MultiUser.nsh [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstall info and MultiUser.nsh</div>
<hr />
<div class="pda"><a href="t-289071.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289071">Uninstall info and MultiUser.nsh</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">26th March 2008, 17:59</div></div><div class="posttext">Having read MultiUser/readme.html until I'm blue in the face, I still can't work out how one is supposed to get an installer to set up uninstall info in the registry ... HKCU for a 'current user 'install and HKLM for an 'all users' install. The documentation barely touches on what one might need to do in an uninstall script.<br />
<br />
At least, this seems to be handled automatically for $INSTDIR, but what I'm trying to do is to get the startmenu folder name selected by the user during install -- commonly known as $ICONS_GROUP -- so that I can delete the shortcuts to the application during uninstall.<br />
<br />
I'm aware of the bug in which HKLM and HKCU are transposed, that's not the problem.<br />
<br />
Is there a worked example anywhere showing how to put MultiUser.nsh through its paces for both install and uninstall?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">27th March 2008, 11:35</div></div><div class="posttext">Originally posted by Daniel James <br />
... this seems to be handled automatically for $INSTDIR ...<br />
Oh, no, it isn't. $INSTDIR is just getting set to the directory from which uninst.exe is run ...<br />
<br />
The installer contains the following definitions and section:<br />
<br />
!define PRODUCT_NAME &quot;My Application&quot;<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define PRODUCT_UNINST_ROOT_KEY &quot;HKLM&quot;<br />
<br />
...<br />
<br />
Section -Post<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot; &quot;$INSTDIR\VA32.EXE&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\MyApp.EXE&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
SectionEnd<br />
<br />
... which works when the installer is run by an administrator, but because it uses HKLM) not when run by a normal user. How do I rewrite this using MultiUser.nsh?<br />
<br />
Once I have that working it should be trivial to store the $ICONS_GROUP string in the registry as well, so I can recover it during uninstall.<br />
<br />
It looks as though MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_KEY and MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_VALUENAME are what I need here ... but I have no idea how to use them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">27th March 2008, 16:54</div></div><div class="posttext">http://forums.winamp.com/showthread.php?threadid=288468</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">27th March 2008, 18:54</div></div><div class="posttext">Originally posted by Joost Verburg <br />
http://forums.winamp.com/showthread.php?threadid=288468 <br />
Well, yes, thanks ... but I did search the forums and I have read that thread several times.<br />
<br />
I presume one sets up definitions like these:<br />
<br />
!define MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
!define MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_VALUENAME &quot;InstallLocation&quot;<br />
<br />
(or something similar ... and does one need an extra '\\' at the end of the key?)<br />
<br />
... but what then? How exactly does MultiUser.nsh use these values? How can I make use of this mechanism in my script to manage different values under the same (or a different) key?<br />
<br />
I have been trying to follow the source of MultiUer.nsh to see just what it does, but NSIS script language isn't the most readable language in the world (especially to a relative beginner). <br />
<br />
Googling for &quot;MULTIUSER_INSTALLMODE_INSTDIR_REGISTRY_KEY&quot; produces precisely two hits, one to the MultiUser readme file and one to a boardreader.com page that doesn't appear to contain that string ... the web knows of no other documentation and no examples. How does one use this feature?<br />
<br />
Inquiring minds are keen to learn.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">29th March 2008, 14:56</div></div><div class="posttext">For the uninstall info use SHELL_CONTEXT instead of HKLM. In addition, add the /CurrentUser or /AllUsers command-line switch to your uninstaller location.<br />
<br />
You also need to set MULTIUSER_INSTALLMODE_COMMANDLINE.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>