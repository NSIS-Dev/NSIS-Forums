<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" return values from the uninstaller, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  return values from the uninstaller NSIS Discussion" />
	
	<title> return values from the uninstaller [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  return values from the uninstaller</div>
<hr />
<div class="pda"><a href="t-250949.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=250949">return values from the uninstaller</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">12th July 2006, 17:53</div></div><div class="posttext">Hi all,<br />
<br />
In case my product is already installed, I run from my installer first the uninstaller and then if this one finishes successfully I continue then with the installation.<br />
<br />
So, I need to check if the uninstaller finished successfully. For this I'm doing the following:<br />
<br />
...<br />
ReadRegStr $UninstString ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot;<br />
HideWindow<br />
ClearErrors<br />
ExecWait '$UninstString _?=$INSTDIR'<br />
IfErrors 0 uninstallDone1_ReinstallValidateSelection<br />
  GetErrorLevel $0 ; check the return error value from the uninstaller<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;ERROR in uninstaller: $0&quot;<br />
...<br />
<br />
<br />
Questions:<br />
1) If there is failure I always see in my msgbox that the uninstaller returned -1, even if in the uninstaller I do before quiting<br />
<br />
SetErrorLevel 2<br />
<br />
Why do I always see the $0 being -1?<br />
2) In help in &quot;D.1 Error Levels&quot; is written: &quot;1 - Installation aborted by user (cancel button)&quot;. But with the procedure above what I notice is that regardless from what page I chose cancel (default NSIS page, or custom page) the value showed in the msgbox is always -1. Why is that?<br />
3) If I quit the uninstaller in a custom page function the return value is success, but if I quit from the uninstall section I get failure (-1). Why the different behaviour when Quit is called in the uninstall section and in the custom-pages-functions?<br />
4) In help in &quot;4.9.1.1 Delete&quot; is written: &quot;The error flag is set if files are found and cannot be deleted.&quot;. But I tried that by doing in the uninstaller:<br />
<br />
Delete /REBOOTOK &quot;$INSTDIR\momo.exe&quot;<br />
<br />
and momo.exe was in use while running the setup and with the very above code (msgbox) I get success, so the uninstaller didn't return error, even though the file was not deleted b/c was in use. Why diff behaviour than what's written in help?<br />
<br />
Thx,<br />
Viv</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th July 2006, 18:00</div></div><div class="posttext">You should check the exit code of the uninstaller with:<br />
ExecWait '$UninstString _?=$INSTDIR' $R0<br />
<br />
$R0 will now contain the exit code.<br />
<br />
Execute the specified program and wait for the executed process to quit. See Exec for more information. If no output variable is specified ExecWait sets the error flag if the program executed returns a nonzero error code, or if there is an error. If an output variable is specified, ExecWait sets the variable with the exit code (and only sets the error flag if an error occurs; if an error occurs the contents of the user variable are undefined).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">12th July 2006, 19:08</div></div><div class="posttext">Ahh, thx for the tip! Nevertheless this would explain only the problem 1 and 2, but not the 3 and 4 I described in my first entry, right?<br />
<br />
Thx,<br />
Viv</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th July 2006, 19:10</div></div><div class="posttext">3) The installer hasn't failed if you Quit on a page, because you haven't installed anything yet. Surely that makes sense?<br />
<br />
4) What does IfErrors show?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">13th July 2006, 11:21</div></div><div class="posttext">3) The installer hasn't failed if you Quit on a page, because you haven't installed anything yet. Surely that makes sense?<br />
<br />
<br />
No, what I ment is: in the UNinstaller I have somewhere a custom page. If in the function of this custom page I call Quit, the return value of the whole uninstaller is success. But if I call Quit in the Section Uninstall, the return value of the whole uninstaller is -1.<br />
In both cases I'm already in the uninstall procedure so I don't understand why different results.<br />
<br />
<br />
<br />
4) What does IfErrors show?<br />
<br />
no errors, which is different than what's written in the help. Seems Comperio got to the same result in: http://forums.winamp.com/showthread.php?s=&amp;postid=1984276#post1984276<br />
<br />
Thx,<br />
Viv</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th July 2006, 13:05</div></div><div class="posttext">3) No. You aren't uninstalling until you reach the UninstFiles page.<br />
<br />
4) This could be a bug. On the NSIS project page (http://www.sf.net/projects/nsis) please post a bug on the tracker.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">14th July 2006, 16:37</div></div><div class="posttext">3) No. You aren't uninstalling until you reach the UninstFiles page.<br />
<br />
<br />
ahh, got it :) Thx!<br />
<br />
<br />
4) This could be a bug. On the NSIS project page (http://www.sf.net/projects/nsis) please post a bug on the tracker.<br />
<br />
I would preffer to see first what is kichik answering to your reply from: here (http://forums.winamp.com/showthread.php?s=&amp;postid=1984276)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>