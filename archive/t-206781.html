<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Bug in CopyFiles, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Bug in CopyFiles NSIS Discussion" />
	
	<title> Bug in CopyFiles [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Bug in CopyFiles</div>
<hr />
<div class="pda"><a href="t-206781.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=206781">Bug in CopyFiles</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">3rd February 2005, 18:02</div></div><div class="posttext">I have found a bug in CopyFiles, which I can reproduce with NSIS 2.0 and NSIS 2.04 (makensis.exe from makensis204_log.zip): obviously, this command does not properly handle filenames with more than one extension ('filename.ext.ext'). <br />
<br />
I want to copy two files 'lang.german.gmt' and 'lang.english.gmt' with <br />
<br />
CopyFiles /SILENT &quot;${DSTDIR}\SPBackup\*.*&quot; &quot;${DSTDIR}&quot;<br />
<br />
After this, the Errorflag is set and one file (probably the one, which was copied at first) got the name 'lang.gmt'. <br />
<br />
The other one was not copied. Apparently the command stopped after this, because there were several 'normal' files in other subdirectories, which should have been copied by this statemant too.<br />
<br />
This is not a problem with long filenames because it works with 'langgerman.gmt' and 'langenglish.gmt' !<br />
<br />
I am using WinXP/SP1.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd February 2005, 19:16</div></div><div class="posttext">CopyFiles simply calls the shell copying function. It's the same as using Explorer to do that copy operation. Does it work for you with Explorer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">3rd February 2005, 19:34</div></div><div class="posttext">It does work with the explorer. <br />
<br />
And CopyFiles works just as expected when _not_ using multiple extensions: it copies the contents of the folder (including all subfolders, although somebody affirmed something else (joost?), when a /r-option was requested in another thread). CopyFiles even replaces existing files/folders without Errorflag, which is exactly what I need.<br />
<br />
Some idea ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd February 2005, 19:59</div></div><div class="posttext">The following code works fine for me:CreateDirectory $TEMP\copyfilestest\2<br />
FileOpen $0 $TEMP\copyfilestest\lang.english.gmt w<br />
FileClose $0<br />
FileOpen $0 $TEMP\copyfilestest\lang.german.gmt w<br />
FileClose $0<br />
CopyFiles $TEMP\copyfilestest\*.* $TEMP\copyfilestest\2What exactly do you mean by multiple extensions? I don't see anything in your example related to that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd February 2005, 20:34</div></div><div class="posttext">I think he means that it has more than one dot in it.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd February 2005, 20:37</div></div><div class="posttext">Indeed, but the CopyFiles instruction in the first post simply uses *.*, and that works, as shown in my example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd February 2005, 21:03</div></div><div class="posttext">Could you make an cut-down example script which reproduces this error?<br />
I can't get the error to occur using the code you attached in the first post.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">4th February 2005, 12:58</div></div><div class="posttext">here is an example. I hope it helps...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th February 2005, 13:20</div></div><div class="posttext">All of the examples work completely fine for me. There are no errors and the results are as expected. MSDN doesn't describe any SHFileOperation flags related to truncating file names. The difference between Explorer and CopyFiles might be the usage of *.* in CopyFiles. Try copying file by file with CopyFiles and see if it happens.<br />
<br />
This shell behavior might be caused by a malfunctioning shell extension. Try removing any shell extensions you've installed lately. I'd also run some anti adware/spyware software to make sure it's not caused by that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">4th February 2005, 15:13</div></div><div class="posttext">@kichik:<br />
<br />
Did you check the filenames in the 'Lang' directories ?<br />
<br />
here is my dir *.gmt /s:<br />
<br />
 Verzeichnis von D:\CopyFiles\Go\Lang<br />
<br />
04.02.2005  11:17                 9 langengl.gmt<br />
04.02.2005  11:17                 8 langgerm.gmt<br />
               2 Datei(en)             17 Bytes<br />
<br />
 Verzeichnis von D:\CopyFiles\Go\SPBackup\Lang<br />
<br />
04.02.2005  11:17                 9 langenglish.gmt<br />
04.02.2005  11:17                 8 langgerman.gmt<br />
               2 Datei(en)             17 Bytes<br />
<br />
 Verzeichnis von D:\CopyFiles\noGo\Lang<br />
<br />
04.02.2005  11:17                 9 lang.gmt<br />
               1 Datei(en)              9 Bytes<br />
<br />
 Verzeichnis von D:\CopyFiles\noGo\SPBackup\Lang<br />
<br />
04.02.2005  11:17                 9 lang.english.gmt<br />
04.02.2005  11:17                 8 lang.german.gmt<br />
               2 Datei(en)             17 Bytes<br />
<br />
 Verzeichnis von D:\CopyFiles\Swap\Lang<br />
<br />
04.02.2005  11:17                 9 english.gmt<br />
04.02.2005  11:17                 8 german.gmt<br />
               2 Datei(en)             17 Bytes<br />
<br />
 Verzeichnis von D:\CopyFiles\Swap\SPBackup\Lang<br />
<br />
04.02.2005  11:17                 9 english.lang.gmt<br />
04.02.2005  11:17                 8 german.lang.gmt<br />
               2 Datei(en)             17 Bytes<br />
<br />
I get the same results without virusscanner, firewall,  database and other background tools. <br />
<br />
The results are similar with W2k, SP4, English. The difference here is that for 'noGo' both files could be copied as lang.gmt and lang1.gmt.<br />
<br />
A test on a NT4-VM gave errors for all 3 cases: not a single file could be copied.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th February 2005, 15:20</div></div><div class="posttext">Works fine with XP, but it started making up weird names with 98. I'll take a look later, after 2.05 is completely released.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">4th February 2005, 15:46</div></div><div class="posttext">@kichik: Thanks. <br />
<br />
Anybody else, who can confirm my problem on nt/2k/xp-machines ?<br />
<br />
By the way, I've found a workaround for the problem: <br />
<br />
Everything will work fine, when using absolute paths for ${SRCDIR}.<br />
<br />
Thus, if you change<br />
<br />
!define SRCDIR . ; same dir like copyfile.exe<br />
<br />
to<br />
<br />
!define SRCDIR d:\copyfiles\go<br />
   OR<br />
!define SRCDIR d:\copyfiles\nogo<br />
   OR<br />
!define SRCDIR d:\copyfiles\swap       <br />
<br />
in the 3 scripts, there will be no errors (tested with XP). It helps me, because this was my first idea to set the SrcDir at runtime. Using '.' was only a quick solution, for testing this piece of code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th February 2005, 16:34</div></div><div class="posttext">Right, probably has something to do with:You should use fully-qualified path names with this function. Using it with relative path names is not thread-safe.I do not know how it gets from non-fully-qualified path names to weird name changes, but I see nothing else about it in MSDN. I'll add a warning to the documentation.<br />
<br />
[EDIT]<br />
<br />
There's also:These names must be fully qualified paths.andUse only fully-qualified paths. Using relative paths will have unpredictable results.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">niteflyer</div><div class="date">4th February 2005, 17:21</div></div><div class="posttext">!define SRCDIR $EXEDIR ; same dir like copyfile.exe<br />
<br />
is better for the demoscript, if $EXEDIR is guaranteed to be fully-qualified. And I should have used DSTDIR instead of SRCDIR, that's a bit irritating. With this change the script works for all 3 examples.<br />
<br />
Have a nice weekend...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>