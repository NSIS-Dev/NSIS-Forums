<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Stack in plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Stack in plugin NSIS Discussion" />
	
	<title> Stack in plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Stack in plugin</div>
<hr />
<div class="pda"><a href="t-222437.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=222437">Stack in plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">25th July 2005, 12:54</div></div><div class="posttext">Wanted to use own plugin stack for data saving, but can't figure it out. nError=1, after pushstring_dll.<br />
<br />
#include &lt;windows.h&gt;<br />
#include &lt;iostream.h&gt;<br />
#define NSIS_MAX_STRLEN 1024<br />
<br />
typedef struct _stack_t_dll {<br />
	struct _stack_t_dll *next;<br />
	char text[NSIS_MAX_STRLEN];<br />
} stack_t_dll;<br />
<br />
stack_t_dll **g_stacktop;<br />
int g_stringsize=NSIS_MAX_STRLEN;<br />
//g_stacktop=???;<br />
<br />
int popstring_dll(char *str);<br />
void pushstring_dll(char *str);<br />
<br />
void main()<br />
{<br />
	char szResult[1024]=&quot;&quot;;<br />
	int nError;<br />
<br />
	pushstring_dll(&quot;xxx&quot;);<br />
	nError=popstring_dll(szResult);<br />
<br />
	cout &lt;&lt; &quot;szResult={&quot;&lt;&lt; szResult &lt;&lt;&quot;} (&quot;&lt;&lt; nError &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
}<br />
<br />
int popstring_dll(char *str)<br />
{<br />
	stack_t_dll *th;<br />
	if (!g_stacktop || !*g_stacktop) return 1;<br />
	th=(*g_stacktop);<br />
	lstrcpy(str,th-&gt;text);<br />
	*g_stacktop = th-&gt;next;<br />
	GlobalFree((HGLOBAL)th);<br />
	return 0;<br />
}<br />
<br />
void pushstring_dll(char *str)<br />
{<br />
	stack_t_dll *th;<br />
	if (!g_stacktop) return;<br />
	th=(stack_t_dll*)GlobalAlloc(GPTR,sizeof(stack_t_dll)+g_stringsize);<br />
	lstrcpyn(th-&gt;text,str,g_stringsize);<br />
	th-&gt;next=*g_stacktop;<br />
	*g_stacktop=th;<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">25th July 2005, 14:50</div></div><div class="posttext">Well... normally you can do that in pure C++<br />
<br />
#include &lt;iostream&gt;<br />
<br />
class Stack<br />
{<br />
public:<br />
	Stack();<br />
	~Stack();<br />
	void Push(const std::string&amp;);<br />
	int Pop(std::string&amp;);<br />
private:<br />
	std::string s;<br />
};<br />
<br />
Stack::Stack()<br />
{<br />
	s = &quot;&quot;;<br />
}<br />
Stack::~Stack()<br />
{<br />
	s = &quot;&quot;;<br />
}<br />
void Stack::Push(const std::string&amp; str)<br />
{<br />
	s = str;<br />
}<br />
int Stack::Pop(std::string&amp; buff)<br />
{<br />
	if (s.empty()) return 0;<br />
	buff = s;<br />
	s = &quot;&quot;;<br />
	return 1;<br />
}<br />
<br />
int main()<br />
{<br />
	using namespace std;<br />
	Stack stack;<br />
	string buff1, buff2;<br />
	int nError = 0;<br />
	stack.Push(&quot;nsis&quot;);<br />
	nError = stack.Pop(buff1);<br />
	//0 = empty<br />
	//1 = not empty<br />
	cout &lt;&lt; &quot;Code: &quot; &lt;&lt; nError &lt;&lt; &quot;\nStack: &quot; &lt;&lt; buff1.c_str() &lt;&lt; endl;<br />
	nError = stack.Pop(buff2);<br />
	cout &lt;&lt; &quot;Code: &quot; &lt;&lt; nError &lt;&lt; &quot;\nStack: &quot; &lt;&lt; buff2.c_str() &lt;&lt; endl;<br />
	stack.Push(&quot;nsis2.08&quot;);<br />
	nError = stack.Pop(buff2);<br />
	cout &lt;&lt; &quot;Code: &quot; &lt;&lt; nError &lt;&lt; &quot;\nStack: &quot; &lt;&lt; buff2.c_str() &lt;&lt; endl;<br />
<br />
	// wait until a keypress to exit<br />
	cin.get();<br />
	return 0;<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">26th July 2005, 09:36</div></div><div class="posttext">Thank you Joel!  Work great, but I still wanted to find &quot;C&quot; solution (point of principle :) )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">26th July 2005, 11:04</div></div><div class="posttext">At last:<br />
<br />
<br />
#include &lt;windows.h&gt;<br />
#include &lt;iostream.h&gt;<br />
<br />
#define NSIS_MAX_STRLEN 1024<br />
<br />
typedef struct _stack_dll {<br />
	struct _stack_dll *next;<br />
	char string[NSIS_MAX_STRLEN];<br />
} stack_dll;<br />
<br />
stack_dll *pStackTop;<br />
<br />
int popstring_dll(char *str);<br />
void pushstring_dll(char *str);<br />
<br />
void main()<br />
{<br />
	char szResult1[1024]=&quot;&quot;;<br />
	char szResult2[1024]=&quot;&quot;;<br />
	int nError1;<br />
	int nError2;<br />
<br />
	pushstring_dll(&quot;xxx&quot;);<br />
	pushstring_dll(&quot;YYY&quot;);<br />
	nError1=popstring_dll(szResult1);<br />
	nError2=popstring_dll(szResult2);<br />
<br />
	cout &lt;&lt; &quot;szResult={&quot;&lt;&lt; szResult1 &lt;&lt;&quot;} (&quot;&lt;&lt; nError1 &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
	cout &lt;&lt; &quot;szResult={&quot;&lt;&lt; szResult2 &lt;&lt;&quot;} (&quot;&lt;&lt; nError2 &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
}<br />
<br />
void pushstring_dll(char *str)<br />
{<br />
	stack_dll *pStackNew;<br />
	pStackNew=(stack_dll*)GlobalAlloc(GPTR, sizeof(stack_dll));<br />
	lstrcpyn(pStackNew-&gt;string, str, NSIS_MAX_STRLEN);<br />
	pStackNew-&gt;next=pStackTop;<br />
	pStackTop=pStackNew;<br />
}<br />
<br />
int popstring_dll(char *str)  //0 on success, 1 on empty stack<br />
{<br />
	stack_dll *pStackTemp;<br />
	if (!pStackTop) return 1;<br />
	pStackTemp=pStackTop;<br />
	lstrcpy(str, pStackTemp-&gt;string);<br />
	pStackTop=pStackTemp-&gt;next;<br />
	GlobalFree((HGLOBAL)pStackTemp);<br />
	return 0;<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">26th July 2005, 17:03</div></div><div class="posttext">I found it interesting to playing with chain of structures.<br />
<br />
Standart NSIS stack functions: push_front, pop_front;<br />
Other stack functions: push_back, stack_read, stack_size.<br />
<br />
<br />
#include &lt;windows.h&gt;<br />
#include &lt;iostream.h&gt;<br />
<br />
#define NSIS_MAX_STRLEN 1024<br />
<br />
typedef struct _stack_dll {<br />
	struct _stack_dll *next;<br />
	char string[NSIS_MAX_STRLEN];<br />
} stack_dll;<br />
<br />
stack_dll *pStackFirst;<br />
stack_dll *pStackTop;<br />
<br />
void push_back(char *str);<br />
void push_front(char *str);<br />
int pop_front(char *str);<br />
int stack_read(char *str, int index);<br />
int stack_size();<br />
<br />
void main()<br />
{<br />
	char szRes1[1024],szRes2[1024],szRes3[1024],szRes4[1024],szRes5[1024]=&quot;&quot;;<br />
	char szRead[1024]=&quot;&quot;;<br />
	int nEr1,nEr2,nEr3,nEr4,nEr5;<br />
	int nErRead;<br />
	int nSize;<br />
<br />
	push_back(&quot;1a&quot;);<br />
	push_back(&quot;2a&quot;);<br />
	push_back(&quot;3a&quot;);<br />
	push_front(&quot;4a&quot;);<br />
<br />
	nErRead=stack_read(szRead, 2);<br />
<br />
	nSize=stack_size();<br />
<br />
	nEr1=pop_front(szRes1);<br />
	nEr2=pop_front(szRes2);<br />
	nEr3=pop_front(szRes3);<br />
	nEr4=pop_front(szRes4);<br />
	nEr5=pop_front(szRes5);<br />
<br />
	cout &lt;&lt; &quot;szRes1={&quot;&lt;&lt; szRes1 &lt;&lt;&quot;} (&quot;&lt;&lt; nEr1 &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
	cout &lt;&lt; &quot;szRes2={&quot;&lt;&lt; szRes2 &lt;&lt;&quot;} (&quot;&lt;&lt; nEr2 &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
	cout &lt;&lt; &quot;szRes3={&quot;&lt;&lt; szRes3 &lt;&lt;&quot;} (&quot;&lt;&lt; nEr3 &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
	cout &lt;&lt; &quot;szRes4={&quot;&lt;&lt; szRes4 &lt;&lt;&quot;} (&quot;&lt;&lt; nEr4 &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
	cout &lt;&lt; &quot;szRes5={&quot;&lt;&lt; szRes5 &lt;&lt;&quot;} (&quot;&lt;&lt; nEr5 &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
	cout &lt;&lt; &quot;szRead={&quot;&lt;&lt; szRead &lt;&lt;&quot;} (&quot;&lt;&lt; nErRead &lt;&lt;&quot;)&quot;&lt;&lt;endl;<br />
	cout &lt;&lt; &quot;nSize={&quot;&lt;&lt; nSize &lt;&lt;&quot;}&quot;&lt;&lt;endl;<br />
}<br />
<br />
//Adds an element to the beginning of the stack.<br />
void push_back(char *str)<br />
{<br />
	stack_dll *pStackNew;<br />
	pStackNew=(stack_dll*)GlobalAlloc(GPTR, sizeof(stack_dll));<br />
	lstrcpyn(pStackNew-&gt;string, str, NSIS_MAX_STRLEN);<br />
	if (pStackFirst) pStackFirst-&gt;next=pStackNew;<br />
	if (!pStackFirst) pStackTop=pStackNew;<br />
	pStackFirst=pStackNew;<br />
}<br />
<br />
//Adds an element to the top of the stack.<br />
void push_front(char *str)<br />
{<br />
	stack_dll *pStackNew;<br />
	pStackNew=(stack_dll*)GlobalAlloc(GPTR, sizeof(stack_dll));<br />
	lstrcpyn(pStackNew-&gt;string, str, NSIS_MAX_STRLEN);<br />
	pStackNew-&gt;next=pStackTop;<br />
	pStackTop=pStackNew;<br />
	if (!pStackFirst) pStackFirst=pStackNew;<br />
}<br />
<br />
//Removes the element from the top of the stack and puts it in the buffer.<br />
//Returns: 0 on success, 1 on empty stack<br />
int pop_front(char *str)<br />
{<br />
	stack_dll *pStackTemp;<br />
	if (!pStackTop) return 1;<br />
	pStackTemp=pStackTop;<br />
	lstrcpy(str, pStackTemp-&gt;string);<br />
	pStackTop=pStackTemp-&gt;next;<br />
	GlobalFree((HGLOBAL)pStackTemp);<br />
	return 0;<br />
}<br />
<br />
//Finds the element with index and puts it in the buffer.<br />
//Returns: 0 on success, 1 on empty stack<br />
int stack_read(char *str, int index)<br />
{<br />
	stack_dll *pStackTemp=pStackTop;<br />
	int sum;<br />
<br />
	for (sum=1; (pStackTemp); ++sum)<br />
	{<br />
		if (sum == index)<br />
		{<br />
			lstrcpy(str, pStackTemp-&gt;string);<br />
			return 0;<br />
		}<br />
		pStackTemp=pStackTemp-&gt;next;<br />
	}<br />
	return 1;<br />
}<br />
<br />
//Returns: the number of elements in the stack.<br />
int stack_size()<br />
{<br />
	stack_dll *pStackTemp=pStackTop;<br />
	int sum;<br />
<br />
	for (sum=0; (pStackTemp); ++sum)<br />
		pStackTemp=pStackTemp-&gt;next;<br />
	return sum;<br />
}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th July 2005, 20:13</div></div><div class="posttext">STL and vectors are easier, but as you said you want C style -_-</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>