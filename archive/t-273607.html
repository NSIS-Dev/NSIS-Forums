<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help please, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help please NSIS Discussion" />
	
	<title> Help please [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help please</div>
<hr />
<div class="pda"><a href="t-273607.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=273607">Help please</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">29th June 2007, 15:22</div></div><div class="posttext">Hi all<br />
I have a lot of things that i dont know how to do. Can you help me please?<br />
<br />
1.- I have to install SQL Server Express 2005 SP2 (ive done it) but only if there isnt any version of SQL Server installed.<br />
<br />
This is how i install SQL Server:<br />
<br />
File &quot;SQLEXPR.EXE&quot;<br />
<br />
ExecWait '$INSTDIR\SQLEXPR_ESN.EXE /qb ADDLOCAL=SQL_Engine INSTANCENAME=MSSQLSERVER SECURITYMODE=SQL SAPWD=onix SQLCOLLATION=&quot;Modern_Spanish_CI_AS&quot; SQLAUTOSTART=1 DISABLENETWORKPROTOCOLS=0'<br />
<br />
2.- When the user uninstalls the program i should uninstall SQL Server and the framework. How can i do it ?<br />
<br />
This is the code of the uninstall section:<br />
<br />
Section &quot;Uninstall&quot;<br />
		<br />
RMDir &quot;$INSTDIR&quot;  				<br />
Delete &quot;$DESKTOP\PymesON.lnk&quot;		<br />
!insertmacro MUI_STARTMENU_GETFOLDER Application $MUI_TEMP<br />
Delete &quot;$SMPROGRAMS\$MUI_TEMP\Uninstall.lnk&quot;  <br />
Delete &quot;$SMPROGRAMS\$MUI_TEMP\${APPNAME}.lnk&quot;<br />
StrCpy $MUI_TEMP &quot;$SMPROGRAMS\$MUI_TEMP&quot;<br />
startMenuDeleteLoop:<br />
ClearErrors<br />
RMDir $MUI_TEMP<br />
GetFullPathName $MUI_TEMP &quot;$MUI_TEMP\..&quot;    <br />
IfErrors startMenuDeleteLoopDone  <br />
StrCmp $MUI_TEMP $SMPROGRAMS startMenuDeleteLoopDone startMenuDeleteLoop	<br />
startMenuDeleteLoopDone:<br />
DeleteRegKey HKCR &quot;.mcr&quot;<br />
DeleteRegKey HKCR &quot;mcrfile&quot;<br />
DeleteRegKey HKCR &quot;mcrfile&quot;<br />
DeleteRegKey HKCU &quot;SOFTWARE\microsoft\Internet Explorer\Extensions\{8491AFCD-14CE-449B-A4F8-0AA5AF2B66DB}&quot; <br />
DeleteRegKey /ifempty HKCU &quot;Software\${APPNAME}&quot;<br />
<br />
SectionEnd<br />
<br />
Can you help me please?? Please...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2007, 15:54</div></div><div class="posttext">Can you not check the registry for an existing version?<br />
Also, you should have quotes around your path for ExecWait.<br />
<br />
ExecWait '&quot;$INSTDIR\SQLEXPR_ESN.EXE&quot; /qb ... '<br />
<br />
If you don't and the path contains spaces then ExecWait will fail.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">29th June 2007, 16:13</div></div><div class="posttext">How can i check the registry for an existing version?<br />
Im new in all this .. i dont know how and where can i do it....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th June 2007, 16:22</div></div><div class="posttext">See ReadRegStr in the manual. VersionCompare will also be necessary if you want to check for a certain version. Use RegEdit to find a suitable registry key to use for your install, or use Google.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">2nd July 2007, 08:36</div></div><div class="posttext">Thanks Afrow UK. <br />
I have done it with this code:<br />
<br />
ReadRegStr $R0 HKLM \&quot;SOFTWARE\Microsoft\MSSQLServer\Setup&quot; SQLPath ;ProductCode<br />
${If} $R0 == &quot;&quot;<br />
File &quot;SQLEXPR_ESN.EXE&quot;			     ExecWait '$INSTDIR\SQLEXPR_ESN.EXE /qb ADDLOCAL=SQL_Engine INSTANCENAME=MSSQLSERVER SECURITYMODE=SQL SAPWD=onix SQLCOLLATION=&quot;Modern_Spanish_CI_AS&quot; SQLAUTOSTART=1 DISABLENETWORKPROTOCOLS=0'<br />
${Else}<br />
;MessageBox MB_ICONEXCLAMATION|MB_OK &quot;SQL Server/MSDE already installed!$\nSQL Path:$R0$\nSetup is terminating the installation process.&quot;<br />
;Quit<br />
${EndIf}<br />
<br />
<br />
About the other question.. How can i uninstall SQL Server? Can you help me please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">2nd July 2007, 10:36</div></div><div class="posttext">And i only should uninstall it if i have installed it...<br />
Ufff... Can someone help me please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">2nd July 2007, 10:53</div></div><div class="posttext">From what I can see, SQL is an MSI package. To uninstall it you can look at HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall\[some key for SQL] for its uninstall entry and call from your script the value given in the UninstallString found in the registry.<br />
<br />
As for uninstalling it only if you have installed it, you could add to your installer a registry value (for example under HKLM\Software\YourCompanyName or something similar), then look for that value from your uninstaller and if it is there then call the uninstall string for the MSI pack ...<br />
<br />
Hope this helps<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">trust11</div><div class="date">2nd July 2007, 11:31</div></div><div class="posttext">Hi CancerFace:<br />
Im trying to dot this. <br />
This is the code when i add a registry value on install:<br />
<br />
WriteRegStr HKLM &quot;SOFTWARE\MyAPP\MyAPP&quot; &quot;1&quot; &quot;1&quot;<br />
<br />
On uninstall im trying with this:<br />
<br />
ReadRegStr $R0 HKLM \<br />
&quot;SOFTWARE\MyAPP\MyAPP&quot; 1<br />
${If} $R0 &lt;&gt; &quot;&quot;<br />
   ReadRegStr $R1 HKLM \		&quot;SOFTWARE\Microsoft\MSSQLServer\UninstallPath&quot; SQLPath ;ProductCode<br />
    ${If} $R1 &lt;&gt; &quot;&quot;<br />
	ExecWait '$R1'<br />
    ${EndIf}	<br />
${EndIf}<br />
<br />
But this isnt working.<br />
What im doing bad??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">2nd July 2007, 15:20</div></div><div class="posttext">This is what I had in mind:<br />
<br />
Installer:<br />
WriteRegStr HKLM &quot;SOFTWARE\MyAPP&quot; &quot;Installed&quot; &quot;1&quot;Uninstaller:<br />
ReadRegStr $R0 HKLM &quot;SOFTWARE\MyAPP&quot; &quot;Installed&quot;<br />
${If} $R0 == 1<br />
# add here the actual uninstall string for the MSI pack<br />
${EndIf}<br />
The uninstall string you will find, as I already pointed out, under HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall\[some key for SQL]<br />
For example, the Intel Alert Agent on the Dell machine I use at work has its uninstaller found in HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{3C50A915-DD33-4802-B83B-9EA997D3337B} and specifically the uninstall string is at the key called UninstallString with a value of MsiExec.exe /I{3C50A915-DD33-4802-B83B-9EA997D3337B}<br />
So if I wanted to start this uninstaller for the Intel Alert Agent  I would call (within my uninstaller):<br />
ReadRegStr $R0 HKLM &quot;SOFTWARE\MyAPP&quot; &quot;Installed&quot;<br />
${If} $R0 == 1<br />
  ReadRegStr $R1 HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{3C50A915-DD33-4802-B83B-9EA997D3337B}&quot;  &quot;UninstallString&quot;<br />
  ${If} $R1 != &quot;&quot;<br />
    ExecWait '$R1'<br />
  ${EndIf}<br />
${EndIf}<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">2nd July 2007, 20:09</div></div><div class="posttext">Just to head off another possible problem, some install packages put the /I parameter into the uninstall string, but actually need /X to do the uninstall (this is from Crystal Reports):<br />
!define UNINSTALL_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall&quot;<br />
ReadRegStr $R0 HKLM &quot;${UNINSTALL_KEY}\{2F8728F9-F239-46A0-9DE2-8AD7302E4B33}&quot; &quot;UninstallString&quot;<br />
; modify the command (/I becomes /x)<br />
${un.WordReplace} &quot;$R0&quot; &quot;/I{&quot; &quot;/x{&quot; &quot;+&quot; &quot;$R0&quot;<br />
ExecWait &quot;$R0 /qn /norestart&quot;<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd July 2007, 09:35</div></div><div class="posttext">I'll say it again for everyone. You have to use quotes around the executable path, otherwise it will not execute if you have a space in the path.<br />
<br />
E.g.<br />
$R0 = &quot;C:\Program Files\MyApp\file.exe&quot;<br />
ExecWait &quot;$R0 /args&quot;<br />
This will become:<br />
ExecWait &quot;C:\Program Files\MyApp\file.exe /args&quot;<br />
<br />
As you can seem C:\Program is not the executable!<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>