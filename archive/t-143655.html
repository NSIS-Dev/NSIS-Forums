<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Skip Sections programatically, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Skip Sections programatically NSIS Discussion" />
	
	<title> Skip Sections programatically [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Skip Sections programatically</div>
<hr />
<div class="pda"><a href="t-143655.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=143655">Skip Sections programatically</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">26th July 2003, 16:03</div></div><div class="posttext">Is it possible to skip sections if a certain condition exists? If so, could someone point me in the right direction on how to do this? Thanks much!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th July 2003, 17:09</div></div><div class="posttext">yes...use SectionSetFlags</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">26th July 2003, 20:27</div></div><div class="posttext">Is SetSectionFlags a built-in function or is that a function/macro that I need to put in my script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th July 2003, 20:29</div></div><div class="posttext">Need put in...a Section, Macro or Function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2003, 20:43</div></div><div class="posttext">You need to do this:<br />
## add at top of script file<br />
!define SF_SELECTED 1<br />
!define SECTION_OFF 0xFFFFFFFE<br />
<br />
Section &quot;Section Name&quot; Sec1<br />
## have stuff here in your section<br />
SectionEnd<br />
<br />
Section &quot;Section Name&quot; Sec2<br />
## have stuff here in your section<br />
SectionEnd<br />
<br />
Then in your functions use:<br />
## Turn sections off<br />
Push $R0 ;save variable<br />
SectionGetFlags ${Sec1} $R0<br />
IntOp $R0 $R0 &amp; ${SECTION_OFF}<br />
SectionSetFlags ${Sec1} $R0<br />
Pop $R0 ;return variable<br />
<br />
<br />
## Turn sections on<br />
Push $R0 ;save variable<br />
SectionGetFlags ${Sec2} $R0<br />
IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
SectionSetFlags ${Sec2} $R0<br />
Pop $R0 ;return variable<br />
<br />
The Sec1 and Sec2 bits are the important parts. Just change those bits for the different sections.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">26th July 2003, 21:34</div></div><div class="posttext">Ok, this is what I have...Could I get someone's verification that I am doing this correctly(I think I supplied all the related code)? Also, are sections initialized to &quot;ON&quot; when a script runs?<br />
<br />
!include Sections.nsh<br />
<br />
!define MUI_CUSTOMFUNCTION_DIRECTORY_PRE DirectoryPre<br />
<br />
Section &quot;Section Name&quot; Sec1<br />
## have stuff here in your section<br />
SectionEnd<br />
Section &quot;Section Name&quot; Sec2 <br />
## have stuff here in your section<br />
SectionEnd<br />
Section &quot;Section Name&quot; Sec3<br />
## have stuff here in your section<br />
SectionEnd<br />
<br />
Function DirectoryPre<br />
  push $R1<br />
  ReadRegStr $R1 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${MUI_PRODUCT}&quot; &quot;UninstallString&quot;<br />
  StrCmp $R1 &quot;&quot; OK<br />
    SetSectionFlag ${sec1} ${SECTION_OFF}<br />
    SetSectionFlag ${sec2} ${SECTION_OFF}<br />
    SetSectionFlag ${sec3} ${SECTION_OFF}<br />
    Abort<br />
OK:<br />
FunctionEnd<br />
<br />
I REALLY appreciate everyone's help on this!!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2003, 21:42</div></div><div class="posttext">It's SectionSetFlags not SetSectionFlag.<br />
Also, your code is wrong and it will not work.<br />
Use the code that I showed you.<br />
<br />
Yes, sections are on by default.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jcagle</div><div class="date">26th July 2003, 22:16</div></div><div class="posttext">In Sections.nsh (in NSIS/include), there is the macro:<br />
!macro SetSectionFlag SECTION BITS<br />
	Push $R0<br />
	SectionGetFlags &quot;${SECTION}&quot; $R0<br />
	IntOp $R0 $R0 | &quot;${BITS}&quot;<br />
	SectionSetFlags &quot;${SECTION}&quot; $R0<br />
	Pop $R0<br />
!macroend<br />
Can't I use that?? The only difference I see between this macro and your code, Afrow, is you have a &quot;&amp;&quot; instead of &quot;|&quot;...which is correct?<br />
<br />
Maybe my code should be modified to:<br />
!insertmacro SetSectionFlag ${sec1} ${SECTION_OFF} <br />
!insertmacro SetSectionFlag ${sec2} ${SECTION_OFF} <br />
!insertmacro SetSectionFlag ${sec3} ${SECTION_OFF}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2003, 12:05</div></div><div class="posttext">That is correct.<br />
If it doesn't work, then try replacing | with &amp; in the macro.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">n0On3</div><div class="date">27th July 2003, 16:57</div></div><div class="posttext">Originally posted by jcagle <br />
Is it possible to skip sections if a certain condition exists? <br />
When I want to skip a section depending on some conditions I write a StrCmp at the beginning and place one jump label at the end of the section.<br />
<br />
This seems eaiser to me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2003, 17:26</div></div><div class="posttext">Yes, thats another way, but you could say it's cheaper and less tidy, but it still works :)<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>