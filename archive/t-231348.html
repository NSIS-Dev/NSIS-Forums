<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Setting Custom Page Text Box State, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Setting Custom Page Text Box State NSIS Discussion" />
	
	<title> Setting Custom Page Text Box State [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Setting Custom Page Text Box State</div>
<hr />
<div class="pda"><a href="t-231348.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=231348">Setting Custom Page Text Box State</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">shock_flights</div><div class="date">18th November 2005, 20:13</div></div><div class="posttext">I created a custom page that asks the user for some input that will be written to an ini file, however I want to prepopulate that text box with any existing text if that ini file already exists and has somehting in it. So I'm doing a ReadINIStr to get the value (and that works fine - proven using MessageBox), but I can't place that value into the Text Box on the custom form in my installer. I tried WriteINIStr and MUI_INSTALLOPTIONS_WRITE, but no matter where I put it, I can't get my read text to appear in the custom form when I get there. I tried putting my code in the .onInit function, as well as at the top of the custom page function, but to no avail. Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shock_flights</div><div class="date">18th November 2005, 22:19</div></div><div class="posttext">Here is more background: <br />
In my custom page (ClientInfo.ini below) I have multiple fields. The one in question is &quot;Field 2&quot;. I am trying to read an existing ini file and then right after that writing it to the custom page ini file (or somehow stuffing it into the text box). Here is what I tried:<br />
<br />
ReadINIStr $ProcessKey &quot;$PROGRAMFILES\CompanyName\MyProg\MyProg.ini&quot; &quot;ID Keys&quot; &quot;Process Key&quot;<br />
  WriteINIStr &quot;ClientInfo.ini&quot; &quot;Field 2&quot; &quot;State&quot; $ProcessKey<br />
<br />
I also tried this (after reading using ReadINIStr):<br />
  ;!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ClientInfo.ini&quot; &quot;Field 2&quot; &quot;State&quot; $ProcessKey</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">18th November 2005, 22:39</div></div><div class="posttext">Originally posted by shock_flights <br />
ReadINIStr $ProcessKey &quot;$PROGRAMFILES\CompanyName\MyProg\MyProg.ini&quot; &quot;ID Keys&quot; &quot;Process Key&quot;<br />
  WriteINIStr &quot;ClientInfo.ini&quot; &quot;Field 2&quot; &quot;State&quot; $ProcessKey<br />
Did you extract the file?<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;ClientInfo.ini&quot;<br />
<br />
Also, your mistake:<br />
<br />
WriteINIStr &quot;ClientInfo.ini&quot; &quot;Field 2&quot; &quot;State&quot; $ProcessKey<br />
<br />
should be:<br />
<br />
WriteINIStr &quot;$PLUGINSDIR\ClientInfo.ini&quot; &quot;Field 2&quot; &quot;State&quot; $ProcessKey<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shock_flights</div><div class="date">18th November 2005, 22:44</div></div><div class="posttext">Yes, I did the extraction. (My custom pages have been working. I'm just adding thsi new functionality now.) I even tried moving the write to before, after and in the .onInit functions. <br />
<br />
I don't think your second comment is correct. It's not really a plug-in, but just a custom page. Also, I checked to make sure it can find the ClientInfo.ini file by using IfFileExists. <br />
<br />
Any other ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhaelochon</div><div class="date">18th November 2005, 23:53</div></div><div class="posttext">Make sure you extract the file in .onInit:<br />
Function .onInit<br />
   !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;ClientInfo.ini&quot;<br />
FunctionEnd<br />
Then, in your page init function:<br />
Function InitClientInfo<br />
   !insertmacro MUI_HEADER_TEXT &quot;Title&quot; &quot;Subtitle&quot;<br />
<br />
   ; init the dialog, but don't show it<br />
   !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;ClientInfo.ini&quot;<br />
   Pop $HWND ;HWND of dialog<br />
<br />
   ; read the value that we want to put on our dialog<br />
   ReadINIStr $ProcessKey &quot;$PROGRAMFILES\CompanyName\MyProg\MyProg.ini&quot; &quot;ID Keys&quot; &quot;Process Key&quot;<br />
<br />
   ; put the value on our dialog<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ClientInfo.ini&quot; &quot;Field 2&quot; &quot;State&quot; $ProcessKey<br />
<br />
   ; show the dialog, now that we've set the text<br />
   !insertmacro MUI_INSTALLOPTIONS_SHOW<br />
FunctionEnd<br />
<br />
And regarding the $PLUGINSDIR thing: What Dan is trying to say is if you're using MUI to extract the file, then you should specify $PLUGINSDIR when using WriteINIStr as opposed to MUI_INSTALLOPTIONS_WRITE--because that's where MUI puts the file. ;-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shock_flights</div><div class="date">19th November 2005, 01:26</div></div><div class="posttext">Thanks for the reply. I'll have to research some of those options. I tried it, but it's still not doing anything. Where am I supposed to be calling this new function (InitClientInfo) from? I cut out the code and stuck it in my ClientPage function as follows:<br />
<br />
Page custom ClientPage <br />
<br />
Is that correct? Is the InitClientPage a special 'init' function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th November 2005, 10:25</div></div><div class="posttext">Page Custom InitClientPage<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhaelochon</div><div class="date">21st November 2005, 16:53</div></div><div class="posttext">shock_flights, you were correct to place the code from my InitClientInfo function into your ClientPage function. Sorry I wasn't more clear about that. :)<br />
<br />
If you're still having problems, please upload your .nsi file so that we may troubleshoot it by trying to compile it ourselves. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shock_flights</div><div class="date">21st November 2005, 20:06</div></div><div class="posttext">Still can't get it working. Attached is a test-script that shows what I'm doing (I cut out much, but not all, of the unnessary stuff.) To test it you might need to change some file paths, or fake some files. <br />
<br />
Let me know if you get anywhere. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bhaelochon</div><div class="date">22nd November 2005, 15:24</div></div><div class="posttext">Okay. I misspoke before. I guess that's what I get for copy/pasting. :( Below is a modified version of the ClientPage function from your test .nsi file. The screen displays with &quot;1137&quot; in the Process Key box. Is that correct?<br />
Function ClientPage<br />
   !insertmacro MUI_HEADER_TEXT \<br />
      &quot;Client Specific Configuration&quot; \<br />
      &quot;Please enter the custom ids and setup information \<br />
       associated with this AcuFlash installation.&quot;<br />
   ; init the dialog, but don't show it<br />
;   !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;ClientInfo.ini&quot;<br />
;   Pop $Hwnd<br />
<br />
;  StrCpy $IniFilePath &quot;$PROGRAMFILES\AcuFlash\AcuFlash.ini&quot;<br />
   StrCpy $IniFilePath &quot;E:\_NSIS Scripts\test\AcuFlash.ini&quot;<br />
   ; read the value that we want to put on our dialog<br />
   ReadINIStr $ProcessKey $IniFilePath &quot;ID Keys&quot; &quot;Process Key&quot;<br />
<br />
   ; put the value on our dialog<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ClientInfo.ini&quot; &quot;Field 2&quot; &quot;State&quot; $ProcessKey<br />
;MessageBox MB_OK &quot;Process=$ProcessKey&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;ClientInfo.ini&quot;<br />
     ; show the dialog, now that we've set the text<br />
;   !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;ClientInfo.ini&quot;<br />
;   Pop $Hwnd<br />
;   !insertmacro MUI_INSTALLOPTIONS_SHOW<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shock_flights</div><div class="date">23rd November 2005, 18:31</div></div><div class="posttext">Hey, that did it. I guess I was close, but the key was the MUI_INSTALLOPTIONS_DISPLAY call? Thanks for taking the time to help out. I really appreciate it. Take care.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>