<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Complex Version Check fails, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Complex Version Check fails NSIS Discussion" />
	
	<title> Complex Version Check fails [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Complex Version Check fails</div>
<hr />
<div class="pda"><a href="t-318430.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318430">Complex Version Check fails</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dbach</div><div class="date">15th April 2010, 12:13</div></div><div class="posttext">Hi Forum.<br />
<br />
I've got a problem. Specified is to allow installation on:<br />
Win2003 Server, Win2008 Server w/ SP2+, Win2008 Server R2 w/ SP2+, WinVista w/ SP2+, WinXP w/ SP3+, Win7+<br />
<br />
This is the code:<br />
<br />
${IfNot} 	${AtLeastWin7}				; Windows 7<br />
${OrIf}		${IsWinXP}					; Windows XP<br />
${AndIfNot} ${AtLeastServicePack} 3		; with SP 3<br />
${OrIf}		${IsWinVista}				; Windows Vista <br />
${AndIfNot} ${AtLeastServicePack} 2		; with SP2<br />
${OrIf}		${IsWin2008}				; Windows Server 2008<br />
${AndIfNot} ${AtLeastServicePack} 2		; with SP2<br />
${OrIf}		${IsWin2008R2}				; Windows Server 2008 R2<br />
${AndIfNot} ${AtLeastServicePack} 2		; with SP2<br />
${OrIfNot}	${IsWin2003}				; Windows Server 2003<br />
	${If} $LANGUAGE == ${LANG_GERMAN}<br />
	   MessageBox MB_OK|MB_TOPMOST|MB_ICONEXCLAMATION &quot;The operating system is unsupported by ${PRODUCT_NAME} ${PRODUCT_VERSION}.&quot;<br />
	${Else}<br />
	   MessageBox MB_OK|MB_TOPMOST|MB_ICONEXCLAMATION &quot;Das Betriebssystem wird von ${PRODUCT_NAME} ${PRODUCT_VERSION} nicht unterstützt.&quot;<br />
	${EndIf}<br />
Abort<br />
<br />
${EndIf}<br />
<br />
But it isn't working (on my testsystems: Win2008R2, Win7). What am I doing wrong?! :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">15th April 2010, 12:35</div></div><div class="posttext">Are you sure the OrIf and AndIf statements can be used in the way you want to use them? Since you cannot put (brackets) around them, it depends on LogicLib.nsh how your code will be interpreted.<br />
<br />
I suggest trying something that's simpler to visualize (as far as understanding what the precompiler is doing, that is). Like this:<br />
${If} ${AtLeastWin7}<br />
${ElseIf} ${IsWinXP}<br />
${AndIf} ${AtLeastServicePack} 3<br />
${ElseIf} ${IsWinVista}<br />
${AndIf} ${AtLeastServicePack} 2<br />
${ElseIf} ${IsWin2008}<br />
${AndIf} ${AtLeastServicePack} 2<br />
${ElseIf} ${IsWin2008R2}<br />
${AndIf} ${AtLeastServicePack} 2<br />
${ElseIf} ${IsWin2003}<br />
${Else}<br />
  ${If} $LANGUAGE == ${LANG_GERMAN}<br />
     MessageBox MB_OK|MB_TOPMOST|MB_ICONEXCLAMATION &quot;The operating system is unsupported by ${PRODUCT_NAME} ${PRODUCT_VERSION}.&quot;<br />
  ${Else}<br />
     MessageBox MB_OK|MB_TOPMOST|MB_ICONEXCLAMATION &quot;Das Betriebssystem wird von ${PRODUCT_NAME} ${PRODUCT_VERSION} nicht unterstützt.&quot;<br />
  ${EndIf}<br />
  Abort<br />
${EndIf}  <br />
<br />
Edit: Also, you have English and German strings reversed. :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbach</div><div class="date">15th April 2010, 13:02</div></div><div class="posttext">Thnx MSG.<br />
<br />
I've changed the way to check the OS. This works:<br />
StrCpy $bValidOS false<br />
${If} 	${AtLeastWin7}					; Windows 7<br />
	StrCpy $bValidOS true<br />
<br />
${ElseIf} ${IsWinXP}					; Windows XP<br />
	${If} 	${AtLeastServicePack} 3	<br />
		StrCpy $bValidOS true<br />
	${EndIf}<br />
	<br />
${ElseIf} ${IsWinVista}					; Windows Vista<br />
	${If} 	${AtLeastServicePack} 2	<br />
		StrCpy $bValidOS true<br />
	${EndIf}<br />
	<br />
${ElseIf} ${IsWin2008}					; Windows Server 2008<br />
	${If} 	${AtLeastServicePack} 2	<br />
		StrCpy $bValidOS true<br />
	${EndIf}	<br />
	<br />
${ElseIf} ${IsWin2008R2}				; Windows Server 2008 R2<br />
	${If} 	${AtLeastServicePack} 2	<br />
		StrCpy $bValidOS true<br />
	${EndIf}	<br />
	<br />
${ElseIf} ${IsWin2003}					; Windows Server 2008<br />
	StrCpy $bValidOS true<br />
	<br />
${EndIf}	<br />
<br />
${If} $bValidOS == false<br />
	${If} $LANGUAGE == ${LANG_GERMAN}<br />
	   MessageBox MB_OK|MB_TOPMOST|MB_ICONEXCLAMATION &quot;Das Betriebssystem wird von ${PRODUCT_NAME} ${PRODUCT_VERSION} nicht unterstützt.&quot;<br />
	${Else}<br />
	   MessageBox MB_OK|MB_TOPMOST|MB_ICONEXCLAMATION &quot;The operating system is unsupported by ${PRODUCT_NAME} ${PRODUCT_VERSION}.&quot;<br />
    ${EndIf}<br />
	<br />
	Abort<br />
${EndIf}</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>