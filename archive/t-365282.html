<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" how do I get dir from MUI_PAGE_DIRECTORY?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  how do I get dir from MUI_PAGE_DIRECTORY? NSIS Discussion" />
	
	<title> how do I get dir from MUI_PAGE_DIRECTORY? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  how do I get dir from MUI_PAGE_DIRECTORY?</div>
<hr />
<div class="pda"><a href="t-365282.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=365282">how do I get dir from MUI_PAGE_DIRECTORY?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">3rd July 2013, 00:33</div></div><div class="posttext">I have the line<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
but it does not seem to provide me with the directory variable it prompts for.<br />
my only guess is it has something to do with MUI_DIRECTORYPAGE_VARIABLE<br />
but I am unable to access this. I have tried all kinds of ways to initialize it  on .onInit and failed (!define, StrCpy)<br />
<br />
!define: &quot;MUI_DIRECTORYPAGE_VARIABLE&quot; already defined!<br />
Error in script &quot;setup2.nsi&quot; on line 242 -- aborting creation process<br />
which is the !define in the following .onInit fragment:<br />
<br />
${If} ${RunningX64}<br />
    StrCpy $Dir_Wanted &quot;$PROGRAMFILES64\${PRODUCT_NAME}&quot;<br />
  !define MUI_DIRECTORYPAGE_VARIABLE &quot;${Dir_Wanted}&quot;<br />
${Else}<br />
    StrCpy $Dir_Wanted &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
  !define MUI_DIRECTORYPAGE_VARIABLE &quot;${Dir_Wanted}&quot;<br />
${EndIf}<br />
<br />
!define's the only thing that doesn't error out. kinda. but I made this change and things don't work.<br />
elsewhere in the top of the install section, I have <br />
${If} ${RunningX64}<br />
	StrCpy $INSTDIR &quot;${Dir_Wanted}&quot;<br />
${Else}<br />
	StrCpy $INSTDIR &quot;${Dir_Wanted}&quot;<br />
${EndIf}<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
<br />
<br />
I wanted to initialize the mui directory page thing so it has a correct default, but also allow for user input to change that value, so I can get a different directory if the user chooses. but I am not having sucess. I also need to get that dir that came from the user. any pointers?<br />
<br />
I tried changing the !define to <br />
!insertmacro MUI_DEFAULT MUI_DIRECTORYPAGE_VARIABLE Dir_Wanted<br />
but it caused<br />
2 warnings:<br />
  unknown variable/constant &quot;{Dir_Wanted}&quot; detected, ignoring (setup2.nsi:109)<br />
  unknown variable/constant &quot;{Dir_Wanted}&quot; detected, ignoring (setup2.nsi:112)<br />
<br />
<br />
thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd July 2013, 09:36</div></div><div class="posttext">I wanted to initialize the mui directory page thing so it has a correct default, but also allow for user input to change that value, so I can get a different directory if the user chooses. but I am not having sucess. I also need to get that dir that came from the user. any pointers?<br />
<br />
Function on.Init<br />
${If} ${RunningX64}<br />
    StrCpy $INSTDIR &quot;$PROGRAMFILES64\${PRODUCT_NAME}&quot;<br />
${Else}<br />
    StrCpy $INSTDIR &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
${EndIf}<br />
FunctionEnd<br />
<br />
That's all.<br />
<br />
Note however that you should only put 64 bits applications in $PROGRAMFILES64. If your application is 32 bits, you should only use $PROGRAMFILES. On 64 bits Windows that will point to &quot;Program Files (x86)&quot; (which is for 32 bits applications), and on 32 bits windows that will point to &quot;Program Files&quot; (which is of course also for 32 bits applications).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">3rd July 2013, 10:50</div></div><div class="posttext">hmm. my programs contain<br />
- DOS<br />
- 64-bit<br />
- 32-bit<br />
- perl maybe<br />
but I only provide links to the appropriate executable and also set the working directory for that shortcut.<br />
<br />
is there a reason why you said what you said? I would like to know the technical details. I read some things about the virtual store. but I don't understand that much about it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd July 2013, 12:44</div></div><div class="posttext">I don't understand your questions in the context of your first post. <br />
<br />
Can you explain clearly what exact behavior you want to get in your installer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">5th July 2013, 23:37</div></div><div class="posttext">- I want the user to be able to get an input box that is initialized with the kiind of program files appropriate for the platform, with the ability of them to browse/change it to a different folder or just enter in the path, and me get the var/whatever that contains that directory so I can finish the installation, to that directory.<br />
<br />
- other that using copyfiles, I don't know how I am going to get the files there, because NSIS by default seems to dump the contents of the installer files into INSTDIR (not sure where or how). I just wish I could redirect it.<br />
<br />
so I have 2 things to solve.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">5th July 2013, 23:49</div></div><div class="posttext">I can post a pastebin url of the whole code if you want. it's 264 lines.<br />
<br />
if I get something working that's cross-platform, I would be glad to get some help posting it in the nsis samples.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">8th July 2013, 19:46</div></div><div class="posttext">1: Use the code I showed you to set the $INSTDIR default according to the platform the installer is running on. Then use a normal DIRECTORY page to allow the user to change it.<br />
2: Use SetOutPath to change the directory where files are extracted. Usually, you want to do<br />
SetOutPath $INSTDIR<br />
to set the output directory to whatever the user entered on the DIRECTORY page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">15th July 2013, 12:26</div></div><div class="posttext">I get no icons except for the uninstaller<br />
<br />
the code isn't compiling properly with 3.0a, doing weird stuff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">15th July 2013, 13:37</div></div><div class="posttext">I get no icons except for the uninstaller<br />
<br />
the code isn't compiling properly with 3.0a, doing weird stuff<br />
<br />
How is this related to MUI_PAGE_DIRECTORY?<br />
<br />
If you think there is a problem with the alpha, post in the alpha thread (With a real description of the problem, compiler error message if any and some sample code)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">16th July 2013, 10:14</div></div><div class="posttext">problem solved, got the small problem of icons worked out, was going to wrong directory.<br />
now installer seems to work correctly. thank you for your help. kudos.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">16th July 2013, 10:26</div></div><div class="posttext">I had thought that maybe I could post a sample installer script so others could benefit from something that's english and cross-platform on modern machines.<br />
<br />
but I have no clue how. I am only semi-capable of wiki-coding. and I don't understand the structure of the NSIS site (and there's no sitemap that I remember).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">29th July 2013, 10:29</div></div><div class="posttext">I have one more big problem. now that MUI_PAGE_DIRECTORY has written the page to the registry in HKCU ... getting it out is another thing (ReadRegStr?), and what to do on failsafe?<br />
<br />
or should I be using something in Uninstall section like a MUI !insertmacro?<br />
clus helpful, thanks.<br />
MUI is not my native language yet, because documentation is not quite that good.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">29th July 2013, 14:11</div></div><div class="posttext">not knowing what else to do, I decided to store/read from the registry.  if there is a MUI way, I would like to know. the Uninstall section doesn't see my <br />
Var /GLOBAL StartMenuFolder<br />
<br />
and neither does the &quot;dot&quot; functions.<br />
<br />
what good is no variables in a function?<br />
this is in 3.0a1.<br />
the message is:<br />
d:\prj\pwdgen\pwdgen-2.11&gt;&quot;\prog\nsis\makensis&quot; setup2.nsi<br />
Processing config: d:\prog\nsis\nsisconf.nsh<br />
Processing script file: &quot;setup2.nsi&quot; (ACP)<br />
warning: unknown variable/constant &quot;{StartMenuFolder}&quot; detected, ignoring (setup2.nsi:316)<br />
warning: unknown variable/constant &quot;{StartMenuFolder}&quot; detected, ignoring (setup2.nsi:317)<br />
<br />
Processed 1 file, writing output (x86-ansi):<br />
<br />
Output: &quot;d:\prj\pwdgen\pwdgen-2.11\pwdgen-2.11-setup.exe&quot;<br />
Install: 9 pages (576 bytes), 1 section (2072 bytes), 600 instructions (16800 bytes), 1 string (46594 bytes), 1 language table (370<br />
bytes).<br />
Uninstall: 3 pages (192 bytes),<br />
1 section (2072 bytes), 88 instructions (2464 bytes), 1 string (2052 bytes), 1 language table (254 bytes).<br />
Datablock optimizer saved 15709 bytes (~0.4%).<br />
<br />
Using bzip2 compression.<br />
<br />
EXE header size:               50176 / 34816 bytes<br />
Install code:                  18332 / 65764 bytes<br />
Install data:                3667985 / 10450240 bytes<br />
Uninstall code+data:           18794 / 22802 bytes<br />
CRC (0xE086BE3C):                  4 / 4 bytes<br />
<br />
Total size:                  3755291 / 10573626 bytes (35.5%)<br />
<br />
2 warnings:<br />
  unknown variable/constant &quot;{StartMenuFolder}&quot; detected, ignoring (setup2.nsi:316)<br />
  unknown variable/constant &quot;{StartMenuFolder}&quot; detected, ignoring (setup2.nsi:317)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th July 2013, 15:14</div></div><div class="posttext">I'm sure one of the MUI examples show you how to save/restore the startmenu folder...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">31st July 2013, 21:54</div></div><div class="posttext">it's MUI_STARTMENU_GETFOLDER was one of the things I wanted. but those have a page_id, I have no clue what that means, what I am supposed to feed into a page_id, and the MUI docs need much improvement, they are not a spec that describes possible values or gives semantics.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st July 2013, 22:15</div></div><div class="posttext">You create the id when you call MUI_PAGE_STARTMENU, it can be anything, only matters when you have multiple startmenu pages...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">31st July 2013, 22:18</div></div><div class="posttext">It's in the manual:<br />
http://nsis.sourceforge.net/Docs/Modern%20UI/Readme.html<br />
Chapter 3:You will need the page ID for the Start Menu folder page when using the Start Menu folder macros.It means that when you want to use any of the MUI_STARTMENU_GETFOLDER macro<br />
   1) you'll have to create a Startmenu page:<br />
       http://forums.winamp.com/showthread.php?t=308752<br />
   2) you'll have to define the MUI_STARTMENUPAGE_REGISTRY_* defines and use the MUI_STARTMENU_WRITE_* macros<br />
       http://stackoverflow.com/questions/3297402/nsis-retrieving-the-start-menu-folder-not-working-as-expected<br />
<br />
The StartMenu.nsi example is a working example.<br />
That should get you started.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>