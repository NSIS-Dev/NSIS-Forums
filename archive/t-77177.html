<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSISDL with HTTP Resume, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSISDL with HTTP Resume NSIS Discussion" />
	
	<title> NSISDL with HTTP Resume [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSISDL with HTTP Resume</div>
<hr />
<div class="pda"><a href="t-77177.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=77177">NSISDL with HTTP Resume</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">hasty</div><div class="date">24th February 2002, 00:21</div></div><div class="posttext">Don't know if anyone's interested in this, but here's a patch for NSISDL. The three main changes are:<br />
<br />
1) Now supports HTTP Resume. If a file download was partially completed the last time a download was attempted, and the filesize on the server hasn't changed, NSISDL will pick up where it left off. This is useful for large files.<br />
2) It now estimates the time remaining in the download, and prints it out after the progress percentage. (also, file sizes are reported in K)<br />
3) Fixed a bug where NSISDL reported success if disconnected in the middle of downloading.<br />
<br />
Can't say it's well written, but it works.<br />
<br />
-H</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tresni</div><div class="date">24th February 2002, 07:54</div></div><div class="posttext">--------------------Configuration: nsisdl - Win32 Release--------------------<br />
Compiling...<br />
nsisdl.cpp<br />
Linking...<br />
   Creating library Release/nsisdl.lib and object Release/nsisdl.exp<br />
nsisdl.obj : error LNK2001: unresolved external symbol _time<br />
../../nsisdl.dll : fatal error LNK1120: 1 unresolved externals<br />
Error executing link.exe.<br />
<br />
nsisdl.dll - 2 error(s), 0 warning(s)<br />
<br />
<br />
All I did was extract and compile as you didn't say what else I needed to do..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yaroslav</div><div class="date">24th February 2002, 08:26</div></div><div class="posttext">_time is from libc.  attached is nsisdl with<br />
Hasty's d/l resume patch that doesn't use libc :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">4th March 2002, 03:52</div></div><div class="posttext">I'm not sure I'm on board with some of the issues http/1.1 support adds.. primarily, the issues are:<br />
<br />
<br />
  support on non http 1.1 servers<br />
  preventing corruption on downlaoded files (i.e. suppose the user is upgrading from one version to another, and accidentally resuming from an old version to a new one). - this one isn't too big of a deal, but just requires the person writing the script to write it intelligently.<br />
  uh, creating registry keys that never get deleted sucks.<br />
<br />
<br />
anyway, I'm going to take a few of these ideas (and bugfixes) and make a NSISDL 1.1 that'll go with NSIS 1.97, but I'm gonna hold off on the http 1.1 resume shit.<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hasty</div><div class="date">4th March 2002, 17:26</div></div><div class="posttext">So, the way it handles the resume of a possibly changed file is by comparing filesizes. This is the info it stores in the registry. For me, this was enough, since the files I'm downloading are 4MB+, and thus any changes to the build large enough to make it to production are most likely going to change the filesize. However, I can see that if you were using NSISDL to fetch, say, an ini file, it may very well be the same size and a different version. So, adding something based around the &quot;Last-Modified&quot; header would solve that problem. At the time, writing something to parse HTTP-date fields was more than I felt I could pull off in a couple hours.<br />
<br />
In any case, as it stands, if the size reported by the server differs from that in the registry, it starts the download over again. This should also take care of any non-HTTP1.1 servers, since it will report the full size of the download, which, added to the size already downloaded, would be incorrect, triggering a re-download. Which is all you can really expect from a server that doesn't support resume. That's not really perfect, either, since it is possible that the server filesize would have changed to exactly the right size to match up with the old filesize minus the current amount downloaded, but that would be fixed by the above timestamping.<br />
<br />
As far as the registry goes, it can certainly be improved by deleting the reg value after a successful download, and removing the NSISDL key if there are no more subvalues. It would still be possible that a key would left behind if a user never finished his or her download, and I can't really think of a way around that. The &quot;metadata&quot; about the partially downloaded file needs to live somewhere.<br />
<br />
-H</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>