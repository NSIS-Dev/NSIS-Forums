<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" UMUI Maintenance Page Remove error, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  UMUI Maintenance Page Remove error NSIS Discussion" />
	
	<title> UMUI Maintenance Page Remove error [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  UMUI Maintenance Page Remove error</div>
<hr />
<div class="pda"><a href="t-325152.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=325152">UMUI Maintenance Page Remove error</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">22nd December 2010, 23:07</div></div><div class="posttext">In order to have a Maintenance Page using UMUI you must '!define' (among other things) UMUI_UNINSTALL_FULLPATH.  The problem is, this may be declared before the install directory is finalized (and therefore the uninstall directory) which causes the 'Remove' option on the maintenance page to not be selectable. <br />
<br />
I attempted to '!define' it to a default and then change the created registry key (in my case &quot;UninstallString&quot;) once I knew the appropriate location, but this also causes the error of 'Remove' not being selectable on the Maintenance page.  This seems like a pretty big flaw considering that any installer that allows the user to change the install directory would have a broken 'Remove' option on the Maintenance Page.  This is of course assuming that the '!define' uses something like &quot;$INSTDIR\uninstall.exe&quot; (which all the examples show).<br />
<br />
Therefore, I am wondering if there is a way around this because I feel like I am missing something.  Any thoughts?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">28th December 2010, 20:23</div></div><div class="posttext">It appears to be yet another issue with Windows User Account Control.  Thank you Windows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">30th December 2010, 21:43</div></div><div class="posttext">shoot, it doesn't appear to be a UAC issue.  Things are still broken.  You simply can not change the value of the Registry key created by '!define UNINSTALLER_FULL_PATH'.  This is a problem since the path is not know until after the user defines the installation directory (unfortunately this happens after defining the above registry key).  Therefore, the Remove option on the Maintenance page doesn't work and can't even be selected...bummer.<br />
<br />
Does anyone have any ideas on this?  I may just have to write my own Modify/Repair/Remove page but would like to avoid it as I am up against a tight deadline.  Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">31st December 2010, 08:53</div></div><div class="posttext">You simply can not change the value of the Registry key created by '!define UNINSTALLER_FULL_PATH'.<br />
<br />
Why not? Just define it as &quot;$INSTDIR\Uninstall.exe&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">blh83</div><div class="date">3rd January 2011, 18:43</div></div><div class="posttext">Thanks MSG, but the crux of the problem is the &quot;$INSTDIR&quot; portion.  The installation directory may change if the user is given the option to do so.  This choice is not made until AFTER the registry key has been written (in my case, the key is &quot;UninstallString&quot;).  If you then go in and change the registry key once you know the correct location, it breaks everything.  The act of changing the key breaks the Remove option on the Maintenance page.  I don't know why it exhibits this behavior, but I have verified it.  If I write the registry key and don't change the install path, everything works swimmingly.  If I change the install path and then change the registry key, the Remove option is broken.<br />
<br />
I am not sure if this is making any sense.  Here is some basic code to show what I mean:<br />
<br />
!define UMUI_UNINSTALL_FULLPATH &quot;$INSTDIR\uninstall.exe&quot;  //lets say this is C:\uninstall.exe<br />
<br />
If I do nothing more and don't give the user the option to change the install directory, then everything is great.  But now I do this:<br />
<br />
!define UMUI_UNINSTALL_FULLPATH &quot;$INSTDIR\uninstall.exe&quot;<br />
<br />
  //the installer runs and the user chooses a directory and the uninstaller ends up in &quot;C:\SomeProgram\uninstall.exe&quot;<br />
<br />
Therefore I go in and change the registry key (I have done this multiple ways but lets say I delete then add):<br />
<br />
DeleteRegValue ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot;<br />
WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;C:\SomeProgram\uninstall.exe&quot;  //pretend this was not hard-coded but retrieved from the appropriate place.  This just makes it easier to see.<br />
<br />
Now when the user receives the Maintenance page, if they re-run the installer, the Remove option is not selectable: Why?.  Hopefully this makes more sense.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd January 2011, 19:39</div></div><div class="posttext">Ok, I see the problem. No idea why it'd disable the remove function... Guess you can either wait for SuperPat to show up, or modify the UMUI header files to write the uninstall regkey at a later time. (BTW, you could also check whether maybe changing the page order is an option.)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>