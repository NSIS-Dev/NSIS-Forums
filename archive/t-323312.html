<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" The installer installs nothing after a uninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  The installer installs nothing after a uninstall NSIS Discussion" />
	
	<title> The installer installs nothing after a uninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  The installer installs nothing after a uninstall</div>
<hr />
<div class="pda"><a href="t-323312.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=323312">The installer installs nothing after a uninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Romuuu</div><div class="date">21st October 2010, 10:46</div></div><div class="posttext">Hello everyone,<br />
<br />
I created an installer which check if a version of my program is already installed before the installation.<br />
If true, the installer launch the uninstaller (if the user agrees), and after the uninstall, the installation is launch.<br />
<br />
When nothing is installed, the installer copies all the files in the right place. But if a version is already installed, and if the user clicks ok, the unsinstall is ok, but when the installer finish his job, nothing is copied (the unsinstall.exe is the only thing which is copied).<br />
<br />
Someone knows this problem?<br />
<br />
Thanks in advance for your answers.<br />
<br />
Regards,<br />
Romuuu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st October 2010, 12:25</div></div><div class="posttext">Can't help much without the code.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">21st October 2010, 12:26</div></div><div class="posttext">would need more information / script code.  Typically the pseudocode would be...<br />
<br />
<br />
if previous installation detected (<br />
  run that installation's uninstaller<br />
)<br />
install<br />
<br />
<br />
There's very little that can go wrong with that in principle.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st October 2010, 12:28</div></div><div class="posttext">Are you running the uninstall using ExecWait with _?=[old_install_dir]? If you omit the _?= switch the uninstaller will spawn a new process and ExecWait will not wait. That sounds like it could be your problem.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Romuuu</div><div class="date">21st October 2010, 13:47</div></div><div class="posttext">Hi, and thanks for the answers.<br />
<br />
I forgot to specify that I am using NSIS with CMake (CPack).<br />
Here is the code :<br />
<br />
<br />
ReadRegStr $0 ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayVersion&quot;<br />
  StrCmp $0 &quot;&quot; no_other_version 0<br />
  StrCmp $0 ${PRODUCT_VERSION} 0 other_version<br />
    MessageBox MB_YESNO &quot;$delete_already_installed&quot; IDYES 0 IDNO keep_previous_installation<br />
      ReadRegStr $1 ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot;<br />
      ExecWait '&quot;$1&quot; _?=$INSTDIR' $0<br />
      IntCmp $0 0 no_other_version keep_previous_installation<br />
    keep_previous_installation:<br />
      MessageBox MB_OK &quot;$cannot_be_installed&quot; IDOK 0<br />
      Quit<br />
  other_version:<br />
    MessageBox MB_YESNO &quot;$delete_deprecated&quot; IDYES 0 IDNO no_other_version<br />
      ReadRegStr $1 ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot;<br />
      ExecWait '&quot;$1&quot; _?=$INSTDIR'<br />
  no_other_version:<br />
<br />
<br />
The installer waits the uninstaller to do his job.<br />
<br />
Thanks in advance.<br />
<br />
<br />
Regards,<br />
Romu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Romuuu</div><div class="date">21st October 2010, 13:54</div></div><div class="posttext">I found the problem.<br />
The registry was checked before running the uninstaller.<br />
Now it is checked after.<br />
<br />
Thanks for your answers, this ppost can be closed.<br />
<br />
Regards,<br />
Romu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>