<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Loop problem - unneeded extra characters, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Loop problem - unneeded extra characters NSIS Discussion" />
	
	<title> Loop problem - unneeded extra characters [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Loop problem - unneeded extra characters</div>
<hr />
<div class="pda"><a href="t-269103.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=269103">Loop problem - unneeded extra characters</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tpr</div><div class="date">6th April 2007, 22:27</div></div><div class="posttext">I have the following problem with loop. I would like to associate filetypes with MyProgram that are listed in an ini file.<br />
The ini file contains file extensions, each of them is in a new row. The loop runs well but with an error <br />
because it adds two extra characters to the end of the name of the registry key, so instead of<br />
<br />
HKCR\MyProgram.mp3<br />
<br />
it writes<br />
<br />
HKCR\MyProgram.mp3<br />
<br />
(if it cannot be seen, there's two extra square-like characters after MyProgram.mp3)<br />
<br />
However, the last item in the ini file are written correctly into the registry (no extra chars).<br />
I'm using NSIS 2.17.<br />
<br />
Here is the corresponding section of the script:<br />
<br />
Section &quot;File Associations&quot;<br />
<br />
ClearErrors<br />
FileOpen $2 &quot;Settings\FileAssociations.ini&quot; r<br />
<br />
loop:<br />
    FileRead $2 $3<br />
    StrCmp $3 &quot;&quot; done<br />
<br />
    !define Index &quot;Line${__LINE__}&quot;<br />
    ReadRegStr $1 HKCR &quot;.$3&quot; &quot;&quot;<br />
    StrCmp $1 &quot;&quot; &quot;${Index}-NoBackup&quot;<br />
    StrCmp $1 &quot;MyProgram.$3&quot; &quot;${Index}-NoBackup&quot;<br />
    WriteRegStr HKCR &quot;.$3&quot; &quot;backup_val&quot; $1<br />
    &quot;${Index}-NoBackup:&quot;<br />
    WriteRegStr HKCR &quot;.$3&quot; &quot;&quot; &quot;MyProgram.$3&quot;<br />
    ReadRegStr $0 HKCR &quot;MyProgram.$3&quot; &quot;&quot;<br />
    StrCmp $0 &quot;&quot; 0 &quot;${Index}-Skip&quot;<br />
    WriteRegStr HKCR &quot;MyProgram.$3&quot; &quot;&quot; &quot;MyProgram $3 file&quot;<br />
    WriteRegStr HKCR &quot;MyProgram.$3\shell&quot; &quot;&quot; &quot;open&quot;<br />
    WriteRegStr HKCR &quot;MyProgram.$3\DefaultIcon&quot; &quot;&quot; &quot;$EXEDIR\Settings\shell_icon.ico&quot;<br />
    &quot;${Index}-Skip:&quot;<br />
    WriteRegStr HKCR &quot;MyProgram.$3\shell\open\command&quot; &quot;&quot; \<br />
    '&quot;$EXEDIR\MyProgram.exe&quot; &quot;%1&quot;'<br />
    !undef Index<br />
Goto loop<br />
<br />
done:<br />
    FileClose $2<br />
    System::Call 'Shell32::SHChangeNotify(i 0x8000000, i 0, i 0, i 0)'<br />
SectionEnd<br />
<br />
I hope you can help me solving this. Thanks for your answers in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">6th April 2007, 22:36</div></div><div class="posttext">&quot;HKCR\MyProgram.mp3&quot; It's because of the new lines, try trim new lines<br />
<br />
http://nsis.sourceforge.net/Docs/AppendixE.html#E.2.14</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tpr</div><div class="date">6th April 2007, 23:20</div></div><div class="posttext">Thanks a lot, now it's working. Great! :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>