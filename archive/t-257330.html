<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Overwrite a file in use, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Overwrite a file in use NSIS Discussion" />
	
	<title> Overwrite a file in use [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Overwrite a file in use</div>
<hr />
<div class="pda"><a href="t-257330.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=257330">Overwrite a file in use</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pkid</div><div class="date">11th October 2006, 12:01</div></div><div class="posttext">Hi<br />
<br />
I was wondering if anybody knows how to force a file to be overwritten even if it is open?  I know that there is a Win32 API function that can unlock files but I am not sure how to use it with NSIS.  The file is on a mapped network drive.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">11th October 2006, 23:28</div></div><div class="posttext">You could try the Network Share Management Functions (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/stgmgmt/fs/network_share_management_functions.asp).<br />
Use NetFileEnum (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/stgmgmt/fs/netfileenum.asp) or NetFileGetInfo (http://msdn.microsoft.com/library/en-us/stgmgmt/fs/netfilegetinfo.asp) to get the ID of the open file, then call NetFileClose (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/stgmgmt/fs/netfileclose.asp) or NetFileClose2 (http://msdn.microsoft.com/library/en-us/netmgmt/netmgmt/netfileclose2.asp) to force the file to close.<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pkid</div><div class="date">28th February 2007, 06:28</div></div><div class="posttext">Hi<br />
<br />
Can I be a real idiot and ask for the Nullsoft script code to do this?  In my intaller I use file *.* to extract the files to the Temp folder.  I then selectively copy files from the temp folder to the install path.  Say I am trying to copy file test.dll and the copy is in use in the install path.  How would I go about unlocking it?<br />
<br />
And then how could I unlock a file if it is in a local folder and in use (e.g. would be c:\myfile.dll)<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">28th February 2007, 12:10</div></div><div class="posttext">Look in the wiki for UpgradeDll (http://nsis.sourceforge.net/UpgradeDLL_Func_function). That page has a function to do just what you're looking for.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pkid</div><div class="date">28th February 2007, 12:14</div></div><div class="posttext">I had looked at that.  The files are on a server that can't be rebooted and the users often forget to close down the application before they leave.  So we can't reboot the server, the files are locked and we need to overwrite them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">28th February 2007, 14:10</div></div><div class="posttext">Maybe this would work: rename the dlls that are locked (I suggest that you use GetTempFileName and then delete the file that it creates or the rename will fail), and then copy your new dll into the directory. New applications should load with the new version of the dll and running applications will still use the old renamed dll.<br />
<br />
You can clean up those old renamed Dll's by 'Delete /REBOOTOK $TempFileName' so that whenever the server finally gets rebooted they will be removed.<br />
<br />
Don</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>