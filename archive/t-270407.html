<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Loading Prerequisites issue, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Loading Prerequisites issue NSIS Discussion" />
	
	<title> Loading Prerequisites issue [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Loading Prerequisites issue</div>
<hr />
<div class="pda"><a href="t-270407.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270407">Loading Prerequisites issue</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">chivalri</div><div class="date">30th April 2007, 18:20</div></div><div class="posttext">For my application, I have a lot of prerequisite requirements.<br />
<br />
I decided to switch to NSIS so that I could more easily install them without having to bloat the installer to over 400MB. Now my installer is 35MB.<br />
<br />
I am having an issue with checking for prerequisites.  I look for the registry keys that these programs create; however, if I loaded the program during the running install, the registry has not been updated and thus I do not see it.<br />
<br />
Since I have several optional components that have some of the same prerequisites, this was causing me to download and install the same app several times.  I fixed this with a global variable to track which programs I already installed.<br />
<br />
Now, the only issue I have involves SQL.  I install the SQL Express and then try to use sqlcmd to load the database.  Path to sqlcmd is not loaded.  I can get around this by hard coding the full path to sqlcmd but under some circumstances this could be an issue.<br />
<br />
Is there a way to reload the registry during the install so that changes made can be seen?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th April 2007, 18:53</div></div><div class="posttext">The registry is always synchronous. There's no need to reload it anywhere. You probably mean environment variables. Those are only loaded once when the process starts or when a special message is sent, and even then, only by explorer.exe. <br />
<br />
The best you can probably do in this case is get the explicit path of sqlcmd.exe, from the registry or elsewhere, and use that instead of relying on it being found in the PATH.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">chivalri</div><div class="date">30th April 2007, 20:12</div></div><div class="posttext">I appreciate your quick response.  Here is a code snip<br />
<br />
!macro CheckWMV <br />
  DetailPrint &quot;Checking for WMV files...&quot;<br />
<br />
  ReadRegStr $R1 HKLM &quot;SOFTWARE\Microsoft\WMV9_VCM&quot; &quot;File Location&quot;<br />
IfErrors 0 GOTWMV<br />
  DetailPrint &quot;Beginning download of wmv9VCM.&quot;<br />
  NSISDL::download ${WMVVCM_URL} &quot;$TEMP\wmv9VCMsetup.exe&quot;<br />
  DetailPrint &quot;Completed download.&quot;<br />
  Pop $0<br />
  ${If} $0 == &quot;cancel&quot;<br />
    MessageBox MB_YESNO|MB_ICONEXCLAMATION &quot;Download cancelled.  Continue Installation?&quot; IDYES GOTWMV IDNO GOTWMV<br />
  ${ElseIf} $0 != &quot;success&quot;<br />
    MessageBox MB_YESNO|MB_ICONEXCLAMATION &quot;Download failed:$\n$0$\n$\nContinue Installation?&quot; IDYES GOTWMV IDNO GOTWMV<br />
  ${EndIf}<br />
  DetailPrint &quot;Pausing installation while downloaded wmv9VCM installer runs.&quot;<br />
  ExecWait '$TEMP\wmv9VCMsetup.exe /q'<br />
  DetailPrint &quot;Completed wmv9VCM install/update. Removing installer.&quot;<br />
  Delete &quot;$TEMP\wmv9VCMsetup.exe&quot;<br />
  DetailPrint &quot;wmv9VCM installer removed.&quot;<br />
GOTWMV:<br />
  DetailPrint &quot;Proceeding with remainder of installation.&quot;<br />
!macroend <br />
<br />
This is a sample of how I have been checking.  I run this code in one section, it checks and gets an error when reading the registry so it downloads the setup file and installs it.  If I rerun my installer, any further calls to this code get a good read and thus we skip the d/l.<br />
<br />
If during the same instance the file gets d/l, a second section calls this code, the registry still does not show the data and thus we d/l again.<br />
<br />
I fixed this by using a global variable to indicate that wmv9vcm was already installed once this instance; however, I don't like using global variables in general and would like to know how to make this work without.<br />
<br />
The sql path is also in the registry (that is where I pull it from) however, I can also get the environment path.<br />
<br />
As I said, I have things working but I don't like having the path hard coded in case the sql files are not installed in C:\Program Files\Microsoft SQL Server\....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th May 2007, 11:31</div></div><div class="posttext">You must use ClearErrors before ReadRegStr or else you might catch errors that occurred earlier in the script.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>