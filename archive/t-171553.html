<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Dialog APIs, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Dialog APIs NSIS Discussion" />
	
	<title> Dialog APIs [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Dialog APIs</div>
<hr />
<div class="pda"><a href="t-171553.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=171553">Dialog APIs</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">29th February 2004, 21:46</div></div><div class="posttext">I tried to use it using System.dll, but without success. Its structure is more complex than other ones I saw before:<br />
<br />
!define _OPENFILENAME &quot;(i, i, i, t, t, i, i, t, i, t, i, t, t, i, i, i, t, t, t, t, v, i, i) i&quot;<br />
<br />
FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
<br />
System::Call &quot;*${_OPENFILENAME}(400, r0,,,,, 0, 'Test.exe', 256,, 256, 'C:\', 'Open Test',,,,'exe',,,, 0,,) .r0&quot;<br />
<br />
System::Call &quot;Comdlg32::GetOpenFileNameA(t) i(r0) e.r1&quot;<br />
<br />
<br />
<br />
Everytime I try to change it and use &quot;GetLastError&quot; API after, GetLastError returns 71-75.<br />
<br />
I really need this, I'm using a ListBox with several sound files to play, and if the user wants to change one of them, he/she needs to click in a button to appear the &quot;Open File&quot; dialog.<br />
<br />
I have:<br />
<br />
WinXP<br />
NSIS Latest Development version from today.<br />
<br />
<br />
(I'm trying the Color Dialogbox, but not sufficient to debug it yet)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">29th February 2004, 23:35</div></div><div class="posttext">System::Call &quot;Comdlg32::GetOpenFileNameA(t) i(r0) e.r1&quot;I've not studied it all, but at first glance this line seems wrong. I think it should be ...GetOpenFileNameA(i)...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">1st March 2004, 22:03</div></div><div class="posttext">Nope, it continues not working...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">3rd March 2004, 23:21</div></div><div class="posttext">I've managed to get a working test version.<br />
<br />
I think the problem might be that &quot;t&quot; paramaters are only meant for function parameters directly, not structure members. All structure members that point to strings have to be allocated separately.<br />
<br />
It's only the most basic example, but hopefully you get the idea.Name &quot;GetOpenFileName Test&quot;<br />
OutFile GetOpenFileName.exe<br />
Section<br />
  SetPluginUnload alwaysoff<br />
  System::Alloc ${NSIS_MAX_STRLEN}<br />
  Pop $1<br />
  System::Call &quot;*(&amp;l4, i$HWNDPARENT, i, i, i, i, i, \<br />
                  ir1, i${NSIS_MAX_STRLEN}, i, i, i, i, \<br />
                  i, &amp;i2, &amp;i2, i, i, i, i) i.r0&quot;<br />
  System::Call &quot;comdlg32::GetOpenFileNameA(ir0) i.r9&quot;<br />
  IntCmp $9 0 failed<br />
    System::Call &quot;*$1(&amp;t${NSIS_MAX_STRLEN}.r9)&quot;<br />
    MessageBox MB_OK $9<br />
failed:<br />
  System::Free $0<br />
  SetPluginUnload manual<br />
  System::Free $1<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">4th March 2004, 03:08</div></div><div class="posttext">Great! Thanks eccles!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>