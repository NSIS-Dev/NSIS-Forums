<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install files directly on a FTP Server, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install files directly on a FTP Server NSIS Discussion" />
	
	<title> Install files directly on a FTP Server [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install files directly on a FTP Server</div>
<hr />
<div class="pda"><a href="t-258716.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258716">Install files directly on a FTP Server</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">1st November 2006, 10:39</div></div><div class="posttext">Hello,<br />
is it possible to upload files directly on a FTP Server?<br />
<br />
If it is.. is there perhaps anywhere an example?<br />
<br />
I've seen this installer but I don't now if that's NSIS:<br />
<br />
http://www.cs-erweiterungen.de/3.jpg<br />
<br />
Thank you :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st November 2006, 10:44</div></div><div class="posttext">A very quick forum search for &quot;ftp upload&quot; will give your answer:<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=198596&amp;perpage=40&amp;highlight=ftp+upload&amp;pagenumber=4<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=255424&amp;highlight=ftp+upload<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=174093&amp;highlight=ftp+upload<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=218313&amp;highlight=ftp+upload<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=186466&amp;highlight=ftp+upload</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">1st November 2006, 14:55</div></div><div class="posttext">Yes, I've already used the forum search. I've only found this ftpul-plugin:<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=174093&amp;highlight=ftp+upload<br />
<br />
But unfortunately it is unstable.. and in the installation one can't define a host..<br />
<br />
The plugin inetc(lient) looks very good but this is only to download from a FTP. Right?<br />
<br />
Gives it an other plugin which I've not seen?<br />
<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st November 2006, 15:03</div></div><div class="posttext">Originally posted by Sp33dy G0nz4l3s <br />
The plugin inetc(lient) looks very good but this is only to download from a FTP. Right?Wrong. According to that specific page of thread that I've linked to, it supports FTP upload. And if it doesn't support, or doesn't work, it still suggests an alternative of using ftp.exe from $SYSDIR with the -s switch for scripting.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">1st November 2006, 15:05</div></div><div class="posttext">I remember &quot;put&quot; entry point in Inetc plug-in ;) http://nsis.sourceforge.net/Inetc_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">1st November 2006, 15:37</div></div><div class="posttext">Ah thanks :).. Now I understand these entry points.<br />
<br />
But in the example the Username... to the FTP Server are defined in the .nsi:<br />
<br />
inetc::put /POPUP /CAPTION &quot;my local ftp upload&quot; &quot;ftp://takhir:pwd@p320/m2.bu.jpg&quot; &quot;$EXEDIR\m2.jpg&quot;<br />
<br />
I've no idea how I can make no a custom page like in the picture I posted. So that the user can write the host... in a field and click after this on the connect button and choose the directory.<br />
<br />
It would be very friendly if someone could help me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">1st November 2006, 16:05</div></div><div class="posttext">You can define user vars and read current values from custom page ini file to vars, then use them in the command line:<br />
&quot;ftp://$user:$password@$server:$port/$os/$path/$addon&quot;<br />
(if I added port correct :) ). But 'ls' not supported - cannot browse folders. And 'passive' is always 'on'.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">1st November 2006, 21:51</div></div><div class="posttext">Thank you Takhir I will try it :)<br />
<br />
But first I've an other question:<br />
<br />
My installer consists of a lot of files.<br />
<br />
Must I now write to every file the &quot;Upload Code&quot;?<br />
<br />
..or gives it the possibility that I indicate a folder and the uploader upload it with all files and subfolders.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">2nd November 2006, 06:55</div></div><div class="posttext">You must define every file you want to upload. I remember a lot of FindFirst-FindNext scripts samples in this forum. You also can use SetPluginUnload alwaysoff option - this makes calls a bit faster. Few url/file pairs supported in the single command line, but this may be not usefull in the dir scan loop, and string length limit 1024 bytes also presents.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">2nd November 2006, 10:41</div></div><div class="posttext">Okay.. I've now searched a long time FindFirst-FindNext scripts and I've founded some topics, too. I've also read FindFirst/FindNext in the user manual..<br />
<br />
..but I don't understand for what I can use this that I don't must define every file.<br />
<br />
Please help me</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">3rd November 2006, 08:35</div></div><div class="posttext">Couldn't anybody explain me please how to use FindFirst/FindNext?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">4th November 2006, 20:00</div></div><div class="posttext">Something like this<br />
Name &quot;Inetc Dir Scanner Test&quot;<br />
OutFile &quot;scanner.exe&quot;<br />
<br />
!include &quot;MUI.nsh&quot;<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro GetFileAttributes<br />
<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
<br />
  FindFirst $0 $1 &quot;$EXEDIR\*&quot;<br />
loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  ${GetFileAttributes} &quot;$EXEDIR\$1&quot; DIRECTORY $2<br />
  IntCmp $2 1 cont<br />
  Inetc::put ftp://*********.com/$1 &quot;$EXEDIR\$1&quot;<br />
  Pop $3<br />
  DetailPrint &quot;$1 $3&quot;<br />
cont:<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
  SetDetailsView show<br />
<br />
SectionEnd<br />
If you need recurcive scan - use forum search.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">5th November 2006, 09:08</div></div><div class="posttext">Thanks a lot Takhir!<br />
<br />
It works fine. I've now only a little problem:<br />
<br />
This is my code now:<br />
<br />
<br />
;--------------------------------<br />
; General Attributes<br />
<br />
Name &quot;Inetc Test&quot;<br />
OutFile &quot;put.exe&quot;<br />
<br />
<br />
;--------------------------------<br />
;Interface Settings<br />
<br />
!include &quot;MUI.nsh&quot;<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install-colorful.ico&quot;<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro GetFileAttributes<br />
<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
	<br />
	SetOutPath &quot;$PROGRAMFILES\TEST&quot;<br />
	File &quot;Test1.txt&quot;<br />
	File &quot;Test2.txt&quot;<br />
	SetOutPath &quot;$PROGRAMFILES\TEST\TEST&quot;<br />
	File &quot;TEST\Test3.txt&quot;<br />
<br />
  FindFirst $0 $1 &quot;$PROGRAMFILES\TEST\*&quot;<br />
loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  ${GetFileAttributes} &quot;$PROGRAMFILES\TEST\$1&quot; DIRECTORY $2<br />
  IntCmp $2 1 cont<br />
  Inetc::put /POPUP /CAPTION &quot;my local ftp upload&quot; &quot;ftp://*********.com/html/$1&quot; &quot;$PROGRAMFILES\TEST\$1&quot;<br />
cont:<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
<br />
	Pop $3 # return value = exit code, &quot;OK&quot; if OK<br />
	MessageBox MB_OK &quot;Upload Status: $3&quot;<br />
<br />
SectionEnd<br />
<br />
The upload is always shown in the popup window. When I close now this popup window (cancel the upload) normally the MessageBox Upload Status: terminated should be shown and the upload should be terminated.<br />
<br />
But with this code always a new upload popup windows is shown and the next file would be uploadet. Could you say me how I must change the code that the upload is then completely terminated?<br />
<br />
Thank you<br />
Marc</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">5th November 2006, 11:16</div></div><div class="posttext">Please note, that in my sample Pop $3 is in loop. This because every Inetc call Pushes one string to stack, so in your variant only last string appears in the MessageBox (all other results remain in stack). So add below plug-in call (not tested)<br />
  Pop $3<br />
  StrCmp $3 &quot;OK&quot; cont<br />
  MessageBox MB_YESNO &quot;Download failed/terminated. Continue?&quot; IDYES cont<br />
  Abort &quot;Terminated by user&quot;<br />
cont:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">5th November 2006, 16:48</div></div><div class="posttext">Thanks now it works and I understand it!<br />
<br />
Only one question:<br />
With this code now the Installer upload all files from the folder $PROGRAMFILES\TEST:<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
	<br />
	SetOutPath &quot;$PROGRAMFILES\TEST&quot;<br />
	File &quot;Test1.txt&quot;<br />
	File &quot;Test2.txt&quot;<br />
	SetOutPath &quot;$PROGRAMFILES\TEST\TEST&quot;<br />
	File &quot;TEST\Test3.txt&quot;<br />
<br />
  FindFirst $0 $1 &quot;$PROGRAMFILES\TEST\*&quot;<br />
loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  ${GetFileAttributes} &quot;$PROGRAMFILES\TEST\$1&quot; DIRECTORY $2<br />
  IntCmp $2 1 cont<br />
  Inetc::put /POPUP /CAPTION &quot;my local ftp upload&quot; &quot;ftp://*********.com/html/$1&quot; &quot;$PROGRAMFILES\TEST\$1&quot;<br />
	Pop $3<br />
  StrCmp $3 &quot;OK&quot; cont<br />
  MessageBox MB_YESNO &quot;Download failed/terminated. Continue?&quot; IDYES cont<br />
  Abort &quot;Terminated by user&quot;<br />
cont:<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
<br />
SectionEnd<br />
<br />
Now the installer should also upload all files from the folder $PROGRAMFILES\TEST\TEST how must I change/extend the code that he do this? I tried a lot of things but nothing has work:<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
	<br />
	SetOutPath &quot;$PROGRAMFILES\TEST&quot;<br />
	File &quot;Test1.txt&quot;<br />
	File &quot;Test2.txt&quot;<br />
	SetOutPath &quot;$PROGRAMFILES\TEST\TEST&quot;<br />
	File &quot;TEST\Test3.txt&quot;<br />
<br />
  FindFirst $0 $1 &quot;$PROGRAMFILES\TEST\*&quot;<br />
loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  ${GetFileAttributes} &quot;$PROGRAMFILES\TEST\$1&quot; DIRECTORY $2<br />
  IntCmp $2 1 cont<br />
  Inetc::put /POPUP /CAPTION &quot;my local ftp upload&quot; &quot;ftp://*********.com/html/$1&quot; &quot;$PROGRAMFILES\TEST\$1&quot;<br />
	Pop $3<br />
  StrCmp $3 &quot;OK&quot; cont<br />
  MessageBox MB_YESNO &quot;Download failed/terminated. Continue?&quot; IDYES cont<br />
  Abort &quot;Terminated by user&quot;<br />
cont:<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
<br />
FindFirst $4 $5 &quot;$PROGRAMFILES\TEST\TEST\*&quot;<br />
loop:<br />
  StrCmp $5 &quot;&quot; done<br />
  ${GetFileAttributes} &quot;$PROGRAMFILES\TEST\TEST\$5&quot; DIRECTORY $6<br />
  IntCmp $6 5 cont<br />
  Inetc::put /POPUP /CAPTION &quot;my local ftp upload&quot; &quot;ftp://*********.com/html/TEST/$5&quot; &quot;$PROGRAMFILES\TEST\TEST\$5&quot;<br />
	Pop $7<br />
  StrCmp $7 &quot;OK&quot; cont<br />
  MessageBox MB_YESNO &quot;Download failed/terminated. Continue?&quot; IDYES cont<br />
  Abort &quot;Terminated by user&quot;<br />
cont:<br />
  FindNext $4 $5<br />
  Goto loop<br />
done:<br />
<br />
SectionEnd<br />
<br />
Thanks for your help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">5th November 2006, 17:33</div></div><div class="posttext">You can use the same variables in the second part ($0 - $3), but need new labels there, for example loop2 instead of loop (compiller probably says about this in error message). Better way - decorate upload code as a function and call it twice with some variable for path (if 2 folders only to be uploaded). If you want to upload all subfolders - you need a recursive call, I am not sure this is possible in script, but forum search gives this thread http://forums.winamp.com/showthread.php?s=&amp;threadid=201394&amp;highlight=recursive+findfirst</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">5th November 2006, 19:17</div></div><div class="posttext">I understand what you are meaning with call the upload as a function. I've try it but I couldn't create it..<br />
<br />
Yes, I would upload all subfolders. I've read so the site from the link you've posted very often but I don't undertstand how i can adapt it in my code.<br />
<br />
If someone could help me it would be very friendly.<br />
<br />
..otherwise I must define every folder individually like Takhir writes it. Thanks for the help concerning this problem Takhir :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">5th November 2006, 20:09</div></div><div class="posttext">you're missing two things:<br />
1. you only can have one label of the same name in a section or function.<br />
2. you need to close your search after finishing it.<br />
<br />
this is the fixed version of your last code listing:<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
	<br />
	SetOutPath &quot;$PROGRAMFILES\TEST&quot;<br />
	File &quot;Test1.txt&quot;<br />
	File &quot;Test2.txt&quot;<br />
	SetOutPath &quot;$PROGRAMFILES\TEST\TEST&quot;<br />
	File &quot;TEST\Test3.txt&quot;<br />
<br />
  FindFirst $0 $1 &quot;$PROGRAMFILES\TEST\*&quot;<br />
loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  ${GetFileAttributes} &quot;$PROGRAMFILES\TEST\$1&quot; DIRECTORY $2<br />
  IntCmp $2 1 cont<br />
  Inetc:ut /POPUP /CAPTION &quot;my local ftp upload&quot; &quot;ftp://*********.com/html/$1&quot; &quot;$PROGRAMFILES\TEST\$1&quot;<br />
	Pop $3<br />
  StrCmp $3 &quot;OK&quot; cont<br />
  MessageBox MB_YESNO &quot;Download failed/terminated. Continue?&quot; IDYES cont<br />
  Abort &quot;Terminated by user&quot;<br />
cont:<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
  FindClose $0<br />
<br />
FindFirst $4 $5 &quot;$PROGRAMFILES\TEST\TEST\*&quot;<br />
loop2:<br />
  StrCmp $5 &quot;&quot; done2<br />
  ${GetFileAttributes} &quot;$PROGRAMFILES\TEST\TEST\$5&quot; DIRECTORY $6<br />
  IntCmp $6 5 cont2<br />
  Inetc:ut /POPUP /CAPTION &quot;my local ftp upload&quot; &quot;ftp://*********.com/html/TEST/$5&quot; &quot;$PROGRAMFILES\TEST\TEST\$5&quot;<br />
	Pop $7<br />
  StrCmp $7 &quot;OK&quot; cont2<br />
  MessageBox MB_YESNO &quot;Download failed/terminated. Continue?&quot; IDYES cont2<br />
  Abort &quot;Terminated by user&quot;<br />
cont2:<br />
  FindNext $4 $5<br />
  Goto loop2<br />
done2:<br />
  FindClose $4<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">6th November 2006, 09:05</div></div><div class="posttext">It was found ( :) ) that recursion works in NSIS script http://nsis.sourceforge.net/Recursive_Upload</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">6th November 2006, 16:04</div></div><div class="posttext">WOW thanks a lot Takhir.<br />
<br />
I've now only the problem that I can't upload the files.<br />
<br />
I've defined the password, username and server in the variable $url<br />
<br />
Example:<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
 <br />
  SetDetailsView hide<br />
  StrCpy $path &quot;$PROGRAMFILES\TEST&quot;<br />
  StrCpy $url ftp://username:pw@server.com/html<br />
  Call dirul<br />
  SetDetailsView show<br />
 <br />
SectionEnd <br />
<br />
.. but when I start the installer I get always an error and in the details is the following text:<br />
<br />
200 Switching to Binary mode.<br />
2Unauthorized (401) C:\Programme\TEST\Test1.txt<br />
terminated by user<br />
<br />
Do you know what's wrong?<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">6th November 2006, 19:51</div></div><div class="posttext">What means  in you script sample? May be simply<br />
StrCpy $url [url]ftp://username:pwd@server.com/html<br />
Edited: forum' php added [url] to my script too :) BTW I don't see 401 in the ftp error codes (http://www.coolpagehelp.com/index.html?row2col2=error_codes.html) - please check url correctness, plug-in threats it as http. I can test it again in office tomorrow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">6th November 2006, 20:22</div></div><div class="posttext">Yes that's right.. it's not a ftp error.<br />
<br />
I checked the url now again and it sould be correct. Here the url only with an other password:<br />
<br />
ftp://web4:pwd@web254.billhost.de/html<br />
<br />
I've try the url with the &quot;original&quot; code and there it works.<br />
<br />
Thanks for your help :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">7th November 2006, 07:41</div></div><div class="posttext">I fixed one bug (take new version from wiki), but found the problem - all files appears at the same folder. It is possible to modify script and update url as it was done for local file path<br />
  Push $path<br />
  Push $url<br />
  StrCpy $path &quot;$path\$1&quot;<br />
  StrCpy $url &quot;$url/$1&quot;<br />
  Call dirul<br />
  Pop $url<br />
  Pop $path<br />
but current plug-in version not creates sub-directories on the ftp server, so folder must exist for this version. <br />
Also, path from 'ftp root' should be used for server, not relative to the user's home folder, for example ftp://myftp.com/home/user/uploads<br />
And local archive creation and single zip/7z file upload should work as well :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sp33dy G0nz4l3s</div><div class="date">7th November 2006, 20:30</div></div><div class="posttext">Takhir, thank you for your help :)<br />
<br />
It works now without problems. Unfortunately for my installer it's necessary that the sub-directories would be provided.<br />
<br />
Perhaps if you've the time and change sometime the plug-in that it creates the sub-directories it would be very friendly if contact me.. about this thread or a pm.<br />
<br />
-Marc</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">12th November 2006, 12:57</div></div><div class="posttext">New version uploaded, features:<br />
- ftp server path creation for 'put' calls;<br />
- both relative (to user' home dir) and ablolute paths support (&quot;host/path&quot; and &quot;host//path&quot;).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>