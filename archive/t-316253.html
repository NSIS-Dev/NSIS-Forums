<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsDialogs and control Z-order, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsDialogs and control Z-order NSIS Discussion" />
	
	<title> nsDialogs and control Z-order [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsDialogs and control Z-order</div>
<hr />
<div class="pda"><a href="t-316253.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316253">nsDialogs and control Z-order</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">14th January 2010, 23:28</div></div><div class="posttext">Greetings. I am trying to add an &quot;Installation Help&quot; link on the MUI 2 Welcome page. <br />
<br />
The first problem I had was the Link not showing up as blue and underlined. I fixed that and got the link appearing and functioning with the following code:<br />
<br />
Function PageFunction_WelcomeShow<br />
;modify the MUI2 Welcome page to include an installation help link<br />
<br />
    ;create the installation help link<br />
    ${NSD_CreateLink} 120u 183u 135u 14u &quot;$(Page_Welcome_Link)&quot;<br />
    ; pop the label HWND off of the stack<br />
    Pop $Link_InstallHelp<br />
    ;welcome page fonts/colors are different from other pages, so force the help link to Blue and the current MUI background color<br />
    SetCtlColors $Link_InstallHelp &quot;0x000080&quot; &quot;${MUI_BGCOLOR}&quot;<br />
    ;font should be Blue now, but it won't be underlined, so we need to fix it.<br />
    CreateFont $Link_InstallHelp_font &quot;$(^Font)&quot; &quot;$(^FontSize)&quot; /UNDERLINE<br />
    SendMessage $Link_InstallHelp ${WM_SETFONT} $Link_InstallHelp_font 0<br />
<br />
    GetFunctionAddress $R0 PageFunction_Welcome_LinkClick<br />
    nsDialogs::OnClick $Link_InstallHelp $R0<br />
<br />
FunctionEnd ;PageFunction_WelcomeShow<br />
<br />
The only problem I have is that it seems that the MUI Welcome label control extends down and slightly overlaps the link control that I have created.<br />
<br />
In other programming languages, I can use a .SendToFront command on a control to fix this, but after much searching and source code dumpster-diving, I haven't been able to figure it out in NSIS and MUI and nsDialogs.<br />
<br />
How does one send a control to the front on the MUI2 Welcome page via nsDialogs or with SendMessage? Is there some other solution I can use?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">15th January 2010, 09:00</div></div><div class="posttext">How does one send a control to the front on the MUI2 Welcome page via nsDialogs or with SendMessage? Is there some other solution I can use? <br />
You can call any API command by calling the appropriate DLL function through the system plugin. But it is generally a bad idea to mess with window order, you're much better off calling the getwindowrect and setwindowpos functions to decrease the label size.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">15th January 2010, 17:16</div></div><div class="posttext">Thanks for the reply. I will see what I can pull off with that.<br />
<br />
I still wish there was a SendToFront thing I could pull off, because I know it would solve the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">15th January 2010, 18:14</div></div><div class="posttext">user32::SetWindowPos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">15th January 2010, 20:02</div></div><div class="posttext">I have tried this, but I can still see that the top of my Link text is being cut off<br />
<br />
Function PageFunction_WelcomeShow<br />
;modify the MUI2 Welcome page to include an installation help link<br />
<br />
    ;create the installation help link<br />
    ${NSD_CreateLink} 120u 183u 135u 14u &quot;$(Page_Welcome_Link)&quot;<br />
    ; pop the label HWND off of the stack<br />
    Pop $Link_InstallHelp<br />
    ;welcome page fonts/colors are different from other pages, so force the help link to Blue and the current MUI background color<br />
    SetCtlColors $Link_InstallHelp &quot;0x000080&quot; &quot;${MUI_BGCOLOR}&quot;<br />
    ;font should be Blue now, but it won't be underlined, so we need to fix it.<br />
    CreateFont $Link_InstallHelp_font &quot;$(^Font)&quot; &quot;$(^FontSize)&quot; /UNDERLINE<br />
    SendMessage $Link_InstallHelp ${WM_SETFONT} $Link_InstallHelp_font 0<br />
<br />
    ;HACK! - try to set the Link control to the top<br />
!define SWP_NOSIZE 0x0001<br />
!define SWP_NOMOVE 0x0002<br />
!define HWND_TOPMOST -1<br />
    System::Call &quot;User32::SetWindowPos(i, i, i, i, i, i, i) b ($Link_InstallHelp, ${HWND_TOPMOST}, 0, 0, 0, 0, ${SWP_NOSIZE}|${SWP_NOMOVE})&quot;<br />
<br />
    GetFunctionAddress $R0 PageFunction_Welcome_LinkClick<br />
    nsDialogs::OnClick $Link_InstallHelp $R0<br />
<br />
FunctionEnd ;PageFunction_WelcomeShow<br />
<br />
I have also tried replacing ${SWP_NOSIZE}|${SWP_NOMOVE} with 3 and it still shows as cut off.<br />
<br />
I must still be missing something. I will try again later this afternoon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">16th January 2010, 18:37</div></div><div class="posttext">you can't use topmost on a child window, try just hwnd_top</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">17th January 2010, 22:11</div></div><div class="posttext">Thank you so much Anders; that was it. Here is the final working code. Maybe, once the project is shipped I will write this up for the wiki<br />
<br />
Function PageFunction_WelcomeShow<br />
;modify the MUI2 Welcome page to include an installation help link<br />
<br />
    ;create the installation help link<br />
    ${NSD_CreateLink} 120u 182u 135u 14u &quot;$(Page_Welcome_Link)&quot;<br />
    ; pop the label HWND off of the stack<br />
    Pop $Link_InstallHelp<br />
    ;welcome page fonts/colors are different from other pages, so force the help link to Blue and the current MUI background color<br />
    SetCtlColors $Link_InstallHelp &quot;0x000080&quot; &quot;${MUI_BGCOLOR}&quot;<br />
    ;font should be Blue now, but it won't be underlined, so we need to fix it.<br />
    CreateFont $Link_InstallHelp_font &quot;$(^Font)&quot; &quot;$(^FontSize)&quot; /UNDERLINE<br />
    SendMessage $Link_InstallHelp ${WM_SETFONT} $Link_InstallHelp_font 0<br />
<br />
    ;move these defines to someplace better in your code<br />
!define SWP_NOSIZE 0x0001<br />
!define SWP_NOMOVE 0x0002<br />
!define HWND_TOP 0x0000<br />
    ;set the Link control on top of the Welcome label text<br />
    System::Call &quot;User32::SetWindowPos(i, i, i, i, i, i, i) b ($Link_InstallHelp, ${HWND_TOP}, 0, 0, 0, 0, ${SWP_NOSIZE}|${SWP_NOMOVE})&quot;<br />
<br />
    GetFunctionAddress $R0 PageFunction_Welcome_LinkClick<br />
    nsDialogs::OnClick $Link_InstallHelp $R0<br />
<br />
FunctionEnd ;PageFunction_WelcomeShow</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>