<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Windows Installer (MSI), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Windows Installer (MSI) NSIS Discussion" />
	
	<title> Windows Installer (MSI) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Windows Installer (MSI)</div>
<hr />
<div class="pda"><a href="t-121559.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=121559">Windows Installer (MSI)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">isaiahbarney</div><div class="date">15th January 2003, 18:04</div></div><div class="posttext">Will there ever be consideration for support of Windows Installer, .msi, .msm. extensions, etc.<br />
I would love to help such developement. I am sure others would too.<br />
A Windows Installer table can be created that is fast and has little overhead. I thought maybe in the future NSIS could include support for .msi functions.<br />
<br />
Just a thought.<br />
:p <br />
:cool:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th January 2003, 18:32</div></div><div class="posttext">This kind of a change is quite huge. Let us first finish NSIS 2 :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">16th January 2003, 18:39</div></div><div class="posttext">A great idea, but I agree with kichik. By the way, reading msi-files also comes with a lot of changes to the code, and not all functions are supported.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">22nd March 2006, 10:35</div></div><div class="posttext">I thought about MSI again (compare http://forums.winamp.com/showthread.php?s=&amp;threadid=241434) and have some ideas to share.<br />
<br />
I think, reading MSI might be one thing but the bigger advantage I see would be storing standard NSIS installers as MSI package so companies can use MSI to deploy packages to machines automatically. NSIS support /S (silent) but this does not integrate into Microsoft standard tools.<br />
<br />
One basic idea (already posted somewhere) is to build a simple MSI package just containing the installer.exe and calling this on the target machine using some start-up registry key. This would require rebooting.<br />
<br />
On other idea: MSI packages can contain COM dlls. We could use a fake COM dll which as DllRegisterServer implemented. This DLL could contain the NSIS installer (data after the code) and the DllregisterServer could extract the installer and run it with /S (silent). This way we could use some static wrapper dll (kind of stub, could be included by NSIS) and don't have to change anything within our installers (I don't want to limit the actions to standard MSI actions, so translation my scripts is no option to me -- that's why I use NSIS). And this would not require reboot (in general). Maybe giving the reboot flag of NSIS back to MSI would be a good idea, too.<br />
<br />
The only thing we would need to add to our scripts:<br />
<br />
OutFileMsi &quot;myinstaller.msi&quot;<br />
<br />
Any more thoughts/ideas out there?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sgt-d</div><div class="date">24th October 2006, 21:40</div></div><div class="posttext">i am dying for a good msi packager and nsis would dominate in this area.<br />
<br />
even if it was just an msi that would contain an exe inside and then execute it - that would be better than nothing at all.<br />
<br />
right now the only tools out there are total crap, or crippled freeware.<br />
<br />
even still, i don't want to learn how to program my installer differently...  the exe's i make with nsis can do some very tricky stuff.  i don't want to have to figure out how to get everything to work via msi programming just because i am forced to use msi files for active directory installations.<br />
<br />
it's bad enough i have to repackage all of my exe's that microsoft now considers &quot;legacy software&quot;.<br />
<br />
what a crock of sh--!<br />
<br />
anyway, any decent workable nsis-msi solution right now would PWN.<br />
<br />
thanks,<br />
<br />
sgt</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">26th October 2006, 09:16</div></div><div class="posttext">I've already build a basic dll implementing DllRegisterServer which runs some EXE. Currently cannot find time to continue this.<br />
<br />
One problem is to get the installer to the disk. It cannot be extracted by DllRegisterServer itself because DllRegisterServer does not know the path of the dll itself (without process list tricks). Currently I plan this solution:<br />
Build an MSI containing EXE and fake-DLL. First extract EXE, then store EXE's path somewhere (registry?), then extract fake-DLL and register it (dll runs EXE).<br />
<br />
One more problem: What about reboot? It would be great if the MSI installer knows whether to reboot. So we would have to store the reboot flag when quitting NSIS installer (e.g. registry) and DllRegisterServer or MSI &quot;script&quot; should read this value and see it as MSI reboot flag. Does someone know how reboot in MSI works?<br />
<br />
I already tried ORCA (MS Platform SDK) and WiX for building/editing MSI. Had no time to continue here (I think WiX is the better solution).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th October 2006, 12:25</div></div><div class="posttext">The DLL can figure out its path by saving hInstance in DllMain and then using it with GetModuleFileName. To pass on the reboot flag, you can use the error level value (http://nsis.sourceforge.net/Docs/AppendixD.html#D.1).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">12th January 2007, 10:22</div></div><div class="posttext">@kichik: How to get the error level value back to Windows Installer? AFAIK error level is something an exe file will &quot;return&quot; (process attribute). What I want to do is calling DllRegisterServer on some DLL.<br />
<br />
I could easily store the reboot flag into registry or in some file. How to get MSI to &quot;read&quot; this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th January 2007, 18:12</div></div><div class="posttext">I don't know how MSI handles this. It probably has some kind of ProcessExitCode property in its database.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">16th January 2007, 10:16</div></div><div class="posttext">Correct, I've done this. It is a programmers nightmare to do however.<br />
<br />
If one one wants to go the NSIS way with MSI packages:<br />
<br />
You NEED the ORCA tool from Microsoft and then create an custom action which calls your silent NSIS setup exe.<br />
<br />
TIP:<br />
I think you better start using MAKEMSI ( http://www.dennisbareis.com/ )  it free and quite easy to learn.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rossi323</div><div class="date">29th January 2007, 10:38</div></div><div class="posttext">hello, <br />
<br />
when is it planned to integrate MSI-package creation into NSIS?<br />
<br />
now we have running our setup-routines under nullsoft, but for Windows Vista Certification, we aspire in the next half year, we need MSI packages. <br />
<br />
it will save a lot of work to us, when not to reorganize our setups. <br />
<br />
Thanks in advance<br />
Thomas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">29th January 2007, 11:14</div></div><div class="posttext">... &quot;but for Windows Vista Certification, we aspire in the next half year, we need MSI packages&quot;... <br />
<br />
&quot;aspire&quot; ? I'm more tempted to say you are forced by Microsoft. Note that not even all their Windows Vista apps come in MSI packages.<br />
<br />
Note that MSI is very limited to what an installer should do (not taking into account custom action ofcourse)<br />
<br />
Anyhow, feel free to help improving NSIS and MSI combination by writing your efforts and solution in a Wiki.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>