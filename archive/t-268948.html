<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" InstallLib and vista..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  InstallLib and vista... NSIS Discussion" />
	
	<title> InstallLib and vista... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  InstallLib and vista...</div>
<hr />
<div class="pda"><a href="t-268948.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268948">InstallLib and vista...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kinar</div><div class="date">4th April 2007, 19:59</div></div><div class="posttext">I'm having problems that while using installib on a vista machine that it doesnt seem to work.  <br />
<br />
I searched the forums but wasn't able to find anything that helped me figure this out and the documentation for InstallLib seems to be non-existant (or at least I havent been able to find it)<br />
<br />
On every other version of windows the following code works (or at least it has the desired effect of allowing my application to run) but on vista the files get copied but they do not get registered.<br />
<br />
Here is the code:<br />
<br />
;at the top of script<br />
RequestExecutionLevel admin<br />
<br />
;later on in script<br />
Section &quot;MFC Files&quot;<br />
  StrCpy $ALREADY_INSTALLED 0<br />
  <br />
  SetOutPath &quot;$SYSDIR&quot;<br />
<br />
  IfFileExists &quot;$SYSDIR\MFC42.dll&quot; 0 +2<br />
    StrCpy $ALREADY_INSTALLED 1<br />
    !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED ..\MFC\MFC42.dll $SYSDIR\MFC42.dll $SYSDIR<br />
  StrCpy $ALREADY_INSTALLED 0<br />
  IfFileExists &quot;$SYSDIR\MFC42u.dll&quot; 0 +2<br />
    StrCpy $ALREADY_INSTALLED 1<br />
    !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED ..\MFC\MFC42u.dll $SYSDIR\MFC42u.dll $SYSDIR<br />
  StrCpy $ALREADY_INSTALLED 0<br />
  IfFileExists &quot;$SYSDIR\msvcrt.dll&quot; 0 +2<br />
    StrCpy $ALREADY_INSTALLED 1<br />
    !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED ..\MFC\msvcrt.dll $SYSDIR\msvcrt.dll $SYSDIR<br />
  StrCpy $ALREADY_INSTALLED 0<br />
  IfFileExists &quot;$SYSDIR\msvcp60.dll&quot; 0 +2<br />
    StrCpy $ALREADY_INSTALLED 1<br />
    !insertmacro InstallLib DLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED ..\MFC\msvcp60.dll $SYSDIR\msvcp60.dll $SYSDIR<br />
SectionEnd<br />
 <br />
<br />
Can anyone point me in the right direction?<br />
<br />
TIA</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">4th April 2007, 20:07</div></div><div class="posttext">Appendix B has documentation for InstallLib. I don't know what causes this to fail on Vista, but you are not using REGDLL as the libtype param....however, these runtimes normally don't get registered on install anyway.<br />
I'd try debugging the install and/or app to see why it isn't working on Vista.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kinar</div><div class="date">4th April 2007, 20:23</div></div><div class="posttext">Thats just the thing, one of my ocx files wont run because it fails registration.  The reason it fails registration is because MFC42.dll is not registered.<br />
<br />
If I try to regsrv32 mfc42.dll from the cmd prompt I get an error.<br />
<br />
If I launch cmd.exe &quot;as administrator&quot; and regsrv32 mfc42.dll it works and my ocx will register as well.<br />
<br />
Or if I turn off the UAC in vista and just launch my app it works because my app is able to register both files.  From that point on everything works fine (even after turning UAC back on since they are now registered).<br />
<br />
The problem I have is installing on new vista installs where I have to install mfc42.dll.  I suppose its entirely possible that this section of the script has never actually done anything in previous versions of windows since it used to be very rare to find a machine without mfc42 already installed.<br />
<br />
I'll take a look at Appendix B....thanks again</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">4th April 2007, 20:32</div></div><div class="posttext">Registration through InstallLib should work the same as from plain script on Vista, since InstallLib uses RegDLL. Have you tried unregsvr'ing and deleting mfc42.dll on a pre-vista system and seeing if your installer and app work? That might let you know if this is really a vista problem or if it's always been this way like you suspect.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kinar</div><div class="date">4th April 2007, 22:04</div></div><div class="posttext">Ok...a bit more info to add to the puzzle here:<br />
<br />
I changed the above InstallLib code to use REGDLL instead of DLL and now the output gives me the error &quot;Could not load symbol: DLLRegisterServer&quot;<br />
<br />
How does a dll that can be registered, tell me it cant be registered by the installer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">4th April 2007, 22:07</div></div><div class="posttext">I just looked at that file, and it depends on MSVCRT.dll. That might be causing your problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kinar</div><div class="date">4th April 2007, 22:46</div></div><div class="posttext">Oops...I misread the output of the install...<br />
<br />
The &quot;Could not load symbol: DLLRegisterServer&quot; error is being generated for the msvcrt.dll and msvcp60.dll and not for the mfc42.dll.<br />
<br />
The mfc43.dll is simply saying &quot;Registering c:\windows\system32\mfc42.dll&quot;  Can I assume that means it is successful (thats what it says for all the other DLLs that work properly)?<br />
<br />
Upon your suggestion, I moved the msvcrt.dll above mfc42 but that did not help (except to make me realise I was misreading the output log).<br />
<br />
In light of this, I suppose its time to check for alternative fixes for this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kinar</div><div class="date">4th April 2007, 22:49</div></div><div class="posttext">and almost immediately I found the problem.<br />
<br />
Thanks a ton for your help dienjd.  I hope you got something good out of the research cause it ended up being a stupid mistake on my end...<br />
<br />
Apparently the reason that my ocx wasn't getting registered was because I forgot to tell the installer to register it :cry: :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">4th April 2007, 23:53</div></div><div class="posttext">No problem. I spend most of my day making stupid mistakes :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>