<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Newbie Help with RegKey, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Newbie Help with RegKey NSIS Discussion" />
	
	<title> Newbie Help with RegKey [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Newbie Help with RegKey</div>
<hr />
<div class="pda"><a href="t-148207.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=148207">Newbie Help with RegKey</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 12:34</div></div><div class="posttext">Hi I'm haveing a problem, I'm trying to detect a registry key to see if it exist, but what ever combination I try I can't get it to work<br />
<br />
ReadRegStr $0 HKLM &quot;Software\game\software&quot; &quot;Install Path&quot;<br />
???????????? continue<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;Registry path can not be found&quot;<br />
Abort<br />
continue:<br />
<br />
<br />
All I would like it to do is if the registry key exist to continue, if it doesn't then I would like it to abort, but I just don't know what the lines should be, I have try looking through the archive and docs and the forum, but what ever combination I do it won't work<br />
<br />
I know it has to be in the Function .oninit, but I ca'nt cet it to work.<br />
<br />
I have try the Archive IfKeyExists Macro, but all I get is<br />
<br />
IfKeyExists not inuse or something like that<br />
<br />
I would be gratefull for your help<br />
<br />
Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 12:40</div></div><div class="posttext">IfKeyExists from the archive is the way to go if you want to check if the key exists. But as it seems, all you need is to know if the value inside it is valid. For that, simply compare it to &quot;&quot; using StrCmp. You can also use InstallDirRegKey (http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 14:55</div></div><div class="posttext">This seems to work, could someone confirm that it's correct and I'm right please<br />
<br />
Thank you <br />
<br />
Function .onInit<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\game\software&quot; &quot;Install Path&quot;<br />
StrCmp $0 &quot;&quot; 0 continue<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;Registry path can not be found&quot;<br />
Abort<br />
continue:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 15:02</div></div><div class="posttext">Yes, that's a good way. But if you want to use $0 later to fill $INSTDIR you should use InstallDirRegKey (http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.21) and check if $INSTDIR is empty in .onInit. It will also make sure the installation path is valid and not just not empty.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 15:09</div></div><div class="posttext">Ok I have this<br />
<br />
Oh I should add that this is a upgrade for some files and not a exe application<br />
<br />
InstallDir &quot;$INSTDIR&quot;<br />
InstallDirRegKey HKLM &quot;Software\game\software&quot; &quot;Install Path&quot;<br />
<br />
but how would I put $INSTDIR into the .oninit ?<br />
<br />
you see I don't want it to be installed to anyother DIR if the Reg key doesn't exist.<br />
<br />
I have read the InstallDirRegKey as you stated but I don't quite understand it</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 15:13</div></div><div class="posttext">I'm sorry, I've mixed up. InstallDirRegKey checks if it's empty for you:<br />
<br />
If this attribute is present, it will override the InstallDir attribute if the registry key is valid, otherwise it will fall back to the InstallDir default.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 15:14</div></div><div class="posttext">so is my little bit of script fine then?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 15:17</div></div><div class="posttext">No. InstallDir sets $INSTDIR, you can't tell it to set it to its self. You must provide a default or provide nothing. If you want to abort the installation if that regkey doesn't exist just use this:<br />
<br />
InstallDirRegKey HKLM &quot;Software\game\software&quot; &quot;Install Path&quot;<br />
Function .onInit<br />
StrCmp $INSTDIR &quot;&quot; 0 ok<br />
MessageBox MB_OK &quot;error...&quot;<br />
Abort<br />
ok:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 15:22</div></div><div class="posttext">so what if I put<br />
<br />
Var GAMEDIR<br />
<br />
Section &quot;-InstallDir&quot;<br />
ReadRegStr $GAMEDIR HKLM &quot;Software\game\software&quot;<br />
StrCpy $INSTDIR &quot;$GAMEDIR&quot;<br />
SectionEnd<br />
<br />
InstallDir &quot;$INSTDIR&quot;<br />
InstallDirRegKey HKLM &quot;Software\game\software&quot; &quot;Install Path&quot;<br />
<br />
and then<br />
<br />
Function .onInit <br />
StrCmp $INSTDIR &quot;&quot; 0 ok <br />
MessageBox MB_OK &quot;error...&quot; <br />
Abort <br />
ok: <br />
FunctionEnd<br />
<br />
will this work</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 15:29</div></div><div class="posttext">Why would you want to do that? Just use the script I gave you.<br />
<br />
This line means nothing:<br />
InstallDir &quot;$INSTDIR&quot;<br />
<br />
This line is missing a parameter:<br />
ReadRegStr $GAMEDIR HKLM &quot;Software\game\software&quot;<br />
<br />
If you don't use InstallDir, InstallDirRegKey will put the value from the registry and if it's not there or the value is invalid, it'll put nothing in it. That's what you should use, my script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 15:31</div></div><div class="posttext">ok then thanks, won't bother you again :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 15:58</div></div><div class="posttext">Sorry about this I know I said I wouldn't bother you again,<br />
<br />
so what would happen if I removed the line InstallDir<br />
<br />
is InstallDirRegKey  used instead?<br />
<br />
Or do I have to have InstallDir line in the script<br />
<br />
I only ask because if I have InstallDir &quot;$PROGRAMFILES\game&quot;  it overrides the InstallDirRegKey and the Function .oninit script you supplied doesn't check if the install path is valid, if I delete the Regkey from the registry is will still install, which I don't want it to do.<br />
<br />
or could I put InstallDir &quot;&quot;<br />
<br />
if not what do I put so it will not override InstallDirRegKey?<br />
<br />
Sorry but it can be confusing and my apologise as you have been very patient so far.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 19:24</div></div><div class="posttext">Hi just wondered if anyone could answer my question</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2003, 20:03</div></div><div class="posttext">As the quote said InstallDirRegKey overrides InstallDir if the key exists and contains a valid path. If you have InstallDir in your script it will fall back to whatever you've defined using InstallDir instead to &quot;&quot; as you wish.<br />
<br />
You should simply not use InstallDir.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LucasXX</div><div class="date">5th September 2003, 20:54</div></div><div class="posttext">Thank you</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>