<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with $PROGRAMFILES under German Windows Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with $PROGRAMFILES under German Windows Vista NSIS Discussion" />
	
	<title> Problem with $PROGRAMFILES under German Windows Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with $PROGRAMFILES under German Windows Vista</div>
<hr />
<div class="pda"><a href="t-290397.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=290397">Problem with $PROGRAMFILES under German Windows Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Jogjog</div><div class="date">17th April 2008, 11:48</div></div><div class="posttext">Have problems with $PROGRAMFILES under German Windows Vista. In German Windows Vista program files are usually copied to &quot;c:\programme\...&quot; but got &quot;c:\program files\...&quot;. Works fine under Windows XP. Any hints?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">17th April 2008, 13:11</div></div><div class="posttext">Program Files is the proper name of the directory. The changed name is a result of all Vista editions being MUI-based: the directory is always called Program Files, and the localized name is a virtual folder, pointing to the &quot;real&quot; one.<br />
<br />
The reason you see Programme in Explorer, is that it uses API calls to format the displayed path according to the active language pack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jogjog</div><div class="date">17th April 2008, 13:30</div></div><div class="posttext">Many thanks for your clarification and you're right. The installation also works with &quot;Program Files&quot; but I'm afraid German / non English end customers will get confused. On other Microsoft operation systems the Installation Folder dialog (Destination Folder) shows the localized name. Any ideas / pointers how I can get the virtual folder name?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">17th April 2008, 13:40</div></div><div class="posttext">Actually, you shouldn't expect it to work if you wrote &quot;Programme&quot; - the handling of that virtual folder can be a bit peculiar at times.<br />
<br />
Displaying the localized path: Take a look at http://blogs.msdn.com/michkap/archive/2007/01/18/1487464.aspx#1736328 - there's some sample C code to get the path. I think it might need to be integrated in the NSIS executable, though - I'm not sure if it's doable using only NSIS scripts.<br />
<br />
As for confusion - you're right that this happens, but in my experience, people learn to deal with it after their first install of a program that doesn't use this approach (which is pretty much anything not MSI-based).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">reace</div><div class="date">4th November 2009, 14:41</div></div><div class="posttext">Hi all,<br />
<br />
I stumbled over this thread by searching for the $PROGRAMFILES problem under german Windows Vista / Windows 7. <br />
<br />
Well, I need to write the $INSTDIR Path, which consists of the $PROGRAMFILES constant, to the registry to get an external program starting the installed application. <br />
The problem is that the external program cannot start the application, because of the wrong path.<br />
<br />
During installation he shows &quot;C:\Program Files\Application&quot;<br />
and thats the path he writes to the registry, but the application will be installed to &quot;C:\Programme\Application&quot;.<br />
<br />
Im getting really frustrated ... there must be a solution for this I think? <br />
<br />
I hope you can help me out :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">4th November 2009, 14:58</div></div><div class="posttext">The situation is no different: C:\Programme doesn't really exist, the folder is really called C:\Program Files and Vista/7 uses the API call mentioned in my previous to localize the displayed path in Explorer.<br />
<br />
You can verify this for yourself by opening a command prompt and navigating there, since that doesn't localize anything.<br />
<br />
Your other application should not fail as long as Program Files is what's being written to the registry. If it does, then you probably have some other problem - like having told your installer to not elevate (in which case it *can't* write to Program Files if UAC is on).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">5th November 2009, 07:51</div></div><div class="posttext">Originally posted by Pidgeot <br />
having told your installer to not elevate (in which case it *can't* write to Program Files if UAC is on).  <br />
Actually in that case you can't write to Program Files even if UAC is off.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sprinleo</div><div class="date">21st December 2009, 09:55</div></div><div class="posttext">thanks guys for bringing this topic up.<br />
simple question: is there a way to just extract the localized name of the &quot;Program Files&quot; from the registry or something ?<br />
<br />
which means, do we have a way to extract the strings like: &quot;Programme&quot; or &quot;Archivos De Programma&quot; which are equivalent to &quot;Program Files&quot; ?<br />
<br />
thanks in anticipation :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TrifonovS</div><div class="date">5th July 2012, 09:44</div></div><div class="posttext">This is rather old thread, but I have the same problem now. Is there a new idea how I can show the virtual name when the user selects the installation path? Is there a plug-in for this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th July 2012, 11:57</div></div><div class="posttext">Converting that code to the System plug-in:!define DONT_RESOLVE_DLL_REFERENCES 0x00000001<br />
!define LOAD_LIBRARY_AS_DATAFILE 0x00000002<br />
<br />
System::Call `shell32::SHGetLocalizedName(t &quot;$PROGRAMFILES&quot;, i ${NSIS_MAX_STRLEN}, i .R0) i .R1`<br />
${If} $R1 == 0<br />
  ExpandEnvStrings $R0 $R0<br />
  ${If} ${FileExists} $R0<br />
    System::Call `kernel32::LoadLibraryEx(t R0, i 0, i ${DONT_RESOLVE_DLL_REFERENCES}|${LOAD_LIBRARY_AS_DATAFILE}) i .R1`<br />
    ${If} $R1 != 0<br />
      System::Call `user32::LoadString(i R1, i R0, t .R2, i ${NSIS_MAX_STRLEN}) i .R3`<br />
      ${If} $R3 != 0<br />
        MessageBox MB_OK $R2<br />
      ${EndIf}<br />
      System::Call `kernel32::FreeLibrary(i R1)`<br />
    ${EndIf}<br />
  ${EndIf}<br />
${EndIf}This has not been tested.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TrifonovS</div><div class="date">5th July 2012, 14:23</div></div><div class="posttext">Hi Afrow,<br />
Thank for the code. I compiled it, but the message box doesn't appear. It looks that R3 is always 0, but I don't know why. I don't understand too much from this code. Can you help me to start it up, please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th July 2012, 22:29</div></div><div class="posttext">SetShellVarContext all ;accessing all users startmenu<br />
System::Call 'SHELL32::SHGetLocalizedName(w &quot;$SMPrograms\Accessories\Welcome Center.lnk&quot;,w.r1,i ${NSIS_MAX_STRLEN},*i.r2)i.r0'<br />
${If} $0 = 0<br />
	ExpandEnvStrings $1 $1<br />
	System::Call 'KERNEL32::LoadLibraryEx(tr1,i0,i 0x23)i.r1'<br />
	${If} $1 &lt;&gt; 0<br />
		System::Call 'USER32::LoadString(ir1,ir2,t.r2,i ${NSIS_MAX_STRLEN})i.r0'<br />
		${If} $0 &lt;&gt; 0<br />
			DetailPrint LocalizedName=$2<br />
		${EndIf}<br />
		System::Call 'KERNEL32::FreeLibrary(ir1)'<br />
	${EndIf}<br />
${EndIf}<br />
<br />
This prints &quot;LocalizedName=Getting Started&quot; on this English Win7 system.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>