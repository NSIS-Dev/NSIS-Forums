<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Create Service, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Create Service NSIS Discussion" />
	
	<title> Create Service [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Create Service</div>
<hr />
<div class="pda"><a href="t-150873.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=150873">Create Service</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">29th September 2003, 20:14</div></div><div class="posttext">Is it possible to create a service with Sunjammers Service Plugin?<br />
<br />
Maybe:<br />
<br />
Services::SendServiceCommand 'create' 'myServiceName'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th September 2003, 20:17</div></div><div class="posttext">dselkirk's service library can create services. Find it in the following link:<br />
<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=345</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">29th September 2003, 22:28</div></div><div class="posttext">Great!  For this guy, I just place it in the NSIS\Include folder and do a &quot;!include servicelib.nsh&quot; prior to using it?  Sorry, another newbie question...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">29th September 2003, 23:02</div></div><div class="posttext">OK, yep, that worked.  Now having trouble using multiple parameters.  In the comments, it looks like the parameters should be separated by semicolons, but that would comment out those parameters.  Any help?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">29th September 2003, 23:27</div></div><div class="posttext">Guess I'm having a conversation with myself.  It doesn't seem to be multiple paramaters.  I'm trying to tell it to run by a domain account using:<br />
<br />
  !insertmacro SERVICE &quot;create&quot; &quot;myService&quot; \<br />
  &quot;path=D:\pathToExe\Service.exe;autostart=0; \<br />
  user=DOMAIN\user;password=userPassword&quot;<br />
<br />
Changing autostart on and off works; thus multiple params works.  However, I can't get it to create the service with a domain account.  Is there a trick?<br />
<br />
Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th September 2003, 23:29</div></div><div class="posttext">; doesn't start a comment if within quotes. dselkirk would have to answer the domain question.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">30th September 2003, 14:04</div></div><div class="posttext">I'm looking at the problem right now. I'll release it with version 1.2 which I'm hoping will be done today or tomorrow. It will have some extra features as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">30th September 2003, 15:59</div></div><div class="posttext">Thanks dselkirk, you're OK!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">1st October 2003, 18:02</div></div><div class="posttext">Please excuse the delay, I haven't had as much time as I wanted on updating the servicelib. I've attached the new version, it still needs to be tested but it gives you something to try.<br />
<br />
New in version 1.2<br />
- fixed domain name (from what info I found) use: domain\user<br />
- add desc paramater<br />
- changed autostart to type with more options<br />
- added dispplay for settings the service displayname<br />
- added log for setting the eventlog<br />
- added quick macro for the service macro<br />
<br />
Let me know if you find any problems. I'll do my best to try and finish it up.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">1st October 2003, 20:16</div></div><div class="posttext">I got an error with the new servicelib.nsh:<br />
<br />
&quot;Install corrupted: invalid opcode&quot;<br />
<br />
Any clue dselkirk?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st October 2003, 21:01</div></div><div class="posttext">That's probably a wrong relative jump.<br />
<br />
There are also some relative jumps used to jump over plug-in calls, which will result in unexpected behavior, because plug-in calls are being converted by the compiler (see documentation for details).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">1st October 2003, 21:41</div></div><div class="posttext">I don't have any relative jumps in my script, and the only places where dselkirk possibly (is System:: a plug-in?) breaks the rules in the doc is:<br />
<br />
    IntCmp $5 0 +2<br />
    System::Call 'advapi32::CloseServiceHandle(i r5) n'<br />
    IntCmp $4 0 +2<br />
    System::Call 'advapi32::CloseServiceHandle(i r4) n'<br />
    Pop $4<br />
<br />
But I changed the relative jumps to labels and still got the error.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">1st October 2003, 21:52</div></div><div class="posttext">There is probably somewhere else a wrong jump. Please check where you get this error.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">1st October 2003, 22:15</div></div><div class="posttext">I stuck a bunch of debug statements in there (message boxes) and the last command it executes is:<br />
<br />
  !macro CALL_GETPARAM VAR NAME DEFAULT LABEL<br />
    Push $1<br />
    Push ${NAME}<br />
    Call ${UN}GETPARAM<br />
    Pop $6<br />
    StrCpy ${VAR} &quot;${DEFAULT}&quot;<br />
<br />
&lt;!--this one below--&gt;<br />
    StrCmp $6 &quot;&quot; &quot;${LABEL}&quot; 0<br />
&lt;!--this one above--&gt;<br />
<br />
    StrCpy ${VAR} $6<br />
  !macroend<br />
<br />
Unfortunately, I don't have much of a grip on this scripting language yet.  Sorry I can't be of more help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">1st October 2003, 22:45</div></div><div class="posttext">No, that was wrong.  I stuck a TON more debug statements in there (is there a better way to debug than with message boxes?) and found the actual last line to compile as follows:<br />
<br />
    lbl_good:<br />
    StrCpy $0 &quot;true&quot;<br />
    lbl_done:<br />
    IntCmp $5 0 +2<br />
    System::Call 'advapi32::CloseServiceHandle(i r5) n'<br />
    IntCmp $4 0 +2<br />
    System::Call 'advapi32::CloseServiceHandle(i r4) n'<br />
    Pop $4<br />
    Pop $3<br />
    Pop $2<br />
    Pop $1<br />
&lt;!--Right after here--&gt;<br />
    Exch 3<br />
&lt;!--Right before here--&gt;<br />
    Pop $5<br />
    Pop $6<br />
    Pop $7<br />
    Exch $0<br />
  !macroend<br />
<br />
So by the doc, it looks like this means the stack is too low to perform this command???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">1st October 2003, 23:13</div></div><div class="posttext">I don't know if my debugging is valid here:<br />
<br />
    lbl_good:<br />
    StrCpy $0 &quot;true&quot;<br />
    lbl_done:<br />
    IntCmp $5 0 mylabel1<br />
MessageBox MB_OK &quot;using first system call&quot;<br />
    System::Call 'advapi32::CloseServiceHandle(i r5) n'<br />
mylabel1:<br />
    IntCmp $4 0 mylabel2<br />
MessageBox MB_OK &quot;using second system call&quot;<br />
    System::Call 'advapi32::CloseServiceHandle(i r4) n'<br />
mylabel2:<br />
    Pop $4<br />
MessageBox MB_OK &quot;$4&quot;<br />
    Pop $3<br />
MessageBox MB_OK &quot;$3&quot;<br />
    Pop $2<br />
MessageBox MB_OK &quot;$2&quot;<br />
    Pop $1<br />
MessageBox MB_OK &quot;$1&quot;<br />
<br />
    Exch 3<br />
<br />
    Pop $5<br />
    Pop $6<br />
    Pop $7<br />
    Exch $0<br />
  !macroend<br />
<br />
but if so, the problem is that the system call doesn't put anything on the stack for this guy.  It went into the second system call and each Pop put nothing into $?.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">2nd October 2003, 01:02</div></div><div class="posttext">Hmmmm.... This code is not wrong to give that error.... Attach the WHOLE script used to compile the program.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fraefel</div><div class="date">2nd October 2003, 06:30</div></div><div class="posttext">Originally posted by stonkers <br />
No, that was wrong.  I stuck a TON more debug statements in there (is there a better way to debug than with message boxes?) and found the actual last line to compile as follows:<br />
<br />
Have a look at DumpState on NSIS Archive (http://nsis.sourceforge.net/archive/viewpage.php?pageid=140) :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">2nd October 2003, 14:54</div></div><div class="posttext">I have the servicelib.nsh file in the includes folder.  Running the beta version of NSIS.  Here's the script.  Pretty straight-forward:<br />
<br />
;----------------------------------<br />
<br />
;NSIS Script For Doc<br />
<br />
;Included file(s)<br />
<br />
!include servicelib.nsh<br />
<br />
;Backgound Colors<br />
BGGradient 800080 000000 FFFFFF<br />
BrandingText &quot; &quot;<br />
<br />
;Title Of Your Application<br />
Name &quot;MyApp&quot;<br />
<br />
;Do A CRC Check<br />
CRCCheck On<br />
<br />
;Output File Name<br />
OutFile &quot;CreateService.exe&quot;<br />
<br />
;The Default Installation Directory<br />
InstallDir &quot;$PROGRAMFILES\MyApp&quot;<br />
<br />
;The text to prompt the user to enter a directory<br />
DirText &quot;Stick it in here&quot;<br />
<br />
Section 1<br />
<br />
  !insertmacro SERVICE &quot;create&quot; &quot;MyService&quot; \<br />
  &quot;path=$INSTDIR\MyApp\bin\Service.exe;user=DOMAIN\MyUser;password=psswd&quot;<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">2nd October 2003, 14:59</div></div><div class="posttext">Exch can cause Invalid Op errors too if not used properly. According to your test it is Exch that causes it and that indicates something is wrong with the stack operations in the macros.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">2nd October 2003, 15:21</div></div><div class="posttext">Found the problem. You forgot an extra &quot;;&quot; at the end of your parameter list. It should look like this:<br />
<br />
!insertmacro SERVICE &quot;create&quot; &quot;MyService&quot; \ <br />
&quot;path=$INSTDIR\MyApp\bin\Service.exe;user=DOMAIN\MyUser;password=psswd;&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">2nd October 2003, 15:29</div></div><div class="posttext">sorry, thats not it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">2nd October 2003, 15:31</div></div><div class="posttext">I've got dumpstate fired up now, I'll be able to give you more info.  I'll put that &quot;;&quot; in there also.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">2nd October 2003, 15:38</div></div><div class="posttext">Found the problem. Quick fix. In the library, goto &quot;lbl_create:&quot;. There are serveral Push statements. After &quot;Push $R8 ;desc&quot;, add &quot;Push $R9 ;log&quot;. Let me know</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">2nd October 2003, 15:46</div></div><div class="posttext">So here's the code that's being executed:<br />
<br />
    System::Call 'advapi32::CloseServiceHandle(i r4) n'<br />
  Dumpstate::debug ;1<br />
    Pop $4<br />
  Dumpstate::debug ;2<br />
    Pop $3<br />
  Dumpstate::debug ;3<br />
    Pop $2<br />
  Dumpstate::debug ;4<br />
    Pop $1<br />
  Dumpstate::debug ;5<br />
    Exch 3<br />
<br />
At each of the dumpstate commands:<br />
<br />
1) $0 = true<br />
   $1 = the path to my executable<br />
   $2 = my app name<br />
   $3 = create<br />
   $4 = 1315648<br />
   $5 = empty<br />
   $6 = 1322456<br />
   $7-&gt; empty<br />
2) $0 = true<br />
   $1 = the path to my executable<br />
   $2 = my app name<br />
   $3 = create<br />
   $4 = empty<br />
   $5 = empty<br />
   $6 = 1322456<br />
   $7-&gt; empty<br />
3) $0 = true<br />
   $1 = the path to my executable<br />
   $2 = my app name<br />
   $3 = empty<br />
   $4 = empty<br />
   $5 = empty<br />
   $6 = 1322456<br />
   $7-&gt; empty<br />
4) $0 = true<br />
   $1 = the path to my executable<br />
   $2 = empty<br />
   $3 = empty<br />
   $4 = empty<br />
   $5 = empty<br />
   $6 = 1322456<br />
   $7-&gt; empty<br />
5) $0 = true<br />
   $1 = empty<br />
   $2 = empty<br />
   $3 = empty<br />
   $4 = empty<br />
   $5 = empty<br />
   $6 = 1322456<br />
   $7-&gt; empty<br />
<br />
Install corrupted: invalid opcode<br />
<br />
How can I see the stack?  It's obviously empty.  What should be there?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">2nd October 2003, 15:52</div></div><div class="posttext">Try the fix I posted. As for the stack, at that point of the library its cleaning up my variables. The only things in the stack would be values set in those variables before running the service command.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">2nd October 2003, 15:56</div></div><div class="posttext">Well, I don't get the error anymore!  But:<br />
<br />
;---------------------------------- <br />
<br />
;NSIS Script For Doc <br />
<br />
;Included file(s) <br />
<br />
!include servicelib.nsh <br />
<br />
;Backgound Colors <br />
BGGradient 800080 000000 FFFFFF <br />
BrandingText &quot; &quot; <br />
<br />
;Title Of Your Application <br />
Name &quot;MyApp&quot; <br />
<br />
;Do A CRC Check <br />
CRCCheck On <br />
<br />
;Output File Name <br />
OutFile &quot;CreateService.exe&quot; <br />
<br />
;The Default Installation Directory <br />
InstallDir &quot;$PROGRAMFILES\MyApp&quot; <br />
<br />
;The text to prompt the user to enter a directory <br />
DirText &quot;Stick it in here&quot; <br />
<br />
Section 1 <br />
<br />
!insertmacro SERVICE &quot;create&quot; &quot;MyService&quot; \ <br />
&quot;path=$INSTDIR\MyApp\bin\Service.exe;user=DOMAIN\MyUser;password=psswd;type=3;&quot; <br />
<br />
SectionEnd<br />
<br />
;---------------------<br />
<br />
gives me a service run by localhost that is of type &quot;manual startup&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">2nd October 2003, 23:01</div></div><div class="posttext">I've monkeyed around a bit more, and it looks like there is a misprint in the comments.  type=2 creates automatic startup and 3 manual.  I can't figure out for the life of me how to make it run by domain user though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stonkers</div><div class="date">2nd October 2003, 23:21</div></div><div class="posttext">Well, I have a theory.  The user tag is being used to create the service but not determine who to run it by.  If I use my userID without the domain name (because I'm not a true user without the domain), the service will be created in &quot;disabled&quot; state.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jeff_hanna</div><div class="date">5th August 2005, 15:26</div></div><div class="posttext">I realize this reply is almost 2 years after the last post in the thread. But, I'm having the exact same problem. Was a solution to starting a network service with a user/password ever found?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vitoco</div><div class="date">11th July 2006, 20:03</div></div><div class="posttext">Did someone try the patch (http://forums.winamp.com/showthread.php?threadid=204726) for ServiceLib (http://nsis.sourceforge.net/NSIS_Service_Lib)? I think it might solve the network user problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">5of0</div><div class="date">23rd December 2006, 04:42</div></div><div class="posttext">For future reference and those looking for solution to opcode errors:<br />
The above problem was most likely caused by the Exch, because if Exch is called when the stack is empty, it throws an opcode error.  See this thread:<br />
http://forums.winamp.com/showthread.php?postid=1836225<br />
For more info.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">17th February 2007, 00:03</div></div><div class="posttext">I'd like to follow some of the links in this thread, but foir all except the first one, the hyperlink code is replaced with non-hyperlink text that says &quot;url submitted by user&quot;. I looked at the page source and the the target url is simply not there.<br />
<br />
ANyone know what's going on and how I Can follow some of the links in this discussion?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th February 2007, 01:59</div></div><div class="posttext">This is to prevent spam, not sure why it blocked these old urls<br />
<br />
Press the quote button on the post that has the url you want(Atleast this works for me, if not, i posted the source @ http://rafb.net/p/HVycee19.txt (thread reversed))</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>