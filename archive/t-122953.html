<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" msvcrt.dll, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  msvcrt.dll NSIS Discussion" />
	
	<title> msvcrt.dll [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  msvcrt.dll</div>
<hr />
<div class="pda"><a href="t-122953.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=122953">msvcrt.dll</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jankofoed</div><div class="date">27th January 2003, 10:47</div></div><div class="posttext">I have tried to make a very small nsis script for upgrading a dll (msvcrt.dll). I use the macro UpgradeDLL from the documentation (Useful function, B.10). I can see in the registry that a pending rename function is inserted. Its intensions seems to be right. The syntax is a little cryptic (some ?? and a !).<br />
<br />
I do not see any effect, the old msvcrt.dll version is kept.<br />
<br />
I have tried to enable boot-logging, but I see nothing there.<br />
<br />
I am using Windows 2000, and NSIS v2.0b0<br />
<br />
Best regards,<br />
Jan Eggert Kofoed</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th January 2003, 11:32</div></div><div class="posttext">Please attach the script and the registry key that is written (just copy and paste it).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jankofoed</div><div class="date">27th January 2003, 11:41</div></div><div class="posttext">My script is as follows<br />
-----------------------<br />
!include jk.txt<br />
Name &quot;FORCE Technology (jk's test)&quot;<br />
InstallDir &quot;c:\Programs\SimFlexNavigator&quot;<br />
OutFile jk.exe<br />
Section &quot;&quot;<br />
  SetOutPath $INSTDIR<br />
!insertmacro UpgradeDLL &quot;msvcrt.dll&quot; &quot;$SYSDIR\msvcrt.dll&quot;<br />
SectionEnd<br />
------------------------<br />
I have a copy of msvcrt.dll where I run the scipts. I can see that the correct file is stored in the temp-directory.<br />
With REGEDIT I find<br />
Folder: My Computer/HKLM/SYSTEM/ControlSet001/Control/Session Manager<br />
Name  : PendingFileRenameOperations<br />
Type  : REG_MULTI_SZ<br />
Data  : \??\C:\DOCUME~1\ADMIN~1.PC0\LOCALS~1\Temp\nst1.tmp !\??\C:\WINNT\System32\msvcrt.dll<br />
(Data is one long line).<br />
<br />
Thank you very much for your quick respons.<br />
<br />
Best regards,<br />
Jan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th January 2003, 11:50</div></div><div class="posttext">Is the temporary file deleted or does it stay in $TEMP?<br />
<br />
BTW, that cryptic syntax is for NT's long paths.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jankofoed</div><div class="date">27th January 2003, 11:54</div></div><div class="posttext">The file IS deleted from $TEMP, and the pending file rename is removed from the registry, so an attempt IS being made. I don't know whether the dll is locked very early on in the boot sequence.<br />
<br />
(What I found cryptic was the use of ? and !   :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th January 2003, 12:07</div></div><div class="posttext">I will test this later on my computer. For now, try using the latest CVS version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jankofoed</div><div class="date">27th January 2003, 12:33</div></div><div class="posttext">Thanx again for your very fast replies!!!<br />
<br />
I have downloaded &quot;Development Snapshot&quot; dated 20020127 (i.e. today), and built all three projects, using the new version of makensis.exe and created a new installation (jk.exe). I get the same result.<br />
The existing dll in c:/winnt/system32 is from May 2001, version 6.1.8924.0<br />
The file nst1.tmp placed in (and subsequently removed from) $TEMP is version 6.1.9359.0<br />
<br />
Best regards,<br />
Jan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">27th January 2003, 13:42</div></div><div class="posttext">The file is probably protected by Windows File Protection, so you can't upgrade it. Only Microsoft Service Packs can upgrade it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>