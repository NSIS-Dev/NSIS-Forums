<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" CPUFeatures plug-in, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  CPUFeatures plug-in NSIS Discussion" />
	
	<title> CPUFeatures plug-in [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  CPUFeatures plug-in</div>
<hr />
<div class="pda"><a href="t-355951.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=355951">CPUFeatures plug-in</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">17th February 2013, 14:52</div></div><div class="posttext">Hi!<br />
<br />
I recently created a plug-in to detect the CPU features (MMX, SSE, AVX, etc) at runtime. Since I didn't want to re-invent the wheel, I simply created a wrapper-library around the CPU detection code from x264 and then built the NSIS plug-in on top. This was mainly created for my own needs, but I though it might be useful for others too.<br />
<br />
Note: Some CPU features are not currently detected, such as &quot;3DNow!&quot;, because it probably was never relevant for x264. I maybe will hack that in at a later time, if anybody still needs that nowadays. Also there are some x264-specifc flags you can simply ignore...<br />
<br />
Wiki page:<br />
http://nsis.sourceforge.net/CPUFeatures_plug-in<br />
<br />
Testing on different CPU's would be appreciated, so I have attached test app ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">17th February 2013, 21:13</div></div><div class="posttext">As a matter of fact I was in need of a 3DNow CPU just two weeks ago. Thanks for sharing!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">21st February 2013, 14:29</div></div><div class="posttext">Okay, I hacked in support for 3DNow! and 3DNow!Ex. And I also added a function to get the no. of CPU cores:<br />
http://nsis.sourceforge.net/CPUFeatures_plug-in<br />
<br />
(3DNow! support is completely untested, as my last AMD machine died a while ago)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">21st February 2013, 20:16</div></div><div class="posttext">Okay, I hacked in support for 3DNow! and 3DNow!Ex. And I also added a function to get the no. of CPU cores:<br />
http://nsis.sourceforge.net/CPUFeatures_plug-in<br />
<br />
(3DNow! support is completely untested, as my last AMD machine died a while ago)<br />
<br />
Okay, I ask a friend to test the new version on his AMD and 3DNow!(Ex) detection seems to work as expected.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">22nd February 2013, 08:24</div></div><div class="posttext">This is going to be really helpful to some people, thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">22nd February 2013, 19:42</div></div><div class="posttext">You're welcome.<br />
<br />
I just added another function to check for multiple features at once. Might simplify things a bit in some situations, I think.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">24th February 2013, 18:07</div></div><div class="posttext">If you feel crazy, you could maybe write wrapper macros for ${If} ${Supports3DNow!} or ${If} ${CPUSupports} &quot;MMX&quot; or something. But only if you feel crazy. :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">24th February 2013, 18:19</div></div><div class="posttext">Unfortunately I'm not enough crazy to understand LogicLib ;)<br />
<br />
(I mean that I understand how to use it, actually I use it extensively, but I have not been able to follow its code)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">25th February 2013, 09:06</div></div><div class="posttext">!macro _CPUSupports _a _b _t _f<br />
  !insertmacro _LOGICLIB_TEMP<br />
  push `${_b}`<br />
  CPUFeatures::CheckCPUFeature /NOUNLOAD<br />
  Pop $_LOGICLIB_TEMP<br />
  !insertmacro _= $_LOGICLIB_TEMP `yes` `${_t}` `${_f}`<br />
!macroend<br />
!define CPUSupports `&quot;&quot; _CPUSupports`<br />
<br />
Didn't test this, but it looks ok to me.<br />
<br />
By the way, I see you're still using /NOUNLOAD. If you're still using the old plugin model, you might want to update it..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">25th February 2013, 13:45</div></div><div class="posttext">!macro _CPUSupports _a _b _t _f<br />
  !insertmacro _LOGICLIB_TEMP<br />
  push `${_b}`<br />
  CPUFeatures::CheckCPUFeature /NOUNLOAD<br />
  Pop $_LOGICLIB_TEMP<br />
  !insertmacro _= $_LOGICLIB_TEMP `yes` `${_t}` `${_f}`<br />
!macroend<br />
!define CPUSupports `&quot;&quot; _CPUSupports`<br />
<br />
Didn't test this, but it looks ok to me.<br />
<br />
Okay, thanks! I will give that code a try. And if it works, I will commit.<br />
<br />
By the way, I see you're still using /NOUNLOAD. If you're still using the old plugin model, you might want to update it..<br />
<br />
Actually I think I do use the new model (with callback function), so I might be able to simply drop the /NOUNLOAD.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">25th February 2013, 21:23</div></div><div class="posttext">Okay, I added the LogicLib support macros, as suggested.<br />
<br />
But in the last line it must be _== instead of _=. That gave me quite a headache! ;)<br />
<br />
New version here:<br />
http://nsis.sourceforge.net/CPUFeatures_plug-in</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>