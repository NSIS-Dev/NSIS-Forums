<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Launch Menu, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Launch Menu NSIS Discussion" />
	
	<title> Launch Menu [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Launch Menu</div>
<hr />
<div class="pda"><a href="t-235961.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=235961">Launch Menu</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">20th January 2006, 05:18</div></div><div class="posttext">I'm trying to make a menu that on launch displays a list with some programs. The user can then add and delete the programs from the list. Each of the programs must have a link to launch the program.<br />
How would I go about doing this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th January 2006, 12:25</div></div><div class="posttext">You can do that with the NOTIFY flag of InstallOptions. See Examples\InstallOptions\testnotify.nsi for an example. It has buttons on the page and it reacts to them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">21st January 2006, 03:47</div></div><div class="posttext">Thanks kichik!<br />
works perfectly</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">21st January 2006, 04:16</div></div><div class="posttext">Now, how would I get this to work with my idea?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st January 2006, 09:21</div></div><div class="posttext">What exactly do you mean? Which part of your idea? What doesn't work for you?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">22nd January 2006, 00:50</div></div><div class="posttext">Sorry for confusing you.<br />
I'll explain in pictures:<br />
I want it to look like this:<br />
---------------------------------<br />
|        [New]    [Remove]      |<br />
|--------------------------------<br />
|App 1                |[Launch] |<br />
|App 2                |[Launch] |<br />
...<br />
<br />
And when someone clicks the New button a popup comes up like this:<br />
---------------------------<br />
|Display Name: [_________]|<br />
|Path:[__________________]|<br />
---------------------------<br />
Which adds it to the list.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">22nd January 2006, 21:17</div></div><div class="posttext">In order to get a customized dialog with Display Name/Path, you'd probably have to use some type of plugin.  (Unfortunately, I've not seen any such plugin that allows for dual inputs.  The closest would be an input box plugin located at http://nsis.sourceforge.net/Dialog****plug-in. )<br />
<br />
As for your list of programs, here's an idea:<br />
Using InstallOptions, create a page containing a list box with buttons off the side for 'Launch', 'Add New', and remove.  When the user highlights the application and clicks the 'launch' button, the appliction would launch.  (Have a look at WinMessages.nsh for a list of supported commands.  Info for the commands themselves can be obtained from msdn.microsoft.com.)<br />
<br />
However, keep in mind that anything added dynamically to an InstallOptions page doesn't update the INI file at runtime.  This means you'd have to read the selected value of the list box using another SendMessage command.  <br />
<br />
I've attached a screenshot of what the finished page might look like.  (created using Eclipe's 'preview' function.)<br />
<br />
Please keep in mind that I offer these as suggestions only.    I'll leave it up to you to do the hard work! ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">23rd January 2006, 07:25</div></div><div class="posttext">OK instead of having a dialog<br />
I will use a FileRequest box and a text box under the Add button. Any plugins I might need/want?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">23rd January 2006, 07:31</div></div><div class="posttext">and also:<br />
Is it possible to save the dynamically added objects to a INI?<br />
What is WinMessages.nsh for?<br />
Can't I just launch with a variable and Exec?<br />
Thanks for your help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">23rd January 2006, 15:51</div></div><div class="posttext">WinMessages.nsh is a header that uses !defines to assign a hex value to a more 'meaningful' description.  It's probably easier to see than explain.  Open WinMessages.nsh located in ${NSISDIR}\include for an example and brief description.  It's uses thoughout the examples included with NSIS.<br />
<br />
Here's an example of how I use list boxes:<br />
1.  Whenever I add an item to the list, I use a ReadIniStr command to write the same value to the page's INI file (ListItems).  Use something like this in the page's leave function:<br />
<br />
; read the original value<br />
   ReadIniStr $0 '$PLUGINSDIR\io_file.ini' 'Field 8' 'ListItems' <br />
;$0 now contains the original string<br />
; Next step is to add this to the list:<br />
   ${WordAdd} $0 '|' '+StingToAdd' $R0 <br />
; finally, add the full string back to the INI<br />
   WriteIniStr '$PLUGINSDIR\swap_names.ini' 'Field 8' 'ListItems' $R0 <br />
<br />
<br />
To find out what the selected value is, just read the STATE value from the INI file during the page's leave function.<br />
<br />
To remove an item, use something like this:<br />
<br />
;Find out what's selected:<br />
   ReadIniStr $R1 '$PLUGINSDIR\swap_names.ini' 'Field 8' 'State'<br />
; if nothing is selected, then error:<br />
   StrCmp $R1 '' Jump_if_error 0<br />
; get it's index:<br />
   SendMessage $R9 ${LB_FINDSTRINGEXACT} -1 &quot;STR:$R1&quot; $R0<br />
; now delete <br />
;(note: $0 is a result var that is not used in this line):<br />
   SendMessage $R9 ${LB_DELETESTRING} $R0 0 $0<br />
; and don't forget INI file:<br />
   ReadIniStr $R2 '$PLUGINSDIR\swap_names.ini' 'Field 8' 'ListItems'<br />
   ${WordAdd} $R2 '|' '-$R1' $0<br />
   WriteIniStr '$PLUGINSDIR\swap_names.ini' 'Field 8' 'ListItems' $0<br />
<br />
   Jump_if_error:<br />
   MessageBox MB_OK &quot;You didn't select anything to delete.&quot;<br />
   abort<br />
<br />
<br />
Please be aware that the examples I provided were code snippits from one of my actual scripts so it may require some finessing to make it work in your script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">24th January 2006, 07:15</div></div><div class="posttext">Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">26th January 2006, 01:42</div></div><div class="posttext">I get an error:<br />
Invalid command: ${WordAdd}<br />
Do I need to define this somewhere or what?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">26th January 2006, 04:49</div></div><div class="posttext">Yes you do.  <br />
Its usage is explained in the help files, Appendix E ('Useful Headers').<br />
<br />
At the beginnig of your script, you must have the following 2 lines:<br />
!include &quot;WordFunc.nsh&quot;<br />
!insertmacro WordAdd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">26th January 2006, 06:37</div></div><div class="posttext">Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">28th January 2006, 01:36</div></div><div class="posttext">:( it doesn't work :( <br />
OK could someone explain how to adapt http://nsis.sourceforge.net/ListBox_example<br />
???<br />
Thanks for the help so far</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">2nd February 2006, 07:11</div></div><div class="posttext">Oh I already changed the end part to:<br />
Exec '$R1'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">5th February 2006, 03:34</div></div><div class="posttext">BTW your add section doesn't work with the ListBox example</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">5th February 2006, 04:07</div></div><div class="posttext">Also, your sections only change the parts after a recompile.<br />
How would I get it to change after each run</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">5th February 2006, 17:10</div></div><div class="posttext">Also, your sections only change the parts after a recompile.<br />
How would I get it to change after each run <br />
<br />
I'm not sure what you mean by this.<br />
<br />
BTW your add section doesn't work with the ListBox example <br />
<br />
Like I said in my original post, my examples were just snippits (cut and paste) of a working install script and that you'd probably have to modify them to fit your needs.<br />
<br />
To better illustrate, I've posted a working example for you to look at.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">6th February 2006, 06:55</div></div><div class="posttext">Thanks. What I meant was the ListBox items only changed after a recompile of the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">6th February 2006, 07:00</div></div><div class="posttext">When I click [close] it says I must have a entry, but I already have.<br />
This is basically the same as the one I have, but yours doesn't save to the file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">6th February 2006, 14:51</div></div><div class="posttext">My bad... I forgot to include the '.ini' at the end of my file name in the leave function.  The correction is posted here.<br />
<br />
And I still don't understand your original question.  The listbox is supposed to be blank each time.  The idea is that the user adds things dynamically at runtime.  If this is not what you want, then you'll need to modify the script, the ini file, or both to fit your needs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">6th February 2006, 21:30</div></div><div class="posttext">I want it to save the items so when the program is started up again, it loads the items</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">7th February 2006, 03:39</div></div><div class="posttext">If you want to save the listbox settings, then you'll need to  either save the listitems value of Field 6 (using ReadIniStr, or make a copy of the page's ini before you exit the script.  (placing it in .onInstSucess would be a good place)<br />
<br />
Then, simply modify your main script's .onInit function to return the value (or entire INI file, however you choose to do it) so that the values are there when the page displays.<br />
<br />
If you're having trouble, have a look at the docs and examples  included with NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">7th February 2006, 10:01</div></div><div class="posttext">I put in onInit:<br />
<br />
FileOpen $0 menu.txt r<br />
FileRead $0 $1<br />
WriteINIStr &quot;menu.ini&quot; 'Field 4' 'ListItems' $1<br />
FileClose $0<br />
<br />
And in onInstSuccess:<br />
<br />
ReadINIStr $R0 'menu.ini' 'Field 4' 'ListItems'<br />
FileOpen $0 menu.txt w<br />
FileWrite $0 $R0<br />
FileClose $0<br />
<br />
What you were thinking of?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">7th February 2006, 22:32</div></div><div class="posttext">Your idea should work fine.  (My other idea involved copying the entire INI from the $PLUGINSDIR in .onInstSucdss and then restoring it later in .onInit.  Either way should work fine.)<br />
<br />
Just a few points:<br />
1.  Remember to use $PLUGINSDIR\menu.ini in the ReadIniStr and WriteIniStr calls since that were it will be at runtime.  (Or, you can use MUI_INSTALLOPTIONS_READ and MUI_INSTALLOPTIONS_WRITE, in which case, you'd omit $PLUGINSDIR since it's appended automatically with those 2 macros.)<br />
<br />
2.  Remember to initialize $PLUGINSDIR in .onInit before you try to write anything.  MUI_INSTALLOPTIONS_EXTRACT does this for you, so insert your INI file code (above) AFTER this call and you'll be fine.<br />
<br />
3.  Remember to read/write the proper fields.  I noticed your example was Field 4, but in my posting, it was field 6.  Without seeing your INI file, I'm not sure if your was a typo or if you just configured your INI file slightly different than my example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">8th February 2006, 07:27</div></div><div class="posttext">Yeah, my script is different.<br />
Thanks for your help<br />
Really appreciate it :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rmccue</div><div class="date">9th February 2006, 09:28</div></div><div class="posttext">Is there a way to display say Xname but still have it open x:\b\t.jmd<br />
for example</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">9th February 2006, 20:06</div></div><div class="posttext">hmmm... An easy way might be to edit your page's INI file to include a section named Launch.  Then in that section, define the name/real-value pairs.  Like this:<br />
<br />
[LAUNCH]<br />
Xname=x:\b\t.jmd<br />
<br />
<br />
This would allow you to keep all your unique names in one place, making it easier to keep track of in case you ever needed to update.  Plus, you'd have just one file to keep track of.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>