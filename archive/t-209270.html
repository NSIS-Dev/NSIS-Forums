<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Unistaller code seems to not work, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Unistaller code seems to not work NSIS Discussion" />
	
	<title> Unistaller code seems to not work [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Unistaller code seems to not work</div>
<hr />
<div class="pda"><a href="t-209270.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=209270">Unistaller code seems to not work</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pet_Gr</div><div class="date">1st March 2005, 22:38</div></div><div class="posttext">Hello i've write here my uninstaller section, but it seems that it's not working because it doesn't delete the directory neither the unistall program<br />
Section &quot;Uninstall&quot;<br />
<br />
  Delete &quot;$INSTDIR\Reports\Dba\*.*&quot;<br />
  Delete &quot;$INSTDIR\Reports\Objetos\*.*&quot;<br />
  Delete &quot;$INSTDIR\Reports\PLSQL\*.*&quot;<br />
  Delete &quot;$INSTDIR\Reports\Usuario\*.*&quot;<br />
  Delete &quot;$INSTDIR\Manual.pdf&quot;<br />
  Delete &quot;$INSTDIR\Manual.cnt&quot;<br />
  Delete &quot;$INSTDIR\Manual.hlp&quot;<br />
  Delete &quot;$INSTDIR\Manual.lang&quot;<br />
  Delete &quot;$INSTDIR\Manual.pdf&quot;<br />
  Delete &quot;$INSTDIR\Uninstall.exe&quot;<br />
  Rmdir &quot;$INSTDIR\Reports\Dba&quot;<br />
  Rmdir &quot;$INSTDIR\Reports\Objetos&quot;<br />
  Rmdir &quot;$INSTDIR\Reports\PLSQL&quot;<br />
  Rmdir &quot;$INSTDIR\Reports\Usuario&quot;<br />
  Rmdir &quot;$INSTDIR\Reports&quot;<br />
  Rmdir &quot;$INSTDIR&quot;<br />
  <br />
  <br />
SectionEnd<br />
Can someone help me?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">1st March 2005, 23:42</div></div><div class="posttext">uninstaller sections must begin with un. (i.e. Section &quot;un.Uninstaller&quot;) as written in the manual (http://nsis.sourceforge.net/Docs/Chapter2.html#2.3.3). if RMDir (http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.1.8 ) still doesn't work then, use it with /REBOOTOK.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">2nd March 2005, 00:12</div></div><div class="posttext">No, that's just for sections beyond the first. If you only have one, the proper name is &quot;Uninstall&quot;. See #4.6.2 (http://nsis.sourceforge.net/Docs/Chapter4.html#4.6.2) in the manual.<br />
<br />
As for getting the files deleted, you should (as said above) try using /REBOOTOK, in case some of the files are in use. Also be sure that your uninstaller is placed in the program directory, as that's where the uninstaller gets $INSTDIR from (also mentioned in #4.6.2 (http://nsis.sourceforge.net/Docs/Chapter4.html#4.6.2)). If it isn't, place it there or retrieve the value from somewhere, such as the registry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pet_gr</div><div class="date">2nd March 2005, 07:46</div></div><div class="posttext">I'll try to test it, thanks to all in anyway you<br />
Greetings<br />
Pedro Garcia Rodriguez</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pet_Gr</div><div class="date">2nd March 2005, 09:56</div></div><div class="posttext">no work.what can i do the /rebootok don't delete the directory  and don't delete the uninstall program</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd March 2005, 14:19</div></div><div class="posttext">Just do:<br />
Rmdir /rebootok /r &quot;$INSTDIR&quot;<br />
<br />
/r == recursive, so it'll delete the directory and all files in it (if it isn't empty).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pet_Gr</div><div class="date">3rd March 2005, 11:31</div></div><div class="posttext">I used the instdir in this way<br />
c:\bla bla bla\ ble ble ble<br />
THe installer delete the ble ble ble but no the bla bla directory<br />
anyone knows why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pidgeot</div><div class="date">3rd March 2005, 14:05</div></div><div class="posttext">RMDir only removes the topmost directory specified, in this case &quot;ble ble ble&quot;, regardless whether or not you specify recursive deletion. If you want to delete &quot;bla bla bla&quot; as well, you need to find uot what &quot;bla bla bla&quot; is and delete it with an additional RMDir.<br />
<br />
Being able to delete &quot;bla bla bla&quot; with RMDir &quot;C:\bla bla bla\ble ble ble&quot; would be very insecure, as you may end up deleting something important.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd March 2005, 14:11</div></div><div class="posttext">Ah right, this is a problem that has always existed.<br />
I wrote this function quite a while ago which should work:<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=302<br />
<br />
You pass it your $INSTDIR and then the number of parent folders to remove. It will remove the folders only if they are empty.<br />
The top level folder ($INSTDIR) will be removed with /r switch so you do not need to use Rmdir /rebootok /r &quot;$INSTDIR&quot; anymore.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gato Muerto</div><div class="date">29th April 2005, 02:40</div></div><div class="posttext">I've tried including the code, but it just doesn't seem to work.  The code included is as follows:<br />
<br />
<br />
Function un.UninstallDirs<br />
  Exch $R0 ;input string<br />
  Exch<br />
  Exch $R1 ;maximum number of dirs to check for<br />
  Push $R2<br />
  Push $R3<br />
  Push $R4<br />
  Push $R5<br />
    IfFileExists &quot;$R0\*.*&quot; 0 +2<br />
    RMDir /r &quot;$R0&quot;<br />
    StrCpy $R5 0<br />
  top:<br />
    StrCpy $R2 0<br />
    StrLen $R4 $R0<br />
  loop:<br />
    IntOp $R2 $R2 + 1<br />
      StrCpy $R3 $R0 1 -$R2<br />
    StrCmp $R2 $R4 exit<br />
    StrCmp $R3 &quot;\&quot; 0 loop<br />
      StrCpy $R0 $R0 -$R2<br />
        IfFileExists &quot;$R0\*.*&quot; 0 +2<br />
        RMDir &quot;$R0&quot;<br />
      IntOp $R5 $R5 + 1<br />
      StrCmp $R5 $R1 exit<br />
  Goto top<br />
  exit:<br />
  Pop $R5<br />
  Pop $R4<br />
  Pop $R3<br />
  Pop $R2<br />
  Pop $R1<br />
  Pop $R0<br />
FunctionEnd<br />
<br />
#location where code is called is elsewhere (uninstall section):<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
#Code clipped for brevity<br />
  RMDir /R &quot;$INSTDIR&quot;<br />
  Push 2<br />
  Push &quot;$INSTDIR&quot;<br />
  Call un.UninstallDirs<br />
<br />
StrCpy $0 &quot;%c&quot;<br />
CallInstDLL &quot;$PLUGINSDIR\nsisdt.dll&quot; currentdate<br />
DetailPrint &quot;Uninstallation finished $0.&quot;<br />
Push &quot;$TEMP\${PRODUCTNAME}-uninstall.log&quot;<br />
DetailPrint &quot;Please wait while uninstaller finishes...&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>