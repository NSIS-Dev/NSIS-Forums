<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" VIProductVersion not performing define substitution?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  VIProductVersion not performing define substitution? NSIS Discussion" />
	
	<title> VIProductVersion not performing define substitution? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  VIProductVersion not performing define substitution?</div>
<hr />
<div class="pda"><a href="t-307250.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=307250">VIProductVersion not performing define substitution?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">10th June 2009, 15:54</div></div><div class="posttext">Just updated to 2.45, and now VIProductVersion, which in previous builds was converting defines to numbers for me, is no longer working, and complains about the format (requiring X.X.X.X).<br />
<br />
I have code that basically does the following:<br />
<br />
!searchparse /noerrors /file &quot;version.rc&quot; &quot;#define kReleaseVersion&quot; PRODUCT_VERSION_MAJOR &quot;,&quot; PRODUCT_VERSION_MINOR &quot;,&quot; PRODUCT_VERSION_SUBRELEASE<br />
<br />
!define PRODUCT_VERSION &quot;${PRODUCT_VERSION_MAJOR}.${PRODUCT_VERSION_MINOR}.${PRODUCT_VERSION_SUBRELEASE}&quot;<br />
<br />
!define INSTALLER_RELEASE &quot;0&quot;<br />
!define	INSTALLER_PRODUCT_VERSION &quot;${PRODUCT_VERSION}.${INSTALLER_RELEASE}&quot;<br />
<br />
...<br />
<br />
VIProductVersion &quot;${INSTALLER_PRODUCT_VERSION}&quot; <br />
<br />
This used to work fine, and no longer does. Bug?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">10th June 2009, 16:13</div></div><div class="posttext">Actually, glancing at the release notes, I see the following ominous note:<br />
<br />
Fixed !searchparse (bug #2680110)<br />
<br />
Since I rely on !searchparse to perform the above operation, and since now, even if I subsitute literals for the !define values to VIProductVersion, I get errors complaining that the !defines are no longer defined, I'm beginning to suspect that !searchparse isn't doing what it's supposed to anymore.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">10th June 2009, 16:15</div></div><div class="posttext">should still work.  why not use &quot;!echo ${INSTALLER_PRODUCT_VERSION}&quot; to check what the value ends up as?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">10th June 2009, 16:23</div></div><div class="posttext">If I remove the /noerrors flag, I get a 'string not found in file' error. This is patently false, since the string does exist in the file.<br />
<br />
Upon closer observation, I note that there is now a new bug filed, 2803622, 'SearchParse regression in 2.45', which describes exactly this problem. So I'm not the only one, it appears.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th June 2009, 16:27</div></div><div class="posttext">Works fine for me when the file just contains #define kReleaseVersion 1,0,0<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">10th June 2009, 16:35</div></div><div class="posttext">Okay, now put a blank line in front of it, like this:<br />
<br />
<br />
<br />
#define	kCMWinReleaseVersion		2,2,2<br />
#define	kCMWinReleaseCode			101<br />
#define	kCMWinBuildNumber			416</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th June 2009, 16:45</div></div><div class="posttext">Is that from the file you are using? If so then it's got kCMWinReleaseVersion and not kReleaseVersion in it.<br />
<br />
But otherwise if I do put some blank lines in front of it it has no effect.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">10th June 2009, 16:55</div></div><div class="posttext">Yes, sorry, forgot to cleanse the names. But they're what I'm using.<br />
<br />
I've enclosed a zipped copy of a test script and the data file. Try compiling SearchParseTest.nsi; does it work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th June 2009, 17:14</div></div><div class="posttext">The problem is that the file is using only line feeds for new lines as opposed to carriage returns + line feeds. Interesting that this breaks !searchparse<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">10th June 2009, 17:19</div></div><div class="posttext">Yup. That's it exactly. Thought I had checked for that, but I guess not.<br />
<br />
In any case, !searchparse used to be able to handle it, but no longer does, apparently.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">10th June 2009, 17:27</div></div><div class="posttext">Hm. May have spoken too soon. I just tried the test file again, having ensured that all my line breaks are CRLF, and it doesn't work. I've enclosed a new copy of the test script and file, zipped. Does this work for you, or not?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th June 2009, 20:11</div></div><div class="posttext">Yeh definitely a new bug. It looks like it stops searching when it finds an empty line. As you said if you don't have the blank line or if you just put in some spaces or tabs then it works fine.<br />
<br />
Please file a bug report on the tracker:<br />
http://sourceforge.net/tracker/?group_id=22049&amp;atid=373085<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">11th June 2009, 07:58</div></div><div class="posttext">Shouldn't I just add to the one already filed (2680110)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mtconleyuk</div><div class="date">11th June 2009, 08:14</div></div><div class="posttext">Sorry, I meant 2803622, and it looks like that one's been closed as fixed. So hopefully this goes away in the next release.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>