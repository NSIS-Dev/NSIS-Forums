<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" OS and IE Version checking, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  OS and IE Version checking NSIS Discussion" />
	
	<title> OS and IE Version checking [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  OS and IE Version checking</div>
<hr />
<div class="pda"><a href="t-46723.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=46723">OS and IE Version checking</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rizzi</div><div class="date">9th April 2001, 19:42</div></div><div class="posttext">I've customized NSIS (based on the 1.1z codebase) to forbid installations that don't have at least certain versions of the OS and/or IE browser.<br />
<br />
What is the procedure for submitting it for inclusion into the NSIS mainline? <br />
<br />
I've bracketed all the new code with NSIS_SUPPORT_VERSION_CHECKING #ifdef blocks so that it doesn't increase the header size for folks who don't want or need this functionality.<br />
<br />
I'd also appreciate comments/suggestions to make it better.<br />
<br />
Should I send a copy to this list as an attachment? Or should I make it available via a URL?<br />
<br />
Preferences?<br />
<br />
thanks,<br />
mike rizzi<br />
Contract Software Engineer for<br />
Kenamea, Inc.<br />
<br />
For interested parties, here are example NSI file entries with documentation comments (unfortunately, the tab/spaces get scrunched in the forum display format). Note that Windows has two different product lines (9x and NT) with overlapping version numbers, hence the need for separate commands for each.<br />
<br />
;VersionCheckWin9xBased major_version [minor_version]<br />
;   example values<br />
;       OS      major_version minor_version<br />
;       --      ------------- -------------<br />
;       win95   4               0<br />
;       win98   4               10<br />
;       winME   4               90<br />
VersionCheckWin9xBased 4 10<br />
<br />
;VersionCheckWinNTBased major_version [minor_version] [service_pack_level]<br />
;   example values<br />
;       OS      major_version minor_version<br />
;       --      ------------- -------------<br />
;       winNT   4 or less<br />
;       win2000 5               0<br />
;       winXP   5               1<br />
VersionCheckWinNTBased 4 0 4<br />
<br />
;IEVersionCheck major_version_allowed [minor_version_allowed]<br />
;   NOTE: <br />
;       Unfortunately, the major version numbers aren't in sync with<br />
;       the common names for Internet Explorer before version 5<br />
;       for example<br />
;           IEVersionCheck 4 70 ;(for Internet Explorer 3.x)<br />
;           IEVersionCheck 4 71 ;(for Internet Explorer 4.0)<br />
;           IEVersionCheck 4 72 ;(for Internet Explorer 4.01)<br />
;           IEVersionCheck 5 0  ;(for Internet Explorer 5.0)<br />
;           IEVersionCheck 5 5  ;(for Internet Explorer 5.5)<br />
IEVersionCheck 4 71</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rizzi</div><div class="date">19th April 2001, 19:37</div></div><div class="posttext">I've finally put the source code for the OS and IE browser checking up for y'all to get, use, and/or comment on.<br />
It can be found at <br />
<br />
http://www.browbeat.com/kenamea/KenameaNSISSource.zip<br />
<br />
I've tried to mimic Justins coding style as much as possible, though it probably could be tightened up a bit to reduce the header size.<br />
<br />
Any comments appreciated. Thanks.<br />
Mike Rizzi<br />
<br />
p.s. here is the text of the ReadMe file I included<br />
<br />
Kenamea Read Me<br />
---------------<br />
18 April 2001<br />
Mike Rizzi<br />
<br />
This modified version of NSIS was created to allow<br />
for OS and IE Browser version checking at the beginning<br />
of the installation process.<br />
<br />
The modifications are based on version 1.1z of NSIS.<br />
<br />
Kenamea modified portions of the code are commented or<br />
bracketed thusly<br />
	x = 1; // KENAMEA_ADDED_CODE<br />
or<br />
	// BEGIN_KENAMEA_ADDED_CODE<br />
	if ( x == 1 )<br />
		do_something();<br />
	// END_KENAMEA_ADDED_CODE<br />
<br />
The files we modified are:<br />
	makenssi.cpp<br />
	makenssi.dsp<br />
	tokens.h<br />
	exehead\Main.c<br />
	exehead\config.h<br />
	exehead\exehead.dsp<br />
	exehead\fileform.h<br />
<br />
Also, we've added two source files versioncheck.c and<br />
versioncheck.h<br />
<br />
The file OS_IE_VersionSample.nsi contains documentation<br />
on the new commands that were added. It isn't a complete<br />
NSI file, it is an excerpt sample.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glenncarr</div><div class="date">20th June 2002, 23:01</div></div><div class="posttext">Any idea when/if these changes for checking the OS and IE versions will be merged into the latest NSIS?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">21st June 2002, 07:50</div></div><div class="posttext">Maybe this (http://forums.winamp.com/showthread.php?s=&amp;threadid=91534) provides an answer to the question of glenncarr.<br />
<br />
-Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glenncarr</div><div class="date">21st June 2002, 09:08</div></div><div class="posttext">:( bummer...  guess I'll have to maintain my own version for a while.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Schultz</div><div class="date">21st June 2002, 13:02</div></div><div class="posttext">Why would you want to add this to NSIS when you got a Extension DLL that will do this for you..<br />
http://forums.winamp.com/showthread.php?threadid=70361</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glenncarr</div><div class="date">21st June 2002, 14:55</div></div><div class="posttext">Sorry, didn't see that.  <br />
<br />
Is there one for getting the IE version?  That's what I really need more than the OS.  If not, I guess I'll have to write one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st June 2002, 15:23</div></div><div class="posttext">It could be added to my sysinfo dll (info here (http://www.clantpa.co.uk/nsis/sysinfoV0.0.php) - although this page will be moving this weekend sometime to my main nsis archive)<br />
<br />
Actually I'll add it to that anyway sometime soon just for completeness.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st June 2002, 15:27</div></div><div class="posttext">Sorry I keep moving stuff around on that server at the mo - the big reshuffle is this weekend - the file that page talks about is here (http://www.clantpa.co.uk/nsis/x18sysinfoV0.0.zip)<br />
<br />
(I would've edited my post but of course I can't :igor:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glenncarr</div><div class="date">21st June 2002, 16:07</div></div><div class="posttext">Cool.  The GetDLLVersion function says it requires a full path to the DLL.  Is that really true?  Will it possibly try to find it in the PATH?  If so, I can just use GetDLLVersion with shdocvw.dll.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st June 2002, 16:44</div></div><div class="posttext">If you are referring to GetDllVersion in my sysinfo DLL it will work on a path because it calls LoadLibrary on the DLL. *However* not all DLLs support the GetDllVersion mechanism. The DLL has to export a method called DllGetVersion - if it doesn't then this method will not return any version information.<br />
<br />
In that case you have to fall back to one of the other means of querying the DLL for a version number, i.e. GetFileVersion.<br />
<br />
I can't be sure if GetFileVersion will search the default paths or not, it's a bit hard to tell from the Win32 API docs. Basically they say that GetModuleHandle which it calls does not need a path, it doesn't say what happens if it doesn't have one.<br />
<br />
I *believe* it will search the default path since that whole chunk of the Win32 API is connected with loading and using DLLs which involves obeying path information.<br />
<br />
I'll have to update those docs when I move them across to the new database, thanks for spotting that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st June 2002, 16:45</div></div><div class="posttext">Grr wish I could edit posts, first line should say &quot;it will work *without* a path&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st June 2002, 16:51</div></div><div class="posttext">Just checked - shdocvw.dll *does* support the DllGetVersion mechanism... check the attached text file for full version info on that dll using my code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glenncarr</div><div class="date">21st June 2002, 17:01</div></div><div class="posttext">:D Great!  Thanks a ton.<br />
<br />
Glenn</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glenncarr</div><div class="date">21st June 2002, 21:05</div></div><div class="posttext">So, I've determined that I can do what I want with this:<br />
<br />
  GetDLLVersion &quot;shdocvw.dll&quot; $1 $4<br />
  IntOp $2 $1 &amp; 0xffff0000<br />
  IntOp $2 $2 /    0x10000<br />
  IntOp $3 $1 &amp; 0x0000ffff<br />
  IntOp $5 $4 &amp; 0xffff0000<br />
  IntOp $5 $5 /    0x10000<br />
  IntOp $6 $4 &amp; 0x0000ffff<br />
  DetailPrint 'IE Version: $2.$3.$5.$6'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">21st June 2002, 21:11</div></div><div class="posttext">Nice one, no point using a DLL if you don't need to. The DLL of mine was written for me for a specific use, it can provide access to version strings embedded in executables, the other functionality was related so in my installer instead of using two mechanisms I just used the one.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>