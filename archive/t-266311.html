<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Getting IfFileExists to work for a directory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Getting IfFileExists to work for a directory NSIS Discussion" />
	
	<title> Getting IfFileExists to work for a directory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Getting IfFileExists to work for a directory</div>
<hr />
<div class="pda"><a href="t-266311.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=266311">Getting IfFileExists to work for a directory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jrenbaum</div><div class="date">21st February 2007, 20:45</div></div><div class="posttext">I have been trying, unsuccessfully, to get NSIS to include a directory in my installer if the directory exists and to skip the attempt to include the directory if it does not exist. I have tried every combination of the IfFileExists instruction and even tried using the LogicLib.nsh include as follows:<br />
<br />
  ${If} ${FileExists} &quot;${ZB_DOCS_PATH}\*.*&quot;<br />
    DetailPrint 'Source file &quot;${ZB_DOCS_PATH}\*.*&quot; exists'<br />
    ; Add the documentation directory and files to the installer<br />
    SetOutPath $INSTDIR<br />
    File /r /x CVS ${ZB_DOCS_PATH}<br />
  ${Else}<br />
    DetailPrint 'Source file &quot;${ZB_DOCS_PATH}\*.*&quot; does not exist'<br />
  ${EndIf}<br />
<br />
I am runing this from inside of a Section. <br />
<br />
Each time I run this, with or without the &quot;\*.*&quot;, the app attempts to include the ${ZB_DOCS_PATH} directory in the installer whether it exists or not. If it does not exist, then the build fails. Here is the output I am seeing when the directory does exist:<br />
<br />
!insertmacro: _If<br />
!insertmacro: end of _If<br />
DetailPrint: &quot;Source file &quot;..\..\documentation\*.*&quot; exists&quot;<br />
SetOutPath: &quot;$INSTDIR&quot;<br />
File: Descending to: &quot;..\..\documentation\&quot;<br />
File: &quot;fred.txt&quot; [compress] 17/19 bytes<br />
File: Returning to: &quot;..\..&quot;<br />
!insertmacro: _Else<br />
!insertmacro: end of _Else<br />
DetailPrint: &quot;Source file &quot;..\..\documentation\*.*&quot; does not exist&quot;<br />
!insertmacro: _EndIf<br />
!insertmacro: end of _EndIf<br />
<br />
This looks like it is going through both the IF and the ELSE which doesn't make sense.<br />
<br />
The documentation folder is not included in the installer in this case. When I do the same using the IfFileExists instruction, the folder is included if it is present, but fails if it is not present. I have tried using Goto Labels and offsets to no avail. <br />
<br />
When running the same compile without the documentation folder being present as defined by ${ZB_DOCS_PATH} the build failes with the following:<br />
<br />
!insertmacro: _If<br />
!insertmacro: end of _If<br />
DetailPrint: &quot;Source file &quot;..\..\documentation\*.*&quot; exists&quot;<br />
SetOutPath: &quot;$INSTDIR&quot;<br />
File: Returning to: &quot;..\..&quot;<br />
File: &quot;..\..\documentation&quot; -&gt; no files found.<br />
Usage: File [/nonfatal] [/a] ([/r] [/x filespec [...]] filespec [...] |<br />
   /oname=outfile one_file_only)<br />
Error in script &quot;C:/builds/Clients/Ankus_R1-0/trunk/hcrest.zuibrowser.win32/../hcrest.zuibrowser.win<br />
32/installer/ZuiBrowserInstaller.nsi&quot; on line 166 -- aborting creation process<br />
NMAKE : fatal error U1077: '&quot;C:\Program Files\NSIS\makensis.exe&quot;' : return code '0x1'<br />
Stop.<br />
NMAKE : fatal error U1077: '&quot;C:\Program Files\Microsoft Visual Studio .NET 2003\VC7\BIN\nmake.exe&quot;'<br />
: return code '0x2'<br />
Stop.<br />
NMAKE : fatal error U1077: '&quot;C:\Program Files\Microsoft Visual Studio .NET 2003\VC7\BIN\nmake.exe&quot;'<br />
: return code '0x2'<br />
Stop.<br />
NMAKE : fatal error U1077: '&quot;C:\Program Files\Microsoft Visual Studio .NET 2003\VC7\BIN\nmake.exe&quot;'<br />
: return code '0x2'<br />
Stop.<br />
<br />
In this case the source file &quot;..\..\documentation\*.*&quot; definitely does not exist, yet NSIS is still going into the IF section rather than the ELSE section.<br />
<br />
Any help would be appreciated. I am using v2.24, but this happens for earlier versions as well.<br />
<br />
Thanks,<br />
<br />
Jay Renbaum</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st February 2007, 21:00</div></div><div class="posttext">That's a common misunderstanding, you're trying to execute run time commands at compile time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jrenbaum</div><div class="date">21st February 2007, 22:09</div></div><div class="posttext">OK,<br />
<br />
That makes sense. That being said, is there a way to do what I want? Have NSIS include the folder in the installer if it is present, but not event try to include it if it is not present?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">21st February 2007, 22:19</div></div><div class="posttext">Define that folder by executing makensis from command line with /D switch and use !ifdel in your script to include/exclude the folder.<br />
<br />
Also take a look at this thread, might be helpful,<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=265319</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>