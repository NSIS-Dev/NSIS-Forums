<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RunAs administrator then execute as desktop user, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RunAs administrator then execute as desktop user NSIS Discussion" />
	
	<title> RunAs administrator then execute as desktop user [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RunAs administrator then execute as desktop user</div>
<hr />
<div class="pda"><a href="t-303567.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=303567">RunAs administrator then execute as desktop user</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">umeca74</div><div class="date">27th February 2009, 11:23</div></div><div class="posttext">Hi<br />
<br />
I have this situation for PRE-vista installations. If a normal user wants to install, I force him to use runas with admin privileges, so the installer runs elevated compared to the desktop logged user.<br />
<br />
Q1. How do I know that this is the case? (ie differentiate runas vs normal admin user)<br />
<br />
If my installer detects this is the case then it needs to run a step using the desktop user credentials. Is there any way to do this? (I have looked at UAC plugin but I don't think it would work under this scenario - it needs the installer to start as the desktop user?)<br />
<br />
what I need is CreateProcessAsUser equivalent for NSIS<br />
<br />
thanks<br />
nikos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th February 2009, 12:09</div></div><div class="posttext">I don't 100% understand what you mean, but using the uac plugin (calling UAC::ExecCodeSegment) should be able to do what you need</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v_automation</div><div class="date">27th February 2009, 12:43</div></div><div class="posttext">Hi<br />
<br />
Setting RequestExecutionLevel to highest will ask user for admin rights if user is from admin group, but install will continue with normal user rights if user is normal user, but not admin and cannot run applications with admin rights</div></div><hr />


<div class="post"><div class="posttop"><div class="username">umeca74</div><div class="date">28th February 2009, 07:07</div></div><div class="posttext">can UAC work in this scenario in &quot;old&quot; windows? (before vista)<br />
<br />
* NORMAL user starts the installer with &quot;runas&quot; to elevate<br />
<br />
* the installer runs as admin but some portions of it use the desktop user<br />
<br />
from my understanding how UAC works, it finds out who the desktop user is when it is first launched as the desktop (ie. normal) user</div></div><hr />


<div class="post"><div class="posttop"><div class="username">v_automation</div><div class="date">28th February 2009, 11:05</div></div><div class="posttext">To run as desktop user means you cannot modify registry keys except these in HKCU and cannot access system files and folders.<br />
<br />
So you decide what will do your installer when it is started from whatever account type.<br />
<br />
If your installer edit registry keys only in KHCU and does not copy files in system folders then no matter it is started with admin rights is will be limited to access rights of normal user<br />
<br />
To check if installer is started with admin rights or with rights of normal user, you can try to access some registry key or folder that is not available for normal user (for example $SYSDIR). If key/folder can be accessed your installer is started with admin rights. If you get error then installer is started from normal user account</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">28th February 2009, 14:33</div></div><div class="posttext">a while ago i tried to build a fake-uac (via nsDialogs) for pre-vista windows, but i had problems when a user had an empty password. sorry, i don't recall the exact the scenario, but there were similiar problems - which made me abandon the idea at some point.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th February 2009, 15:59</div></div><div class="posttext">the UAC plugin works on ANY version of windows, the part where it actually elevates and uses two processes works on 2000 and later.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">umeca74</div><div class="date">28th February 2009, 16:20</div></div><div class="posttext">the UAC plugin works on ANY version of windows, the part where it actually elevates and uses two processes works on 2000 and later<br />
<br />
you are the author of this plugin, right? who will ask the user for elevation, your plugin or the user beforehand? As I said if the user before launching the installer uses runas to elevate himself, then the link to the &quot;normal&quot; desktop user will be lost, wouldn't it? Even if your plugin uses 2 processes they will both be elevated. If not, can you tell me how you figure out the desktop user?<br />
<br />
thanks<br />
nikos</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th February 2009, 16:33</div></div><div class="posttext">yes, if the user does runas first, then the game is over, but you should not fight this, its the users choice, you don't know which user they really want to install as...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>