<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Customize Spring-Installer on-the-fly (when downloading), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Customize Spring-Installer on-the-fly (when downloading) NSIS Discussion" />
	
	<title> Customize Spring-Installer on-the-fly (when downloading) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Customize Spring-Installer on-the-fly (when downloading)</div>
<hr />
<div class="pda"><a href="t-324837.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=324837">Customize Spring-Installer on-the-fly (when downloading)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">abma</div><div class="date">13th December 2010, 15:43</div></div><div class="posttext">i want to customize an nsis-installer on the fly, an php-script should attach some zip-files + some data, where theses files should be installed. Did someone try this?<br />
<br />
In general, the php script should do something like this:<br />
<br />
<br />
file_get_contents('nsis_setup.exe');<br />
if ($param==&quot;attach&quot;){<br />
 file_get_contents('some_data');<br />
 echo 'ATTACHED'; //attach tag<br />
 echo filesize('nsis_setup.exe'); //attach offset<br />
}<br />
<br />
<br />
and the installer itselfs should check if the tag + offset is avaiable.<br />
<br />
if so, it should extract the attached file.<br />
<br />
any ideas/suggestions how to do that? is that possible with the nsis installer?<br />
<br />
i try to modify the installer of an engine, that it can be customized to attach an game and an game-map to the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">13th December 2010, 21:26</div></div><div class="posttext">The ReadCustomerData function may be of interest to you. Basically you can just append whatever data you want to an NSIS exe, it won't break. You will however have to add your own integrity checks, as the NSIS CRC check only covers the installer part of the exe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CrushBug</div><div class="date">14th December 2010, 05:38</div></div><div class="posttext">The ReadCustomerData function may be of interest to you. Basically you can just append whatever data you want to an NSIS exe, it won't break. You will however have to add your own integrity checks, as the NSIS CRC check only covers the installer part of the exe.<br />
<br />
Where is this ReadCustomerData function? I didn't find it in the NSIS help file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abma</div><div class="date">14th December 2010, 06:02</div></div><div class="posttext">http://nsis.sourceforge.net/ReadCustomerData</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">14th December 2010, 06:43</div></div><div class="posttext">Try google. It often helps when you want to find something.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abma</div><div class="date">14th December 2010, 10:58</div></div><div class="posttext">thanks, that helped a lot!<br />
<br />
now i'm having problems, how to copy parts of binary data from the installer:<br />
<br />
<br />
<br />
        ;Reads last bytes from installer, checks if it is SPRING&lt;START&gt;&lt;LENGTH&gt;<br />
        ;then reads from installer at pos &lt;START&gt; &lt;LENGTH&gt; bytes<br />
        FileOpen $0 $EXEPATH r<br />
        FileSeek $0 -10 END<br />
<br />
        ;check if signature found (6 Bytes)<br />
        FileRead $0 $1 6<br />
        DetailPrint &quot;Signature read: $1&quot;<br />
        StrCmpS $1 'SPRING' 0 end<br />
<br />
        ;Last bytes contains offset (4 Bytes)<br />
        FileReadByte $0 $1 ;read byte into $1<br />
        System::Int64Op $1 &lt;&lt; 24 ; shift left<br />
        Pop $2 ; store in $0<br />
<br />
        FileReadByte $0 $1<br />
        System::Int64Op $1 &lt;&lt; 16<br />
        Pop $3<br />
        System::Int64Op $2 + $3<br />
        Pop $2<br />
<br />
        FileReadByte $0 $1<br />
        System::Int64Op $1 &lt;&lt; 8<br />
        Pop $3<br />
        System::Int64Op $2 + $3<br />
        Pop $2<br />
<br />
        FileReadByte $0 $1<br />
        System::Int64Op $1 + $2<br />
        Pop $5<br />
<br />
        DetailPrint &quot;Custom Data starts at: $5&quot;<br />
<br />
        MessageBox MB_OK &quot;Read Signature done&quot;<br />
<br />
;TODO: do until here on init<br />
<br />
        ;signature found, read offset where ini files start<br />
<br />
        System::Call 'msvcrt.dll::calloc(i 1024, i 1) i .r0' ; creates a 1024 size buffer<br />
        MessageBox MB_OK &quot;Opening Installer file $EXEPATH&quot;<br />
        System::Call 'msvcrt.dll::_open($EXEPATH,  i 0x8000) i .r1' ; open first file<br />
<br />
        MessageBox MB_OK &quot;Seeking to adress $5&quot;<br />
        ;fseek to offset<br />
        System::Call 'msvcrt.dll::_lseek(i r1, i $5, i 0) i .r1' ; seek to position of ini<br />
<br />
        System::Call 'msvcrt.dll::_open(t &quot;$INSTDIR\prueba2.bin&quot;, i 0x8101) i .r2' ; open second file, mode create|trunc|binary<br />
        System::Call 'msvcrt.dll::_read(i r1, i r0,i 1024) i .r3' ;read the first file<br />
        System::Call 'msvcrt.dll::_write(i r2, i r0,i 1024) i .r3' ;and writes to the second<br />
        System::Call 'msvcrt.dll::_close(i r1)' ; close file 1<br />
        System::Call 'msvcrt.dll::_close(i r2)' ; close file 2<br />
        System::Call 'msvcrt.dll::free(i ro)'<br />
<br />
        end:<br />
<br />
<br />
what's wrong here, i only get 1024 Null-bytes written into the destination?  Is my usage of _lseek wrong? The Offset seems to be correct. I'm a bit confused about the System::Call's...<br />
<br />
(the installer is for springrts...)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abma</div><div class="date">19th December 2010, 04:35</div></div><div class="posttext">ok, i did it:<br />
https://github.com/spring/spring/blob/customInstaller/installer/sections/customInstaller.nsh<br />
<br />
its a bit ugly, but seems to work...<br />
<br />
any hints for improvements are welcome :-)<br />
<br />
<br />
IMHO it could be better to reimplement that as plugin, but i'm new to nsis, so this would take to much time at the moment :-/</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>