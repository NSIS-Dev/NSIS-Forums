<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Moves all directories only, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Moves all directories only NSIS Discussion" />
	
	<title> Moves all directories only [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Moves all directories only</div>
<hr />
<div class="pda"><a href="t-333359.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=333359">Moves all directories only</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">yoachan</div><div class="date">9th August 2011, 03:56</div></div><div class="posttext">Dear all,<br />
<br />
One of our department made a software, and we create an NSIS installer.<br />
But due to some issue with Windows Vista and 7, they decided to move all data directories from &quot;Program Files&quot; to &quot;Shared Documents&quot;. It won't be a big issue for a new installation.<br />
But if somehow our client have already installed previous version of our software, we need to have an installer that will move all data directories from &quot;Program Files&quot; to &quot;Shared Documents&quot; while leaving all non directories in &quot;Program Files&quot;.<br />
<br />
Is there any way for me to do this?<br />
<br />
I don't think either &quot;CopyFiles&quot; or &quot;MoveFolder&quot; able to tell which is directory and which is a regular file.....<br />
<br />
edit: /FILESONLY &quot;CopyFiles&quot; can copy file only... but still doesn't fit my need... :(<br />
<br />
any help appreciated.<br />
<br />
regards,<br />
<br />
Yoachan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">9th August 2011, 05:49</div></div><div class="posttext">It's all in the manual:<br />
http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">9th August 2011, 11:57</div></div><div class="posttext">Anyway, installing program files to &quot;Shared Documents&quot; generally is a bad idea! :stare:<br />
<br />
There is a reason why program files usually are installed to &quot;Program Files&quot; folder and why that folder has special protection.<br />
<br />
NSIS does deal properly with UAC on Vista/Win7 systems. Just use &quot;RequestExecutionLevel admin&quot; or use the nice UAC plug-in.<br />
<br />
If your software doesn't work with UAC, then it's time to fix that software. Vista is on the marked for almost 5 years now.<br />
<br />
(Undermining the operating system's security mechanisms is not a good advertisement for your product, I think)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">9th August 2011, 21:13</div></div><div class="posttext">An app's binary files should go into $PROGRAMFILES. Configuration files on the other hand should go into $APPDATA or $LOCALAPPDATA.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">9th August 2011, 22:22</div></div><div class="posttext">Maybe I misunderstood his post :igor:<br />
<br />
If he indeed is moving user data (configuration files) from $PROGRAMFILES to $APPDATA, then it's the correct thing to do, of course.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">10th August 2011, 06:04</div></div><div class="posttext">Well no, that's not what he said. That's just a general statement on my part. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yoachan</div><div class="date">10th August 2011, 07:16</div></div><div class="posttext">@All: Thanks for your replies :)<br />
<br />
It's all in the manual:<br />
http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.2<br />
<br />
Yes, I've never thought about creating list that way. Thank you for your help :)<br />
<br />
Anyway, installing program files to &quot;Shared Documents&quot; generally is a bad idea! :stare:<br />
<br />
There is a reason why program files usually are installed to &quot;Program Files&quot; folder and why that folder has special protection.<br />
<br />
NSIS does deal properly with UAC on Vista/Win7 systems. Just use &quot;RequestExecutionLevel admin&quot; or use the nice UAC plug-in.<br />
<br />
If your software doesn't work with UAC, then it's time to fix that software. Vista is on the marked for almost 5 years now.<br />
<br />
(Undermining the operating system's security mechanisms is not a good advertisement for your product, I think)<br />
<br />
True :)<br />
<br />
An app's binary files should go into $PROGRAMFILES. Configuration files on the other hand should go into $APPDATA or $LOCALAPPDATA.<br />
<br />
True :)<br />
<br />
Maybe I misunderstood his post :igor:<br />
<br />
If he indeed is moving user data (configuration files) from $PROGRAMFILES to $APPDATA, then it's the correct thing to do, of course.<br />
<br />
True :)<br />
<br />
Well no, that's not what he said. That's just a general statement on my part. :)<br />
<br />
True :)<br />
<br />
well, basically I only need to move data directories out of Program Files while leaving the program's binary and executable(s) in Program Files. That's why what I need to move is only directories, and I should leave all files that scattered in InstallDir for that will be program related - non data - files.<br />
<br />
regards,<br />
<br />
YoChan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">10th August 2011, 20:16</div></div><div class="posttext">Have look at:<br />
http://msdn.microsoft.com/en-us/library/bb762164%28v=vs.85%29.aspx<br />
<br />
And:<br />
http://msdn.microsoft.com/en-us/library/bb759795%28v=vs.85%29.aspx<br />
<br />
If there is no NSIS plug-in for SHFileOperation, it should be trivial to create one (with some C experience).<br />
<br />
Otherwise the System plugin-in may give you access to that function...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th August 2011, 13:14</div></div><div class="posttext">I've hacked something together, that should do the job:<br />
<br />
Section<br />
    #extract some dummy files<br />
    InitPluginsDir<br />
    SetOutPath &quot;$PLUGINSDIR\TestDirA&quot;<br />
    File &quot;${NSISDIR}\Contrib\Graphics\Checks\*.*&quot;<br />
<br />
    #move the directory<br />
    push &quot;$PLUGINSDIR\TestDirA&quot;          #from<br />
    push &quot;$PLUGINSDIR\Foobar\TestDirB&quot;   #to<br />
    push $HWNDPARENT                     #hwnd<br />
    StdUtils::SHFileMove /NOUNLOAD<br />
    pop $0                               #result (OK/ABORTED/ERROR)<br />
    DetailPrint &quot;SHFileMove: $0&quot; <br />
    <br />
    #see the result<br />
    ExecShell &quot;explore&quot; &quot;$PLUGINSDIR&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">12th August 2011, 17:17</div></div><div class="posttext">Update. Highly recommended (bugfixes). Now ANSI and Unicode versions and also with Example+Include files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">13th August 2011, 17:22</div></div><div class="posttext">Yet another update. Now complete package, including source.<br />
<br />
Wiki page:<br />
http://nsis.sourceforge.net/StdUtils_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">14th August 2011, 14:42</div></div><div class="posttext">This is a bugfix release:<br />
<br />
Demo should now run through under Win2k. Also added &quot;verbose&quot; mode.<br />
<br />
Wiki page:<br />
http://nsis.sourceforge.net/StdUtils_plug-in</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>