<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Adding input field to modern..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Adding input field to modern... NSIS Discussion" />
	
	<title> Adding input field to modern... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Adding input field to modern...</div>
<hr />
<div class="pda"><a href="t-213299.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=213299">Adding input field to modern...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Fireye</div><div class="date">15th April 2005, 18:54</div></div><div class="posttext">How would I go about adding an input field to the Modern installer?  I'd like to be able to add a text field into my simple script (Generated by Venis), which would allow me to set a variable.  Would anyone care to tell me a good place to start?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">15th April 2005, 19:30</div></div><div class="posttext">The easiest way (in my opinion) would be to create a custom page using InstallOptions. (See the InstallOptions docs included with the NSIS install.)<br />
<br />
If you were really brave, you might be able to hack the MUI ressource files.  (Something I've not been brave enough to try, but it is another option.)<br />
<br />
If you need this special input field in either the welcome or finish page, you can insert code into the PRE function of the welcome or finish page to modify the ioSpecial.ini file.  (This info comes from the MUI documentation also included with the main NSIS install.)<br />
:D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">15th April 2005, 19:32</div></div><div class="posttext">Try InstallOptions or, as my best suggestion, move-on to HM Edit Nsis (http://hmne.sourceforge.net/).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Fireye</div><div class="date">15th April 2005, 20:09</div></div><div class="posttext">Thanks for the pointers, HMEdit's giving me an error right now... here's what I have:<br />
<br />
<br />
Function .onInit<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS &quot;c:\wsus.ini&quot; &quot;wsus.ini&quot;<br />
FunctionEnd<br />
<br />
<br />
Page custom WSUSPage<br />
<br />
Function WSUSPage<br />
!insertmacro MUI_HEADER_TEXT &quot;WSUS Server...&quot; &quot;Stuff&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;wsus.ini&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_READ $server &quot;wsus.ini&quot; &quot;Field 1&quot; &quot;Text&quot;<br />
FunctionEnd<br />
<br />
<br />
and it's giving me...<br />
<br />
Function: &quot;WSUSPage&quot;<br />
!insertmacro: MUI_HEADER_TEXT<br />
!insertmacro: end of MUI_HEADER_TEXT<br />
!insertmacro: MUI_INSTALLOPTIONS_DISPLAY<br />
!insertmacro: end of MUI_INSTALLOPTIONS_DISPLAY<br />
!insertmacro: MUI_INSTALLOPTIONS_READ<br />
Usage: ReadINIStr $(user_var: output) ini_file section entry_name<br />
Error in macro MUI_INSTALLOPTIONS_READ on macroline 5<br />
Error in script &quot;C:\Program Files\HMSoft\NIS Edit\wsus.nsi&quot; on line 108 -- aborting creation process<br />
<br />
<br />
Where my ini is:<br />
<br />
; Ini file generated by the HM NIS Edit IO designer.<br />
[Settings]<br />
NumFields=2<br />
Title=Setting our WSUS Server<br />
NextButtonText=Next<br />
BackButtonText=Previous<br />
<br />
[Field 1]<br />
Type=Text<br />
State=Text<br />
Left=54<br />
Right=267<br />
Top=28<br />
Bottom=41<br />
<br />
[Field 2]<br />
Type=Label<br />
Text=Server IP/Name<br />
Left=0<br />
Right=51<br />
Top=30<br />
Bottom=38</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th April 2005, 21:00</div></div><div class="posttext">Did you declare the $server variable with Var server?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Fireye</div><div class="date">15th April 2005, 21:08</div></div><div class="posttext">Nope, and i noticed that later on.  I decided to go ahead and use $R0 as other people had suggested in another thread and a messagebox popup to make sure it's passing the data.  I still can't get it to pass the data properly...<br />
Here's what I have now:<br />
<br />
Function .onInit<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT_AS &quot;c:\wsus.ini&quot; &quot;wsus.ini&quot;<br />
FunctionEnd<br />
<br />
Page custom WSUSPage WSUSPageLeave<br />
<br />
Function WSUSPage<br />
!insertmacro MUI_HEADER_TEXT &quot;WSUS Server...&quot; &quot;whee&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;wsus.ini&quot;<br />
  ReadINIStr $R0 &quot;wsus.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
FunctionEnd<br />
<br />
Function WSUSPageLeave<br />
  MessageBox MB_OK $R0<br />
WriteRegStr HKEY_LOCAL_MACHINE &quot;SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot; &quot;WUServer&quot; &quot;http://$R0&quot;<br />
WriteRegStr HKEY_LOCAL_MACHINE &quot;SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate&quot; &quot;WUStatusServer&quot; &quot;http://$R0&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">16th April 2005, 21:03</div></div><div class="posttext">Seems like you'd want to read your InstallOptions ini file during the leave function instead of the show function. The MUI docs also state you can use MUI_INSTALLOPTIONS_READ from within a section (rather than a function).<br />
<br />
In my personal experience, I've found it better to read during the leave function becuase it allows me to verify what the user entered and call an ABORT command if necessary.  On the other hand, if the users makes his/her selection via a hard-coded choice--such as radio button or drop-down menu--then either method should work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th April 2005, 23:55</div></div><div class="posttext">Data on the InstallOptions page is only written to the INI file after you leave the page Show function. Therefore, your INI file will remain unchanged until the Leave function is reached.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vsleepy</div><div class="date">5th May 2005, 04:45</div></div><div class="posttext">Sorry for bumping this thread, but i had the same problem so i thought id post the solution.<br />
<br />
You need to init the plugins folder in the .oninit function.<br />
If you do this then you can use the MUI_INSTALLOPTIONS_READ macro within a function.<br />
<br />
 eg:<br />
Function .onInit<br />
  InitPluginsDir<br />
  File /oname=$PLUGINSDIR\dcsdraft.ini MYINI.ini<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;MYINI.ini&quot;<br />
FunctionEnd<br />
<br />
r,<br />
vsleepy</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>