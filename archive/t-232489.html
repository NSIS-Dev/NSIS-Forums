<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" error at install time, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  error at install time NSIS Discussion" />
	
	<title> error at install time [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  error at install time</div>
<hr />
<div class="pda"><a href="t-232489.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=232489">error at install time</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">HiranChaudhuri</div><div class="date">4th December 2005, 08:02</div></div><div class="posttext">Alright, I have a running installer.<br />
It is supposed to write some settings to a file. After installation the file exists but is empty (zero length).<br />
<br />
Now I'd like to know what went wrong. The error flag is set, but why? Is there some way to get an error number or message for further information (not just for the user, it's also me...)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">4th December 2005, 11:19</div></div><div class="posttext">You can use NSIS MessageBoxes to check file handle in write command is the same as was returned by file open command. File must have write permission. GetLastError() is available using System plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HiranChaudhuri</div><div class="date">4th December 2005, 11:35</div></div><div class="posttext">I thought to have opened the file with write access, and the handle should be the same. The hint to GetLastError is what I am after, but somehow I cannot find a header file containing GetLastError. Do I understand I have to define that myself? This is my first such attempt....<br />
<br />
My code looks like this:<br />
<br />
  CreateDirectory &quot;$INSTDIR\etc&quot;<br />
  CopyFiles $LICFILE $INSTDIR\etc<br />
  ClearErrors<br />
  FileOpen ยง0 $INSTDIR\etc\config.properties w<br />
  IfErrors showerror<br />
  FileWrite $0 &quot;home=$INSTDIR&quot;<br />
  FileWrite $0 &quot;license=$LICFILE&quot;<br />
  FileWrite $0 &quot;projects=$INSTDIR\Projects&quot;<br />
  ifErrors showerror<br />
  FileClose $0<br />
  ifErrors showerror<br />
  Goto continue<br />
showerror:<br />
    MessageBox MB_OK &quot;ERROR: &quot;<br />
<br />
continue:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">4th December 2005, 11:51</div></div><div class="posttext">My MSDN says GetLastError is in the kernel32.dll<br />
<br />
FileOpen ยง0 &quot;$INSTDIR\etc\config.properties&quot; w<br />
...<br />
FileWrite $0 &quot;home=$INSTDIR$\n&quot;<br />
System::Call 'kernel32.dll::GetLastError() i .r0'<br />
should return error code to $0. Use it after write command. Use quotas if NSIS var or expression may have blank spaces (or this is implemented in NSIS already? :) ).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HiranChaudhuri</div><div class="date">4th December 2005, 12:14</div></div><div class="posttext">Thank you for that sample. Reading the System plugin documentation I found out that I was wrongly using registers as temporary variables. Your hint checking the file handle told me I have to declare my own variable. Now that one works.<br />
<br />
Will try your suggestion to still show errors when they occur. Thank you very much.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>