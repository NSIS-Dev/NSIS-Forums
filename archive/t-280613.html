<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsisStartMenu Plugin : ensure your shortcuts order !, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsisStartMenu Plugin : ensure your shortcuts order ! NSIS Discussion" />
	
	<title> nsisStartMenu Plugin : ensure your shortcuts order ! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsisStartMenu Plugin : ensure your shortcuts order !</div>
<hr />
<div class="pda"><a href="t-280613.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=280613">nsisStartMenu Plugin : ensure your shortcuts order !</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">3rd November 2007, 03:31</div></div><div class="posttext">nsisStartMenu Plugin Homepage (http://wiz0u.free.fr/prog/nsisStartMenu)<br />
<br />
Presentation<br />
<br />
nsisStartMenu is a small NSIS plugin that that will help you ensure a given order of shortcuts in Start Menu<br />
<br />
You can typically use to ensure that the shortcut for your main program executable appears first and the shortcut for the uninstaller appears last, in the folder you're creating under Windows' Start Menu <br />
<br />
Usage<br />
The following is taken from the readme file in the downloadable zip file:<br />
<br />
<br />
nsisStartMenu::RegenerateFolder &quot;&lt;folder name&gt;&quot;<br />
<br />
&lt;folder name&gt; is the name of your folder under the $SMPROGRAMS folder<br />
	It should not contain the prefix $SMPROGRAMS\, but it can contain backslashes if<br />
you're working on a subfolder<br />
<br />
This will force an update of the state of the corresponding shell menu (just as if<br />
the user has displayed the menu)<br />
=&gt; All deleted entries (since the last state of the menu) will be pruned from the<br />
menu<br />
=&gt; All new entries (since the last state of the menu) will be added at the end of<br />
the menu in alphabetical order<br />
<br />
Return Value<br />
------------<br />
<br />
nsisStartMenu returns an integer status on the top of the stack<br />
Possible status are:<br />
	0:  Failure<br />
	1:  Success<br />
<br />
<br />
Download<br />
nsisStartMenu Plugin Homepage (http://wiz0u.free.fr/prog/nsisStartMenu)<br />
<br />
ZIP archive contains the plug-in DLL, as well as documentation, sample script and a LIB file for C++ programmers</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">15th November 2007, 20:35</div></div><div class="posttext">I wonder why my plugin doesn't have much success ?<br />
I spent so many hours trying to understand how Windows works things out regarding the start menu shortcuts.<br />
I was proud to have found a clean solution to a problem that seems so common to most installers..<br />
<br />
So please tell me :<br />
- don't you register start menu shortcuts in your installers ?<br />
- don't you care about the order of these shortcuts ? like it doesn't bother you having &quot;Uninstall&quot; appearing first sometimes ? (especially in language like French &quot;dÃ©sinstaller&quot; is likely to be often first)<br />
- or maybe you don't add the &quot;uninstall&quot; shortcut to the start menu and let the user go through &quot;add/remove program&quot; ?<br />
- does your installer registers several shortcuts in the Start Menu ? like help files or secondary programs ?<br />
<br />
For those who tried my plugin, don't hesitate to give me some feedback<br />
<br />
Thanks !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">1st May 2008, 23:32</div></div><div class="posttext">Just released version 1.1 which supports Unicode-NSIS<br />
through nsisStartMenu::RegenerateFolderW &quot;&lt;folder name&gt;&quot;<br />
<br />
http://wiz0u.free.fr/prog/nsisStartMenu/</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rixor</div><div class="date">13th June 2008, 22:28</div></div><div class="posttext">I am just about to try your plugin now.<br />
<br />
In the meantime I will say THANK YOU! I was getting so frustrated with my shortcuts showing up in what seemed like a totally random order. If this works, you are my hero!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rixor</div><div class="date">13th June 2008, 23:25</div></div><div class="posttext">Didn't seem to work. It always errors.<br />
<br />
Here is the code:<br />
<br />
<br />
CreateDirectory &quot;$SMPROGRAMS\$STARTMENU_FOLDER&quot;<br />
SetOutPath &quot;$INSTDIR\path&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\$STARTMENU_FOLDER\link.lnk&quot; &quot;$INSTDIR\path\file.exe&quot;<br />
nsisStartMenu::RegenerateFolder &quot;$STARTMENU_FOLDER&quot;<br />
Pop $0<br />
IntCmp $0 0 0 noError noError<br />
MessageBox MB_OK &quot;Foiled.&quot;<br />
noError:<br />
 <br />
<br />
Don't know if this would affect it, but currently (while testing) that link points to nothing. The file doesn't exist. Also, all the shortcut commands are wrapped by the MUI macros:<br />
<br />
!insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
!insertmacro MUI_STARTMENU_WRITE_END</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">16th June 2008, 09:45</div></div><div class="posttext">are you using Unicode-NSIS ?<br />
what does $STARTMENU_FOLDER contain ?<br />
are you using SetShellVarContext current or all ?<br />
does it fail if the shortcut points to an existing file ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rixor</div><div class="date">16th June 2008, 17:36</div></div><div class="posttext">Yes its Unicode-NSIS<br />
$STARTMENU_FOLDER contains a string defining the start menu folder name. In this case it was &quot;Product Version&quot;.<br />
I am doing nothing with SetShellVarContext.<br />
Haven't tried it with a valid link yet.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">16th June 2008, 17:44</div></div><div class="posttext">for Unicode-NSIS, you should use<br />
nsisStartMenu::RegenerateFolderW<br />
instead of<br />
nsisStartMenu::RegenerateFolder</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rixor</div><div class="date">16th June 2008, 18:26</div></div><div class="posttext">Works like a hot damn! Thank you, sir!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">16th June 2008, 18:56</div></div><div class="posttext">Originally posted by Wizou <br />
I wonder why my plugin doesn't have much success ?<br />
I spent so many hours trying to understand how Windows works things out regarding the start menu shortcuts.<br />
I was proud to have found a clean solution to a problem that seems so common to most installers.. <br />
<br />
i'm often annoyed by unsorted startmenus, so i wrote a script that just orders it on every startup. however, i wouldn't force a setting on a different user, just because i prefer it. i'm thinking of adding it, if it doesn't add to much size.. but only with a dialog, which asks for confirmation first. otherwise people might skip your product just because of that installer behaviour.<br />
<br />
just wanted to point this out, of course a lot of commands alone can do damage, it's all about the right combination of commands :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">17th June 2008, 00:23</div></div><div class="posttext">I just gave your plugin a try and it seems to work fine.<br />
Guess I'll keep it in my installer. Thanks!<br />
<br />
One question though:<br />
Which OS does it support? Will it work on Vista too?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">17th June 2008, 08:50</div></div><div class="posttext">@Yathosho: My plug-in only orders the start menu subdirectory of your choice (typically the one your installer is creating), not the whole start menu. And it can't place new shortcuts in front of existing ones.<br />
So it can only be useful for building up your application's submenu so that your shortcuts appears in a useful order.<br />
<br />
@LoRd_MuldeR: As noted in the ReadMe file, I've tested it under Windows XP but it should be compatible with Windows 2000, XP and more recent. However, on Vista, the new start menu doesn't allow the user (or an installer) to choose a customized order for shortcuts. So I can't do anything for it. In any case, you can still call the plug-in, it won't do any harm and gracefully return an error code if it didn't work.<br />
<br />
PS: I just realized that you could choose the old start menu behaviour in Vista, and it seems like nsisStartMenu doesn't work with it. I will check that out and release a compatible version of nsisStartMenu soon.<br />
<br />
Thanks for your feedback :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">17th June 2008, 15:11</div></div><div class="posttext">Originally posted by Wizou <br />
However, on Vista, the new start menu doesn't allow the user (or an installer) to choose a customized order for shortcuts. So I can't do anything for it. In any case, you can still call the plug-in, it won't do any harm and gracefully return an error code if it didn't work.<br />
<br />
Thx, that's what I needed to know!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zdenek_martinek</div><div class="date">18th July 2008, 15:06</div></div><div class="posttext">First, thanks a lot for this plugin, I could not find any documentation in MSDN about this matter, so I am happy I have found this plugin.<br />
<br />
Positioning one item as first or as last functions fine, but I want to have *all* menu items positioned in the order they were created. It is not much clear what the RegenerateFolder actually does, so I do not know whether calling it after each inserted item would bring the desired effect (I will test it anyway).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">18th July 2008, 17:04</div></div><div class="posttext">Originally posted by zdenek_martinek <br />
First, thanks a lot for this plugin, I could not find any documentation in MSDN about this matter, so I am happy I have found this plugin.<br />
<br />
Positioning one item as first or as last functions fine, but I want to have *all* menu items positioned in the order they were created. It is not much clear what the RegenerateFolder actually does, so I do not know whether calling it after each inserted item would bring the desired effect (I will test it anyway).  <br />
<br />
1. Delete the folder (if existing)<br />
2. Create a new folder<br />
3a. Create new Shortcut in that folder<br />
3b. Run &quot;RegenerateFolder&quot; on the folder<br />
3c. If more shortcuts then goto 3a, else skip<br />
4. You are done!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zdenek_martinek</div><div class="date">18th July 2008, 18:40</div></div><div class="posttext">Thanks, now it works much better! Anyway, I still have a partial problem: the shortcuts are now placed as I need, but when there are subdirectories (=submenus), they are still sorted alphabetically, even if after each directory creation I call RegenerateFolder for its parent.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">19th July 2008, 13:10</div></div><div class="posttext">Originally posted by zdenek_martinek <br />
Thanks, now it works much better! Anyway, I still have a partial problem: the shortcuts are now placed as I need, but when there are subdirectories (=submenus), they are still sorted alphabetically, even if after each directory creation I call RegenerateFolder for its parent.  <br />
<br />
Make sure you RegenerateFolder also *before* creating the *first* subfolder.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">21st July 2008, 08:33</div></div><div class="posttext">Thanks for helping people out, LoRd_MuldeR :)<br />
<br />
Just to let you know my findings: On Vista, the new start menu *does* in fact allow for a custom order if the user has uncheck the &quot;sort Programs menu by name&quot; in the Start menu Properties dialog.<br />
This is not a well-known option so I doubt many users have changed it (checked by default), but I'm working on having nsisStartMenu also function properly with it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zdenek_martinek</div><div class="date">21st July 2008, 10:13</div></div><div class="posttext">Originally posted by LoRd_MuldeR <br />
Make sure you RegenerateFolder also *before* creating the *first* subfolder.  <br />
<br />
Now it works, I also had a small bug in my code. Thanks again for this valuable plugin! :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">21st July 2008, 10:46</div></div><div class="posttext">Originally posted by zdenek_martinek <br />
Thanks again for this valuable plugin! :up:  <br />
You're welcome :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>