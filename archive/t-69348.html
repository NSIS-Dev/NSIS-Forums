<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SendMessage, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SendMessage NSIS Discussion" />
	
	<title> SendMessage [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SendMessage</div>
<hr />
<div class="pda"><a href="t-69348.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=69348">SendMessage</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">20th December 2001, 08:05</div></div><div class="posttext">dear all,<br />
<br />
I want to do the following:<br />
<br />
Matlab is some sort of command-prompt mathematics program and I want to install a plugin into this program. This can only be done by Matlab itself, so you should type the command and Enter and then it's installed.<br />
Is it possible to automate this using SendMessage? And if so, can anyone give me a link to a site where I can find more codes for possible messages the the matlabwindow, because I'm not experienced in c-programming...<br />
<br />
thx a lot all, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th December 2001, 19:43</div></div><div class="posttext">Did you try to use:<br />
X:\whatever\matlab\matlab.exe &lt; installplugin.txt<br />
<br />
when installplugin.txt is the commands you need to enter to matlab?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">21st December 2001, 08:54</div></div><div class="posttext">thx, i tried, but it didn't work...<br />
but maybe there are other possibilities for the command line, so thx for your idea, greetz,<br />
<br />
Hendri,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">21st December 2001, 12:59</div></div><div class="posttext">well, matlab does not support command-line arguments at startup, so if anyone knows a way how to use SendMessage for this problem, this would bevery helpfull.<br />
<br />
Thx, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st December 2001, 13:15</div></div><div class="posttext">Oops... If you DID read this message before I changed it, please ignore it. It was a mistake.<br />
<br />
And now that I think about it, you just can't do it with SendMessage. SendMessage only works on windows, and if you say that Matlab is command prompt program then you just can't do it. :( <br />
<br />
Here is a quote from MSDN:<br />
The SendMessage function sends the specified message to a window or windows. The function calls the window procedure for the specified window and does not return until the window procedure has processed the message. <br />
<br />
Sorry... :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">21st December 2001, 16:44</div></div><div class="posttext">kichik, thx for your reply...<br />
I realize that it's indeed not possible with SendMessage. I will take a look at the website of Matlab. Maybe they can give me a hint on how to interact with Matlab....<br />
<br />
Thx anyway, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">21st December 2001, 21:51</div></div><div class="posttext">Mmm, but a command prompt is just another window, so it should be possible.<br />
<br />
Try this..Name &quot;Test&quot;<br />
OutFile &quot;test.exe&quot;<br />
<br />
; Send a simple command to a Command Prompt window (works in Win2K)<br />
Section<br />
  FindWindow $R0 &quot;&quot; &quot;Command Prompt&quot;<br />
; or, more generic -<br />
; FindWindow $R0 &quot;ConsoleWindowClass&quot;<br />
  IntCmp $R0 0 NoWindow<br />
  MessageBox MB_ICONINFORMATION|MB_OK &quot;Window found ($R0)&quot;<br />
  Push $R0<br />
  Push &quot;dir$\r&quot;<br />
  Call SendChars<br />
  Return<br />
NoWindow:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;No window found!&quot;<br />
SectionEnd<br />
<br />
; SendChars:<br />
;   Send a stream of WM_CHAR messages to a window to simulate user input<br />
; Usage:<br />
;   Push &lt;window-handle&gt;<br />
;   Push &lt;message&gt;<br />
;   Call SendChars<br />
Function SendChars<br />
  Exch $R0 ; Get string<br />
  Exch<br />
  Exch $R1 ; Get hwnd<br />
  Push $R2<br />
  Push $R3<br />
  StrCpy $R2 0 ; Char index<br />
loop:<br />
  StrCpy $R3 $R0 1 $R2 ; Get next char<br />
  StrCmp $R3 &quot;&quot; done<br />
  Push $R3<br />
  Call CharToAscii ; Convert it to ASCII<br />
  Pop $R3<br />
  SendMessage $R1 258 $R3 0 ; Send a WM_CHAR message<br />
  IntOp $R2 $R2 + 1<br />
  Goto loop<br />
done:<br />
  Pop $R3<br />
  Pop $R2<br />
  Pop $R1<br />
  Pop $R0<br />
FunctionEnd<br />
<br />
; CharToAscii:<br />
;   Convert a character to it's ascii code<br />
; Usage:<br />
;   Push &lt;character&gt;<br />
;   Call CharToAscii<br />
;   Pop &lt;ascii-code&gt;<br />
;<br />
; Surely there must be a simpler way of doing this!<br />
; Am I missing something obvious??<br />
Function CharToAscii<br />
  Exch $R0 ; Get character<br />
  Push $R1<br />
  Push $R2<br />
  StrCpy $R1 255 ; ASCII code test counter<br />
loop:<br />
  IntFmt $R2 &quot;%c&quot; $R1 ; Convert current test counter to it's char<br />
  StrCmp $R2 $R0 done ; Have we found it yet? (note - not case sensitive)<br />
  IntOp $R1 $R1 - 1 ; Next code<br />
  IntCmp $R1 0 &quot;&quot; &quot;&quot; loop<br />
done:<br />
  Pop $R2<br />
  Exch<br />
  Pop $R0<br />
  Exch $R1<br />
FunctionEnd -- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st December 2001, 22:09</div></div><div class="posttext">I haven't though about it like this. Good work :cool:<br />
Will it work on full screened command prompts?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">21st December 2001, 22:29</div></div><div class="posttext">Just tried - yep, seems to :)<br />
<br />
Hopefully this Matlab app has a unique, consistent, window title (as ConsoleWindowClass on its own could find anything!)<br />
<br />
-- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">22nd December 2001, 06:44</div></div><div class="posttext">Dave,<br />
<br />
thx a lot for your reply, but it doesn't work yet... :(<br />
<br />
The problem is, that my program is compatible to two Matlab versions: 5 and 6. 5 only has a window called &quot;Matlab command window&quot; and the program should be able to find this window, but i couldn't test this because I do not have Matlab 5. Matlab 6 has a child (see the picture). The child has a name &quot;Command window&quot; and the test.nsi is not able to find this window. (it can find the main Matlab though...)<br />
<br />
Can you help me out here?<br />
<br />
thx, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">22nd December 2001, 07:09</div></div><div class="posttext">hi dave,<br />
<br />
I found out (at least I think), that Matlab is not really a command prompt program, but it only looks like that. This is because above functions work really well for the DOS-window, but cannot add anything to a Matlab window. Please, take a look at the picture i posted earlier, maybe this might give you a clue how to do this...<br />
<br />
Thx a lot, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">22nd December 2001, 13:31</div></div><div class="posttext">Ok, I see what you mean.<br />
<br />
Try this, if it doesn't work then maybe there's another window between the main window and the Command Window, but this has no name (that you can see) so you'd have to find out the window class name. To do that I use a tool which comes with Visual Studio, but I'm sure there must be freeware utilities that can do that too...Section<br />
  ; Look for Matlab 5 window<br />
  FindWindow $R0 &quot;&quot; &quot;Matlab command window&quot;<br />
  IntCmp $R0 0 &quot;&quot; FoundWindow FoundWindow<br />
  ; Look for Matlab 6 window (main window)<br />
  FindWindow $R0 &quot;&quot; &quot;MATLAB&quot;<br />
  IntCmp $R0 0 NoWindow<br />
  ; Now look for the command window (child window) inside it<br />
  FindWindow $R0 &quot;&quot; &quot;Command Window&quot; $R0<br />
  IntCmp $R0 0 NoWindow<br />
FoundWindow:<br />
  MessageBox MB_ICONINFORMATION|MB_OK &quot;Window found ($R0)&quot;<br />
  Push $R0<br />
  Push &quot;dir$\r&quot;<br />
  Call SendChars<br />
  Return<br />
NoWindow:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;No window found!&quot;<br />
SectionEnd Good luck!  And Happy Christmas to all... :) <br />
<br />
-- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">23rd December 2001, 00:42</div></div><div class="posttext">Dave,<br />
<br />
thx a lot for your reply and the code, but it's still not able to find the Matlab command window using Matlab 6. In Matlab 5 it finds the window, but does not add anything behind the command prompt...<br />
<br />
So I guess Matlab uses some strange unknown construction for it's windows...<br />
<br />
And I guess that I will have to think about another solution on how to do the thing i mentioned above. Or construct erverything in a completely other way...<br />
<br />
I also posted this thread at www.mathworks.com (Matlab web-site) but they didn't even give a response....<br />
<br />
So thx a lot all (especially Dave!!!), if you know another way of doing this, please let me know, thx, greetz,<br />
<br />
Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">24th December 2001, 11:43</div></div><div class="posttext">You might be interested in downloading AutoIt (http://www.hiddensoft.com/autoit/). It allows you to write small scripts that activate windows, send keystrokes, mouse clicks, all sorts of stuff, and it allows you to compile your scripts into small EXE files.<br />
<br />
My favourite utility before I discovered NSIS!<br />
<br />
Sure, it's not the most practical solution, but it's better than nothing.<br />
<br />
Feel free to PM me if you need help writing a script for it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">24th December 2001, 13:39</div></div><div class="posttext">Petersa,<br />
<br />
thx for your reply, I just downloaded the program and I will certainly try it.<br />
<br />
Have a nice christmas time, greetz,<br />
Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">25th December 2001, 23:44</div></div><div class="posttext">Petersa,<br />
<br />
I tried AutoIt, but I couldn't get it to work. Even the example program's (after translating the neccessary command's to Dutch :)) didn't work (eg: adding lines to notepad). I also tried to apply this to Matlab but did also not work unfortunately....<br />
<br />
I've given up, I think... :(<br />
<br />
Thx all anyway. I will be considering your inputs, maybe, I can get some of it to work later on.<br />
<br />
THX, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2001, 14:31</div></div><div class="posttext">Well, as I see it all you need to do is to discover Matlab command window class name. After you do that Dave's code will work.<br />
<br />
To discover the class name of the command window use Microsoft Spy++ (included with Visual C++) or Spy (included with Microsoft SDK). I am sure there is a freeware that displays this kind of information for all windows somewhere out there but I don't know it. Don't give up, search for it if you don't have Visual C++ or you don't want to download Microsoft SDK.<br />
<br />
KiCHiK</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">26th December 2001, 14:42</div></div><div class="posttext">kichik, thx for your idea!<br />
I'll start a search for Spy for I do not have C++<br />
<br />
If you know some page, please tell me...<br />
<br />
Thx a lot, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2001, 15:29</div></div><div class="posttext">I have found just the prog for you. It tells you the class name of the window you are pointing with the mouse. It doesn't shows all messages sent to all windows like Spy++ but it should do the trick.<br />
<br />
WinSpy (http://www.gena01.com/win32spy/)<br />
<br />
Enjoy! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">26th December 2001, 15:48</div></div><div class="posttext">Kichik,<br />
<br />
thx for this URL, it indeed is the program I was looking for. So I found out that Matlab 6 has a SunAwtFrame class window with Caption &quot;Matlab&quot;, my installer found the window (!!!) but it's not able to send some characters to it... (I use SendChars posted as a reply to my first thread)... Do you know what's missing now :( ???<br />
<br />
Thx, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">26th December 2001, 15:52</div></div><div class="posttext">Well I mean, (i hope this was clear...) that nothing happens to the window, no characters appear in the window, nothing is being executed...<br />
<br />
thx, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2001, 16:26</div></div><div class="posttext">Attached is Spy from Microsoft Platform SDK (it's a free download but a long one with all the other stuff).<br />
<br />
In the Spy menu click on Select window and select the window needed from Matlab. Then click Start!, type something in Matlab and notice what messages it gets.<br />
<br />
You should use the exact same messages in your NSIS script.<br />
<br />
If you get too many messages start filtering them with Options-&gt;Messages.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">26th December 2001, 17:26</div></div><div class="posttext">&quot;Cannot load HOOK.DLL&quot; is the message I get when clicking 'Start!'<br />
<br />
Can you also post this dll (and maybe other files the spy uses???)<br />
<br />
Thx a lot, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2001, 17:39</div></div><div class="posttext">Oops... :rolleyes: <br />
<br />
Well I have reupped it in the same reply (2 up) with hook.dll. I also checked that it doesn't need anything else but hook.dll.<br />
<br />
KiCHiK</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">26th December 2001, 22:16</div></div><div class="posttext">thx kichik,<br />
<br />
i already gave it a try using notepad but i got indeed a lot of messages from one window. I will try to sort this out using the options menu...<br />
<br />
Thanks a lot, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">29th December 2001, 19:56</div></div><div class="posttext">Hi Hendri,<br />
<br />
How's it going, working yet?<br />
<br />
If not, maybe what Matlab's after are messages to fool it into thinking it has keyboard focus...<br />
Function SendChars<br />
  Exch $R0 ; Get string<br />
  Exch<br />
  Exch $R1 ; Get hwnd<br />
  Push $R2<br />
  Push $R3<br />
  SendMessage $R1 ${WM_SETFOCUS} 0 0<br />
  StrCpy $R2 0 ; Char index<br />
loop:<br />
  StrCpy $R3 $R0 1 $R2 ; Get next char<br />
  StrCmp $R3 &quot;&quot; done<br />
  Push $R3<br />
  Call CharToAscii ; Convert it to ASCII<br />
  Pop $R3<br />
  SendMessage $R1 ${WM_CHAR} $R3 0<br />
  IntOp $R2 $R2 + 1<br />
  Goto loop<br />
done:<br />
  SendMessage $R1 ${WM_KILLFOCUS} 0 0<br />
  Pop $R3<br />
  Pop $R2<br />
  Pop $R1<br />
  Pop $R0<br />
FunctionEndbtw, see KiCHik's Windows Messages thread (http://forums.winamp.com/showthread.php?s=&amp;threadid=70118) for the header file for the !defines used. Very handy!<br />
<br />
Other than that, I'm not sure what else to suggest :(  Maybe experiment with other windows messages, described at MSDN (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/winui/keybinpt_4iib.asp?frame=true).<br />
<br />
Good luck!<br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">29th December 2001, 20:15</div></div><div class="posttext">Hi Dave,<br />
<br />
thx i'll try. I indeed downloaded Kichik's package. I also used some spy to determine what messages to send to Matlab. But I do not understand this output. I press for example 'd' and one time the spy tells me that this is in fact produced by the messages key_down, char and key_up and another time it's produced by char, char and key_up...<br />
<br />
So I can't figure out what to send...<br />
<br />
But I tried to send 'dir\n' using SendChar and using the first construction (key_down, char, key_up) for each character and Matlab interpreted these messages as:<br />
49[Enter]<br />
<br />
So, again really stuck. Is this a strange thing of Matlab, you think, or am I just doing the wrong thing????<br />
<br />
Thx in advance, i didn't try above yet, i'll do it right away, thx,<br />
<br />
greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th December 2001, 20:35</div></div><div class="posttext">From MSDN:<br />
<br />
The WM_CHAR message is posted to the window with the keyboard focus when a WM_KEYDOWN message is translated by the TranslateMessage function. WM_CHAR contains the character code of the key that was pressed. <br />
<br />
Correct me if I am wrong but this means that you don't need to send WM_KEYDOWN and WM_KEYUP. All that it does is to send to the window WM_CHAR so you can skip it and just send WM_CHAR.<br />
<br />
And if you already got it to send 49[Enter] keep trying, you are on the right track :up:.<br />
<br />
KiCHiK<br />
<br />
PS<br />
I am glad you like my header file :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">30th December 2001, 18:09</div></div><div class="posttext">Kichik,<br />
<br />
I think i should use Key_down and up...<br />
I first tried without, but that resulted in just no response from Matlab, so i think i should use it...<br />
<br />
Indeed i'm on the right track, i hope, so i'll keep trying, maybe someone has another idea what's going on with Matlab, because in a simple Dos-Window, there is no problem with just sending WM_CHAR...<br />
<br />
Thx, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">30th December 2001, 18:12</div></div><div class="posttext">Bye the way, trying to send 'dir\n' resulted in '49[Enter]' so on the right track... I don't know. There seems to be something wrong...<br />
<br />
Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">futuris</div><div class="date">30th December 2001, 20:54</div></div><div class="posttext">&gt; Matlab 6 has a SunAwtFrame class window with Caption &quot;Matlab&quot;<br />
<br />
&quot;SunAwtFrame&quot; means that MatLab written in Java! It means, that it will not (most likely) react to Windows messages.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st December 2001, 12:08</div></div><div class="posttext">Smile2Me, have you tried sending the lParam and wParam as shown on Spy?<br />
<br />
And does [Enter] means a line break or does it actually show [Enter]?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">1st January 2002, 21:07</div></div><div class="posttext">Kichik,<br />
<br />
[Enter] means a line break indeed, but also that the command entered will be executed. In Matlab 49[Enter] means that it will assign the value 49 to the variable 'ans'...<br />
<br />
But I think I replicated the messages given by Spy completely, but I'll check on this again, thx...<br />
<br />
Happy NewYear to you all!!!<br />
<br />
Greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st January 2002, 21:33</div></div><div class="posttext">I still think you are on the right track.<br />
<br />
As you can see by the &quot;table&quot; below the values you sent with WM_KEYUP/DOWN/CHAR were just shifted some to the digits zone. The difference between d and i is the same as 4 and 9. All we are missing now is the r :)<br />
<br />
<br />
4 5678 9<br />
d efgh i<br />
<br />
<br />
Did you try to use spy to see what messages are being sent from the installer and then compare them to the messages you sent manually?<br />
<br />
KiCHiK</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">2nd January 2002, 13:35</div></div><div class="posttext">Kichik,<br />
<br />
bright point!!!<br />
I'll check the function CharToAscii as it seems that there is something wrong there...<br />
<br />
Yeah, i spied the messages from installler to Matlab and everything looked ok to me... (just the messages i send where reported, nothing strange...)<br />
<br />
But i also discovered some functions in Matlab to do the job i posted this thread for (in the end, I wanted to protect my M-files (just textfiles with commands) from being viewed or changed). Matlab offers a service for that. So finding some dll's of Matlab give me the opportunity to code my files...<br />
<br />
So the goal is achieved!!!<br />
<br />
But i'll keep trying to get the messages to work because i think i'll need it later on for other installer features...<br />
<br />
So at this point thx all for the helping replies!!!<br />
<br />
Kichik, i'll work on it, and i'll post my result here!!!<br />
<br />
THX ALL, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">14th January 2002, 17:07</div></div><div class="posttext">Some old topic information:<br />
<br />
I gave up, but did the thing in another way, as you might have read...<br />
<br />
But I've got a new question on SendMessage.<br />
<br />
Please help me at:<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=71924<br />
<br />
Thx all, greetz, Hendri.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>