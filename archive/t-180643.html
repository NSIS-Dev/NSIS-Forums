<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need Help on Buttons in custom pages, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need Help on Buttons in custom pages NSIS Discussion" />
	
	<title> Need Help on Buttons in custom pages [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need Help on Buttons in custom pages</div>
<hr />
<div class="pda"><a href="t-180643.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=180643">Need Help on Buttons in custom pages</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">20th May 2004, 18:23</div></div><div class="posttext">Hi all,<br />
<br />
I am as new as you can get to NSIS, so excuse my ignorance.<br />
<br />
I have created a custom page with a button.  I want to call a function when that button is clicked. The function, in turn, will run some commands based on selections made on  the custom page.<br />
<br />
What works:<br />
1. got a page with 2 radio buttons, text field and Add button<br />
2. i read the values of the fields in my custom page function<br />
<br />
Need help:<br />
1. how to call a function from my button, yet remain on the same page<br />
2. the function being called needs to use values read in the custom page function<br />
<br />
Is this possible? and if yes, how would I do it?<br />
<br />
Any help is GREATLY appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th May 2004, 18:38</div></div><div class="posttext">Use Abort to stay on the current page.<br />
<br />
You can store values in variables or on the stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">20th May 2004, 19:50</div></div><div class="posttext">Thanks for a quick response....<br />
<br />
But how do I call a function from my button?<br />
<br />
I have searched the forum and the docs, all I could find was that I can put a command that can be executed with Exec in the state of the button, and clicking the button will Exec that code.<br />
<br />
What I need is to click the button and call a method in my script.<br />
<br />
Thanks again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th May 2004, 19:52</div></div><div class="posttext">See the InstallOptions documentation and examples about the NOTIFY flag.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">20th May 2004, 19:53</div></div><div class="posttext">Let me check that out....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">20th May 2004, 21:58</div></div><div class="posttext">Great !!!! Thanks, it works, BUT I am encountering another issue: can't get out of the window even if I click close.  Here is my code:<br />
<br />
Page custom AddUserPage test<br />
.<br />
.<br />
Function AddUserPage ;FunctionName defined with Page command<br />
   !insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;sshUser.ini&quot;<br />
<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $domain_radio &quot;sshUser.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $local_radio &quot;sshUser.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $user_text &quot;sshUser.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
<br />
FunctionEnd<br />
<br />
<br />
Function test<br />
   MessageBox MB_OK &quot;add clicked&quot;<br />
   Abort<br />
FunctionEnd<br />
<br />
I know there has to be a way to close this, my guess would be an error/completion code in the stack?!?! But how would I get it, what do I compare it too? Just need close button to close without calling test again.<br />
<br />
Can't thank enough the people responding...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th May 2004, 22:29</div></div><div class="posttext">You should read the status from the INI file, see docs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">20th May 2004, 22:39</div></div><div class="posttext">I appologize if it sounds like I don't want to do searching myself, its definetly not the case.  I just can not find it in docs or the forum post related to my question.  <br />
<br />
Dear Joost, after reading the forum for about 5 continous hours I see that your contribution to both the forum and development is quite large.  <br />
<br />
I would greatly appreciate a pointer to an example or maybe the section in the docs (a link) to solve my problem<br />
<br />
Again, thanks for taking the time to answer my questions</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">21st May 2004, 03:11</div></div><div class="posttext">If you put only the Abort command inside a leave_function, you won't ever close the program by normal ways. You have to give it some conditions to don't execute the Abort command. You can use StrCmp for comparing strings.<br />
<br />
Ok, this is the first step, now you have to have a string to compare with. This can be:<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;sshUser.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
<br />
Where the result will be a control number if you selected one, or an empty string if not.<br />
<br />
The result code will be as this below:<br />
<br />
Function test<br />
<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;sshUser.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
  StrCmp $0 2 +3<br />
  StrCmp $0 3 +2<br />
  StrCmp $0 4 0 +2<br />
    Abort<br />
<br />
FunctionEnd<br />
<br />
Try it and say if it worked.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">24th May 2004, 17:57</div></div><div class="posttext">Hi all,<br />
<br />
1. Thanks a whole lot for the response. REALLY REALLY appreciate it.<br />
2. What you are suggesting is very clear to me.  Here is my problem:<br />
I have 3 buttons on the screen, Cancel, Close, Add User (custom page button). Cancel works fine, does what is expected. Add User also behaves normally.  Close calls the same method as Add User (I am using notify flag), but in the method I would like to be able to know that the method was called as a result of Close button being clicked not Add User. Is there a way to do that?<br />
<br />
So I still have a problem.....<br />
<br />
Thanks for your responses.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">24th May 2004, 22:16</div></div><div class="posttext">Instead of using !insertmacro MUI_INSTALLOPTIONS_DISPLAY you can use !insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN and pop the return value. The value can be one of these:<br />
<br />
success - The user has pressed the Next button <br />
<br />
back - The user has pressed the Back button <br />
<br />
cancel - The user has pressed the Cancel button <br />
<br />
error - An error has occurred, the dialog cannot be displayed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">24th May 2004, 22:29</div></div><div class="posttext">Thanks for the info, I have tried it with interesting results...still does not work. <br />
<br />
How can I attach my file? I appologize in advance for pasting the code...<br />
<br />
Please take a look, maybe I am doing something exceptionally stupid.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">24th May 2004, 22:48</div></div><div class="posttext"># NOTE: this .NSI script is designed for NSIS v1.8+<br />
!define ALL_USERS<br />
!include MUI.nsh<br />
<br />
Name &quot;SSH Users&quot;<br />
OutFile &quot;configureUsers.exe&quot;<br />
<br />
<br />
InstallDir &quot;C:\CP_WORK\TEST_AREA\test&quot;<br />
<br />
LangString TEXT_IO_TITLE ${LANG_ENGLISH} &quot;SSH User configuration&quot;<br />
LangString TEXT_IO_SUBTITLE ${LANG_ENGLISH} &quot;Configure users&quot;<br />
<br />
BrandingText /TRIMRIGHT &quot;SSH User Configurator&quot;<br />
<br />
Page custom AddUserPage addUser<br />
<br />
# declare variables<br />
Var domain_radio<br />
Var local_radio<br />
Var user_text<br />
var path_to_ssh<br />
var clean_path<br />
<br />
# begin install settings/section<br />
Section &quot;install&quot; # (default section)<br />
SetOutPath &quot;$INSTDIR&quot;<br />
<br />
# write out uninstaller<br />
WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
SectionEnd ; end of default section<br />
<br />
<br />
# begin uninstall settings/section<br />
UninstallText &quot;This will uninstall SiteAlive from your system&quot;<br />
<br />
Section Uninstall<br />
#Set the context to all users<br />
SetShellVarContext all<br />
<br />
SectionEnd # end of uninstall section<br />
<br />
# FUNCTIONS<br />
Function .onInit<br />
  Call findOpenSSHInstallDir<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;sshUser.ini&quot;<br />
FunctionEnd<br />
<br />
Function AddUserPage ;FunctionName defined with Page command<br />
   <br />
   !insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_DISPLAY_RETURN &quot;sshUser.ini&quot;<br />
<br />
FunctionEnd<br />
.<br />
.<br />
.<br />
Function addUser ;FunctionName defined with Page command<br />
   Pop $R1<br />
   StrCmp $R1 cancel c1<br />
   StrCmp $R1 success c2<br />
   goto process<br />
   <br />
   c1:<br />
   MessageBox MB_OK &quot;Canceled&quot;<br />
   goto done<br />
   <br />
   c2:<br />
   MessageBox MB_OK &quot;Closed&quot;<br />
   goto done<br />
<br />
   process:<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $domain_radio &quot;sshUser.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $local_radio &quot;sshUser.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $user_text &quot;sshUser.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
   <br />
    StrCmp $domain_radio &quot;1&quot; domainuser localuser<br />
<br />
    domainuser:<br />
    StrLen $4 $user_text<br />
    StrCmp $4 &quot;0&quot; samePage<br />
    Exec '&quot;$clean_path\bin\configDomainUser.bat&quot; $path_to_ssh $user_text'<br />
    MessageBox MB_OK &quot;User Added $clean_path\bin\configDomainUser.bat $\r$\n $path_to_ssh $\r$\n $user_text&quot;<br />
    goto samePage<br />
<br />
    localuser:<br />
    StrLen $4 $user_text<br />
    StrCmp $4 &quot;0&quot; samePage<br />
    Exec '&quot;$clean_path\bin\configLocalUser.bat&quot; $path_to_ssh $user_text'<br />
    MessageBox MB_OK &quot;User Added $clean_path\bin\configLocalUser.bat $\r$\n $path_to_ssh $\r$\n $user_text&quot;<br />
    goto samePage<br />
    <br />
    samePage:<br />
    Abort<br />
    <br />
    done:<br />
FunctionEnd<br />
<br />
# eof</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">25th May 2004, 00:16</div></div><div class="posttext">Ahh, so &quot;Close&quot; button is the &quot;Next&quot; button...<br />
<br />
Replace (Field number of &quot;Add User&quot; button) as it says.<br />
<br />
c2:<br />
MessageBox MB_OK &quot;Closed&quot;<br />
goto done<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;sshUser.ini&quot; &quot;Settings&quot; &quot;State&quot;<br />
<br />
StrCmp $0 '(Field number of &quot;Add User&quot; button)' 0 EndAddUser<br />
<br />
  MessageBox MB_OK '&quot;Add User&quot; button executed!'<br />
<br />
EndAddUser:<br />
<br />
process:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gugo46</div><div class="date">25th May 2004, 01:02</div></div><div class="posttext">TADA!!!!<br />
<br />
Cannot thank you enough!!!!<br />
<br />
Worked like a charm. Thanks again deguix and everybody.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>