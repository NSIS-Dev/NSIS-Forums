<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsdialogs +  Trackbar control [NSD_OnNotify problem], media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsdialogs +  Trackbar control [NSD_OnNotify problem] NSIS Discussion" />
	
	<title> nsdialogs +  Trackbar control [NSD_OnNotify problem] [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsdialogs +  Trackbar control [NSD_OnNotify problem]</div>
<hr />
<div class="pda"><a href="t-324072.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=324072">nsdialogs +  Trackbar control [NSD_OnNotify problem]</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Pawel</div><div class="date">15th November 2010, 17:41</div></div><div class="posttext">I would like to ask about TrackBar control support in NSIS.<br />
I need to use a trackbar in my nsdialogs based custom page.<br />
I have few problems with it...<br />
<br />
Here is how I create the control:<br />
<br />
	!define TBM_SETPOS 0x0405<br />
	!define TBM_GETPOS 0x0400<br />
	!define TBM_SETRANGEMIN 0x0407<br />
	!define TBM_SETRANGEMAX 0x0408	<br />
	<br />
; Slider	<br />
	nsDialogs::CreateControl &quot;msctls_trackbar32&quot; &quot;0x50010000|0x00000018&quot; &quot;&quot; 15u 76u 100 20 &quot;&quot;<br />
    Pop $Slider1<br />
	SendMessage $Slider1 ${TBM_SETRANGEMIN} 1 1   ; Setting Min range (1)<br />
	SendMessage $Slider1 ${TBM_SETRANGEMAX} 1 8	  ; Setting Max range (8)<br />
	${NSD_OnNotify} $Slider1 onNotify_Slider1	  ; Using OnNotify<br />
	<br />
First problem. ${NSD_OnClick} or ${NSD_OnChange$} doeasnt work. Is it possible to make it work?<br />
I want to do some action, when user move the slider.<br />
I am using ${NSD_OnNotify} instead. This works, but there are some problems... <br />
Take a look at  this function:<br />
<br />
Function onNotify_Slider1<br />
<br />
	SendMessage $Slider1 ${TBM_GETPOS} 0 0 $1 ; Get Trackbar position<br />
	<br />
	${Select} $1<br />
		${Case} &quot;1&quot;<br />
			; Do something 1 (I am displaying here an image 1)<br />
		${Case} &quot;2&quot;<br />
			; Do something 2 (I am displaying here an image 2)<br />
		${Case} &quot;n&quot;<br />
			; Do something n (I am displaying here an image n)<br />
	${EndSelect}<br />
	<br />
	System::Call &quot;gdi32:DeleteObject(i $Image_Var)&quot; ; Here I am freeing used resource for Images<br />
	<br />
FunctionEnd<br />
<br />
The big problem is, that if I move slider of trackbar (few times, from position 1 to 8), installer uses more and more memory.<br />
Even if function &quot;onNotify_Slider1&quot; has no code (is empty), there are some memory leaks or something.<br />
Why? What is the way to use correctly ${NSD_OnNotify}?<br />
<br />
OnNotify<br />
<br />
nsDialogs::OnNotify control_HWND function_address<br />
<br />
Sets a notification callback function for the given control. Whenever the control receives the WM_NOTIFY message, the function will be called and the control's HWND, notification code and a pointer to the MNHDR structure will be waiting on its stack.<br />
<br />
Use GetFunctionAddress to get the address of the desired callback function.<br />
<br />
Maybe memory problems is result of this MNHDR structure on stack? Maybe I should free this? (how?)<br />
How can I just use OnChange for Trackbar?<br />
<br />
Somebody has an idea, example? <br />
Thanks<br />
-Pawel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th November 2010, 19:28</div></div><div class="posttext">http://msdn.microsoft.com/en-us/library/bb760172%28v=VS.85%29.aspx<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pawel</div><div class="date">15th November 2010, 20:20</div></div><div class="posttext">Stu,<br />
Thanks for tip.<br />
Could you explain it with some code example?<br />
I am afraid I don't know how to use this...<br />
And, if it is used right, is it gonna fix memory problems?<br />
<br />
<br />
Ps: Stu, I send you private message few days ago. Can you alos take a look at this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">15th November 2010, 20:22</div></div><div class="posttext">A function that handles the WM_NOTIFY callback cannot be empty, that is why you get leaks. It HAS to pop the 3? parameters off the stack each time it is called.<br />
<br />
<br />
http://msdn.microsoft.com/en-us/library/bb760172%28v=VS.85%29.aspx<br />
<br />
<br />
MSDN claims that message is Vista only, so I don't know why you are linking to it</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th November 2010, 20:34</div></div><div class="posttext">Ah sorry my bad. See this instead: http://msdn.microsoft.com/en-us/library/bb760149%28VS.85%29.aspx (the Trackbar Notification Messages section). Unfortunately nsDialogs doesn't appear to handle WM_HSCROLL or WM_VSCROLL. You would probably need to modify the plugin (nsDialogs.c:79) to handle those messages and call onChange (or something).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Pawel</div><div class="date">15th November 2010, 20:39</div></div><div class="posttext">@Anders<br />
Pop $0<br />
Pop $1<br />
Pop $2<br />
<br />
This do the job. no more memory leaks. Thx.<br />
<br />
@Stu<br />
Sounds very clever, but I dont know how to use it :P<br />
I need something in Notify callback, that:<br />
If message = &quot;???&quot; then do some action<br />
<br />
-Pawel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th November 2010, 21:00</div></div><div class="posttext">That's the first link I posted but as Anders rightly points out is only available on Vista and above.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>