<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Totally disabling a Section when installed., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Totally disabling a Section when installed. NSIS Discussion" />
	
	<title> Totally disabling a Section when installed. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Totally disabling a Section when installed.</div>
<hr />
<div class="pda"><a href="t-244571.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244571">Totally disabling a Section when installed.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">25th April 2006, 12:54</div></div><div class="posttext">I have an installer where the user can choose among several Sections, arranged in Groups.<br />
<br />
All Sections and Groups are optional by default (unchecked).<br />
<br />
Now, the thing is that with my installer, if the user chooses not to install a couple of the options and/or Groups the first time, he/she can re-open the installer later and add those features.<br />
<br />
When the user re-opens the installer, I have made it so that the Sections and Groups that the user installed, are not visible on the Components page anymore. So the user can then only choose among the visible Sections/Groups, in other words the ones that weren't installed last time.<br />
<br />
I have done this by using UnSelectSecion and SecionSetText [Section] &quot;&quot;.<br />
<br />
However - from practical tests:<br />
<br />
-If the user has installed let's say all but one component from a Group, and he/she then later re-opens the installer, and uses the Group's main checkbox to select the remaining option within the Group, then NSIS runs even the Sections that are invisible. <br />
<br />
If the user checks only the checkbox of the remaining Section within the Group (and don't use the Group's main checkbox), then it works, and only that last, visible Section is run.<br />
<br />
Here's how my &quot;Group/Section disabling and invisible making&quot; code looks (there's one for each Group):<br />
        <br />
-I first put in the wrong code...<br />
<br />
<br />
	ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;21&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${Sec21}<br />
		SectionSetText ${Sec21} &quot;&quot;<br />
	${endif}<br />
<br />
	ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;22&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${Sec22}<br />
		SectionSetText ${Sec22} &quot;&quot;<br />
	${endif}<br />
<br />
	ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;23&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${Sec23}<br />
		SectionSetText ${Sec23} &quot;&quot;<br />
	${endif}<br />
<br />
	ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;24&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${Sec24}<br />
		SectionSetText ${Sec24} &quot;&quot;<br />
	${endif}<br />
<br />
	ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;25&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${Sec25}<br />
		SectionSetText ${Sec25} &quot;&quot;<br />
	${endif}<br />
<br />
        ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;21&quot;<br />
	${if} $0 == 1<br />
        ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;22&quot;<br />
	${if} $0 == 1<br />
        ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;23&quot;<br />
	${if} $0 == 1<br />
        ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;24&quot;<br />
	${if} $0 == 1<br />
        ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;25&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${SubSecMisc}<br />
		SectionSetText ${SubSecMisc} &quot;&quot;<br />
	${endif}<br />
	${endif}<br />
	${endif}<br />
	${endif}<br />
	${endif}<br />
<br />
<br />
(the meaning of the code above is that if the individual Section is installed, then it will be invisible in the installer, and if all the Sections within the Group are installed, then the entire Section Group will be invisible)<br />
<br />
<br />
The reason I know that the invisible Components are run when you check their Group's main checkbox, is that stuff happens during install that isn't supposed to happen, when you check that main checkbox (because what happens is part of the invisible Components), and it doesn't happen if you check only the remaining Component's own checkbox instead.<br />
<br />
<br />
How can I make sure that the invisible Sections/Components within a Group are not run when the user checks the main checkbox of the Group?<br />
<br />
Is there such a thing as DisableSection or similar?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">27th April 2006, 10:54</div></div><div class="posttext">You need to make the section read only. This way user can't change the status.<br />
<br />
	ReadRegStr $0 HKLM &quot;Software\${PRODUCT_NAME}\InstallSections&quot; &quot;21&quot;<br />
	${if} $0 == 1<br />
		!insertmacro SetSectionFlag ${Sec21} ${SF_RO}<br />
		!insertmacro UnselectSection ${Sec21}<br />
		SectionSetText ${Sec21} &quot;&quot;<br />
	${endif}<br />
...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>