<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Modify InstallDir within a Section/Function, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Modify InstallDir within a Section/Function NSIS Discussion" />
	
	<title> Modify InstallDir within a Section/Function [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Modify InstallDir within a Section/Function</div>
<hr />
<div class="pda"><a href="t-295205.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=295205">Modify InstallDir within a Section/Function</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bubustoober</div><div class="date">28th July 2008, 22:04</div></div><div class="posttext">Note: I am new to NSIS and still getting used to the scripting language. <br />
<br />
Goal: I want to allow the user of my installer to enter the name of their project (e.g. &quot;ProjectX&quot;) on a custom page (I have successfully implemented this) and then append that to a default InstallDir (e.g. &quot;C:\Program Files\Company Name\Product Title\ProjectX&quot;). <br />
<br />
Problem: I can't figure out how to modify the InstallDir from within a Section or Function. Thanks in advance for any assistance!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">29th July 2008, 18:53</div></div><div class="posttext">Just use StrCpy to modify the $INSTDIR variable before showing the directory page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KrisAster</div><div class="date">29th July 2008, 19:43</div></div><div class="posttext">Right, though in practice if I were you I'd generally try to stay away from doing that.  Something less prone to error might be something along the lines of:<br />
<br />
Var PROJECTDIR ; PROJECTDIR is set in your custom page<br />
<br />
Section &quot;Make Custom Project X&quot;<br />
SetOutPath &quot;$INSTDIR\$PROJECTDIR&quot;<br />
File &quot;Blah&quot;<br />
SectionEnd<br />
<br />
(Just my thoughts anyway.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bubustoober</div><div class="date">29th July 2008, 22:40</div></div><div class="posttext">Thanks for the help guys. I used a combination of your suggestions. I used StrCpy to set $INSTDIR with the default install directory plus the user-defined project name. See working code below!<br />
<br />
;This function drives the custom page where the user enters the name of their project<br />
Function enterProjectNamePage<br />
<br />
	nsDialogs::Create /NOUNLOAD 1018<br />
	Pop $Dialog<br />
<br />
	;Simple error handling<br />
	${If} $Dialog == error<br />
		Abort<br />
	${EndIf}<br />
<br />
	;Label above the project name text field<br />
	${NSD_CreateLabel} 0 0 100% 12u &quot;Please enter the project name below:&quot;<br />
	Pop $Label<br />
	<br />
	;If the user has previously entered a project name, it was stored and will be recalled if they return to this page<br />
	;If Project_name is empty, the user has not previously entered a project name and so the field should be blank<br />
	${If} $Project_name == &quot;&quot;<br />
		; Disable next button until the user enters text<br />
		GetDlgItem $0 $HWNDPARENT 1<br />
		EnableWindow $0 0<br />
		<br />
		;Create the text field<br />
		${NSD_CreateText} 0 13u 100% 12u &quot;&quot;<br />
		Pop $Text<br />
		${NSD_OnChange} $Text enableNextButton<br />
	${Else}	<br />
		;Create the text field, prepopulated with user's previously entered text<br />
		${NSD_CreateText} 0 13u 100% 12u &quot;$Project_name&quot;<br />
		Pop $Text<br />
		${NSD_OnChange} $Text enableNextButton<br />
	${EndIf}<br />
<br />
	nsDialogs::Show<br />
<br />
FunctionEnd<br />
<br />
;This function is called in the previous function, enables the &quot;next&quot; button on the custom page only after the user has entered text in the project name field<br />
Function enableNextButton<br />
	<br />
	; Enable next button since the user has entered text<br />
	GetDlgItem $0 $HWNDPARENT 1<br />
	EnableWindow $0 1<br />
<br />
FunctionEnd<br />
<br />
;This function is executed upon leaving the custom page <br />
Function enterProjectNamePageLeave<br />
<br />
	;Stores the text the user entered for project name<br />
	${NSD_GetText} $Text $Project_name <br />
	<br />
	;Sets the default install directory to C:\Program Files\&lt;product name&gt;\&lt;user-defined project name&gt;<br />
	;StrCpy $INSTDIR &quot;$PROGRAMFILES\${prodname}\$Project_name&quot;<br />
<br />
FunctionEnd<br />
<br />
;Sets the default installation directory<br />
InstallDir $INSTDIR</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>