<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Refresh Layer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Refresh Layer NSIS Discussion" />
	
	<title> Refresh Layer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Refresh Layer</div>
<hr />
<div class="pda"><a href="t-363282.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=363282">Refresh Layer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nashtor</div><div class="date">8th June 2013, 20:57</div></div><div class="posttext">Hello,<br />
<br />
I am trying to display a message on a nsis 2.46.5-Unicode MUI2 page while calling a function.<br />
Thing is, the text will only be displayed after the function closes.<br />
The only way I found to avoid this was to include a MessageBox.<br />
<br />
Is there a way to 'refresh' the page/layer without using a MultiProcess plugin or a MessageBox?<br />
<br />
<br />
Example:<br />
!include &quot;MUI2.nsh&quot;<br />
!include &quot;nsDialogs.nsh&quot;<br />
<br />
!define PRODUCTNAME &quot;RefreshLayer&quot;<br />
Name &quot;${PRODUCTNAME}&quot;<br />
OutFile &quot;${PRODUCTNAME}.exe&quot;<br />
<br />
RequestExecutionLevel user<br />
<br />
!define BLACK &quot;0x000000&quot;<br />
!define RED &quot;0xFF0000&quot;<br />
!define GREEN &quot;0x009900&quot;<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
;------------------------<br />
!macro _ConsoleWindowRefresh CONTROL STRING COLOR COLORBACK<br />
	<br />
	ShowWindow ${CONTROL} ${SW_HIDE}<br />
	SetCtlColors ${CONTROL} &quot;${COLOR}&quot; &quot;${COLORBACK}&quot;<br />
	${NSD_SetText} ${CONTROL} &quot;${STRING}&quot;<br />
	ShowWindow ${CONTROL} ${SW_SHOW}<br />
	<br />
!macroend<br />
<br />
!define ConsoleWindowRefresh &quot;!insertmacro _ConsoleWindowRefresh&quot;<br />
;------------------------<br />
<br />
Page custom nsDialogsMainPage<br />
<br />
<br />
Section &quot;&quot;<br />
SectionEnd<br />
<br />
Function nsDialogsMainPage<br />
	<br />
	!insertmacro MUI_HEADER_TEXT $(PAGEMAIN_TITLE) $(PAGEMAIN_SUBTITLE)<br />
	<br />
	nsDialogs::Create 1018<br />
	Pop $0<br />
<br />
	${If} $0 == error<br />
		Abort<br />
	${EndIf}<br />
	<br />
	<br />
	${NSD_CreateLabel} 0 90% 100% 10u &quot;&quot;<br />
	Pop $R0<br />
	<br />
	${NSD_CreateButton} 20% 30% 20% 40u &quot;TestWithoutMSGB&quot;<br />
	Pop $R1<br />
	${NSD_OnClick} $R1 TestWithoutMSGB<br />
	<br />
	${NSD_CreateButton} 60% 30% 20% 40u &quot;TestWithMSGB&quot;<br />
	Pop $R2<br />
	${NSD_OnClick} $R2 TestWithMSGB<br />
	<br />
	<br />
	nsDialogs::Show<br />
	<br />
FunctionEnd<br />
<br />
Function TestWithoutMSGB<br />
	<br />
	${ConsoleWindowRefresh} $R0 &quot; never to be seen... &quot; &quot;${RED}&quot; &quot;${BLACK}&quot;<br />
	Sleep 1000<br />
	${ConsoleWindowRefresh} $R0 &quot; Ever to be seen... &quot; &quot;${GREEN}&quot; &quot;transparent&quot;<br />
	<br />
FunctionEnd<br />
<br />
Function TestWithMSGB<br />
	<br />
	${ConsoleWindowRefresh} $R0 &quot; never to be seen... &quot; &quot;${RED}&quot; &quot;${BLACK}&quot;<br />
	MessageBox MB_OK &quot; ... &quot;<br />
	${ConsoleWindowRefresh} $R0 &quot; Ever to be seen... &quot; &quot;${GREEN}&quot; &quot;transparent&quot;<br />
	<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">9th June 2013, 12:21</div></div><div class="posttext">Lose ShowWindow (don't hide the control) and it will work. But you can't use transparent in the 2nd call because the new text will be drawn on top of the old one, which will remain visible.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th June 2013, 21:13</div></div><div class="posttext">MessageBox will pump messages, Sleep does not so no WM_PAINT is processed, you have to force a paint cycle...<br />
<br />
!macro _ConsoleWindowRefresh CONTROL STRING COLOR COLORBACK<br />
<br />
    ShowWindow ${CONTROL} ${SW_HIDE}<br />
    SetCtlColors ${CONTROL} &quot;${COLOR}&quot; &quot;${COLORBACK}&quot;<br />
    ShowWindow ${CONTROL} ${SW_SHOW}<br />
    ${NSD_SetText} ${CONTROL} &quot;${STRING}&quot;<br />
    System::Call 'USER32::RedrawWindow(i${CONTROL},i0,i0,i0x787)'<br />
<br />
!macroend<br />
<br />
Switching to and from transparent is problematic so the hide/show hack has to stay.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nashtor</div><div class="date">10th June 2013, 15:24</div></div><div class="posttext">Thanks a lot!<br />
<br />
It works like a charm.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>