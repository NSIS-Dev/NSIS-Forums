<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" newbie, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  newbie NSIS Discussion" />
	
	<title> newbie [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  newbie</div>
<hr />
<div class="pda"><a href="t-317623.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=317623">newbie</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nibble</div><div class="date">10th March 2010, 11:49</div></div><div class="posttext">I did read the documentation as suggested etc.. But, I still don't understand some fundamentals<br />
<br />
This a code snippet taken from <br />
http://nsis.sourceforge.net/Docs/System/System.html#faq<br />
<br />
# allocate<br />
System::Alloc 32<br />
Pop $1<br />
# call<br />
System::Call &quot;Kernel32::GlobalMemoryStatus(p r1)&quot;<br />
# get<br />
System::Call &quot;*$1(i.r2, i.r3, p.r4, p.r5, p.r6, p.r7, p.r8, p.r9)&quot;<br />
# free<br />
System::Free $1<br />
<br />
If I'm correct, $1 holds the pointer to 32 bytes.<br />
We want the GlobalMemoryStatus to fill that memory.<br />
Now, GlobalMemoryStatus takes r1 as an argument. How is $1 related to r1? $1 == r1????<br />
<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">10th March 2010, 12:11</div></div><div class="posttext">This is explained in the system plug-in readme.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nibble</div><div class="date">10th March 2010, 13:30</div></div><div class="posttext">MSG, unfortunately I still don't get it...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">10th March 2010, 14:35</div></div><div class="posttext">How is $1 related to r1? $1 == r1????From the NSIS System Plug-in documentation:Available Sources and Destinations<br />
<br />
Type                 Meaning<br />
r0 through r9	     $0 through $9 respectively<br />
r10 through r19      $R0 through $R9 respectively<br />
R0 through R9	     $R0 through $R9 respectively<br />
The documentation includes sample code# assuming the struct's memory address is kept in $0<br />
System::Call &quot;*$0(i .r0, i .r1, i .r2, t .r3)&quot;<br />
DetailPrint &quot;first int = $0&quot;<br />
DetailPrint &quot;second int = $1&quot;<br />
DetailPrint &quot;third int = $2&quot;<br />
DetailPrint &quot;string = $3&quot;There is even a sample script in the Examples\System folder.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nibble</div><div class="date">10th March 2010, 15:04</div></div><div class="posttext">Call me dumb, but I still don't see a connection between $1 and r1. If the answer is very long and complex, say so.<br />
<br />
What makes sense is:<br />
<br />
System::Alloc 156 ; // sizeof(OSVERSIONINFOEX)<br />
Pop $0<br />
System::Call &quot;*$0(&amp;i4 156)&quot;<br />
System::Call &quot;kernel32::GetVersionExA (p $0)&quot;<br />
<br />
but it doesn't work... So, I guess I'm missing something big here. Perhaps switching to Visual Studio is much better idea...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">10th March 2010, 17:01</div></div><div class="posttext">but I still don't see a connection between $1 and r1.If you use .r1 in the system plugin call the plugin will use the NSIS variable called $1. If you use .r11 in the call then the plugin will use $R1. If you use .R1 then the plugin will use $R1.<br />
<br />
Here is the sample code from my last reply:# assuming the struct's memory address is kept in $0<br />
System::Call &quot;*$0(i .r0, i .r1, i .r2, t .r3)&quot;<br />
DetailPrint &quot;first int = $0&quot;<br />
DetailPrint &quot;second int = $1&quot;<br />
DetailPrint &quot;third int = $2&quot;<br />
DetailPrint &quot;string = $3&quot;Notice that the system plugin call uses .r0 and .r1 and .r2 and .r3 and that the DetailPrint commands refer to $0, $1, $2 and $3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2010, 17:15</div></div><div class="posttext">If you specify $0 instead of .r0 then you're passing the string value of $0. Passing .r0 tells System to internally use the actual contents of $0.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nibble</div><div class="date">11th March 2010, 07:47</div></div><div class="posttext">pengyou and Afrow UK, thank you both very much!<br />
I owe you a six pack :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nibble</div><div class="date">11th March 2010, 10:21</div></div><div class="posttext">System::Alloc 284 ; // sizeof(OSVERSIONINFOEX)<br />
Pop $0<br />
  <br />
${If} $0 &lt;&gt; 0<br />
  System::Call &quot;*$0(&amp;i4 284)&quot;<br />
  System::Call &quot;kernel32::GetVersionExW (p r0)&quot;<br />
${EndIf}<br />
 <br />
System::Alloc 36 ; // sizeof(SYSTEM_INFO)<br />
Pop $1<br />
  <br />
${If} $1 &lt;&gt; 0<br />
  System::Call &quot;kernel32::GetNativeSystemInfo (p r1)&quot;<br />
${EndIf}<br />
  <br />
System::Call &quot;*$0(i, i.R2, i.R3)&quot;<br />
System::Call &quot;*$1(&amp;i2.R4)&quot;<br />
     <br />
System::Free $1<br />
System::Free $0<br />
<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;$R2,$R3,$R4&quot; /SD IDOK<br />
<br />
R2, R3 and R4 are zero. Any suggestions/comments?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th March 2010, 11:51</div></div><div class="posttext">Get rid of the spaces after your function names. And there is no 'p'.<br />
<br />
GetVersionExW (p r0)<br />
-&gt;<br />
GetVersionExW(ir0)<br />
<br />
You can look at WinVer.nsh for usage of GetVersionEx.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>