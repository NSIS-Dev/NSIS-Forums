<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Check if user has permissions to create directory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Check if user has permissions to create directory NSIS Discussion" />
	
	<title> Check if user has permissions to create directory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Check if user has permissions to create directory</div>
<hr />
<div class="pda"><a href="t-312637.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=312637">Check if user has permissions to create directory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Jacobkg</div><div class="date">18th September 2009, 19:15</div></div><div class="posttext">Greetings:<br />
<br />
I am fairly new to NSIS installer creation, and could not find the answer to this question via other means.  I have an NSIS installer that defaults to a folder within the Program Files directory.  For non-admin users on Windows Server machines, I am getting an error when it tries to write files to that default directory.  I want to write a custom MUI_PAGE_CUSTOMFUNCTION_LEAVE function for the directory page that verifies that the user can write to the directory.  Anyone have a good idea about the best way to check whether a user has the appropriate permissions?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">21st September 2009, 11:37</div></div><div class="posttext">I have a solution for this at home. I'll try to remember to post it when I get back... &gt;__&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st September 2009, 12:38</div></div><div class="posttext">Just try writing to the folder and then check the errors flag:<br />
<br />
<br />
ClearErrors<br />
FileOpen $R0 $INSTDIR\tmp.dat w<br />
FileClose $R0<br />
Delete $INSTDIR\tmp.dat<br />
${If} ${Errors}<br />
  ...<br />
  Abort<br />
${EndIf}<br />
<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">21st September 2009, 12:57</div></div><div class="posttext">There's a differe between creation and modification priviledges. Are you sure the above will effectively test for both? But aside from that, that method should work just fine for in a leave function.<br />
<br />
(The solution I was referring to before is to directly check the permissions themselves, so it can be used in cases where many tests would be required in a short period of time.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st September 2009, 16:01</div></div><div class="posttext">The ability to create files and write to files are the same privilege.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">21st September 2009, 16:56</div></div><div class="posttext">FILE_WRITE_DATA 0x0002	For a file object, the right to write data to the file. For a directory object, the right to create a file in the directory (FILE_ADD_FILE).<br />
<br />
FILE_APPEND_DATA 0x0004	For a file object, the right to append data to the file. (For local files, write operations will not overwrite existing data if this flag is specified without FILE_WRITE_DATA.) For a directory object, the right to create a subdirectory (FILE_ADD_SUBDIRECTORY).<br />
<br />
These are separate permissions. They are both included in GENERIC_WRITE, but that does not mean that you shouldn't test for both privileges if you're going to need both.<br />
<br />
<br />
Here's what I've got, based on a script example by Anders:<br />
System::Call &quot;kernel32::CreateFile(t `$INSTDIR`,i 0x1301BB,i 3,i 0,i 3,i 0x02000000,i 0)i .r1&quot;<br />
The above hex value 0x1301BB consists of the following:<br />
STANDARD_RIGHTS_READ | FILE_READ_DATA | FILE_READ_ATTRIBUTES | FILE_READ_EA | SYNCHRONIZE | <br />
STANDARD_RIGHTS_WRITE | FILE_WRITE_DATA | FILE_WRITE_ATTRIBUTES | FILE_WRITE_EA | FILE_APPEND_DATA | <br />
STANDARD_RIGHTS_EXECUTE | FILE_EXECUTE |<br />
DELETE<br />
<br />
...Which is just the expanded version of FILE_GENERIC_READ | FILE_GENERIC_WRITE | FILE_GENERIC_EXECUTE | DELETE. Now that I think about it, I might also have tested for that pattern instead, chances are it would've amounted to the same thing.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>