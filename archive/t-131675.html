<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Automatic logging of files?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Automatic logging of files? NSIS Discussion" />
	
	<title> Automatic logging of files? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Automatic logging of files?</div>
<hr />
<div class="pda"><a href="t-131675.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=131675">Automatic logging of files?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">14th April 2003, 11:10</div></div><div class="posttext">Here's the story (sorry, it's a bit too long, but I want to be sure that everything's clear):<br />
I use &quot;external&quot; nsis installer: setup.exe and Instdata dir is packed into one with WinRar sfx. During install they're both unpacked to tempdir, and setup.exe copies files from Instdata using CopyFiles. So far so good.<br />
Uninstaller reads filenames from $INSTDIR\files.lst, where files.lst is a text list of all the files that must be removed:<br />
<br />
<br />
file1.exe<br />
file2.dll<br />
Data\file3.dat<br />
Data\Sound\file4.wav<br />
<br />
<br />
And so on (~300 entries).<br />
<br />
Now the problem is that I make files.lst myself and supply it in Instdata\files.lst. So being lazy (and it's not very comfortable, because the only thing that changes in the package are files in Instdata, and sometimes i'm not the last one who adds files to package) I thought:<br />
&quot;Wouldn't it be cool, if setup.exe on the run scans $EXEDIR\Instdata and automatically generates Instdata\files.lst&quot; or something similar. But I'm not programmer, in truth I have 0 experience in this field. I've tried to write using Findfirst &amp; Findnext, but it didn't work (as if I'm surprised) - wasn't working on subdirs and in the end crashed anyways, so I have no idea whatsoever. :igor: <br />
<br />
TIA,<br />
galil</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th April 2003, 17:45</div></div><div class="posttext">Example:<br />
<br />
Function ScanDir<br />
  Exch $2<br />
  Push $0<br />
  Push $1<br />
<br />
  FindFirst $0 $1 &quot;$2\*.*&quot;<br />
  IfErrors done<br />
  loop:<br />
    StrCmp $1 &quot;.&quot; next<br />
    StrCmp $1 &quot;..&quot; next<br />
    Push &quot;$2\$1&quot;<br />
    Call ScanDir<br />
    DetailPrint &quot;$2\$1&quot;<br />
    next:<br />
      FindNext $0 $1<br />
      IfErrors done loop<br />
<br />
  done:<br />
    Pop $1<br />
    Pop $0<br />
    Pop $2<br />
FunctionEnd<br />
<br />
Section &quot;Scan $TEMP&quot;<br />
  Push $TEMP<br />
  Call ScanDir<br />
SectionEnd<br />
<br />
You can easily change this to write to a file instead of printing it.<br />
Removing the full path can also be arranged with so much effort.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">16th April 2003, 21:25</div></div><div class="posttext">Thank you so much for your reply! :up: :) <br />
<br />
However I can't get your example script to work :(<br />
When run, it displays only:<br />
<br />
E:\TEMP\TEMP<br />
Completed<br />
<br />
So I changed -<br />
FindFirst $0 $1 $2*.*<br />
to<br />
FindFirst $0 $1 $2\*.*<br />
- and removed &quot;Call ScanDir&quot; line from function itself.<br />
<br />
So now it kinda works, but it has two flaws: lists directory names too (I don't need that, but I guess I could remove those entries by searching for &quot;.&quot; in the string) and, most importantly, doesn't scan subdirectories.<br />
So do I got your example wrong or what? :confused: <br />
<br />
TIA,<br />
galil</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th April 2003, 21:30</div></div><div class="posttext">Try the code again, I have mistakenly used [ php ] which is known to remove slashes. It's now using [ code ] which doesn't remove anything.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">17th April 2003, 12:29</div></div><div class="posttext">Tried it, now it only lists 1 file from temp dir, like:<br />
<br />
E:\TEMP\TERRA FIRMA (Lara's Mix).mp3<br />
Completed<br />
<br />
When I removed that call to itself:<br />
...<br />
    Push &quot;$2\$1&quot;<br />
    Call ScanDir;  &lt;- why this? I removed it.<br />
    DetailPrint &quot;$2\$1&quot;<br />
...<br />
, then it lists all files. But it doesn't scan subdirectories of Temp. :weird: <br />
<br />
TIA, <br />
galil</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th April 2003, 12:34</div></div><div class="posttext">The exact code, as written in the above post, works perfectly fine. Please try the attachment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">17th April 2003, 14:08</div></div><div class="posttext">Your compiled exe works fine.<br />
<br />
But when I try to compile it myself using the script I attached,<br />
it doesn't work.<br />
I guess I'm missing something again. :( <br />
<br />
TIA,<br />
galil<br />
<br />
PS: I'm sorry for being so retarded.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th April 2003, 14:17</div></div><div class="posttext">It's the exact same script as mine... What version are you using? If it's a version from CVS get the latest CVS version, if it's a version that's older than b3 get b3, and if it's b3 get latest CVS version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">17th April 2003, 14:42</div></div><div class="posttext">I'm using b3.<br />
<br />
I'll try latest CVS, downloading atm.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">galil</div><div class="date">17th April 2003, 15:34</div></div><div class="posttext">Woohoo, it works with CVS! Strange why it didn't with b3 though. Anyway, I'm so excited I gonna run around the office in circles, thank you so much! :up: <br />
<br />
Now I only need to change it to my needs. To get rid of that full path part, and I also don't need directory names included in the list. I guess I'll go check the Archive for some examples..<br />
<br />
TIA,<br />
galil</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>