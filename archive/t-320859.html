<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Are &quot;space required&quot; and &quot;space available&quot; in variables somewhere?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Are &quot;space required&quot; and &quot;space available&quot; in variables somewhere? NSIS Discussion" />
	
	<title> Are &quot;space required&quot; and &quot;space available&quot; in variables somewhere? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Are &quot;space required&quot; and &quot;space available&quot; in variables somewhere?</div>
<hr />
<div class="pda"><a href="t-320859.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=320859">Are &quot;space required&quot; and &quot;space available&quot; in variables somewhere?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Bansaw</div><div class="date">16th July 2010, 15:16</div></div><div class="posttext">These pop up when I specify output directory, but are they available in variables?<br />
<br />
I want to make a message box that says &quot;this is going to take up xGB of hard drive space, are you sure you want to continue?&quot;<br />
<br />
(And I want to express it in terms of GB not Kb.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">16th July 2010, 15:58</div></div><div class="posttext">I'm not sure if they happen to get stored in variables - I don't think so, though.<br />
<br />
If you're already on the directory page, then you could just steal them out of the labels and parse them from there.<br />
<br />
Alternatively, and more flexible, you can use SectionGetSize to get the size of a section - just add all of the sections that the user selected up to get the total kilobyte count - just divide by 1000000 or 1048576 to get GB or GiB), and ${DriveSpace} from the File Functions header (See the help file) to get the available space on a drive.<br />
<br />
Edit: SectionGetSize returns kilobyte, not byte -_-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">16th July 2010, 16:24</div></div><div class="posttext">something like this...<br />
<br />
<br />
!include &quot;LogicLib.nsh&quot;<br />
!include &quot;FileFunc.nsh&quot;<br />
<br />
...<br />
<br />
Var counter<br />
Var spaceNeeded<br />
Var spaceAvailable<br />
<br />
Function someFunction<br />
	StrCpy $spaceNeeded 0<br />
	StrCpy $counter 0<br />
	${Do}<br />
		${If} ${SectionIsSelected} $counter<br />
		    SectionGetSize $counter $0<br />
			IntOp $spaceNeeded $spaceNeeded + $0<br />
		${EndIf}<br />
		IntOp $counter $counter + 1<br />
	${LoopUntil} ${Errors}<br />
	System::Int64Op $spaceNeeded / 1048576 ; GiB<br />
	Pop $spaceNeeded<br />
	${GetRoot} &quot;$INSTDIR&quot; $0<br />
	${DriveSpace} &quot;$0\&quot; &quot;/D=F /S=G&quot; $spaceAvailable ; G = GiB<br />
	MessageBox MB_OK &quot;Install dir: $INSTDIR$\r$\nSpace required: $spaceNeeded$\r$\nSpace available: $spaceAvailable&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Bansaw</div><div class="date">16th July 2010, 18:34</div></div><div class="posttext">Thanks!    It works for the Space Available very well.<br />
<br />
But, if the total installation is less than 1GB it outputs 0.<br />
<br />
Is there anyway of it outputting 0.4GB for example</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">16th July 2010, 18:44</div></div><div class="posttext">${DriveSpace} is described in the manual:<br />
http://nsis.sourceforge.net/Docs/AppendixE.html#E.1.4<br />
<br />
If you change the /S=G part of the command to /S=K then the result will be shown in kilobytes instead of Gigabytes. If you really want to display 0.4 GB then you'll need to do some more work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">18th August 2010, 18:34</div></div><div class="posttext">Just correcting an error in my earlier post (Can no longer edit) pointed out in another thread.. whoops.<br />
<br />
The counter increase should be inside the loop, not inside the section selected conditional handling.<br />
<br />
<br />
${Do}<br />
	${If} ${SectionIsSelected} $counter<br />
		SectionGetSize $counter $0<br />
		IntOp $spaceNeeded $spaceNeeded + $0<br />
	${EndIf}<br />
	IntOp $counter $counter + 1<br />
${LoopUntil} ${Errors}</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>