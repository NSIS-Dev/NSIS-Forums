<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MUI + Messagebox plugin - Bug?!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MUI + Messagebox plugin - Bug?! NSIS Discussion" />
	
	<title> MUI + Messagebox plugin - Bug?! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MUI + Messagebox plugin - Bug?!</div>
<hr />
<div class="pda"><a href="t-279654.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279654">MUI + Messagebox plugin - Bug?!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Lenge</div><div class="date">21st October 2007, 22:57</div></div><div class="posttext">Hello world,<br />
<br />
I came across the following bug when using MUI and the messagebox plugin: When I define my own MUI_CUSTOMFUNCTION_ABORT function and use messagebox::show in it, then an additional (undesired) button is shown when &quot;Cancel&quot; is pressed for the first time. <br />
<br />
I have stripped down the error to the following small example. I found that...<br />
a) When you press &quot;Cancel&quot; for the first time, an undesired third button is shown.<br />
b) All subsequent uses of the Cancel button show only the &quot;Yes&quot; and &quot;No&quot; buttons (as desired).<br />
c) When I use msssagebox:show in the &quot;Section&quot; instead of the custom function, the bug does not show up.<br />
<br />
Is this a known bug or am I doing something wrong? What can I do to resolve the issue?<br />
<br />
JensName &quot;Test&quot;<br />
OutFile &quot;Test.exe&quot;<br />
!include MUI.nsh<br />
!define MUI_CUSTOMFUNCTION_ABORT MUI.onUserAbort<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
Section<br />
SectionEnd<br />
<br />
Function MUI.onUserAbort<br />
  messagebox::show MB_DEFBUTTON2 &quot;&quot; &quot;&quot; &quot;Really cancel?&quot; &quot;Yes&quot; &quot;No&quot;<br />
  pop $0<br />
  StrCmp $0 &quot;1&quot; +2<br />
  Abort<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">21st October 2007, 23:04</div></div><div class="posttext">you need to ensure that that stack is clear before calling the messagebox function (push/pop combination from what i remember). one day i may eventually re-write the lost code of that plugin so as not to have that issue (inbetween all of my winamp duties)<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lenge</div><div class="date">22nd October 2007, 09:42</div></div><div class="posttext">you need to ensure that that stack is clear before calling the messagebox functionHow would I do that best? In my example, none of my own code is executed before the plugin is called (only NSIS and MUI code). So how can I save all current stack values and restore them afterwards - all without exactly knowing how many values are on the stack?one day i may eventually re-write the lost code of that plugin so as not to have that issue (inbetween all of my winamp duties)Pleeeeaaaaase do so. Winamp duties will surely happily wait some time in favor of NSIS... ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lenge</div><div class="date">23rd October 2007, 09:55</div></div><div class="posttext">Hello world,<br />
<br />
I learned that the messagebox plugin requires an empty stack before calling messagebox::show, so I wrote two auxiliary macros _MSGBOX_CLEAR_STACK and _MSGBOX_RESTORE_STACK to to the job. But now I frequently get an &quot;unhandled Win32 exception&quot; if I use the plugin in the MUI_CUSTOMFUNCTION_ABORT function.<br />
<br />
I have stripped down the issue to a small test script that is attached to this posting.<br />
Could somebody please be so kind to have a look at it and see if you can reproduce the error?<br />
<br />
1. Run the compiled &quot;Test.exe&quot;.<br />
2. Proceed to the second page (directory selection).<br />
3. Press &quot;Cancel&quot; and confirm with &quot;Yes&quot;.<br />
<br />
At this point the Visual Studio debugger pops up claiming an unhandled Win32 exception. This does not always happen, but still about every second time I run the installer. The same thing happens on at least two other computers.<br />
<br />
My system:<br />
Windows XP SP2 with latest patches, NSIS 2.31, Visual Studio 2005 SP1 installed (that's why the debugger pops up when the error occurs).<br />
<br />
I am not quite sure if it's a bug in the plugin, or in MUI itself, or if it's just me doing something wrong. Any helpful comments are welcome.<br />
<br />
Jens</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>