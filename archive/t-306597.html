<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Cannot overwrite dll files in system32, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Cannot overwrite dll files in system32 NSIS Discussion" />
	
	<title> Cannot overwrite dll files in system32 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Cannot overwrite dll files in system32</div>
<hr />
<div class="pda"><a href="t-306597.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=306597">Cannot overwrite dll files in system32</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">danielbcn</div><div class="date">21st May 2009, 13:07</div></div><div class="posttext">Hi,<br />
<br />
I am pretty new to NSIS. I am facing a problem that I'm sure must have a simple solution.<br />
<br />
Everything works fine when I install my application for the first time in a PC.<br />
<br />
Then, I unistall it and then I want to reinstall it back. I get no errors from the setup program, but the DLL's I had copied to windows\system32 folder are never overwritten. For some reason, the only way to get the new version installed is to delete manually the old dlls first.<br />
<br />
This happens either in Windows XP or Windows Vista, no matter if the user has administrator rights or not.<br />
<br />
Do you know if there is any instruction that can overcome this limitation?<br />
<br />
I'm sending the whole script so you can see what I'm doing.<br />
<br />
Thanks in advance,<br />
<br />
Dani Carbonell</div></div><hr />


<div class="post"><div class="posttop"><div class="username">danielbcn</div><div class="date">3rd June 2009, 12:18</div></div><div class="posttext">In UpgradeDLL.nsh, I tried to change<br />
<br />
    SetOverwrite try<br />
<br />
to<br />
<br />
    SetOverwrite on<br />
<br />
... thinking that was going to be it... but it still won't overwrite the files...<br />
<br />
Any other ideas?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">3rd June 2009, 17:22</div></div><div class="posttext">Why don't you delete the DLL files when uninstalling?<br />
Or are these DLL's shared?<br />
<br />
You can try the InstallLib macro which is included in NSIS.<br />
Search the NSIS manual for InstallLib for more info.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd June 2009, 17:24</div></div><div class="posttext">It may be that the files have attributes set. Try SetFileAttributes dll_file.dll NORMAL<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">3rd June 2009, 21:15</div></div><div class="posttext">Are you trying to overwrite Windows system files? It looks like it. If the files need to be updated you should bundle a redistributable setup from Microsoft with the updated DLLs and have your script execute it, or put the files in the same folder as your program. You should not be replacing system files with your own, Microsoft prevents it and developers replacing system file with their own was the reason users experience instability with Windows or other applications.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Simon Brown</div><div class="date">3rd June 2009, 21:19</div></div><div class="posttext">I get no errors from the setup program, but the DLL's I had copied to windows\system32 folder are never overwritten. For some reason, the only way to get the new version installed is to delete manually the old dlls first.<br />
<br />
http://blogs.msdn.com/oldnewthing/archive/2006/03/21/556505.aspx<br />
<br />
Programs expect to be able to overwrite the files. A program's setup would run and it decided that it needed to &quot;update&quot; some system file and attempt to overwrite it. If the system tried to stop the file from being overwritten, the setup program would halt and report that it was unable to install the file. Even if the operating system detected that somebody was trying to overwrite a system file and instead gave them a handle to NUL, those programs would nevertheless notice that they had been hoodwinked because as a &quot;verification&quot; step, they would open the file they had just copied and compare it against the &quot;master copy&quot; on the installation CD.  The solution was to let the program think it had won, and then, when it wasn't looking, put the original back. <br />
<br />
;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">3rd June 2009, 21:56</div></div><div class="posttext">Since you're updating VB6 runtimes you should use this setup instead, either indicate it needs to be installed first or extract it to $TEMP or $PLUGINSDIR run it from your setup: www.microsoft.com/downloads/details.aspx?FamilyId=7B9BA261-7A9C-43E7-9117-F673077FFB3C&amp;displaylang=en but you shouldn't install it for XP and later. Although it wouldn't hurt because Windows should make sure newer versions aren't overwritten with older ones.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">danielbcn</div><div class="date">4th June 2009, 06:13</div></div><div class="posttext">In response to some of the comments:<br />
<br />
- Why don't you delete the DLL files when uninstalling?<br />
Or are these DLL's shared?<br />
<br />
They are (potentially) shared among a few aplications.<br />
<br />
- It may be that the files have attributes set.<br />
<br />
Do you mean they are marked as read-only? If so, they are not (I just checked).<br />
<br />
- Are you trying to overwrite Windows system files?<br />
<br />
I'm not overwriting the system files, but some dlls I developed which are shared among some applications I have developed.<br />
<br />
- Programs expect to be able to overwrite the files.<br />
<br />
You mean Windows makes the setup program think it has been able to overwrite the files and then, when it is not looking, goes back to the old version? Do you think there is a way to avoid this to happen?<br />
<br />
- Since you're updating VB6 runtimes you should use another setup instead.<br />
<br />
The problem I get os with my custom DLLs, not with the system ones.<br />
<br />
Thanks everyone for your replies.<br />
<br />
Dani</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th June 2009, 11:55</div></div><div class="posttext">Files with SYSTEM set are not always overwriteable in my experience.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">danielbcn</div><div class="date">4th June 2009, 13:16</div></div><div class="posttext">Hi, Afrow UK,<br />
<br />
Thanks for your comment.<br />
<br />
The files I need to overwrite do not have the SYSTEM attribute, they are regular dlls.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>