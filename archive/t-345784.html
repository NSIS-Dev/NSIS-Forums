<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS - Do you want to allow the followin program..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS - Do you want to allow the followin program... NSIS Discussion" />
	
	<title> NSIS - Do you want to allow the followin program... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS - Do you want to allow the followin program...</div>
<hr />
<div class="pda"><a href="t-345784.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=345784">NSIS - Do you want to allow the followin program...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">donose.mihai</div><div class="date">25th June 2012, 08:41</div></div><div class="posttext">Hello,<br />
<br />
I've created an installer using NSIS and used the ACCESSCONTROL to set the permission even for users:<br />
<br />
 AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;ListDirectory + GenericRead + GenericExecute + GenericWrite + GenericExecute&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(S-1-5-21)&quot; &quot;FullAccess&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(S-1-1-0)&quot; &quot;FullAccess&quot;<br />
   AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(S-1-5-32-545)&quot; &quot;FullAccess&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(Users)&quot; &quot;FullAccess&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(BU)&quot; &quot;FullAccess&quot;<br />
  AccessControl::EnableFileInheritance &quot;$INSTDIR&quot;<br />
<br />
<br />
Question:<br />
<br />
How can i get the software to run as administrator (without the message pooping up: &quot; Do you want to allow...&quot; )<br />
<br />
Do i need to make some registry settings?<br />
<br />
Any help will be greatly appreciated.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">25th June 2012, 08:45</div></div><div class="posttext">How can i get the software to run as administrator (without the message pooping up: &quot; Do you want to allow...&quot; )<br />
If by the popup you mean the UAC popup, you can't. You cannot run something as admin without the user explicitly allowing you (or without the user entering the admin password).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">donose.mihai</div><div class="date">25th June 2012, 08:51</div></div><div class="posttext">Yes i am referring to the UAC, but how other software can run from program files (x86), without the message from the UAC popping up?<br />
Can i make some registry settings from NSIS to run as administrator?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">25th June 2012, 08:57</div></div><div class="posttext">You can *run* from the program files directory, you just cannot *write* to it without admin access. The apps installed in those protected directories were installed at admin level.<br />
<br />
Your app should write to a subfolder of $APPDATA or $LOCALAPPDATA, not to $INSTDIR.<br />
<br />
(You can also add an admin request to your application's manifest, but that will only work on Vista and newer if UAC is enabled. But of course that will popup a confirmation dialog.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">donose.mihai</div><div class="date">25th June 2012, 09:18</div></div><div class="posttext">Let me ask you another thing because i didn't get it.<br />
<br />
Let's say i'm installing WinAmp in Program Files (x86), the UAC appears for the 1st time and after that i can run winamp without the UAC message popping up every time....and i found only an ini file and a temp file for winamp in the subfolders $APPDATA.<br />
<br />
<br />
<br />
Thanks for answering to a beginner :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">25th June 2012, 09:39</div></div><div class="posttext">Like I said, any user can run an app from a protected directory such as program files, because reading is allowed. Writing is however not allowed. For writing you need admin access, which is why the installer throws a UAC admin request. As far as I know, Winamp itself does NOT try to write to its own folder. Instead, it writes all its stuff either to HKCU registry or to $APPDATA / $LOCALAPPDATA.<br />
<br />
(If I'm wrong and it *does* try to write to its installation folder, then winamp is broken and needs to be fixed.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">donose.mihai</div><div class="date">27th June 2012, 10:39</div></div><div class="posttext">It is posibble...i've done it!!!<br />
<br />
The UAC message is not appearing anymore:<br />
<br />
I've used the access control plugin from nsis + i've worked with the registry:<br />
<br />
  ;--------------------------------<br />
  ; THIS TO WORK REQUIRES TO INSTALL THE ACCESSCONTROL PLUGIN INTO NSIS<br />
  ; FIND THE PLUGIN IN NET, UNPACK AND COPY THE .dll FILE INTO NSIS PLUGINS FOLDER<br />
  ;--------------------------------<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;ListDirectory + GenericRead + GenericExecute + GenericWrite + GenericExecute + Delete&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(S-1-5-21)&quot; &quot;ListDirectory + GenericRead + GenericExecute + GenericWrite + GenericExecute + Delete&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(S-1-1-0)&quot; &quot;ListDirectory + GenericRead + GenericExecute + GenericWrite + GenericExecute + Delete&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(S-1-5-32-545)&quot; &quot;ListDirectory + GenericRead + GenericExecute + GenericWrite + GenericExecute + Delete&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(Users)&quot; &quot;ListDirectory + GenericRead + GenericExecute + GenericWrite + GenericExecute + Delete&quot;<br />
  AccessControl::GrantOnFile &quot;$INSTDIR&quot; &quot;(BU)&quot; &quot;ListDirectory + GenericRead + GenericExecute + GenericWrite + GenericExecute + Delete&quot;<br />
  AccessControl::GrantOnRegKey \<br />
  HKLM &quot;Software\SoftwareName&quot;&quot; &quot;(BU)&quot; &quot;FullAccess&quot;<br />
    AccessControl::GrantOnRegKey \<br />
  HKLM &quot;Software\SoftwareName&quot; &quot;(S-1-5-32-545)&quot; &quot;FullAccess&quot;<br />
<br />
  ; Write the installation path into the registry<br />
  WriteRegStr HKLM SOFTWARE\SoftwareName &quot;Install_Dir&quot; &quot;$INSTDIR&quot;<br />
  <br />
  WriteRegStr HKLM &quot;Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\layers&quot; \<br />
&quot;$NameOfTheExeFile.exe&quot; &quot;RUNASADMIN&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th June 2012, 11:07</div></div><div class="posttext">Why on Earth are you doing that? Where are you installing to that requires you to change folder permissions?<br />
<br />
Either way I see some issues with your code:<br />
<br />
 Your first call to AccessControl will always fail - the username/SID argument is not optional (i.e. this will result in stack corruption).<br />
 S-1-5-21 is not a valid security identifier.<br />
 S-1-5-32-545, Users and BU are all the same BUILTIN\Users group!<br />
<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">donose.mihai</div><div class="date">27th June 2012, 12:04</div></div><div class="posttext">1. True, i've notice now that it has no identifier.<br />
<br />
2. It is a valid identifier S-1-5-21 - According to Microsoft is the Domain Admin - http://support.microsoft.com/kb/243330<br />
<br />
3. Use the SID &quot;(S-1-5-32-545)&quot; instead of &quot;(BU)&quot; for Windows 7 - &quot;(BU)&quot; doesn't work. This may also help for non-English installations.<br />
<br />
http://nsis.sourceforge.net/Talk:AccessControl_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th June 2012, 12:26</div></div><div class="posttext">2. It is a valid identifier S-1-5-21 - According to Microsoft is the Domain Admin - http://support.microsoft.com/kb/243330<br />
No, the domain administrator's SID is S-1-5-21domain-512 where domain is taken from the domain or machine SID. Similarly the local administrator's SID is S-1-5-21domain-500. S-1-5-21 on its own means nothing (try it in the active directory object browser).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">donose.mihai</div><div class="date">27th June 2012, 15:39</div></div><div class="posttext">thanks...you're right regarding the S-1-5-21, but bottom line is that i've done it....no UAC message appears and the application updates itself without any issues.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>