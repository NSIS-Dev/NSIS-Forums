<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help... cant get release, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help... cant get release NSIS Discussion" />
	
	<title> Help... cant get release [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help... cant get release</div>
<hr />
<div class="pda"><a href="t-120797.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=120797">Help... cant get release</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">umchebe</div><div class="date">9th January 2003, 20:30</div></div><div class="posttext">I have been using NSIS for several months now to help automate the distribution of my software... but I have had one recurring problem.<br />
<br />
The application that I written follows this process:<br />
<br />
1) it recognizes that it needs to update itself<br />
2) it streams the update file from the server<br />
3) it then launches the null soft wrapped update exe and closes itself<br />
4) the null soft package launches fine<br />
5) when it runs it attempts to unbundle the new version of my software<br />
6) windows has not always finished releasing the instance of my application<br />
7) 1 out of every 2 times it fails and asks the user if they wish to &quot;Retry&quot;, which I have had to train my users to always &quot;retry&quot;<br />
8) after several clicks it will recognize that windows has released the application instance... and then it succedes..<br />
<br />
I have put sleep commands in, and findwindow + sleep command which helped a little.... but unfortuantely it seems that Null Soft runs synchronously and does not let the operating system complete its work.<br />
<br />
What I need is a &quot;process messages&quot; call.... a way to tell the null soft process to chill, and let windows do its homework before proceeding.  (demote my thread temporarily)<br />
<br />
Any thoughts?<br />
<br />
matthew@smartrestaurant.com</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th January 2003, 20:45</div></div><div class="posttext">Make your application add a global mutex, and release that mutex when you exit the application. Then write a plug-in for NSIS (using Contrib\ExDLL structure) that will wait for this mutex to vanish. A better way would be writing to plug-in to keep trying to open the EXE until it succeeds and then let the installer continue.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">umchebe</div><div class="date">14th January 2003, 16:54</div></div><div class="posttext">Thanks... I can try this... but I am still wondering if it is difficult to invoke an API call (or similar) that tells the cpu to demote the nsis thread in favor of other system processes.. thus allowing it to finish, and then allowing the nsis to complete satisfactorily 100% of the time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th January 2003, 17:39</div></div><div class="posttext">Relaying on something to wait a certain number of seconds for it to finish before another thing is never a good idea. There is no way you can be absolutely sure that NSIS will wait enough time. You shold &quot;ask&quot; your program when it finishes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">umchebe</div><div class="date">14th January 2003, 17:46</div></div><div class="posttext">this is what i was hoping would work...<br />
sit and spin until the window class goes away...<br />
<br />
<br />
window_go_away:<br />
  Sleep 500<br />
  FindWindow $0 &quot;tViewSplash&quot; &quot;&quot;<br />
  IsWindow $0 window_go_away<br />
<br />
Sleep 200<br />
<br />
File &quot;C:\SmartTouch\SmartTouch.exe&quot;  <br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th January 2003, 17:53</div></div><div class="posttext">The window class is destroyed before the process exits.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">umchebe</div><div class="date">22nd January 2003, 20:15</div></div><div class="posttext">I have tried this morning... unsuccessfully.<br />
<br />
I created a function in the dll to recurrently try to create the applications mutex and contiue until success.  The function is exported.  The dll was built and placed in the same directory as makensis and my .nsi file.<br />
<br />
The script fails to recognize my function.<br />
<br />
Any ideas??<br />
<br />
Thanks very much.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd January 2003, 22:31</div></div><div class="posttext">Put it in the plugins directory or use PluginsDir.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>