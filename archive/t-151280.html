<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Looking for a smaller way for this..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Looking for a smaller way for this... NSIS Discussion" />
	
	<title> Looking for a smaller way for this... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Looking for a smaller way for this...</div>
<hr />
<div class="pda"><a href="t-151280.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=151280">Looking for a smaller way for this...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">2nd October 2003, 23:28</div></div><div class="posttext">Is there a smaller way to create a NSIS plugin?<br />
Ok. Since I'm learning C++ with Dev-C++, I'd like to try to<br />
make some of them. <br />
Thanks :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">3rd October 2003, 11:29</div></div><div class="posttext">What do you mean? Please give more details.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd October 2003, 13:24</div></div><div class="posttext">Try searching for ways to avoid inclusion of MSVCRT from MinGW's compiled DLL. I have searched Google a bit but couldn't find anything useful on the first result page ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">3rd October 2003, 18:36</div></div><div class="posttext">Hey, a quick way to get started is to import the exdll project and modify it. Just make sure to change the project type to win32dll before compiling. Dev-cpp doesn't import the fact that its a dll.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">3rd October 2003, 18:58</div></div><div class="posttext">not using the standard c functions helps as well - like with most of the example dlls by including your own atoi functions, etc and that (usually saves around 30k from what i remember).<br />
<br />
other options are eliminating duplicate strings (not sure how/if Dev-C++ has that option - know how to with vc++ 6 and borland c++ 5)<br />
<br />
if you were using vc++ 6 i would also say to try this (http://www.codeproject.com/tips/aggressiveoptimize.asp?target=aggressive) which kicks in certain optimisations to help cut compiled sizes down (if the code and all that allows for it ;))<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">3rd October 2003, 19:35</div></div><div class="posttext">Here is an example project. Simply extra and drop into the NSIS Contrib folder (so it can find the ExDll.h). I hope this helps.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">3rd October 2003, 20:29</div></div><div class="posttext">Thanks to everyone :).<br />
@KichiK: According to Dev-C++'s site, the MSVCRT dependecy come with Windows 95 or higher... since NSIS run only in Win95 and up, I'll be don't problem, right?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">3rd October 2003, 22:30</div></div><div class="posttext">Well, in VC-land, I use ATL/WTL.<br />
<br />
ATL (Active Template Library) was created to build *small* DLL/COM objects which could be downloaded on the net (even using dialup)... it has wizard project support under VC, and once you have created the empty DLL, you just don't add any COM interfaces/objects. :)<br />
<br />
WTL (Windows Template Library) is more of an [unofficial] statement of what MFC could (should?) have been... template-based class wrappers around many of the Windows controls and objects actually handle a great deal of what most people use MFC for - without the incredible bloat!<br />
<br />
With care, either or both may be used to construct *small* (4k-8k) libraries/executables without runtime library (or exception handling) support.<br />
<br />
The downside (for some) is probably that these are Microsoft-based tools... ATL comes with VC, while WTL is available as a free download (with very little documentation).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">4th October 2003, 01:28</div></div><div class="posttext">ok, with the fuction that come with the above zip:<br />
<br />
void __declspec(dllexport) myFunction(HWND hwndParent, int string_size, char *variables, stack_t **stacktop)<br />
{<br />
  EXDLL_INIT();<br />
  {<br />
    char buf[1024];<br />
    popstring(buf);<br />
    MessageBox(hwndParent,buf,0,MB_OK);<br />
  }<br />
}<br />
<br />
How can I input or output values?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th October 2003, 13:03</div></div><div class="posttext">With popstring and pushstring. They work on the NSIS stack which is controlled by Push, Pop and Exch in the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">4th October 2003, 20:51</div></div><div class="posttext">Thanks I'll give it a try :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">4th October 2003, 21:59</div></div><div class="posttext">Ok. I almost got it. I have this:<br />
<br />
char buf[1024];<br />
char buf2[1024];<br />
popstring(buf);<br />
popstring(buf2);<br />
MessageBox(hwndParent,buf,0,MB_OK);<br />
MessageBox(hwndParent,buf2,0,MB_OK);<br />
<br />
Works great. It display the Two MessageBoxes with MB_YESNO and the MB_ICONINFORMATION.<br />
These are my questions:<br />
1. How can I input numeric (int or double) values, since the popstring is char?<br />
2. How can I output values? Since Button &quot;Yes&quot; is 6 and Button &quot;No&quot; is 7.<br />
Thanks. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">4th October 2003, 23:33</div></div><div class="posttext">Here is an example:<br />
<br />
<br />
static buf[1024];<br />
int num;<br />
popstring(buf); //get number string<br />
num = my_atoi(buf); //convert to number<br />
wsprintf(buf,&quot;%d&quot;,num); //convert number back to string<br />
pushstring; //output number string<br />
<br />
<br />
The my_atoi function is available from the nsexec plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">5th October 2003, 16:32</div></div><div class="posttext">Ok. One more time. :) I have this:<br />
<br />
int num1;<br />
int num2;<br />
int ret;<br />
char *ok;<br />
int decimal, sign;<br />
<br />
/* .... */<br />
<br />
char buf1[1024];<br />
char buf2[1024];<br />
num1 = atoi(buf1);<br />
num2 = atoi(buf2);<br />
ret = num1 + num2;<br />
ok = fcvt(ret,1, &amp;decimal, &amp;sign);<br />
popstring(ok);<br />
MessageBox(hwndParent,ok,&quot;Hola&quot;,64);<br />
<br />
If I put:<br />
<br />
MyDLL::Test &quot;5&quot; &quot;3&quot;<br />
<br />
In the MessageBox ok is equal to &quot;5&quot;, when is suppose to be &quot;8&quot;. Why doesn't make the op. &quot;5+3&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">5th October 2003, 16:43</div></div><div class="posttext">use wsprintf(ok,&quot;%d&quot;,ret); and change char* ok to char ok[8].<br />
<br />
that should work<br />
<br />
-daz<br />
<br />
 you don't need the fcvt(..) part with the change</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">5th October 2003, 17:07</div></div><div class="posttext">Thanks DrO. :) With this:<br />
<br />
char buf1[1024];<br />
char buf2[1024];<br />
popstring(buf1);<br />
popstring(buf2);<br />
num1 = atoi(buf1);<br />
num2 = atoi(buf2);<br />
ret = num1 + num2;<br />
wsprintf(ok,&quot;%d&quot;,ret); <br />
MessageBox(hwndParent,ok,&quot;Hola&quot;,64);<br />
<br />
Now I'm going to output the value of the press messagebox button, for example: OK=1; YES=6; NO=7. The return value must be in a $(0..9), any ideas? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">5th October 2003, 17:20</div></div><div class="posttext">try this:<br />
<br />
   char buf1[1024];<br />
   char buf2[1024];<br />
   int ret;<br />
       popstring(buf1);<br />
       popstring(buf2);<br />
       wsprintf(ok,&quot;%d&quot;,atoi(buf1)+atoi(buf2));<br />
       ret = MessageBox(hwndParent,ok,&quot;Hola&quot;,64);<br />
       wsprintf(buf1,&quot;%d&quot;,ret);<br />
       pushstring(buf1);   // should put the return value into $0<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">5th October 2003, 17:35</div></div><div class="posttext">Thanks dude :) :up:<br />
Now I think that I can take it from here  :confused: --&gt; :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">5th October 2003, 17:37</div></div><div class="posttext">no problem ;) <br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">5th October 2003, 17:48</div></div><div class="posttext">Well, one more :rolleyes:<br />
Since is<br />
<br />
pushstring(buf1); // should put the return value into $0 <br />
<br />
How can I change the value of the stack, I mean in this example is $0 is the default, how can change it... mmm, let's say to $5</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th October 2003, 19:35</div></div><div class="posttext">I thought that pushstring will not replace anything on the stack, just add an item to the stack, so the user will have to pop multiple times to get all the stack strings.<br />
<br />
Wouldn't the user just have to Pop $5<br />
<br />
Edit: But then again, I don't know any C++/Delphi, so I'm probably wrong.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">6th October 2003, 11:43</div></div><div class="posttext">think it's setuservariable (or something to that name) in exdll.h and from what i understand it will allow you to set $5 based on the id from the enum list you use.<br />
<br />
can't check this for sure at the moment but think that's the push in the right direction.<br />
<br />
I thought that pushstring will not replace anything on the stack, just add an item to the stack, so the user will have to pop multiple times to get all the stack strings. that's how i'd take it as well<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">9th October 2003, 01:37</div></div><div class="posttext">I'm stuck in here:<br />
<br />
float myret;<br />
float num1;<br />
float num2;<br />
char ok[1024];<br />
<br />
void __declspec(dllexport) Add(HWND hWnd, int string_size, char *variables, stack_t **stacktop)<br />
{<br />
EXDLL_INIT();<br />
{<br />
char n1[1024];<br />
char n2[1024];<br />
popstring(n1);<br />
popstring(n2);<br />
num1 = atof(n1);<br />
num2 = atof(n2);<br />
myret = num1 + num2;<br />
//gcvt(myret,3,ok);<br />
sprintf(ok,&quot;%g&quot;,myret);<br />
MessageBox (hWnd, ok, &quot;Atención&quot;, 0 + MB_ICONASTERISK);<br />
}<br />
}<br />
<br />
if I used this:<br />
<br />
MyDLL::Add &quot;5&quot; &quot;2&quot;<br />
<br />
the ok returns this: 2.48085e+006 :igor:<br />
I'm trying to read &quot;float numbers&quot; like &quot;5&quot; and &quot;5.6&quot; to make the op. like 5+5.56.<br />
Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th October 2003, 11:56</div></div><div class="posttext">What's %g? Don't you mean %f? printf also has options you can put between % and f. See printf's readme for more information about setting the output precision.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">9th October 2003, 23:12</div></div><div class="posttext">Ok. I'm trying again. Thanks :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">10th October 2003, 00:39</div></div><div class="posttext">Well... This could be &quot;it&quot;.<br />
I have this now:<br />
<br />
char n1[1024];<br />
char n2[1024];<br />
char ret[1024];<br />
popstring(n1);<br />
popstring(n2);<br />
num1 = atof(n1);<br />
num2 = atof(n2);<br />
myret = num1 + num2;<br />
gcvt (myret,10,ok);<br />
MessageBox (hWnd, ok, &quot;Atención&quot;, 0 + MB_ICONASTERISK);<br />
popstring(ret);<br />
if (ret == &quot;Yes&quot;) MessageBox (hWnd, &quot;Esta es para $0&quot; , &quot;Hola!&quot;, 0);<br />
if (ret == &quot;No&quot;) MessageBox (hWnd, &quot;Esta es para $1&quot; , &quot;Hola&quot;, 0);<br />
<br />
With this Nsis code:<br />
<br />
MyDLL::Add &quot;3.150&quot; &quot;-1.134&quot; &quot;No&quot;<br />
Quit<br />
<br />
The plugin successfully do the operation. :up:<br />
But it doesn't show the second Messagebox, anyone know why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th October 2003, 00:42</div></div><div class="posttext">You can't compare strings like that. Use strcmp or anyone of its varients.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">10th October 2003, 23:32</div></div><div class="posttext">Thanks Kichik, that was it :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">11th October 2003, 22:33</div></div><div class="posttext">Just to say thanks to all the people who help me creating a plugin.<br />
It's almost done. It's based in the concept of Math.dll, with a spanish style :p ;).<br />
Thanks to all the people of this thread and brainsucker :).<br />
It's more like a doubt. When the compiler (makensisw.exe) reads the script, it has something like this in the log:<br />
<br />
Processing plugin dlls: &quot;C:\lobolunar\dev\nsis\plugins\*.dll&quot;<br />
 - Banner::destroy<br />
 - Banner::show<br />
 - LangDLL::LangDialog<br />
...<br />
<br />
In my plugin I have some functions that I don't wanna show in the log... so...how do you do that....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th October 2003, 11:59</div></div><div class="posttext">Functions that should not be accessible to the user shouldn't be of the following format:<br />
<br />
void __declspec(dllexport) functionName(HWND hwndParent, int string_size, char *variables, stack_t **stacktop)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">12th October 2003, 16:06</div></div><div class="posttext">mmm...Yes I think of that, but still...<br />
Look, I'm attaching the source code of my first version.<br />
In MathOpH.h has the function that I don't wanna show.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th October 2003, 16:12</div></div><div class="posttext">Remove the functions you don't want exported from dll.def.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">12th October 2003, 16:32</div></div><div class="posttext">mmmmm, how? :rolleyes:<br />
/edit... I discovered :D Thanks :up: /</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>