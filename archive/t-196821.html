<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" uninstaller problems, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  uninstaller problems NSIS Discussion" />
	
	<title> uninstaller problems [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  uninstaller problems</div>
<hr />
<div class="pda"><a href="t-196821.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=196821">uninstaller problems</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BigBadBurrows</div><div class="date">19th October 2004, 22:07</div></div><div class="posttext">Hi all,<br />
<br />
I recently added a function to my installer to allow the user to select between a minimum database which is 200Mb or an extended database which is 900Mb. Before I always installed the extended one.<br />
<br />
To do this I created an options file to allow the user to chose which database to install: -<br />
<br />
<br />
;Read a value from an InstallOptions INI file<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\database.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
<br />
<br />
  ; Test to see which Database is to be installed<br />
  StrCmp $R0 &quot;1&quot; &quot;&quot; Extended<br />
<br />
<br />
     DetailPrint &quot;Installing Minimum Database&quot;<br />
     setOutPath &quot;$INSTDIR\data\english&quot;<br />
     File /r &quot;C:\mindata\english\*.*&quot;  ; contains the minimal distributed tables<br />
<br />
     setOutPath &quot;$INSTDIR\data\usa&quot;<br />
     File /r &quot;C:\mindata\usa\*.*&quot;  ; contains the minimal distributed tables<br />
<br />
    Goto Done<br />
<br />
<br />
    Extended:<br />
    <br />
    <br />
     DetailPrint &quot;Installing Extended Database&quot;<br />
     SetOutPath &quot;$INSTDIR\data\english&quot;<br />
     File /r &quot;C:\fulldata\english\*.*&quot;  ; contains the extended tables<br />
<br />
     SetOutPath &quot;$INSTDIR\data\usa&quot;<br />
     File /r &quot;C:\fulldata\usa\*.*&quot;<br />
<br />
<br />
    Done:<br />
<br />
<br />
This bit works ok. And it installs the database I select.<br />
<br />
As part of the installation I also create an uninstaller: -<br />
<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
  RMDir &quot;$INSTDIR\j2re&quot;<br />
  RMDir &quot;$INSTDIR\Program Files&quot;<br />
  RMDir &quot;INSTDIR\data\english&quot;<br />
  RMDir &quot;INSTDIR\data\usa&quot;<br />
<br />
  Delete &quot;$INSTDIR\Uninstall.exe&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
However, when I run the installer program when it gets to the stage where the uninstaller is created, it pauses for a few minutes then I get an error &quot;Error creating uninstall.exe&quot;<br />
<br />
When I try and run the uninstaller all it does is delete the Uninstall.exe, but non of the other files.<br />
<br />
I never had this problem before I added the ability to chose the database, so i'm guessing that might have something to do with it. <br />
<br />
Does anyone know why this might be happening?<br />
<br />
Many Thanks,<br />
<br />
Martin<br />
<br />
P.S.  I'm using NSIS 2.01</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">20th October 2004, 03:49</div></div><div class="posttext">hopefully the solution is simple as that: you used INSTDIR instead of $INSTDIR in the uninstaller section.. but i guess you would've gotten an error while compiling the installer, dunno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BigBadBurrows</div><div class="date">20th October 2004, 09:45</div></div><div class="posttext">Yeh sorry, that was just a typo in the simplified version I put on the forum</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">20th October 2004, 10:47</div></div><div class="posttext">you could use IfFileExists and MessageBox to make sure the uninstaller finds the files you intend to delete</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BigBadBurrows</div><div class="date">20th October 2004, 17:56</div></div><div class="posttext">OK, I tried using a message box to display the paths to be deleted. The path is correct but the directory still isn't being deleted.  The only thing I can think of that there isn't a closing slash, e.g.<br />
<br />
&quot;C:\Program Files\MyApp\Program Files&quot;<br />
<br />
Am I also using the right method to delete the folder?<br />
<br />
RMDir &quot;$INSTDIR\Program Files&quot;<br />
<br />
Any ideas?  I'm baffled</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">20th October 2004, 18:14</div></div><div class="posttext">Are you sure that folders are empty? To remove not empty folder use <br />
<br />
RMDir /r &quot;$INSTDIR&quot;<br />
<br />
instead of 5 lines in your Uninstall section. This is little dangerous because user can copy Uninstaller to root folder and run it with default $INSTDIR = c:\ :( , but this works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BigBadBurrows</div><div class="date">21st October 2004, 01:51</div></div><div class="posttext">FIXED!!<br />
<br />
Thanks Yathosho &amp; Takhir.  It was what Takhir suggested, and the folder werent empty so they weren't being deleted.  The /r flag fixed it though<br />
<br />
Thanks again</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st October 2004, 17:58</div></div><div class="posttext">RMDir /r won't delete a root directory unless AllowRootDirInstall true is used.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>