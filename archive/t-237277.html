<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Odd LangString behavior, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Odd LangString behavior NSIS Discussion" />
	
	<title> Odd LangString behavior [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Odd LangString behavior</div>
<hr />
<div class="pda"><a href="t-237277.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=237277">Odd LangString behavior</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Dashus</div><div class="date">5th February 2006, 21:46</div></div><div class="posttext">I'm reading in a language id from regsitry which doesn't match the ${LANGUAGE_*} values so I'm just switching the LANGID and popping the appropriate value into $LANGUAGE.  The problem is that while the value of $LANGUAGE is correct it always prints the english error message.  The license agreement is in the correct language; just never any of the error messages.  All errors are thrown only in .onInit.  Any ideas?<br />
<br />
<br />
!define LANGID_ENGLISH 0<br />
!define LANGIS_FRENCH 1<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!insertmacro MUI_LANGUAGE &quot;French&quot;<br />
<br />
LicenseLangString myLicenseData ${LANG_ENGLISH} &quot;local\license.txt.EN&quot;<br />
LicenseLangString myLicenseData ${LANG_FRENCH} &quot;local\license.txt.FR&quot;<br />
LicenseData $(myLicenseData)<br />
<br />
LangString emsg_InstallerAlreadyRunning ${LANG_ENGLISH} &quot;English - Installer already running.&quot;<br />
LangString emsg_InstallerAlreadyRunning ${LANG_FRENCH} &quot;French - Installer already running.&quot;<br />
<br />
Function .onInit<br />
<br />
    ; Get the game language value<br />
    ReadRegDWORD $LANGID HKLM &quot;...&quot; &quot;Language&quot;<br />
    ${Select} $LANGID<br />
    ${Case} ${LANGID_FRENCH}<br />
      Push ${LANG_FRENCH}<br />
      Pop $LANGUAGE<br />
    ${Default}<br />
      Push ${LANG_ENGLISH}<br />
      Pop $LANGUAGE<br />
    ${EndSelect}<br />
<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION &quot;$LANGUAGE&quot;<br />
<br />
    ; Prevent multiple instances of installer<br />
    System::Call 'kernel32::CreateMutexA(i 0, i 0, t &quot;TSLRP&quot;) i .r1 ?e'<br />
    Pop $R0<br />
    StrCmp $R0 0 +3<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION &quot;$(emsg_InstallerAlreadyRunning)&quot;<br />
    Abort<br />
    ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">6th February 2006, 01:17</div></div><div class="posttext">Possible solutions:<br />
<br />
Solution 1:<br />
<br />
Typo:<br />
LANGIS_FRENCH<br />
should be<br />
LANGID_FRENCH<br />
Solution 2:<br />
Language IDs are wrong.  English is 1033 and French is 1036.  <br />
<br />
Solution 3:<br />
Try:<br />
ReadRegDWORD $LANGID HKLM &quot;...&quot; &quot;Language&quot; ; edit this!<br />
${Select} $LANGID<br />
${Case} ${LANGID_FRENCH}<br />
  StrCpy $LANGUAGE 1036<br />
${Default}<br />
  StrCpy $LANGUAGE 1033<br />
${EndSelect}<br />
Edit: Modern UI will require the language ID to be correct (i. e. 1033 for english and 1036 for french) or you won't see much of a ui.<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dashus</div><div class="date">7th February 2006, 00:01</div></div><div class="posttext">1) Typo isn't in my original; I didn't copy paste...foolish me :igor: <br />
<br />
2) The MessageBox displays the proper value of $LANGUAGE for both the first and second instance of the installer.<br />
<br />
3) And I do in fact get the UI to come up.  It's just that I'm trying to display the &quot;The installer is already running&quot; in the language of the user.  But despite the fact that the value in $LANGUAGE (1036) is correct for both instances I always get the English error message.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">7th February 2006, 09:08</div></div><div class="posttext">That's because $LANGUAGE variable is set in .onInit, but NSIS re-reads it only after .onInit. So your multilanguage variable &quot;emsg_InstallerAlreadyRunning&quot; will be &quot;multilanguage&quot; only after .onInit execution.<br />
Here (http://forums.winamp.com/showthread.php?postid=1641306#post1641306) and here (http://forums.winamp.com/showthread.php?s=&amp;threadid=147907&amp;highlight=oninit+Messagebox) discussion. Or search the forum for &quot;oninit&quot;, &quot;multilanguage&quot;, &quot;messagebox&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dashus</div><div class="date">8th February 2006, 02:54</div></div><div class="posttext">Appreciate it!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>