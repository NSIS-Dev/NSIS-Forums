<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Nsis Mui_langdll_display, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Nsis Mui_langdll_display NSIS Discussion" />
	
	<title> Nsis Mui_langdll_display [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Nsis Mui_langdll_display</div>
<hr />
<div class="pda"><a href="t-308157.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=308157">Nsis Mui_langdll_display</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TERRAPOD</div><div class="date">10th July 2009, 09:45</div></div><div class="posttext">Hello. I'm new to NSIS and i need to display language selection dialog with hardcoded default language. It is not english.<br />
<br />
As i understand MUI_LANGDLL_DISPLAY does not provide such a possibility. Is there any way to implement my own language selection dialog avoiding C/C++ DLL creation? Could u give me a simple example or a link to the right place to read about this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th July 2009, 10:45</div></div><div class="posttext">Why not create your own language file?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th July 2009, 10:53</div></div><div class="posttext">Ok lets assume you add a custom language to the dialog (which you can) you will get your custom language id pushed onto the stack afterwards. You would then need to do something with this language id (i.e. ${If} $LANGUAGE == 12345) but there's nothing you can do if the language is hard coded?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TERRAPOD</div><div class="date">10th July 2009, 13:09</div></div><div class="posttext">Afrow,<br />
<br />
u missunderstand me. I have a translation. I need my language be first in the list. Here is an example:<br />
<br />
...<br />
; langs<br />
!insertmacro MUI_LANGUAGE &quot;Russian&quot;<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
...<br />
Function .onInit<br />
<br />
  ; language selection dialog<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
  ...<br />
FunctionEnd<br />
<br />
MUI_LANGDLL_DISPLAY shows a dialog and sometimes &quot;Russian&quot; is selected by default, sometimes English. As i understand, it depend on different system settings (Regional and lang options etc). But i need &quot;Russian&quot; to be the 1st in the combo ALWAYS.<br />
<br />
I've made a workaround using Page custom. Here it is:<br />
...<br />
; installer pages<br />
Page custom LangSelector<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_INSTFILES<br />
...<br />
Function LangSelector<br />
<br />
  nsDialogs::Create 1018<br />
	Pop $Dialog<br />
<br />
	${If} $Dialog == error<br />
		Abort<br />
	${EndIf}<br />
  <br />
  ${NSD_CreateGroupBox} 0 0 100% 125 &quot;Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸&quot;<br />
  Pop $GroupBox<br />
  <br />
  ; RU line<br />
  ${NSD_CreateBitmap} 25 31 16 11 &quot;&quot;<br />
  Pop $FlagRU<br />
  ${NSD_SetImage} $FlagRU &quot;ru.bmp&quot; $hFlagRU<br />
  ${NSD_CreateRadioButton} 60 25 50% 25 &quot;Ð_ÑƒÑÑÐºÐ¸Ð¹&quot;<br />
  Pop $LangRU<br />
  ${NSD_OnClick} $LangRU LangChanged<br />
  ${NSD_Check} $LangRU ; !!! this is always default !!!<br />
  <br />
  ; GB line<br />
  ${NSD_CreateBitmap} 25 81 16 11 &quot;&quot;<br />
  Pop $FlagGB<br />
  ${NSD_OnClick} $FlagGB LangChanged<br />
  ${NSD_SetImage} $FlagGB &quot;gb.bmp&quot; $hFlagGB<br />
  ${NSD_CreateRadioButton} 60 75 50% 25 &quot;English&quot;<br />
  Pop $LangGB<br />
  ${NSD_OnClick} $LangGB LangChanged<br />
  <br />
  nsDialogs::Show<br />
<br />
  ; free resources  <br />
  ${NSD_FreeImage} $FlagRU<br />
  ${NSD_FreeImage} $FlagGB<br />
<br />
FunctionEnd<br />
...<br />
And now I have another problem: how should i setup selected language so the other pages use correct language? Here is what i did:<br />
...<br />
Function LangChanged<br />
  Pop $0 ; radio box handle that was clicked<br />
  ${If} $0 == $LangRU<br />
    Push ${LANG_RUSSIAN}<br />
    Pop $LANGUAGE<br />
    ${NSD_SetText} $GroupBox &quot;Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸&quot;<br />
  ${EndIf}<br />
  ${If} $0 == $LangGB<br />
    Push ${LANG_ENGLISH}<br />
    Pop $LANGUAGE<br />
    ${NSD_SetText} $GroupBox &quot;Select installer language&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
It is incorrect and does not change language... How to change it except using $LANGUAGE (as i did)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th July 2009, 13:24</div></div><div class="posttext">Are you using the MUI_LANGDLL_REGISTRY_* defines?<br />
$LANGUAGE has to be set in .onInit before any dialogs are shown.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TERRAPOD</div><div class="date">10th July 2009, 14:39</div></div><div class="posttext">Originally posted by Afrow UK <br />
Are you using the MUI_LANGDLL_REGISTRY_* defines? <br />
No, i don't use MUI_LANGDLL_REGISTRY_* defines.<br />
<br />
Originally posted by Afrow UK <br />
$LANGUAGE has to be set in .onInit before any dialogs are shown.<br />
<br />
Stu <br />
Thank you... So, custom page is not a right way for me. Below is a short example demonstrating my problem, if u compile it and run you will see &quot;English&quot; is a default. I need change it to &quot;Russian&quot;. Any proposals?<br />
<br />
<br />
; includes<br />
!include &quot;MUI2.nsh&quot;<br />
<br />
; configure<br />
Name &quot;Example&quot;<br />
OutFile &quot;Example.exe&quot;<br />
<br />
; installer pages<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
; langs<br />
!insertmacro MUI_LANGUAGE &quot;Russian&quot;<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
; localized messages<br />
LangString HELLO_WORLD ${LANG_RUSSIAN} &quot;ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð¼Ð¸Ñ€!&quot;<br />
LangString HELLO_WORLD ${LANG_ENGLISH} &quot;Hello, world!&quot;<br />
<br />
Function .onInit<br />
  ; ask for installer language<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
FunctionEnd<br />
<br />
Section &quot;First and the only&quot;<br />
  DetailPrint $(HELLO_WORLD)<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">10th July 2009, 15:04</div></div><div class="posttext">You can set the default language in the registry.<br />
<br />
Check the MUI documentation (Settings for registry storage of selected language).<br />
If you want your users to be able to select another language, define MUI_LANGDLL_ALWAYSSHOW as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TERRAPOD</div><div class="date">10th July 2009, 15:08</div></div><div class="posttext">Originally posted by jpderuiter <br />
You can set the default language in the registry.<br />
<br />
Check the MUI documentation (Settings for registry storage of selected language).<br />
If you want your users to be able select another language, define MUI_LANGDLL_ALWAYSSHOW as well.  <br />
Got it! Thank you very much! Here is corrected example if anyone will need:<br />
Function .onInit<br />
  WriteRegDWORD HKLM &quot;Software\MyMegaApplication&quot; &quot;NSISDefaultLang&quot; ${LANG_RUSSIAN}<br />
  !define MUI_LANGDLL_REGISTRY_ROOT HKLM<br />
  !define MUI_LANGDLL_REGISTRY_KEY &quot;Software\MyMegaApplication&quot;<br />
  !define MUI_LANGDLL_REGISTRY_VALUENAME &quot;NSISHardcodedDefaultLang&quot;<br />
  !define MUI_LANGDLL_ALWAYSSHOW<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>