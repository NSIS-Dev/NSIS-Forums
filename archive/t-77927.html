<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" FileClose not closing a file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  FileClose not closing a file NSIS Discussion" />
	
	<title> FileClose not closing a file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  FileClose not closing a file</div>
<hr />
<div class="pda"><a href="t-77927.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=77927">FileClose not closing a file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bbh</div><div class="date">1st March 2002, 20:57</div></div><div class="posttext">Hi,<br />
<br />
I have a temporary file used by my installer that I cannot delete.  But I believe the delete is failing because it is not actually getting closed.  The delete is setting the ErrorFlag, and the only thing I can think of is the file is not getting closed, thus preventing it from being deleted.<br />
<br />
I have put a whole bunch of Message Boxes in my script to follow closely what is going on.  If I use the OS to check the handle of my temp file, I see that nothing else has a hold of it except my installer program.  If fact the installer program has a hold of it until I actually exit the installer, even though I request to close it and delete it.  I am using v1.96, on W2K.<br />
<br />
Here is the portion of my script:<br />
	SetOutPath $TEMP<br />
	GetTempFileName $7<br />
	MessageBox MB_OK &quot;Temp file name is $7&quot;<br />
<br />
	&lt;snip... run program that will write errors to $7&gt;<br />
<br />
	ClearErrors<br />
<br />
<br />
; ConfigureJavaWebStart returned a non-zero error code.<br />
ExceptionError:<br />
  	MessageBox MB_OK &quot;Error: Could not configure program. Please contact System Administrator&quot;<br />
	MessageBox MB_OK &quot;Looking for error file : $7&quot;<br />
	IfFileExists $7 ErrorFileFound ErrorUnknown<br />
<br />
ErrorFileFound:<br />
	MessageBox MB_OK &quot;Error file found&quot;<br />
	FileOpen $4 $7 &quot;r&quot;<br />
	IfErrors ErrorUnknown<br />
	StrCpy $6 &quot;&quot;<br />
<br />
ErrorLoop:<br />
	FileRead $4 $5<br />
	IfErrors ErrorLoopDone<br />
	DetailPrint $5<br />
	StrCpy $6 &quot;$6$5&quot;<br />
	Goto ErrorLoop<br />
<br />
ErrorLoopDone:<br />
	ClearErrors<br />
	FileClose $7<br />
	IfErrors CloseError CloseNoError<br />
<br />
CloseError:<br />
	MessageBox MB_OK &quot;Error: could not close file $7&quot;<br />
<br />
CloseNoError:<br />
	MessageBox MB_OK &quot;ERROR: Could not configure JWS with correct JRE.  Error is $6&quot;<br />
	MessageBox MB_OK &quot;Deleting file $7&quot;<br />
	ClearErrors<br />
	Delete $7<br />
	IfErrors DeleteError DeleteNoError<br />
<br />
DeleteError:<br />
	MessageBox MB_OK &quot;Error deleting file $7&quot;<br />
<br />
DeleteNoError:<br />
	SetErrors<br />
	Goto InstallDone<br />
<br />
<br />
<br />
Thanks for any help.<br />
Beth</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">2nd March 2002, 00:12</div></div><div class="posttext">I see your problem - you should be passing $4 (file handle) to FileClose, not $7 (file name).FileClose $4HTH!<br />
<br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bbh</div><div class="date">2nd March 2002, 00:22</div></div><div class="posttext">Thank you!!!!<br />
I stared at that forever and couldn't see the problem.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>