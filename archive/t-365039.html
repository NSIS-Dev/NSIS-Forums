<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Hex Strings and lpBuffer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Hex Strings and lpBuffer NSIS Discussion" />
	
	<title> Hex Strings and lpBuffer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Hex Strings and lpBuffer</div>
<hr />
<div class="pda"><a href="t-365039.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=365039">Hex Strings and lpBuffer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zeeh3</div><div class="date">30th June 2013, 14:47</div></div><div class="posttext">When using System::Call 'Kernel32::ReadFile(i r0, i r2, i r1, *i .r3, i 0)', $2 is a lpBuffer, a pointer to the buffer that receives the data read from a file. Is it possible to pass a hexadecimal string to a buffer like $2, instead of creating a file, writing the hexadecimal string to the file, reading the file to fill the $2 buffer and erasing the file to do what I want?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">30th June 2013, 17:37</div></div><div class="posttext">There may be a more elegant way than how I do it, but here's a working example:<br />
Outfile BufferStuffer.exe<br />
Var Buffer<br />
Var DataSize<br />
<br />
!macro FillBuffer Data # Hex string expected for Data<br />
StrLen $DataSize ${Data}<br />
IntOp $DataSize $DataSize / 2<br />
System::Alloc $DataSize<br />
Pop $Buffer<br />
StrCpy $9 0<br />
IntOp $0 $9 * 2<br />
StrCpy $0 ${Data} 2 $0<br />
System::Call &quot;*$Buffer(&amp;v$9, &amp;i1 '0x$0')&quot;<br />
IntOp $9 $9 + 1<br />
IntCmp $9 $DataSize 0 -4<br />
!macroend<br />
!define FillBuffer &quot;!insertmacro FillBuffer&quot;<br />
<br />
<br />
       Function .onInit<br />
${FillBuffer} &quot;497420776F726B7321&quot;<br />
FileOpen $R0 &quot;$EXEDIR\doesitwork.txt&quot; w<br />
System::Call &quot;kernel32::WriteFile(i R0, i $Buffer, i $DataSize, *i.r1, i '') i.r0&quot;<br />
FileClose $R0<br />
System::Free $Buffer<br />
IntCmp $0 0 +2<br />
IntCmp $1 $Datasize +2<br />
MessageBox MB_OK|MB_ICONSTOP &quot;Error writing file.&quot;<br />
Abort<br />
FunctionEnd<br />
<br />
Section Blank<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zeeh3</div><div class="date">30th June 2013, 20:03</div></div><div class="posttext">Thank you, I will try it :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zeeh3</div><div class="date">2nd July 2013, 16:44</div></div><div class="posttext">It works fine, but is pretty slow with big strings.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">2nd July 2013, 17:59</div></div><div class="posttext">Well, one System call for every byte of data, you can't expect turbo performance if you need to process more than a few KB. It's not appropriate for that. Maybe someone knows a way to fill the buffer in a single pass, I don't, apart from the one you know as well - ReadFile. I don't know what your goal is, is it patching of some sort? A FileWriteByte loop should be faster than my example, no buffer required. Vpatch would be a perfect solution, if applicable.<br />
<br />
[Edit] Did some testing: a FileWriteByte variant turned out approx. 3x faster for the same input/output.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">2nd July 2013, 18:39</div></div><div class="posttext">You're processing a load of 511B chunks because of maxstrlen, that's what the question about iterating through gflags in that other thread was about, right? Packing it all up in a binary file you'd extract at runtime and load with ReadFile really would be way faster and 'cleaner'.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zeeh3</div><div class="date">2nd July 2013, 21:27</div></div><div class="posttext">Yes, that's correct. I am now getting the data as a resource.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">2nd July 2013, 23:20</div></div><div class="posttext">RCData? Nice solution.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>