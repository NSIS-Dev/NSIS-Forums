<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Calling a custom plugin from the Uninstall section fails, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Calling a custom plugin from the Uninstall section fails NSIS Discussion" />
	
	<title> Calling a custom plugin from the Uninstall section fails [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Calling a custom plugin from the Uninstall section fails</div>
<hr />
<div class="pda"><a href="t-156770.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=156770">Calling a custom plugin from the Uninstall section fails</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">CoffeeMug</div><div class="date">19th November 2003, 09:40</div></div><div class="posttext">Hello everyone. I've created a custom C++ plugin to perform certain specialized tasks during the install and uninstall. The plugin currently has two functions, one called from the main installation section, the other called from the Uninstall section. Calling the function from the main section works like a charm. However, when I call the cleanup function from the Uninstall section the code never executes. The script compiles fine and uninstall completes successfully but the uninstaller doesn't attempt to execute the cleanup function from the plugin. I am using the latest development snapshot. Here's a piece of code from my script:<br />
<br />
Section Uninstall<br />
  ; Uninstall the trigger<br />
  InstallHelper::CleanupFunc   ; &lt;--- this never executes<br />
<br />
  Delete &quot;$INSTDIR\${PRODUCT_NAME}.url&quot; ; &lt;--- this executes fine<br />
  ; ..........<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th November 2003, 12:04</div></div><div class="posttext">Plug-ins in uninstaller sections should work fine. Are you sure there is no bug in your code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CoffeeMug</div><div class="date">19th November 2003, 16:16</div></div><div class="posttext">Although one can never be 100% sure, however it is a rather simple example... I have a plugin with a TestFunction that displays a message box on entry. When I call TestFunction from the main section the message box displays fine. When I call it from Uninstall, it simply does not display. All other code in Uninstall executes (native NSIS functions). I removed all other code just to see if this works, and it fails. I do not have any conditional code in my script...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th November 2003, 16:22</div></div><div class="posttext">Works fine for me. Using the NSIS latest version? Can you post an example with plug-in and source?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CoffeeMug</div><div class="date">19th November 2003, 17:15</div></div><div class="posttext">I used the latest development snapshot (downloaded it yesterday). I attach the code for the installer to this post. There's nothing special about the plugin, especially considering that the same function is called from the main section perfectly fine. Perhaps the plugin is &quot;removed&quot; by the uninstall script before it tries to call it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2003, 17:20</div></div><div class="posttext">The plug-in is bundled inside the uninstaller data block, it can't be removed. How do you test that the plug-in has not been called?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CoffeeMug</div><div class="date">19th November 2003, 17:33</div></div><div class="posttext">Well, the function does some cleanup in the database and when I check the db the cleanup has never occured. It does clean up the database when I call it from the main section. After a while I just started popping up message box on entry.<br />
<br />
The plugin dll uses one of the dlls I install (DBHelper.dll). Perhaps the function isn't called because I remove DBHelper.dll before I call the the plugin? I tried to move the call to the plugin above the &quot;Delete&quot; commands but it doesn't seem to have any effect.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2003, 17:43</div></div><div class="posttext">Make sure all the DLLs that plug-in depends on are in somewhere the loader can find them. The best place is the current working directory which is set using SetOutPath.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CoffeeMug</div><div class="date">19th November 2003, 18:16</div></div><div class="posttext">Could you please give a little more information? Do you mean at the time I compile the install script or during the actual runtime of install/uninstall on a target machine?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">19th November 2003, 18:27</div></div><div class="posttext">If you DLL files depend on other files, make sure that the loader can find them.<br />
<br />
If you store these files in the current folder (which you can set using SetOutPath), the loader will find them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CoffeeMug</div><div class="date">19th November 2003, 22:11</div></div><div class="posttext">Placing a SetOutPath in the uninstall section and setting it to the $INSTDIR worked like a charm. Thank you very much for your help. NSIS is an amazing piece of software. I am doing some custom work for managing COM+ applications through NSIS (creating a COM+ application, installing a component, etc.) and when I have time I'll try to donate the code. Keep up the good work!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>