<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" !tempfile problem on WIndows 2003 server, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  !tempfile problem on WIndows 2003 server NSIS Discussion" />
	
	<title> !tempfile problem on WIndows 2003 server [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  !tempfile problem on WIndows 2003 server</div>
<hr />
<div class="pda"><a href="t-275912.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275912">!tempfile problem on WIndows 2003 server</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">14th August 2007, 19:00</div></div><div class="posttext">I get a !tempfile: unable to create temporary file. error on a Windows 2003 machine. I checked all the environment variables and everything is fine. Does anyone know what else could cause the problem?<br />
<br />
I executed a small program on the machine which throws this error and this passed too. This code is from NSIS script.cpp file.<br />
<br />
char buf[MAX_PATH], buf2[MAX_PATH];<br />
<br />
        GetTempPath(MAX_PATH, buf);<br />
        if (!GetTempFileName(buf, &quot;nst&quot;, 0, buf2))<br />
        {<br />
          ERROR_MSG(&quot;!tempfile: unable to create temporary file.\n&quot;);<br />
          return PS_ERROR;<br />
        }<br />
buf and buf2 were populated correctly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th August 2007, 20:57</div></div><div class="posttext">Can you add a call to GetLastError() in the code and see what it says?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">15th August 2007, 03:56</div></div><div class="posttext">Sorry i did not explain it properly, the problem is i get this error only when i am compiling the script  otherwise it works fine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">15th August 2007, 17:03</div></div><div class="posttext">This the last few lines before the compilation failed<br />
<br />
!insertmacro: InstallLib<br />
!tempfile: unable to create temporary file.<br />
Error in macro __InstallLib_Helper_GetVersion on macroline 4 Error in macro InstallLib on macroline 86<br />
<br />
When i execute the code as mentioned above it does not fail :(<br />
<br />
Does anybody have any idea??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th August 2007, 21:29</div></div><div class="posttext">I was talking about NSIS's source code. I've added the call and uploaded the compiled makensis.exe to:<br />
<br />
http://stashbox.org/33659/makensis.zip</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">17th August 2007, 02:37</div></div><div class="posttext">Thanks for the file. I am getting a Error code 5 (Access is denied) for the return of GetLastError. I checked it up on net why this would happen but no luck. <br />
<br />
Please help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">17th August 2007, 06:49</div></div><div class="posttext">Ok i hacked into the source code and added few statements to figure out what exactly is going wrong<br />
<br />
Here is the output of the analysis<br />
<br />
!tempfile: unable to create temporary file.<br />
GetLastError:5<br />
Output Of GetTempPath: C:\WINDOWS\<br />
Output of GetTempFileName: urrentVersion\SharedDLLs<br />
<br />
I still cant figure out how can an MSDN function fail like this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th August 2007, 09:16</div></div><div class="posttext">It would seem GetTempFileName doesn't not allow creating temporary files directly under C:\Windows. Start by verifying the TEMP and TMP environment variables and make sure they're not set to C:\Windows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">18th August 2007, 03:41</div></div><div class="posttext">The problem is that the user is unable to create temp files in c:\windows. I am confused since the the variables<br />
<br />
TMP=C:\Documents and Settings\User\LocalSettings\Temp<br />
TEMP=C:\Documents and Settings\User\LocalSettings\Temp<br />
USEPROFILE=C:\Documents and Settings\User<br />
<br />
are set correctly. Do you know why would the query for these variables fail? According to MSDN only when query to all of these variables fail windows directory would returned :(<br />
<br />
Could you please help me out.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th August 2007, 09:53</div></div><div class="posttext">Maybe makensis somehow runs as a limited user with no access to those directories?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th August 2007, 12:07</div></div><div class="posttext">Try running it with FileMon (http://www.microsoft.com/technet/sysinternals/utilities/filemon.mspx) and see what happens when it tries to create the temporary file in %TEMP%.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">18th August 2007, 15:31</div></div><div class="posttext">The problem is the installer build is an automated process run by another user(i dont have access to the account, Hence faing a lot of problems). Hence i am unable to use the Filemon on that machine. Is there an other way?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">18th August 2007, 16:00</div></div><div class="posttext">I think i have found the problem. The GetTempPath is trying to query the registry for the TMP,TEMP and USERPROFILE keys. Since the user does not have any permissions to do so, all the calls to it are failing. <br />
<br />
Hence the only option left is to return the windows directory(according to MSDN), since this also fails due to permissions issue of the user. the whole thing fails miserably:(. <br />
<br />
Does makensis require all the builds to be run under Administrator mode(it doesnt mention this anywhere(correct me if I am wrong))? Is it possible to change the code for tempfile, delfile and execute(other bunch of stuff which does require administrator rights) to reflect all these?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th August 2007, 16:46</div></div><div class="posttext">No, it doesn't require administrator privileges. It does, however, makes the reasonable assumption that it could create temporary files in the temporary directory. If this is an automated system, you can make it set the TEMP environment variable and point it to somewhere the user can write to.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">18th August 2007, 17:03</div></div><div class="posttext">This is a guest account. Is it possible to set a TEMP variable for this account?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th August 2007, 17:26</div></div><div class="posttext">Of course. Every user can have environmental variables.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darthvader</div><div class="date">18th August 2007, 17:53</div></div><div class="posttext">I just have a feeling that GetTempPath queries the registry for the environment variables. Hence its failing for the guest account. Could you please comment on this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th August 2007, 17:56</div></div><div class="posttext">The guest user has its own registry hive which it can query. No user can function without a hive. I have a guest account on my computer and it works perfectly fine with its own temporary directory.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>