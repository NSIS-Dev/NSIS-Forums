<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" At un-install remove renamed left over shortcuts best method?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  At un-install remove renamed left over shortcuts best method? NSIS Discussion" />
	
	<title> At un-install remove renamed left over shortcuts best method? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  At un-install remove renamed left over shortcuts best method?</div>
<hr />
<div class="pda"><a href="t-261212.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=261212">At un-install remove renamed left over shortcuts best method?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">6th December 2006, 16:04</div></div><div class="posttext">SUBJECT:<br />
At un-install remove renamed left over shortcuts best method? <br />
<br />
ISSUE:<br />
If an NSIS installer installs an application, it is easy at un-install to remove a known by name shortcut. However is the shortcut is renamed by a users the .lnk name changed and the un-install of the shortcut will not be performed.<br />
<br />
WISH:<br />
Like to have for a un-install improvement:<br />
<br />
Look for shortcut and recursively delete shortcuts from a known application name e.g. &quot;MYAPP.EXE&quot;<br />
- All users Startmenu <br />
- All users Desktop<br />
- Current user Startmenu<br />
- Current users Desktop<br />
<br />
* NSIS function that performs and looks like the following:<br />
<br />
$0 = set Target to look for e.g. &quot;MYAPP.EXE&quot;<br />
$1 = $SM value via NSIS or $DESKTOP values via NSIS<br />
$2 = Current user or all users<br />
<br />
...<br />
<br />
Function un.removeleftovershortcuts $0 $1 $2<br />
<br />
  ;PSEUDOCODE: <br />
   ;; Look for shortcut and recursively delete shortcuts<br />
      ; compare lastpart .lnk target with \+$0 with first stripping part after $0 <br />
      ; if same then this is a shortcut to delete<br />
      <br />
   ; If found delete Shortcut via dialogbox ask Delete? Y/N <br />
   ; If silent install always delete/ nverdelete via a set boolean<br />
   ; Refresh desktop if needed<br />
   <br />
   ; REAL CODE HERE PLZ :up:<br />
   <br />
FunctionEnd<br />
<br />
...<br />
<br />
I searched the Wiki but found no solution, maybe combine and adjust a lot of codesnippets from:<br />
http://nsis.sourceforge.net/Category:Disk%2C_Path_%26_File_Functions<br />
<br />
But which are the best to start with? :confused:<br />
<br />
QUESTION:<br />
Anyone already once created such a script, be so kind as to share.<br />
<br />
Somehow I have the feeling the &quot;Locate&quot; NSIS Script <br />
 http://nsis.sourceforge.net/Locate<br />
could solve my problem but somehow cannot figure it out... maybe I should add sleep to the code ? ;)<br />
<br />
TIA</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">7th December 2006, 12:48</div></div><div class="posttext">To difficult? &gt;:-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">7th December 2006, 18:58</div></div><div class="posttext">Hi onad,<br />
Just some thought, have no idea if could be done.<br />
A method with system plugin that retrieves the target property from shortcuts in combination with locate plugin. E.g. Get shortcuts from desktop one by one with locate, pass each one to system plugin to retrieve the target, compare the retrieved target with a defined string, and remove every shortcut that has target myApp.exe.<br />
Another thought, some kind of modification on MoreInfo plugin to be able ro retrieve the target property, again in combination with locate plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th December 2006, 19:09</div></div><div class="posttext">The ShellLink (http://nsis.sourceforge.net/ShellLink_plug-in) plug-in allows you to retrieve the properties of shortcuts. You could scan through all shortcuts and compare their target to your target.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">7th December 2006, 19:51</div></div><div class="posttext">Thanks to kichik (always :-)) here is something:<br />
OutFile &quot;locate_shellink.exe&quot;<br />
ShowInstDetails show<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro Locate<br />
<br />
!define MyApp &quot;$PROGRAMFILES\Mozilla Firefox\firefox.exe&quot;<br />
<br />
Section<br />
       SetShellVarContext all<br />
	StrCpy $R0 ''<br />
<br />
	${Locate} &quot;$DESKTOP&quot; &quot;/L=F /M=*.lnk /S=0B&quot; &quot;LocateCallback&quot;<br />
<br />
	IfErrors 0 +2<br />
	MessageBox MB_OK &quot;Error&quot; IDOK +2<br />
	MessageBox MB_OK &quot;$$R0={$R0}&quot;<br />
SectionEnd<br />
<br />
<br />
Function LocateCallback<br />
	ShellLink::GetShortCutTarget &quot;$R9&quot;<br />
	Pop $0<br />
<br />
	StrCmp '$0' '${MyApp}' 0 end<br />
	StrCpy &quot;$R0&quot; &quot;$R9&quot;<br />
	StrCpy &quot;$0&quot; StopLocate<br />
<br />
	end:<br />
	Push &quot;$0&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">8th December 2006, 00:38</div></div><div class="posttext">Just tried another instance, uses RecFind.nsh and I think it is more accurate. <br />
Besides it removes repeated wrong name shortcuts in a snap.<br />
# Execute compiled installer then manual create some copies of the generated<br />
# shortcut on desktop, then execute uninstaller and watch the action.<br />
OutFile &quot;RecFind_shellink.exe&quot;<br />
InstallDir '$EXEDIR'<br />
ShowInstDetails show<br />
ShowUninstDetails show<br />
<br />
!include 'RecFind.nsh'<br />
<br />
  !define ICON_SEARCH '$DESKTOP\$R0\$R1'<br />
  !define MyApp '$1\nsis.exe'<br />
  !define Uninst 'unshortcut.exe'<br />
<br />
Section Install<br />
;  SetShellVarContext all<br />
  ReadRegStr &quot;$1&quot; HKLM &quot;Software\NSIS&quot; &quot;&quot;<br />
   createshortcut '$DESKTOP\nsis.lnk' '${MyApp}'<br />
    ShellLink::SetShortCutWorkingDirectory '$DESKTOP\nsis.lnk' '$1'<br />
    Pop $0<br />
   messagebox mb_ok 'errorlevel $0'<br />
   writeuninstaller '$INSTDIR\${Uninst}'<br />
sectionend<br />
<br />
Section Uninstall<br />
;  SetShellVarContext all<br />
  ReadRegStr &quot;$1&quot; HKLM &quot;Software\NSIS&quot; &quot;&quot;<br />
  Delete '$DESKTOP\nsis.lnk'<br />
   ${RecFindOpen} '$DESKTOP' '$R0' '$R1'<br />
     ${RecFindFirst}<br />
       ; DetailPrint '${ICON_SEARCH}'<br />
	 ShellLink::GetShortCutTarget '${ICON_SEARCH}'<br />
	 Pop $0<br />
	 StrCmp '$0' '${MyApp}' 0 end<br />
	 messagebox mb_ok '${ICON_SEARCH}'<br />
         Delete '${ICON_SEARCH}'<br />
             end:<br />
     ${RecFindNext}<br />
   ${RecFindClose}<br />
  Delete '$INSTDIR\${Uninst}'<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">8th December 2006, 09:15</div></div><div class="posttext">Great! Thanks Red Wine and Kichik,<br />
<br />
I will try the solutions and see if they fit in my full goal.<br />
<br />
Note that I still did not took an extra nap  ;) since I was a  really busy creating a plugin to solve the problem. I think I still will finish that plugin and post it to a Wikipage anyhow.<br />
<br />
I also discovered that I did something wrong resolving the  shortcuttarget and storing the value :((, so that is why shelllink and locate combination did not work at all during my tryouts...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">8th December 2006, 14:23</div></div><div class="posttext">Tried it, and the second solution really works good and fast almost without enlarging the intaller size, thanks!<br />
<br />
No need for yet another plugin ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">9th December 2006, 11:06</div></div><div class="posttext">Well, I got a step deeper.<br />
Following example removes normal/renamed shortcut(s) from desktop and also removes normal/renamed shortcus from Start Menu along with the created Start Menu folder even if the folder is renamed and/or moved-copied elsewhere inside Start Menu!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th December 2006, 11:49</div></div><div class="posttext">A little bit enhanced in order to manage shortcuts that have been copied/renamed from current user to all users and vice versa :-)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>