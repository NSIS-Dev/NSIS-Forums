<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" PRODUCT_DIR_REGKEY on 64-bit, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  PRODUCT_DIR_REGKEY on 64-bit NSIS Discussion" />
	
	<title> PRODUCT_DIR_REGKEY on 64-bit [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  PRODUCT_DIR_REGKEY on 64-bit</div>
<hr />
<div class="pda"><a href="t-362421.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=362421">PRODUCT_DIR_REGKEY on 64-bit</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">29th May 2013, 17:42</div></div><div class="posttext">I have a few defines in my nsi script.  I am making a universal installer so it installs if there is a 64-bit system/32-bit system, it would do so dynamically.<br />
<br />
For the most part, it works, except for the registry part.<br />
<br />
I already did the setregview 64 in the appropiate spots, but it is failing because of:<br />
<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
How can I get it so the define changes based on 64-bit?<br />
<br />
SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\${PROGRAM_NAME}&quot; <br />
<br />
So essentially, I want to do this<br />
<br />
<br />
${If} ${RunningX64}<br />
!define PRODUCT_UNINST_KEY &quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\${PROGRAM_NAME}&quot;<br />
${Else}<br />
!define PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
${End}<br />
<br />
<br />
And that is obviously an illegal command.  How can I follow the law and make this legal?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">29th May 2013, 18:49</div></div><div class="posttext">Make a (global) variable for it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">29th May 2013, 19:20</div></div><div class="posttext">Make a (global) variable for it.<br />
<br />
In other words, comment out the two defines, and use a global variable elsewhere in the code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">29th May 2013, 19:26</div></div><div class="posttext">What I also don't get is, in <br />
!define PRODUCT_DIR_REGKEY &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\foo.EXE&quot; already has it in the Wow64 folder, and I did not knowingly put it there, so why would it not do that for the uninstall stuff?<br />
<br />
essentially...<br />
<br />
<br />
Section -Post<br />
# lalala<br />
${If} ${RunningX64}<br />
  SetRegView 64<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
${Else}<br />
  SetRegView 32<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;${PRODUCT_DIR_REGKEY}&quot; &quot;&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
${EndIf}<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">29th May 2013, 19:28</div></div><div class="posttext">Yes, create a global variable (e.g. $Product_Uninst_Key), replace &quot;!define&quot; with &quot;StrCpy $Product_Uninst_Key&quot;, and use $Product_Uninst_Key elsewhere in your code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">29th May 2013, 20:38</div></div><div class="posttext">can I just put it here at the end oft he defines?<br />
<br />
;  Reserve files<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
Var /GLOBAL PRODUCT_UNINST_KEY64 &quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\${PROGRAM_NAME}&quot;<br />
Var /GLOBAL PRODUCT_UNINST_KEY &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
<br />
BrandingText &quot;${PRODUCT_PUBLISHER}&quot;<br />
;  MUI end ------<br />
<br />
Function .onInit</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">29th May 2013, 21:10</div></div><div class="posttext">Yes, but you cannot assign values there.<br />
<br />
So:;  Reserve files<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
Var /GLOBAL Product_Uninst_Key<br />
BrandingText &quot;${PRODUCT_PUBLISHER}&quot;<br />
;  MUI end ------<br />
Function .onInit<br />
...<br />
Section -Post<br />
# lalala<br />
${If} ${RunningX64}<br />
  SetRegView 64<br />
  StrCpy $Product_Uninst_Key &quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\${PROGRAM_NAME}&quot;<br />
${Else}<br />
  SetRegView 32<br />
  StrCpy $Product_Uninst_Key &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
${EndIf}<br />
WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} $Product_Uninst_Key&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
;etc<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">29th May 2013, 21:43</div></div><div class="posttext">Yeah.. after i saw what you wrote and reread the documentation i now realise why the strcpy was necessary.  so i did<br />
<br />
Section -Post<br />
# lalala<br />
<br />
# define the variables<br />
var /GLOBAL unkey64<br />
StrCpy $unkey64 &quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
var /GLOBAL unkey32<br />
StrCpy $unkey32 &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
var /GLOBAL regkey64<br />
StrCpy $regkey64 &quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\App Paths\Foo.exe&quot;<br />
var /GLOBAL regkey32 <br />
StrCpy $regkey32 &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\Foo.exe&quot;<br />
<br />
<br />
${If} ${RunningX64}<br />
  SetRegView 64<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$regkey64&quot; &quot;&quot; &quot;$INSTDIR\Foo.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\Foo.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
${Else}<br />
  SetRegView 32<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$regkey32&quot; &quot;&quot; &quot;$INSTDIR\Foo.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\Foo.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
${EndIf}<br />
SectionEnd<br />
<br />
<br />
should this be the only other area that this is needed?<br />
<br />
the only other area where i explicitly mention the 64 thing was right before the main function, so i guess the end of oninit function was<br />
<br />
<br />
# foofoo<br />
install:<br />
${If} ${RunningX64}<br />
      SetRegView 64<br />
    StrCpy $INSTDIR &quot;$PROGRAMFILES64\${PRODUCT_NAME}&quot;<br />
    SetOutPath &quot;$PROGRAMFILES64\${PRODUCT_NAME}&quot;<br />
${Else}<br />
      SetRegView 32<br />
    StrCpy $INSTDIR &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
    SetOutPath &quot;$PROGRAMFILES\${PRODUCT_NAME}&quot;<br />
${EndIf}<br />
<br />
<br />
mainly, i had issues with it actually putting the 64-bit code into program files, as it kept putting it into x86.  originally we did that, bc our code wasn't 64-bit compliant yet, but eventually we did it, but in the past we did just programfiles32 or something. i had thought forcing it on 64 would force it to go program files regardless of architecture.<br />
<br />
anyway, the above does what i want, with at least to the registry, thanks again for all your help...just wanting to make sure that if you can think of other areas that i may had missed off the top of hte head w/o seeing the entire project, but any other areas i should look out for you think?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st May 2013, 12:54</div></div><div class="posttext">The reason your registry went under Wow6432Node is because NSIS is 32-bit and Windows 64 automatically redirects registry key operations for 32-bit processes to that key. There is no need to hard-code the Wow6432Node registry key path specially for Windows 64-bit, you are just over-complicating things. Just use the regular key path and do not change SetRegView.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">13th November 2013, 20:23</div></div><div class="posttext">I know it has been awhile but I am back at it.  So to clarify, I don't need to use any setregview, no wow6432node, just use the regular HKLM and it should automagically go into the correct spots within the registry?  i think its working fine in Win 7 and Win 8 x86/x64, but not Win XP / Vista x64.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th November 2013, 02:48</div></div><div class="posttext">i think its working fine in Win 7 and Win 8 x86/x64, but not Win XP / Vista x64.<br />
<br />
What do you mean? Does it not show up in the control panel?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th November 2013, 02:51</div></div><div class="posttext">You should only use SetRegView 64 and $programfiles64 when installing a 64bit application, if your application is always 32bit you should just pretend that 64bit Windows does not exist...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">14th November 2013, 16:06</div></div><div class="posttext">No no, I mean its a universal installer, so if its on 64 bit it does 64-bit install, if on 32-bit, it does 32-bit install...<br />
<br />
<br />
${If} ${RunningX64}<br />
  SetRegView 64<br />
  # the strcpy is illegal outside of scope<br />
  var /GLOBAL unkey64<br />
  var /GLOBAL regkey64<br />
<br />
  StrCpy $unkey64 &quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
  StrCpy $regkey64 &quot;SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\App Paths\foo.exe&quot;<br />
  <br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$regkey64&quot; &quot;&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr HKLM &quot;$unkey64&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
<br />
${Else}<br />
  SetRegView 32<br />
  var /GLOBAL unkey32<br />
  var /GLOBAL regkey32<br />
<br />
  StrCpy $unkey32 &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;<br />
  StrCpy $regkey32 &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\foo.exe&quot;<br />
<br />
  WriteUninstaller &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$regkey32&quot; &quot;&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;DisplayIcon&quot; &quot;$INSTDIR\foo.EXE&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;URLInfoAbout&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
  WriteRegStr HKLM &quot;$unkey32&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">14th November 2013, 16:07</div></div><div class="posttext">So...<br />
<br />
XP x32 - OK<br />
XP x64 -No good<br />
Vista x32 - OK<br />
Vista x64 - No good<br />
Windows 7 x32 - OK<br />
Windows 7 x64 - OK<br />
Windows 8 x64 - not tested but it worked before<br />
<br />
Meaning that it isnt going into the registry at all</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th November 2013, 16:52</div></div><div class="posttext">Don't use Wow6432Node, only SetRegView?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">14th November 2013, 17:18</div></div><div class="posttext">So, just use setregview and for the HKLM location use Software\Microsoft\Windows\CurrentVersion\App Paths for both?<br />
it should use node automatically by redirection?  why would it work for the newer stuff but not the older stuff?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">15th November 2013, 02:41</div></div><div class="posttext">SetRegView 64 turns off registry redirection so you are writing to the real 64 bit registry, normally a 32bit application on 64bit Windows writes to a 32bit part of the registry (but some keys are redirected and/or reflected depending on the Windows version)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">15th November 2013, 14:17</div></div><div class="posttext">Weird.<br />
<br />
It is something def with vista then<br />
<br />
somehting like this<br />
<br />
<br />
${If} ${RunningX64}<br />
  SetRegView 64<br />
${Else}<br />
  SetRegView 32<br />
${EndIf}<br />
MessageBox MB_OK &quot;inst: $INSTDIR&quot;   # debugging jw<br />
<br />
<br />
in win 7 x64 instdir is populated.  on vista x64 it is not.  <br />
so it is writing to the registry properly now, it is detecting what i need to detect, but the part where it tries to find the unist in instdir to rm the previous version if detected, is detecting it, but isnt running the uninst.exe bc instdir seems to be blank.  and not sure why.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">15th November 2013, 14:58</div></div><div class="posttext">You can use Process Monitor to view registry operations...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">15th November 2013, 19:13</div></div><div class="posttext">not too sure why but this now works, but uninst.exe is now orphaned after it uninstalls previous prior to install new version.  <br />
<br />
;  Run the uninstaller<br />
uninst:<br />
${If} ${RunningX64}<br />
  SetRegView 64<br />
   ReadRegStr $R0 HKLM \<br />
  &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}&quot;\<br />
  &quot;UninstallString&quot;<br />
 <br />
  ${GetParent} $R0 $R1<br />
  strcpy $INSTDIR $R1<br />
  ExecWait '&quot;$INSTDIR\uninst.exe&quot; _?=$INSTDIR' $R1<br />
<br />
   StrCmp $R1 0 no_remove_uninstaller ; Success? If so we are done...<br />
   Abort ; Uninstaller was canceled or failed, we cannot continue<br />
${Else}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">16th November 2013, 02:26</div></div><div class="posttext">Running with _?= does not delete the uninstaller, you must delete manually...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">19th November 2013, 14:14</div></div><div class="posttext">Well, I have delete the uinst.exe in the uninst section, it orphans it when it is run beforehand, during the installer, it checks for previous version, it uninstalls it, then continues.  so if i run uininstall manuall there is no orphan.  my understanding the _? just doesnt copy the uninstall.  this is where i am confused.  as the execwait $R1 bit i thought fixed it as my previous version of software i had no orphans in that circumstance and now it is back again for some strange reason.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">19th November 2013, 15:00</div></div><div class="posttext">Normally the uninstaller will copy itself to %temp% and run that copy with _?=, it basically does Exec (not wait) on that copy. The reason is so that the uninstaller in $instdir can be deleted. _?= sets $instdir to that path so code in the uninstaller like RMDir $instdir will work correctly.<br />
<br />
To fully uninstall and use ExecWait you also need Delete &quot;$INSTDIR\uninst.exe&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">19th November 2013, 19:19</div></div><div class="posttext">problem is, i did that, but it will then delete the uninstaller after installing and when it needs to be uninstalled later, it cant because the file has been deleted.  where do i put the delete uninst so it doesnt do so?  perhaps my logic was poor.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">19th November 2013, 20:21</div></div><div class="posttext">Right after execwait...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">19th November 2013, 20:40</div></div><div class="posttext">uninst:<br />
;  Exit codes are documented in Appendix D in the help file.<br />
   ExecWait '&quot;$INSTDIR\uninst.exe&quot; _?=$INSTDIR' $R2<br />
;   Delete &quot;$INSTDIR\uninst.exe&quot;<br />
   StrCmp $R2 0 no_remove_uninstaller ; Success? If so we are done...<br />
   Abort ; Uninstaller was canceled or failed, we cannot continue<br />
<br />
<br />
I did do that, and I had to comment it out because it deleted the uinstaller after uninstalling it if it was previously installed so the new uninstaller i guess never generates it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th November 2013, 05:57</div></div><div class="posttext">WriteUninstaller &quot;$INSTDIR\uninst.exe&quot; will create the new uninstaller and this of course has to happen later in your script...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">20th November 2013, 14:22</div></div><div class="posttext">WriteUninstaller is there much further down in the code.  <br />
As mentioned, maybe I wasn't being clear enough and for that I apologise.  <br />
<br />
1.  If the software detects a previous version, it asks do you want to uninstall previous version first.  It is mandatory.  If they say yes, it will uninstall.  When that uninstall is done, it keeps itself behind.  If they say no, obviously it aborts.<br />
<br />
2.  After the software is installed and the user runs the uininstaller, the same one thats in the $instdir\${product_name} folder nothing is orphaned.<br />
<br />
3.  If I actually run the orphaned file that got left behind from step one, it will erase itself.<br />
<br />
4.  If I add the delete instdir right after execute, it will erase the uinstaller and not show up again, though I have not recently tested this, this is what occurred last time when I first brought up this thread.  since I never changed nsis I don't see why anything is different this time.  I should however try again anyway, but still doesn't explain why it gets orphaned as the uinstaller does in fact erase itself under normal circumstances, it just doesn't do it when it is doing it from the execwait rather than be initiated by control panel/explorer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th November 2013, 15:16</div></div><div class="posttext">I don't know how many times I can try to explain this but I'll try one more time.<br />
<br />
Running the uninstaller with  _?= is never going to delete the uninstaller .exe.<br />
<br />
When running the uninstaller without  _?= what happens is:<br />
<br />
 uninst.exe is copied to %temp%\~un.exe<br />
 uninst.exe does Exec %temp%\~un.exe _?=instdir and quits<br />
 %temp%\~un.exe performs uninstall including deleting uninst.exe in $instdir</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jweinraub</div><div class="date">20th November 2013, 15:40</div></div><div class="posttext">Anders,<br />
<br />
Thank you for this explanation now I am more understanding what is going on.  Thank you for your patience and apologise for not being clear for understanding what was going on.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>