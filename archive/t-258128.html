<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Create Schema on mySQL when finising installation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Create Schema on mySQL when finising installation NSIS Discussion" />
	
	<title> Create Schema on mySQL when finising installation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Create Schema on mySQL when finising installation</div>
<hr />
<div class="pda"><a href="t-258128.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258128">Create Schema on mySQL when finising installation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">23rd October 2006, 08:58</div></div><div class="posttext">I have read many information about MySQL on this forum but I still do not find my answer.<br />
When finishing to install mysql, how can I create a schema  and  run file script on command line  to finish my install by NSIS language.<br />
In my opinion, I do with it but it does not work<br />
eg:<br />
<br />
Section Run_Scrilpt<br />
execDos::exec /NOUNLOAD /TIMEOUT=10000 '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; --user=root --password=passroot --database=openim &lt; &quot;e:\server\openim.sql&quot; &quot;&quot;'<br />
Pop $0 # return value<br />
MessageBox MB_OK &quot;Exit code $0&quot;<br />
SectionEnd<br />
 <br />
<br />
I am worry about password of root because I do not know it during user to set up our application.<br />
Somebody used to see this problem please help me!!!<br />
Big thank for someone can reply me!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">23rd October 2006, 11:18</div></div><div class="posttext">I also check all cases which I read on forum but It can not still run.<br />
<br />
<br />
ExpandEnvStrings $0 %COMSPEC%<br />
<br />
Exec '&quot;$0&quot; /C &quot;$PROGRAMFILES\MySql\MySql server 5.0\bin\mysql.exe&quot; &quot;openim&quot; &lt; &quot;$INSTDIR\openim.sql&quot;'<br />
Pop $0 # return value<br />
<br />
MessageBox MB_OK &quot;Exit code $0&quot;<br />
<br />
<br />
I only need to create database and run script on mysql!!!!<br />
Please help me!!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">24th October 2006, 05:36</div></div><div class="posttext">I am sorry for self reply. Now I can run a script on MySQL. However, I do not know how to create a database (schema).<br />
How can I do with it????<br />
Your help will be really appreciated!!!<br />
Thank alot,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">OrdiMars</div><div class="date">24th October 2006, 17:46</div></div><div class="posttext">TO create the database test use (and then go into the db):<br />
<br />
CREATE DATABASE IF NOT EXISTS `test` ;<br />
USE test;<br />
<br />
You may want also have a look at MySQL doc:<br />
http://dev.mysql.com/doc/refman/5.0/en/create-database.html<br />
<br />
Cheers,<br />
L@u</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">25th October 2006, 02:18</div></div><div class="posttext">Thank OrdiMars alot,<br />
<br />
I know this command but I do not know how to write it on NSIS because I must run this on MySQL.<br />
On mysql,I must run MySQL.exe and type password to use mySQL after that I can make this command run.<br />
But I do not know password of root or user who install MySQL and write it.That is the first problem which I see.<br />
The second how can I run thing to create database on this. These document on forum also show how to run application on command line not in mysql.<br />
<br />
Your help is very useful for me!<br />
Best regard,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">25th October 2006, 04:40</div></div><div class="posttext">You can use InstallOptions to write a custom page that prompts the user for the MySQL root password. Then create a temporary schema file and execute MySQL twice:<br />
Page custom CustomPage CustomFinish &quot; - MySQL root password&quot;<br />
Var $mysql_root_pass<br />
<br />
Function CustomPage<br />
  InitPluginsDir<br />
  SetOutPath $PLUGINSDIR<br />
  File mysql.ini ; refer to InstallOptions docs for instructions for creating this file<br />
  InstallOptions::initDialog /NOUNLOAD &quot;$PLUGINSDIR\mysql.ini&quot;<br />
  InstallOptions::show<br />
FunctionEnd<br />
<br />
Function CustomFinish<br />
  ; NOTE: Be sure to bhange &quot;field 1&quot; to the field number!<br />
  ReadINIStr $mysql_root_pass $PLUGINSDIR\mysql.ini &quot;Field 1&quot; State<br />
  StrCmp $mysql_root_pass &quot;&quot; 0 +3<br />
    MessageBox MB_YESNO|MB_ICONQUESTION &quot;You didn't type a MySQL root password, \<br />
        connection to MySQL may fail, do you want to continue?&quot; IDYES +2<br />
      Abort ; returns to the page<br />
FunctionEnd<br />
<br />
Section<br />
  GetTempFileName $R0<br />
  FileOpen $R1 $R0 &quot;w&quot;<br />
  FileWrite $R1 &quot;CREATE DATABASE IF NOT EXISTS openim;$\r$\n&quot;<br />
  FileClose $R1<br />
  ; First round: create the database<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; \<br />
    --user=root --password=$mysql_root_pass &lt; &quot;$R0&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
  ; Second round: run the schema<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; \<br />
    --user=root --password=passroot --database=openim &lt; &quot;e:\server\openim.sql&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
SectionEnd<br />
(edit: it may be worthy to note that I'm a little rusty at NSIS, so there might be some minor problems with this code; I couldn't test it because everything's booted into Linux at the moment)<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">25th October 2006, 05:22</div></div><div class="posttext">Thank you very much dandaman32,<br />
I know my requirement is not suitable but I am studying about InstallOptions and many things I do not understand clearly :( .<br />
Could you please send me the format file mysql.ini?<br />
I am so sorry for my inconvenience because I still do not study it well.<br />
Thank alot,<br />
:D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">31st October 2006, 10:35</div></div><div class="posttext">Section &quot;RunDB&quot;<br />
  GetTempFileName $R0<br />
  FileOpen $R1 $R0 &quot;w&quot;<br />
  FileWrite $R1 &quot;CREATE DATABASE IF NOT EXISTS openim;$\r$\n&quot;<br />
  FileClose $R1<br />
  ; First round: create the database<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; \<br />
    --user=root --password=$mysql_root_pass &lt; &quot;$R0&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
  ; Second round: run the schema<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; \<br />
    --user=root --password=passroot --database=openim &lt; &quot;e:\server\openim.sql&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
SectionEnd <br />
 <br />
Now I can understand InstallOption. When I read your code, i  have some confuse.<br />
<br />
<br />
  ; First round: create the database<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; \<br />
    --user=root --password=$mysql_root_pass &lt; &quot;$R0&quot; &quot;&quot;'<br />
<br />
<br />
<br />
It runs $R0 to create database on mysql.When I create database on mysql, we must pass 3 function<br />
+ Run mysql.exe<br />
+ Enter password<br />
+ Type this command &quot;create database if not exists openim&quot;<br />
Firstly, your command run mysql.exe and I can not understand  how to work.<br />
Although I try your code,I does not work. I aslo change many times but I do not work.<br />
eg:<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; --password=$mysql_root_pass &lt; &quot;$R0&quot; &quot;&quot;'<br />
If someone use to see this problem, please tell me!!!<br />
Thank you very much for your help,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">4th November 2006, 09:03</div></div><div class="posttext">dandaman32 posted:<br />
<br />
Page custom CustomPage CustomFinish &quot; - MySQL root password&quot;<br />
Var $mysql_root_pass<br />
<br />
Function CustomPage<br />
  InitPluginsDir<br />
  SetOutPath $PLUGINSDIR<br />
  File mysql.ini ; refer to InstallOptions docs for instructions for creating this file<br />
  InstallOptions::initDialog /NOUNLOAD &quot;$PLUGINSDIR\mysql.ini&quot;<br />
  InstallOptions::show<br />
FunctionEnd<br />
<br />
Function CustomFinish<br />
  ; NOTE: Be sure to bhange &quot;field 1&quot; to the field number!<br />
  ReadINIStr $mysql_root_pass $PLUGINSDIR\mysql.ini &quot;Field 1&quot; State<br />
  StrCmp $mysql_root_pass &quot;&quot; 0 +3<br />
    MessageBox MB_YESNO|MB_ICONQUESTION &quot;You didn't type a MySQL root password, \<br />
        connection to MySQL may fail, do you want to continue?&quot; IDYES +2<br />
      Abort ; returns to the page<br />
FunctionEnd<br />
<br />
Section<br />
  GetTempFileName $R0<br />
  FileOpen $R1 $R0 &quot;w&quot;<br />
  FileWrite $R1 &quot;CREATE DATABASE IF NOT EXISTS openim;$\r$\n&quot;<br />
  FileClose $R1<br />
  ; First round: create the database<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; \<br />
    --user=root --password=$mysql_root_pass &lt; &quot;$R0&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
  ; Second round: run the schema<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    '&quot;$PROGRAMFILES\MySQL\MySQL Server 5.0\bin\mysql.exe&quot; \<br />
    --user=root --password=passroot --database=openim &lt; &quot;e:\server\openim.sql&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
SectionEnd<br />
<br />
Now I can understand what you want to help me,however I run your script. It always displays Error 1<br />
I do not know Error 1 to appear where, so I can not repair it. <br />
However, I change your code with this:<br />
<br />
<br />
Section <br />
StrCpy $passroot_sql '123456789'<br />
GetTempFileName $R0<br />
  FileOpen $R1 $R0 &quot;w&quot;<br />
  FileWrite $R1 &quot;CREATE DATABASE IF NOT EXISTS openim;$\r$\n&quot;<br />
  FileClose $R1<br />
  ; First round: create the database<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \ 'mysql.exe --user=root --password=$passroot_sql &lt; &quot;$R0&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
  ; Second round: run the schema<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    'mysql.exe --user=root --password=$passroot_sql --database=openim &lt; &quot;e:\server\openim.sql&quot; &quot;&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
SectionEnd<br />
<br />
<br />
It announces Error -14 <br />
I can not repair it.<br />
Somebody see this problem, please help me,<br />
I try my best to study NSIS during many weeks but now I am still not good.<br />
Your help is very useful for me,<br />
Thank a lot,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th November 2006, 13:40</div></div><div class="posttext">You have extra quotes after &quot;e:\server\openim.sql&quot;. Remove them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">6th November 2006, 01:23</div></div><div class="posttext">Thank Kichik,<br />
Kichik posted<br />
You have extra quotes after &quot;e:\server\openim.sql&quot;. Remove them.<br />
 <br />
<br />
I try with both but It can not work and show  ERROR -14<br />
<br />
Section <br />
StrCpy $passroot_sql '123456789'<br />
GetTempFileName $R0<br />
  FileOpen $R1 $R0 &quot;w&quot;<br />
  FileWrite $R1 &quot;CREATE DATABASE IF NOT EXISTS openim;$\r$\n&quot;<br />
  FileClose $R1<br />
  ; First round: create the database<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \ 'mysql.exe --user=root --password=$passroot_sql &lt; &quot;$R0&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
  ; Second round: run the schema<br />
  execDos::exec /NOUNLOAD /TIMEOUT=10000 \<br />
    'mysql.exe --user=root --password=$passroot_sql --database=openim &lt; &quot;e:\server\openim.sql&quot;'<br />
  Pop $0 # return value<br />
  MessageBox MB_OK &quot;Exit code $0&quot;<br />
SectionEnd<br />
<br />
<br />
Actually, I only want to run two command on console window:<br />
<br />
C:\&gt;mysql.exe --user=root --password=$passroot_sql &lt; e:\db.txt           //to create database <br />
C:\&gt;mysql.exe --user=root --password=$passroot_sql &lt; e:\openim.sql       //to run file script <br />
<br />
I try my best to run with all exec,execwait, execshell, ExecCmd::Exec.... but I can not work well.<br />
Please someone help me,<br />
Thank a lot,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2006, 06:57</div></div><div class="posttext">You should consult MySQL's documentation to find out what error -14 means.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">6th November 2006, 08:26</div></div><div class="posttext">Thank Kichik,<br />
I will find it on mysql forum.And now I can do it well. <br />
In my application, I use passdialog to get password of mysql to create schema or run sql. But I do not know password which user input is right or wrong.<br />
I want to check it but in my code, I wrote it on file bat and run it. Also, I use nsExec::exec to hide window console. <br />
How can I know error happen when user type wrong password?<br />
Console window is hidden so how can I display error for them to know or anything else to know?<br />
Thank you for your help,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">6th November 2006, 10:13</div></div><div class="posttext">Make a test schema (.sql file) that creates a database with a name that's total gibberish and then drops it again. Then use Pop after you call nsExec to get the return code of mysql.exe. Use StrCmp to check the status code - 0 is success, anything else is failure. AFAIK that's the only reliable way to check the password.<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sunlight112</div><div class="date">6th November 2006, 10:58</div></div><div class="posttext">Thank dandaman32 for your reply,<br />
I also think about this and do with it already. But I can pop error. I do not know why<br />
In file schema.sql &quot;create database if not exists OpenIM&quot;<br />
My code here:<br />
<br />
  $passroot is got from dialog password<br />
   FileOpen $1 $0 &quot;w&quot;<br />
   FileWrite $1 &quot;@echo off$\r$\n&quot;<br />
   StrCpy $2 $TEMP 2     ##C:<br />
   FileWrite $1 &quot;$2$\r$\n&quot;<br />
   FileWrite $1 &quot;mysql.exe --user=root --password=$passroot &lt; c:\openim\home\database\schema.sql$\r$\n&quot;<br />
   FileClose $1<br />
   nsExec::exec &quot;$0&quot;<br />
   Pop $0<br />
   IfErrors 0 NoAbort<br />
   MessageBox MB_OK &quot;Error code $0&quot;<br />
   Detailprint &quot;Create database is error&quot;<br />
   NoAbort:<br />
   Delete $0<br />
   Detailprint &quot;Create database successful&quot;<br />
<br />
I think I have some mistakes in my code, if you see it, please tell me!!!<br />
Thank alot,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">6th November 2006, 11:22</div></div><div class="posttext">-14 comes from ExecDos errors enum:<br />
enum ERROR_CODES {<br />
   ERR_DUPHANDLE = -16,<br />
   ERR_CREATEPIPE,<br />
   ERR_CREATEPROC,<br />
...<br />
&quot;Could not create process&quot; means Win API CreateProcess() call returned error. So I guess mysql is not in path for the last script.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>