<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RegisterTlb Function (for those who need this), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RegisterTlb Function (for those who need this) NSIS Discussion" />
	
	<title> RegisterTlb Function (for those who need this) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RegisterTlb Function (for those who need this)</div>
<hr />
<div class="pda"><a href="t-178315.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=178315">RegisterTlb Function (for those who need this)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">28th April 2004, 21:40</div></div><div class="posttext">It took me some time to learn System.dll and make this working, so I post it for anyone who may need this.<br />
<br />
My motivation was to register stdole2.tlb as I install VB6 runtimes. Microsoft's installers (PDW and VSI) seem to register this, too. The NSIS archive tipp (how to install vb6 runtime) does not register this file, supplied version of UpgradeDll isn't able to do this.<br />
<br />
It seems that on my PC (Windows XP) running this causes stdole2.tlb to be registered for the first time. But VB6 apps (and VB6 and Office) are installed already so I don't know whether it really is necessary or a &quot;should do&quot;. Nevertheless: Here's the function including call example. I didn't test it widely yet but regarding to MSDN it should work on Win95 and newer. <br />
<br />
<br />
...  <br />
  Push &quot;C:\WINDOWS\System32\stdole2.tlb&quot;<br />
  Call RegisterTlb<br />
...<br />
<br />
<br />
Function RegisterTlb<br />
  Exch $R0  ; save old R0 and get filename as R0<br />
  Push $R1  ; save R1<br />
  Push $R2  ; save R2<br />
  ; now register TLB file R0<br />
  StrCpy $R1 0 ; init R1 with 0 (maybe not neccessary)<br />
  System::Call &quot;Oleaut32::LoadTypeLib(w, *i) i (R0, R1R1) .R2&quot;<br />
  ; R2 contains result, 0 if ok<br />
  IntCmp $R2 0 cont<br />
  LogText &quot;LoadTypeLib returned $R2 with $R0&quot;<br />
  ; debug MessageBox MB_OK &quot;LoadTypeLib returned $R2 with $R0&quot;<br />
  Goto exit<br />
cont:<br />
  ; now R1 contains pointer to typelib<br />
  System::Call &quot;Oleaut32::RegisterTypeLib(i, w, i) i (R1, R0, 0) .R2&quot;<br />
  ; R2 contains result, 0 if ok<br />
  IntCmp $R2 0 exit<br />
  LogText &quot;RegisterTypeLib returned $R2 with $R1, $R0&quot;  <br />
  ; debug MessageBox MB_OK &quot;RegisterTypeLib returned $R2 with $R1, $R0&quot; <br />
exit:<br />
  ;; debug MessageBox MB_OK &quot;RegisterTlb: all ok&quot;<br />
  Pop $R2 ; R2 restore<br />
  Pop $R1 ; R1 restore<br />
  Pop $R0 ; R0 restore<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st May 2004, 20:48</div></div><div class="posttext">Please create an archive (http://nsis.sf.net/archive) page for it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>