<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" CreateShortCuts for all users, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  CreateShortCuts for all users NSIS Discussion" />
	
	<title> CreateShortCuts for all users [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  CreateShortCuts for all users</div>
<hr />
<div class="pda"><a href="t-245963.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=245963">CreateShortCuts for all users</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">lievencardoen</div><div class="date">11th May 2006, 15:54</div></div><div class="posttext">I create some shortcuts like this : <br />
<br />
SetShellVarContext current<br />
    ReadINIStr $3 &quot;$PLUGINSDIR\user.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
    StrCmp $3 &quot;1&quot; 0 +2<br />
       SetShellVarContext all<br />
CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\CitePlus1.lnk&quot; &quot;$INSTDIR\CitePlus1.exe&quot; &quot;&quot; &quot;$INSTDIR\deboeck.ICO&quot;<br />
CreateShortcut &quot;$DESKTOP\CitePlus1.lnk&quot; &quot;$INSTDIR\CitePlus1.exe&quot; &quot;&quot; &quot;$INSTDIR\deboeck.ICO&quot;<br />
CreateShortcut &quot;$QUICKLAUNCH\CitePlus1.lnk&quot; &quot;$INSTDIR\CitePlus1.exe&quot; &quot;&quot; &quot;$INSTDIR\deboeck.ICO&quot;<br />
<br />
In uninstaller I delete them like this : <br />
<br />
SetShellVarContext current<br />
    ReadINIStr $3 &quot;$PLUGINSDIR\user.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
    StrCmp $3 &quot;1&quot; 0 +2<br />
       SetShellVarContext all<br />
    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\$(^UninstallLink).lnk&quot;<br />
    Delete /REBOOTOK $INSTDIR\uninstall.exe<br />
    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\CitePlus1.lnk&quot;<br />
    Delete /REBOOTOK &quot;$DESKTOP\CitePlus1.lnk&quot;<br />
    Delete /REBOOTOK &quot;$QUICKLAUNCH\CitePlus1.lnk&quot;<br />
<br />
When SetShellVarContext is set to current, the shortcuts are deleted, but when SetShellVarContext is set to all, only the shortcut in the quicklaunch bar is deleted (apparently because NSIS doesn't create the quicklaunch shortcut in All Users but in Current User).<br />
<br />
Any ideas?<br />
<br />
Lieven</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th May 2006, 16:04</div></div><div class="posttext">My guess is that your &quot;$PLUGINSDIR\user.ini&quot; will only exist for the installer.<br />
<br />
Rather than check the value in the INI file, check if the shortcuts exist for either user and then delete.<br />
<br />
E.g.<br />
<br />
!macro Delete File<br />
SetShellVarContext current<br />
IfFileExists &quot;${File}&quot; +2<br />
SetShellVarContext all<br />
Delete &quot;${File}&quot;<br />
!macroend<br />
<br />
!insertmacro Delete &quot;$SMPROGRAMS\$StartMenuGroup\$(^UninstallLink).lnk&quot;<br />
<br />
; ...etc<br />
<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lievencardoen</div><div class="date">11th May 2006, 16:04</div></div><div class="posttext">SetShellVarContext current<br />
ReadINIStr $3 &quot;$PLUGINSDIR\user.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
StrCmp $3 &quot;1&quot; 0 +2<br />
SetShellVarContext all<br />
<br />
Apparently, the uninstaller doesn't now the state anymore of Field 3... If you install, is it possible to save variables so you can access them when you uninstall?<br />
<br />
Lieven</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lievencardoen</div><div class="date">11th May 2006, 16:17</div></div><div class="posttext">Wonderfull! thx!<br />
<br />
Is there a way to save a variable so you can access it in the uninstaller?<br />
<br />
Lieven</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th May 2006, 17:58</div></div><div class="posttext">You'd have to save its value in the registry or in an INI file.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>