<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ITypeLib-&gt;GetLibAttr &amp; TLIBATTR  structure, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ITypeLib-&gt;GetLibAttr &amp; TLIBATTR  structure NSIS Discussion" />
	
	<title> ITypeLib-&gt;GetLibAttr &amp; TLIBATTR  structure [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ITypeLib-&gt;GetLibAttr &amp; TLIBATTR  structure</div>
<hr />
<div class="pda"><a href="t-321838.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321838">ITypeLib-&gt;GetLibAttr &amp; TLIBATTR  structure</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">gringoloco023</div><div class="date">20th August 2010, 23:09</div></div><div class="posttext">In addition to yesterdays tread about 'Playing with COM', I am hoping to get some help.<br />
<br />
I'm trying to get the TLIBATTR  structure (http://msdn.microsoft.com/en-us/library/ms891296.aspx) by loading a dll. I'm able to get the GUID but non of the other members.<br />
There must be something wrong with the way I allocate the TLIBATTR  structure ?<br />
<br />
<br />
!define COM_CallMethod &quot;!insertmacro _COM_CallMethod &quot;<br />
!macro _COM_CallMethod _vto _ParamsDecl _IFacePtr _Params<br />
	System::Call `${_IFacePtr}-&gt;${_vto}${_ParamsDecl} ${_Params}`<br />
!macroend<br />
<br />
!define ITypeLib-&gt;GetLibAttr &quot;${COM_CallMethod}7 (i)i. &quot;<br />
!define ITypeLib-&gt;ReleaseTLibAttr &quot;${COM_CallMethod}12 ()i. &quot;<br />
<br />
Section<br />
	StrCpy $0 msxml.dll<br />
	System::Call Oleaut32::LoadTypeLib(wr0,*i.r1)<br />
<br />
	System::call *(g,i,i,i,i,i)i.R0 ;  TLIBATTR  structure<br />
	${ITypeLib-&gt;GetLibAttr} $1 (R0)<br />
<br />
	System::Call *$R0(g.R1,i.R2,i.R3,i.R4,i.R5,i.R6)<br />
	${ITypeLib-&gt;ReleaseTLibAttr} $1 ()<br />
	System::free $R0<br />
<br />
	DetailPrint 'TLIBATTR structure'<br />
	DetailPrint GUID=$R1<br />
	DetailPrint CLID=$R2<br />
	DetailPrint SYSKIND=$R3<br />
	DetailPrint MajorVerNum=$R4<br />
	DetailPrint MinorVerNum=$R5<br />
	DetailPrint LibFlags=$R6<br />
SectionEnd<br />
<br />
<br />
Or use the attached file for a complete test script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st August 2010, 00:32</div></div><div class="posttext">The TLIBATTR struct is probably more like *(&amp;g16,i,i,&amp;i2,&amp;i2,&amp;i2), but that is only half your problem. GetLibAttr will allocate the struct for you...<br />
<br />
!include LogicLib.nsh<br />
<br />
!define IUnknown-&gt;Release &quot;${COM_CallMethod}2 ()i. &quot;<br />
!define ITypeLib-&gt;GetLibAttr &quot;${COM_CallMethod}7 (*i)i. &quot;<br />
!define ITypeLib-&gt;ReleaseTLibAttr &quot;${COM_CallMethod}12 (i)i. &quot;<br />
<br />
Section<br />
    System::Call 'Oleaut32::LoadTypeLib(w &quot;msxml.dll&quot;,*i.r1)i.r0'<br />
    ${If} $0 = 0<br />
    	${ITypeLib-&gt;GetLibAttr} $1 '(.R0).r0'<br />
    	${If} $0 = 0<br />
    		System::Call '*$R0(&amp;g16.R1,i.R2,i.R3,&amp;i2.R4,&amp;i2.R5,&amp;i2.R6)'<br />
    		${ITypeLib-&gt;ReleaseTLibAttr} $1 (R0)<br />
    		<br />
    		DetailPrint 'TLIBATTR structure'<br />
    		DetailPrint GUID=$R1<br />
    		DetailPrint CLID=$R2<br />
    		DetailPrint SYSKIND=$R3<br />
    		DetailPrint MajorVerNum=$R4<br />
    		DetailPrint MinorVerNum=$R5<br />
    		DetailPrint LibFlags=$R6<br />
    	${EndIf}<br />
    	${IUnknown-&gt;Release} $1 ()<br />
    ${EndIf}<br />
SectionEnd  <br />
<br />
Edit: The fact that you need &amp;g16 and not just g in a struct is probably a system plugin bug</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gringoloco023</div><div class="date">21st August 2010, 06:07</div></div><div class="posttext">Thanx for that, it works great now !<br />
 it must have been the &amp;g16 thing what was bugging me :(</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>