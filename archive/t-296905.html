<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsdialogs and installer icon, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsdialogs and installer icon NSIS Discussion" />
	
	<title> nsdialogs and installer icon [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsdialogs and installer icon</div>
<hr />
<div class="pda"><a href="t-296905.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=296905">nsdialogs and installer icon</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">WebMatze</div><div class="date">4th September 2008, 12:11</div></div><div class="posttext">Hello, i'm trying to do something but i dont know if it is possible.<br />
<br />
Here is my question: Is it possible in a custom page generated with nsdialogs to have the installer icon ?<br />
<br />
I know it is possible to load external images (like in the welcome.nsi example), but i would like to have on my page the icon i specified with the Icon instruction at the beginning of my script.<br />
<br />
If it is possible, could someone tell me how to do ?<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2008, 12:20</div></div><div class="posttext">You can call LoadIcon to load that icon. The C code that does it is:LoadIcon(GetModuleHandle(0), MAKEINTRESOURCE(103))</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WebMatze</div><div class="date">5th September 2008, 16:31</div></div><div class="posttext">thanks for your answer,<br />
 i will try it ... and i'll let you know if it works</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WebMatze</div><div class="date">5th September 2008, 16:39</div></div><div class="posttext">Hello,<br />
<br />
I tried the follwing:<br />
<br />
<br />
nsDialogs::CreateControl /NOUNLOAD STATIC ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS}|${SS_ICON} 0 0 0 109u 193u &quot;&quot;<br />
Pop $IMAGECTL<br />
<br />
System::Call 'user32::LoadIcon(GetModuleHandle(0), MAKEINTRESOURCE(103))i.s'<br />
Pop $IMAGE<br />
	<br />
SendMessage $IMAGECTL ${STM_SETICON} ${IMAGE_ICON} $IMAGE<br />
<br />
<br />
but it doesn't work...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2008, 17:06</div></div><div class="posttext">That's because I gave you the C code, not System::Call code.System::Call kernel32::GetModuleHandle(i0)i.s<br />
System::Call user32::LoadIcon(is,i103)i.s<br />
Pop $IMAGE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WebMatze</div><div class="date">5th September 2008, 20:20</div></div><div class="posttext">Hello, and thanks again for your help<br />
<br />
i tried:<br />
System::Call kernel32::GetModuleHandle(i0)i.s<br />
System::Call user32::LoadIcon(is,i103)i.s<br />
Pop $IMAGE<br />
${NSD_CreateIcon} 0 0 100% 12u $IMAGE<br />
<br />
without success<br />
<br />
if i replace createicon by createlabel i get a random number.<br />
<br />
do you have an idea ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th September 2008, 21:32</div></div><div class="posttext">That random number is the icon handle. The fifth parameter sets the text, not the icon. Use STM_SETICON as you've originally done.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WebMatze</div><div class="date">6th September 2008, 06:30</div></div><div class="posttext">Hello,<br />
<br />
i retried with the original code:<br />
<br />
nsDialogs::CreateControl /NOUNLOAD STATIC ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS}|${SS_ICON} 0 0 0 109u 193u &quot;&quot;<br />
Pop $IMAGECTL<br />
<br />
System::Call kernel32::GetModuleHandle(i0)i.s<br />
System::Call user32::LoadIcon(is,i103)i.s<br />
Pop $IMAGE<br />
	<br />
SendMessage $IMAGECTL ${STM_SETICON} ${IMAGE_ICON} $IMAGE<br />
<br />
<br />
but without success. What am i doing wrong ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th September 2008, 06:40</div></div><div class="posttext">You're passing the wrong parameters for STM_SETICON.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">WebMatze</div><div class="date">6th September 2008, 10:02</div></div><div class="posttext">Thanks Kichik, that works<br />
<br />
Here is the working code:<br />
<br />
<br />
nsDialogs::CreateControl /NOUNLOAD STATIC ${WS_VISIBLE}|${WS_CHILD}|${WS_CLIPSIBLINGS}|${SS_ICON} 30 30 0 109u 193u &quot;&quot;<br />
Pop $IMAGECTL<br />
<br />
System::Call kernel32::GetModuleHandle(i0)i.s<br />
System::Call user32::LoadIcon(is,i103)i.s<br />
Pop $0<br />
	<br />
SendMessage $IMAGECTL ${STM_SETICON} $0 &quot;&quot;<br />
 <br />
<br />
Thanks again for your help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">26th December 2008, 14:32</div></div><div class="posttext">Hi, I want to do the same thing, but I want to stay away from using the system plug-in (installer + 11kb, not cool for the wiki). I also want to avoid writing a single function plugin with a single line of code to do the same job (my IDE isn't installed ATM). Using NSIS code is preferable, but adding the code to nsDialogs would be even better.<br />
<br />
[edit] I am updating my InstallSpider User Interface  to Modern UI 2 and I don't really want to include the system plugin with it.<br />
Code fragment from SpiderBanner plugin (most of it):<br />
<br />
SendMessage([hwnd], STM_SETICON, (WPARAM)(HICON)LoadIcon(GetModuleHandle(NULL), MAKEINTRESOURCE(103)), 0);</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2008, 18:16</div></div><div class="posttext">nsDialogs is built to be used along with System. It has no capabilities of its own to load images, yet.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">26th December 2008, 19:11</div></div><div class="posttext">If you can't beat it, join it. I have whipped up a patch that loads icons from both a file and the installer (using system plugin).<br />
<br />
[edit] And I am now 60% ubuntu linux, 20% debian and 20% WinXP, and loving it!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th December 2008, 20:44</div></div><div class="posttext">What's wrong with NSD_SetImage? Or is it especially for icons where NSD_SetImage works just for bitmaps? If it's the second, it'd be better to extract the commons into another macro instead of duplicating the code between the two.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">27th December 2008, 03:17</div></div><div class="posttext">Its the latter, and no, there is not much in common (API call wise). I found that if LR_DEFAULTSIZE is omitted, the icon is 16x16, so I added it for 32x32 icons to appear. Plus, the image type is specifically for icons, so they have the IMAGE_ICON type in the arguments.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">27th December 2008, 04:08</div></div><div class="posttext">So, something like this then?<br />
<br />
[edit] I have noticed the coding of the macros is different to most macros I have seen. These ones ask for a return value, much like standard nsis functions, and pops the handle at the end of the macro. Different, but a bit easier to follow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">27th December 2008, 10:22</div></div><div class="posttext">You can go even further by passing IMAGE_BITMAP and IMAGE_ICON as another parameter to the macro. No need to write the LoadImage line more than once.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">28th December 2008, 12:48</div></div><div class="posttext">Yeah I could. This kind of programming is new to me, coding the most common code (in the script) so that its only coded once.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">28th December 2008, 13:23</div></div><div class="posttext">Well, I optimized the code to a point where if you made any changes, the code gets worse (I hope, although including LR_DEFAULTSIZE is debatable).<br />
<br />
[edit] I did say in an earlier post why I put it in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th December 2008, 13:47</div></div><div class="posttext">you probably don't want LR_DEFAULTSIZE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th January 2009, 22:00</div></div><div class="posttext">Could you submit it along with the appropriate documentation changes as a patch?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">12th January 2009, 07:48</div></div><div class="posttext">I should also add a 'ClearImage' macro for clearing icons. I will post here again once uploaded to the patch tracker.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">12th January 2009, 08:58</div></div><div class="posttext">Patch is now added in the patch tracker.<br />
<br />
http://sourceforge.net/tracker/?group_id=22049&amp;atid=373087</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aluna</div><div class="date">26th January 2009, 17:14</div></div><div class="posttext">Hello<br />
<br />
I'm new to NSIS coding.<br />
I have a custom page and want it to give the same look of other built-in pages, i.e, with installer icon at top left (I'm not using modern ui).<br />
<br />
So, I downloaded your patch but don't know who to use it.<br />
Could you please, post sample code?<br />
<br />
Thank you<br />
Regards<br />
<br />
Alex</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>