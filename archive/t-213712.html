<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Building CVS with scons, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Building CVS with scons NSIS Discussion" />
	
	<title> Building CVS with scons [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Building CVS with scons</div>
<hr />
<div class="pda"><a href="t-213712.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=213712">Building CVS with scons</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">20th April 2005, 22:07</div></div><div class="posttext">I hope someone can point me in the right direction here...<br />
<br />
I've just downloaded + installed Python 2.4, scons 0.96.1, Microsoft SDK (core package), Microsoft Visual C++ Toolkit 2003.<br />
<br />
When I attempt to compile using details here:<br />
<br />
http://nsis.sourceforge.net/index.php?id=2&amp;backPID=2&amp;tt_news=22<br />
<br />
...this is what I'm getting:<br />
<br />
C:\NSIS&gt;scons<br />
scons: Reading SConscript files ...<br />
Using default tools configuration<br />
AttributeError: SConsEnvironment instance has no attribute 'RES':<br />
  File &quot;SConstruct&quot;, line 94:<br />
    target = SConscript(dirs = 'Source/exehead', build_dir = build_dir, duplicat<br />
e = 0, exports = exports)<br />
  File &quot;C:\Python24\scons\SCons\Script\SConscript.py&quot;, line 581:<br />
    return apply(method, args, kw)<br />
  File &quot;C:\Python24\scons\SCons\Script\SConscript.py&quot;, line 508:<br />
    return apply(_SConscript, [self.fs,] + files, {'exports' : exports})<br />
  File &quot;C:\Python24\scons\SCons\Script\SConscript.py&quot;, line 239:<br />
    exec _file_ in stack[-1].globals<br />
  File &quot;Source\exehead\SConscript&quot;, line 77:<br />
    res = env.RES(resources)<br />
<br />
and with the mstoolkit parameter<br />
<br />
C:\NSIS&gt;scons MSTOOLKIT=yes<br />
scons: Reading SConscript files ...<br />
Using Microsoft tools configuration<br />
Checking for main() in C library gdi32... yes<br />
Checking for main() in C library user32... yes<br />
Checking for main() in C library version... yes<br />
Checking for main() in C library pthread... no<br />
Checking for main() in C library stdc++... no<br />
Checking for main() in C library iconv... no<br />
Checking for main() in C library libiconv... no<br />
<br />
scons: *** Multiple ways to build the same target were specified for: AdvSplash.<br />
dll<br />
File &quot;Contrib\AdvSplash\SConscript&quot;, line 18, in ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">21st April 2005, 02:50</div></div><div class="posttext">Try to update your Scons to version 0.96.90 to see if that happens again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">21st April 2005, 09:49</div></div><div class="posttext">I had already tried that actually, but the 0.96.1 seemed to be the better of the two! Anyway, here's the log from that version<br />
<br />
C:\NSIS&gt;scons<br />
scons: Reading SConscript files ...<br />
TypeError: cannot concatenate 'str' and 'NoneType' objects:<br />
  File &quot;SConstruct&quot;, line 47:<br />
    prefix = GetLaunchDir() + os.sep<br />
  File &quot;C:\Python24\scons\SCons\Script\SConscript.py&quot;, line 532:<br />
    env = self.factory()<br />
  File &quot;C:\Python24\scons\SCons\Script\SConscript.py&quot;, line 512:<br />
    default_env = SCons.Defaults.DefaultEnvironment()<br />
  File &quot;C:\Python24\scons\SCons\Defaults.py&quot;, line 65:<br />
    _default_env = apply(SCons.Environment.Environment, args, kw)<br />
  File &quot;C:\Python24\scons\SCons\Memoize.py&quot;, line 815:<br />
    klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />
  File &quot;...\SCons\Memoizer-init-lambda&lt;C:\Python24\scons\SCons\Memoize.py&gt;&quot;, lin<br />
e 1:<br />
    None<br />
  File &quot;C:\Python24\scons\SCons\Memoize.py&quot;, line 774:<br />
    apply(actual_init, (self,)+args, kw)<br />
  File &quot;C:\Python24\scons\SCons\Memoize.py&quot;, line 1:<br />
    &quot;&quot;&quot;Memoizer<br />
  File &quot;C:\Python24\scons\SCons\Memoize.py&quot;, line 777:<br />
    apply(super(cls, self).__init__, args, kw)<br />
  File &quot;C:\Python24\scons\SCons\Memoize.py&quot;, line 815:<br />
    klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />
  File &quot;...\SCons\Memoizer-init-lambda&lt;C:\Python24\scons\SCons\Environment.py&gt;&quot;,<br />
 line 465:<br />
    None<br />
  File &quot;C:\Python24\scons\SCons\Memoize.py&quot;, line 774:<br />
    apply(actual_init, (self,)+args, kw)<br />
  File &quot;C:\Python24\scons\SCons\Environment.py&quot;, line 511:<br />
    apply_tools(self, tools, toolpath)<br />
  File &quot;C:\Python24\scons\SCons\Environment.py&quot;, line 129:<br />
    env.Tool(tool, toolpath)<br />
  File &quot;C:\Python24\scons\SCons\Environment.py&quot;, line 1055:<br />
    tool(self)<br />
  File &quot;C:\Python24\scons\SCons\Tool\__init__.py&quot;, line 87:<br />
    apply(self.generate, ( env, ) + args, kw)<br />
  File &quot;C:\Python24\scons\SCons\Tool\default.py&quot;, line 40:<br />
    for t in SCons.Tool.tool_list(env['PLATFORM'], env):<br />
  File &quot;C:\Python24\scons\SCons\Tool\__init__.py&quot;, line 382:<br />
    c_compiler = FindTool(c_compilers, env) or c_compilers[0]<br />
  File &quot;C:\Python24\scons\SCons\Tool\__init__.py&quot;, line 301:<br />
    if t.exists(env):<br />
  File &quot;C:\Python24\scons\SCons\Tool\intelc.py&quot;, line 278:<br />
    top = get_intel_compiler_top()<br />
  File &quot;C:\Python24\scons\SCons\Tool\intelc.py&quot;, line 142:<br />
    top = get_intel_registry_value('ProductDir', version, abi)<br />
  File &quot;C:\Python24\scons\SCons\Tool\intelc.py&quot;, line 69:<br />
    K = 'Software\\Intel\\Compilers\\C++\\' + version + '\\'+abi.upper()<br />
<br />
Same for both with and without the MSTOOLKIT=yes parameter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st April 2005, 16:09</div></div><div class="posttext">If you're using the toolkit you must use MSTOOLKIT=yes. It might not work because it can not find cl.exe in the path. Try running scons using the Visual C++ Toolkit 2003 Command Prompt. The toolkit installs a link to it on the start menu and in its installation directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">21st April 2005, 19:18</div></div><div class="posttext">Ok well I finally kinda got it working after a lot of messing around (not knowing what I'm doing!).<br />
<br />
MakeLangId wont complile because it cant find AFXRES.H or WINRES.h.<br />
<br />
halibut fails to compile because the environment paths aren't set up correctly. The MSTOOLKIT bit is effectivly ignored in the SConscript in its folder as only the default environment is used.<br />
<br />
You also need to ensure hhc is installed and its folder added to the 'path' environment variable.<br />
<br />
Download it from here:<br />
<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/htmlhelp/html/hwMicrosoftHTMLHelpDownloads.asp<br />
<br />
contrib/startmenu also wont compile. Needs afxres.h and winres.h too.<br />
<br />
<br />
Once all that's out of the way, I'm left with this:<br />
<br />
C:\NSIS&gt;scons MSTOOLKIT=yes<br />
scons: Reading SConscript files ...<br />
Using Microsoft tools configuration<br />
Checking for main() in C library gdi32... yes<br />
Checking for main() in C library user32... yes<br />
Checking for main() in C library version... yes<br />
Checking for main() in C library pthread... no<br />
Checking for main() in C library stdc++... no<br />
Checking for main() in C library iconv... no<br />
Checking for main() in C library libiconv... no<br />
Using Microsoft tools configuration<br />
scons: done reading SConscript files.<br />
scons: Building targets ...<br />
scons: *** Source `Contrib\AdvSplash\AdvSplash' not found, needed by target `build\AdvSplash\AdvSplash.map'.  Stop.<br />
scons: building terminated because of errors.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">21st April 2005, 19:45</div></div><div class="posttext">It's now also very easy to build NSIS using the free Visual C++ Toolkit 2003 and Platform SDK.Kichik just forgot to mention about the &quot;HTML Help Workshop&quot; to compile the docs.<br />
<br />
Now, about the problem, it's maybe because you only have the core of Platform SDK. I downloaded all packages, and the latest update for WinXP SP2, and the compilation works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">21st April 2005, 20:23</div></div><div class="posttext">Ok, it seems the beta of scons works ok but the old one wont.<br />
<br />
I'm doing this build on a clean install of Windows 2003, so chances are, others will need to do them too.<br />
<br />
I expect you lot have already got loads of bits installed which is making life easier for you!<br />
<br />
Copying over the missing header files from MakeLangId and StartMenu isn't a big deal but I'd like the 'Documentation' chunk of the SContruct file fixed so that the correct environment variables are set up and it doesn't again complain about not being able to find cl.exe - which obviously it has been able to find ok for the rest of the script before that point.<br />
<br />
I ended up changing SConstruct<br />
<br />
stub_env = envs[0]<br />
makensis_env = envs[1]<br />
plugin_env = envs[2]<br />
util_env = envs[3]<br />
<br />
to<br />
<br />
stub_env = envs[0]<br />
makensis_env = envs[1]<br />
help_env = makensis_env.Copy()<br />
plugin_env = envs[2]<br />
util_env = envs[3]<br />
<br />
and then<br />
<br />
halibut = SConscript(<br />
	dirs = 'Docs/src/bin/halibut',<br />
	build_dir = build_prefix + 'halibut',<br />
	duplicate = 0<br />
)<br />
<br />
to<br />
<br />
halibut = SConscript(<br />
	dirs = 'Docs/src/bin/halibut',<br />
	build_dir = build_prefix + 'halibut',<br />
	duplicate = 0,<br />
	exports = {'env' : help_env.Copy()}<br />
)<br />
<br />
I then changed Docs\src\bin\halibut\SConscript<br />
<br />
by changing:<br />
<br />
env = Environment()<br />
<br />
to<br />
<br />
Import('env')<br />
<br />
It then compile / linked just fine.<br />
<br />
I've no idea if what I've done above is ok, but it works... and that's all that matters!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st April 2005, 20:48</div></div><div class="posttext">halibut SConscript was indeed using the wrong environment. I've already fixed this in the latest CVS version in a manner similar to what you've suggested.<br />
<br />
However, the current CVS can fail building NSIS Update. You can use the -k command line option to keep building anyway.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">21st April 2005, 21:57</div></div><div class="posttext">Ok, I'll keep an eye out for the updated CVS version, it still seems to show the old one on sourceforge.<br />
<br />
Can I also point out the makensis.nsi script now fails for 2 reasons (rather than just the 1 it's failed on for a while now).<br />
<br />
1. 'bin2h.exe' is still referenced.<br />
<br />
2. 'Contrib\Library\LibraryLocal\*.exe' no longer exists because the LibraryLocal.exe is in the 'build\Library\LibraryLocal' folder.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th April 2005, 18:23</div></div><div class="posttext">Originally posted by kichik <br />
halibut SConscript was indeed using the wrong environment. I've already fixed this in the latest CVS version in a manner similar to what you've suggested.Oops, was thinking of something else. It's really fixed in CVS now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">26th April 2005, 05:19</div></div><div class="posttext">A new problem building the docs:<br />
<br />
C:\projects\NSIS&gt;scons -j4 MSTOOLKIT=yes<br />
scons: Reading SConscript files ...<br />
Using Microsoft tools configuration<br />
Checking for main() in C library gdi32... (cached) yes<br />
Checking for main() in C library user32... (cached) yes<br />
Checking for main() in C library version... (cached) yes<br />
Checking for main() in C library pthread... (cached) no<br />
Checking for main() in C library stdc++... (cached) no<br />
Checking for main() in C library iconv... (cached) no<br />
Checking for main() in C library libiconv... (cached) no<br />
scons: done reading SConscript files.<br />
scons: Building targets ...<br />
Copy(&quot;C:\projects\NSIS\build\release\Docs&quot;, &quot;Docs\src/../style.css&quot;)<br />
scons: *** [build\release\Docs\NSIS.chm] Permission denied<br />
scons: building terminated because of errors.<br />
<br />
<br />
The problem is that the files being copied in the Docs Sconscript file are read-only and that is killing Scons.<br />
So either the destination files should be deleted first or the copy action should force an overwrite.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">26th April 2005, 15:21</div></div><div class="posttext">installed latest python (2.4.1) and scons (0.96.90).<br />
opening console at my nsis root (E:\Programme\NSIS\) and typing &quot;scons&quot; just gives me an error &quot;file or command not found&quot;.<br />
<br />
what am i doing wrong?<br />
<br />
read the news carefully, theres nothing else mentioned.<br />
<br />
or do i really need the vcpp toolkit?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">26th April 2005, 17:15</div></div><div class="posttext">Make sure that python, VC toolkit and hhc.exe are in your path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">26th April 2005, 19:22</div></div><div class="posttext">Can anyone fix it so that the !InstallNSIS.BAT file (and the script it calls) actually works?<br />
<br />
It's great that I can now compile the CVS data without any critical errors, but if I then get stuck building the installer, it's not much use ;)<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">26th April 2005, 20:04</div></div><div class="posttext">Make sure that python, VC toolkit and hhc.exe are in your path.<br />
that they are in WHICH path?<br />
<br />
and why isn't that fact mentioned anywhere in the documentation/news?<br />
<br />
if i install python, it installs to &quot;C:\Program Files\Python24&quot; (on english systems), on mine this would be E:\Programme\Python.<br />
scons uses the same dir:<br />
E:\Programme\Python\scons\SCons<br />
(doubled folder may be a bug in the installer of scons - they didnt use nsis :D)<br />
<br />
nsis is installed in E:\Programme\NSIS<br />
vctoolkit (which i now downloaded and installed) is in <br />
&quot;E:\Programme\Microsoft VisualC++ 2003 Toolkit&quot;<br />
<br />
now, what files do i have to put to which directories manually?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">26th April 2005, 20:10</div></div><div class="posttext">if you type 'set path' from the command prompt, you should see e:\programme\python in there somewhere. If not, you need to add it via the 'properties -&gt; Advanced -&gt; Environment variables' bit when you right click My Computer.<br />
<br />
After that, it should just be 'scons MSTOOLKIT=yes' to get it to compile. Scons configures the other path settings it needs. Dont forget you need hhc (help workshop from microsoft) installed too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">26th April 2005, 20:14</div></div><div class="posttext">thanks, it works!!!<br />
great!<br />
but PLEASE ADD THIS immediately to a faq or similar.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">26th April 2005, 20:24</div></div><div class="posttext">E:\Programme\NSIS&gt;scons -j4 MSTOOLKIT=yes<br />
scons: Reading SConscript files ...<br />
<br />
scons: *** Path does not exist for option CPPPATH:<br />
File &quot;SConstruct&quot;, line 61, in ?<br />
E:\Programme\NSIS&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">26th April 2005, 20:40</div></div><div class="posttext">Ermm don't know the answer to that one, sorry!<br />
<br />
if you type 'set' from the command prompt, do you get a line like:<br />
<br />
VCToolkitInstallDir=C:\Program Files\Microsoft Visual C++ Toolkit 2003\<br />
<br />
?? (Obviously your path will be different if you changed it from the default)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">26th April 2005, 21:01</div></div><div class="posttext">i do get this path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LIGHTNING UK!</div><div class="date">26th April 2005, 21:10</div></div><div class="posttext">ok, still no idea then.<br />
<br />
I thought I'd had pretty much every problem is was possible to have. Now it seems I didn't ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th April 2005, 21:33</div></div><div class="posttext">iceman_k, that's very weird... SCons first tries to copy the file and then set the destination to writable:def _copy_func(src, dest):<br />
    shutil.copy2(src, dest)<br />
    st=os.stat(src)<br />
    os.chmod(dest, stat.S_IMODE(st[stat.ST_MODE]) | stat.S_IWRITE)I'll see if I can find a workaround or if I'm reading this right later.<br />
<br />
LIGHTNING UK!, makensis.nsi will be fixed later. I'm not too sure what I want to do with it yet. I'd be great if the SCons script could generate the installer script too so I only have to specify what to install and where only once. For now, you can use NSIS from the build directory or use:scons PREFIX=&quot;C:\Program Files\NSIS&quot; install<br />
<br />
Comm@nder21, are you using the latest version from CVS? I don't get any error with CPPPATH and I'm using the same versions of Python and SCons as you. Is anyone else getting this error?<br />
<br />
Please don't post every SCons related question or problem in this thread. It'll get pretty huge and hard to follow.<br />
<br />
BTW, I've finally managed to get wine to compile on my linux. It only took a night. I've also managed to get the VC Toolkit, Python and SCons to run on it. With some minor changes to everything involved, NSIS builds just fine. All except the CHM which still needs some love. A complete build took only 3 and half hours on my all so powerful Pentium 100. Once it's completely working, it'll be used to create real nightly snapshots.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">27th April 2005, 16:05</div></div><div class="posttext">yep, i updated it just atm.<br />
<br />
could you have a look at your environment vars if theres one called CPPPATH ?<br />
<br />
i don't have one, that may be the problem.<br />
<br />
installed all programs with their native installer programs, though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th April 2005, 18:10</div></div><div class="posttext">I don't have CPPPATH in my environment. CPPPATH is an option which can be used on the command line. It has a default value of None. None should be a &quot;valid&quot; path. Run scons with --debug=stacktrace and attach the stack trace. To get around this, you can try giving it a real path in CPPPATH.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th April 2005, 19:58</div></div><div class="posttext">iceman_k, I was looking at the wrong place. It's not the copy function that fails, it's the deletion of the target file before the installation. It does however make some sense as read only files shouldn't be touched. I am willing to accept with this reasonable limitation. If you wish, you can submit a bug report (https://sourceforge.net/tracker/?atid=398971&amp;group_id=30337&amp;func=browse) to scons.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">30th April 2005, 16:17</div></div><div class="posttext">updated cvs, which contained a new sconstruct scriptfile, but gave the same error.<br />
then ran with your debug instruction:<br />
SCons error: Warning:  stacktrace is not a valid debug type<br />
<br />
/edit:<br />
updated scons to 0.96.90, like you posted in the other thread (http://forums.winamp.com/showthread.php?s=&amp;threadid=214474).<br />
now i get other errors, which i think are results of missing platform sdk :)<br />
(this **** microsoft server gives me no more than 10kbit/s, no pausable downloads, not more than 2 connections a time!!!!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">1st May 2005, 09:31</div></div><div class="posttext">downloaded and installed platform sdk (under admin account).<br />
get the following errors:<br />
E:\Programme\NSIS&gt;scons -j4 MSTOOLKIT=yes<br />
scons: Reading SConscript files ...<br />
TypeError: cannot concatenate 'str' and 'NoneType' objects:<br />
  File &quot;SConstruct&quot;, line 54:<br />
    defenv = Environment()<br />
  File &quot;E:\Programme\Python\scons\SCons\Memoize.py&quot;, line 815:<br />
    klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />
  File &quot;...\SCons\Memoizer-init-lambda&lt;E:\Programme\Python\scons\SCons\Memoize.p<br />
y&gt;&quot;, line 1:<br />
    None<br />
  File &quot;E:\Programme\Python\scons\SCons\Memoize.py&quot;, line 774:<br />
    apply(actual_init, (self,)+args, kw)<br />
  File &quot;E:\Programme\Python\scons\SCons\Memoize.py&quot;, line 1:<br />
    &quot;&quot;&quot;Memoizer<br />
  File &quot;E:\Programme\Python\scons\SCons\Memoize.py&quot;, line 777:<br />
    apply(super(cls, self).__init__, args, kw)<br />
  File &quot;E:\Programme\Python\scons\SCons\Memoize.py&quot;, line 815:<br />
    klassdict['__init__'] = lambda self, *args, **kw: newinit(self, args, kw)<br />
  File &quot;...\SCons\Memoizer-init-lambda&lt;E:\Programme\Python\scons\SCons\Environme<br />
nt.py&gt;&quot;, line 465:<br />
    None<br />
  File &quot;E:\Programme\Python\scons\SCons\Memoize.py&quot;, line 774:<br />
    apply(actual_init, (self,)+args, kw)<br />
  File &quot;E:\Programme\Python\scons\SCons\Environment.py&quot;, line 511:<br />
    apply_tools(self, tools, toolpath)<br />
  File &quot;E:\Programme\Python\scons\SCons\Environment.py&quot;, line 129:<br />
    env.Tool(tool, toolpath)<br />
  File &quot;E:\Programme\Python\scons\SCons\Environment.py&quot;, line 1055:<br />
    tool(self)<br />
  File &quot;E:\Programme\Python\scons\SCons\Tool\__init__.py&quot;, line 87:<br />
    apply(self.generate, ( env, ) + args, kw)<br />
  File &quot;E:\Programme\Python\scons\SCons\Tool\default.py&quot;, line 40:<br />
    for t in SCons.Tool.tool_list(env['PLATFORM'], env):<br />
  File &quot;E:\Programme\Python\scons\SCons\Tool\__init__.py&quot;, line 382:<br />
    c_compiler = FindTool(c_compilers, env) or c_compilers[0]<br />
  File &quot;E:\Programme\Python\scons\SCons\Tool\__init__.py&quot;, line 301:<br />
    if t.exists(env):<br />
  File &quot;E:\Programme\Python\scons\SCons\Tool\intelc.py&quot;, line 278:<br />
    top = get_intel_compiler_top()<br />
  File &quot;E:\Programme\Python\scons\SCons\Tool\intelc.py&quot;, line 142:<br />
    top = get_intel_registry_value('ProductDir', version, abi)<br />
  File &quot;E:\Programme\Python\scons\SCons\Tool\intelc.py&quot;, line 69:<br />
    K = 'Software\\Intel\\Compilers\\C++\\' + version + '\\'+abi.upper()<br />
E:\Programme\NSIS&gt;<br />
<br />
system:<br />
- windows xp sp2<br />
- psdk for sp2<br />
- vc toolkit 2003<br />
- python 2.41<br />
- scons 0.96.90<br />
<br />
all installed without errors.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">1st May 2005, 13:20</div></div><div class="posttext">Make sure to register the PSDK paths.<br />
c:\program files\microsoft sdk\setenv.bat</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">1st May 2005, 19:43</div></div><div class="posttext">i did</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">2nd May 2005, 12:59</div></div><div class="posttext">i now probably know, why scons makes so much problems.<br />
<br />
running it from cmd.exe gives me the last reported errors.<br />
<br />
running it from the vc toolkit prompt brings me the error, that it couldn't find the psdk.<br />
so, at first it doesnt find the vc toolkit.<br />
<br />
the psdk is properly installed, and registered, but the scons script searches the wrong registry values.<br />
i searched through the scons script, which contains the following lines:<br />
mstoolkit.py<br />
	PlatformSDKDir = &quot;&quot;	<br />
	try:<br />
		PlatformSDKDir = SCons.Util.RegGetValue(SCons.Util.HKEY_LOCAL_MACHINE, r'SOFTWARE\Microsoft\MicrosoftSDK\Directories\Install Dir')[0]<br />
		PlatformSDKDir = str(PlatformSDKDir)<br />
	except SCons.Util.RegError:<br />
		raise SCons.Errors.InternalError, &quot;The Platform SDK directory was not found in the registry.&quot;<br />
it searches in HKLM\SOFTWARE\Microsoft\MicrosoftSDK\Directories\Install Dir<br />
this is wrong.<br />
on my system (see above for details) the install dir is stored in the key:<br />
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MicrosoftSDK\InstalledSDKs\B44C7E10-89BD-4A32-A3BF-D9D0BC4C9A05<br />
as value:<br />
Install Dir<br />
<br />
changing this solves the problem with the psdk.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">2nd May 2005, 13:05</div></div><div class="posttext">well, it now compiles (with -k) but has lots of troubles.<br />
it always tries to run<br />
&quot;E:\Programme\Microsoft Platform SDK\\bin\Win64\link.exe&quot;<br />
which of course doesn't exist.<br />
<br />
1. theres a \ too much<br />
2. i'm running win32 not 64.<br />
<br />
is there ANYONE out there who has a WORKING script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">2nd May 2005, 13:11</div></div><div class="posttext">found the link.exe after some searching:<br />
it's not provided with the psdk.<br />
it's provided with the vc-toolkit:<br />
E:\Programme\Microsoft Visual C++ Toolkit 2003\bin\link.exe<br />
<br />
why does scons use that ****** paths?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd May 2005, 18:41</div></div><div class="posttext">Install the PSDK for Windows 2003 server and it should work. See this thread (http://forums.winamp.com/showthread.php?s=&amp;threadid=214474) for more information.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">13th May 2005, 21:06</div></div><div class="posttext">finally got it working.<br />
some more problems:<br />
the environment vars still don't work.<br />
with latest cvs (updated today) it still does not find the vc++ toolkit itself, even if the vars are set correctly.<br />
the environment code for scons is simply wrong, there were already solutions posted, you may also find one at this link:<br />
http://www.scons.org/faq.php#SS_4_3<br />
plz update the sconstruct file in cvs.<br />
<br />
also, theres still the wrong registry path set in the mstoolkit.py:<br />
SOFTWARE\Microsoft\MicrosoftSDK\Directories\Install Dir<br />
this is your one. its wrong. i tried it both with the xpsp2 sdk and the 2003sp1 one.<br />
for the 2003sp1 one (the only one really working) it must be:<br />
SOFTWARE\Microsoft\MicrosoftSDK\InstalledSDKs\8F9E5EF3-A9A5-491B-A889-C58EFFECE8B3\Install Dir<br />
pls fix that too.<br />
thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th May 2005, 19:11</div></div><div class="posttext">mstoolkit.py adds the bin directory of the toolkit to the path, there's no need to add the entire os path to scons' path. I have updated it to give up if it can't find VCToolkitInstallDir in the environment instead of trying &quot;C:\Program Files\Microsoft Visual C++ Toolkit 2003&quot;.<br />
<br />
I have tried installing a fresh copy of PSDK on a fresh computer and indeed the registry key read in mstoolkit.py was not there. Seems like they're removed it in one of the latest versions. I have updated mstoolkit.py to look in the MSSDK environment variable. I have also made it search that registry key with the GUID, even though it's probably a bad idea. It doesn't exist on the older versions, so it'll probably change in the future.<br />
<br />
So now you must have two envrionment variables: MSSDK should point to the Platform SDK installation directory. It's created automatically, if you choose Register Environment Variables during installation of the PSDK. VCToolkitInstallDir should point to the Visual C++ Toolkit installation directory. It's also created automatically during installation.<br />
<br />
Thanks for the information.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th June 2005, 22:45</div></div><div class="posttext">I have tried building on another with system which has just the toolkit and the Platform SDK and I got an error resulting from this bug (http://sourceforge.net/tracker/?group_id=30337&amp;atid=398971&amp;func=detail&amp;aid=1169089). It can be easily identified by the last place in the stack trace which is intelc.py.<br />
<br />
This bug has already been fixed in the latest CVS version of SCons. However, no versions were released since 0.96.90. Until version 0.97 is released you can use this build (http://nsis.sourceforge.net/scons-0.96.nsis.win32.exe) I made from CVS today. Note that unlike 0.96.*, it doesn't install scons.bat in the main Python directory but in a subdirectory called Scripts. So if you want to change your PATH environment variable so you can just type 'scons' and not C:\Python\Scripts\scons.bat, don't forget to add C:\Python\Scripts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">11th July 2005, 00:02</div></div><div class="posttext">This is very off topic but it is nice to see LIGHTING UK! on the forums after the fall of dvd decrypter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">28th July 2005, 00:45</div></div><div class="posttext">Kickhik:<br />
Any idea about what could be causing this problem:<br />
C:\projects\NSIS\Development&gt;scons MSTOOLKIT=yes<br />
scons: Reading SConscript files ...<br />
Delete(&quot;nsis-27-Jul-2005.cvs&quot;)<br />
Delete(&quot;.instdist&quot;)<br />
Delete(&quot;.test&quot;)<br />
Using Microsoft tools configuration<br />
Checking for main() in C library gdi32... (cached) yes<br />
Checking for main() in C library user32... (cached) yes<br />
Checking for main() in C library version... (cached) yes<br />
Checking for main() in C library pthread... (cached) no<br />
Checking for main() in C library stdc++... (cached) no<br />
Checking for main() in C library iconv... (cached) no<br />
Checking for main() in C library libiconv... (cached) no<br />
Checking for main() in C++ library cppunit... (cached) no<br />
scons: done reading SConscript files.<br />
scons: Building targets ...<br />
Copy(&quot;C:\projects\NSIS\Development\build\release\Docs\chm&quot;, &quot;Docs\src/../style.css&quot;)<br />
scons: *** [build\release\Docs\chm\NSIS.chm] Permission denied<br />
scons: building terminated because of errors. <br />
<br />
I don't get it with a clean build, but I still get it when I try rebuilding. Is there some verbose mode I can enable to get more details?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">28th July 2005, 00:57</div></div><div class="posttext">Did you put the HTML Help compiler is your path?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">28th July 2005, 03:26</div></div><div class="posttext">It works fine if I do a clean build- it builds the CHM and everything. However, if I delete build\release\Docs\chm\NSIS.chm and run Scons again, it fails.<br />
The reason it fails is that the Copy() commands below do not change the readonly attribute of the files.<br />
<br />
	chm_builder = Builder(<br />
		action = [<br />
			Copy(build_dir, '${SOURCE.dir}/../style.css'),<br />
			Copy(build_dir, '${SOURCE.dir}/chmlink.js'),<br />
			Copy(build_dir, '${SOURCE.dir}/nsis.hhp'),<br />
			Action('cd &quot;%s&quot; &amp;&amp; &quot;%s&quot; ${SOURCES.abspath}' % (build_dir, halibut[0].abspath)),<br />
			hhc_action<br />
		]<br />
	)<br />
 <br />
Since I have configured my CVS with watch/edit enabled, non-edited files have the readonly attribute set. If the build directory is empty, these are copied over without a problem.<br />
However, the next time I run Scons, the copy fails because the target files are readonly.<br />
This is in spite of the _copy_func definition ostensibly changing the status to writeable:<br />
<br />
def _copy_func(src, dest):<br />
    shutil.copy2(src, dest)<br />
    st=os.stat(src)<br />
    os.chmod(dest, stat.S_IMODE(st[stat.ST_MODE]) | stat.S_IWRITE)<br />
<br />
<br />
So, eventually, my work around was to create a build.bat file which fixes the readonly attribute for me:<br />
<br />
setlocal<br />
set MSSDK=C:\Program Files\Microsoft SDK<br />
set VCToolkitInstallDir=C:\Program Files\Microsoft Visual C++ Toolkit 2003<br />
path %path%;c:\python;c:\Program Files\HTML Help Workshop<br />
call scons MSTOOLKIT=yes &gt; build.log 2&gt;&amp;1<br />
if exist build\release\Docs\chm (<br />
pushd build\release\Docs\chm<br />
if exist style.css attrib -r -s -h -a style.css<br />
if exist chmlink.js attrib -r -s -h -a chmlink.js<br />
if exist nsis.hhp attrib -r -s -h -a nsis.hhp<br />
popd<br />
)<br />
if exist build\release\Docs\html (<br />
pushd build\release\Docs\html<br />
if exist style.css attrib -r -s -h -a style.css<br />
popd<br />
)<br />
call scons MSTOOLKIT=yes PREFIX=&quot;C:\Projects\NSIS&quot; install &gt;&gt; build.log 2&gt;&amp;1<br />
endlocal</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>