<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Changing $TEMP path, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Changing $TEMP path NSIS Discussion" />
	
	<title> Changing $TEMP path [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Changing $TEMP path</div>
<hr />
<div class="pda"><a href="t-179738.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179738">Changing $TEMP path</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">12th May 2004, 15:10</div></div><div class="posttext">I have a customer who has most of their user accounts set up as Restricted. On top of that they don't allow the users to write to the Temp folder under $WINDIR\temp or $TEMP. So, I'm wondering if there is a way for me to modify the $TEMP path. I'm figuring I'll set up a command line parameter for him to set the temp path. However, I tried setting $TEMP using -- StrCpy $TEMP &quot;C:\newtemp&quot; --and it won't compile. Is this not possible?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th May 2004, 15:24</div></div><div class="posttext">Use StrCpy in the .onInit function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">12th May 2004, 16:04</div></div><div class="posttext">Ok, so what am I doing wrong? That's what I've been trying. I took the Basic.nsi script from the Modern UI folder and added:<br />
<br />
Function .onInit<br />
<br />
  StrCpy $TEMP &quot;C:\newtemp&quot;<br />
<br />
FunctionEnd<br />
<br />
and it won't compile.<br />
Function: &quot;.onInit&quot;<br />
Usage: StrCpy $(user_var: output) str [maxlen] [startoffset]<br />
Error in script &quot;C:\Temp\Basic.nsi&quot; on line 46 -- aborting creation process</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th May 2004, 20:05</div></div><div class="posttext">You can't modify this variable, you should declare your own.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">thelliez</div><div class="date">17th May 2004, 21:03</div></div><div class="posttext">I would like to second this feature request. I am in a similar situation where I am not allowed to write to the C drive.<br />
<br />
Right now, I am using my own directory but I then have to remember to delete these tmp files.<br />
<br />
Is there a way that I can delete these files even if the user aborts the installation?<br />
<br />
<br />
Thanks,<br />
Thierry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th May 2004, 22:03</div></div><div class="posttext">See the documentation about callback functions.<br />
<br />
But why not use the plug-ins directory ($PLUGINSDIR after calling InitPluginsDir)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">17th May 2004, 22:15</div></div><div class="posttext">Modifying the $PLUGINSDIR doesn't really seem to solve the problem either. If I put a MessageBox as the very first thing in .onInit and then check the temp directory it has already written a file there (C:\Documents and Settings\andyg\Local Settings\Temp\nskC0.tmp). So, unless that temp file is there because I did a MessageBox it seems too late to change the plugins directory and use it as the temp folder. Is there a function before .onInit?<br />
My client is claiming that my installs just won't work in his environment unless he can specify where the temp path is.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th May 2004, 22:18</div></div><div class="posttext">That isn't a file, it's a folder. Use it and it will be removed automatically (but don't forget to call InitPluginsDir).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">17th May 2004, 22:27</div></div><div class="posttext">It's actually a file for me. It's locked though, it won't even let me open it in Notepad. If I then click Ok on the MessageBox I get a folder after that with all my IO pages, bitmaps etc. I realize it renames itself everytime but in this instance I have a TMP file named nsbD3.tmp and then I get a nscD4.tmp folder after I click past the message box. I get the same result if I run the nsis20.exe install file. Both the temp file and folder do go away after the install is cancelled or completed. I'm running XP Pro SP1 if that matters.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th May 2004, 19:59</div></div><div class="posttext">That's probably the solid compression buffer. Don't use solid comression if you don't want it to be created.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">21st May 2004, 16:44</div></div><div class="posttext">Ok, I switched to using non-solid compression and the .tmp file did go away so that must have been what was causing that. I had to change things using MUI_INSTALLOPTIONS_EXTRACT_AS to File so that I could copy them into the user defined temp folder and that worked ok. However, plugins (like InstallOptions.dll), ioSpecial.ini and the header and wizard bitmap still go to the temp folder under profiles for that user. How can I get it so that these files will go into the usr defined temp folder? I'm thinking something like &quot;InitPluginsDir c:\usertemp&quot; would be great. I realize I may have to delete the files myself once the install is finished. Thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st May 2004, 16:58</div></div><div class="posttext">You can call plug-ins the old fashioned way, with CallInstDLL. To avoid having to do that for every plug-in, you can get your first plug-in to change $PLUGINSDIR. $PLUGINSDIR is not changable from the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">21st May 2004, 20:24</div></div><div class="posttext">Are you saying that CallInstDLL will set the $PLUGINSDIR path or that my first plugin can somehow set the $PLUGINSDIR path? If the second is true is there an example of that somewhere? I've attached a modified version of Basic.nsi to illustrate what I'm trying. It ends up that the $PLUGINSDIR never gets set even after the call to CallInstDLL. The exdll.dll does get called though from the usertemp folder. The install runs but I have no idea where ioSpecial.ini and InstallOptions.dll are going.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd May 2004, 00:40</div></div><div class="posttext">The plug-in can change $PLUGINSDIR using the variables argument passed to its function. I suggest you simply examine what is passed in variables and see where the change is needed. The utility functions in exdll.h might help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">22nd May 2004, 23:23</div></div><div class="posttext">Awesome, I got the plug-in built and working. Here's what I did if anybody else is curious: I extract my DLL to whatever folder the user specifies on the command line and then call my DLL to change the PLUGINSDIR. Then I call InitPluginsDir from my script so that I can use the path and it also creates a unique folder under the user path, which is nice. Then I delete my DLL used to change the PLUGINSDIR and NSIS takes care of deleting the temp path it created and all the junk in it when the install finishes. I had to add a little code in .onInit but the rest of my script appears to work as is. If anybody wants more detail please ask. Thanks again kichik!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">thelliez</div><div class="date">24th May 2004, 05:03</div></div><div class="posttext">Do you mind posting a little bit more details about you made it happen? What does your dll like?<br />
<br />
Thanks,<br />
Thierry</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">24th May 2004, 14:43</div></div><div class="posttext">The DLL didn't take much. I just took exdll and added this code to myFunction:<br />
<br />
char buf[1024];<br />
int  e=-1;<br />
popstring(buf);<br />
e = myatoi(buf);<br />
popstring(buf);<br />
setuservariable(e, buf);<br />
<br />
I ultimately ended up renaming the function and the DLL but that's about it besides adding the PLUGINSDIR to the enum in the header file. PLUGINSDIR then became #25 so when I call the DLL I used 25 to let it know which variable to change. Oh, I also had to grab the myatoi function from another example DLL.<br />
<br />
SetOutPath $TEMPDIR<br />
File /oname=$TEMPDIR\chngvrbl.dll &quot;${NSISDIR}                                                   \Plugins\chngvrbl.dll&quot;<br />
Push $TEMPDIR<br />
Push 25<br />
CallInstDLL &quot;$TEMPDIR\chngvrbl.dll&quot; changeVariable</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">16th July 2004, 20:14</div></div><div class="posttext">Several of my customers have been using this plugin in my installs with no problems. It was being used to change the $PLUGINSDIR. So, I thought that I would post the plugin to the Archive (http://nsis.sourceforge.net/archive/nsisweb.php?page=593&amp;instances=0) just in case anyone else could use it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>