<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install Directory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install Directory NSIS Discussion" />
	
	<title> Install Directory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install Directory</div>
<hr />
<div class="pda"><a href="t-125557.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125557">Install Directory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">treaz</div><div class="date">18th February 2003, 21:18</div></div><div class="posttext">Hi,<br />
I was thinking if it is possible for me to prevent the user from entering a destination directory that has spaces in them (e.g &quot;C:\test folder\my test&quot;).  <br />
<br />
I am currently using the modern UI for its interface......can anyone help?<br />
<br />
Thanks a lot.<br />
:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th February 2003, 21:20</div></div><div class="posttext">there is a cool string functions in the archive:<br />
<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=122&amp;instances=0,11</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th February 2003, 15:42</div></div><div class="posttext">And you can use that function in .onVerifyInstDir to find out if there is a space in $INSTDIR. If there is you can use Abort in this callback function to gray out the next button. If you want a message box too you'll have to do this check in the page's leave function.<br />
<br />
Why don't you want the user to use spaces? Maybe there is a better way to do what you're looking for. If you are looking for valid DOS names for example (8.3) then you can use GetFullPathName /SHORT.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treaz</div><div class="date">25th February 2003, 22:52</div></div><div class="posttext">Hi,<br />
Thanks for the responses.<br />
<br />
I do not wish to have spaces in the install directory because my program does not handle it. Guess I should try to modify my program instead but a temporary solution would be to make sure the user does not enter spaces.<br />
<br />
How would you suggest I check for spaces and how can I use Abort such that the next button is grayed out?<br />
<br />
Part 2:<br />
Another different question:<br />
Would I be able to disable the install directory page or in any case disable any pages while the program is running?  <br />
<br />
Purpose of this:<br />
I wish to run a checking which would tell me if my program has already been installed once by the user and if it has been installed before, now I wish to run an update which will not require the user to select any destination directory. Destination directory would be read from the registry.<br />
<br />
Thanks in advance for any sound advice.<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">25th February 2003, 23:27</div></div><div class="posttext">For disable the Install Directory you can use:<br />
<br />
DirShow hide ;normal nsis<br />
<br />
<br />
or:<br />
<br />
<br />
Don't put the !define MUI_DIRECTORYPAGE in Modern UI<br />
<br />
<br />
<br />
Would I be able to disable the install directory page or in any case disable any pages while the program is running? <br />
<br />
<br />
Maybe the Callback Functions (http://nsis.sourceforge.net/Docs/Chapter3.html#3.5.1) could help you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">26th February 2003, 06:34</div></div><div class="posttext">I was thinking if it is possible for me to prevent the user from entering a destination directory that has spaces in them (e.g &quot;C:\test folder\my test&quot;).<br />
<br />
<br />
Yes, it is possible. This code will disable the Install button if the path contains spaces. Uses &quot;Search in a String&quot; Function (or StrStr Function) :<br />
<br />
Function .onVerifyInstDir<br />
Push &quot;$INSTDIR&quot;<br />
Push &quot; &quot;<br />
Call StrStr<br />
Pop $0<br />
StrCpy $0 $0 1<br />
StrCmp $0 &quot; &quot; 0 +2<br />
  Abort<br />
FunctionEnd<br />
<br />
(this code as been tested before posting)<br />
<br />
<br />
Would I be able to disable the install directory page or in any case disable any pages while the program is running?<br />
<br />
<br />
You can do this:<br />
<br />
!define MUI_DIRECTORYPAGE<br />
!define MUI_CUSTOMFUNCTION_DIRECTORY_PRE &quot;Abort&quot;<br />
<br />
Function Abort<br />
Abort<br />
FunctionEnd<br />
<br />
<br />
You can put the code for detect if is an update in this function abort.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th February 2003, 10:40</div></div><div class="posttext">Why don't you want the user to use spaces? Maybe there is a better way to do what you're looking for. If you are looking for valid DOS names for example (8.3) then you can use GetFullPathName /SHORT.<br />
<br />
I forgot to mention that valid DOS names have no spaces in them and they can be used as any other path names by Windows or any other program.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treaz</div><div class="date">26th February 2003, 16:50</div></div><div class="posttext">You can do this:<br />
<br />
!define MUI_DIRECTORYPAGE<br />
!define MUI_CUSTOMFUNCTION_DIRECTORY_PRE &quot;Abort&quot;<br />
<br />
Function Abort<br />
Abort<br />
FunctionEnd<br />
 <br />
<br />
I got a warning upon compiling the above: install function &quot;Abort&quot; not referenced - zeroing code (777-778) out <br />
<br />
When I ran the installer it does not disable the directory page too.<br />
<br />
I guess I would need assistance on where I should place the above code. Or do I need to specify anything else like the page order?<br />
My guess is may be my System.nsh file does not have this CustomFunction_Directory_Pre function.<br />
<br />
Thanks. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treaz</div><div class="date">26th February 2003, 17:08</div></div><div class="posttext">Originally posted by kichik <br />
I forgot to mention that valid DOS names have no spaces in them and they can be used as any other path names by Windows or any other program.  <br />
<br />
I would very much prefer to use spaces too. However, at this point of time it's my program's incapability to use spaces not the installer.  So for the time being I think I am better off not allowing spaces.<br />
<br />
:p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treaz</div><div class="date">26th February 2003, 18:54</div></div><div class="posttext">Looks like I found out that I need to use the Modern UI v1.6.2 or NSISv2.0b0.<br />
<br />
May I know if I could also choose to disable the start-menu page during running check? <br />
<br />
Thanks.<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th February 2003, 22:46</div></div><div class="posttext">Indeed, you need the latest version for that (2.0b2).<br />
<br />
What I meant with the short (DOS) file path names (hopefully it will come out clearer now :)) is that the installer can generate a path name with no spaces from any path name, with, or without spaces, for your programs use and it refer to the exact same file/dir as the long path with the spaces in it.<br />
<br />
Just use:GetFullPathName /SHORT $INSTDIR $INSTDIR<br />
before you let your program know what $INSTDIR is. You'll get a name without spaces that works exactly the same as the name with the spaces.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treaz</div><div class="date">26th February 2003, 22:57</div></div><div class="posttext">Guess I finally get what you mean! Thanks.  Looks like it's a good option out.<br />
<br />
May I know if v2.0b2 supports disabling the StartMenu during installation?<br />
<br />
Thanks.<br />
:)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th February 2003, 23:02</div></div><div class="posttext">I'll have to wait for Joost to reply on this one as he knows far more about the MUI than me. I have looked a bit on the source and couldn't find anyway to do it directly with the MUI but I might be wrong so it'll be better to wait for him</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">27th February 2003, 07:56</div></div><div class="posttext">Originally posted by treaz <br />
Guess I finally get what you mean! Thanks.  Looks like it's a good option out.<br />
<br />
May I know if v2.0b2 supports disabling the StartMenu during installation?<br />
<br />
Thanks.<br />
:) <br />
<br />
Yes! But have a documentation error: is MUI_CUSTOMFUNCTION_START not MUI_CUSTOMFUNCTION_STARTMENU. See how to do:<br />
<br />
<br />
!define MUI_DIRECTORYPAGE<br />
!define MUI_CUSTOMFUNCTION_DIRECTORY_PRE &quot;Abort&quot;<br />
!define MUI_STARTMENUPAGE<br />
!define MUI_CUSTOMFUNCTION_START &quot;Abort&quot;<br />
<br />
Function &quot;Abort&quot;<br />
Abort<br />
FunctionEnd<br />
<br />
View that MUI_CUSTOMFUNCTION_DIRECTORY_PRE and MUI_CUSTOMFUNCTION_START are using the same function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">27th February 2003, 13:59</div></div><div class="posttext">It should be MUI_CUSTOMFUNCTION_STARTMENU. Fixed in CVS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">treaz</div><div class="date">27th February 2003, 15:14</div></div><div class="posttext">Hi,<br />
<br />
Thanks for your respond.  However, could you please advice me on how I should go about update my NSIS that I have installed to accomodate the changes you have made?<br />
<br />
I just had v2.0b2 installed on my machine but it does not perform MUI_CUSTOMFUNCTION_START neither does it perform MUI_CUSTOMFUNCTION_STARTMENU.<br />
<br />
Thanks. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">27th February 2003, 21:32</div></div><div class="posttext">The current funtion is being called after calling the StartMenu plugin. I'll add a pre and leave funtion, so you can use the pre function :)<br />
<br />
edit:<br />
Done! Grab the latest CVS version. Define names have been changed, check the new StartMenu.nsi example.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>