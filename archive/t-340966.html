<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstaller does not reboot if run from installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstaller does not reboot if run from installer NSIS Discussion" />
	
	<title> Uninstaller does not reboot if run from installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstaller does not reboot if run from installer</div>
<hr />
<div class="pda"><a href="t-340966.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=340966">Uninstaller does not reboot if run from installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">20th January 2012, 20:31</div></div><div class="posttext">My installer code runs the uninstaller (in .onInit) if it detects the software is already installed. Once the software finishes uninstalling, it continues with the installation.<br />
<br />
I am using &quot;Delete /REBOOTOK&quot; to delete files in my uninstaller. If one of the files cannot be deleted, it asks the user to reboot the system.<br />
<br />
1. If I intentionally lock a file, run the uninstaller directly, and the user agrees to reboot the system *does* reboot.<br />
<br />
2. If I do the same, but launch the uninstaller from inside the installer, it does *not* reboot.<br />
<br />
The installer is invoking the uninstaller using this code:<br />
<br />
ExecWait '$0 _?=$INSTDIR' ;Do not copy the uninstaller to a temp file<br />
<br />
Why isn't the uninstaller rebooting?<br />
<br />
Thanks,<br />
Gili</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">20th January 2012, 20:56</div></div><div class="posttext">Windows 'knows' that the installer is running and prevents the reboot. I had a similar problem and solved it by making the uninstaller terminate the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">20th January 2012, 21:09</div></div><div class="posttext">Windows 'knows' that the installer is running and prevents the reboot. I had a similar problem and solved it by making the uninstaller terminate the installer.<br />
<br />
Seems hackish, but just in case... how do you do that? :)<br />
Is there a cleaner solution?<br />
<br />
Thanks,<br />
Gili</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th January 2012, 23:02</div></div><div class="posttext">The installer is blocking the reboot IIRC, I think there is a plugin that prevents it from doing that...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">23rd January 2012, 17:44</div></div><div class="posttext">The installer is blocking the reboot IIRC, I think there is a plugin that prevents it from doing that...<br />
<br />
Where can I find this plugin?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd January 2012, 19:34</div></div><div class="posttext">http://nsis.sourceforge.net/ShutdownAllow_plug-in<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">23rd January 2012, 20:13</div></div><div class="posttext">Excellent. Thanks Stu! :)<br />
<br />
Gili</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">23rd January 2012, 21:01</div></div><div class="posttext">Okay, now I've got one more problem... The uninstaller is causing the system to reboot, but in the meantime it returns control back to the installer which allows the user to begin installation.<br />
<br />
I noticed that the uninstaller is returning exit code 164 (or -164, I forget). Where does this number come from? Is it documented somewhere? Can I rely on it not changing?<br />
<br />
Thanks,<br />
Gili</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">23rd January 2012, 21:10</div></div><div class="posttext">Hmm, it seems I jumped the gun. I get an exit code of 164 whether the uninstaller reboots or not. Any ideas on how to tell the installer to abort when the uninstaller tries to reboot?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd January 2012, 21:12</div></div><div class="posttext">Looking at the source it just returns the current error level (SetErrorLevel) so perhaps something in your script is setting it to 164. You can try setting your own error level just before rebooting.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">23rd January 2012, 21:16</div></div><div class="posttext">I stand corrected. I'm getting error code 0 (not 164) whether it reboots or not.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">23rd January 2012, 21:17</div></div><div class="posttext">Stu,<br />
<br />
Which function gets executed if the user chooses to reboot (I'd like to SetErrorLevel there)? I believe the reboot flag is being set by &quot;Delete /REBOOTOK&quot;. I never explicitly set it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd January 2012, 21:20</div></div><div class="posttext">IfRebootFlag 0 +2<br />
  SetErrorLevel 99Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">cowwoc</div><div class="date">23rd January 2012, 21:56</div></div><div class="posttext">IfRebootFlag 0 +2<br />
  SetErrorLevel 99Stu<br />
<br />
I added this to the end of:<br />
<br />
   Section &quot;Uninstall&quot;<br />
<br />
Thanks again,<br />
Gili</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>