<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help me pick an installer example, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help me pick an installer example NSIS Discussion" />
	
	<title> Help me pick an installer example [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help me pick an installer example</div>
<hr />
<div class="pda"><a href="t-278382.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=278382">Help me pick an installer example</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">torpark</div><div class="date">6th October 2007, 17:01</div></div><div class="posttext">I'm trying to build an installer that does the following. Are there any good examples out there? All I see is a sea of them.<br />
<br />
1. Check and see if there was a prior installation, if so, allow install ontop, or uninstall the whole installation.<br />
2. Ask for directory of installation<br />
3. Ask some settings questions<br />
4. Execute some file create, move, delete<br />
5. Run another MUI page to determine some system settings and give the user option for input.<br />
6. User enters serial code, we check it online.<br />
7. Exit</div></div><hr />


<div class="post"><div class="posttop"><div class="username">torpark</div><div class="date">8th October 2007, 01:23</div></div><div class="posttext">bump</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">8th October 2007, 01:50</div></div><div class="posttext">I don't think there's a standalone example with those tasks. I will try to help you.<br />
<br />
1. To check you can try ReadRegStr to find registry entries of past installers.<br />
2. Use Page directory, or build your own with InstallOptions or nsDialogs.<br />
3. Again, build your pages with above pluigns.<br />
4. Exec, ExecShell<br />
5. ?<br />
6. Again, build your page and use InetLoad.<br />
7. Close.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">torpark</div><div class="date">8th October 2007, 23:54</div></div><div class="posttext">We aren't using the registry whatsoever. I already have the inetload code we need. Now what I really need is an example installer that asks where the program should be installed, and perhaps has an extra page or uninstall function inside it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th October 2007, 00:07</div></div><div class="posttext">Pretty much every installer out there asks for the installation directory. Starting from Examples\example1.nsi, through cool examples like primes.nsi ranging all the way to full blown examples (http://nsis.sourceforge.net/Simple_installer_with_JRE_check) on the Wiki. As Joel said, all you need is Page directory or MUI_PAGE_DIRECTORY.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">torpark</div><div class="date">15th October 2007, 09:35</div></div><div class="posttext">I used some examples to patch together a rudimentary installer. Now I need to add a custom page and custom code i've already made up from another installer. Can anyone help me mate the code to my installer?<br />
<br />
I've written some code that automatically checks for proxy information on the machine. It also allows the user to enter in HTTP and HTTPS proxy information, and later ask for a password when in use. I had an old ini page for it but made up a new one, since it needs much fewer options.<br />
<br />
I am highly motivated to finish this in the next 24 hours, and I would be willing to compensate someone who is expert to take on the task themselves.<br />
<br />
<br />
;--------------------------------<br />
!include &quot;MUI.nsh&quot;<br />
!define PROGRAM_NAME &quot;Program&quot;<br />
!define PROGRAM_EXE &quot;Program.exe&quot;<br />
!define INSTALLATION_DIR &quot;$PROGRAMFILES\Program&quot;<br />
!define COMPANY_NAME &quot;Company&quot;<br />
; The name of the installer<br />
Name &quot;${COMPANY_NAME}&quot;<br />
<br />
; The file to write<br />
OutFile &quot;${COMPANY_NAME}.exe&quot;<br />
<br />
; The default installation directory<br />
CRCCheck on<br />
InstallDir ${INSTALLATION_DIR}<br />
ShowInstDetails show<br />
LicenseText &quot;${COMPANY_NAME} License Agreement&quot;<br />
LicenseData &quot;license.txt&quot;<br />
XPStyle on<br />
<br />
;--------------------------------<br />
<br />
; Pages<br />
<br />
Page license<br />
Page directory<br />
Page instfiles<br />
;Modified Finish Page<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE fin_pre<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW fin_show<br />
  !define MUI_PAGE_CUSTOMFUNCTION_LEAVE fin_leave<br />
  !define MUI_FINISHPAGE_SHOWREADME &quot;${NSISDIR}\Docs\Modern UI\Changelog.txt&quot;<br />
  !define MUI_FINISHPAGE_RUN<br />
  !define MUI_FINISHPAGE_RUN_FUNCTION Desc_ShortCut<br />
  !define MUI_FINISHPAGE_RUN_TEXT &quot;Create Desktop Shortcut&quot;<br />
  !insertmacro MUI_PAGE_FINISH<br />
  !insertmacro MUI_UNPAGE_WELCOME<br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_INSTFILES<br />
  !insertmacro MUI_UNPAGE_FINISH<br />
<br />
;--------------------------------<br />
;Languages<br />
<br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
<br />
<br />
; The stuff to install<br />
Section &quot;&quot; ;No components page, name is not important<br />
  <br />
	SetOutPath $INSTDIR\temp ; temporarily set output path temp dir to extract the data.<br />
	File data.zip ;extract the data to install<br />
	ZipDLL::extractall &quot;$INSTDIR\temp\data.zip&quot; &quot;$INSTDIR&quot; ;extract all the files in data<br />
	SetOutPath $INSTDIR ; set output path temp dir to extract the data.  <br />
	Delete &quot;$INSTDIR\temp\data.zip&quot;; remove the temp file once it was all installed.<br />
	RMDir &quot;$INSTDIR\temp&quot; ;remove the temp dir<br />
   <br />
SectionEnd ; end the section<br />
<br />
;------------------<br />
;Functions<br />
Function Desc_Shortcut<br />
SetOutPath &quot;$INSTDIR&quot;<br />
CreateShortCut &quot;$DESKTOP\${PROGRAM_NAME}.lnk&quot; &quot;$INSTDIR\${PROGRAM_EXE}&quot;<br />
FunctionEnd<br />
<br />
Function fin_show<br />
ReadINIStr $0 &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;HWND&quot;<br />
SetCtlColors $0 0x000000 0xFFFFFF<br />
FunctionEnd<br />
<br />
Function fin_pre<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;6&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Type&quot; &quot;CheckBox&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Text&quot; &quot;&amp;Create Quicklaunch Shortcut&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Left&quot; &quot;120&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Right&quot; &quot;315&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Top&quot; &quot;130&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;Bottom&quot; &quot;140&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;State&quot; &quot;1&quot;<br />
FunctionEnd<br />
<br />
Function fin_leave<br />
ReadINIStr $0 &quot;$PLUGINSDIR\iospecial.ini&quot; &quot;Field 6&quot; &quot;State&quot;<br />
StrCmp $0 &quot;0&quot; end<br />
SetOutPath &quot;$INSTDIR&quot;<br />
CreateShortCut &quot;$QUICKLAUNCH\my program.lnk&quot; &quot;$INSTDIR\makensisw.exe&quot;<br />
end:<br />
FunctionEnd<br />
<br />
<br />
And this is the INI<br />
<br />
<br />
 Ini file generated by the HM NIS Edit IO designer.<br />
[Settings]<br />
NumFields=15<br />
Title=XeroBank Configuration Wizard<br />
CancelShow=1<br />
CancelButtonText=&amp;Cancel<br />
NextButtonText=&amp;Generate<br />
<br />
[Field 1]<br />
Type=Groupbox<br />
Text=Internet Settings<br />
Left=20<br />
Right=260<br />
Top=0<br />
Bottom=68<br />
Flags=NOTABSTOP<br />
<br />
[Field 2]<br />
Type=Groupbox<br />
Text=Proxy Settings<br />
Left=20<br />
Right=260<br />
Top=70<br />
Bottom=140<br />
Flags=NOTABSTOP|DISABLED<br />
<br />
[Field 3]<br />
Type=Label<br />
Text=HTTP Proxy:<br />
Left=32<br />
Right=76<br />
Top=86<br />
Bottom=96<br />
Flags=NOTABSTOP|DISABLED<br />
<br />
[Field 4]<br />
Type=Text<br />
State=IP Address<br />
Left=99<br />
Right=171<br />
Top=83<br />
Bottom=96<br />
MaxLen=256<br />
Flags=DISABLED<br />
<br />
[Field 5]<br />
Type=Text<br />
State=Port<br />
Left=174<br />
Right=201<br />
Top=83<br />
Bottom=96<br />
MaxLen=5<br />
Flags=DISABLED|ONLY_NUMBERS<br />
<br />
[Field 6]<br />
Type=Checkbox<br />
Text=Requires Username &amp;&amp; Password<br />
Left=87<br />
Right=204<br />
Top=97<br />
Bottom=109<br />
Flags=DISABLED<br />
<br />
[Field 7]<br />
Type=Label<br />
Text=HTTPS Proxy:<br />
Left=32<br />
Right=79<br />
Top=113<br />
Bottom=123<br />
Flags=NOTABSTOP|DISABLED<br />
<br />
[Field 8]<br />
Type=Text<br />
MaxLen=256<br />
State=IP Address<br />
Left=99<br />
Right=171<br />
Top=113<br />
Bottom=124<br />
Flags=DISABLED<br />
<br />
[Field 9]<br />
Type=Text<br />
MaxLen=5<br />
State=Port<br />
Left=174<br />
Right=202<br />
Top=113<br />
Bottom=124<br />
Flags=DISABLED|ONLY_NUMBERS<br />
<br />
[Field 10]<br />
Type=Checkbox<br />
Text=Requires Username &amp;&amp; Password<br />
Left=87<br />
Right=202<br />
Top=128<br />
Bottom=137<br />
Flags=DISABLED<br />
<br />
[Field 11]<br />
Type=Button<br />
Text=Auto-Detect<br />
Left=205<br />
Right=255<br />
Top=83<br />
Bottom=136<br />
Flags=DISABLED|NOTIFY<br />
<br />
[Field 12]<br />
Type=RadioButton<br />
Text=Direct Connection<br />
Left=44<br />
Right=119<br />
Top=32<br />
Bottom=42<br />
<br />
[Field 13]<br />
Type=RadioButton<br />
Text=Network Proxy<br />
Left=44<br />
Right=119<br />
Top=48<br />
Bottom=58<br />
<br />
[Field 14]<br />
Type=Label<br />
Text=How do you connect to the internet?<br />
Left=30<br />
Right=146<br />
Top=16<br />
Bottom=24<br />
<br />
[Field 15]<br />
Type=Label<br />
Text=(Most Users)<br />
Flags=NOTABSTOP<br />
Left=120<br />
Right=159<br />
Top=32<br />
Bottom=40<br />
<br />
<br />
And here is the old installer code we want to mate to this new INI and installer:<br />
<br />
<br />
  !include &quot;MUI.nsh&quot;<br />
<br />
;---------------------<br />
;includes<br />
  !include &quot;LogicLib.nsh&quot;<br />
  !include &quot;WordFunc.nsh&quot;<br />
	!insertmacro WordFind<br />
	!insertmacro WordFind2x<br />
	!insertmacro WordReplace<br />
<br />
;----------------------<br />
;MUI defines<br />
<br />
  !define BROWSERNAME &quot;xBBrowser&quot;<br />
  !define MAILCLIENTNAME &quot;xBMail&quot;<br />
  !define UIDISABLEWARNING &quot;Field 2&quot;<br />
  !define UIDISABLESPLASH &quot;Field 3&quot;<br />
  !define UIDISABLETOR &quot;Field 4&quot;<br />
  !define UIWAITFORCIRCUIT &quot;Field 5&quot;<br />
  !define UIPROXYREQ &quot;Field 6&quot;<br />
  !define UIDEBUGON &quot;Field 7&quot;<br />
  <br />
  !define UITORBOX &quot;Field 8&quot;<br />
  <br />
  !define UICIRCUITLABEL &quot;Field 9&quot;<br />
  !define UICONTROLLABEL &quot;Field 11&quot;<br />
  !define UISOCKSLABEL &quot;Field 13&quot;<br />
  !define UITORCOMLABEL &quot;Field 15&quot;<br />
  <br />
  !define UITORTIMEOUT &quot;Field 10&quot;<br />
  !define UICONTROLPORT &quot;Field 12&quot;<br />
  !define UISOCKSPORT &quot;Field 14&quot;  <br />
  !define UITORCOMMANDS &quot;Field 16&quot;<br />
  !define UIDELDIRDATA &quot;Field 17&quot;<br />
  <br />
  !define UIIPADDRESS1 &quot;Field 20&quot;<br />
  !define UIPORT1 &quot;Field 21&quot;<br />
  !define UIREQAUTH1 &quot;Field 22&quot;<br />
  <br />
  !define UIIPADDRESS2 &quot;Field 24&quot;<br />
  !define UIPORT2 &quot;Field 25&quot;<br />
  !define UIREQAUTH2 &quot;Field 26&quot;<br />
  <br />
  !define UIAUTODETECT &quot;Field 27&quot;<br />
  !define UIHTTPLABEL &quot;Field 19&quot;<br />
  !define UIHTTPSLABEL &quot;Field 23&quot;<br />
  <br />
<br />
;--------------------------------<br />
;General<br />
<br />
  ;Name and file<br />
!define NAME &quot;xBConfig&quot;<br />
  Name &quot;XeroBank Configuration Wizard&quot;<br />
  OutFile &quot;xBConfig.exe&quot;<br />
<br />
  ;Default installation folder<br />
  InstallDir &quot;$EXEDIR\..&quot;<br />
  <br />
  ;Get installation folder from registry if available<br />
<br />
;--------------------------------<br />
;Pages<br />
<br />
  Page custom InitPage LeavePage<br />
 <br />
;--------------------------------<br />
;Interface Settings<br />
<br />
  !define MUI_ABORTWARNING<br />
  <br />
;--------------------------------<br />
;Languages<br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
;--------------------------------<br />
;Reserve Files<br />
  <br />
  ;If you are using solid compression, files that are required before<br />
  ;the actual installation should be stored first in the data block,<br />
  ;because this will make your installer start faster.<br />
  <br />
  ReserveFile &quot;xBConfig.ini&quot;<br />
  !insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
;--------------------------------<br />
;Variables<br />
Icon &quot;${NAME}.ico&quot;<br />
VAR DISABLEWARNING<br />
VAR DISABLESPLASH<br />
VAR DISABLETOR<br />
VAR WAITFORCIRCUIT<br />
VAR DEBUGON<br />
<br />
VAR TORTIMEOUT<br />
VAR CONTROLPORT<br />
VAR SOCKSPORT<br />
VAR TORCOMMANDS<br />
VAR DELDIRDATA<br />
<br />
VAR IPADDRESS1<br />
VAR PORT1<br />
VAR REQAUTH1  <br />
VAR IPADDRESS2<br />
VAR PORT2<br />
VAR REQAUTH2<br />
VAR PROXYREQ<br />
<br />
VAR HTTPPROXY<br />
VAR HTTPSPROXY<br />
<br />
<br />
<br />
<br />
Var tmp<br />
Var tmpstate ; holds the value of the state<br />
Var tmpstate2<br />
Var tmphwnd ; holds the hwnd of the element<br />
<br />
;reads the hwnd from the ini file and sets the state of the element<br />
!macro CHANGEELEMENT ELEMENT STATEVAL<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $tmphwnd &quot;xBConfig.ini&quot; &quot;${ELEMENT}&quot; &quot;HWND&quot;<br />
	EnableWindow $tmphwnd ${STATEVAL}<br />
<br />
  ; Put state change in flags of element as well<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $tmp &quot;xBConfig.ini&quot; &quot;${ELEMENT}&quot; &quot;Flags&quot;<br />
	${If} &quot;${STATEVAL}&quot; == &quot;1&quot;<br />
	  ${WordReplace} $tmp &quot;DISABLED&quot; &quot;&quot; &quot;+&quot; $tmp<br />
		${WordReplace} $tmp &quot;||&quot; &quot;|&quot; &quot;+&quot; $tmp<br />
		!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;xBConfig.ini&quot; &quot;${ELEMENT}&quot; &quot;Flags&quot; $tmp<br />
	${Else}<br />
    !insertmacro MUI_INSTALLOPTIONS_READ $tmp &quot;xBConfig.ini&quot; &quot;${ELEMENT}&quot; &quot;Flags&quot;<br />
		!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;xBConfig.ini&quot; &quot;${ELEMENT}&quot; &quot;Flags&quot; &quot;$tmp|DISABLED&quot;<br />
	${EndIf}<br />
	<br />
	<br />
	<br />
!macroend<br />
<br />
;change the state of a group of elements<br />
!macro CHANGEGROUPSTATE STATEVALUE<br />
<br />
  !insertmacro CHANGEELEMENT &quot;${UIIPADDRESS1}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIPORT1}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIREQAUTH1}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIIPADDRESS2}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIPORT2}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIREQAUTH2}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIAUTODETECT}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIHTTPLABEL}&quot; &quot;${STATEVALUE}&quot;<br />
  !insertmacro CHANGEELEMENT &quot;${UIHTTPSLABEL}&quot; &quot;${STATEVALUE}&quot;<br />
	<br />
!macroend<br />
<br />
!macro CHANGEGROUPSTATE2 STATEVALUE<br />
	!insertmacro CHANGEELEMENT &quot;${UITORTIMEOUT}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UISOCKSPORT}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UICONTROLPORT}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UICIRCUITLABEL}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UICONTROLLABEL}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UISOCKSLABEL}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UITORCOMLABEL}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UITORCOMMANDS}&quot; &quot;${STATEVALUE}&quot;<br />
	!insertmacro CHANGEELEMENT &quot;${UIDELDIRDATA}&quot; &quot;${STATEVALUE}&quot;<br />
!macroend<br />
<br />
;change text field and put value in ini file<br />
!macro CHANGETEXTFIELD ELEMENT VALUE<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE ${VALUE} &quot;xBConfig.ini&quot; &quot;${ELEMENT}&quot; &quot;State&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $tmp &quot;xBConfig.ini&quot; &quot;${ELEMENT}&quot; &quot;HWND&quot;<br />
	SendMessage $tmp ${WM_SETTEXT} 0 &quot;STR:${VALUE}&quot;<br />
!macroend<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  <br />
  ;ADD YOUR OWN FILES HERE...<br />
  <br />
  ;Store installation folder<br />
 <br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Installer Functions<br />
<br />
Function .onInit<br />
<br />
  ;Extract InstallOptions INI files<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;xBConfig.ini&quot;<br />
  <br />
FunctionEnd<br />
<br />
LangString TEXT_IO_TITLE ${LANG_ENGLISH} &quot;XeroBank Configuration Wizard&quot;<br />
LangString TEXT_IO_SUBTITLE ${LANG_ENGLISH} &quot;Generates XeroBank INI Files&quot;<br />
<br />
Function InitPage<br />
<br />
  !insertmacro MUI_HEADER_TEXT &quot;$(TEXT_IO_TITLE)&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;xBConfig.ini&quot;<br />
<br />
FunctionEnd<br />
<br />
Function LeavePage<br />
  ; handle notify event of element<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $tmp &quot;xBConfig.ini&quot; &quot;Settings&quot; &quot;State&quot;	<br />
	${Switch} &quot;Field $tmp&quot;<br />
    ${Case} &quot;${UIPROXYREQ}&quot;<br />
      !insertmacro MUI_INSTALLOPTIONS_READ $tmpstate &quot;xBConfig.ini&quot; &quot;${UIPROXYREQ}&quot; &quot;State&quot;<br />
		  !insertmacro CHANGEGROUPSTATE $tmpstate<br />
			Abort<br />
	${Case} &quot;${UIAUTODETECT}&quot;<br />
		Call GetProxySettings<br />
<br />
			;fill in ini-file and change text<br />
		!insertmacro CHANGETEXTFIELD &quot;${UIIPADDRESS1}&quot; &quot;$IPADDRESS1&quot;<br />
		!insertmacro CHANGETEXTFIELD &quot;${UIPORT1}&quot; &quot;$PORT1&quot;<br />
		!insertmacro CHANGETEXTFIELD &quot;${UIIPADDRESS2}&quot; &quot;$IPADDRESS2&quot;<br />
		!insertmacro CHANGETEXTFIELD &quot;${UIPORT2}&quot; &quot;$PORT2&quot;<br />
<br />
		!insertmacro MUI_INSTALLOPTIONS_WRITE $IPADDRESS1 &quot;xBConfig.ini&quot; &quot;${UIIPADDRESS1}&quot; &quot;State&quot;<br />
		!insertmacro MUI_INSTALLOPTIONS_WRITE $PORT1 &quot;xBConfig.ini&quot; &quot;${UIPORT1}&quot; &quot;State&quot;<br />
		!insertmacro MUI_INSTALLOPTIONS_WRITE $IPADDRESS2 &quot;xBConfig.ini&quot; &quot;${UIIPADDRESS2}&quot; &quot;State&quot;<br />
		!insertmacro MUI_INSTALLOPTIONS_WRITE $PORT2 &quot;xBConfig.ini&quot; &quot;${UIPORT2}&quot; &quot;State&quot;<br />
		Abort<br />
<br />
    ${Case} &quot;${UIDISABLETOR}&quot;<br />
                    !insertmacro MUI_INSTALLOPTIONS_READ $tmpstate2 &quot;xBConfig.ini&quot; &quot;${UIDISABLETOR}&quot; &quot;State&quot;<br />
                    ${If} $tmpstate2 == &quot;1&quot;<br />
                       StrCpy $tmpstate2 &quot;0&quot;<br />
                    ${Else}<br />
                       StrCpy $tmpstate2 &quot;1&quot;<br />
                    ${EndIf}<br />
                    !insertmacro CHANGEGROUPSTATE2 $tmpstate2<br />
                    Abort<br />
	${EndSwitch}<br />
	<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $IPADDRESS1 &quot;xBConfig.ini&quot; &quot;${UIIPADDRESS1}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $PORT1 &quot;xBConfig.ini&quot; &quot;${UIPORT1}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $IPADDRESS2 &quot;xBConfig.ini&quot; &quot;${UIIPADDRESS2}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $PORT2 &quot;xBConfig.ini&quot; &quot;${UIPORT2}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $PROXYREQ &quot;xBConfig.ini&quot; &quot;${UIPROXYREQ}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $DISABLEWARNING &quot;xBConfig.ini&quot; &quot;${UIDISABLEWARNING}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $DISABLESPLASH &quot;xBConfig.ini&quot; &quot;${UIDISABLESPLASH}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $DISABLETOR &quot;xBConfig.ini&quot; &quot;${UIDISABLETOR}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $WAITFORCIRCUIT &quot;xBConfig.ini&quot; &quot;${UIWAITFORCIRCUIT}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $TORTIMEOUT &quot;xBConfig.ini&quot; &quot;${UITORTIMEOUT}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $CONTROLPORT &quot;xBConfig.ini&quot; &quot;${UICONTROLPORT}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $SOCKSPORT &quot;xBConfig.ini&quot; &quot;${UISOCKSPORT}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $REQAUTH1 &quot;xBConfig.ini&quot; &quot;${UIREQAUTH1}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $REQAUTH2 &quot;xBConfig.ini&quot; &quot;${UIREQAUTH2}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $DEBUGON &quot;xBConfig.ini&quot; &quot;${UIDEBUGON}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $TORCOMMANDS &quot;xBConfig.ini&quot; &quot;${UITORCOMMANDS}&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $DELDIRDATA &quot;xBConfig.ini&quot; &quot;${UIDELDIRDATA}&quot; &quot;State&quot;<br />
<br />
	<br />
	;	convert 1 = true, 0 = false<br />
	${If} $DISABLEWARNING = 1<br />
		StrCpy $DISABLEWARNING &quot;true&quot;<br />
		${ElseIf} $DISABLEWARNING = 0<br />
			StrCpy $DISABLEWARNING &quot;false&quot;<br />
	${EndIf}<br />
	<br />
	${If} $DISABLESPLASH = 1<br />
		StrCpy $DISABLESPLASH &quot;true&quot;<br />
		${ElseIf} $DISABLESPLASH = 0<br />
			StrCpy $DISABLESPLASH &quot;false&quot;<br />
	${EndIf}<br />
	<br />
	${If} $DISABLETOR = 1<br />
		StrCpy $DISABLETOR &quot;true&quot;<br />
		${ElseIf} $DISABLETOR = 0<br />
			StrCpy $DISABLETOR &quot;false&quot;<br />
	${EndIf}<br />
	<br />
	${If} $WAITFORCIRCUIT = 1<br />
		StrCpy $WAITFORCIRCUIT &quot;true&quot;<br />
		${ElseIf} $WAITFORCIRCUIT = 0<br />
			StrCpy $WAITFORCIRCUIT &quot;false&quot;<br />
	${EndIf}<br />
	<br />
	${If} $DELDIRDATA = 1<br />
		StrCpy $DELDIRDATA &quot;true&quot;<br />
		${ElseIf} $DELDIRDATA = 0<br />
			StrCpy $DELDIRDATA &quot;false&quot;<br />
	${EndIf}<br />
<br />
	<br />
		; TODO: save values to ini file/registry...<br />
	${If} $DEBUGON = 1 		;To create the log file, we need debugon to be written as 2, a 1 will just cause popups.<br />
		StrCpy $DEBUGON 2<br />
	${EndIf}<br />
	<br />
	FileOpen $6 &quot;$EXEDIR\..\XeroBank.ini&quot; w<br />
	FileWrite $6 &quot;;Don't use Notepad to read or wite to this file. Use some other text editor like Wordpad. $\r&quot;<br />
	FileWrite $6 &quot;;If you need to manually upgrade to XeroBank service, ServiceLevel 1 is XeroBank Basic, 2 is XeroBank Plus, and 3 is XeroBank Pro$\r&quot;<br />
	FileWrite $6 &quot;;If upgrading to XeroBank Basic, put the XeroBank.key file in the \Data\XeroBank\ directory$\r&quot; <br />
	FileWrite $6 &quot;;If you are manually adding your proxy credentials, then set the ProxyAuths like so: username:password$\r$\r&quot;<br />
<br />
;*************************************** Write the XeroBank Section *******************************<br />
	FileWrite $6 &quot;[XeroBank]$\r&quot;<br />
	FileWrite $6 &quot;TorDirectory=App\tor$\r&quot;<br />
	FileWrite $6 &quot;OutPath=App$\r&quot;<br />
	FileWrite $6 &quot;TimerMax=$TORTIMEOUT$\r&quot;<br />
	FileWrite $6 &quot;ServiceLevel=$\r&quot;<br />
	FileWrite $6 &quot;WaitForTorCircuit=$WAITFORCIRCUIT$\r&quot;<br />
	FileWrite $6 &quot;SubmissiveMode=$DISABLETOR$\r&quot;<br />
	FileWrite $6 &quot;DeleteDirData=$DELDIRDATA$\r&quot;<br />
	FileWrite $6 &quot;SOCKSPort=$SOCKSPort$\r&quot;<br />
	FileWrite $6 &quot;ControlPort=$ControlPort$\r&quot;<br />
	FileWrite $6 &quot;DebugOn=$DebugOn$\r&quot;<br />
	FileWrite $6 &quot;TorCommands=$TorCommands$\r&quot;<br />
	FileWrite $6 &quot;GnuPGPATHDIRECTORYApp\gpg$\r&quot;<br />
	FileWrite $6 &quot;GnuPGHOMEDIRECTORY=Data\gpg$\r&quot;<br />
	<br />
;****************************** Write the proxy data to the XeroBank section ***************************<br />
<br />
	${If} $PROXYREQ = 1 ;If there is a proxy, write out the proxy data<br />
		FileWrite $6 &quot;ProxyRequired=Yes$\r&quot;<br />
		${If} $IPADDRESS1 != &quot;IP Address&quot;<br />
			FileWrite $6 &quot;HttpProxyAddress=$IPADDRESS1$\r&quot;<br />
			FileWrite $6 &quot;HttpProxyPort=$PORT1$\r&quot;<br />
			${If} $REQAUTH1 = 1<br />
				FileWrite $6 &quot;HttpProxyAuth=Ask$\r&quot;<br />
				${ElseIf} $REQAUTH1 = 0<br />
					FileWrite $6 &quot;HttpProxyAuth=No$\r&quot;<br />
			${EndIf}<br />
		${ElseIf} $IPADDRESS1 == &quot;IP Address&quot;<br />
			FileWrite $6 &quot;HttpProxyAddress=$\r&quot;<br />
			FileWrite $6 &quot;HttpProxyPort=$\r&quot;<br />
			FileWrite $6 &quot;HttpProxyAuth=$\r&quot;<br />
		${EndIf}<br />
		${If} $IPADDRESS2 != &quot;IP Address&quot;<br />
			FileWrite $6 &quot;HttpsProxyAddress=$IPADDRESS2$\r&quot;<br />
			FileWrite $6 &quot;HttpsProxyPort=$PORT2$\r&quot;<br />
			${If} $REQAUTH2 = 1<br />
				FileWrite $6 &quot;HttpsProxyAuth=Ask$\r&quot;<br />
				${ElseIf} $REQAUTH2 = 0<br />
					FileWrite $6 &quot;HttpsProxyAuth=No$\r&quot;<br />
			${EndIf}<br />
		${ElseIf} $IPADDRESS2 == &quot;IP Address&quot;<br />
			FileWrite $6 &quot;HttpsProxyAddress=$\r&quot;<br />
			FileWrite $6 &quot;HttpsProxyPort=$\r&quot;<br />
			FileWrite $6 &quot;HttpsProxyAuth=$\r&quot;<br />
	${EndIf}<br />
		<br />
	${ElseIf} $PROXYREQ = 0		;If there is no proxy, zero out the lines.<br />
		FileWrite $6 &quot;ProxyRequired=No$\r&quot;<br />
		FileWrite $6 &quot;HttpProxyAddress=$\r&quot;<br />
		FileWrite $6 &quot;HttpProxyPort=$\r&quot;<br />
		FileWrite $6 &quot;HttpProxyAuth=$\r&quot;<br />
		FileWrite $6 &quot;HttpsProxyAddress=$\r&quot;<br />
		FileWrite $6 &quot;HttpsProxyPort=$\r&quot;<br />
		FileWrite $6 &quot;HttpsProxyAuth=$\r&quot;<br />
	${EndIf}<br />
<br />
;******************************************** Now Write the Browser Prefs *********************<br />
	FileWrite $6 &quot;$\r&quot;<br />
	FileWrite $6 &quot;[${BROWSERNAME}]$\r&quot;<br />
	FileWrite $6 &quot;ProgramDirectory=App\Browser\firefox$\r&quot;<br />
	FileWrite $6 &quot;ProgramExecutable=firefox.exe$\r&quot;<br />
	FileWrite $6 &quot;ProfileDirectory=Data\Browser\profile$\r&quot;<br />
	FileWrite $6 &quot;PluginsDirectory=Data\Browser\plugins$\r&quot;<br />
	FileWrite $6 &quot;TempDirectory=App\Browser\temp$\r&quot;<br />
	FileWrite $6 &quot;UserProfileDirectory=Data\Browser\userprofile$\r&quot;<br />
	FileWrite $6 &quot;DisableSplashScreen=$DISABLESPLASH$\r&quot;<br />
	FileWrite $6 &quot;DisableWarning=$DISABLEWARNING$\r&quot;<br />
	FileWrite $6 &quot;SkipChromeFix=false$\r&quot;<br />
	FileWrite $6 &quot;SkipCompregFix=false$\r&quot;<br />
	FileWrite $6 &quot;LocalHomePage=$\r&quot;<br />
	<br />
;******************************************** Now Write the Mail Prefs *********************<br />
	FileWrite $6 &quot;$\r&quot;<br />
	FileWrite $6 &quot;[${MAILCLIENTNAME}]$\r&quot;<br />
	FileWrite $6 &quot;ProgramDirectory=App\Mail\thunderbird$\r&quot;<br />
	FileWrite $6 &quot;ProgramExecutable=thunderbird.exe$\r&quot;<br />
	FileWrite $6 &quot;ProfileDirectory=Data\thunderbird\profile$\r&quot;<br />
	FileWrite $6 &quot;PluginsDirectory=Data\thunderbird\plugins$\r&quot;<br />
	FileWrite $6 &quot;TempDirectory=App\thunderbird\temp$\r&quot;<br />
	FileWrite $6 &quot;UserProfileDirectory=Data\thunderbird\userprofile$\r&quot;<br />
	FileWrite $6 &quot;DisableSplashScreen=$DISABLESPLASH$\r&quot;<br />
	FileWrite $6 &quot;DisableWarning=$DISABLEWARNING$\r&quot;<br />
	FileWrite $6 &quot;SkipChromeFix=false$\r&quot;<br />
	FileWrite $6 &quot;SkipCompregFix=false$\r&quot;<br />
	<br />
;********************************************* And now close the file **************************	<br />
	FileClose $6<br />
	<br />
;	Firewall-Disabler::QueryFirewall<br />
;	Pop $R0 <br />
;	StrCmp $R0 &quot;1&quot; &quot;&quot; +2<br />
;	Messagebox MB_OK &quot;xBConfig has detected that the Windows Firewall is enabled.$\nIf you experience trouble with XeroBank software, try disabling it.&quot;<br />
FunctionEnd<br />
<br />
Function GetProxySettings<br />
	ReadRegDWORD $R0 HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot; ProxyEnable ;Check registry to see if proxy is enabled<br />
	${If} $R0 = 1 <br />
		ReadRegStr $R0 HKCU &quot;Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot; ProxyServer ;Read the proxy string from the reg.<br />
		${WordFind2X} &quot;$R0&quot; &quot;http=&quot; &quot;;&quot; &quot;E+1&quot; $3 ;Get http proxy data. if error, set to 1<br />
		${If} $3 != 1 ;If there is no error, do the following<br />
			StrCpy $HTTPPROXY $3<br />
			${WordFind} &quot;$HTTPPROXY&quot; &quot;:&quot; &quot;+1&quot; $IPADDRESS1 	 <br />
			${WordFind} &quot;$HTTPPROXY&quot; &quot;:&quot; &quot;-1&quot; $PORT1<br />
		${EndIf}<br />
		${WordFind2X} &quot;$R0&quot; &quot;https=&quot; &quot;;&quot; &quot;E+1&quot; $3 ;Get https proxy data. if error, set to 1<br />
		${If} $3 != 1 ;If there is no error, do the follwing:<br />
			StrCpy $HTTPSPROXY $3<br />
			${WordFind} &quot;$HTTPSPROXY&quot; &quot;:&quot; &quot;+1&quot; $IPADDRESS2   ;Split it up<br />
			${WordFind} &quot;$HTTPSPROXY&quot; &quot;:&quot; &quot;-1&quot; $PORT2<br />
		${EndIf}<br />
	${ElseIf} $R0 = 0<br />
		MessageBox MB_OK &quot;No Proxy Data Found. Assuming Direct Connection to Internet&quot;<br />
	${EndIf}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th October 2007, 10:57</div></div><div class="posttext">Please attach large scripts.<br />
<br />
One note is do not mix and match MUI pages with standard pages, i.e. do not use Page Directory, use !insertmacro MUI_PAGE_DIRECTORY.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">torpark</div><div class="date">15th October 2007, 20:49</div></div><div class="posttext">Okay good news. I've got it doing most of what I want it to do.<br />
<br />
X 0. Display the License<br />
X 1. Install the program<br />
 X a. Ask the directory<br />
 X b. Create some temp files and extract<br />
2. Get Proxy Information<br />
 X a. Firewall test<br />
 X b. Use It<br />
X 3. Take serial number and download program using serial data.<br />
   a. Change box colors.<br />
X 4. Create Icons.<br />
<br />
So we still have some issues.<br />
<br />
How can I change the serial box colors? (passdialog plugin)<br />
<br />
In the example below, the code changes the color. How do I do that with my code? How do I figure out the values?<br />
<br />
<br />
Name    &quot;PassDialog InputBox&quot;<br />
OutFile &quot;PassDialog-InputBox.exe&quot;<br />
<br />
## Include headers<br />
!include MUI.nsh<br />
<br />
## Pages<br />
 !insertmacro MUI_PAGE_WELCOME<br />
 Page Custom InputBoxPageShow InputBoxPageLeave<br />
 !insertmacro MUI_PAGE_COMPONENTS<br />
 !insertmacro MUI_PAGE_INSTFILES<br />
<br />
## Password is<br />
!define Password &quot;blah&quot;<br />
!define Username &quot;Jeff&quot;<br />
<br />
## Control ID's<br />
!define IDC_INPUTBOX 1216<br />
<br />
## Languages<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
## Displays the input box dialog<br />
Function InputBoxPageShow<br />
<br />
 !insertmacro MUI_HEADER_TEXT &quot;Enter Details&quot; &quot;Enter your details.&quot;<br />
<br />
 PassDialog::InitDialog /NOUNLOAD InputBox /BOX &quot;ja&quot; &quot;hello&quot; 0<br />
  Pop $R0 # Page HWND<br />
<br />
  GetDlgItem $R1 $R0 ${IDC_INPUTBOX}<br />
  SetCtlColors $R1 0xFF0000 0xFFFF00<br />
<br />
 PassDialog::Show<br />
<br />
FunctionEnd<br />
<br />
## Validate inpu<br />
Function InputBoxPageLeave<br />
<br />
 ## Pop details from stack<br />
 Pop $R0<br />
<br />
 ## Display the details<br />
 MessageBox MB_OK|MB_ICONINFORMATION &quot;You entered: $R0 !&quot;<br />
<br />
FunctionEnd<br />
<br />
## Just a dummy section<br />
Section 'A section'<br />
SectionEnd<br />
<br />
<br />
And here is my code for the serial box:<br />
<br />
<br />
Function InitPage<br />
<br />
!insertmacro MUI_HEADER_TEXT &quot;Upgrade xB Browser&quot; &quot;Enable XeroBank Plus Service&quot;<br />
<br />
 PassDialog::Dialog Serial            \<br />
                    /HEADINGTEXT 'Enter your XeroBank Transaction ID, displayed when you login at xerobank.com' \<br />
                    /CENTER             \<br />
                    /BOXDASH 12  50 4 '' \<br />
                    /BOXDASH 72  50 4 ''  \<br />
                    /BOXDASH 132 50 4 ''   \<br />
                    /BOX	 192 50 4 ''    \<br />
                    <br />
<br />
  Pop $R0 # success, back, cancel or error<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th October 2007, 21:27</div></div><div class="posttext">Notice the InitDialog and Show calls and what is in between.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">torpark</div><div class="date">15th October 2007, 21:41</div></div><div class="posttext">The ${IDC_INPUTBOX} however, is from up above. And that seems to make all the difference in the world. What would be the corresponding !define Control ID(s) and # for the serial boxes?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th October 2007, 08:34</div></div><div class="posttext">I believe it tells you in the readme file.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>