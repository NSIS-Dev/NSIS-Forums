<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How do i get a list of installed printers?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How do i get a list of installed printers? NSIS Discussion" />
	
	<title> How do i get a list of installed printers? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How do i get a list of installed printers?</div>
<hr />
<div class="pda"><a href="t-103943.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=103943">How do i get a list of installed printers?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">6th September 2002, 17:12</div></div><div class="posttext">Is it possible to get a list of installed Printers, the ports they are installed onto and their share name?<br />
<br />
I know that the printers are listed in win.ini but is there another way, plus there is no share names in there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th September 2002, 17:37</div></div><div class="posttext">Create an extension DLL that uses EnumPrinters.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">9th September 2002, 11:47</div></div><div class="posttext">I don't know how to create a DLL. Is it a big job?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">veekee</div><div class="date">9th September 2002, 12:22</div></div><div class="posttext">printers may be in the registry ... try to search them ;) (can't do it by my self, i'm currently on Linux :D)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">9th September 2002, 14:43</div></div><div class="posttext">I believe they are but how do you tell nsis to search for a key when you don't know what it is called.<br />
<br />
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Print\Printers\HP LaserJet 4 in Corridor<br />
<br />
The last part of the key is the Printer Name displayed in the Printers folder (win 98).<br />
<br />
How can i utilise this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">9th September 2002, 15:21</div></div><div class="posttext">Look at EnumRegKey in the makensis.htm.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2002, 16:41</div></div><div class="posttext">EnumPrinters is the safest way to go. I will try to write you a simple DLL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">9th September 2002, 16:55</div></div><div class="posttext">Thanx guys</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2002, 17:54</div></div><div class="posttext">Code example included inside the ZIP file. Enjoy :D<br />
<br />
BTW, a lot more info can be gathered. Have a look here (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/gdi/prntspol_9otu.asp) to see how much.<br />
<br />
Note to plug-in developers: this is also a simple example of how to use the new /NOUNLOAD thingy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">9th September 2002, 19:33</div></div><div class="posttext">I'm sorry but i don't understand how to use the example.  Can anyone help?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2002, 19:36</div></div><div class="posttext">What exactly don't you understand? If you can be a little more specific I can help you better ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">9th September 2002, 19:55</div></div><div class="posttext">As you may have guessed i'm not that up on programming and stuff. Sorry to be a pain.  This is all a learning curve to me.<br />
<br />
I don't no where to put :<br />
<br />
; printers enumeration starts at 1<br />
StrCpy $R0 1<br />
enum_printers:<br />
	Printers::GetPrinterInfo /NOUNLOAD $R0<br />
	Pop $0<br />
	; First pop == 0, no more printers<br />
	StrCmp $0 &quot;&quot; enum_printers_done<br />
		Pop $1<br />
		Pop $2<br />
		Pop $3<br />
		MessageBox MB_OK &quot;Name: $0$\nServer name: $1$\nShare name: $2$\nPort name: $3&quot;<br />
		IntOp $R0 $R0 + 1<br />
		Goto enum_printers<br />
enum_printers_done:<br />
	; unload the DLL<br />
	Printers::GetPrinterInfo $R0<br />
<br />
Do i put it in a section or what?<br />
<br />
When i do i get &quot;Invalid Command : Printers::GetPrinterInfo&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th September 2002, 20:00</div></div><div class="posttext">You must put Printers.dll in your plug-ins directory, or use PluginDir, then it will find the command. After you did that you can put that code piece any where you want. I think you will understand it all from there, don't be afraid to ask again if you still don't.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">9th September 2002, 20:44</div></div><div class="posttext">I don't understand. I must be missing something simple.<br />
<br />
Compiler results....<br />
<br />
Processing plugin dlls: &quot;C:\Program Files\NSIS\plugins\*.dll&quot;<br />
 - InstallOptions.dll::dialog<br />
 - LangDLL.dll::LangDialog<br />
 - nsisdl.dll::download<br />
 - nsisdl.dll::download_quiet<br />
 - Printers.dll::GetPrinterInfo<br />
<br />
<br />
Processing config: <br />
Changing directory to: &quot;C:\Software\Software Development\NSIS\printers\Printers&quot;<br />
<br />
<br />
Processing script file: &quot;C:\Software\Software Development\NSIS\printers\Printers\printers.nsi&quot;<br />
OutFile: &quot;printers.exe&quot;<br />
Name: &quot;Printers Test&quot;<br />
Section: &quot;&quot;<br />
StrCpy $R0 &quot;1&quot; () ()<br />
Invalid command: Printers::GetPrinterInfo<br />
Error in script &quot;C:\Software\Software Development\NSIS\printers\Printers\printers.nsi&quot; on line 9 -- aborting creation process<br />
<br />
My simple script ...<br />
<br />
outfile printers.exe<br />
name &quot;Printers Test&quot;<br />
<br />
Section<br />
<br />
; printers enumeration starts at 1<br />
StrCpy $R0 1<br />
enum_printers:<br />
	Printers::GetPrinterInfo /NOUNLOAD $R0<br />
	Pop $0<br />
	; First pop == 0, no more printers<br />
	StrCmp $0 &quot;&quot; enum_printers_done<br />
		Pop $1<br />
		Pop $2<br />
		Pop $3<br />
		MessageBox MB_OK &quot;Name: $0$\nServer name: $1$\nShare name: $2$\nPort name: $3&quot;<br />
		IntOp $R0 $R0 + 1<br />
		Goto enum_printers<br />
enum_printers_done:<br />
	; unload the DLL<br />
	Printers::GetPrinterInfo $R0<br />
SectionEnd<br />
<br />
Do i need anything else?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th September 2002, 06:45</div></div><div class="posttext">What NSIS version do you use? If you don't use the latest CVS version you will need to call GetPrintersInfo without Printers:: infront of it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dizzy007</div><div class="date">11th September 2002, 08:14</div></div><div class="posttext">Hi!<br />
<br />
I've got the same problem.<br />
I use NSIS198 downloaded from http://www.nullsoft.com/free/nsis.<br />
<br />
So, after installation i haven't got a &quot;plugin-dir&quot;.<br />
I have created one under c:\Programme\NSIS\plugins and copied the<br />
printers.dll into it. <br />
I inserted &quot;PluginDir&quot; into the code but i still get errors.<br />
<br />
*****************<br />
Changing directory to: &quot;C:\8\Printers&quot;<br />
<br />
Processing script file: &quot;C:\8\Printers\printer.nsi&quot;<br />
OutFile: &quot;printer.exe&quot;<br />
Name: &quot;Print&quot;<br />
Invalid command: PluginDir<br />
Error in script &quot;C:\8\Printers\printer.nsi&quot; on line 4 -- aborting creation process<br />
******************<br />
<br />
<br />
My code :<br />
=========<br />
outfile printer.exe<br />
name Print<br />
<br />
PluginDir C:\Programme\NSIS\plugins\<br />
<br />
<br />
; printers enumeration starts at 1<br />
StrCpy $R0 1<br />
enum_printers:<br />
  Printers::GetPrinterInfo /NOUNLOAD $R0<br />
  Pop $0<br />
  ; First pop == 0, no more printers<br />
  StrCmp $0 &quot;&quot; enum_printers_done<br />
    Pop $1<br />
    Pop $2<br />
    Pop $3<br />
    MessageBox MB_OK &quot;Name: $0$\nServer name: $1$\nShare name: $2$\nPort name: $3&quot;<br />
    IntOp $R0 $R0 + 1<br />
    Goto enum_printers<br />
enum_printers_done:<br />
  ; unload the DLL<br />
  Printers::GetPrinterInfo $R0<br />
<br />
===================================================<br />
Can someone tell me :<br />
--&gt; where i have to put the plugindir?<br />
--&gt; how to tell the compiler to use the plugins<br />
--&gt; and if possible : the hole printer.nsi the get the printers out of the registry ??<br />
<br />
I really would be happy!<br />
<br />
Thanks <br />
Jens</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th September 2002, 08:34</div></div><div class="posttext">Simplified calling of plug-ins (dllname::function) was introduced in NSIS 2.0a4 by Sunjammer.<br />
It doesn't work on NSIS 1.98.<br />
Either download NSIS 2, or use the old fashioned way (GetTempFileName, File /oname, Push, CallInstDLL).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">11th September 2002, 09:34</div></div><div class="posttext">OK my NSIS wasn't the most up to date.<br />
<br />
This works for 1.98<br />
<br />
; printers enumeration starts at 1<br />
StrCpy $R0 1<br />
enum_printers:<br />
        Push $R0<br />
        CallInstDLL $TEMP\Printers.dll GetPrinterInfo<br />
        Pop $0<br />
	; First pop == 0, no more printers<br />
	StrCmp $0 &quot;&quot; enum_printers_done<br />
		Pop $1<br />
		Pop $2<br />
		Pop $3<br />
		MessageBox MB_OK &quot;Name: $0$\nServer name: $1$\nShare name: $2$\nPort name: $3&quot;<br />
		IntOp $R0 $R0 + 1<br />
		Goto enum_printers<br />
        enum_printers_done:<br />
<br />
<br />
Do you need to unload the DLL in any way if you use the old CallInstDLL method?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dizzy007</div><div class="date">11th September 2002, 13:50</div></div><div class="posttext">Yes - this works with nsis 1.98 - THANKS<br />
but ... <br />
is there a function to get the network printer as well??<br />
<br />
Regards <br />
Jens<br />
<br />
[edited by kichik, script not needed here]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sailo</div><div class="date">11th September 2002, 14:56</div></div><div class="posttext">The printers.dll was intended to get a list of printers installed on the machine that you are running it on.<br />
<br />
If you want a list of printers installed on all machines across your network that is a compleletly different thing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th September 2002, 11:37</div></div><div class="posttext">Do you need to unload the DLL in any way if you use the old CallInstDLL method?<br />
NSIS automatically unloads the DLL after it calls it with CallInstDLL, unless you specify /NOUNLOAD (only available from a7 and above [maybe 6...])<br />
<br />
is there a function to get the network printer as well??<br />
<br />
Do you mean all printers installed on the network, or only the printers the user has installed drivers for in his computer?<br />
If the user installed a driver, you will see it with this function.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>