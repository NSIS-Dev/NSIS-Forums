<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Custom pages and registry settings, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Custom pages and registry settings NSIS Discussion" />
	
	<title> Custom pages and registry settings [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Custom pages and registry settings</div>
<hr />
<div class="pda"><a href="t-210008.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210008">Custom pages and registry settings</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">10th March 2005, 07:53</div></div><div class="posttext">I have a custom page that I made and i would like whatever is put in the TEXT fields to be saved to the registry in windows.<br />
Thx for any help you can provide.<br />
<br />
[Settings]<br />
NumFields=4<br />
<br />
[Field 1]<br />
Type=Label<br />
Text=Name<br />
Left=0<br />
Right=-1<br />
Top=0<br />
Bottom=10<br />
<br />
[Field 2]<br />
Type=Text<br />
Left=0<br />
Right=-1<br />
Top=10<br />
Bottom=20<br />
<br />
<br />
[Field 3]<br />
Type=Label<br />
Text=Serial Number<br />
Left=0<br />
Right=-1<br />
Top=40<br />
Bottom=50<br />
<br />
[Field 4]<br />
Type=Text<br />
Left=0<br />
Right=-1<br />
Top=50<br />
Bottom=60</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 08:37</div></div><div class="posttext">In the page's Leave function, use ReadINIStr to retrieve the Text string, and then write it to the registry using WriteRegStr.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">10th March 2005, 08:54</div></div><div class="posttext">sry, don't know where the documentation for that is, can you put it in one fo the example scripts so that I can figure out where it goes, Thx alot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 12:21</div></div><div class="posttext">ReadINIStr and WriteINIStr are in the NSIS documentation.<br />
For example:<br />
Page Custom customPage customPageLeave<br />
<br />
Function customPageLeave<br />
 Push $R0<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\ioFile.ini&quot; &quot;Field 1&quot; &quot;Text&quot;<br />
  WriteRegStr HKCU &quot;Software\MyApp&quot; &quot;Blah&quot; &quot;$R0&quot;<br />
 Pop $R0<br />
FunctionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">10th March 2005, 16:22</div></div><div class="posttext">It is creating the registry entryis now but it isn't putting anything in them. Thx for the help but I must be missing something.<br />
<br />
Function customPageA<br />
!insertmacro MUI_HEADER_TEXT &quot;Registration&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;registry.ini&quot;<br />
 Push $R0<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\registry.ini&quot; &quot;Field 2&quot; &quot;Text&quot;<br />
  WriteRegStr HKCU &quot;Software\AirSnare&quot; &quot;UserName&quot; &quot;$R0&quot;<br />
 Pop $R0<br />
 Push $R1<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\registry.ini&quot; &quot;Field 4&quot; &quot;Text&quot;<br />
  WriteRegStr HKCU &quot;Software\AirSnare&quot; &quot;Serial&quot; &quot;$R1&quot;<br />
 Pop $R1<br />
FunctionEnd <br />
<br />
Same INI as above</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 18:01</div></div><div class="posttext">You are reading from INI file into $R0, but writing variable $R1 to registry.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">10th March 2005, 19:39</div></div><div class="posttext">OK, Thx but still there is nothing in the data field of the registry key<br />
<br />
<br />
Function customPageA<br />
!insertmacro MUI_HEADER_TEXT &quot;Registration&quot; &quot;$(TEXT_IO_SUBTITLE)&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;registry.ini&quot;<br />
 Push $R0<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\registry.ini&quot; &quot;Field 2&quot; &quot;Text&quot;<br />
  WriteRegStr HKCU &quot;Software\AirSnare&quot; &quot;UserName&quot; &quot;$R0&quot;<br />
 Pop $R0<br />
 Push $R0<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\registry.ini&quot; &quot;Field 4&quot; &quot;Text&quot;<br />
  WriteRegStr HKCU &quot;Software\AirSnare&quot; &quot;Serial&quot; &quot;$R0&quot;<br />
 Pop $R0<br />
FunctionEnd <br />
<br />
<br />
<br />
[Settings]<br />
NumFields=4<br />
<br />
[Field 1]<br />
Type=Label<br />
Text=Name<br />
Left=0<br />
Right=-1<br />
Top=0<br />
Bottom=10<br />
<br />
[Field 2]<br />
Type=Text<br />
Text=<br />
Left=0<br />
Right=-1<br />
Top=10<br />
Bottom=20<br />
<br />
<br />
[Field 3]<br />
Type=Label<br />
Text=Serial Number<br />
Left=0<br />
Right=-1<br />
Top=40<br />
Bottom=50<br />
<br />
[Field 4]<br />
Type=Text<br />
Text=<br />
Left=0<br />
Right=-1<br />
Top=50<br />
Bottom=60</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 20:15</div></div><div class="posttext">This code needs to go in the page's Leave function:<br />
<br />
 Push $R0<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\registry.ini&quot; &quot;Field 2&quot; &quot;Text&quot;<br />
  WriteRegStr HKCU &quot;Software\AirSnare&quot; &quot;UserName&quot; &quot;$R0&quot;<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\registry.ini&quot; &quot;Field 4&quot; &quot;Text&quot;<br />
  WriteRegStr HKCU &quot;Software\AirSnare&quot; &quot;Serial&quot; &quot;$R0&quot;<br />
 Pop $R0<br />
<br />
<br />
User input from the InstallOptions dialog are not saved to the INI file until after the user leaves the page. That's why you aren't getting any data.<br />
<br />
Declare the Leave function like so:<br />
Page Custom customPageA customPageALeave<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">11th March 2005, 06:02</div></div><div class="posttext">can you show me what it should look like, please? Thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Installer</div><div class="date">11th March 2005, 07:04</div></div><div class="posttext">hello Installers,<br />
<br />
I have the same problem that you are faceing .<br />
this is a small piece of script<br />
<br />
Function SetContentServer<br />
   Push $R0<br />
   InstallOptions::dialog $PLUGINSDIR\ContentServer_Name.ini<br />
   Pop $R0<br />
   ReadINIStr $1 &quot;$PLUGINSDIR\ContentServer_Name.ini&quot; &quot;Field 2&quot; &quot;Text&quot;<br />
FunctionEnd<br />
<br />
Function SetContentServerLeave<br />
  ;  Push $1<br />
 WriteRegStr HKLM &quot;Software\Legato\ContentServer&quot; &quot;ServerName&quot; &quot;$1&quot;<br />
       <br />
FunctionEnd<br />
<br />
<br />
If i put the text from the Page properties before compilation it writes into the registry. but If i take it from the user at runtime it does not.<br />
<br />
Wht could be the issue?<br />
why does &quot;Var varname&quot; variable decleration  not work ?<br />
<br />
Your help will be appreciated.<br />
<br />
Regards<br />
<br />
Parag</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th March 2005, 11:42</div></div><div class="posttext">The leave function is called when the user clicks the next button, before the InstallOptions::dialog call returns. Simply write the value to the registry right after you read it in SetContentServer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">11th March 2005, 19:39</div></div><div class="posttext">While not vastly experienced in custom pages, I do have *one* and use a slightly different model... :)<br />
<br />
I use an .onInit to check the registry for an existing value for my field - if it is present, I directly update the corresponding field in the [now expanded] INI file.<br />
<br />
BTW, since it makes sense for my case, I use the install options length-validating feature to enforce the length restrictions for my data entry field.  This blocks the user from proceeding past that page until the restrictions are satisfied.<br />
<br />
Then, in the body of the installer section - actually, just before it completes - I do a MUI_INSTALLOPTIONS_READ to get the value of the field, and save it to the registry with a WriteRegStr.<br />
<br />
I am posting this both to make sure that my approach is sound (it does seem to work), and to mention that using the Leave function can have the side-effect of making a registry change (in the case described above) even if the user chooses to back out of (abort) the install...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">12th March 2005, 00:21</div></div><div class="posttext">this is all wonderful info and I hope to put it in my next installer, however, where should I place &quot;Page Custom customPageA customPageALeave &quot;, Thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RDaneel</div><div class="date">12th March 2005, 00:35</div></div><div class="posttext">The &quot;page custom...&quot; would go in the midst of your &quot;!insertmacro MUI_PAGE*&quot; statements.<br />
<br />
It is just saying that you have a custom page and that it has both Enter and Leave functions defined.  The precise placement determines where in the sequence of pages making up your installer it appears.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">12th March 2005, 04:12</div></div><div class="posttext">tried it and got this error and it won't create any .exe now<br />
<br />
Error: resolving leave-page function &quot;customPageALeave&quot; in install pages<br />
Note: uninstall functions must begin with &quot;un.&quot;, and install functions must not<br />
Error - aborting creation process <br />
<br />
Any Ideas? Thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th March 2005, 15:40</div></div><div class="posttext">It means you haven't declared the customPageALeave Function :D<br />
<br />
You need to do it like:<br />
Function customPageALeave<br />
# ... code here ...<br />
FunctionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">12th March 2005, 17:15</div></div><div class="posttext">ok it actually made the Installer but now it still isn't writing the registry keys. See included zip with all the code and .ini's, thx for any help you can provide</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th March 2005, 21:58</div></div><div class="posttext">Put &quot;MessageBox MB_OK $R0&quot; under the first ReadINIStr in your Leave function to see what the value of $R0 is.<br />
<br />
Also you don't need the Pop and Push in the middle.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">13th March 2005, 00:35</div></div><div class="posttext">it isn't capturing the text put in the boxes, nothing is diplayed in the popup</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th March 2005, 00:36</div></div><div class="posttext">Oh wait, if you're reading from a Text field, then you ReadINIStr from &quot;State&quot; not &quot;Text&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dragon_Z</div><div class="date">13th March 2005, 00:40</div></div><div class="posttext">OK, thx now it works, thx for your patience, it is my first project</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>