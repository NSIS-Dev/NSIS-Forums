<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Version Checker Help, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Version Checker Help NSIS Discussion" />
	
	<title> Version Checker Help [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Version Checker Help</div>
<hr />
<div class="pda"><a href="t-176651.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=176651">Version Checker Help</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tribe25</div><div class="date">14th April 2004, 21:21</div></div><div class="posttext">Below is a little script that I am trying to get to work. I keep getting... install function &quot;GetWindowsVersion&quot; not referenced - zeroing code (3-48) out<br />
<br />
I am new to this and don't really understand what that is telling me. Any help would be great. If this does get the Windows version, how would I then tell the installer where to install the files based on the OS. Thanks in advance.<br />
<br />
<br />
<br />
; Asks the user if they really want to install and register the files.<br />
Function .onInit<br />
 MessageBox MB_YESNO &quot;This will install Safari Remote. Do you wish to continue?&quot; IDYES gogogo<br />
   Abort<br />
 gogogo:<br />
FunctionEnd<br />
<br />
<br />
OutFile &quot;Testing.exe&quot;<br />
<br />
Function GetWindowsVersion<br />
<br />
  Push $R0<br />
  Push $R1<br />
<br />
  ClearErrors<br />
<br />
  ReadRegStr $R0 HKLM \<br />
  &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
<br />
  IfErrors 0 lbl_winnt<br />
<br />
  ; we are not NT<br />
  ReadRegStr $R0 HKLM \<br />
  &quot;SOFTWARE\Microsoft\Windows\CurrentVersion&quot; VersionNumber<br />
<br />
  StrCpy $R1 $R0 1<br />
  StrCmp $R1 '4' 0 lbl_error<br />
<br />
  StrCpy $R1 $R0 3<br />
<br />
  StrCmp $R1 '4.0' lbl_win32_95<br />
  StrCmp $R1 '4.9' lbl_win32_ME lbl_win32_98<br />
<br />
  lbl_win32_95:<br />
    StrCpy $R0 '95'<br />
  Goto lbl_done<br />
<br />
  lbl_win32_98:<br />
;;beginning of additions to support win 98 SE<br />
    push $R0<br />
    push &quot;.&quot;<br />
;    call strstr<br />
    pop $R0<br />
    StrCpy $R0 $R0 &quot;&quot; 1<br />
    StrCmp $R0 &quot;10.2222&quot; lbl_win32_98SE<br />
    StrCpy $R0 '98'  ;;this line was not added<br />
  Goto lbl_done      ;;this line was not added either<br />
<br />
  lbl_win32_98SE:<br />
    StrCpy $R0 '98 SE'<br />
  Goto lbl_done<br />
;;end of additions to support win 98 SE<br />
  lbl_win32_ME:<br />
    StrCpy $R0 'ME'<br />
  Goto lbl_done<br />
<br />
  lbl_winnt:<br />
<br />
  StrCpy $R1 $R0 1<br />
<br />
  StrCmp $R1 '3' lbl_winnt_x<br />
  StrCmp $R1 '4' lbl_winnt_x<br />
<br />
  StrCpy $R1 $R0 3<br />
<br />
  StrCmp $R1 '5.0' lbl_winnt_2000<br />
  StrCmp $R1 '5.1' lbl_winnt_XP<br />
  StrCmp $R1 '5.2' lbl_winnt_2003 lbl_error<br />
<br />
  lbl_winnt_x:<br />
    StrCpy $R0 &quot;NT $R0&quot; 6<br />
  Goto lbl_done<br />
<br />
  lbl_winnt_2000:<br />
    Strcpy $R0 '2000'<br />
  Goto lbl_done<br />
<br />
  lbl_winnt_XP:<br />
    Strcpy $R0 'XP'<br />
  Goto lbl_done<br />
<br />
  lbl_winnt_2003:<br />
    Strcpy $R0 '2003'<br />
  Goto lbl_done<br />
<br />
  lbl_error:<br />
    Strcpy $R0 ''<br />
  lbl_done:<br />
<br />
  Pop $R1<br />
  Exch $R0<br />
<br />
FunctionEnd<br />
<br />
<br />
Section &quot;New&quot;<br />
<br />
SetShellVarContext ALL<br />
<br />
; This section adds mainly DLL files to the Windows\system folder and need to be registered <br />
  <br />
  SetOutPath C:\Test <br />
<br />
  File ..\actbar.oca<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">14th April 2004, 21:34</div></div><div class="posttext">You never Call the function so it zeros it out.<br />
<br />
You need to add this to your section:<br />
Call GetWindowsVersion<br />
Pop $R0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tribe25</div><div class="date">14th April 2004, 22:01</div></div><div class="posttext">Ok, got the Windows version, thanks. Now, if the version is Windows XP I need it to install to a certain directory, like Windows\System(32) and if WinNT then WinNT\System32. I got all the files installed correctly, just need to read the version and then install based off answer. Thanks again for the help.<br />
<br />
!define VERSION &quot;1.0.0&quot;<br />
<br />
Function .onInit<br />
 MessageBox MB_YESNO &quot;This will install Safari Remote. Do you wish to continue?&quot; IDYES gogogo<br />
   Abort<br />
 gogogo:<br />
 Call &quot;GetWin&quot;<br />
 MessageBox MB_OK|MB_ICONINFORMATION $0<br />
FunctionEnd<br />
<br />
Function &quot;GetWIN&quot;<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion&quot; ProductName<br />
StrCmp $0 &quot;&quot; +1 +2<br />
ReadRegStr $0 HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; ProductName<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">14th April 2004, 22:08</div></div><div class="posttext">posted twice see below</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">14th April 2004, 22:08</div></div><div class="posttext">If you want to check the value of a variable, use StrCmp.<br />
<br />
However, you don't need any version detection in this case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">14th April 2004, 22:09</div></div><div class="posttext">You could just use the variable $SYSDIR and it will give you the correct directory and skip the windows detection completely. You can also use $WINDIR if all you want is the directory where Windows is installed. Detecting which version of windows they are running and then installing into that directory doesn't solve your problem because the user can install Windows into whichever directory he wants. It could be c:\mywindir for all you know. So, use the variables above just to make sure you get the right directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tribe25</div><div class="date">14th April 2004, 22:24</div></div><div class="posttext">Ok, I have files going to Windows\System32...I can use $SYSDIR for that.<br />
<br />
I have files going to Windows\System...what would I use for that?<br />
<br />
And any files that go into Windows...I use $WINDIR<br />
<br />
Am I catching on? Thanks again for the help!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">14th April 2004, 22:39</div></div><div class="posttext">It's always been my understanding that the OS only uses one or the other. So, $SYSDIR will get you Windows\System if that is what that machine uses. I could be wrong about that though. I don't see another variable for just plain system so I have to assume that's right.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>