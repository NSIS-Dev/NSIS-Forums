<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RmDir error because Command line shell, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RmDir error because Command line shell NSIS Discussion" />
	
	<title> RmDir error because Command line shell [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RmDir error because Command line shell</div>
<hr />
<div class="pda"><a href="t-241697.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=241697">RmDir error because Command line shell</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">M-Force</div><div class="date">24th March 2006, 21:10</div></div><div class="posttext">Hi,<br />
<br />
I try to remove a folder and all its contents (RMDir /r). But when i have a open Command Shell which shows the content of the folder which i want to remove i get an error. All files and subfolders will be removed but the folder itself is still there. I made already sure that the SetOutPath points to another folder. I guess the open shell locks the folder which i want to delete and prevent to remove it.<br />
Is there a workaround or a way to figure out if a folder is lockend by a process and close that process which is locking it?<br />
<br />
<br />
Thank you for your help.<br />
<br />
<br />
M.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th March 2006, 21:51</div></div><div class="posttext">This seems to work fine:<br />
<br />
CreateDirectory &quot;D:\Program Files\NSIS\Projects\Testing\ja&quot;<br />
Exec 'explorer &quot;D:\Program Files\NSIS\Projects\Testing\ja&quot;'<br />
Sleep 5000<br />
RMDir /r &quot;D:\Program Files\NSIS\Projects\Testing\ja&quot;<br />
<br />
<br />
Explorer window opens showing folder &quot;ja&quot; then closes after 5 seconds when the folder is deleted.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">M-Force</div><div class="date">24th March 2006, 22:08</div></div><div class="posttext">Hi Stu,<br />
<br />
thank you for your quick answer.<br />
<br />
I tried out what you suggested but it doesnt work.<br />
<br />
  Sleep 5000<br />
  RMDir /r &quot;$INSTDIR&quot;<br />
<br />
It removes the folder sucessfully when i dont have a shell window showing the content of that folder. But not otherwise, even with the 5 sec delay.<br />
<br />
M.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th March 2006, 23:49</div></div><div class="posttext">What Windows are you running?<br />
By shell window do you mean Windows Explorer (explorer.exe)?<br />
What code are you using to view the folder contents?<br />
<br />
Try my example in a single Section but use $INSTDIR instead:<br />
<br />
Section &quot;blah&quot;<br />
CreateDirectory &quot;$INSTDIR&quot;<br />
Exec 'explorer &quot;$INSTDIR&quot;'<br />
Sleep 5000<br />
RMDir /r &quot;$INSTDIR&quot;<br />
SectionEnd<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">M-Force</div><div class="date">27th March 2006, 15:01</div></div><div class="posttext">The shell what i am talking about is the command line shell (cmd.exe). I dont have a problem with the Windows Explorer.<br />
<br />
The described behavior only happens with such a command shell.<br />
<br />
I hopes that helps to understand my problem.<br />
<br />
M.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th March 2006, 15:05</div></div><div class="posttext">Hmm I see now, missed the Command Shell from your first post :(<br />
<br />
Well will Command Prompt always be open? In which way is it viewing the folder... with the dir command or some other executable?<br />
<br />
I don't know of a way to find out which process last accessed the folder, but that would be your best solution. Otherwise, you could probably close Command Prompt with FindWindow and SendMessage with ${WM_CLOSE}.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th March 2006, 15:26</div></div><div class="posttext">First of all might be good to understand why console stays open. NSIS distribution includes nsExec plug-in for DOS applications, ExecDos and ExecCmd are available in archive, plug-ins can solve the problem for most of apps (not 100%, test required). From the other side, if user opened console, might be better to leave it as it is (and do not rmdir).<br />
Win9x consoles not accepted windows messages in my tests.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>