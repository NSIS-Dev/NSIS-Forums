<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS feature questions: external DLL functions, custom dialogs?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS feature questions: external DLL functions, custom dialogs? NSIS Discussion" />
	
	<title> NSIS feature questions: external DLL functions, custom dialogs? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS feature questions: external DLL functions, custom dialogs?</div>
<hr />
<div class="pda"><a href="t-55185.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=55185">NSIS feature questions: external DLL functions, custom dialogs?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">AndrewRich</div><div class="date">19th July 2001, 01:52</div></div><div class="posttext">Hi folks,<br />
<br />
I'm an experienced InstallShield programmer looking to move some of our apps to a lighter-weight installation package.  NSIS looks quite interesting, but I need to know about its support for external DLL functions and custom dialogs.<br />
<br />
We have several custom DLLs with various functions exported for use by the InstallShield project.  Can NSIS call exported DLL functions?<br />
<br />
Our product requires a bit of configuration by the user at install-time.  Can NSIS display custom dialogs and act on the results?<br />
<br />
Thanks for reading.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gonzotek</div><div class="date">19th July 2001, 02:20</div></div><div class="posttext">NSIS doesn't call external .dlls nor does it do cutom dialogs.  However, it's open-source, so you can easily add the custom dialogs.  Calling the functions from .dlls might be a bit harder, as I beleive they are made to work with InstallShield, are they not?  What, generally, are the functions in the .dlls related too?  If we have some idea of what you're trying to accomplish in the install it will be easier to specifically answer your questions.  A small post-installation program could be written to overcome NSIS limits without messing with the NSIS code.<br />
<br />
-=Gonzotek=-</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AndrewRich</div><div class="date">19th July 2001, 02:59</div></div><div class="posttext">Originally posted by Gonzotek <br />
Calling the functions from .dlls might be a bit harder, as I beleive they are made to work with InstallShield, are they not?  <br />
<br />
Pretty standard DLLs with exported functions.  The prototypes are all LONG WINAPI if that makes any difference.<br />
<br />
What, generally, are the functions in the .dlls related too?  If we have some idea of what you're trying to accomplish in the install it will be easier to specifically answer your questions.  <br />
<br />
Our application is a web server/database that manages and generates reports from data passed from remote agents.  We have DLLs that export functions more easily implemented this way; a variety of file, service, and database functions.  As an example, we have one DLL that exports the following functions:<br />
<br />
  CheckDB		[check the existence of an SQL database]<br />
  CheckService	[check the status of a service]<br />
  CreateDB		[create an SQL database]<br />
  InstallLocalService	[install a service as the System Account]<br />
  InstallLocalServiceX	[install a service as another user]<br />
  RemoveLocalService	[remove a service]<br />
  StartLocalService	[start a service]<br />
  StopLocalService	[stop a service]<br />
  KillProcess		[kill a running process, uses PSAPI.DLL]<br />
  IsPortAvailable		[check availability of a TCP port]<br />
<br />
These functions are called during the installation of the application to, for instance, install the service or create the database in SQL Server.<br />
<br />
The custom dialogs I mentioned are things like selecting an SQL Server host machine, entering between three and five TCP ports for the server application to use, entering passwords for the reporting agents to use.  <br />
<br />
The InstallShield project that builds this installer is just huge.  It's out of control.  So I'm looking for another solution that will still have the flexibility of InstallShield without the tremendous overhead.<br />
<br />
Thanks for reading!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spaetz</div><div class="date">19th July 2001, 11:52</div></div><div class="posttext">I guess you'd have to write a 5kb C app, that you hand over the name of the .dll and the function and it would basically call the .dll. You simply do the <br />
ExecWait &quot;Calldll.exe Functionname&quot;<br />
You can delete the small app afterwards. Shouldn't be that tricky.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AndrewRich</div><div class="date">19th July 2001, 17:58</div></div><div class="posttext">Isn't that what RunDLL32 is meant for?  Hmm, I will have to investigate this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">saivert</div><div class="date">5th August 2001, 17:42</div></div><div class="posttext">To use Microsoft's RunDll/RunDll32 the DLL functions need to use some specific prototype, calling-convention and return value (void ??). However I do not know about the specifics of this (search MSDN for info). I once tried to make a DLL that exported a function with this prototype: 'void MyRunDllProc(char *params);' but when I tried to run 'RunDll32 mydll.dll,MyRunDllProc someparams' RunDll32 failed. Also it's not advicable to use any external DLL function caller anyway, just rewrite NSIS to include a Instruction such as (syntax displayed):<br />
CallDll retval($0-9|$INSTDIR|$OUTDIR) dllfile dllfunction parameters....<br />
You could just use LoadLibrary and GetProcAddress in the code of NSIS. I am sure this will work for most purposes, as long as the DLL function returns a string, number or nothing (void). Also the DLL function could have any parameters as long as it was char and int types, else you would also have to specify the types in the CallDll instruction. [END_OF_TRANSMISSION]</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>