<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" x64 license page problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  x64 license page problem NSIS Discussion" />
	
	<title> x64 license page problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  x64 license page problem</div>
<hr />
<div class="pda"><a href="t-262273.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262273">x64 license page problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">22nd December 2006, 12:11</div></div><div class="posttext">I am running setup on MS Windows Server 2003 Enterprise x64 Edition SP1, Dual Core AMD Opteron. Problem comes from .onInit syscall, but error situation appear later - on the license page only:<br />
!include &quot;MUI.nsh&quot; <br />
!define INAME license<br />
<br />
Name ${INAME} <br />
OutFile ${INAME}.exe <br />
InstallDir &quot;$PROGRAMFILES\${INAME}&quot;<br />
BGGradient 000000 000080 FFFFFF<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_LICENSE license_en.txt<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
SectionEnd<br />
<br />
Function .onInit<br />
  System::Call &quot;kernel32::Wow64DisableWow64FsRedirection(*i)&quot;<br />
FunctionEnd<br />
With background gradient enabled I see image instead of license text (like on attached gif). If BG line commented unhandled exception occure, debug shows zero pointer. Temp dir created in the same place on all comps (user/local settings/temp). On 32 bits XP/2003 all is correct (just no dll entry point). Any short fix?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd December 2006, 12:29</div></div><div class="posttext">Seems like that System call somehow runs over some memory it shouldn't touch. Does it work if you add an actual output value?System::Call &quot;kernel32::Wow64DisableWow64FsRedirection(*i.r0)&quot;A quick fix would probably be using the macros in x64.nsh because they use Wow64EnableWow64FsRedirection.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">22nd December 2006, 12:47</div></div><div class="posttext">System::Call &quot;kernel32::Wow64DisableWow64FsRedirection(*i.r0)&quot;not works :( (exception without BG gradient)<br />
The same with !insertmacro DisableX64FSRedirection</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd December 2006, 13:02</div></div><div class="posttext">Doesn't the gradient window show at all? Does it only show inside the license box?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd December 2006, 13:03</div></div><div class="posttext">Does $TEMP change before and after the redirection changes?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">22nd December 2006, 13:16</div></div><div class="posttext">$TEMP not changes: e:\docume~1\admini~1\locals~1\temp\2, just created tmp folder nsm4.tmp appear under it. Temporary files present in folder (installoptions.dll, system.dll, iospecial.ini, modern-wizard.bmp).<br />
License window repeats top level corner of (presenting) background gradient.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd December 2006, 15:38</div></div><div class="posttext">What happens if you use a plug-in that disables the redirection instead of using the System plug-in? I'm a bit in the dark here, because I don't have x64 Windows to test on. Maybe it's because LoadLibrary is fooled by the disabled redirection. RichEd20.dll is used right after .onInit is called.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">25th December 2006, 08:18</div></div><div class="posttext">Yes, looks like wrong dll... Moving 'disable' to .onguiinit or section solves the problem. 'disable' in .oninit and then 'enable' in the same function (after environment check) also works. Thanks :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>