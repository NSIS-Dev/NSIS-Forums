<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" &quot;Windows installer has stopped working&quot; error with silent NSIS install in Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  &quot;Windows installer has stopped working&quot; error with silent NSIS install in Vista NSIS Discussion" />
	
	<title> &quot;Windows installer has stopped working&quot; error with silent NSIS install in Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  &quot;Windows installer has stopped working&quot; error with silent NSIS install in Vista</div>
<hr />
<div class="pda"><a href="t-309027.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=309027">&quot;Windows installer has stopped working&quot; error with silent NSIS install in Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">darienphoenix</div><div class="date">29th July 2009, 08:30</div></div><div class="posttext">I have a silent NSIS wrapper which copies my main installer to a temporary directory and then executes it. However, once the main installer has finished, the following error appears:<br />
<br />
http://img169.imageshack.us/img169/1474/windowsinstallerstopped.jpg<br />
<br />
I have &quot;RequestExecutionLevel admin&quot; at the top of my script, and have also added ClearErrors and SetErrorLevel 0 at the end of the only section in the stub script. The problem still occurs.<br />
<br />
It's similar to the problem described here (http://forums.winamp.com/showthread.php?postid=2538140), only a different error. <br />
<br />
If I run the main installer (which also has RequestExecutionLevel in it) directly without the Stub, the error does not occur, which leads me to believe it's a problem with the silent install.<br />
<br />
Any help would be greatly appreciated, as this problem is driving me nuts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2009, 12:15</div></div><div class="posttext">NSIS isn't a Windows Installer. Are you using that as the caption yourself? The lower case i in installer would lead me to believe that. Either way it would be handy if you posted some code.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darienphoenix</div><div class="date">29th July 2009, 13:35</div></div><div class="posttext">No, it's not named 'Windows installer'. The problem only occurs when I use the stub wrapper, not when I use the main installer (and no, the stub isn't called windows installer either).<br />
<br />
I'm actually using the InstStub .exe provided in the cab files example to launch and then delete my main installer, unless the problem is there somewhere.<br />
<br />
I'll have to post code when I get back to work as I don't have any on my home computer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2009, 18:11</div></div><div class="posttext">Not sure what InstStub.exe is for but you can easily write a wrapper executable for an MSI with a few lines of code:<br />
<br />
Icon ...<br />
OutFile wrapper.exe<br />
SilentInstall silent<br />
SetCompressor /solid lzma<br />
<br />
Section<br />
  InitPluginsDir<br />
  SetOutPath $PLUGINSDIR<br />
  File /oname=install.msi some_installer.msi<br />
  ExecWait `&quot;$SYSDIR\msiexec.exe&quot; /i install.msi`<br />
SectionEnd<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darienphoenix</div><div class="date">29th July 2009, 18:21</div></div><div class="posttext">...<br />
<br />
Stu the problem isn't writing the stub, I've done that. The problem is that it causes the error I posted in my first post.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th July 2009, 19:05</div></div><div class="posttext">You neglected to mention you were using CABSetup hence my post.<br />
<br />
You can identify which executable has crashed by killing one when the crash occurs.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darienphoenix</div><div class="date">30th July 2009, 01:23</div></div><div class="posttext">Ah thanks Stu, I understand now.<br />
<br />
The reason I'm using CABSetup is because my installer may be distributed on removable media which may need to be removed mid-installation. The Stub installer copies the main installer to a temporary directory along with the InstStub executable provided in CABSetup, and then executes InstStub. The main installer then runs and is deleted afterwards.<br />
<br />
I'm beginning to think the problem is with InstStub and not the wrapper script, since the problem only occurs (or at least appears) after the main installation has completed, and the stub finishes execution shortly after the main installer is run.<br />
<br />
The problem cropping up right after the main installer process has completed would make sense if it was InstStub causing the error (and it might also explain the 'Windows installer' title if that is the name used in InstStub).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th July 2009, 11:27</div></div><div class="posttext">You can definitely do that without using CABSetup if you want to go that route. Otherwise you should probably get hold of the guy who made CABSetup. If InstStub is an NSIS executable then the cause of the crash is likely to be a plugin it uses more than anything.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darienphoenix</div><div class="date">3rd August 2009, 04:08</div></div><div class="posttext">Fixed - the problem was indeed caused by the InstStub.exe file included with CABSetup.<br />
<br />
I replaced it with a combination of an AutoIt script and a batch file, since I couldn't figure out how to get either of them to do both an ExecWait and also be capable of self-deletion.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>