<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" InstallOption / Verify / setting new text in a &quot;Text&quot; field., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  InstallOption / Verify / setting new text in a &quot;Text&quot; field. NSIS Discussion" />
	
	<title> InstallOption / Verify / setting new text in a &quot;Text&quot; field. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  InstallOption / Verify / setting new text in a &quot;Text&quot; field.</div>
<hr />
<div class="pda"><a href="t-265717.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=265717">InstallOption / Verify / setting new text in a &quot;Text&quot; field.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">13th February 2007, 19:52</div></div><div class="posttext">Hi all,<br />
<br />
I am using MUI (Well, UMUI), and creating a custom InstallOption page.<br />
<br />
On this page, I have a text field (readonly), that I populate with text, based on another setting on the page.<br />
<br />
I have set the &quot;other&quot; field setting to state of VERIFY, so I get a callback into my &quot;verify&quot; function.<br />
This works.<br />
<br />
However, I when I try to &quot;update&quot; the text field, it doesn't seem to get applied, not sure why...<br />
<br />
I do this in the &quot;Verify&quot; callback:<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioA.ini&quot; &quot;Field 7&quot; &quot;State&quot; &quot;blah&quot;<br />
<br />
Then I do an &quot;Abort&quot; to back out back to the Custom Page again.<br />
When it backs out, it does not contain &quot;blah&quot;, but instead the old text that was there before...<br />
<br />
I assume I have to send a message to the Window to redraw/update itself?<br />
If so, How?<br />
<br />
Thanks!<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">13th February 2007, 20:03</div></div><div class="posttext">I assume I have to send a message to the Window to redraw/update itself?<br />
If so, How?Right!<br />
See the included example NSIS\Examples\InstallOptions\testnotify.nsi especially what the button clear does.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">13th February 2007, 20:10</div></div><div class="posttext">Yup.<br />
Thats where I was getting the idea from.<br />
<br />
They do:<br />
<br />
ReadINIStr $1 &quot;$PLUGINSDIR\test.ini&quot; &quot;Field 5&quot; &quot;HWND&quot;<br />
SendMessage $1 ${WM_SETTEXT} 0 &quot;STR:&quot;<br />
<br />
Which works and completely makes sense for setting the &quot;text&quot; of the buttons.<br />
<br />
But it does not seem to work for setting the actual text<br />
inside of an Edit (text) box...<br />
<br />
Obviously it must be a different message, I just can't seem to find the right one! =)<br />
<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">13th February 2007, 20:15</div></div><div class="posttext">The example clears the text into text fields, to set the text, you need &quot;STR:Add_string_here&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">13th February 2007, 21:35</div></div><div class="posttext">Ya.<br />
<br />
I seem to have more problems than just this one... =)<br />
<br />
In my &quot;verify&quot; (LeaveCustom) section, I am getting very very strange results on just about everything.<br />
<br />
Obviously I have broken something, still trying to figure out what I did... =)<br />
<br />
Doing the following, I get a &quot;bizarre&quot; output on the first<br />
Messagebox of &quot;1: blah&quot;  (ie, it is suggesting that $1 is coming back as &quot;blah&quot;, which is bizarre, since I don't have &quot;blah&quot; anywhere in my script or .ini file...)<br />
<br />
The next MessageBox should display the HWND, but its displaying nothing at all!<br />
<br />
Function LeaveCustom<br />
<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioA.ini&quot; &quot;Field 7&quot; &quot;State&quot; &quot;Old Version: $1\r\nNew Version: $2&quot;<br />
<br />
    Strcpy $1 &quot;&quot;<br />
    ReadINIStr $1 &quot;ioA.ini&quot; &quot;Field 7&quot; &quot;State&quot;<br />
    MessageBox MB_OK &quot;1: $1&quot;<br />
<br />
    ReadINIStr $1 &quot;ioA.ini&quot; &quot;Field 7&quot; &quot;HWND&quot;<br />
    MessageBox MB_OK &quot;2: $1&quot;<br />
  <br />
    Abort<br />
<br />
FunctionEnd<br />
<br />
<br />
The .ini file for field 7 isn't much:<br />
<br />
[Field 7]<br />
Type=Text<br />
Left=9<br />
Top=169<br />
Right=131<br />
Bottom=198<br />
State=&quot;&quot;<br />
<br />
Just plain bizarre.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">13th February 2007, 21:45</div></div><div class="posttext">lol, where the blah comes from when there isn't blah in your script?<br />
Seriously, if you use ReadINIStr you need to add the $PLUGINSDIR e.g.<br />
ReadINIStr $1 &quot;$PLUGINSDIR\ioA.ini&quot; &quot;Field 7&quot; &quot;State&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">13th February 2007, 22:05</div></div><div class="posttext">&gt; Seriously, if you use ReadINIStr you need to <br />
&gt; add the $PLUGINSDIR e.g.<br />
&gt; ReadINIStr $1 &quot;$PLUGINSDIR\ioA.ini&quot; &quot;Field 7&quot; &quot;State&quot;<br />
<br />
Ah, that helped immensely!<br />
<br />
I actually had nearly everything working, but missed the concept of needing $PLUGINSDIR !<br />
<br />
Thanks for your help!<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">13th February 2007, 22:08</div></div><div class="posttext">This example shows the actual difference,<br />
OutFile &quot;Test.exe&quot;<br />
<br />
!include &quot;mui.nsh&quot;<br />
<br />
!insertmacro MUI_PAGE_LICENSE &quot;${NSISDIR}\Docs\Modern UI\License.txt&quot;<br />
Page Custom custcreate custleave<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
Section <br />
   <br />
SectionEnd<br />
<br />
<br />
Function custcreate<br />
   !insertmacro MUI_HEADER_TEXT &quot;Custom Page&quot; \<br />
   &quot;Just a simple custom page&quot;<br />
   !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;some sample text&quot;<br />
   push $0<br />
   InstallOptions::Dialog &quot;$PLUGINSDIR\custom.ini&quot;<br />
   pop $0<br />
   pop $0<br />
FunctionEnd<br />
<br />
<br />
Function custleave<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;custom.ini&quot; &quot;Settings&quot; &quot;state&quot;<br />
   StrCmp $0 2 0 end<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;custom.ini&quot; &quot;field 2&quot; &quot;State&quot;<br />
   StrCmp $0 0 0 +4<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;custom.ini&quot; &quot;field 1&quot; &quot;HWND&quot;<br />
   SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:some sample text&quot;<br />
   Goto +3<br />
   !insertmacro MUI_INSTALLOPTIONS_READ $0 &quot;custom.ini&quot; &quot;field 1&quot; &quot;HWND&quot;<br />
   SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:The text has changed now&quot;<br />
   Abort<br />
   <br />
   end:<br />
FunctionEnd<br />
<br />
<br />
Function .onInit<br />
   InitPluginsDir<br />
   GetTempFileName $0<br />
   Rename $0 &quot;$PLUGINSDIR\custom.ini&quot;<br />
<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;settings&quot; &quot;numfields&quot; &quot;2&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;type&quot; &quot;text&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;left&quot; &quot;10&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;right&quot; &quot;-10&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;top&quot; &quot;10&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;bottom&quot; &quot;22&quot;<br />
   <br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;type&quot; &quot;checkbox&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;text&quot; &quot;I'm a checkbox&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;left&quot; &quot;10&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;right&quot; &quot;-10&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;top&quot; &quot;30&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;bottom&quot; &quot;42&quot;<br />
   WriteINIStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;flags&quot; &quot;NOTIFY&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">14th February 2007, 01:56</div></div><div class="posttext">I got it working great now!<br />
Thanks again for all your help!<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th February 2007, 08:43</div></div><div class="posttext">To avoid confusion with $PLUGINSDIR when using ReadINIStr you should use the MUI_INSTALLOPTIONS_READ macro which you only give the INI file name rather than the entire path.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>