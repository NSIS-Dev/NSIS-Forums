<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" WriteRegStr @ HKLM on Win 7, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  WriteRegStr @ HKLM on Win 7 NSIS Discussion" />
	
	<title> WriteRegStr @ HKLM on Win 7 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  WriteRegStr @ HKLM on Win 7</div>
<hr />
<div class="pda"><a href="t-319451.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319451">WriteRegStr @ HKLM on Win 7</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Eleethal</div><div class="date">25th May 2010, 22:57</div></div><div class="posttext">Hello, I am writing an application that needs to write to the HKLM/SOFTWARE section of the registry in Windows 7 and seem to be hitting a brick wall.<br />
<br />
I have tried to request execution level user,admin and highest, neither seems to be letting NSIS write to HKLM.... Am I doing something wrong or missing an important step?<br />
<br />
Thanks in advance!  Here is a truncated version of the script I am trying to put together, you can see the WriteRegStr is just a test entry there for debugging purposes until I find out why it's not writing.<br />
<br />
<br />
<br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;LogicLib.nsh&quot;<br />
<br />
var /GLOBAL VER<br />
<br />
Name &quot;BSC Suite $VER&quot;<br />
BrandingText &quot;Bayside Computer Shop&quot;<br />
OutFile &quot;bayside-installer.exe&quot;<br />
RequestExecutionLevel admin<br />
CRCCheck off<br />
Icon hdup.ico<br />
<br />
Page components<br />
Page directory<br />
Page instfiles<br />
<br />
Section &quot;Malware Bytes Anti-Malware&quot; g2o7<br />
  SetOutPath &quot;$INSTDIR\Anti-Malware&quot;<br />
  File &quot;bin\mbam-setup.exe&quot;<br />
  WriteRegStr HKLM &quot;SOFTWARE\My Software&quot; &quot;&quot; $INSTDIR<br />
SectionEnd<br />
<br />
<br />
Function .onInit<br />
  StrCpy $VER 10.4.27<br />
  StrCpy $INSTDIR &quot;$DOCUMENTS\tech\User Software&quot;<br />
FunctionEnd<br />
<br />
<br />
Function .onInstSuccess<br />
  MessageBox MB_YESNO|MB_ICONQUESTION &quot;The computer has to reboot before any$\r$\nof the software you selected is$\r$\ninstalled.$\r$\n$\r$\nDo you wish to reboot the system?&quot; IDNO +2<br />
    Reboot<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2010, 23:26</div></div><div class="posttext">I am not completely familiar with running NSIS on 7/Vista but I assume it is UAC that is blocking your installer. You can try the UAC plug-in: http://nsis.sourceforge.net/UAC_plug-in<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Eleethal</div><div class="date">25th May 2010, 23:38</div></div><div class="posttext">I currently have UAC disabled on this 7 machine while I test stuff, I read the documentation/ReadMe included with that UAC plugin but I do not see any functions to write to the registry, I loaded it in my script and tried compiling/running the script again and it still does not write to HKLM, but it will write to HKCU when I use the same syntax.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">25th May 2010, 23:53</div></div><div class="posttext">you should be okay, UAC-wise, when requesting admin level; unless the key is set read-only somewhere.<br />
<br />
Are you sure that NSIS isn't allowed to write to the registry in that location?  How are you verifying this?<br />
<br />
Just to throw one possible thing out there... a lot of Win7 machines are going to be 64bit.  If you don't use SetRegView to switch to the 64bit registry, NSIS will actually end up writing to the 32bit registry at HKEY_LOCAL_MACHINE\Software\WOW6432node\My Software\.  So if you are checking behavior by simply looking for HKEY_LOCAL_MACHINE\Software\My Software\, you're not going to be finding it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Eleethal</div><div class="date">26th May 2010, 00:28</div></div><div class="posttext">Very nice, I think that was it (SetRegView) ... My entries are showing under the WOW6432node key.  I'll look up the SetRegView routine, I'm assuming there is a way to detect if you are running 64 bit and to switch views appropriately. Thank you so much for your help, you saved me a serious headache consindering all our windows 7 machines are 64 bit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">26th May 2010, 00:47</div></div><div class="posttext">yep - see the included 'x64.nsh' for some LogicLib-enabled macros you can use.  in short:<br />
<br />
${If} ${RunningX64}<br />
; 64bit things here<br />
${Else}<br />
; 32bit things here<br />
${EndIf}<br />
<br />
<br />
However... you shouldn't be writing to the 64bit registry unless you - or rather the application you're installing - need(s) it.<br />
<br />
I.e. if you are installing a 32bit application, it makes sense to just let your installer write to the 32bit registry as well - especially if the installer writes out information that your application needs, as it will be subject to the same registry redirection.<br />
<br />
Similarly, if you are installing a 64bit application, that's when you'd want to use SetRegView to toggle to the 64bit registry.<br />
( also keep in mind that there are separate 64bit handlers for $PROGRAMFILES and the like, and that the Windows\System32\ folder gets redirected; have a search through the forums for details.. not sure there's a wiki entry on all of this yet. )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Eleethal</div><div class="date">26th May 2010, 01:06</div></div><div class="posttext">Thanks a bunch, the reason I need to write to the real HKLM is for RunOnceEx (HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnceEx in order to install applications on the next boot,)  so I'm pretty sure it has to be the real 64 bit HKLM that I need to write to.  I'll look into x64.nsh and SetRegView when I get off of work, thanks for all the help and information!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>