<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Get a path from registry, if not found send error message, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Get a path from registry, if not found send error message NSIS Discussion" />
	
	<title> Get a path from registry, if not found send error message [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Get a path from registry, if not found send error message</div>
<hr />
<div class="pda"><a href="t-316140.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316140">Get a path from registry, if not found send error message</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">10th January 2010, 12:10</div></div><div class="posttext">Yeah, it's me again. I've searched for this, but nothing found.<br />
<br />
I want that my installer search for a path in registry. BUT, if it don't find anything, I want that the installer send a message and SKIP the section that need the path.<br />
<br />
Something like: get a path from an app. If it don't find the path, send a message saying 'install app needed first, then try to install the plugin ('or whatever') again' and go to next section.<br />
<br />
Right now, I have this:<br />
	MessageBox MB_OK &quot;$(MessageWinamp)&quot;<br />
  ReadRegStr $0 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\winamp.exe&quot; &quot;Path&quot;<br />
	DetailPrint &quot;Winamp is installed at: $0&quot;<br />
	<br />
	SetDetailsPrint textonly<br />
  DetailPrint &quot;$(InstallWinamp)&quot;<br />
  SetDetailsPrint listonly<br />
	<br />
	Sleep 1000	<br />
	SetOutPath &quot;$0\Plugins&quot;<br />
	File &quot;gen_CADStarter.Plugin.dll&quot;	<br />
	File &quot;CADStarter.dll&quot;<br />
<br />
How I can implement it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">10th January 2010, 12:23</div></div><div class="posttext">From the NSIS manual:The error flag will be set and $x will be set to an empty string (&quot;&quot;) if the string is not present. If the value is present, but is of type REG_DWORD, it will be read and converted to a string and the error flag will be set.So you should check if the error flag is set (with IfErrors) and if $0 ==&quot;&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">10th January 2010, 14:24</div></div><div class="posttext">Hi Reenan:<br />
<br />
If you are looking for Winamp install path, I recommend that you use the &quot;uninstall&quot; entry from the registry (where add and remove programs are placed), since is been used since Winamp 2.x series or older.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">10th January 2010, 15:33</div></div><div class="posttext">Originally posted by jpderuiter <br />
From the NSIS manual:So you should check if the error flag is set (with IfErrors) and if $0 ==&quot;&quot;.  <br />
<br />
I don't know how to do this :/ I've looked a bit into the manual, but it seems to confuse to me! (Remember, I'm brazilian, so lots of things written in english can look tough to me)<br />
<br />
can you give me a little explanation on it?<br />
<br />
About yout tip, Joel, I was using Winamp key present in Software root first, then someone told me to use that one. For God's sake, what key is easier to use?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">10th January 2010, 17:53</div></div><div class="posttext">ReadRegStr $0 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\winamp.exe&quot; &quot;Path&quot;<br />
IfErrors 0 RegOK<br />
StrCmp $0 &quot;&quot; 0 RegOK<br />
DetailPrint &quot;Error reading registry&quot;<br />
Goto End<br />
RegOK:<br />
DetailPrint &quot;Registry value: $0&quot;<br />
End:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th January 2010, 08:51</div></div><div class="posttext">Actually there should be aClearErrorsline just before that code...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">11th January 2010, 10:53</div></div><div class="posttext">Before the 'End:' one?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">11th January 2010, 11:28</div></div><div class="posttext">No, before the code. Before all of the code. Like this:<br />
<br />
ClearErrors<br />
ReadRegStr $0 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\winamp.exe&quot; &quot;Path&quot;<br />
IfErrors 0 RegOK<br />
StrCmp $0 &quot;&quot; 0 RegOK<br />
DetailPrint &quot;Error reading registry&quot;<br />
Goto End<br />
RegOK:<br />
DetailPrint &quot;Registry value: $0&quot;<br />
End:<br />
<br />
<br />
Note: I really recommend using LogicLib. It'll greatly increase the readability of your code:<br />
ClearErrors<br />
ReadRegStr $0 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\winamp.exe&quot; &quot;Path&quot;<br />
${If} ${Errors}<br />
${OrIf} $0 == &quot;&quot;<br />
  DetailPrint &quot;Error reading registry&quot;<br />
${Else}<br />
  DetailPrint &quot;Registry value: $0&quot;<br />
${EndIf}<br />
<br />
Edit: Come to think of it, in this case you don't need to use the Error flag at all. As long as $0 is empty we're in trouble, regardless of the actual error flag.<br />
ReadRegStr $0 HKEY_LOCAL_MACHINE &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\winamp.exe&quot; &quot;Path&quot;<br />
${If} $0 == &quot;&quot;<br />
  DetailPrint &quot;Error reading registry&quot;<br />
${Else}<br />
  DetailPrint &quot;Registry value: $0&quot;<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">11th January 2010, 14:34</div></div><div class="posttext">Originally posted by Reenan <br />
I don't know how to do this :/ I've looked a bit into the manual, but it seems to confuse to me! (Remember, I'm brazilian, so lots of things written in english can look tough to me)<br />
<br />
can you give me a little explanation on it?<br />
<br />
About yout tip, Joel, I was using Winamp key present in Software root first, then someone told me to use that one. For God's sake, what key is easier to use?  <br />
Are you targeting modern Winamp versions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">11th January 2010, 19:58</div></div><div class="posttext">Originally posted by Joel <br />
Are you targeting modern Winamp versions?  <br />
<br />
Well, I'm writing a installer for the CAD Plugin for winamp. CAD site and even plugin download don't seem to say for which version it its. This way, I'll consider it to modern Winamp.<br />
<br />
EDIT:<br />
One more thing (I don't want to create a new topic again). There is some way to use the entire header as image?<br />
<br />
ANOTHER EDIT (to don't create another topic):<br />
How can I do a file check during uninstall?<br />
<br />
- Check if a file exists. If exist, do something. If not, same as my first problem: send a message and skip it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>