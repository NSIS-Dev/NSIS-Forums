<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Self deleting installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Self deleting installer NSIS Discussion" />
	
	<title> Self deleting installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Self deleting installer</div>
<hr />
<div class="pda"><a href="t-241921.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=241921">Self deleting installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">27th March 2006, 11:15</div></div><div class="posttext">Hi,<br />
<br />
feature suggestion for NSIS scripting language:<br />
<br />
add some command like<br />
<br />
&quot;SetDeleteOnQuit true&quot;<br />
<br />
This command should set some flag and the installer should delete itself when terminating (caused e.g. by Quit,Abort...).<br />
<br />
I know this can be done manually using some tricks and I know that Uninstallers do something similar by default (when not using special arg ?=). But it could be useful in many situations. E.g. RegTool.bin (library.nsh) is compiled using a two-step installer so in fact that binary is an uninstaller to have the Delete-on-quit feature. Could be done the easy way then.<br />
<br />
The command should be runtime (not compile-time).<br />
<br />
For installers the value should be &quot;false&quot; by default, of course. I know there is some issue with current uninstallers: I guess they move themself to TEMP while loading. So I would let the behaviour of uninstallers as it is (besides SetDeleteOnQuit should delete $INSTDIR/uninstall.exe at the end).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">27th March 2006, 12:45</div></div><div class="posttext">You probably can combine 4.7.2.1.9 .onUserAbort and SelfDel plug-in (http://nsis.sourceforge.net/File:SelfDel.zip)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th March 2006, 17:04</div></div><div class="posttext">The command can't be a runtime command because this is done before any code is run. Uninstallers don't really delete themselves, they only copy themselves to the TEMP directory and set that copy to be deleted on reboot. The copy can then delete the original, if it wants to.<br />
<br />
It can be made a compile time command which will simply set the uninstaller flag to the generated installer. It's just one simple flag set in the firstheader structure, called FH_FLAGS_UNINSTALL.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">28th March 2006, 20:07</div></div><div class="posttext">Hi kichik,<br />
<br />
compile time would help with those installer-in-installer packages like regtool.bin. But that's not what I want. Are you sure that Uninstallers do not delete themself. Using MoveFile(Ex) &quot;/deleteonreboot&quot; would be an easy solution (one could do manually), but IIRC Uninstaller does some self-delete trick like that one mentioned on the site mentioned in the selfdel plug-in (catch22...) But you're the expert so you'll know what you write.<br />
<br />
Why am I looking for a run-time command? I could use this to create dynamic installers which &quot;update&quot; themself (downloading a installer package and executing it). Currently I execute the downloaded installer package using ExecWait (has some other advantage but needs special handling for Mutex).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th March 2006, 20:20</div></div><div class="posttext">Uninstallers only copy themselves to the TEMP directory and execute from. You don't have to use `Delete $INSTDIR\uninstall.exe`, so it doesn't really have to delete itself. You can do the same using CopyFiles, Exec and Delete /REBOOTOK.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th March 2006, 20:24</div></div><div class="posttext">If you are happy with deleting after a reboot, then surely Delete /rebootok &quot;$EXEDIR\setup.exe&quot; will work (unless there is something I am missing).<br />
<br />
You should get the installer file name first however, using this function:<br />
http://nsis.sourceforge.net/Get_installer_filename<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">28th March 2006, 20:36</div></div><div class="posttext">Thanks Stu,<br />
<br />
but I'm not &quot;happy&quot; with this. (Hey, this seems to easy... we're professionals, eh?) ;-)<br />
<br />
Please see my self-del runtime command suggestion as &quot;nice to have&quot;. Maybe it can be done easily. I think this would be a valuable function making installers even more powerful. I currently work around using ExecWAIT so I can delete the sub-installer after it finishes.<br />
<br />
Again: Is this (current uninstaller behaviour) just delete-on-reboot? My guess is: no.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th March 2006, 20:39</div></div><div class="posttext">It's not only delete-on-reboot, it's copy to TEMP, optionally delete original immediately and delete copy on reboot. Please add the request to the feature request tracker.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th March 2006, 20:40</div></div><div class="posttext">Well I could create a Wiki page for this with a small executable download and macro to delete the installer...<br />
<br />
It would have to be called .onGUIEnd or whatever though.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mr Inches</div><div class="date">28th March 2006, 21:22</div></div><div class="posttext">Although it is not done purely in NSIS script, you could also use the InstStub.exe/ExitStub.exe component within the CABSetup suite/plugin to run the (un)installer and have it deleted afterward. No reboots are required.<br />
<br />
This was one of the ideas used within that suite to handle the original installer not being available because the source media changed; copy the installer to the TEMP directory and have it removed automatically when it completes.<br />
<br />
For the uninstaller, it would mean leaving another file (other than than the uninstaller) on the target computer, but once executed, both files (InstStub and the uninstaller) would be deleted.<br />
<br />
Duncan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">28th March 2006, 22:49</div></div><div class="posttext">Another solution: make a wrapper for your exe that extracts the installer to the pluginsdir, then use exewait to run it. The installer is deleted when the wrapper has finished waiting for the installer to finish (I have done the same thing on one of my installers).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>