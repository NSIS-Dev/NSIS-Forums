<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsDialogs - Listbox with drive letters, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsDialogs - Listbox with drive letters NSIS Discussion" />
	
	<title> nsDialogs - Listbox with drive letters [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsDialogs - Listbox with drive letters</div>
<hr />
<div class="pda"><a href="t-304077.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=304077">nsDialogs - Listbox with drive letters</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">_-_PSEJ_-_</div><div class="date">12th March 2009, 07:53</div></div><div class="posttext">Hey how to create Listbox with drive letters selection ?<br />
<br />
i need it to use as variable for command ie. &quot;something.exe $letter&quot; (letter without :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th March 2009, 10:04</div></div><div class="posttext">Use the GetDrives functionality from the FileFunc.nsh header file (comes with NSIS), and in the callback function you specify for it, add the drive letters/etc. to the dropdown list.<br />
<br />
e.g.<br />
<br />
<br />
!include &quot;winmessages.nsh&quot;<br />
!include &quot;LogicLib.nsh&quot;<br />
!include &quot;nsDialogs.nsh&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
<br />
Outfile &quot;test.exe&quot;<br />
<br />
var dialog<br />
var hwnd<br />
var null<br />
<br />
Page custom customPage<br />
<br />
Function customPage<br />
	nsDialogs::Create 1018<br />
		Pop $dialog<br />
<br />
	${NSD_CreateDroplist} 0 0 100% 100% &quot;&quot;<br />
	    Pop $hwnd<br />
		${NSD_OnChange} $hwnd db_select.onchange<br />
		${GetDrives} &quot;ALL&quot; driveListFiller<br />
		<br />
	nsDialogs::Show<br />
FunctionEnd<br />
Function db_select.onchange<br />
	Pop $hwnd<br />
	${NSD_GetText} $hwnd $0<br />
	MessageBox MB_OK &quot;Drive selected: $0&quot;<br />
FunctionEnd<br />
<br />
Function driveListFiller<br />
	SendMessage $hwnd ${CB_ADDSTRING} 0 &quot;STR:$9 [$8]&quot;<br />
	Push 1 ; must push something - see GetDrives documentation<br />
FunctionEnd<br />
<br />
Section &quot;&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th March 2009, 13:14</div></div><div class="posttext">oh uhh... I created a Droplist, but you can easily retool it for a List %)  just replace NSD_CreateDroplist with NSD_CreateListbox and CB_ADDSTRING with LB_ADDSTRING</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zeeh3</div><div class="date">12th March 2009, 15:46</div></div><div class="posttext">If we select the line, the messagebox doesn't show selected item text. I have tried the code below, but there must be an easier way to do it:<br />
<br />
Function db_select.onchange<br />
	Pop $hwnd<br />
<br />
	SendMessage $hwnd ${LB_GETCURSEL} 0 0 $0<br />
	SendMessage $hwnd ${LB_GETTEXTLEN} $0 0 $1<br />
<br />
	System::alloc $1<br />
	Pop $2<br />
<br />
	SendMessage $hwnd ${LB_GETTEXT} $0 $2<br />
	System::Call &quot;*$2(&amp;t1024 .r3)&quot;<br />
	System::free $2<br />
<br />
	MessageBox MB_OK &quot;Drive selected: $3&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th March 2009, 16:03</div></div><div class="posttext">odd- seems to work for me:<br />
<br />
!include &quot;winmessages.nsh&quot;<br />
!include &quot;LogicLib.nsh&quot;<br />
!include &quot;nsDialogs.nsh&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
<br />
Outfile &quot;test.exe&quot;<br />
<br />
var dialog<br />
var hwnd<br />
var null<br />
<br />
Page custom customPage<br />
<br />
Function customPage<br />
	nsDialogs::Create 1018<br />
		Pop $dialog<br />
<br />
	${NSD_CreateListbox} 0 0 100% 100% &quot;&quot;<br />
	    Pop $hwnd<br />
		${NSD_OnChange} $hwnd db_select.onchange<br />
		${GetDrives} &quot;ALL&quot; driveListFiller<br />
		<br />
	nsDialogs::Show<br />
FunctionEnd<br />
<br />
Function db_select.onchange<br />
    Pop $hwnd<br />
<br />
    SendMessage $hwnd ${LB_GETCURSEL} 0 0 $0<br />
    SendMessage $hwnd ${LB_GETTEXTLEN} $0 0 $1<br />
<br />
    System::alloc $1<br />
    Pop $2<br />
<br />
    SendMessage $hwnd ${LB_GETTEXT} $0 $2<br />
    System::Call &quot;*$2(&amp;t1024 .r3)&quot;<br />
    System::free $2<br />
<br />
    MessageBox MB_OK &quot;Drive selected: $3&quot;<br />
FunctionEnd<br />
<br />
Function driveListFiller<br />
	SendMessage $hwnd ${LB_ADDSTRING} 0 &quot;STR:$9 [$8]&quot;<br />
	Push 1<br />
FunctionEnd<br />
<br />
Section &quot;&quot;<br />
SectionEnd<br />
<br />
<br />
That said - yes, there's easier methods.. nsDialogs actually has good support for listboxes built-in;<br />
http://nsis.sourceforge.net/Docs/nsDialogs/Readme.html#mref-lbaddstring<br />
http://nsis.sourceforge.net/Docs/nsDialogs/Readme.html#mref-lbgetselection</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zeeh3</div><div class="date">12th March 2009, 16:13</div></div><div class="posttext">Sorry, it was a misunderstanding, the code worked for me too :)<br />
I was trying to say that the code could be smaller.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th March 2009, 16:57</div></div><div class="posttext">not much smaller - short of abstracting it into a macro/function; which is what NSD_LB_GetSelection and such are</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>