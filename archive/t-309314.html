<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Hex to ASCII and back, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Hex to ASCII and back NSIS Discussion" />
	
	<title> Hex to ASCII and back [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Hex to ASCII and back</div>
<hr />
<div class="pda"><a href="t-309314.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=309314">Hex to ASCII and back</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 03:59</div></div><div class="posttext">I'm working on modifying a hex file and I've searched but I haven't found a clear answer on this.<br />
<br />
I just want to be able to open a file using FileOpen, find what I'm looking for with either FileSeek, unless there is an easier way, and then modify it using FileWriteByte and then FileClose.<br />
<br />
I need to read the file in Hex, convert it to ASCII, then go from ASCII to Hex to write it again...even if I have to do some extra converts, that's the basic idea I have.<br />
<br />
I'm only going to be changing one character, but I haven't found an easy way to do this.<br />
<br />
Thanks in Advance for the help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 07:12</div></div><div class="posttext">Alright, well, I've got it mostly figured out.<br />
<br />
Here is what I used<br />
<br />
IntFmt $2 &quot;%C&quot; &quot;0x$1&quot;<br />
<br />
to do what I want...but now I've run into a new issue...<br />
<br />
I need to read a certain hex out of this file here (http://papps.gizmokid2005.com/Others/%7B95e21257-dd32-4a4c-a8cf-b404864bc2a8%7D.7z) and I can't seem to figure out which byte to read.<br />
<br />
The character I want is (I guess it depends on which editor you use) is the FIRST instance of 0x54 (letter: &quot;T&quot;).  In one editor I used, it says the offset it 9 so..I don't know if that helps or not.<br />
<br />
I just can't seem to seek to the right location and read the right byte so I can replace it.<br />
<br />
This is where I'm currently at your mercy.  Can anyone tell me what I should be using to get to this particular hex and read/write it??<br />
<br />
I need to replace that exact hex 0x54 with another hex that'll be the same length, but could be almost any character from A-Z.  Insight here would be extremely appreciated also.<br />
<br />
Here is the code that I've been working with to get to where I want to be:<br />
<br />
  		FileOpen $0 &quot;$PROFILEDIRECTORY\fstrees\$TREEFILE&quot; a<br />
  		FileSeek $0 9 SET $1<br />
  		FileReadByte $1 $2<br />
  		IntFmt $3 &quot;%C&quot; &quot;0x$2&quot;<br />
<br />
as well as many variations thereof, but I can't find the right byte.<br />
<br />
(I'm currently working on this in a PortableApps.com Launcher to portablize Songbird.  And this file is part of their watch folders setup, in hex, so I have to edit this one character as it's the drive letter -- if this helps at all).<br />
<br />
Again, Thanks in advance for any help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 07:14</div></div><div class="posttext">And the file from the URL (in case it's stripped out of my message).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">4th August 2009, 14:03</div></div><div class="posttext">This code fragment might help you  FileOpen $0 &quot;$TREEFILE&quot; a<br />
  <br />
  FileSeek $0 9 SET<br />
  FileReadByte $0 $2<br />
  IntFmt $3 &quot;%C&quot; &quot;$2&quot;<br />
  <br />
  DetailPrint &quot;$$3 = '$3'&quot;<br />
<br />
  FileClose $0It produces this output when used with the sample file you supplied:$3 = 'T'<br />
Completed</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 15:12</div></div><div class="posttext">Originally posted by pengyou <br />
This code fragment might help you  FileOpen $0 &quot;$TREEFILE&quot; a<br />
  <br />
  FileSeek $0 9 SET<br />
  FileReadByte $0 $2<br />
  IntFmt $3 &quot;%C&quot; &quot;$2&quot;<br />
  <br />
  DetailPrint &quot;$$3 = '$3'&quot;<br />
<br />
  FileClose $0It produces this output when used with the sample file you supplied:$3 = 'T'<br />
Completed  <br />
<br />
THANK YOU!!!  I'm so grateful I could kiss you!!  (But I won't, that would be weird).<br />
<br />
I tried 9, my issue must've been with the IntFmt using the 0x also instead of just the byte I read.  OH well.  I'm going to tinker some more, I have to convert bytes some more still.  This is a huge help!  :D  thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 16:07</div></div><div class="posttext">Now I can't format from string back to hex...<br />
<br />
I'm using the following:<br />
IntFmt $3 &quot;%lX&quot; &quot;C&quot;<br />
<br />
and it returns nothing but &quot;0&quot;.  I've tried &quot;%x&quot;, &quot;%X&quot;, &quot;%lx&quot;, &quot;%lX&quot; but none of them return nothing but &quot;0&quot;.  Am I doing something wrong?  I've even tried adding &quot;0x&quot; in front of those and I still get nothing :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">4th August 2009, 16:40</div></div><div class="posttext">There is a LogicLib.nsh function called  ${CharToASCII} which helps when you need to manipulate ASCII codes.<br />
<br />
See this wiki page for further details: http://nsis.sourceforge.net/CharToASCII<br />
<br />
Here is a simple example which uses that function: http://forums.winamp.com/showthread.php?postid=2530285#post2530285</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 16:50</div></div><div class="posttext">I'm trying that now, when I include the CharToASCII I get the following error:<br />
!define: &quot;CharToASCII&quot;=&quot;!insertmacro CharToASCII&quot;<br />
Function: &quot;CharToASCII&quot;<br />
Exch($0,0)<br />
Push: $1<br />
Push: $2<br />
StrCpy $2 &quot;1&quot; () ()<br />
IntFmt: $2-&gt;$1 (fmt:%c)<br />
Invalid command: ${If}<br />
!include: error in script: &quot;CharToASCII.nsh&quot; on line 17</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">4th August 2009, 16:59</div></div><div class="posttext">Did you include LogicLib.nsh in your script? You need to include that file in order to be able to use &quot;${If}&quot;.<br />
<br />
I need to correct my last reply: I should have said &quot;There is a LogicLib.nsh-based function called ${CharToASCII} ...&quot; because ${CharToASCII} is not actually included in LogicLib.nsh.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 17:01</div></div><div class="posttext">Oh wow...I apparently missed that.  Lemme add it and try again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 17:27</div></div><div class="posttext">Here's what I managed:<br />
FileOpen $0 &quot;$PROFILEDIRECTORY\fstrees\$TREEFILE&quot; a<br />
  		FileSeek $0 9 SET<br />
  		FileReadByte $0 $1<br />
  		IntFmt $2 &quot;%C&quot; &quot;$1&quot;<br />
  		${StrStrip} &quot;:&quot; $LASTDRIVE $3<br />
          ;StrCmp $2 $5<br />
          ${CharToASCII} $4 $3<br />
          IntFmt $5 &quot;%lX&quot; &quot;$4&quot;<br />
<br />
Where the character I'm reading from the .tree file is &quot;T&quot; and the character from last drive is &quot;C&quot; (at least in this case).<br />
<br />
This returns what I need finally :)<br />
<br />
Thanks pengyou, again, for all your help, even in my blatant stupidity :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">4th August 2009, 17:41</div></div><div class="posttext">And ONE last nagging question.<br />
<br />
I want to replace the byte that I've read, with the byte I just converted...  I'm guessing something like this, but I don't think it's going to be this easy...is it?:<br />
<br />
  		FileOpen $0 &quot;$PROFILEDIRECTORY\fstrees\$TREEFILE&quot; a<br />
  		FileSeek $0 9 SET<br />
  		FileReadByte $0 $1<br />
  		IntFmt $2 &quot;%C&quot; &quot;$1&quot;<br />
  		${StrStrip} &quot;:&quot; $LASTDRIVE $3<br />
          ;StrCmp $2 $3<br />
          ${CharToASCII} $4 $3<br />
          IntFmt $5 &quot;%lX&quot; &quot;$4&quot;<br />
          FileWriteByte $0 $5<br />
          FileClose $0<br />
<br />
Ignore the StrCmp for now, that's just so I don't forget I need that there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">4th August 2009, 18:20</div></div><div class="posttext">I'm guessing something like this, but I don't think it's going to be this easy...is it?:I think that was close but not quite there. Try something like thisFileOpen $0 &quot;$PROFILEDIRECTORY\fstrees\$TREEFILE&quot; a<br />
FileSeek $0 9 SET<br />
FileReadByte $0 $1<br />
IntFmt $2 &quot;%C&quot; &quot;$1&quot;<br />
${StrStrip} &quot;:&quot; $LASTDRIVE $3<br />
;StrCmp $2 $3<br />
${CharToASCII} $4 $3<br />
<br />
FileSeek $0 9 SET<br />
FileWriteByte $0 $4<br />
<br />
FileClose $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">5th August 2009, 07:44</div></div><div class="posttext">Wow...I'm not getting anywhere again, pulling my hair out.<br />
<br />
I've attached my current .tree file.<br />
<br />
Here's the code I'm using (explanation to follow):<br />
<br />
<br />
  		FileOpen $0 &quot;$PROFILEDIRECTORY\fstrees\$TREEFILE&quot; a<br />
  		FileSeek $0 9 SET<br />
  		FileReadByte $0 $1<br />
  		FileSeek $0 10 SET<br />
  		FileReadByte $0 $7<br />
  		IntFmt $2 &quot;%C&quot; &quot;$1&quot;<br />
  		${StrStrip} &quot;:&quot; $CURRENTDRIVE $3<br />
          ${CharToASCII} $4 $3<br />
          IntFmt $5 &quot;%lX&quot; &quot;$4&quot;<br />
          FileSeek $0 9 SET<br />
          FileWriteByte $0 $5<br />
          FileSeek $0 9 SET<br />
          FileReadByte $0 $6<br />
          FileSeek $0 1 SET<br />
          FileReadByte $0 $8<br />
  		Messagebox MB_OK|MB_ICONEXCLAMATION `$1 -- $2 -- $3 -- $4 -- $5 -- $6 -- $7 -- $8`<br />
<br />
Now, in here I'm trying to read the &quot;F&quot; and change it to a new letter, in my testing I was aiming for J.<br />
<br />
I've added the Messagebox to show the variables (self-explanatory now), for debugging.  What seems to be happening, is it reads the F fine, formats it to a character beautifully, and then it reads the currentdrive, J, encodes it correctly to the hex equivalent (4A), as shown by $5, but then when I read the Byte again, it only reads as &quot;4&quot; as shown by $6.  $7 and $8 also both read as zero.  When I look at the file again, the previous drive letter &quot;F&quot; was replaced with EOT, whose hex equivalent is &quot;4&quot;.  So it seems that only one byte is being written, not both??<br />
<br />
I have to recode the $4 back to hex because that's how the file is stored, hence the IntFmt to create $5.  Which, I checked, is the right hex value.<br />
<br />
Do I have to just split and write the bytes separately??  I'm just kinda lost on why it's not working.<br />
<br />
Don't worry, I plan on cleaning up the reads and whatnot after I get this debugged, I'm just trying to figure it out.<br />
<br />
Thanks AGAIN.  (I'm a pain, I know).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">5th August 2009, 09:32</div></div><div class="posttext">FileWriteByte writes a SINGLE byte to the file. ASCII characters fit into a SINGLE byte so to change the letter 'F' to the letter 'J' all you need to do is change a SINGLE byte.<br />
<br />
Look again at the last code fragment I supplied. When I tested it the code was able to change the 'T' in your sample data to a 'Z'.<br />
<br />
There is no need to do the hex conversion; notice that my code does NOT use IntFmt to convert the result from CharToASCII.<br />
<br />
In my code the result from CharToASCII is written directly to the file. ASCII characters fit into a single byte so there is no need to do anything to the result before FileWriteByte is used to save the result in the file.<br />
<br />
FileWriteByte only writes a single byte to the file (i.e. it writes a value between 0 and 255 or, if you prefer to think in hex, between 0x00 and 0xFF). If you supply a value that is too big to fit into a single byte, FileWriteByte will only write the bottom 8 bits, e.g. supply 256 and it will write 0 into the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Gizmokid2005</div><div class="date">5th August 2009, 15:18</div></div><div class="posttext">Thank you!!  I was overcomplicating it I suppose...it works beautifully without the IntFmt.  I guess that just didn't click in my mind.  Now it works as it should :) (So far).<br />
<br />
Thanks again for everything pengyou!!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">5th August 2009, 15:53</div></div><div class="posttext">Originally posted by Gizmokid2005 <br />
Now it works as it should :) Glad to hear that you have got it working now.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>