<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Ini edit not being observed by installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Ini edit not being observed by installer NSIS Discussion" />
	
	<title> Ini edit not being observed by installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Ini edit not being observed by installer</div>
<hr />
<div class="pda"><a href="t-334382.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=334382">Ini edit not being observed by installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Rajada</div><div class="date">4th September 2011, 15:50</div></div><div class="posttext">I have an installer that edits the ini file of a particular application. The installer basically changes the value of an integer to a non-zero value (the exact number depends on the situation). If the ini line has a value of zero, the exe carries out function A (just using placeholder names) and if the value is not zero it carries out function B.<br />
<br />
If I edit the number in the ini with a text editor everything runs fine afterwards. If I let the installer edit the value, then exit the installer and run the exe everything still runs fine. The problem comes in if I have the exe listed as the program to run after installation is complete. If I run the exe using the checkbox at the end of the installer (close installer and run exe), the exe acts as if the ini value is 0, no matter what it really is set to.<br />
<br />
Is there some ini save function I need to call to get this to behave the correct way?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th September 2011, 17:46</div></div><div class="posttext">First of all, verify that the value is correctly set to non-zero, before you click Finish on the finish page.<br />
<br />
Second, what OS is this? Admin or user? What directory is the ini file in?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">4th September 2011, 18:33</div></div><div class="posttext">Did you use the FlushINI command?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rajada</div><div class="date">4th September 2011, 21:35</div></div><div class="posttext">To be honest, I acquired the main installer source code from a friend who didn't want to work on it anymore. The flush ini function is nowhere to be found in the script. What is its usage and what effects does it have?<br />
<br />
My OS is Windows 7, but the same problem has been confirmed on machines as old as Windows XP. The installer runs as an administrator by default. The ini is installed to a user chosen directory that is confirmed to have a prerequisite application. I can open the ini before, during and after installation and confirm that the non-zero value is there, it just seems like it is being ignored.<br />
<br />
This is the tidbit of code that I think is most relevant.<br />
<br />
Function checkUpdaterINI<br />
<br />
   IfFileExists &quot;$INSTDIR\Updater2\updater.ini&quot; 0 copy<br />
       	${ConfigRead} &quot;$INSTDIR\Updater2\updater.ini&quot; &quot;LastUpdate = &quot; $R1<br />
<br />
${If} $R1 &gt;= 17 ; Skip INI, leave it alone<br />
      ; Greater than or equal to INI number<br />
      Goto done<br />
      <br />
${Else} ; Update INI<br />
       ; Less than update INI number<br />
        Push &quot;$INSTDIR\Updater2\updater.ini&quot; ; file to modify<br />
        Push &quot;LastUpdate&quot; ; string that a line must begin with<br />
        Push &quot;LastUpdate = 17&quot; ; string to replace whole line with<br />
        Call ReplaceLineStr<br />
       Goto done<br />
${EndIf}<br />
<br />
        copy: ; Overide entire INI<br />
                SetOutPath &quot;$INSTDIR\Updater2&quot;<br />
                File &quot;NerfCP\Updater2\updater.ini&quot;<br />
         Goto done<br />
         <br />
<br />
        done:<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th September 2011, 22:28</div></div><div class="posttext">Use ReadINIStr/WriteINIStr if possible. I'm not sure this still applies to Windows 7 but on 9x INI files were cached in memory and so you had to use FlushINI to write the buffers to disk.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">5th September 2011, 05:47</div></div><div class="posttext">The flush ini function is nowhere to be found in the script. What is its usage and what effects does it have?<br />
As is often the case, it's all in the manual:  http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.8<br />
<br />
The installer runs as an administrator by default.<br />
There's no such thing as a default admin. If you need admin you have to enforce it (using the userinfo plugin in .onInit for example).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Roger_wgnr</div><div class="date">5th September 2011, 06:05</div></div><div class="posttext">What code is in the ReplaceLineStr function? this is where the INI actually gets updated from what I see. You push values to the stack and Call ReplaceLineStr, I imagine that the values are Pop'd in this function and the INI updated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Rajada</div><div class="date">5th September 2011, 08:10</div></div><div class="posttext">Well here's the thing, this installer was coded with a very old version of NSIS. My thought is I should rewrite this now to use WriteIniString like my other updated bits of code and include the flushing function. If that doesn't solve the problem I'll have to do more digging.<br />
<br />
And sorry about the confusion, it installs components fine with the current user account settings, so I know that isn't the issue. All I meant is that it asks on all systems I've tested to install as an administrator and works fine every time.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>