<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Serial Strangeness, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Serial Strangeness NSIS Discussion" />
	
	<title> Serial Strangeness [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Serial Strangeness</div>
<hr />
<div class="pda"><a href="t-281896.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281896">Serial Strangeness</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">21st November 2007, 21:05</div></div><div class="posttext">Hi there :)<br />
<br />
I have this code which i use to validate a serial code: the user types their serial code in a box which then posts to a webpage to check against a MySQL database and says VALID if the key is valid and INVALID if not<br />
<br />
if the key is entered correctly, there is no problem. If the key is NOT then the page for entering the serial is shown again. The only difference is that when you enter the key the second time, it doesn't matter if the key is correct or not, it doesn't bother to validate. Please advise. I have posted the bit of code which validates below:<br />
<br />
<br />
Function SerialPageShow<br />
	!insertmacro MUI_HEADER_TEXT &quot;Enter Serial Code&quot; &quot;Enter the software serial code to continue.&quot;<br />
<br />
	PassDialog::Dialog Serial            \<br />
                    /HEADINGTEXT 'Please enter the serial code...' \<br />
                    /CENTER             \<br />
                    /BOXDASH 12  70 5 '' \<br />
                    /BOXDASH 92  70 5 ''  \<br />
                    /BOXDASH 172 70 5 ''   \<br />
                    /BOXDASH 252 70 5 ''    \<br />
                    /BOX     332 70 5 ''<br />
<br />
Pop $R0 # success, back, cancel or error<br />
FunctionEnd<br />
<br />
Function SerialPageLeave<br />
<br />
	## Pop values from stack<br />
	Pop $R1<br />
	Pop $R2<br />
	Pop $R3<br />
	Pop $R4<br />
	Pop $R5<br />
<br />
	;!insertmacro MUI_HEADER_TEXT &quot;Validating...&quot; &quot;Please Wait&quot;<br />
	;!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;validateSerial.ini&quot;<br />
<br />
	;MessageBox MB_OK &quot;Break1&quot;<br />
<br />
FunctionEnd<br />
<br />
Function validateSerial<br />
<br />
	;MessageBox MB_OK &quot;Break2&quot;<br />
<br />
	;## Disable the Back button<br />
	;GetDlgItem $R6 $HWNDPARENT 3<br />
	;EnableWindow $R6 0<br />
	;## Disable the Next button<br />
	;GetDlgItem $R6 $HWNDPARENT 1<br />
	;EnableWindow $R6 0<br />
<br />
	GetTempFileName $0<br />
	InetLoad::load /post &quot;licence=$R1-$R2-$R3-$R4-$R5&quot; &quot;http://www.mysite.co.uk/install/verify.php&quot; &quot;$0&quot; /slient &quot;&quot;<br />
	Pop $1 # $1 now holds the exit code for above<br />
<br />
	FileOpen $2 $0 &quot;r&quot;<br />
	FileRead $2 $3<br />
	FileClose $2<br />
<br />
	${If} $3 == 'INVALID'<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Invalid Serial&quot;<br />
	Call SerialPageShow<br />
	${Else}<br />
	Goto serialOK<br />
	${EndIf}<br />
<br />
	Abort<br />
<br />
	serialOK:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st November 2007, 21:58</div></div><div class="posttext">Move the contents of validateSerial into SerialPageLeave.<br />
You don't Call SerialPageShow to show the page again... you just call Abort.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">22nd November 2007, 19:05</div></div><div class="posttext">you mean like this:<br />
<br />
Function SerialPageLeave<br />
<br />
	## Pop values from stack<br />
	Pop $R1<br />
	Pop $R2<br />
	Pop $R3<br />
	Pop $R4<br />
	Pop $R5<br />
<br />
	;!insertmacro MUI_HEADER_TEXT &quot;Validating...&quot; &quot;Please Wait&quot;<br />
	;!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;validateSerial.ini&quot;<br />
<br />
	;MessageBox MB_OK &quot;Break1&quot;<br />
<br />
<br />
	;MessageBox MB_OK &quot;Break2&quot;<br />
<br />
	;## Disable the Back button<br />
	;GetDlgItem $R6 $HWNDPARENT 3<br />
	;EnableWindow $R6 0<br />
	;## Disable the Next button<br />
	;GetDlgItem $R6 $HWNDPARENT 1<br />
	;EnableWindow $R6 0<br />
<br />
	GetTempFileName $0<br />
	InetLoad::load /post &quot;licence=$R1-$R2-$R3-$R4-$R5&quot; &quot;http://www.mysite.co.uk/site/verify.php&quot; &quot;$0&quot; /slient &quot;&quot;<br />
	Pop $1 # $1 now holds the exit code for above<br />
<br />
	FileOpen $2 $0 &quot;r&quot;<br />
	FileRead $2 $3<br />
	FileClose $2<br />
<br />
	${If} $3 == 'INVALID'<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Invalid Serial&quot;<br />
	Call SerialPageShow<br />
	${Else}<br />
	Goto serialOK<br />
	${EndIf}<br />
<br />
	Abort<br />
<br />
	serialOK:<br />
<br />
FunctionEnd<br />
<br />
<br />
or like this:<br />
<br />
Function SerialPageLeave<br />
	;MessageBox MB_OK &quot;Break1&quot;<br />
<br />
<br />
	;MessageBox MB_OK &quot;Break2&quot;<br />
<br />
	;## Disable the Back button<br />
	;GetDlgItem $R6 $HWNDPARENT 3<br />
	;EnableWindow $R6 0<br />
	;## Disable the Next button<br />
	;GetDlgItem $R6 $HWNDPARENT 1<br />
	;EnableWindow $R6 0<br />
<br />
	GetTempFileName $0<br />
	InetLoad::load /post &quot;licence=$R1-$R2-$R3-$R4-$R5&quot; &quot;http://www.mysite.co.uk/site/verify.php&quot; &quot;$0&quot; /slient &quot;&quot;<br />
	Pop $1 # $1 now holds the exit code for above<br />
<br />
	FileOpen $2 $0 &quot;r&quot;<br />
	FileRead $2 $3<br />
	FileClose $2<br />
<br />
	${If} $3 == 'INVALID'<br />
	MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Invalid Serial&quot;<br />
	Call SerialPageShow<br />
	${Else}<br />
	Goto serialOK<br />
	${EndIf}<br />
<br />
	Abort<br />
<br />
	serialOK:<br />
<br />
FunctionEnd<br />
<br />
<br />
Using the first method, the installer exits the second time a code is entered whether valid or not.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd November 2007, 20:50</div></div><div class="posttext">Function SerialPageLeave<br />
<br />
  ## Pop values from stack<br />
  Pop $R1<br />
  Pop $R2<br />
  Pop $R3<br />
  Pop $R4<br />
  Pop $R5<br />
<br />
  GetTempFileName $0<br />
  InetLoad::load /post &quot;licence=$R1-$R2-$R3-$R4-$R5&quot; /silent &quot;&quot; &quot;http://www.mysite.co.uk/site/verify.php&quot; &quot;$0&quot; /end<br />
  Pop $1 # $1 now holds the exit code for above<br />
<br />
  FileOpen $2 $0 &quot;r&quot;<br />
  FileRead $2 $3<br />
  FileClose $2<br />
<br />
  ${If} $3 == 'INVALID'<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Invalid Serial&quot;<br />
    Abort<br />
  ${EndIf}<br />
<br />
FunctionEnd<br />
Notice I have changed your InetLoad parameters a bit so that it's to the readme spec.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">23rd November 2007, 15:37</div></div><div class="posttext">Edit (again!): The installer now simply says the code is invalid, even if the database doesn't say INVALID, but says Serial Validated</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd November 2007, 19:03</div></div><div class="posttext">I have swapped the /silent and /post switched around.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">24th November 2007, 12:56</div></div><div class="posttext">so should I switch them round?<br />
still says invalid for all serials<br />
<br />
don't know if this is just my pc, but the installer takes at least 20 seconds to try and check (and fail) the serial the first time then only about 2 seconds the second, third, fourth etc times.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th November 2007, 14:09</div></div><div class="posttext">Check the exit code. Your code would not have worked because all switches go before the url parts, not to mention you had /slient not /silent :)<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">24th November 2007, 14:29</div></div><div class="posttext">ok... i'm now a little confused... can you post the code to show what you mean... thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th November 2007, 20:57</div></div><div class="posttext">Pop $1 # $1 now holds the exit code for above<br />
<br />
Check the value of $1.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">24th November 2007, 21:01</div></div><div class="posttext">umm... how would i do that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th November 2007, 21:42</div></div><div class="posttext">With a MessageBox perhaps :)<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">25th November 2007, 11:02</div></div><div class="posttext">ahh :)<br />
<br />
like this:    MessageBox MB_OK|MB_ICONEXCLAMATION &quot;$1&quot;<br />
<br />
the message box says &quot;SendRequest Error&quot;<br />
<br />
and the installer has now started validating every code... :confused:<br />
<br />
if you want to take a look at the installer to see for yourself i can post it here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th November 2007, 15:17</div></div><div class="posttext">If there is an error then obviously there is something wrong. Try removing the /silent &quot;&quot; bit.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">25th November 2007, 16:28</div></div><div class="posttext">the installer just goes straight onto the components page and doesn't try to access the validate.php file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th November 2007, 17:23</div></div><div class="posttext">There must be something wrong with your php script or website. The code works fine for me using a different php script with post data.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">25th November 2007, 17:36</div></div><div class="posttext">Please note, that FileRead returns string with newline char at the end (if  any), so comparision may require a kind of trim for incoming string (or just use 'INVALIDE$\n' in ${if} statement). The following test works correct for me:    InetLoad::load /post &quot;licence=INVALID&quot; /silent &quot;&quot; &quot;http://localhost/echo.php&quot; &quot;$EXEDIR\echo.htm&quot; /end<br />
Pop $0 # &quot;OK&quot; means okay<br />
FileOpen $2 &quot;$EXEDIR\echo.htm&quot; &quot;r&quot;<br />
FileRead $2 $3<br />
FileClose $2<br />
MessageBox MB_OK &quot;Download Status: $0, Result = &lt;$3&gt;&quot;<br />
StrCmp $3 &quot;INVALID&quot; 0 +2<br />
MessageBox MB_OK &quot;Invalid Serial&quot;for the following test php&lt;?php $n = 0; foreach($_REQUEST as $v) {echo $v; if($n &gt; 0) echo &quot;\n&quot;; $n++; } ?&gt;But comparision require 'INVALIDE$\n' if newline presents in the server reply.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">26th November 2007, 19:11</div></div><div class="posttext">Originally posted by Afrow UK <br />
There must be something wrong with your php script or website. The code works fine for me using a different php script with post data.<br />
<br />
Stu  <br />
<br />
what is your php script like?<br />
i've checked the php manually (launched my browser and gone to the URL) and when i &quot;post&quot; an invalid code the source of the page simply says<br />
INVALID<br />
and when i &quot;post&quot; a valid one,<br />
Serial Validated<br />
Thats all the source shows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th November 2007, 19:46</div></div><div class="posttext">My PHP script is just a normal webpage. The only thing I can think of is make sure you set the content type to plain text before displaying your result in the PHP script:<br />
<br />
header(&quot;Content-Type: text/plain&quot;);<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">29th November 2007, 15:06</div></div><div class="posttext">:l still doesn't work... <br />
<br />
a temporary URL for the script is Here (http://angusi.letsgethappy.co.uk/verify.php) - At the moment any code should read INVALID...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">1st December 2007, 15:49</div></div><div class="posttext">This is really starting to annoy me now lol... I tried putting some of this into my script:<br />
<br />
Originally posted by Takhir <br />
<br />
InetLoad::load /post &quot;licence=$R1-$R2-$R3-$R4-$R5&quot; /silent &quot;&quot; &quot;http://www.mysite.com/site/verify.php&quot; &quot;$EXEDIR\echo.htm&quot; /end<br />
Pop $0 # &quot;OK&quot; means okay<br />
FileOpen $2 &quot;$EXEDIR\echo.htm&quot; &quot;r&quot;<br />
FileRead $2 $3<br />
FileClose $2<br />
MessageBox MB_OK &quot;Download Status: $0, Result = &lt;$3&gt;&quot;<br />
StrCmp $3 &quot;INVALID&quot; 0 +2<br />
MessageBox MB_OK &quot;Invalid Serial&quot;<br />
<br />
<br />
the $EXEDIR\echo.htm reads INVALID, but not in text/plain formatting - is that somehow relevant?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd December 2007, 14:35</div></div><div class="posttext">Make sure you aren't placing any new line characters on the end of the output string. FileRead reads new line characters as well.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">2nd December 2007, 15:20</div></div><div class="posttext">would that not mean that if would validate every code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd December 2007, 16:15</div></div><div class="posttext">Sorry?<br />
Just make sure in your PHP script you're echoing &quot;INVALID&quot; and not &quot;INVALID\r\n&quot; for example.<br />
<br />
What does your message box display?<br />
MessageBox MB_OK &quot;Download Status: $0, Result = &lt;$3&gt;&quot;<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">angusi</div><div class="date">4th December 2007, 18:45</div></div><div class="posttext">&quot;INVALID&quot;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>