<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System Font, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System Font NSIS Discussion" />
	
	<title> System Font [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System Font</div>
<hr />
<div class="pda"><a href="t-207640.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207640">System Font</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">13th February 2005, 13:07</div></div><div class="posttext">Is there a risk in changing the font of the installer?<br />
<br />
Normally the default font &quot;MS Shell Dlg&quot; on Windows XP resolves as Tahoma. For &quot;subjective&quot; reasons I believe Microsoft Sans Serif looks better.<br />
<br />
What would happen if the local target system does not have Microsoft Sans Serif?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th February 2005, 13:24</div></div><div class="posttext">All systems should have Sans Serif. This is so because in CSS, sans-serif is on the list of 'certified fonts' that must exist on all systems as specified by W3C.<br />
<br />
Anyway, I'm sure that if the font you specify does not exist, then the default Windows font will be used anyway.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">13th February 2005, 13:54</div></div><div class="posttext">There are about three different Sans Serif fonts installed into the Windows Font folder.<br />
<br />
Microsoft Sans Serif is not necessarily one of them.<br />
<br />
I recently found this on the internet:<br />
<br />
These are the only *.ttf fonts you will absolutely need...<br />
<br />
arial.ttf <br />
arialbd.ttf <br />
arialbi.ttf <br />
ariali.ttf <br />
courbd.ttf <br />
lucon.ttf <br />
marlett.ttf <br />
micross.ttf <br />
tahoma.ttf <br />
tahomabd.ttf <br />
times.ttf <br />
timesbd.ttf <br />
verdana.ttf <br />
verdanab.ttf <br />
verdanai.ttf <br />
verdanaz.ttf <br />
<br />
Just now I've been experimenting with Vogue. I disable Vogue (in Adobe Type Manager) and the installer substitutes it with an illegible font.<br />
<br />
This suggests you need to install and register fonts.<br />
<br />
Is that true, and is there an easy script for it?<br />
<br />
I'm too lazy to search the board, I guess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">13th February 2005, 14:45</div></div><div class="posttext">I had to make sure I wasn't spreading any lies.<br />
<br />
I have a backup image of Windows 95 and the Fonts folder does not include micross.ttf = Microsoft Sans Serif.<br />
<br />
That's the truth.<br />
<br />
And I found this piece of code on the message board:<br />
!include WinMessages.nsh<br />
System::Call &quot;GDI32::AddFontResourceA(t) i ('micross.ttf') .s&quot;<br />
Pop $0<br />
# $0 is zero if the function failed<br />
SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0<br />
Would the system have time to register the font if a function were to call the code during the initialization in MUI_CUSTOMFUNCTION_GUIINIT?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th February 2005, 15:10</div></div><div class="posttext">http://www.kayskreations.net/fonts/fonttb.html<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">13th February 2005, 15:31</div></div><div class="posttext">Thank you, Stu,<br />
<br />
I visited your link.<br />
<br />
Windows XP has:<br />
<br />
Microsoft Sans Serif <br />
Modern MS Sans Serif <br />
<br />
And Windows 95 only has:<br />
<br />
MS Sans Serif<br />
<br />
That might be a problem.<br />
<br />
As to using code or a plug-in to register the font, others have more experience than I do. I consider this a good point to ask:<br />
<br />
Can you register a font before an installation so it shows up during the installation?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">13th February 2005, 18:40</div></div><div class="posttext">There's this cool plugin you can use on here (fonts.dll):<br />
http://nsis.sourceforge.net/archive/download.php<br />
<br />
You could try calling this in your installer's .onInit function, and then it should appear on your installer.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">13th February 2005, 23:02</div></div><div class="posttext">Thanks. The plug-in is worth a shot.<br />
<br />
I tested my installer on Windows 95. A version of the installer where I changed the font to Microsoft Sans Serif replaced the missing font with a typeface that was too large. The size of the setup window increased from 503x386 to 668x469 pixels, and bold page headers did not become bigger.<br />
<br />
I will spare you the screenshot.<br />
<br />
I noticed something else in Windows 95. My code has a glitch, but I can't see what's wrong. I'm trying to hide a checkbox from non-NT Windows.<br />
<br />
Function .onInit<br />
  UserInfo::GetAccountType<br />
  Pop $1<br />
  StrCpy $ACCOUNT &quot;$1&quot; #<br />
  StrCmp $ACCOUNT &quot;Admin&quot; showcheckbox 0<br />
  StrCmp $ACCOUNT &quot;Power&quot; showcheckbox next<br />
  showcheckbox:<br />
    StrCpy $ACCOUNT &quot;access&quot; #<br />
  next:<br />
EndFunction<br />
<br />
Function SetCustom<br />
  StrCmp $ACCOUNT &quot;access&quot; 0 hidecheckbox<br />
    !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;ready.ini&quot;<br />
    Goto end<br />
  hidecheckbox:<br />
    !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;ready.ini&quot;<br />
    Pop $MUI_HWND<br />
    GetDlgItem $0 $MUI_HWND &quot;1203&quot;<br />
    ShowWindow $0 ${SW_HIDE}<br />
    !insertmacro MUI_INSTALLOPTIONS_SHOW<br />
  end:<br />
FunctionEnd<br />
<br />
The checkbox is hidden in Windows 95 (and 98) without the UserInfo::GetAccountType condition, so there must be something wrong with the condition. The code fails.<br />
<br />
Should I put this in a new topic under a new post, or is everyone okay with it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">14th February 2005, 09:01</div></div><div class="posttext">continued from previous<br />
<br />
RE: a compatibility issue when asking for the account type on computers which don't have user accounts, Windows 9x and ME.<br />
<br />
The proposed work-around, to run an NT check before querying the account type, doesn't work either. I omitted that from the code excerpt. Here is the first function again with the part I left out:<br />
<br />
Function .onInit<br />
  ClearErrors<br />
  UserInfo::GetName<br />
  IfErrors next ; an error occurs under Windows 9x!<br />
  UserInfo::GetAccountType<br />
  Pop $1<br />
  StrCpy $ACCOUNT &quot;$1&quot; #<br />
  StrCmp $ACCOUNT &quot;Admin&quot; showcheckbox 0<br />
  StrCmp $ACCOUNT &quot;Power&quot; showcheckbox next<br />
  showcheckbox:<br />
    StrCpy $ACCOUNT &quot;access&quot; #<br />
  next:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th February 2005, 12:13</div></div><div class="posttext">I think the reason that it's hidden on 9x is because of this:<br />
 ClearErrors <br />
 UserInfo::GetName <br />
 IfErrors next ; an error occurs under Windows 9x!<br />
Am I correct to assume you generally want those without user accounts enabled (ie Win95) to have access... so you could change your code around a little if that is the case...Function .onInit <br />
  ClearErrors<br />
  UserInfo::GetName<br />
  IfErrors next ; an error occurs under Windows 9x!<br />
  UserInfo::GetAccountType <br />
  Pop $ACCOUNT<br />
  StrCmp $ACCOUNT &quot;Admin&quot; next<br />
  StrCmp $ACCOUNT &quot;Power&quot; next<br />
    StrCpy $ACCOUNT &quot;noaccess&quot; #<br />
  next:<br />
FunctionEnd<br />
<br />
Function SetCustom <br />
  StrCmp $ACCOUNT &quot;noaccess&quot; hidecheckbox <br />
    !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;ready.ini&quot; <br />
    Goto end <br />
  hidecheckbox: <br />
    !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;ready.ini&quot; <br />
    Pop $MUI_HWND <br />
    GetDlgItem $0 $MUI_HWND &quot;1203&quot; <br />
    ShowWindow $0 ${SW_HIDE} <br />
    !insertmacro MUI_INSTALLOPTIONS_SHOW <br />
  end: <br />
FunctionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">14th February 2005, 14:57</div></div><div class="posttext">I'd like to hide the checkbox. When a user ticks it, the shortcut folder will be put in the common startmenu folder for all users.<br />
<br />
That part of the code should be skipped by Windows 95, 98 and Windows ME. $ACCOUNT should equal &quot;&quot; on those systems; &quot;access&quot; should be defined for Administrators and Power Users only.<br />
<br />
Maybe this is a topic for a new post.<br />
<br />
Better news on the original topic. If you change the installer font to &quot;MS Sans Serif&quot; instead of &quot;Microsoft Sans Serif&quot;, it displays correctly in Windows 95, and Windows XP!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th February 2005, 16:17</div></div><div class="posttext">Have you used my code?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">14th February 2005, 17:14</div></div><div class="posttext">Sorry, no.<br />
<br />
I wasn't paying attention.<br />
<br />
Your code is better than mine, isn't it?<br />
<br />
I haven't tried it yet. I'll get on it.<br />
<br />
Thanks.<br />
<br />
ps: this should take about half an hour, if you want to hang around.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">14th February 2005, 18:28</div></div><div class="posttext">I'll be out of commission for a few days I have a feeling.<br />
<br />
Either my motherboard short-circuited or the CPU. The whole computer is dead.<br />
<br />
No condolence messages, please.<br />
<br />
I might be up and running again sooner than you think.<br />
<br />
Then again, maybe not.<br />
<br />
ps: I'm sending this from a laptop in case you're wondering.<br />
<br />
pps: Be careful when you switch those harddisks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th February 2005, 18:57</div></div><div class="posttext">It's practically the same except I've allowed those without user accounts (ie with no User Name) access for your check-box.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">19th February 2005, 04:17</div></div><div class="posttext">Stu, I'm back. In part. <br />
<br />
UserInfo::GetName fails to return an error... despite your slight variation. Thanks for the input (above).<br />
<br />
I think there is something perverse about the UserInfo plug-in. Wish I could put my finger on it.<br />
<br />
- Tom</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">19th February 2005, 13:40</div></div><div class="posttext">UserInfo::GetName fails to return an errorI have used the UserInfo plugin on Windows 9x systems and found that it does not return an error:<br />
<br />
UserInfo::GetName returns the Windows login name<br />
UserInfo::GetAccountType returns &quot;Admin&quot;<br />
<br />
The source code for the plugin shows that GetAccountType will return &quot;Admin&quot; if used on Win9x systems. I think an earlier version of the UserInfo plugin did return an error but that was a long time ago (the current source code file is dated November 2003).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">19th February 2005, 15:40</div></div><div class="posttext">It's supposed to return an error (and skip to next). On Windows 9x there are no users. GetUserName is followed by the IfErrors line.<br />
<br />
Concerning the source code, I agree with you. UserInfo::GetAccountType returns &quot;Admin&quot; on Win 9x systems. Again, why doesn't it just return &quot;&quot;, which would be more accurate?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">19th February 2005, 15:51</div></div><div class="posttext">On Windows 9x there are no users.This is not true - Win9x systems can have several users, each with their own Start Menu and desktop, etc.Again, why doesn't it just return &quot;&quot;, which would be more accurate?I do not agree. On Win9x every user is an Administrator, i.e. they usually have full access to the system.GetUserName is followed by the IfErrors line.If you are referring to the UserInfo.nsi script, that script is dated six months before the source code for the plugin - it seems the example script was not updated when the plugin was changed to return &quot;Admin&quot; on Win9x systems.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">19th February 2005, 19:24</div></div><div class="posttext">I am referring to the example.nsi. I took for granted that an error would be returned.<br />
<br />
I thought GetAccountType would detect the type of user account on NT-based OSes.<br />
<br />
There should be a plug-in to find out whether the user is on a non-NT-based OS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">20th February 2005, 14:19</div></div><div class="posttext">I prefer happy endings and practical solutions.<br />
<br />
A solution to what?<br />
<br />
Well, if you have been following this thread, you will be aware that the example script for the UserInfo plug-in is somewhat outdated and somewhat misleading. I was misled into believing you could adopt the script in order to hide a checkbox under Windows 9x and Windows ME. You can't, but here's what you can do:<br />
<br />
1. Create a custom page (see ..\NSIS\Contrib\InstallOptions\Readme.html - &quot;InstallOptions 2&quot;) <br />
2. Create a checkbox field (edit the INI file) <br />
3. Label the checkbox, for example: Make shortcuts available to all users<br />
4. Insert the code below into your *.nsi script<br />
<br />
; Variables<br />
Var ACCOUNT<br />
<br />
Function .onInit <br />
  ClearErrors<br />
  ReadRegStr $0 HKLM \<br />
  &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
  IfErrors next ; an error occurs under Windows 9x &amp; Windows ME!<br />
  UserInfo::GetAccountType <br />
  Pop $ACCOUNT<br />
  StrCmp $ACCOUNT &quot;Admin&quot; end<br />
  StrCmp $ACCOUNT &quot;Power&quot; end<br />
  next:<br />
    StrCpy $ACCOUNT &quot;noaccess&quot; #<br />
  end:<br />
FunctionEnd<br />
<br />
; Ready to install page<br />
Page custom SetCustom ValidateCustom &quot;&quot; ; Custom page. InstallOptions gets called in SetCustom.<br />
<br />
Function SetCustom <br />
  StrCmp $ACCOUNT &quot;noaccess&quot; hidecheckbox <br />
    !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;ready.ini&quot; <br />
    Goto end <br />
  hidecheckbox: <br />
    !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;ready.ini&quot; <br />
    Pop $MUI_HWND <br />
    GetDlgItem $0 $MUI_HWND &quot;1203&quot; ; 1200 + field number - 1<br />
    ShowWindow $0 ${SW_HIDE} <br />
    !insertmacro MUI_INSTALLOPTIONS_SHOW <br />
  end: <br />
FunctionEndDisclaimer: I'm only a junior member. I make mistakes.<br />
<br />
THE END</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>