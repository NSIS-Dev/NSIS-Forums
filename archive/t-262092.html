<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Unable to select sections without going to custom install, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Unable to select sections without going to custom install NSIS Discussion" />
	
	<title> Unable to select sections without going to custom install [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Unable to select sections without going to custom install</div>
<hr />
<div class="pda"><a href="t-262092.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262092">Unable to select sections without going to custom install</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">davidnewcomb</div><div class="date">19th December 2006, 17:58</div></div><div class="posttext">I have two sections &quot;Install&quot; and &quot;Extract&quot;, and 7 sections.<br />
&quot;Extract&quot; has 1 of the sections selected and this simply extracts the payload.<br />
&quot;Install&quot; does a number of tests and depending on external conditions selects 1 to 6 of the sections.<br />
I want to present the user with &quot;Extract&quot; or &quot;Install&quot;. The user will not be able to change any of the sections selected.<br />
<br />
Unfortunately, I keep running into problems. If I use SectionIn to designate which sections are assigned to an Install type, it switches to a 'Custom' Install option as soon as I change any of them. If I set the components page to use /NOCUSTOM then on loading it sets the Install component type to blank which disappears when I select another option.<br />
<br />
I want it to appear with Install and all the required options preselected, so the user can just click next.<br />
<br />
The example below is as close as I can get it :( The type of install is set to blank. When you manually set it to Install it sets the correct options, but this is an extra step which I am trying to get rid of.<br />
<br />
!include Sections.nsh<br />
!include MUI.nsh<br />
<br />
Name InstTest<br />
OutFile c:\InstText.exe<br />
InstallDir C:\Data\QuentinV3<br />
<br />
<br />
InstType &quot;Install&quot;<br />
InstType &quot;Extract&quot;<br />
InstType /NOCUSTOM<br />
<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
Section &quot;Install Java SDK&quot; sec_install_java<br />
    SectionIn ro 1<br />
SectionEnd<br />
<br />
Section &quot;Install MySQL database server&quot; sec_install_mysql<br />
    SectionIn ro 1<br />
SectionEnd<br />
<br />
Section &quot;ISA Manager&quot; sec_install_isa<br />
    SectionIn ro 1<br />
SectionEnd<br />
<br />
Section &quot;Configure Database&quot; sec_config_db<br />
    SectionIn ro 1<br />
SectionEnd<br />
<br />
Section &quot;Update Quantel database&quot; sec_config_update<br />
    SectionIn ro 1<br />
SectionEnd<br />
<br />
Section &quot;Downdate Quantel database&quot; sec_config_downdate<br />
    SectionIn ro 1<br />
SectionEnd<br />
<br />
Section &quot;File Extract Only&quot; sec_extract_only<br />
    SectionIn ro 2<br />
SectionEnd<br />
<br />
Function .onInit<br />
	!insertmacro ClearSectionInInstType &quot;${sec_install_java}&quot; &quot;${INSTTYPE_1}&quot;<br />
	!insertmacro ClearSectionInInstType &quot;${sec_config_update}&quot; &quot;${INSTTYPE_1}&quot;<br />
	!insertmacro SetSectionInInstType &quot;${sec_extract_only}&quot; &quot;${INSTTYPE_2}&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th December 2006, 22:36</div></div><div class="posttext">I guess this is what you're looking for :-)<br />
!define SF_USELECTED  0<br />
!define SF_SELECTED   1<br />
!define SF_RO         16<br />
<br />
Name InstTest<br />
OutFile 'InstText.exe'<br />
<br />
InstType &quot;Install&quot;<br />
InstType &quot;Extract&quot;<br />
InstType /NOCUSTOM<br />
<br />
!include MUI.nsh<br />
<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
Section &quot;Install Java SDK&quot; SEC_1<br />
;;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section &quot;Install MySQL database server&quot; SEC_2<br />
;;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section &quot;ISA Manager&quot; SEC_3<br />
;;;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section &quot;Configure Database&quot; SEC_4<br />
;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section &quot;Update Quantel database&quot; SEC_5<br />
;;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section &quot;Downdate Quantel database&quot; SEC_6<br />
;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section &quot;File Extract Only&quot; SEC_7<br />
;;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Function .onInit<br />
# execute at least this sample script twice by changing the Push below<br />
# respectively to contition1 contition2 and watch the action :-)<br />
  Push contition1<br />
  Pop $R0<br />
  StrCmp $R0 'contition1' contition1 contition2<br />
<br />
  contition1:<br />
  IntOp $0 ${SF_SELECTED} | ${SF_RO}<br />
<br />
  SectionSetFlags ${SEC_1} $0<br />
  SectionSetInstTypes ${SEC_1} 1<br />
<br />
  SectionSetFlags ${SEC_5} $0<br />
  SectionSetInstTypes ${SEC_5} 1<br />
<br />
  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br />
<br />
  SectionSetFlags ${SEC_2} $0<br />
<br />
  SectionSetFlags ${SEC_3} $0<br />
<br />
  SectionSetFlags ${SEC_4} $0<br />
<br />
  SectionSetFlags ${SEC_6} $0<br />
<br />
  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br />
<br />
  SectionSetFlags ${SEC_7} $0<br />
  SectionSetInstTypes ${SEC_7} 2<br />
<br />
  contition2:<br />
  StrCmp $R0 'contition2' 0 exit<br />
<br />
  IntOp $0 ${SF_SELECTED} | ${SF_RO}<br />
<br />
  SectionSetFlags ${SEC_1} $0<br />
  SectionSetInstTypes ${SEC_1} 1<br />
<br />
  SectionSetFlags ${SEC_5} $0<br />
  SectionSetInstTypes ${SEC_5} 1<br />
<br />
  SectionSetFlags ${SEC_2} $0<br />
  SectionSetInstTypes ${SEC_2} 1<br />
<br />
  SectionSetFlags ${SEC_3} $0<br />
  SectionSetInstTypes ${SEC_3} 1<br />
<br />
  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br />
<br />
  SectionSetFlags ${SEC_4} $0<br />
<br />
  SectionSetFlags ${SEC_6} $0<br />
<br />
  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br />
<br />
  SectionSetFlags ${SEC_7} $0<br />
  SectionSetInstTypes ${SEC_7} 2<br />
<br />
  exit:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davidnewcomb</div><div class="date">20th December 2006, 14:28</div></div><div class="posttext">Wow thanks, You have obviously put in a lot of work for this.<br />
It took quite a long time to understand how it works so I will add an explaination for others.<br />
<br />
The reason why my orginal showed blank in the selection list was because the selected sections did not match any of the predefined install types.<br />
<br />
After a bit of fiddling I found SetSectionInInstType in sections.nsh and wrote 2 macros to help standardise the SectionSet stuff.<br />
<br />
<br />
!macro AssignInstallSection P_SEC<br />
  Push $0<br />
  IntOp $0 ${SF_SELECTED} | ${SF_RO}<br />
  SectionSetFlags ${P_SEC} $0<br />
  Pop $0<br />
!macroend<br />
<br />
!macro UnassignInstallSection P_SEC<br />
  Push $0<br />
  IntOp $0 ${SF_USELECTED} | ${SF_RO}<br />
  SectionSetFlags ${P_SEC} $0<br />
  Pop $0<br />
!macroend<br />
<br />
Function .onInit<br />
<br />
!insertmacro SetSectionInInstType ${sec_install_java} 1<br />
!insertmacro AssignInstallSection ${sec_install_java}<br />
<br />
!insertmacro ClearSectionInInstType ${sec_install_mysql} 1<br />
!insertmacro UnassignInstallSection ${sec_install_mysql}<br />
<br />
!insertmacro ClearSectionInInstType ${sec_install_isa} 1<br />
!insertmacro UnassignInstallSection ${sec_install_isa}<br />
<br />
!insertmacro ClearSectionInInstType ${sec_config_db} 1<br />
!insertmacro UnassignInstallSection ${sec_config_db}<br />
<br />
!insertmacro SetSectionInInstType ${sec_config_update} 1<br />
!insertmacro AssignInstallSection ${sec_config_update}<br />
<br />
!insertmacro ClearSectionInInstType ${sec_config_downdate} 1<br />
!insertmacro UnassignInstallSection ${sec_config_downdate}<br />
<br />
!insertmacro SetSectionInInstType ${sec_extract_only} 2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">20th December 2006, 14:54</div></div><div class="posttext">Î¥ou're welcome!. Nice job from your side!<br />
Perhaps you may want to take a look at the attached below sample. I think it is a little more pro looking :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">davidnewcomb</div><div class="date">20th December 2006, 18:11</div></div><div class="posttext">Maybe 1 for the Wiki!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">20th December 2006, 18:18</div></div><div class="posttext">I've already posted a topic  at wiki (http://nsis.sourceforge.net/Managing_Sections_on_Runtime) with the above sample code because here in forum after a few days is not easy to find it by someone who might need it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>