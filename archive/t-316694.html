<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Update 32 bit installer with 64 bit, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Update 32 bit installer with 64 bit NSIS Discussion" />
	
	<title> Update 32 bit installer with 64 bit [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Update 32 bit installer with 64 bit</div>
<hr />
<div class="pda"><a href="t-316694.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316694">Update 32 bit installer with 64 bit</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Maxim30</div><div class="date">31st January 2010, 21:15</div></div><div class="posttext">Hello,<br />
I would change the default $PROGRAMFILES constant, in InstallDir attribute for a 32 bit system, into another one that shift to $PROGRAMFILES64 for a 64 bit system but remaining $PROGRAMFILES for 32 bit systems.<br />
I have tried to use the constant ${RunningX64} from &quot;x64.nsh&quot; script with LogicLib and StrCmp functions but this do not work.<br />
Do you know a script that make this ?<br />
<br />
Greetings</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st February 2010, 07:24</div></div><div class="posttext">If the macros in x64.nsh did not work, you're using them wrong. Can you show us how you use them?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Maxim30</div><div class="date">1st February 2010, 09:42</div></div><div class="posttext">Hello,<br />
here there the code:<br />
<br />
  !include &quot;LogicLib.nsh&quot;<br />
  !include &quot;WinVer.nsh&quot;<br />
  !include &quot;x64.nsh&quot;<br />
<br />
...<br />
<br />
InstallDir &quot;$R0\${Nome}&quot;<br />
<br />
...<br />
<br />
Function .onInit<br />
  ${If} ${RunningX64}<br />
    StrCpy $R0 &quot;$PROGRAMFILES64&quot;<br />
  ${Else}<br />
    StrCpy $R0 &quot;$PROGRAMFILES32&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Only the variable ${Nome} is recognized by the installer in the path box.<br />
<br />
What's wrong ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st February 2010, 12:30</div></div><div class="posttext">InstallDir is a compile-time command. The onInit function is executed at runtime. Obviously, when you're compiling the installer, $R0 does not yet contain any value.<br />
<br />
What you want to do is this:<br />
Function .onInit<br />
${If} ${RunningX64}<br />
StrCpy $INSTDIR &quot;$PROGRAMFILES64\${Nome}&quot;<br />
${Else}<br />
StrCpy $INSTDIR &quot;$PROGRAMFILES32\${Nome}&quot;<br />
${EndIf}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Maxim30</div><div class="date">1st February 2010, 13:54</div></div><div class="posttext">Originally posted by MSG <br />
InstallDir is a compile-time command. The onInit function is executed at runtime. Obviously, when you're compiling the installer, $R0 does not yet contain any value.<br />
<br />
What you want to do is this:<br />
Function .onInit<br />
${If} ${RunningX64}<br />
StrCpy $INSTDIR &quot;$PROGRAMFILES64\${Nome}&quot;<br />
${Else}<br />
StrCpy $INSTDIR &quot;$PROGRAMFILES32\${Nome}&quot;<br />
${EndIf}<br />
FunctionEnd  <br />
<br />
Now it works, BUT what's about the InstallDir attribute ? If I omit now it or if I set it to $INSTDIR argument, then the setup, at the next running, does not recognixe the previous installation folder when using also the attribute InstallDirRegKey.<br />
<br />
Can it be fixed ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st February 2010, 14:38</div></div><div class="posttext">InstallDirRegkey is an ancient NSIS command and shouldn't be used anymore if you ask me. Just do:<br />
ReadRegStr $0 (your registry path here)<br />
${If} $0 == &quot;&quot;<br />
  ${If} ${RunningX64}<br />
  etc...<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Maxim30</div><div class="date">1st February 2010, 16:44</div></div><div class="posttext">Originally posted by MSG <br />
InstallDirRegkey is an ancient NSIS command and shouldn't be used anymore if you ask me. Just do:<br />
ReadRegStr $0 (your registry path here)<br />
${If} $0 == &quot;&quot;<br />
  ${If} ${RunningX64}<br />
  etc...<br />
${EndIf}  <br />
<br />
My attribute is:<br />
InstallDirRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${Nome}&quot; &quot;NSIS:InstallDir&quot;.<br />
How it should be placed into your code above ? And what should I fill into the etc... section of your code above ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">1st February 2010, 19:16</div></div><div class="posttext">Originally posted by MSG <br />
InstallDirRegkey is an ancient NSIS command and shouldn't be used anymore if you ask me. Just do:<br />
ReadRegStr $0 (your registry path here)<br />
${If} $0 == &quot;&quot;<br />
  ${If} ${RunningX64}<br />
  etc...<br />
${EndIf}  <br />
Agree, but helps getting a prev installed path :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Maxim30</div><div class="date">1st February 2010, 19:23</div></div><div class="posttext">Originally posted by Maxim30 <br />
My attribute is:<br />
InstallDirRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${Nome}&quot; &quot;NSIS:InstallDir&quot;.<br />
How it should be placed into your code above ? And what should I fill into the etc... section of your code above ?  <br />
<br />
I found this code and it seems to work:<br />
<br />
ReadRegStr $0 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${Nome}&quot; &quot;NSIS:InstallDir&quot;<br />
  ${If} $0 != &quot;&quot;<br />
    StrCpy $INSTDIR $0<br />
  ${ElseIf} ${RunningX64}<br />
    StrCpy $INSTDIR &quot;$PROGRAMFILES64\${Nome}&quot;<br />
  ${Else}<br />
    StrCpy $INSTDIR &quot;$PROGRAMFILES32\${Nome}&quot;<br />
  ${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd February 2010, 06:38</div></div><div class="posttext">Maxim30, for information on how to use ReadRegStr, please see the manual:<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.2.12</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>