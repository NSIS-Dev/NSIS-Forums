<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" problem with system plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  problem with system plugin NSIS Discussion" />
	
	<title> problem with system plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  problem with system plugin</div>
<hr />
<div class="pda"><a href="t-358969.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=358969">problem with system plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sss123next</div><div class="date">7th April 2013, 21:38</div></div><div class="posttext">Hi all, i am trying to get &quot;window&quot; under current cursor position, i found working example which work as i need, it using WindowFromPoint api function, but does not work for disabled windows,  i read in msdn what i need another api function to get handle of disabled window ChildWindowFromPointEx, but it does not work for me, code follows:<br />
<br />
Function OnTimer<br />
${Unless} $tips &lt;&gt; 0<br />
    System::Call USER32::CreateWindowEx(i0x00000008,t&quot;tooltips_class32&quot;,i,i0x80000000,i,i,i,i,i,i,i0,i)i.s<br />
    Pop $tipS<br />
${EndUnless}<br />
System::Alloc 16<br />
Pop $0<br />
System::Call USER32::GetCursorPos(ir0)<br />
System::Call *$0(i.r1,i.r2)<br />
System::Free $0<br />
System::Call USER32::ChildWindowFromPointEx(i  $HWNDPARENT, ir1, ir2, i 0)i.R7  #should work, but not working at all<br />
;System::Call USER32::WindowFromPoint(ir1,ir2)i.R7 #working, but not for disabled windows<br />
${If} $R7 == $our_btn<br />
   StrCpy $R1 &quot;test&quot;<br />
   System::Call *(i0x28,i0x010,i$our_btn,i0x409,i,i,i,i,i0,tR1)i.R1<br />
   SendMessage $tipS 1028 0 $R1<br />
   SendMessage $tipS 1033 0 $R1<br />
   SendMessage $tipS 1025 1 0<br />
   SendMessage $tipS 1041 1 $R1<br />
   System::Free $R1<br />
   System::Call USER32::LoadCursor(i,i32649)i.s<br />
   System::Call USER32::SetCursor(is)<br />
${Else}<br />
   SendMessage $tipS 1025 0 0<br />
${EndIf}<br />
FunctionEnd<br />
<br />
<br />
what i am doing wrong ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th April 2013, 11:46</div></div><div class="posttext">You have spaces in your API call string therefore you need to surround it with quotes or remove the spaces as you have done with your other calls.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sss123next</div><div class="date">8th April 2013, 20:38</div></div><div class="posttext">oh..., thx! i will check it now.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sss123next</div><div class="date">8th April 2013, 22:28</div></div><div class="posttext">you right, but now i have another problem, function always returns 0, i have tried to pass $hwndparent and also $our_btn with window handle, but i always have 0, i understand what it is winapi question and not nsis, but maybe you can help me ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th April 2013, 11:26</div></div><div class="posttext">ChildWindowFromPointEx expects 3 arguments, the 2nd of which is a POINT struct. You should be passing it ir0 for the 2nd argument (and then freeing $0).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sss123next</div><div class="date">9th April 2013, 16:26</div></div><div class="posttext">i will try, but WindowFromPoint expect one argument, point struct as well, so i write code based on this call, i will check with struct and reply.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sss123next</div><div class="date">9th April 2013, 17:39</div></div><div class="posttext">same result, returning 0 (, but thx for your help anyway.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th April 2013, 18:22</div></div><div class="posttext">Msdn: the search is restricted to immediate child windows. Grandchildren and deeper descendants are not searched<br />
<br />
See also: http://blogs.msdn.com/b/oldnewthing/archive/2010/12/30/10110077.aspx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sss123next</div><div class="date">10th April 2013, 11:25</div></div><div class="posttext">thx for link, interesting post, but, my problem is what functions return 0, not parent, but 0, i have tried  $hwndparent, which as i understand root nsis window, i also tried handle of window on which i need to detect mouse as parent handle, but in all tries i have 0 as result, so looks like functions just noop, all except WindowFromPoint which is not work for transparent/disabled/..e.t.c., and i failing to understand what i am doing wrong, i also tried to pass struct as Afrow Uk and System plugin manual recommends, but with same result.<br />
<br />
i know handle of windows which i need to detect from point, so i can pass it as parent, and i tried that, but not work as well.<br />
<br />
maybe this api calls needs some special initializations before using ?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>