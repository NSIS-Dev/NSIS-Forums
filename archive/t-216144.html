<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem to have two Directory Page !, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem to have two Directory Page ! NSIS Discussion" />
	
	<title> Problem to have two Directory Page ! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem to have two Directory Page !</div>
<hr />
<div class="pda"><a href="t-216144.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=216144">Problem to have two Directory Page !</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">emdiouf</div><div class="date">16th May 2005, 10:11</div></div><div class="posttext">Hi everybody,<br />
I would like to have two Directory Page for my installer; one for the <br />
Application and another for the Data Base :<br />
i have found in the archive some examples and try to adapt them but it don't work.<br />
<br />
Here is part of my code :<br />
<br />
Var AppliDir<br />
Var DataDir<br />
<br />
function .onInit<br />
  strCpy $AppliDir &quot;c:\myAppli&quot;<br />
  strCpy $DataDir &quot;c:\myData&quot;<br />
functionEnd<br />
<br />
PageEx directory<br />
  #customization of the page<br />
  PageCallbacks appliPre<br />
PageExEnd <br />
<br />
PageEx directory<br />
  #customization of the page<br />
  PageCallbacks dataPre<br />
PageExEnd<br />
<br />
function appliPre<br />
   # Display Appli Directory Page if and only if Section1 #or Section2 are selected<br />
   SectionGetFlags Section1 $R1<br />
   IntOp $R1 $R1 &amp; ${SF_SELECTED}<br />
   SectionGetFlags Section2 $R2<br />
   IntOp $R2 $R2 &amp; ${SF_SELECTED}<br />
   Intop $R3 $R1 | $R2<br />
   IntCmp $R3 ${SF_SELECTED} displayPageAppli<br />
   	Abort<br />
	displayPageAppli:<br />
functionEnd<br />
<br />
function dataPre<br />
   # Display Data Directory Page if and only if Section4 #is  selected<br />
	SectionGetFlags Section4 $R0<br />
	IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
	IntCmp $R0 ${SF_SELECTED} displayPageDB<br />
   	Abort<br />
  displayPageDB:<br />
functionEnd<br />
<br />
SubSection &quot;mySubsection1&quot;<br />
<br />
  Section &quot;Section1&quot; SEC1<br />
    SetOutPath $AppliDir<br />
    #put files here<br />
  SectionEnd<br />
  <br />
  Section &quot;Section2&quot; SEC2<br />
    SetOutPath $AppliDir<br />
    #put files here<br />
  SectionEnd<br />
  <br />
  Section &quot;Section3&quot; SEC3<br />
    SetOutPath $AppliDir<br />
    #put files here<br />
  SectionEnd<br />
SubSectionEnd<br />
<br />
SubSection &quot;mySubsection2&quot;<br />
  Section &quot;Section4&quot; SEC4<br />
    SetOutPath $DataDir <br />
    #put files here<br />
  SectionEnd<br />
SubsectionEnd<br />
<br />
<br />
What I would like :<br />
1)display the Appli directory if and only if one of Section1 or Section2<br />
or the two sections are selected; in other cases not to display the Appli Directory<br />
<br />
2)display the Data directory if and only if Section4 is selected; in other cases not to display Data directory<br />
<br />
How it run for the moment:<br />
1)if i only select Section1 or Section2 it install them without displaying the page to select the Appli directory<br />
<br />
2)if i select only Data directory, it installs Data Base without displaying the page to select the data directory <br />
<br />
3)if i select Section1, Section2 and Section3, it displays Appli directory and Data directory too(it would not display the Data directory in this case).<br />
<br />
4)if i select Section1, Section2, Section3 and Section4,it displays Appli directory and Data directory ;(in this case all is right) before installing.<br />
<br />
What is wrong in my code specialy in my two functions appliPre and dataPre<br />
<br />
<br />
Thanks for your help !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th May 2005, 13:05</div></div><div class="posttext">You could try this:<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=676&amp;instances=0,64<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">emdiouf</div><div class="date">16th May 2005, 13:10</div></div><div class="posttext">I have read it in the archive and i have adapted it as i explain above but my program don't work as i like.<br />
Can somebody help me or tell what is wrong in my two function pre<br />
<br />
Thanks !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th May 2005, 13:14</div></div><div class="posttext">Ok, I see your problem:<br />
You're trying to use SectionGetFlags on the section's title: e.g. SectionGetFlags Section2 $R2<br />
You have to call it on the section's index, e.g. SectionGetFlags ${SEC2} $R2<br />
${SEC2} will contain the section's index number on compile-time.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">emdiouf</div><div class="date">16th May 2005, 13:54</div></div><div class="posttext">Sorry, i corrected it just after i posted but it don't work, here is a test case of my code but the Pb is the same<br />
<br />
In this case i use a macro so that it is more readable,<br />
I think that is about my function pre .<br />
<br />
here is the code :<br />
<br />
!include &quot;Sections.nsh&quot; <br />
<br />
Name Test <br />
OutFile test.exe <br />
<br />
Page components <br />
<br />
Var ECITIZ_DIR <br />
PageEx directory <br />
DirVar $ECITIZ_DIR <br />
PageCallbacks DirectoryAppliPre &quot;&quot; &quot;&quot; <br />
PageExEnd <br />
<br />
Var POSTGRES_DIR <br />
PageEx directory <br />
DirText &quot;Ceci installera la Base de Données PostgreSQL dans le dossier suivant; pour l'installer dans un autre dossier, \<br />
cliquez parcourir et choisissez un autre dossier. Cliquez suivant pour continuer.&quot; &quot;Installation de \<br />
la Base de Données PostgreSQL&quot; <br />
DirVar $POSTGRES_DIR <br />
PageCallbacks DirectoryBDPre &quot;&quot; &quot;&quot; <br />
PageExEnd <br />
<br />
Page instfiles <br />
<br />
!macro SiCocheAlorsVaA TMPVAR SECTION GOTO <br />
SectionGetFlags ${SECTION} ${TMPVAR} <br />
IntOp ${TMPVAR} ${TMPVAR} &amp; ${SF_SELECTED} <br />
IntCmp ${TMPVAR} 1 ${GOTO} +1 <br />
!macroend <br />
<br />
Function DirectoryAppliPre <br />
Push $1 <br />
StrCpy $ECITIZ_DIR &quot;c:\ecitiz&quot; <br />
!insertmacro SiCocheAlorsVaA $1 eCitiz afficherPageAppli <br />
!insertmacro SiCocheAlorsVaA $1 examples afficherPageAppli <br />
Pop $1 <br />
Abort <br />
<br />
afficherPageAppli: <br />
<br />
FunctionEnd <br />
<br />
Function DirectoryBDPre <br />
Push $1 <br />
StrCpy $ECITIZ_DIR &quot;c:\postgres&quot; <br />
!insertmacro SiCocheAlorsVaA $1 bdd afficherPageDB <br />
<br />
Abort <br />
<br />
afficherPageDB: <br />
Pop $1 <br />
FunctionEnd <br />
<br />
SubSection &quot;e-Citiz&quot; <br />
;sous-section d'installation du studio <br />
Section &quot;!e-Citiz Studio&quot; eCitiz <br />
SetOutPath $INSTDIR <br />
MessageBox MB_OK &quot;eCitiz&quot; <br />
SectionEnd <br />
<br />
;Sous-section d'installation du bouquet <br />
Section /o &quot;!Exemples de Téléprocédures&quot; examples <br />
SetOutPath $INSTDIR <br />
MessageBox MB_OK &quot;examples&quot; <br />
SectionEnd <br />
<br />
Section &quot;!Raccourcis&quot; short <br />
MessageBox MB_OK &quot;short&quot; <br />
SectionEnd <br />
<br />
SubSectionEnd <br />
<br />
<br />
SubSection &quot;Base de données&quot; <br />
# Sous-section d'installation de posgreSQL <br />
Section &quot;!PostgreSQL&quot; bdd <br />
MessageBox MB_OK &quot;bdd&quot; <br />
SectionEnd <br />
SubSectionEnd <br />
<br />
SubSection &quot;Adobe Acrobat Reader&quot; <br />
# Sous-section d'installation de Acrobat Reader <br />
Section /o &quot;!Adobe Acrobat Reader&quot; adobe <br />
MessageBox MB_OK &quot;adobe&quot; <br />
SectionEnd <br />
SubSectionEnd <br />
<br />
<br />
<br />
It execute all the instructions of the selected sections(in examples i just displays messages).<br />
But <br />
1°)if i don't select the tree sections eCitiz, examples and  short it don't displays the page to select the Appli directory!<br />
2°)if i only select the bdd section it execute the instruction in the bdd section but don't displays the page to select the directory<br />
3°)if i only selected the tree sections eCitiz, examples and short it display the page to select the Appli directory but it displays too the page to select the Data directory even if i don't select the bdd section.<br />
<br />
what is wrong with my program ?!<br />
<br />
You can test it, it don't work !<br />
<br />
Thanks !!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">emdiouf</div><div class="date">16th May 2005, 16:49</div></div><div class="posttext">Hi everybody,<br />
Please don't fotget my post<br />
My code seems to be logic but it don't work as expected<br />
<br />
I explain above:<br />
-what i would like to do <br />
-How it works now<br />
<br />
Thanks for your reply !</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>