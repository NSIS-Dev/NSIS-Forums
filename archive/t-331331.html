<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS Plugin documentation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS Plugin documentation NSIS Discussion" />
	
	<title> NSIS Plugin documentation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS Plugin documentation</div>
<hr />
<div class="pda"><a href="t-331331.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=331331">NSIS Plugin documentation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Wonderketchup</div><div class="date">8th June 2011, 10:52</div></div><div class="posttext">Hello,<br />
<br />
I am trying to build an NSIS plugin but there is not much documentation on how to proceed. Nevertheless, I've found Jim Parks example and started from there: http://nsis.svn.sourceforge.net/viewvc/nsis/NSIS/trunk/Contrib/ExDLL/exdll.c?revision=&amp;view=markup. <br />
<br />
With Eclipse CDT, I succeded to build my dll using as source files: MySourceFile.c, pluginapi.c and as include files: api.h, nsis_tchar.h and pluginapi.h.<br />
<br />
From EclipsesNSIS, I am able to access the exported functions of the dll. <br />
<br />
First weird thing is that when I decide to upgrade my dll with a new function, build it and copy back the dll in the NSIS plugins directory, when I restart EclipseNSIS, the autocompletion will not detect the new functions added, though, when compiling the nsi script, it will detect it.<br />
<br />
Second thing is that I am not able to push and pop the stack correctly, here follows my plugin code:<br />
<br />
#include &lt;windows.h&gt;<br />
#include &lt;string.h&gt;<br />
#include &quot;pluginapi.h&quot; // nsis plugin<br />
<br />
HINSTANCE g_hInstance;<br />
<br />
HWND g_hwndParent;<br />
<br />
void __declspec(dllexport) test(HWND hwndParent, int string_size, char *variables, stack_t **stacktop, extra_parameters *extra)<br />
{<br />
  g_hwndParent=hwndParent;<br />
  EXDLL_INIT();<br />
  {<br />
	  const TCHAR* result = &quot;Yes&quot;;<br />
	  pushstring(result);<br />
  }<br />
}<br />
<br />
void __declspec(dllexport) test2(HWND hwndParent, int string_size, char *variables, stack_t **stacktop, extra_parameters *extra)<br />
{<br />
  g_hwndParent=hwndParent;<br />
  EXDLL_INIT();<br />
  {<br />
	  const TCHAR* result = &quot;Yes&quot;;<br />
	  pushstring(result);<br />
  }<br />
}<br />
<br />
BOOL WINAPI DllMain(HANDLE hInst, ULONG ul_reason_for_call, LPVOID lpReserved) {<br />
	g_hInstance = hInst;<br />
	return TRUE;<br />
}<br />
<br />
<br />
I call it from my nsi script as follows:<br />
<br />
MySourceFile::test<br />
pop $0<br />
MessagBox MB_OK &quot;$0&quot;<br />
<br />
And I don't get back my string &quot;Yes&quot; but a value: 512.<br />
<br />
I've tried calling it as follows:<br />
 MySourceFile::test /NOUNLOAD &quot;test&quot; but I get back always the first parameter passed.<br />
<br />
Please help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wonderketchup</div><div class="date">9th June 2011, 17:39</div></div><div class="posttext">Hello guyz,<br />
<br />
finally I switched to Visual Studio Express 2010 and followed this tutorial: http://clseto.mysinablog.com/index.php?op=ViewArticle&amp;articleId=1910084 and it worked directly. I stil don't see why it didn't work with the Eclipse CDT environment.<br />
<br />
Kind regards,<br />
<br />
Tanguy Mezzano</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th June 2011, 17:55</div></div><div class="posttext">Also look at this: http://nsis.sourceforge.net/Building_plug-ins_without_Microsoft_Visual_C_Run-Time_%28MSVCRT%29_dependency<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">10th June 2011, 06:43</div></div><div class="posttext">Hello guyz,<br />
<br />
finally I switched to Visual Studio Express 2010 and followed this tutorial: http://clseto.mysinablog.com/index.php?op=ViewArticle&amp;articleId=1910084 and it worked directly. I stil don't see why it didn't work with the Eclipse CDT environment.<br />
<br />
Kind regards,<br />
<br />
Tanguy Mezzano<br />
<br />
When I was creating my very first plugin for NSIS (but I cant remember what it was :p) I was totally desperated about it.<br />
So I took working plugin and created my own from it's sources.<br />
As time had passed I found what to do.<br />
<br />
MySourceFile::test /NOUNLOAD &quot;test&quot;  <br />
<br />
NOUNLOAD is actually a parameter for dll, but it cannot be popped from stack!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">10th June 2011, 07:03</div></div><div class="posttext">The nounload plugin parameter was deprecated a couple of NSIS versions ago. The new plugin model doesn't use the parameter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th June 2011, 10:56</div></div><div class="posttext">The nounload plugin parameter was deprecated a couple of NSIS versions ago. The new plugin model doesn't use the parameter.<br />
<br />
The new plugin model is optional, and so is /NOUNLOAD</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>