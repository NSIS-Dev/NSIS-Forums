<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" BgGradient and CRC patch, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  BgGradient and CRC patch NSIS Discussion" />
	
	<title> BgGradient and CRC patch [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  BgGradient and CRC patch</div>
<hr />
<div class="pda"><a href="t-245064.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=245064">BgGradient and CRC patch</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">1st May 2006, 01:40</div></div><div class="posttext">I have just got back from my two week holiday from college, and I have been busy. I have added a patch to add a border, a title bar, and a system menu to bggradient, with defines in scons to turn it on and off. I also added to the crc check the ability to move a progress bar. You have to add the progress bar to the verify dialog using resource hacker, and give it and id of 3003 (I think). InstallSpiderUI already has the progress bar on it. Requires nsis 2.07 and above.<br />
<br />
Here is the binary stubs...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">1st May 2006, 01:48</div></div><div class="posttext">...and here is the source code. Will now work on a stub that has no compression code in it for the installers that have 'SetCompress off' in the script (for a smaller stub and to say there is 'Using no compression' instead of 'Using zlib compression' after you compile a script).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd May 2006, 11:27</div></div><div class="posttext">Thanks for the patches. Please submit patches to the patch tracker (http://sourceforge.net/tracker/?group_id=22049&amp;atid=373087) for easier tracking. What's the byte count on those features? Did you test the gradient window changes with minimizing, maximizing, window switching, etc.? 2.07 required because of SCons?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">3rd May 2006, 23:10</div></div><div class="posttext">I am not a member of sourceforge.net yet, so I can't submit patches.<br />
<br />
1. 1KB extra on stubs (half a KB on some)<br />
<br />
2. Yes I have tested the patch, and the latest InstallSpiderUI release uses this patch. I made the bggradient window a child of a dummy window so that the taskbar button for the bggradient window does not show. I also disabled the minimize and maximize buttons, as well as disabling the window, so that the user cannot interact with the bggradient window on runtime (it still minimizes and maximizes with the main installer window).<br />
<br />
3. I just relised it could actually be used with any nsis version (not just the scons built nsis) because I included a file (config_old_scons_nsis.h) with the defines for older scons nsis versions, which could be used for pre scons nsis versions as well. My mistake.<br />
<br />
Note: files for source code taken from nsis 2.15 source.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th May 2006, 14:41</div></div><div class="posttext">I am not a member of sourceforge.net yet, so I can't submit patches.Signing up is free and requires no more than 5 minutes. Did you check the exact numbers in the map file? Tried all the winkey shortcuts? Winkey+M, Winkey+D? Other applications minimizing the window? I only ask because it took me a while to get it right for the current implementation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">5th May 2006, 02:31</div></div><div class="posttext">1. Didn't know there was a map file :confused:.<br />
<br />
2. As far as I can see, winkey+D and winkey+M do work correctly. The only thing I added for the patch is a dummy window, and changed the window style to make it have a title bar and system menu (although they can't actually be used). I have commented where the extra code is in the source.<br />
<br />
Just registered at sourceforge.net.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">15th May 2006, 02:13</div></div><div class="posttext">Another update (hopefully for good). Fixed the bottom of the window not covering the taskbar. As before, binary stubs for NSIS 2.07 and above...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">15th May 2006, 02:17</div></div><div class="posttext">...and the source for (almost) any nsis version.<br />
<br />
This one will be submitted to the patch tracker in the near future (don't know how near).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">16th May 2006, 01:31</div></div><div class="posttext">Well, that day in the near future has come and gone. I have just submitted it to the patch tracker here (http://sourceforge.net/tracker/index.php?func=detail&amp;aid=1489215&amp;group_id=22049&amp;atid=373087).<br />
fixed typo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">22nd May 2006, 05:30</div></div><div class="posttext">I stated that the progress bar id for the verify dialog was 3003, when it is actually 3300. I didn't check until now :rolleyes:.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">16th August 2006, 00:37</div></div><div class="posttext">I have revived work on this little project again. This time, I am adding the patch as switches to the BGGradient command. <br />
<br />
Forgot to say that the crc progress bar will not be in this patch.<br />
<br />
I added it in the last hour or so to the source of NSIS 2.19. I will be compiling and testing over the next five days to make sure it works the way I intended. Example usage:<br />
<br />
BGGradient /TITLEBAR /DROPSHADOW 0000FF 000000 FFFFFF<br />
<br />
The /TITLEBAR option adds a border and title bar to the top of the window (along with the caption from the main window).<br />
<br />
The /DROPSHADOW option adds a black dropshadow to the text in the background.<br />
<br />
If I'm lucky, this might be added to an NSIS release, doubtful though :(.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">16th August 2006, 23:52</div></div><div class="posttext">I didn't want to create a new thread, and since it is related to showing windows, I will ask it here.<br />
<br />
When the background window is displayed, it is shown behind the main installer window. I am trying to do the same on one of my new plugins, but the window is in front of the installer (in other words, the window is shown, and any message boxes that pop up are mostly hidden by the window I have created). Is there a simple fix for this (like SetWindowPos)?<br />
<br />
I have attached an example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th August 2006, 12:36</div></div><div class="posttext">You can use SetWindowPos to set your window to show below the installer window. Call SetWindowPos on the your window's handle and pass the installer's window handle in hWndInsertAfter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">20th August 2006, 23:10</div></div><div class="posttext">Yeah, I figured that out on the weekend, but it does not work :(. I thought it would.<br />
<br />
My next step is to use the code from the BgImage plugin to create the window (because the window for that is behind the main installer window).<br />
<br />
Update on the BgGradient patch: I have put in the script parsing code for it, but found out it is not so easy to add a command to NSIS (2.15). I am having trouble writing and reading the correct value to and from the exehead. If someone could give me a crash course on adding info to the exehead and reading it from the exehead at runtime, that would be awesome.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th August 2006, 12:42</div></div><div class="posttext">Simplest way is changing the header structure (Source\exehead\fileform.h and Source\fileform.cpp). Then, you'll have your information in g_header in the exehead code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">27th August 2006, 23:16</div></div><div class="posttext">Thanks for that. I will look at it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">20th September 2006, 23:59</div></div><div class="posttext">It's probably because I have no idea whats wrong with my code. Source\fileform.cpp has the right fields in it to add to the bg part (bg_color1-2), but source\exehead\fileform.h dosen't have the same structure and I don't know how to set it. I have managed to get it so that it makes an error everytime the bggradient command is used, which means that the data is not being read/written (correctly).<br />
<br />
I will be away for the next two and a half weeks so you probably won't get me until the 9th of October.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2006, 10:45</div></div><div class="posttext">fileform.h is not automatically generated. You must add those fields on your own in the same place you've put them in fileform.cpp.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>