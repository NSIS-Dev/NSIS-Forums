<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Make uninstaller get a path from registry, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Make uninstaller get a path from registry NSIS Discussion" />
	
	<title> Make uninstaller get a path from registry [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Make uninstaller get a path from registry</div>
<hr />
<div class="pda"><a href="t-315599.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=315599">Make uninstaller get a path from registry</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">22nd December 2009, 20:47</div></div><div class="posttext">Well, I'm making a installer for an app (thanks, Captain Obvious...)<br />
<br />
But it installs file on one dir and on another dir, that I've got during installation, reading the registry and setting to a var.<br />
<br />
now, when I want to uninstall, I tried the same way: read reg, set a var and delete the file from the dir, set on the var.<br />
<br />
but uninstaller don't delete it, it just ignore the file.<br />
<br />
what I'm doing wrong?<br />
<br />
One more thing: when I read the reg during install, how can I make the installer send a message if it don't find anything? Like: I've made the installer read a install path of some app, but the app isn't installed on user's system. what I need to do to the installer send a message to user saying something like &quot;the app isn't installed and additional files will be ignored&quot;?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">22nd December 2009, 22:04</div></div><div class="posttext">Can I see a code example of what you are trying to do, and where the different dirs are. $INSTDIR in an uninstaller is wherever the uninstaller resides.<br />
<br />
As for the other.. you should read a registry entry or file from that program.<br />
<br />
ClearErrors<br />
ReadRegStr $R0 &lt;some registry key set by another program&gt;<br />
<br />
IfErrors 0 +2 <br />
&amp;nbsp;&amp;nbsp;MessageBox MB_OK|MB_ICONINFORMATION &quot;the app isn't installed and additional files will be ignored&quot;<br />
<br />
&lt;continue&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">22nd December 2009, 23:07</div></div><div class="posttext">Here is my entire script:<br />
<br />
; Script generated with the Venis Install Wizard<br />
<br />
; Define your application name<br />
!define APPNAME &quot;CD Art Display&quot;<br />
!define APPNAMEANDVERSION &quot;CD Art Display 2.0.1&quot;<br />
<br />
; Main Install settings<br />
Name &quot;${APPNAMEANDVERSION}&quot;<br />
InstallDir &quot;$PROGRAMFILES\CD Art Display&quot;<br />
InstallDirRegKey HKLM &quot;Software\${APPNAME}&quot; &quot;&quot;<br />
OutFile &quot;C:\cad201extra.exe&quot;<br />
<br />
; Use compression<br />
SetCompressor LZMA<br />
<br />
; Modern interface settings<br />
!include &quot;MUI.nsh&quot;<br />
<br />
!define MUI_ABORTWARNING<br />
!define MUI_FINISHPAGE_RUN &quot;$INSTDIR\CAD.exe&quot;<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
!insertmacro MUI_UNPAGE_WELCOME<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
<br />
; Set languages (first is default language)<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!insertmacro MUI_RESERVEFILE_LANGDLL<br />
<br />
InstType Full<br />
InstType &quot;CAD Only&quot;<br />
InstType /NOCUSTOM<br />
<br />
Section &quot;CD Art Display&quot; Section1<br />
	SectionIn 1 2 RO<br />
  SetDetailsPrint textonly<br />
  DetailPrint &quot;Installing CD Art Display...&quot;<br />
  SetDetailsPrint listonly<br />
	; Set Section properties<br />
	SetOverwrite on<br />
<br />
	; Set Section Files and Shortcuts<br />
	SetOutPath &quot;$INSTDIR\&quot;<br />
	File &quot;cad201.exe&quot;<br />
  ExecWait '&quot;$INSTDIR\cad201.exe&quot; /VERYSILENT /DIR=&quot;$INSTDIR&quot; /NOICONS'<br />
	Delete &quot;cad201.exe&quot;<br />
	<br />
SectionEnd<br />
<br />
Section &quot;Winamp Plugin&quot; Section2<br />
	MessageBox MB_OK &quot;Make sure that Winamp is CLOSED.&quot;<br />
	SectionIn 1<br />
	<br />
	ReadRegStr $0 HKCU Software\Winamp &quot;&quot;<br />
	DetailPrint &quot;Winamp is installed at: $0&quot;<br />
	<br />
	SetOutPath &quot;$0\Plugins&quot;<br />
	File &quot;gen_CADStarter.Plugin.dll&quot;	<br />
	File &quot;CADStarter.dll&quot;<br />
<br />
	<br />
SectionEnd<br />
<br />
Section -FinishSection<br />
  SectionIn 1 2<br />
	WriteRegStr HKLM &quot;Software\${APPNAME}&quot; &quot;&quot; &quot;$INSTDIR&quot;<br />
	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot; &quot;DisplayName&quot; &quot;${APPNAME}&quot;<br />
	WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninstall.exe&quot;<br />
	WriteUninstaller &quot;$INSTDIR\delete_cad.exe&quot;<br />
<br />
SectionEnd<br />
<br />
; Modern install component descriptions<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
	!insertmacro MUI_DESCRIPTION_TEXT ${Section1} &quot;CD Art Display Main Files - Required!&quot;<br />
	!insertmacro MUI_DESCRIPTION_TEXT ${Section2} &quot;Winamp plugin for CAD - useful for Winamp Users&quot;<br />
!insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
<br />
;Uninstall section<br />
Section Uninstall<br />
	<br />
	SectionIn 1 2<br />
  ExecWait '&quot;$INSTDIR\unins000.exe&quot; /VERYSILENT'<br />
	<br />
	;Remove from registry...<br />
	DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\${APPNAME}&quot;<br />
	DeleteRegKey HKLM &quot;SOFTWARE\${APPNAME}&quot;<br />
<br />
	; Delete self<br />
	Delete &quot;$INSTDIR\delete_cad.exe&quot;<br />
<br />
	; Clean up CD Art Display<br />
	Delete &quot;$INSTDIR\cad201.exe&quot;<br />
	<br />
	ReadRegStr $0 HKCU Software\Winamp &quot;&quot;<br />
	DetailPrint &quot;Winamp is installed at: $0&quot;<br />
	<br />
	Delete &quot;$0\gen_CADStarter.Plugin.dll&quot;<br />
	Delete &quot;$0\CADStarter.dll&quot;<br />
<br />
	; Remove remaining directories<br />
	RMDir &quot;$INSTDIR\&quot;<br />
<br />
SectionEnd<br />
<br />
BrandingText &quot;CD Art Display - Extra edition by ~reenan&quot;<br />
<br />
; eof<br />
<br />
As you can see, I'm trying to make a CD Art Display with Winamp Plugin Embedded. I've figured that I could bundle the installer of CAD inside a new installer, and this makes everything a lot easier.<br />
<br />
But when uninstalling... it gets the problem.<br />
<br />
About the other thing that I've asked, can you (or somebody) explain it a little more?<br />
<br />
And, to not make another topic, how can I make a script that adds EVERYTHING from a folder? I can simple use:<br />
File &quot;*.*&quot;<br />
?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">23rd December 2009, 20:09</div></div><div class="posttext">I can't make it work either, but it'd be better to grab the Winamp path from HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\winamp.exe (Path) because HKCU key would only work on the user that installed Winamp.<br />
<br />
And yes you can use wildcards.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">24th December 2009, 00:55</div></div><div class="posttext">I've tried wildcards, and appears that it didn't worked. :P<br />
<br />
And thanks for the tip of the regkey, I really need that it work on every situation.<br />
<br />
I'm trying to solve the problem this way:<br />
	ReadRegStr $0 HKCU Software\Winamp &quot;&quot;<br />
	DetailPrint &quot;Winamp is installed at: $0&quot;<br />
	<br />
	!define WINAMPDIR &quot;$0&quot;<br />
	<br />
	Delete &quot;${WINAMPDIR}\gen_CADStarter.Plugin.dll&quot;<br />
	Delete &quot;${WINAMPDIR}\CADStarter.dll&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">24th December 2009, 08:08</div></div><div class="posttext">Defines are supposed to be compile-time. The two delete commands will just end up back as 'Delete &quot;$0\...&quot;'.<br />
<br />
Only other way I can think of is to create a batch file and insert the paths into that. It'd look something like this:<br />
<br />
ReadRegStr $0 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\App Paths\winamp.exe&quot; &quot;Path&quot;<br />
DetailPrint &quot;Winamp is installed at: $0&quot;<br />
<br />
FileOpen $9 &quot;$PLUGINSDIR\delplugins.bat&quot; w<br />
FileWrite $9 &quot;del $0\Plugins\gen_CADStarter.Plugin.dll&quot;<br />
FileWrite $9 &quot;del $0\Plugins\CADStarter.dll&quot;<br />
FileWrite $9 &quot;exit&quot;<br />
FileClose $9<br />
<br />
From: http://nsis.sourceforge.net/Write_text_to_a_file<br />
<br />
I'm not familiar with executing batch files, look here: http://forums.winamp.com/showthread.php?postid=2054461#post2054461<br />
<br />
As for the File command, see if this helps any: http://nsis.sourceforge.net/Docs/Chapter4.html 4.9.1.5 File</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Reenan</div><div class="date">25th December 2009, 01:17</div></div><div class="posttext">I had that idea too, will try it later. Thanks!<br />
<br />
If I need more help, I'll come here to say :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>