<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help with GetLastInputInfo via System Plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help with GetLastInputInfo via System Plugin NSIS Discussion" />
	
	<title> Need help with GetLastInputInfo via System Plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help with GetLastInputInfo via System Plugin</div>
<hr />
<div class="pda"><a href="t-332884.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=332884">Need help with GetLastInputInfo via System Plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">parasoul</div><div class="date">26th July 2011, 23:44</div></div><div class="posttext">Hi. I'm trying to get the GETLASTINFO structure from GetLastInputInfo function from user32.dll<br />
<br />
here's my current code:<br />
<br />
System::Alloc 32<br />
Pop $1<br />
# call<br />
System::Call &quot;user32::GetLastInputInfo(p r1)&quot;<br />
# get<br />
System::Call &quot;*$1(&amp;l, i.r0)&quot;<br />
MessageBox MB_OK &quot;$0&quot;<br />
# free<br />
System::Free $1<br />
<br />
this code crashes... not sure what the problem is.<br />
<br />
I'd very much appreciate you guys taking a look @ it and offering some assistance.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">parasoul</div><div class="date">26th July 2011, 23:51</div></div><div class="posttext">I Think the problem may be that I need to set the first member of the struct in $1 to sizeof(struct) (by using &amp;l, correct?) however, I do not know how to set the members of a struct with nsis.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">26th July 2011, 23:59</div></div><div class="posttext">p type does not work in 2.46, use i</div></div><hr />


<div class="post"><div class="posttop"><div class="username">parasoul</div><div class="date">27th July 2011, 00:13</div></div><div class="posttext">thank you.<br />
<br />
Now it doesn't crash, but it just has one output for the second member of the struct (milliseconds since last input)...<br />
<br />
<br />
${While} 1 == 1<br />
System::Alloc 32<br />
Pop $1<br />
System::Call &quot;*$1(&amp;l, i.r0)&quot; ;setting data in struct..<br />
System::Call &quot;user32::GetLastInputInfo(i r1)&quot; ;call function..<br />
# get<br />
System::Call &quot;*$1(&amp;l, i.r0)&quot; ;read struct output<br />
DetailPrint &quot;$0&quot;<br />
System::Free $1<br />
${EndWhile}<br />
<br />
<br />
note: it's in an inf. while loop so I can see if the time since last input values will change of course<br />
<br />
it just constantly stays at zero regardless if my activity<br />
<br />
do you see any reason why this will happen?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">parasoul</div><div class="date">27th July 2011, 00:18</div></div><div class="posttext">hmm,<br />
<br />
when I replace line 4 in my code with this:<br />
<br />
System::Call &quot;*$1(&amp;l, i 5)&quot; ;setting data in struct..<br />
<br />
<br />
then the &quot;output&quot; will just stay at 5... so it seems like GetLastInputInfo isn't manipulating the struct at all...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th July 2011, 14:57</div></div><div class="posttext">System::Call '*(i 8,i)i.r0'<br />
System::Call 'USER32::GetLastInputInfo(ir0)'<br />
System::Call '*$0(i,i.r1)'<br />
System::Free $0<br />
DetailPrint $1<br />
...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2011, 15:07</div></div><div class="posttext">Not sure how you are supposed to use &amp;l but this works without it:System::Call `*(i 8, i 0) i.r0`<br />
System::Call `user32::GetLastInputInfo(i r0)`<br />
System::Call `*$0(i, i.r1)`<br />
System::Free $0<br />
DetailPrint $1Edit: LOL^ :D<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">parasoul</div><div class="date">28th July 2011, 00:15</div></div><div class="posttext">So awesome. Thanks guys.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>