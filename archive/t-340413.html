<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem using SetRegView, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem using SetRegView NSIS Discussion" />
	
	<title> Problem using SetRegView [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem using SetRegView</div>
<hr />
<div class="pda"><a href="t-340413.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=340413">Problem using SetRegView</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jakc</div><div class="date">11th January 2012, 05:14</div></div><div class="posttext">I am creating my first installer with NSIS, and learning a lot.<br />
It is for a desktop Java application, and is 64bit only.<br />
The installer actually exits at onInit if it detects its 32bit.<br />
<br />
I have the below code that detects if some application (that's a 32bit native app) is already on the machine.<br />
This code works fine, but I understand that using the Wow6432Node is not good practise, and that I should make use of SetRegView.<br />
<br />
Existing Code:<br />
<br />
Section &quot;Check AGS&quot; SEC01<br />
 call CheckAGS<br />
 Pop $R0<br />
 messagebox MB_OK $AGSv <br />
SectionEnd<br />
<br />
;Check to see if AGS is installed, and which version.  0 - none, 1 - 9.3, 2 - 10, (3 - 10.1)<br />
Function CheckAGS<br />
		ReadRegStr $1 HKLM &quot;SOFTWARE\Wow6432Node\ESRI\Server10.0\CoreRuntime&quot; &quot;RealVersion&quot;<br />
${If} $1 != &quot;&quot;<br />
    StrCpy $AGSv 2<br />
    return<br />
${EndIf}<br />
ReadRegStr $1 HKLM &quot;SOFTWARE\Wow6432Node\ESRI\ArcServer\Microsoft .NET Framework Edition&quot; &quot;RealVersion&quot;<br />
${If} $1 != &quot;&quot;<br />
    StrCpy $AGSv 1<br />
    return<br />
${EndIf}<br />
StrCpy $AGSv 0 ;not found<br />
Messagebox MB_ICONSTOP &quot;No AGS installation detected.&quot;<br />
FunctionEnd<br />
<br />
If I ammend this code to change:<br />
<br />
SetRegView 64<br />
ReadRegStr $1 HKLM &quot;SOFTWARE\ESRI\Server10.0\CoreRuntime&quot; &quot;RealVersion&quot;<br />
${If} $1 != &quot;&quot;<br />
    StrCpy $AGSv 2<br />
    return<br />
${EndIf}<br />
ReadRegStr $1 HKLM &quot;SOFTWARE\ESRI\ArcServer\Microsoft .NET Framework Edition&quot; &quot;RealVersion&quot;<br />
${If} $1 != &quot;&quot;<br />
    StrCpy $AGSv 1<br />
    return<br />
${EndIf}<br />
<br />
It still compiles, but always returns me a 0, indicating that its not finding the registry keys that I am expecting it to find.<br />
<br />
Can someone point out where I am going wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th January 2012, 12:30</div></div><div class="posttext">If you are looking for a key or value in Wow6432Node then SetRegView should be 32, not 64. When it is 32, Windows transparently redirects NSIS to Wow6432Node (because the installer is 32-bit). You disable this behaviour by setting SetRegView 64 (which is not what you want).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jakc</div><div class="date">12th January 2012, 04:20</div></div><div class="posttext">Perfect thanks!<br />
<br />
<br />
Function CheckAGS<br />
SetRegView 32<br />
ReadRegStr $1 HKLM &quot;SOFTWARE\ESRI\Server10.0\CoreRuntime&quot; &quot;RealVersion&quot;<br />
${If} $1 != &quot;&quot;<br />
    StrCpy $AGSv 2<br />
    return<br />
${EndIf}<br />
ReadRegStr $1 HKLM &quot;SOFTWARE\ESRI\ArcServer\Microsoft .NET Framework Edition&quot; &quot;RealVersion&quot;<br />
${If} $1 != &quot;&quot;<br />
    StrCpy $AGSv 1<br />
    return<br />
${EndIf}<br />
StrCpy $AGSv 0 ;not found<br />
Messagebox MB_ICONSTOP &quot;No AGS installation detected.&quot;<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>