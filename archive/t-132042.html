<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" XML editing,code from archives but not working, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  XML editing,code from archives but not working NSIS Discussion" />
	
	<title> XML editing,code from archives but not working [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  XML editing,code from archives but not working</div>
<hr />
<div class="pda"><a href="t-132042.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=132042">XML editing,code from archives but not working</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">merahul94538</div><div class="date">17th April 2003, 01:39</div></div><div class="posttext">Code is from Archive.What I need to do it to call this script from my main installer file to make changes in my 2 XML files. <br />
This is code  in my main installer file but it's not working,i am doing something wrong but can't figure out<br />
In WriteXML I get script,StringA,StringB value coorect but file.name and filnenew.xml comes as null.Please help.<br />
Code attached. <br />
What I need is that I should be able to send sourcefile name,destination file name,string to be replaced,new string  from my main installer file to Writexml and get the final output in destination file name. Thank in advance <br />
<br />
push &quot;StringA&quot;<br />
push &quot;StringB&quot;<br />
push &quot;file.xml&quot;<br />
push &quot;filenew.xml&quot;<br />
<br />
<br />
; Some code to adjust settings in XML file.<br />
;<br />
; By Hendri Adriaens.<br />
; HendriAdriaens@hotmail.com<br />
!define TEMP1 $R0 ;Temp variable<br />
!define TEMP2 $R1 ;Temp variable <br />
!define TEMP3 $R2 ;Temp variable<br />
!define TEMP4 $R3 ;Temp variable<br />
;outfile WriteXML.exe<br />
;name WriteXML<br />
; push sourcefile<br />
; push destfile<br />
; push search string<br />
; push new string<br />
<br />
function ParseXML<br />
  ;MessageBox MB_YESNO &quot;This will modify studio.txt and put output to temp.tmp.$\r$\nContinue?&quot; IdNo Quiting<br />
     <br />
  Exch $0 ;newString <br />
  MessageBox MB_OK $0<br />
  Exch<br />
  Exch $1 ;search string <br />
  MessageBox MB_OK $1<br />
  Exch<br />
  Exch $2 ;source file<br />
MessageBox MB_OK $2<br />
  Exch<br />
 Exch $3 ;destfile<br />
MessageBox MB_OK $3<br />
  <br />
    <br />
FileOpen $R0 &quot;$3&quot; &quot;r&quot;<br />
FileOpen $R1 &quot;$4&quot; &quot;w&quot;<br />
MessageBox MB_OK $R0<br />
MessageBox MB_OK $R1<br />
<br />
<br />
  Loop:<br />
  FileRead $R0 $R2<br />
  StrCmp $R2 &quot;&quot; ExitLoop<br />
  push $R2<br />
  push $1<br />
  Call StrStrH<br />
  Pop $R3<br />
  StrCmp $R3 $R2 NotFound<br />
  FileWrite $R1 '$R3&quot;$1&quot; value=&quot;$2&quot; /&gt;$\r$\n'<br />
  GoTo Loop<br />
  NotFound:<br />
  FileWrite $R1 $R2<br />
  Goto Loop<br />
  ExitLoop:<br />
  FileClose $R0<br />
  FileClose $R1<br />
  Quiting:<br />
  Quit<br />
functionend<br />
<br />
Function StrStrH<br />
  ;Modified StrStr function from functions.htm<br />
  Exch $1<br />
  Exch<br />
  Exch $2<br />
  Push $3<br />
  Push $4<br />
  Push $5<br />
  StrLen $3 $1<br />
  StrCpy $4 0<br />
  loop:<br />
    StrCpy $5 $2 $3 $4<br />
    StrCmp $5 $1 done<br />
    StrCmp $5 &quot;&quot; done<br />
    IntOp $4 $4 + 1<br />
    Goto loop<br />
  done:<br />
  StrCpy $1 $2 $4<br />
  Pop $5<br />
  Pop $4<br />
  Pop $3<br />
  Pop $2<br />
  Exch $1<br />
FunctionEnd<br />
<br />
section<br />
sectionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">17th April 2003, 06:05</div></div><div class="posttext">In the first place, you seem to be pushing your arguments in the wrong order.<br />
The documentation for the script says:<br />
<br />
<br />
; push sourcefile <br />
; push destfile <br />
; push search string <br />
; push new string <br />
<br />
<br />
So you should push in that order.<br />
<br />
Secondly, the ParseXML function seems to be extracting the arguments incorrectly.<br />
It should be doing:<br />
<br />
<br />
Exch $0 ;newString <br />
MessageBox MB_OK $0 <br />
Exch <br />
Exch $1 ;search string <br />
MessageBox MB_OK $1 <br />
Exch <br />
Exch 2<br />
Exch $2 ;dest file <br />
Exch <br />
Exch 2<br />
Exch 3<br />
Exch $3 ;source file <br />
<br />
<br />
Please correct me if I am wrong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">merahul94538</div><div class="date">17th April 2003, 06:54</div></div><div class="posttext">I put that documentation in and I think stack is LAST IN FIRST OUT, correct me if I am wrong. That's what I assume and I get the valye for STRINGA and STRINGB correct in the function but just not the 2 files. It could be the extraction problem,I will look into it more.Anybody else ?<br />
Thanks for your reply</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">17th April 2003, 10:18</div></div><div class="posttext">I think that you should use Pop to get the value on the stack instead of Exch. Exch exchanges the top value on the stack with the value in the variable. Pop moves the value on the stack to the variable, so that the next value on the stack becomes the top value:<br />
<br />
push &quot;StringA&quot;<br />
push &quot;StringB&quot;<br />
push &quot;file.xml&quot;<br />
push &quot;filenew.xml&quot;<br />
<br />
The stack contains:<br />
filenew.xml<br />
file.xml<br />
StringB<br />
StringA<br />
<br />
Then, using Pop:<br />
Pop $0<br />
MessageBox MB_OK $0<br />
<br />
The stack contains:<br />
file.xml<br />
StringB<br />
StringA<br />
And the message box should show: filenew.xml<br />
<br />
Then pop again, and so on.<br />
<br />
I'm not sure about the order in which the items come on the stack and leave stack. But I think that Push puts the item on top of the stack, and Pop takes the top item of the stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">17th April 2003, 12:26</div></div><div class="posttext">If Pop is used to get the values from the stack, you lose the current values in the registers- which could have bad consequences later.<br />
Another problem I noticed with ParseXML is that it is not restoring the register values when it completes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th April 2003, 12:48</div></div><div class="posttext">The stack operations in this function are wrong. Where did you take it from? I can't find it in the archive...<br />
<br />
Please attach large scripts next time.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>