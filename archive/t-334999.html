<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RequestExecutionLevel admin doesn't seem to do anything, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RequestExecutionLevel admin doesn't seem to do anything NSIS Discussion" />
	
	<title> RequestExecutionLevel admin doesn't seem to do anything [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RequestExecutionLevel admin doesn't seem to do anything</div>
<hr />
<div class="pda"><a href="t-334999.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=334999">RequestExecutionLevel admin doesn't seem to do anything</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">JonHodgson</div><div class="date">20th September 2011, 10:26</div></div><div class="posttext">Hi,<br />
<br />
I have an installer that really needs to run with admin priviledges.<br />
<br />
I can run it fine from an admin account... no surprise there.<br />
<br />
But when I run it from a user account, the best I seem to be able to manage is to get it to detect it does not have admin priviledges and exit. <br />
<br />
RequestExecutionLevel admin seems to make no difference.<br />
<br />
Neither it seems does right clicking and selecting &quot;run as administrator&quot;<br />
<br />
So how do I get it to run with admin priviledges from a user account?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">20th September 2011, 12:18</div></div><div class="posttext">&quot;RequestExecutionLevel&quot; does nothing but adding a Manifest to the EXE file.<br />
<br />
This will trigger elevation on Vista+ systems that have UAC enabled.<br />
<br />
However it does absolutely nothing on pre-Vista systems as well as on Vista+ systems with UAC turned off.<br />
<br />
That's why you still need to check for Admin rights at runtime, as suggested all the time on the forum...<br />
<br />
<br />
I would recommend to give the UAC plug-in a try:<br />
http://nsis.sourceforge.net/UAC_plug-in<br />
<br />
That is the code I currently use:<br />
http://pastie.org/private/8eaggwflkvn3shecyvjng</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JonHodgson</div><div class="date">20th September 2011, 13:34</div></div><div class="posttext">I've implemented the check at runtime, that works.<br />
<br />
But what I can't seem to do, despite having requires admin rights in the manifest, AND selecting &quot;run as admin&quot; from the explorer context menu, is to actually get it to run with admin rights from a non admin user account.<br />
<br />
I'm working on Windows 7 64 bit (though it's a 32 bit installer and app)<br />
<br />
I shall try your code</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">20th September 2011, 14:01</div></div><div class="posttext">With &quot;RequestExecutionLevel admin&quot; and running on Vista+ and UAC enabled, the following should happen:<br />
<br />
(1) User with admin-privileges runs the installer:<br />
An UAC dialog pops up and asks the user to confirm (click on YES button is sufficient, NO button aborts)<br />
<br />
(2) User without admin-privileges runs the installer:<br />
An UAC dialog pops up and asks the user to enter login credentials of an Admin account.<br />
<br />
In both cases the installer should either start with elevated (&quot;admin&quot;) rights or not start at all. Also you don't need to use &quot;run as admin&quot;. This is for legacy applications that need elevation (&quot;admin&quot; rights) but are lacking a proper UAC Manifest to enforce.<br />
<br />
Again, on Windows XP (or even older) the UAC Manifest does nothing. So on these systems the installer would start with the privileges of whoever has launched the installer and you need to check yourself, at runtime, whether we are Admin or not.<br />
<br />
BTW: The great UAC plug-in allows you to do &quot;elevation&quot; even on Windows XP (it will pop up a &quot;run as&quot; dialog, if the installer was run by a Non-Admin user) and it allows you to handle the situation when the user has clicked &quot;NO&quot; in the UAC dialog on Vista+ systems (so you can show a message like &quot;This installer needs elevation. Please try again!&quot; and then re-run the installer to give the user another chance).<br />
<br />
IMPORTANT: If you ever try the UAC plug-in, make sure you use &quot;RequestExecutionLevel user&quot; and let the plug-in handle all elevation!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th September 2011, 14:43</div></div><div class="posttext">Please do not recommend the UAC plugin for something as simple as elevation. Elevation is NOT what the UAC plugin should be used for. The only thing the UAC plugin was designed to do is allowing the finish page's Run checkbox to launch the app at userlevel, after elevation has occured for the installer.<br />
<br />
To enforce admin-only installations, use the userinfo plugin in .onInit, with a messagebox + quit if access level is too low.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JonHodgson</div><div class="date">20th September 2011, 14:47</div></div><div class="posttext">What you describe is what I expected to happen.<br />
<br />
But not what I'm getting.<br />
<br />
Windows 7 seems to be completely ignoring the requirement for admin rights when running the installer... though not when bringing up errors when it tries to do something that requires admin rights.<br />
<br />
I've checked and it is in the manifest.<br />
<br />
the UAC plugin example installer seems to work as it should, so that seems like a working solution to what I need to do, but I'm still confused as to why I'm not seeing the behaviour you describe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">20th September 2011, 14:53</div></div><div class="posttext">I disagree ;)<br />
<br />
Being able to launch application in a non-elevated way from an elevated installer already is an essential feature for me. But being able to force &quot;elevation&quot; (i.e. automatically trigger a &quot;run as&quot; dialog if installer was run by a non-admin user) on pre-Vista systems is very useful too! Last but not least with UAC plug-in I can handle the situation when elevation has failed (e.g. the user has accidentally clicked on &quot;NO&quot;). Without UAC plug-in my installer would never be started in that case, so I cannot handle anything. Bad for Auto Update and stuff...<br />
<br />
(This doesn't mean everybody needs the UAC plug-in, but everybody should be aware what it can do)<br />
<br />
@JonHodgson<br />
What UAC level is configured on your test system? Also, what actions exactly do cause errors?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th September 2011, 15:12</div></div><div class="posttext">I don't think everybody should be aware of what it can do. It's a relatively complex tool for only a small added feature (being a shiny run as dialog). You shouldn't push any and all beginners towards something that will in the best case cost them a huge amount of work to figure out, and in the worst case cause them to give up completely.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JonHodgson</div><div class="date">20th September 2011, 15:47</div></div><div class="posttext">Where is the UAC level set?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">20th September 2011, 16:05</div></div><div class="posttext">In the control panel:<br />
http://img191.imageshack.us/img191/482/uaccontrol.jpg</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JonHodgson</div><div class="date">20th September 2011, 16:26</div></div><div class="posttext">Thanks,<br />
<br />
Ok, here's what I've found.<br />
<br />
At some point I turned UAC off, probably because with all the installs and updates I was doing setting up a new system it was just a pain.<br />
<br />
Anyway....<br />
<br />
If UAC is any level of on, then things are as described by others here, I try to run the installer from a non admin user account and I get a dialog where I can put in an admin password, and it then runs properly.<br />
<br />
But...<br />
<br />
If UAC is switched off, I don't get any such dialog (not too surprising), but the installer doesn't work, because for example that user doesn't have write permission to Program Files (x86)<br />
<br />
Maybe that makes sense to Microsoft, or someone here, but it doesn't to me. I would have thought that switching UAC off would switch off the protection against users modifying the system, but all it seems to be doing is switching off the means to elevate over that protection.<br />
<br />
Now I think that a simple check of admin rights will result in an installer that will work first time for most users, so that's fine in itself, but I'd still like to understand the thinking behind how things are working.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">20th September 2011, 16:33</div></div><div class="posttext">As said before, without UAC (pre-Vista OS or Vista+ with UAC turned off) the UAC Manifest doesn't do anything.<br />
<br />
So if the installer is launched by a Non-Admin user with UAC turned off, it will probably run with that user's limited rights.<br />
<br />
Do what MSG has suggested: Use the UserInfo plug-in in .onInit and abort if the rights are not sufficient...<br />
<br />
<br />
Keep in mind:<br />
<br />
On Windows every user has a security &quot;Token&quot; containing its rights and generally applications are launched with the user's token. At least that was the situation before UAC (and still is the situation with UAC turned off). If a &quot;regular&quot; user, who has limited rights, launches an application, the application will have limited rights too. If an Admin, with maximum rights, launches the application, the application has maximum rights. Now, with UAC in action, each user has two tokens: A &quot;restricted&quot; one and an &quot;unrestricted&quot; one. By default applications are always launched with the &quot;restricted&quot; token - even if you are an Admin user! Elevation, which can be enforced by Manifest, will cause the application to be launched with the &quot;unrestricted&quot; token, but only after the user has confirmed. AFAIK &quot;Admin&quot; users just have to click &quot;YES&quot;, but a &quot;Non-Admin&quot; user will be prompted to enter the login credentials of an &quot;Admin&quot; user in that situation (so it can borrow the Admin's &quot;unrestricted&quot; token for the installer process). With UAC turned off elevation doesn't happen! And so the application is simply launched with the user's token, which has limited rights - not because of UAC, but because the user is a &quot;regular&quot; (Non-Admin) user...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th September 2011, 17:37</div></div><div class="posttext">http://pastebin.com/EvMkyLLt is as simple as you can get it</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>