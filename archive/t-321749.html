<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Required Working Space Warning, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Required Working Space Warning NSIS Discussion" />
	
	<title> Required Working Space Warning [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Required Working Space Warning</div>
<hr />
<div class="pda"><a href="t-321749.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321749">Required Working Space Warning</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">17th August 2010, 18:15</div></div><div class="posttext">I looked around quite a bit but couldn't really find what I was looking for, I am also pretty new at NSIS.<br />
<br />
In the directory page I have noticed that it will not allow you to install to a drive that does not have enough space the next button will not be enabled.  This is good.<br />
<br />
However what I am looking to do is warn the user that they might not have enough space after an install to work with the piece of software.<br />
<br />
ie. 3.4 GB install on a 4GB drive, I would like to show a popup or warning that says something along the lines of &quot;The free space on chosen location may not be enough to use the software correctly&quot;   <br />
<br />
I was thinking of something along the lines of doing this:<br />
<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE &quot;checkSpaceInstDir&quot;<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
Function checkSpaceInstDir<br />
//Calculating the free drive space here if it is less than a certain threshold ie. 2GB<br />
//Popup a message, with the option of continuing or to Cancel the install <br />
FunctionEnd<br />
<br />
<br />
Am I way out in left field or will something like this work?<br />
<br />
<br />
cheers,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">17th August 2010, 18:30</div></div><div class="posttext">This will work, but I wouldn't cancel the install. I'd just call abort so the user stays in the directory page to select a different drive.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">17th August 2010, 18:34</div></div><div class="posttext">OK sounds good, I am not sure how to compute the remaining drive space though how do I know what directory was selected from the directory page, I am assuming I could use ${DriveSpace} somehow after that????</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">17th August 2010, 21:46</div></div><div class="posttext">by default, the selected directory will be copied into the $INSTDIR variable.  So you can just get get drive letter from that (See the ${GetRoot} function from the File Functions Header), then pass that on to ${DriveSpace}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th August 2010, 05:46</div></div><div class="posttext">Keep in mind that you have to use the IntOp64 function of the system plugin, as drive spaces are almost always &gt;4GB.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">18th August 2010, 15:50</div></div><div class="posttext">Ok I have computed the drive space from the chosen $INSTDIR, but it's giving me the total drive space from the chosen $INSTDIR, where does the software size value come from in this directory page? If I can get that then I can just subtract it from the $INSTDIR number I am getting and I will have found my solution.<br />
<br />
Can I simply just use this for the continue?<br />
<br />
MessageBox MB_YESNO &quot;You only have $R1 GB Free of Disk Space do you want to continue?&quot;<br />
<br />
Noob question but how do I implement the Abort? so it simply goes back to the directory page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th August 2010, 15:58</div></div><div class="posttext">SectionGetSize. Abort goes back to a page when called in the page's leave function.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">18th August 2010, 16:32</div></div><div class="posttext">SectionGetSize of what though?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">18th August 2010, 16:50</div></div><div class="posttext">Sorry, but this was discussed a week ago already<br />
http://forums.winamp.com/showthread.php?t=321448</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">18th August 2010, 17:09</div></div><div class="posttext">Yes I read that but I think my problem is a little different.  Here is the code snippet.<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE &quot;checkSpaceInstDir&quot;<br />
!insertmacro    MUI_PAGE_DIRECTORY<br />
<br />
Function checkSpaceInstDir<br />
${GetRoot} $INSTDIR $R0<br />
${DriveSpace} $R0 &quot;/D=F /S=G&quot; $R1<br />
SectionGetSize ${INSTALLER_SPACE} $R2<br />
#$R3 = $R1-$R2 do something like this.<br />
MessageBox MB_YESNO &quot;Free disk space after Install will be $R3 do you want to continue with the Install?&quot;<br />
FunctionEnd<br />
<br />
My question is what would the &quot;INSTALLER_SPACE&quot; variable be? the Directory Page knows that size because it doesn't enable the next button until the $INSTDIR is greater than it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">18th August 2010, 17:29</div></div><div class="posttext">Getting the required space is EXACTLY what is discussed in the thread linked by jp. Your problem is not different.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th August 2010, 17:38</div></div><div class="posttext">The first parameter for SectionGetSize is the zero-based index of the section to get the size of. Rather than specify the index yourself, you can specify a constant of which the Section instruction can define itself (see the docs on Section).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">18th August 2010, 17:50</div></div><div class="posttext">I took the function from the referenced thread, My space required is coming up with 0????<br />
<br />
StrCpy $spaceNeeded 0<br />
	StrCpy $counter 0<br />
	${Do}<br />
		${If} ${SectionIsSelected} $counter<br />
		    SectionGetSize $counter $0<br />
			IntOp $spaceNeeded $spaceNeeded + $0<br />
			IntOp $counter $counter + 1<br />
		${EndIf}<br />
	${LoopUntil} ${Errors}<br />
	System::Int64Op $spaceNeeded / 1048576 ; GiB<br />
	Pop $spaceNeeded<br />
	${GetRoot} &quot;$INSTDIR&quot; $0<br />
	${DriveSpace} &quot;$0\&quot; &quot;/D=F /S=G&quot; $spaceAvailable ; G = GiB<br />
<br />
	MessageBox MB_OK &quot;Install dir: $INSTDIR$\r$\nSpace required: $spaceNeeded$\r$\nSpace available: $spaceAvailable&quot;<br />
<br />
<br />
<br />
Is there a way to simply parse what the Directory Page shows? or is there a reason I am getting 0, BTW the Directory Page shows my Space Req being 7.9GB</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th August 2010, 18:10</div></div><div class="posttext">Try putting ClearErrors at the top. Also the IntOp $counter $counter + 1 should be moved to after the ${EndIf} otherwise as soon as it hits an unselected section it will loop infinitely.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">18th August 2010, 18:25</div></div><div class="posttext">Thanks, that worked.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">18th August 2010, 18:36</div></div><div class="posttext">Also the IntOp $counter $counter + 1 should be moved to after the ${EndIf} otherwise as soon as it hits an unselected section it will loop infinitely.<br />
<br />
Whoops - that was an error in the other thread's post (mine); added an addendum there as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">NSISNUB</div><div class="date">19th August 2010, 20:04</div></div><div class="posttext">One more question, why doesn't this work?<br />
<br />
${If} $result &lt; X<br />
MessageBox MB_YESNO|MB_ICONQUESTION  &quot;The amount of free space after install will be: $result GB$\r$\n \<br />
It is less than what is recommended.$\r$\n \<br />
Do you still want to install to this location?&quot; \<br />
IDNO Abort <br />
${Endif}<br />
<br />
<br />
It doesn't compile, If yes I want to continue to the next page of the installer, and no I want to abort so it stays at the current page which should work, what is missing?<br />
<br />
thanks,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th August 2010, 20:49</div></div><div class="posttext">If you read the manual on MessageBox it needs labels to jump to, not instructions.<br />
<br />
Edit: And you can also do this:<br />
${If} ${Cmd} `MessageBox MB_YESNO|MB_ICONQUESTION 'Call Abort?' IDYES`<br />
  Abort<br />
${EndIf}<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>