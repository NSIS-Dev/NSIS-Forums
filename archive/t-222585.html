<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problems reading InstallOptions field, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problems reading InstallOptions field NSIS Discussion" />
	
	<title> Problems reading InstallOptions field [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problems reading InstallOptions field</div>
<hr />
<div class="pda"><a href="t-222585.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=222585">Problems reading InstallOptions field</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">strailey</div><div class="date">27th July 2005, 01:31</div></div><div class="posttext">On a custom MUI page, I am using a page leave function to validate the user input.  My problem is that after doing the ReadINIStr function it always returns the default field value of &quot;Text&quot; rather than the newly entered data.  I am using NSIS 2.08 and the INI file is not opened by any other application.<br />
<br />
Here are the contents of my INI file (CompName.ini)<br />
---------<br />
[Settings]<br />
FieldNum=2<br />
<br />
[Field 1]<br />
Type=Label<br />
Text=New Computer Name<br />
&lt;Position info follows and has been omitted&gt;<br />
<br />
[Field 2]<br />
Type=Text<br />
State=Text<br />
&lt;Position info follows and has been omitted&gt;<br />
---------<br />
<br />
Here is the custom page defnition:<br />
page custom ComputerName VerifyInput<br />
<br />
Here is the VerifyInput function:<br />
----------<br />
;This is the problematic validation function<br />
Function VerifyInput<br />
  Push $R0<br />
  Push $R1<br />
<br />
  ;******This is where my problem lies. Read newly entered<br />
  ; Computer Name from custom page<br />
  ReadINIStr $R1 &quot;CompName.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  ; Display debug MB with entered Computer Name<br />
  MessageBox MB_OK &quot;Name Entered = $R1&quot;<br />
  ;MessageBox always displays &quot;Name Entered = Text&quot;<br />
  <br />
  ;Now vaildate user entry, always fails since $R1=&quot;Text&quot;<br />
  ;See attachment for details on CheckName.exe<br />
  ExecWait '&quot;$INSTDIR\CheckName.exe&quot; $R1' $R0<br />
  IntCmp $R0 1 goodname badname badname<br />
  goodname:<br />
    StrCpy $RENAME 1<br />
    Goto done1<br />
  badname:<br />
    MessageBox MB_ICONEXCLATMATION|MB_OK|MB_TOPMOST &quot;Computer Name must adhere to corporate naming standards....&quot;<br />
    Abort<br />
  done1:<br />
    Pop $R1<br />
    Pop $R0<br />
FunctionEnd<br />
---------------<br />
<br />
The attachment contains additional relevant excerpts from the NSI file.<br />
<br />
Can anyone provide any insight as to why &quot;Field 2&quot; always contains &quot;Text&quot;?  This is my first custom MUI page, am I going about this the wrong way?  Just for grins, I have tried the following items:<br />
<br />
Replace the ReadINIStr statement with the following:<br />
!insertmacro MUI_INSTALLOPTIONS_READ $R1 &quot;CompName.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
<br />
Additionally, I added the NOTIFY flag to the field in the INI file (I know it is not suppose to work with TEXT fields, but I'm grasping at straws), again with no joy.<br />
<br />
Any thoughts would be greatly appreciated.  Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">27th July 2005, 01:51</div></div><div class="posttext">Is there any 'text' field as well? I haven't used a text box before but there might be a text field in the ini file. You could try reading the text field instead of the state field. Do you use HM NIS Edit to make your custom pages?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">strailey</div><div class="date">27th July 2005, 04:32</div></div><div class="posttext">Yes, I used HM NIS Edit to create the INI file.  Yes, you can set a Text field associated with the Text control, however I don't believe it really serves any purpose for the Text control. However, I did give you suggestion a try, reading from the control's Text field will return whatever it was used to initialize it.  It does not however return the value entered into the field via the form.  Thanks for the suggestions though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">27th July 2005, 05:41</div></div><div class="posttext">I think I see your problem.  Your install is reading the skeleton CompName.ini which is probably in the same folder as your main script file.<br />
<br />
Your verify function should use this:<br />
ReadIniStr $R1 '$PLUGINSDIR\CompName.ini' 'Field 2' 'State'<br />
<br />
By reading just 'CompName.ini', you are reading from the current working directory (probably $EXEDIR in this case.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">strailey</div><div class="date">27th July 2005, 05:48</div></div><div class="posttext">Comperio,<br />
<br />
Thanks, that did indeed fix the problem.  I guess I failed to realize that there is more than one version of the INI file.  Thanks again for the quick reply.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>