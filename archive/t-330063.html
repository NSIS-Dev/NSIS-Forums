<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Code to install an application in user mode(Limited privilege), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Code to install an application in user mode(Limited privilege) NSIS Discussion" />
	
	<title> Code to install an application in user mode(Limited privilege) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Code to install an application in user mode(Limited privilege)</div>
<hr />
<div class="pda"><a href="t-330063.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=330063">Code to install an application in user mode(Limited privilege)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">balamdu01</div><div class="date">27th April 2011, 05:11</div></div><div class="posttext">I am having an installer that will install the application only in the admin mode. If i try to install in user mode(Limited privilege), then it is saying that &quot;you are not having administrator privilege to install this&quot;. But i want to install the application in user mode. Can anyone please tell me how to code in NSIS to install the application in user mode.<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">27th April 2011, 06:15</div></div><div class="posttext">Use the UserInfo plugin in .onInit:<br />
<br />
  UserInfo::GetAccountType<br />
  Pop $1<br />
  ${If} $1 == &quot;Admin&quot;<br />
    StrCpy $ACCESSLEVEL &quot;Admin&quot;<br />
    SetShellVarContext all<br />
  ${Else}<br />
    StrCpy $ACCESSLEVEL &quot;NotAdmin&quot;<br />
    SetShellVarContext current<br />
  ${EndIf}<br />
<br />
And then in the rest of your script you can use that variable to determine what code should be executed.<br />
Note: For userlevel installs, the default installpath should be $LOCALAPPDATA\YourPath.<br />
Note: If you want the user to be able to choose a different direction, you'll need to check for sufficient access privileges in the selected directory. (see here: http://forums.winamp.com/showthread.php?t=317018 ).<br />
Note: If you don't want to use that, you'll probably need to skip the DIRECTORY page and force $LOCALAPPDATA as install dir.<br />
Note: By setting SetShellVarContext in the above If Else code, you can use WriteRegStr SHCTX &quot;software\etc&quot; for both admin and userlevel registry commands</div></div><hr />


<div class="post"><div class="posttop"><div class="username">balamdu01</div><div class="date">27th April 2011, 14:53</div></div><div class="posttext">My product is having third party tools like JRE , Flash player , .. etc.. which requires only admin mode to install these software's. The above code is not working while installing the third party tools.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">balamdu01</div><div class="date">27th April 2011, 14:56</div></div><div class="posttext">I am having an installer that will install the application only in the admin mode. If i try to install in user mode(Limited privilege), then it is saying that &quot;you are not having administrator privilege to install this&quot;.My application has third party tools(Supporting softwares) like JRE , Flashplayer , .. etc. But i want to install the application in user mode. Can anyone please tell me in detail how to code in NSIS to install the application in user mode .<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">27th April 2011, 15:04</div></div><div class="posttext">You can´t install these 3rd party apps in usermode. There is no way around. You need adminrights.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">balamdu01</div><div class="date">27th April 2011, 15:40</div></div><div class="posttext">Thanks for the reply.      I can install Microsoft Office in User mode(Limited privilege).It will ask Admin password.After entering the password, It will install in the user mode with admin privilege. My requirement is like this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">27th April 2011, 15:58</div></div><div class="posttext">Ah ok... i know what you want. But if you need adminrights for the 3rd party apps anyway why don´t you install your app with adminrights too? Do your app really NEED a userlevel install? Beacuse it would be much easier that way.<br />
<br />
For Win Vista/7 (with UAC on) add following line to your code:<br />
<br />
RequestExecutionLevel admin<br />
<br />
and to ensure that the user have adminrights use the code from MSG in the .onInit function and have a look to the notes he wrote.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">27th April 2011, 15:58</div></div><div class="posttext">http://nsis.sourceforge.net/Docs/Chapter4.html#4.8.1.32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">balamdu01</div><div class="date">2nd May 2011, 11:30</div></div><div class="posttext">Thank you all for your notes and references. <br />
<br />
We have decided not to install our app in User mode (Limited Privilege) and will only install in Admin mode. Here the install of our s/w and the associated 3rd party tools goes off fine. <br />
<br />
However, I am facing a new problem. Our customers SHOULD have the option of running the app in User mode (after installing in Admin mode). <br />
<br />
If the app is installed in C:\Program Files, then it doesnt work in User mode (it works alright in Admin mode). I have noticed that if the app is installed in another path say D:\  then it works alright. <br />
<br />
Question - Why does this happen ? How is it possible to overcome this problem ?<br />
<br />
Thank You</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd May 2011, 11:40</div></div><div class="posttext">In what way does it not work? Is your application trying to write to that folder?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">balamdu01</div><div class="date">2nd May 2011, 12:01</div></div><div class="posttext">Thanks for the reply.<br />
Yes. we are writing text file (.txt files) in that path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">2nd May 2011, 15:18</div></div><div class="posttext">This is (and always was) a bad idea. But you´re not the only one who does this mistake. <br />
Apps should store files they want to write into (like configfiles etc.) in %APPDATA% and NOT in %PROGRAMFILES%. That is not a new fact but in the past many programmers don´t care about. Most incompatibilities of older programs running under vista/7 are related to this design fault.<br />
<br />
Program -&gt; %PROGRAMFILES%<br />
configfiles (files that need write access in usermode) -&gt; %APPDATA%</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>