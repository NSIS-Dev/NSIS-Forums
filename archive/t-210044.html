<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Unselect RO Section?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Unselect RO Section? NSIS Discussion" />
	
	<title> Unselect RO Section? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Unselect RO Section?</div>
<hr />
<div class="pda"><a href="t-210044.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210044">Unselect RO Section?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">10th March 2005, 18:11</div></div><div class="posttext">I have an installer which hides the sections that the user installs, as he/she installs them. So when the person re-opens the installer, the sections that are already installed will have disappeared from the list of options to install. They are then found in the uninstaller.<br />
<br />
This all works as intended.<br />
<br />
However - I have a section now, that I need to be RO.<br />
<br />
Only problem is - that RO section won't hide once it's installed, like the others still do.<br />
<br />
So how can I hide an RO section after it's installed?<br />
<br />
The way I do it for the other sections, is(in .onInit):<br />
<br />
<br />
	ReadRegStr $0 HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${Sec01}<br />
		SectionSetText ${Sec01} &quot;&quot;<br />
	${endif}<br />
<br />
This works for all sections, but not for the RO section. It still shows up after it's installed, with description and everything, and I don't want that, because it could confuse the user into thinking he/she didn't install it afterall.<br />
<br />
How do I fix this?<br />
<br />
Thanks. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th March 2005, 18:26</div></div><div class="posttext">SectionSetText doesn't care if the section is RO or not. There must be an error somewhere else. Please attach a minimal example reproducing the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 18:27</div></div><div class="posttext">Hmm, using...<br />
SectionSetText ${Index} &quot;&quot;<br />
...hides Read-Only sections here.<br />
<br />
Are you using latest NSIS version?<br />
If you are then it must be something in the code not working right...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">10th March 2005, 18:35</div></div><div class="posttext">OK I'll look through it again.<br />
<br />
However - it works if I remove the &quot;SectionIn RO&quot; from the section, making it selectable again. Should I not use &quot;SectionIn RO&quot; below the Section name? Isn't that the only way?<br />
All the other selectable sections are hidden when they are installed, using the code I have now. <br />
<br />
I'm using the latest build.<br />
<br />
I tried it now - the only change I made to the script now was to remove SectionIn RO from the section, then I saved it and compiled it. Once installed, the option then doesn't appear in the installer when it's reopened. So the only difference is the SectionIn RO thing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 19:13</div></div><div class="posttext">Could you attach your script please.<br />
<br />
Edit: Or make a cut-down script which produces the same problem.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">10th March 2005, 20:02</div></div><div class="posttext">Well - I've tried to cut it down to it's bare essentials, but it's a big script, and there's a whole lot of stuff that depends on other stuff so it's hard to cut things out without getting errors.<br />
<br />
So I'll try to post the most essential parts that has to do with this problem instead.<br />
<br />
First, one of the sections(the one I'm having problems with):<br />
<br />
Section &quot;Testing testing.&quot; Sec01<br />
SectionIn RO<br />
SetDetailsPrint textonly<br />
DetailPrint &quot;Extracting And Installing Files... Please Wait.&quot;<br />
SetDetailsPrint none<br />
ReadRegStr $0 HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot;<br />
	${if} $0 == 1<br />
Goto AlreadyInstalled<br />
${endif}<br />
LOTS OF STUFF DOWN HERE, BUT NOT IMPORTANT, JUST FILES TO EXTRACT ETC.<br />
<br />
then on to .onInit:<br />
<br />
<br />
	ReadRegStr $0 HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot;<br />
	${if} $0 == 1<br />
		!insertmacro UnselectSection ${Sec01}<br />
		SectionSetText ${Sec01} &quot;&quot;<br />
	${endif}<br />
(one of those for each section)<br />
<br />
<br />
Then there's -post:<br />
<br />
<br />
Section -post<br />
ReadRegStr $0 HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot;<br />
	${if} $0 == 1<br />
Goto +4<br />
${else}<br />
SectionGetFlags ${Sec01} $0<br />
	WriteRegStr HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot; $0<br />
${endif}<br />
<br />
(one of those for each section)<br />
<br />
And I have some similar ones in the un.onInit and un.post parts of the script.<br />
<br />
<br />
And in each of the uninstall sections, there's one of these:<br />
<br />
<br />
WriteRegStr HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot; &quot;0&quot;<br />
<br />
<br />
<br />
That's all I can see that can play any part in the problem.<br />
<br />
Again - what I want is for the installed sections to disappear from the components page when the installer is reopened. This works already, for all sections, even the one I'm having problems with. The ONLY thing that mucks things up, is if I add the SectionIn RO to the section. Then, when it's installed and I reopen the installer, it's still there. If I REMOVE only the SectionIn RO line, save and compile, ALL sections are gone from the installer when reopened (as I want them to be), if all the components were installed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th March 2005, 20:10</div></div><div class="posttext">Did you make sure the registry value is set right after the first installation? Add a message box just above the SectionSetText instruction to make sure it's really executed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 20:11</div></div><div class="posttext">Couldn't find any errors there, except you could change the -post Section code to make it a little cleaner:<br />
<br />
Section -post<br />
ReadRegStr $0 HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot;<br />
 ${if} $0 != 1<br />
  SectionGetFlags ${Sec01} $0<br />
  WriteRegStr HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot; $0<br />
 ${endif}<br />
<br />
However, that shouldn't fix anything.<br />
<br />
Please attach your whole script (as file attachment).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">10th March 2005, 20:20</div></div><div class="posttext">Originally posted by kichik <br />
Did you make sure the registry value is set right after the first installation? Add a message box just above the SectionSetText instruction to make sure it's really executed.  <br />
<br />
OK - I think I've found the problem. I opened the registry, and for some strange reason, the first entry says 17, when it's supposed to say 1. So there's obviously something in the script I have overlooked. It should say either 1 or 0 (installed or not installed), so I don't know where 17 comes from...<br />
<br />
But I think I'll be able to solve it now anyway.<br />
<br />
Thanks for the tips and help, both of you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">10th March 2005, 20:41</div></div><div class="posttext">Actually I still don't get it. <br />
<br />
When the ONLY thing I do to the script is to remove the line SectionIn RO from the first section, then save and compile, and run the installer, then suddenly the registry entry says 1 for that section, which it's supposed to do.<br />
<br />
-How can the registry setting go from 17 to 1 just because I remove one unrelated line from the script??<br />
<br />
I'm sorry, but I won't put the script up here(could e-mail or PM it to someone though). If it's impossible to solve then, I'll just have to do it some other way. After all, it does work as long as I don't make a section Read Only...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th March 2005, 20:48</div></div><div class="posttext">You probably write exactly what you get from SectionGetFlags into the registry. SF_RO is 16. SF_RO | SF_SELECTED is 17.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">10th March 2005, 20:51</div></div><div class="posttext">Originally posted by kichik <br />
You probably write exactly what you get from SectionGetFlags into the registry. SF_RO is 16. SF_RO | SF_SELECTED is 17.  <br />
<br />
Ah! I didn't know that (how many people do?). Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th March 2005, 21:02</div></div><div class="posttext">John, use:<br />
 ${if} ${SectionIsSelected} ${Sec01}<br />
  WriteRegStr HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot; &quot;1&quot;<br />
 ${Else}<br />
  WriteRegStr HKCU &quot;Software\${VER_NAME}\Sections&quot; &quot;01&quot; &quot;0&quot;<br />
 ${endif}<br />
<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>