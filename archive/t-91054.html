<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Can installer update itself?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Can installer update itself? NSIS Discussion" />
	
	<title> Can installer update itself? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Can installer update itself?</div>
<hr />
<div class="pda"><a href="t-91054.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=91054">Can installer update itself?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">14th June 2002, 14:22</div></div><div class="posttext">I'm nearing the completion of an online updater, and one task that would be nice is for the installer to update itself.<br />
<br />
I have tried many different ways, such as downloading as a different name, and then renaming as the last task in the installer, but this doesnt seem to work?<br />
<br />
Is there an easy way around this?  I couldn't find anything in the forums on this topic, and don't want to have to reboot either since the updater is mostly automated.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">14th June 2002, 14:40</div></div><div class="posttext">Couldn't you launch a detached script (i.e don't wait for it to finish) then exit the installer. The launched script (or whatever) pauses for a few seconds then runs the new installer exe?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">14th June 2002, 14:52</div></div><div class="posttext">I'm not quite sure what you mean Ximon.<br />
<br />
If I have to run something separate, surely I'd need to delete that too, once I've finished?<br />
<br />
What do you mean by a detached script?<br />
<br />
Thanks for the help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">14th June 2002, 14:59</div></div><div class="posttext">Maybe I've got the wrong end of the stick but this is my idea...<br />
<br />
  - Run your installer<br />
  - Download a new file installer version as another filename<br />
  - Extract tiny assistant program <br />
  - Exec 'tiny assistant program'<br />
  - Quit<br />
<br />
The tiny program or script or whatever sleeps for a couple of seconds to give the first installer time to quit, deletes the first installer, renames the new one then launches it and that then deletes the tiny assistant program.<br />
<br />
It's not very neat I know :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th June 2002, 16:07</div></div><div class="posttext">Sleeping is not a good idea... You better send it $HWNDPARENT as a command line parameter and then it should wait until the owner process of the HWND is terminated. Same for the new installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">14th June 2002, 16:37</div></div><div class="posttext">Ah you didn't dismiss the idea outright! Cheers! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">14th June 2002, 20:00</div></div><div class="posttext">I can't thank you enough for all your help you guys!!<br />
<br />
I did what you suggested Ximon, and it works very well.<br />
<br />
I'm not sure what you were talking about Amir, regarding $HWNDPARENT.  I presume you mean something about closing the parent window (the one that spawned the helper).<br />
<br />
Did you mean to sendmessage or something, to get rid of it, or to detect its existence, if it's still there?<br />
<br />
Could you explain in more detail what you mean...perhaps a small example?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">14th June 2002, 20:06</div></div><div class="posttext">Glad I could help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th June 2002, 09:26</div></div><div class="posttext">What I meant is that you can not be sure that after the sleep period the installer would exit. You must somehow detect that it was indeed termintated so you can replace the EXE.<br />
<br />
Here is the code needed:<br />
In the updater:<br />
Exec '&quot;$TEMP\helper.exe&quot; $HWNDPARENT'<br />
<br />
In the helper:<br />
// Get the command line with GetCommandLine() and get the<br />
// HWNDPARENT from it<br />
DWORD pId;<br />
HANDLE hP;<br />
GetWindowThreadProcessId(hwParent, &amp;pId);<br />
hP = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pId);<br />
WaitForSingleObject(hP, /*time-out interval*/10000);<br />
CloseHandle(hP);</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">16th June 2002, 06:29</div></div><div class="posttext">You could of course (but this isn't much &quot;safer&quot;) just sleep n seconds then try deleting the old .exe and if it fails wait a bit longer upto a maximum by which point you decide that there is a severe problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">simham_uk</div><div class="date">16th June 2002, 20:54</div></div><div class="posttext">This is kinda what I'm doing Ximon.<br />
<br />
I don't know much about C, but my helper is another installer that downloads the new Updater anyway.<br />
<br />
I've just discovered UPX, so my installers are now much smaller...that helper is only 25k.<br />
<br />
Thanks again guys!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>