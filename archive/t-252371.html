<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Trouble getting file version, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Trouble getting file version NSIS Discussion" />
	
	<title> Trouble getting file version [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Trouble getting file version</div>
<hr />
<div class="pda"><a href="t-252371.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252371">Trouble getting file version</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">billsh</div><div class="date">1st August 2006, 00:43</div></div><div class="posttext">I'm trying to get a file version and after calling GetFileVersion, the return value is always empty.  I know the file exists (I've tried this on a number of files) and that there is version data in the file.  I've tried using my Var and R0 to capture the result, both return an empty string.  <br />
<br />
It sounds like maybe I'm not getting the library setup properly (i.e. like having to call StrStr before it will work), but I can't seem to find any hints.  Here is a code snippet.  The syntax looks pretty straighforward, so I'm not sure what I'm doing wrong.  This is just test code now so I'm aborting after some debugging message boxes.  I'm on version 2.16.<br />
<br />
Any clues?<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!include &quot;WordFunc.nsh&quot;<br />
!include &quot;TextFunc.nsh&quot;<br />
!include &quot;StrFunc.nsh&quot;<br />
${StrStr} ;Activate the StrStr Function<br />
!insertmacro GetFileVersion<br />
!insertmacro VersionCompare<br />
!insertmacro LineFind<br />
!insertmacro WordReplace<br />
<br />
...<br />
...<br />
<br />
Function .onInit<br />
    Var /GLOBAL INSTALLED_VERSION<br />
<br />
    IfFileExists &quot;$PROGRAMFILES\foo\foo.exe&quot; 0 NoErrorMsg<br />
        <br />
        ; See what version it is<br />
        ${GetFileVersion} '$PROGRAMFILES\foo\foo.exe' $INSTALLED_VERSION<br />
        MessageBox MB_OK &quot;$(INSTALLED_VERSION)&quot;<br />
        MessageBox MB_OK &quot;${VERSION}&quot;<br />
        Abort<br />
<br />
                <br />
        ; Check version status<br />
        ${VersionCompare} $INSTALLED_VERSION ${VERSION} $INSTALLED_VERSION<br />
                <br />
        IntCmp 1 $R0 downgrade upgrade CurrentVer<br />
        <br />
        CurrentVer:<br />
            MessageBox MB_OK &quot;current&quot;<br />
            Abort<br />
            <br />
        downgrade:  <br />
            MessageBox MB_OK &quot;older&quot;<br />
            Abort<br />
<br />
        upgrade:<br />
            MessageBox MB_OK &quot;Upgrade&quot;<br />
            Abort<br />
<br />
  NoErrorMsg:<br />
  <br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Swapan Das</div><div class="date">1st August 2006, 06:47</div></div><div class="posttext">Hi!<br />
<br />
You can use the following method for getting File Version:<br />
<br />
  ;declare variables before the section<br />
  Var Out2<br />
  Var Out3<br />
  Var BundledExe1 ; foo.exe (this will contain your/developer's latest version of foo.exe)<br />
<br />
  Now add the following coding inside your section:<br />
      ;supply your latest exe's(foo.exe) version no.<br />
      StrCpy $BundledExe1 &quot;5.168.0.33&quot;<br />
      ;To fetch ver.info of user's exsisting foo.exe<br />
      ${GetFileVersion} '$INSTDIR\foo.exe' $OUT2<br />
      ;OUT2 variable will contain the file version of foo.exe<br />
      ;you can use the messagebox to check it.<br />
<br />
      ;now go for version compare of your and user's copy of foo.exe:<br />
      ${VersionCompare} $BundledExe1 $OUT2 $OUT3<br />
            ;    $OUT3=0  Versions are equal<br />
            ;    $OUT3=1  Version1 is newer<br />
            ;    $OUT3=2  Version2 is newer<br />
      ${If} $OUT3 = 1<br />
	;take action as per your requirement<br />
      ${ElseIf} $OUT3 = 2<br />
	;take action as per your requirement<br />
      ${ElseIf} $OUT3 = 0<br />
	;take action as per your requirement<br />
      ${EndIf}<br />
<br />
<br />
I'm using this coding for real-life project and its working fine.<br />
<br />
With regards,<br />
Swapan Das</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2006, 11:22</div></div><div class="posttext">You don't use parenthesis on variables.<br />
E.g.<br />
Bad: $(INSTALLED_VERSION)<br />
Good: $INSTALLED_VERSION<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>