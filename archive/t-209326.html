<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Installing fonts script error with InstallTTFFont (FontReg), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Installing fonts script error with InstallTTFFont (FontReg) NSIS Discussion" />
	
	<title> Installing fonts script error with InstallTTFFont (FontReg) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Installing fonts script error with InstallTTFFont (FontReg)</div>
<hr />
<div class="pda"><a href="t-209326.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=209326">Installing fonts script error with InstallTTFFont (FontReg)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mattwilkinson</div><div class="date">2nd March 2005, 12:49</div></div><div class="posttext">I am having problems trying to use the FontReg macro. I have included the fontreg and fontname .nsh files and have put the !include at the top of my script.<br />
<br />
I am calling the code using this:<br />
SetOutPath &quot;$FONTS&quot;<br />
File &quot;${SOURCEDIR}\FREE.ttf&quot;<br />
StrCpy $FONT_DIR $FONTS<br />
!insertmacro InstallTTFFont 'FREE.TTF'  <br />
SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
<br />
<br />
When compiling the script - I get this error:<br />
StrCpy $FONT_DIR &quot;$FONTS&quot; () ()<br />
!insertmacro: InstallTTFFont<br />
Push: $R0<br />
Push: $R1<br />
Push: $R2<br />
!define: &quot;Index&quot;=&quot;Line1183.5&quot;<br />
SetOutPath: &quot;$FONT_DIR&quot;<br />
IfFileExists: &quot;$FONT_DIR\FREE.TTF&quot; ? Line1183.5 : <br />
File: &quot;FREE.TTF&quot; -&gt; no files found.<br />
Usage: File [/nonfatal] [/a] ([/r] [/x filespec [...]] filespec [...] |<br />
   /oname=outfile one_file_only)<br />
Error in macro InstallTTFFont on macroline 9<br />
<br />
<br />
<br />
I think that I am not doing something simple but can't figure out what it is . Can anyone help????</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">2nd March 2005, 14:34</div></div><div class="posttext">Well, what does it say? &quot;File: &quot;FREE.TTF&quot; -&gt; no files found&quot;<br />
You are passing the path to FREE.TTF to the macro, but you haven't specified the proper path. Unless the font file is in the same folder as your script, you need to make sure you specify the full path, e.g C:\font.ttf<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mattwilkinson</div><div class="date">3rd March 2005, 10:43</div></div><div class="posttext">That's it, thanks. <br />
<br />
The next headache is that I get an invalid file handle reported by the macro.<br />
<br />
StrCpy $FONT_DIR $FONTS<br />
!insertmacro InstallTTFFont '${SOURCEDIR}\FREE.TTF'  <br />
SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
<br />
Any clues?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd March 2005, 14:17</div></div><div class="posttext">Firstly make sure you have HWND_BROADCAST defined as a variable, e.g.<br />
Var $hwnd<br />
!define HWND_BROADCAST $hwnd<br />
and make sure you !include WinMessages.nsh.<br />
Both need to be at the top of your script.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd March 2005, 19:29</div></div><div class="posttext">HWND_BROADCAST is defined in WinMessages.nsh. You shouldn't define it as $hwnd, it's already defined as 0xFFFF.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Huette</div><div class="date">8th August 2005, 16:32</div></div><div class="posttext">I've got a similar problem and can't figure out what's wrong. The Error is:<br />
<br />
Section: &quot;Systemfiles&quot; -&gt;(SystemFiles)<br />
StrCpy $FONT_DIR &quot;$WINDIR\Fonts&quot; () ()<br />
SetOutPath: &quot;$FONT_DIR&quot;<br />
File: &quot;webdings.ttf&quot; 118752 bytes<br />
File: &quot;ariblk.ttf&quot; 117028 bytes<br />
!insertmacro: InstallTTFFont<br />
Push: $0<br />
Push: $R0<br />
Push: $R1<br />
Push: $R2<br />
!define: &quot;Index&quot;=&quot;Line221.6&quot;<br />
!insertmacro: GetFileNameCall<br />
Push: webdings.TTF<br />
Call &quot;GetFileName&quot;<br />
Pop: $0<br />
!insertmacro: end of GetFileNameCall<br />
!define: &quot;FontFileName&quot;=&quot;$0&quot;<br />
SetOutPath: &quot;$FONT_DIR&quot;<br />
IfFileExists: &quot;$FONT_DIR\$0&quot; ? Line221.6 : <br />
File: &quot;webdings.TTF&quot; -&gt; no files found.<br />
Usage: File [/nonfatal] [/a] ([/r] [/x filespec [...]] filespec [...] |<br />
   /oname=outfile one_file_only)<br />
Error in macro InstallTTFFont on macroline 14<br />
Error in script &quot;D:\Updates\Ready4Risk\Update Ready4Risk.nsi&quot; on line 221 -- aborting creation process<br />
<br />
<br />
This is my section:<br />
<br />
Section &quot;Systemfiles&quot; SystemFiles<br />
  StrCpy $FONT_DIR &quot;$WINDIR\Fonts&quot;<br />
        SetOutPath &quot;$FONT_DIR&quot;<br />
  File &quot;D:\Quellen\Fonts\webdings.ttf&quot;<br />
  File &quot;D:\Quellen\Fonts\ariblk.ttf&quot;<br />
  !insertmacro InstallTTFFont 'webdings.TTF'<br />
  !insertmacro InstallTTFFont 'ariblk.ttf'<br />
  SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
SectionEnd<br />
<br />
File &quot;D:\Quellen\Fonts\webdings.ttf&quot; -&gt; is definetly the correct path to the font</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th August 2005, 17:37</div></div><div class="posttext">The InstallTTFFont macro already contains code to compress your font file,.so you don't need any File commands first.<br />
Make sure webdings.TTF and ariblk.ttf is in the same folder as your installer script.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Huette</div><div class="date">9th August 2005, 07:27</div></div><div class="posttext">Thanks! Works fine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dark^Listner</div><div class="date">21st May 2008, 00:55</div></div><div class="posttext">Hello, i have a problem looks very similar to threat intro<br />
<br />
When i compile my script this is my abortmessage:<br />
<br />
File: &quot;gplatten.ace&quot; -&gt; no files found.<br />
Usage: File [/nonfatal] [/a] ([/r] [/x filespec [...]] filespec [...] |<br />
   /oname=outfile one_file_only)<br />
Error in script &quot;P:\installscript.nsi&quot; on line 6742 -- aborting creation process<br />
<br />
<br />
I trieed to replace this file with a new version, maybe why i get this message, but hey how can i replace some files which are in my script whithout writing a new one<br />
<br />
Maybe anyone of us can help me.<br />
Thanks <br />
DL</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">21st May 2008, 08:58</div></div><div class="posttext">Try to use your editor's Search&amp;Replace feature.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bazald</div><div class="date">18th July 2008, 02:00</div></div><div class="posttext">Originally posted by mattwilkinson The next headache is that I get an invalid file handle reported by the macro.<br />
<br />
StrCpy $FONT_DIR $FONTS<br />
!insertmacro InstallTTFFont '${SOURCEDIR}\FREE.TTF'  <br />
SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
<br />
I'm having the same problem as the above poster, with &quot;invalid file handle 32&quot; reported on the Windows XP system on which I'm trying to run the installer.  On the other hand, my Vista (x64) system seems to run the installer fine.<br />
<br />
It didn't seem like he had any real resolution to this issue.  If the solution is known, sorry for the thread resurection.  In any case, thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">robertinventor</div><div class="date">12th March 2010, 00:16</div></div><div class="posttext">I got an  &quot;invalid file handle 3&quot; (3 for some reason instead of 32) but probably same problem.<br />
<br />
Here is my code that fixed it:<br />
<br />
FIXED VERSION<br />
<br />
!include FontReg.nsh<br />
!include FontName.nsh<br />
 !include WinMessages.nsh.<br />
Section &quot;Install Bach 4.1 Musicological Font&quot;<br />
SectionIn 1 2<br />
<br />
  StrCpy $FONT_DIR $FONTS<br />
  !insertmacro InstallTTFFont 'BACH41.TTF'<br />
  SendMessage ${HWND_BROADCAST} ${WM_FONTCHANGE} 0 0 /TIMEOUT=5000<br />
SectionEnd<br />
<br />
where I placed BACH41.TTF into the same folder as the script<br />
<br />
Before, it was something like this:<br />
<br />
VERSION WITH ERROR MESSAGE ON WINDOWS 7<br />
<br />
  !insertmacro InstallTTFFont '${SourceFolder}\\BACH41.TTF'<br />
<br />
which lead to the error message - so fixed by putting the ttf file in the same folder as the .nsi script.<br />
<br />
Got the file error message on Windows 7.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">robertinventor</div><div class="date">12th March 2010, 00:18</div></div><div class="posttext">btw formatted the script as php just to get the colour coding.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>