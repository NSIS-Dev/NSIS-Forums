<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with sections group hierarchy, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with sections group hierarchy NSIS Discussion" />
	
	<title> Problem with sections group hierarchy [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with sections group hierarchy</div>
<hr />
<div class="pda"><a href="t-302563.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302563">Problem with sections group hierarchy</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bohajo</div><div class="date">29th January 2009, 19:09</div></div><div class="posttext">Hello to all,<br />
I actually develop a Installer with NSIS and have a problem....  see subject.<br />
<br />
Sample Code:<br />
SectionGroup 'GRP_1' GRP_1<br />
  Section 'SEC_1_1' SEC_1_1<br />
  SectionEnd<br />
SectionGroupEnd<br />
<br />
SectionGroup 'GRP_2' GRP_2<br />
  Section 'SEC_2_1' SEC_2_1<br />
  SectionEnd<br />
SectionGroupEnd<br />
<br />
When the Installer starts it looks OK in this form:<br />
[ ] GRP_1<br />
....[ ] SEC_1_1<br />
[ ] GRP_2<br />
....[ ] SEC_2_1<br />
<br />
When I read the sections text from a INI-File in .onInit and use the function SectionSetText, then the hierachy is not OK, it looks like:<br />
[ ] GRP_1<br />
....[ ] SEC_1_1<br />
....[ ] GRP_2<br />
........[ ] SEC_2_1<br />
<br />
The grouping of the checkboxes is OK what means if I click on GRP_1 only SEC_1_1 is changed. With GRP_2 the same, SEC_2_1 is changed.<br />
<br />
The INI-File content:<br />
; section titles<br />
[setup]<br />
GRP_1=Group1<br />
SEC_1_1=Sec_1_1<br />
GRP_2=Group2<br />
SEC_2_1=Sec_2_1<br />
 <br />
Can someone please give me a hint what I made wrong?<br />
Thanks in advance<br />
Joachim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">30th January 2009, 02:04</div></div><div class="posttext">can't think of anything... can you post a more complete example?<br />
<br />
This is mine.. which works;<br />
<br />
!include 'MUI.nsh'<br />
!include 'LogicLib.nsh'<br />
!include 'nsDialogs.nsh'<br />
<br />
outfile 'customtest.exe'<br />
<br />
Page Components<br />
<br />
SectionGroup 'GRP_1' GRP_1<br />
	Section 'SEC_1_1' SEC_1_1<br />
	SectionEnd<br />
SectionGroupEnd<br />
<br />
SectionGroup 'GRP_2' GRP_2<br />
	Section 'SEC_2_1' SEC_2_1<br />
	SectionEnd<br />
SectionGroupEnd<br />
<br />
Function .onInit<br />
	ReadiniStr $0 &quot;c:\temp\sectiontest.ini&quot; &quot;setup&quot; &quot;GRP_1&quot;<br />
	SectionSetText ${GRP_1} &quot;$0&quot;<br />
	ReadiniStr $0 &quot;c:\temp\sectiontest.ini&quot; &quot;setup&quot; &quot;SEC_1_1&quot;<br />
	SectionSetText ${SEC_1_1} &quot;$0&quot;<br />
	ReadiniStr $0 &quot;c:\temp\sectiontest.ini&quot; &quot;setup&quot; &quot;GRP_2&quot;<br />
	SectionSetText ${GRP_2} &quot;$0&quot;<br />
	ReadiniStr $0 &quot;c:\temp\sectiontest.ini&quot; &quot;setup&quot; &quot;SEC_2_1&quot;<br />
	SectionSetText ${SEC_2_1} &quot;$0&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bohajo</div><div class="date">1st February 2009, 17:25</div></div><div class="posttext">Thank you for investigating. Yes, your examle is working.<br />
I check more on my scipt and found a workaround but the error is not clear to me. I use a loop to iterate over all sections with the section index number. And the section 3 SectionGetText found '-'. But why? I insert the &quot;IfErrors&quot; instruction (see code) and now it works. But it is not clear to me why the section 3 has text like '-'.<br />
Below the sections (with a lot of code for tests). I'm too new to NSIS ;-)<br />
<br />
Thank you very much for your help<br />
Joachim<br />
<br />
My sections:<br />
<br />
InstType &quot;Default&quot; <br />
InstType &quot;Default1&quot; <br />
<br />
!define SECTIONCOUNT 7   ; total - 1<br />
<br />
Section &quot;&quot;<br />
  StrCpy $R0 &quot;Hallo&quot;<br />
  DetailPrint &quot;---   $R0 Install Logfile   ---&quot;<br />
  Call GetWindowsVersion<br />
  Pop $R0<br />
  StrCpy $0 &quot;Windows Version found: $R0&quot;<br />
  DetailPrint $0<br />
  ; DetailPrint $PLUGINSDIR<br />
SectionEnd<br />
<br />
<br />
#---  Group &quot;default&quot; installation<br />
SectionGroup 'GRP_1' GRP_1<br />
Section 'SEC_1_1' SEC_1_1<br />
  SectionIn 1<br />
  ;File /r D:\_a\*.*<br />
  StrCpy $0 &quot;putty.exe&quot;<br />
  inetc::get /BANNER &quot;Download in progress... ('$0')&quot; \<br />
              &quot;ftp://blabla@ftp.bla.net/$0&quot; &quot;$INSTDIR\$0&quot;<br />
  Pop $0<br />
  DetailPrint $0<br />
  strCmp $0 &quot;OK&quot; dlok<br />
  MessageBox MB_OK|MB_ICONEXCLAMATION &quot;ftp download Error, click OK to abort installation&quot; /SD IDOK<br />
  Abort<br />
dlok:<br />
  Call ReadComponentsText<br />
  DetailPrint &quot;Sectionindex of ${GRP_1}&quot;<br />
  DetailPrint &quot;Sectionindex of ${SEC_1_1}&quot;<br />
SectionEnd<br />
SectionGroupEnd<br />
<br />
#--- Group custom installation<br />
SectionGroup 'GRP_2' GRP_2<br />
Section 'SEC_2_1' SEC_2_1<br />
  SectionIn 2<br />
  SectionGetText SEC_2_1 $R0<br />
  DetailPrint $R0 <br />
  DetailPrint &quot;Sectionindex of ${GRP_2}&quot;<br />
  DetailPrint &quot;Sectionindex of ${SEC_2_1}&quot;<br />
  ;;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section 'SEC_2_2' SEC_2_2<br />
  SectionIn 2<br />
  SectionGetText SEC_2_2 $R0<br />
  DetailPrint $R0 <br />
  ;;;;;;;;;;;;;;<br />
SectionEnd<br />
<br />
Section  'SEC_2_3' SEC_2_3<br />
  SectionIn 2<br />
  SectionGetText SEC_2_3 $R0<br />
  DetailPrint $R0 <br />
  ;ExecShell &quot;open&quot; &quot;http://nsis.sf.net/&quot;<br />
SectionEnd<br />
SectionGroupEnd<br />
<br />
Section &quot;&quot;<br />
  ;Create a Logfile from the installation<br />
  StrCpy $0 $INSTDIR\install.log<br />
  Push $0<br />
  Call DumpLog<br />
SectionEnd<br />
<br />
; FOLLOWING FUNCTION I CALLED IN .oninit<br />
; It works only with the IfErrors instruction<br />
<br />
Function ReadComponentsText<br />
; start with section 1 as the section 0 is a &quot;startup section&quot; and is not visible<br />
  ${For} $R1 1 ${SECTIONCOUNT}<br />
    SectionGetText $R1 $R2<br />
    DetailPrint &quot;$R1, $R2&quot;<br />
    ReadINIStr $R0 &quot;$PLUGINSDIR\sections.ini&quot; &quot;setup&quot; &quot;$R2&quot;<br />
    IfErrors xNext<br />
    DetailPrint &quot;$R1, $R0&quot;<br />
    SectionSetText $R1 $R0<br />
xNext:    <br />
  ${Next}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">2nd February 2009, 06:06</div></div><div class="posttext">A section with an empty string &quot;&quot; is treated as &quot;-&quot; by NSIS internally<br />
<br />
If section_name is empty, omitted, or begins with a -, then it is a hidden section and the user will not have the option of disabling it.<br />
<br />
Even if it returned an empty string as the text, you'd still get an error because you can't read an empty set from an INI file; so the IfErrors is proper to have there either way :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bohajo</div><div class="date">2nd February 2009, 06:53</div></div><div class="posttext">Yes, that I know. But if you take a look to the sequence of the sections then you see, there is only a empty section at the beginning and one at the end.<br />
That is the reason why the function to fill the section names starts with 1 and not with 0. OK one bug is there, the loop runs until the last empty section but it is not section 3.<br />
<br />
Why he found such section with index 3? This is, what confuse me.<br />
<br />
Joachim</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">2nd February 2009, 07:14</div></div><div class="posttext">ahhh okay...<br />
<br />
That.. I do not know :)  Seems to be one at the end of each sectiongroup, actually.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bohajo</div><div class="date">2nd February 2009, 07:29</div></div><div class="posttext">Hmmm.... may be. As I'm curious about that, I will investigate in the next time. Even I found alredy a solution....<br />
<br />
Joachim</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>