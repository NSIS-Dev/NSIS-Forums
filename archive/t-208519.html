<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Service : DisplayName / ServiceName, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Service : DisplayName / ServiceName NSIS Discussion" />
	
	<title> Service : DisplayName / ServiceName [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Service : DisplayName / ServiceName</div>
<hr />
<div class="pda"><a href="t-208519.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=208519">Service : DisplayName / ServiceName</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">geoffrey_4js</div><div class="date">22nd February 2005, 16:43</div></div><div class="posttext">Hi,<br />
<br />
I would like to create a service with a displayname different than the servicename, and a particular description.<br />
<br />
In my company, the guy who was doing installation quit and I've to take his script and modify them.<br />
<br />
I'm using this to create the service<br />
<br />
!insertmacro SERVICE &quot;create&quot; &quot;$R2&quot; \<br />
&quot;path=$R3;type=$R4;interact=$R5;display=$R6;machine=$R7;user=$R8\$R9;password=$0;desc=$1;&quot;<br />
<br />
But description, display name and interact doesn't work. Type doesn't work either.<br />
<br />
To modify the type, i've to do :<br />
<br />
WriteRegDWORD HKLM \<br />
&quot;SYSTEM\CurrentControlSet\Services\${PRODUCT_SHORT_NAME}-${PRODUCT_VERSION}-gas-$R6&quot; \<br />
&quot;Start&quot; 0x00000002<br />
<br />
To modify description, i'm doing this :<br />
<br />
WriteRegStr HKLM \<br />
&quot;SYSTEM\CurrentControlSet\Services\${PRODUCT_SHORT_NAME}-${PRODUCT_VERSION}-gas-$R6&quot; \<br />
&quot;Description&quot; &quot;Manages Genero applications on the server and their connectivity \<br />
with remote ActiveX and WebServices&quot;<br />
<br />
To start the create service :<br />
<br />
!insertmacro SERVICE &quot;start&quot; \<br />
&quot;${PRODUCT_SHORT_NAME}-${PRODUCT_VERSION}-gas-$R6&quot; &quot;&quot;<br />
<br />
All of theses &quot;tricks&quot; work for me (even I'm sure there are far better way to do that).<br />
<br />
Now I want to modify the display name :<br />
<br />
WriteRegStr HKLM \<br />
&quot;SYSTEM\CurrentControlSet\Services\${PRODUCT_SHORT_NAME}-${PRODUCT_VERSION}-gas-$R6&quot;\<br />
&quot;DisplayName&quot; &quot;Genero Application Server (GEP)&quot;<br />
<br />
The registry's datas are up-to-date, but in the Services administration tools, it's the servicename that is displayed  AND in the property window of the service, the display name is good.<br />
<br />
I've tested on w2k and wxp for the same result<br />
<br />
So i'm quited confused on how can i achieve to create the desired service.<br />
<br />
I've read about SC.exe but can't find it on my w2k computer.<br />
<br />
I've also see this in archive  Service Control Manager plugin (http://nsis.sourceforge.net/archive/viewpage.php?pageid=385) but don't know how to use it.<br />
<br />
Can someone help me ? Thx !!<br />
<br />
Geoffrey</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd February 2005, 18:27</div></div><div class="posttext">Are you sure what you're trying to do is possible? If it does display the name you want in the property page, but doesn't display it in the service list, it's possible that's just how it works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">geoffrey_4js</div><div class="date">23rd February 2005, 08:46</div></div><div class="posttext">Yes, it's possible to have a displayname different form the service name, but the problem comes from Windows in fact.<br />
<br />
If I restart the computer, the service display name is correctly updated in the services windows.<br />
<br />
What is weird is that the property windows of the service doesn't need a restart to be correctly displayed whereas the services windows need a restart to take in account the datas from the registry !<br />
<br />
I should find a way to specify displayname and servicename at the service creation, and not modify it by editing the registry keys later, any idea ?<br />
<br />
Geo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th February 2005, 15:15</div></div><div class="posttext">If restarting the computer updates the name, Windows probably doesn't read the name from the registry after you write it. I'm sure there is an API function for quite a simple usage. Search MSDN for methods to update the name of a service. If you can find something but can't get it to work with the System plug-in, post the details and someone will surely be able to help you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fluidz91</div><div class="date">7th June 2006, 09:37</div></div><div class="posttext">Hello,<br />
<br />
I have the same need as geoffrey_4js and i think i use the same library to create a NT service (servicelib.nsg from dselkirk).<br />
What i have seen in this library is that the same value is used to create the service name and the service displayname, instead of hard coding the value i wanted to add a variable but didn't manage (i discover NSIS for a week and not a real developper).<br />
I'll try to contact dselkirk if he can make a change to his code, but if anyone has a clue !<br />
Thanks in advance...<br />
<br />
The library used :<br />
http://nsis.sourceforge.net/NSIS_Service_Lib<br />
<br />
The code to create the service in the library :<br />
<br />
System::Call 'advapi32::CreateServiceA(i r4, t r2, t r2, i ${SERVICE_ALL_ACCESS}, \<br />
             i R4, i R5, i 0, t R6, n, n, R1, R2, R3) i.r6'<br />
<br />
Detail of the API function :<br />
CreateServiceA( DWORD hSCManager, LPCSTR lpServiceName,<br />
376                   LPCSTR lpDisplayName, DWORD dwDesiredAccess, <br />
377                   DWORD dwServiceType, DWORD dwStartType, <br />
378                   DWORD dwErrorControl, LPCSTR lpBinaryPathName,<br />
379                   LPCSTR lpLoadOrderGroup, LPDWORD lpdwTagId, <br />
380                   LPCSTR lpDependencies, LPCSTR lpServiceStartName, <br />
381                   LPCSTR lpPassword )<br />
<br />
I guessed variable r2 is used to create service name AND displayname...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">7th June 2006, 11:02</div></div><div class="posttext">Reading this (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/createservice.asp) MSDN page it seems to me that the second parameter controls the service name while the third parameter controls the display name (to be used by user interface programs to identify the service). instead of hard coding the value i wanted to add a variable but didn't manage<br />
Can you provide the code that you used?<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fluidz91</div><div class="date">7th June 2006, 16:45</div></div><div class="posttext">I agree with you that the 2nd parameter stands for 'service name' and 3rd for the 'displayname'.<br />
The fact is that the library i use takes the same variable for both of them.<br />
<br />
Part of my nsi script:<br />
<br />
Section -post SEC0001<br />
...<br />
!insertmacro SERVICE &quot;create&quot; &quot;MyServiceName&quot; &quot;path=$INSTDIR\SubDir\MyService.exe;autostart=1;&quot;<br />
...<br />
SectionEnd<br />
<br />
<br />
what the macro does (full lib at http://nsis.sourceforge.net/NSIS_Service_Lib):<br />
<br />
Parsing the 3 parameters given &quot;action&quot; &quot;name&quot; &quot;parameters&quot;<br />
<br />
Then<br />
<br />
System::Call 'advapi32::CreateServiceA(i r4, t r2, t r2, i ${SERVICE_ALL_ACCESS}, \<br />
                                             i R4, i R5, i 0, t R6, n, n, R1, R2, R3) i.r6'<br />
<br />
i'd like to add another parameter/variable in &quot;parameters&quot; in order to define a different variable for the parameter &quot;displayname&quot; instead of using the same param or hard coding it in the lib like :<br />
<br />
System::Call 'advapi32::CreateServiceA(i r4, t r2, t &quot;MyDisplayNameString&quot;, i ${SERVICE_ALL_ACCESS}, \<br />
                                             i R4, i R5, i 0, t R6, n, n, R1, R2, R3) i.r6'<br />
<br />
What i would like :<br />
<br />
Section -post SEC0001<br />
...<br />
!insertmacro SERVICE &quot;create&quot; &quot;MyServiceName&quot; &quot;path=$INSTDIR\SubDir\MyService.exe;autostart=1;display=My Service Display Name;&quot;<br />
...<br />
SectionEnd<br />
<br />
System::Call 'advapi32::CreateServiceA(i r4, t r2, t rX, i ${SERVICE_ALL_ACCESS}, \<br />
                                             i R4, i R5, i 0, t R6, n, n, R1, R2, R3) i.r6'<br />
<br />
<br />
I hope it is clear :igor: , however you have the link to the full code of the lib ! ;)<br />
<br />
(Wow!! longer post than expected, nobody bothered ?...)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">7th June 2006, 18:44</div></div><div class="posttext">Since you only need to use the Display name upon the creation of the service there is no reason to alter the header that you are using, just get a handle to the service manager, create your service, and use the servicelib header for anything else (including uninstalling the service).<br />
Something like this:<br />
...<br />
!define SC_MANAGER_ALL_ACCESS		0x3F<br />
!define SERVICE_ALL_ACCESS		0xF01FF<br />
<br />
; Service Types (SRVType)<br />
!define SERVICE_FILE_SYSTEM_DRIVER	0x00000002<br />
!define SERVICE_KERNEL_DRIVER		0x00000001<br />
!define SERVICE_WIN32_OWN_PROCESS	0x00000010<br />
!define SERVICE_WIN32_SHARE_PROCESS	0x00000020<br />
!define SERVICE_INTERACTIVE_PROCESS	0x00000100<br />
<br />
; Service start options (SRVStartOptions)<br />
!define SERVICE_AUTO_START		0x00000002<br />
!define SERVICE_BOOT_START		0x00000000<br />
!define SERVICE_DEMAND_START		0x00000003<br />
!define SERVICE_DISABLED		0x00000004<br />
!define SERVICE_SYSTEM_START		0x00000001<br />
<br />
; Service Error control (SRVErrorControl)<br />
!define SERVICE_ERROR_CRITICAL		0x00000003<br />
!define SERVICE_ERROR_IGNORE		0x00000000<br />
!define SERVICE_ERROR_NORMAL		0x00000001<br />
!define SERVICE_ERROR_SEVERE		0x00000002<br />
<br />
!macro CreateServiceEx SRVName DisplayName SRVType SRVStartOptions SRVErrorControl SRVExecutable SRVUser SRVPasswd<br />
  System::Call 'advapi32::OpenSCManagerA(,,i ${SC_MANAGER_ALL_ACCESS})i.R0'<br />
  System::Call 'advapi32::CreateServiceA(i R0,t &quot;${SRVName}&quot;,t &quot;${DisplayName}&quot;,i ${SERVICE_ALL_ACCESS},i ${SRVType}, \<br />
i ${SRVStartOptions},i ${SRVErrorControl}, t &quot;${SRVExecutable}&quot;,,,,t &quot;${SRVUser}&quot;,t &quot;${SRVPasswd}&quot;)i.r1'<br />
  System::Call 'advapi32::CloseServiceHandle(i R0) n'<br />
!macroend<br />
<br />
...<br />
And to use it, call it from within your code:!insertmacro CreateServiceEx &quot;ServiceName&quot; &quot;My Fancy Service Name&quot; ${SERVICE_FILE_SYSTEM_DRIVER} ${SERVICE_BOOT_START} ${SERVICE_ERROR_IGNORE} &quot;$SYSDIR\SomeFile.sys&quot; &quot;&quot; &quot;&quot;<br />
The last two parameters control the username and password that will be used to run the service. If you leave them both empty then the LocalSystem account is used. Check this (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/createservice.asp) MSDN pages for more info ...<br />
<br />
I have not tested the above but it should work. Use the servicelib header to uninstall/query/control the service and the above macro to create it<br />
<br />
:)<br />
<br />
CF<br />
<br />
[Edit] @%@#$ forgot all the definitions!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fluidz91</div><div class="date">7th June 2006, 21:59</div></div><div class="posttext">Thanks for the job and time passed to help.<br />
I may try this but maybe i m stupid but i don't know why rewrite function createservice when the lib is ready to do that and you just have to change/add a parameter to define this displayname value.<br />
<br />
One more question : what are those parameters r4, r2 (different from $RX in lib ?) and what are those letters in front of them (i, t ?)...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">7th June 2006, 22:44</div></div><div class="posttext">Well I didn't rewrite the entire thing, I just created a small macro that achieves what you were after. Saves me the trouble of troubleshooting the rest of the code too! You will still need to use the servicelib for the rest of the functions that it provides. :)<br />
One more question : what are those parameters r4, r2 (different from $RX in lib ?) and what are those letters in front of them (i, t ?)...You may want to read the documentation of the System plugin (http://nsis.sourceforge.net/System_plug-in) to get an idea about those ... ;) <br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fluidz91</div><div class="date">8th June 2006, 08:42</div></div><div class="posttext">Ok CF, thank you for all the precious information<br />
<br />
Edit : i read the System plug-in readme and it is beyond my reach :( I hope i'll never have to use it by myself :hang:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vitoco</div><div class="date">23rd November 2006, 20:52</div></div><div class="posttext">I've released my modified version of servicelib.nsh (http://www.vitoco.cl/nsis/servicelib.html).<br />
<br />
I removed some bugs and added this feature as I also want to display an arbitrary name for a service.<br />
<br />
Hope this helps...<br />
<br />
++Vitoco</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd November 2006, 21:00</div></div><div class="posttext">You should update the Wiki page with the new version. If not backward compatible, at least as another version. But as far as I can see, it can be easily made backwards compatible by accepting both &quot;machine&quot; and &quot;depend&quot;.<br />
<br />
This will assure future generations will find it easily and won't run into the trouble you've already fixed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vitoco</div><div class="date">24th November 2006, 19:13</div></div><div class="posttext">I'm not the author of that piece of code, I just fixed it. I sent an email to dselkirk some time ago without a response. This is why I wrote my page (http://www.vitoco.cl/nsis/servicelib.html) instead of to update the wiki.<br />
<br />
Accepting both parameters (&quot;machine&quot; and &quot;depend&quot;) is a good idea for backward compatibility, but I'm not sure if &quot;machine&quot; was once used as the name of the machine where to install a service. I don't know about Windows' system calls history :D<br />
<br />
If I get some requests here, I'll think again about to upload my script to the wiki.<br />
<br />
++Vitoco</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th November 2006, 19:36</div></div><div class="posttext">The Wiki is all about public contribution. You can edit that page, even if you didn't create it. If you have a fix for a script in the Wiki, you should update the page to at least mention it. In the worst case, there's an history page for each Wiki page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vitoco</div><div class="date">12th December 2006, 12:57</div></div><div class="posttext">Wiki page updated... (http://nsis.sourceforge.net/NSIS_Service_Lib)<br />
<br />
The new 1.4 version is backward compatible (accepts both &quot;depend&quot; and &quot;machine&quot; as the name for the same parameter).<br />
<br />
++Vitoco</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>