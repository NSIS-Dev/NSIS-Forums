<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How many IfErrors do I really need?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How many IfErrors do I really need? NSIS Discussion" />
	
	<title> How many IfErrors do I really need? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How many IfErrors do I really need?</div>
<hr />
<div class="pda"><a href="t-271365.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=271365">How many IfErrors do I really need?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DrDan</div><div class="date">18th May 2007, 14:36</div></div><div class="posttext">I have a sequence of registry entry writes like this:<br />
<br />
WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\MyProduct&quot; &quot;MyProduct v 1.0&quot; &quot;MyCompany's Product&quot;<br />
WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\MyProduct&quot; &quot;UninstallString&quot; &quot;$INSTDIR\${UNINSTALLER_NAME}&quot;<br />
WriteRegStr HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\MyProduct&quot; &quot;DisplayName&quot; &quot;MyProduct v1.0&quot;<br />
WriteRegDWORD HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\MyProduct&quot; &quot;NoModify&quot; 0x1<br />
WriteRegDWORD HKLM &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\MyProduct&quot; &quot;NoRepair&quot; 0x1<br />
<br />
I need to be able to log everything that goes wrong. So, my question is: should I have a ClearErrors call before each one and an IfErrors call after each one? Is this the only way to handle errors? What is the best way to deal with so many goto labels?<br />
<br />
Any advice is appreciated.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">18th May 2007, 15:12</div></div><div class="posttext">The error flag resets only if ClearErrors or IfErrors is called. You should add ClearErrors before the first WriteRegStr just to be sure. You can add IfErrors after each WriteReg if you really want to, but you can also add just one after all of the WriteRegs. :) <br />
<br />
ClearErrors<br />
WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;MyProduct v 1.0&quot; &quot;MyCompany's Product&quot;<br />
WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;UninstallString&quot; &quot;$INSTDIR\${UNINSTALLER_NAME}&quot;<br />
WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;DisplayName&quot; &quot;MyProduct v1.0&quot;<br />
WriteRegDWORD HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;NoModify&quot; 0x1<br />
WriteRegDWORD HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;NoRepair&quot; 0x1<br />
IfErrors 0 +2<br />
  DetailPrint &quot;Writing Uninstall registry keys failed!&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">18th May 2007, 15:22</div></div><div class="posttext">Anytime you call IfErrors, the system clears the error flag.  It's probably good to clear errors at the beginning, but not necessary afterward if you are using IfErrors.<br />
<br />
If you need to log specifics for each registry write, then you'll need to call IfErrors each time.  But if you want to just log one error for the entire block, then call IfErrors once at the end.<br />
<br />
And if you need to call after each time, the easiest way would be to wrap the call into its own macro.  Something like this (using logiclib):<br />
<br />
!define WriteReg &quot;${WriteReg}&quot;<br />
<br />
!macro WriteReg type hive key value<br />
   ${Switch} ${type}<br />
      Case 'str'<br />
         WriteRegStr '${hive}' '${key}' '${value}'<br />
	 ${Break}<br />
      Case 'dword'<br />
	 WriteRegDword '${hive}' '${key}' '${value}'<br />
	 ${Break}<br />
    ${EndSwitch}<br />
	${If} ${Errors} <br />
      ; put code here if errors...<br />
    ${Else}<br />
      ; put any non-error code here, if any<br />
   ${EndIf}<br />
!macroend<br />
<br />
<br />
Then, your calls would look like this:<br />
<br />
${WriteReg} &quot;str&quot; HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;MyProduct v 1.0&quot; &quot;MyCompany's Product&quot;<br />
${WriteReg} &quot;str&quot; HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;UninstallString&quot; &quot;$INSTDIR\${UNINSTALLER_NAME}&quot;<br />
${WriteReg} &quot;str&quot; HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;DisplayName&quot; &quot;MyProduct v1.0&quot;<br />
${WriteReg} &quot;dword&quot; HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;NoModify&quot; 0x1<br />
${WriteReg} &quot;dword&quot; HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\MyProduct&quot; &quot;NoRepair&quot; 0x1</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>