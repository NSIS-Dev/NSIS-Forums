<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with shortcut icon and NSIS, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with shortcut icon and NSIS NSIS Discussion" />
	
	<title> Problem with shortcut icon and NSIS [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with shortcut icon and NSIS</div>
<hr />
<div class="pda"><a href="t-355827.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=355827">Problem with shortcut icon and NSIS</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Arth</div><div class="date">13th February 2013, 23:18</div></div><div class="posttext">I am trying to get an external icon installed in the program .lnk but it is not working for me.  The following is the nsis.nsi statements that are involved:<br />
<br />
!define APP_NAME &quot;Fescue&quot;<br />
!define VERSION &quot;01.00.00.00&quot;<br />
!define DESCRIPTION &quot;Application&quot;<br />
!define INSTALLER_NAME &quot;\Dropbox\Fescue\setup.exe&quot;<br />
!define MAIN_APP_EXE &quot;Fescue.rex&quot;<br />
!define MAIN_APP_ICO &quot;Fescue.ico&quot;<br />
!define INSTALL_TYPE &quot;SetShellVarContext current&quot;<br />
<br />
!ifdef REG_START_MENU<br />
!insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
CreateDirectory &quot;$SMPROGRAMS\$SM_Folder&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\$SM_Folder\${APP_NAME}.lnk&quot; \<br />
          &quot;$INSTDIR\${MAIN_APP_EXE}&quot; &quot;$INSTDIR\${MAIN_APP_ICO}&quot;<br />
CreateShortCut &quot;$DESKTOP\${APP_NAME}.lnk&quot; &quot;$INSTDIR\${MAIN_APP_EXE}&quot; \<br />
          &quot;$INSTDIR\${MAIN_APP_ICO}&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\$SM_Folder\Uninstall ${APP_NAME}.lnk&quot; \<br />
           &quot;$INSTDIR\uninstall.exe&quot;<br />
!endif<br />
<br />
When I look at the .lnk file with a hex editor, or select properties on the program icon, it appears the .ico file information has been appended to the end of the target field for the program.  If I manually select to change the icon on the properties panel, it works okay, but the .ico information is located in a different place in the .lnk file.  Suggestions on how to get around this problem?  This is on a Windows XP Pro system.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th February 2013, 03:32</div></div><div class="posttext">Make sure $INSTDIR\${MAIN_APP_EXE} and ${MAIN_APP_ICO} exist before you call CreateShortcut...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Arth</div><div class="date">14th February 2013, 14:21</div></div><div class="posttext">Thanks Anders, but if you read my original post, the following defines are at the first part of my script:<br />
!define MAIN_APP_EXE &quot;Fescue.rex&quot;<br />
!define MAIN_APP_ICO &quot;Fescue.ico&quot;<br />
Is there another solution or work around?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">14th February 2013, 15:21</div></div><div class="posttext">Anders means that the folders and files must exist before the shortcut is created.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Arth</div><div class="date">14th February 2013, 15:56</div></div><div class="posttext">Sorry for being so dense, but see the following from my original post:<br />
CreateDirectory &quot;$SMPROGRAMS\$SM_Folder&quot;<br />
CreateShortCut &quot;$SMPROGRAMS\$SM_Folder\${APP_NAME}.lnk&quot; \<br />
&quot;$INSTDIR\${MAIN_APP_EXE}&quot; &quot;$INSTDIR\${MAIN_APP_ICO}&quot;<br />
CreateShortCut &quot;$DESKTOP\${APP_NAME}.lnk&quot; &quot;$INSTDIR\${MAIN_APP_EXE}&quot; \<br />
&quot;$INSTDIR\${MAIN_APP_ICO}&quot;<br />
<br />
As I stated in the original post, the shortcut is there with the execution parameter filled in and the ico parameter is also there, but following the execution parameter in the target field like:<br />
C:\Fescue\fescue.rex C:\Fescue\fescue.ico<br />
the fescue.ico file is also in the C:\Fescue folder after the setup.exe install has been run.  I suspect the problem is with the executable not being an .exe or .dll, but the .rex is defined to have ooRexx.exe start and that is passed as the startup parameter.  That all works okay - just the icon is NOT present on either the desktop or the Start Menu folder.  I am asking if there is a workaround or how this should be handled.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">14th February 2013, 18:58</div></div><div class="posttext">Arth, you still don't seem to be answering Anders' concern. When you execute the code to create the SMPrograms folder and the shortcut, has the executable file been extracted yet? If the file isn't yet on the target computer, the shortcut icon won't be set properly.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th February 2013, 20:25</div></div><div class="posttext">You forgot a parameter: Createshortcut foo.lnk bar.exe &quot;&quot; baz.ico</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>