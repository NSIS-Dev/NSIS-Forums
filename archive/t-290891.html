<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Mutually Exclusive Options problem., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Mutually Exclusive Options problem. NSIS Discussion" />
	
	<title> Mutually Exclusive Options problem. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Mutually Exclusive Options problem.</div>
<hr />
<div class="pda"><a href="t-290891.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=290891">Mutually Exclusive Options problem.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Anach</div><div class="date">26th April 2008, 16:32</div></div><div class="posttext">Almost done with my Installer, but have been stuck on one problem which I've been unable to solve.<br />
<br />
I have 3 option groups with 2 mutually exclusive options each. Now this is where it gets confusing.<br />
<br />
If the Top option in each group is selected (Sec2, Sec4, Sec6) by the user, then the user can change between options in any other of the 3 groups by single clicking between each selection, as one would expect. However, if the bottom option in any group is selected (Sec1, Sec3, Sec5) then the user has to unselect the selected option before selecting another, as it locks and wont allow it to change.  So it works one way, but not the other.<br />
<br />
<br />
Function .onSelChange<br />
  Push $0<br />
 <br />
;OptionGroup1<br />
    StrCmp $R9 ${Sec1} check_Sec1<br />
    SectionGetFlags ${Sec1} $0<br />
    IntOp $0 $0 &amp; ${SF_SELECTED}<br />
    IntCmp $0 ${SF_SELECTED} 0 OptionGroup1Done OptionGroup1Done<br />
      StrCpy $R9 ${Sec1}<br />
      SectionGetFlags ${Sec2} $0<br />
      IntOp $0 $0 &amp; ${SECTION_OFF}<br />
      SectionSetFlags ${Sec2} $0<br />
  <br />
    Goto OptionGroup1Done  <br />
    <br />
  check_Sec1:<br />
 <br />
    SectionGetFlags ${Sec2} $0<br />
    IntOp $0 $0 &amp; ${SF_SELECTED}<br />
    IntCmp $0 ${SF_SELECTED} 0 OptionGroup1Done OptionGroup1Done<br />
      StrCpy $R9 ${Sec2}<br />
      SectionGetFlags ${Sec1} $0<br />
      IntOp $0 $0 &amp; ${SECTION_OFF}<br />
      SectionSetFlags ${Sec1} $0<br />
   <br />
   OptionGroup1Done:<br />
   <br />
;OptionGroup2<br />
    StrCmp $R9 ${Sec3} check_Sec3<br />
    SectionGetFlags ${Sec3} $0<br />
    IntOp $0 $0 &amp; ${SF_SELECTED}<br />
    IntCmp $0 ${SF_SELECTED} 0 OptionGroup2Done OptionGroup2Done<br />
      StrCpy $R9 ${Sec3}<br />
      SectionGetFlags ${Sec4} $0<br />
      IntOp $0 $0 &amp; ${SECTION_OFF}<br />
      SectionSetFlags ${Sec4} $0<br />
 <br />
     Goto OptionGroup2Done <br />
     <br />
  check_Sec3:<br />
 <br />
    SectionGetFlags ${Sec4} $0<br />
    IntOp $0 $0 &amp; ${SF_SELECTED}<br />
    IntCmp $0 ${SF_SELECTED} 0 OptionGroup2Done OptionGroup2Done<br />
      StrCpy $R9 ${Sec4}<br />
      SectionGetFlags ${Sec3} $0<br />
      IntOp $0 $0 &amp; ${SECTION_OFF}<br />
      SectionSetFlags ${Sec3} $0<br />
  <br />
  OptionGroup2Done:<br />
    <br />
;OptionGroup3 <br />
    StrCmp $R9 ${Sec5} check_Sec5<br />
    SectionGetFlags ${Sec5} $0<br />
    IntOp $0 $0 &amp; ${SF_SELECTED}<br />
    IntCmp $0 ${SF_SELECTED} 0 OptionGroup3Done OptionGroup3Done<br />
      StrCpy $R9 ${Sec5}<br />
      SectionGetFlags ${Sec6} $0<br />
      IntOp $0 $0 &amp; ${SECTION_OFF}<br />
      SectionSetFlags ${Sec6} $0<br />
 <br />
    Goto OptionGroup3Done <br />
  <br />
  check_Sec5:<br />
 <br />
    SectionGetFlags ${Sec6} $0<br />
    IntOp $0 $0 &amp; ${SF_SELECTED}<br />
    IntCmp $0 ${SF_SELECTED} 0 OptionGroup3Done OptionGroup3Done<br />
      StrCpy $R9 ${Sec6}<br />
      SectionGetFlags ${Sec5} $0<br />
      IntOp $0 $0 &amp; ${SECTION_OFF}<br />
      SectionSetFlags ${Sec5} $0<br />
<br />
  OptionGroup3Done:<br />
 <br />
  Pop $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AaronLS</div><div class="date">26th April 2008, 19:19</div></div><div class="posttext">There are a couple critical pieces missing from this:<br />
http://nsis.sourceforge.net/Mutually_Exclusive_Sections<br />
<br />
First, in .oninit you have to memorize current selections.  I personally would use a user var instead of register R9.<br />
<br />
Second, you use that in selection onchange.  You are missing this line from the example at the beginning of .onSelChange:<br />
  StrCmp $R9 ${sec1} check_sec1<br />
<br />
You might want to consider using the RadioButtons macros, as it might make this a lot easier, especially if you get more than 2 items in a group:<br />
http://nsis.sourceforge.net/RadioButtons<br />
<br />
Anyway, I just tested this code:<br />
<br />
Name &quot;Example1&quot;<br />
<br />
; The file to write<br />
OutFile &quot;example1.exe&quot;<br />
<br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;LogicLib.nsh&quot;<br />
<br />
; The default installation directory<br />
InstallDir $DESKTOP\Example1<br />
<br />
Page components<br />
Page instfiles<br />
<br />
Section &quot;1&quot; Sec1<br />
  <br />
SectionEnd ; end the section<br />
Section /o &quot;2&quot; Sec2<br />
  <br />
SectionEnd ; end the section<br />
Section &quot;3&quot; Sec3<br />
  <br />
SectionEnd ; end the section<br />
Section /o &quot;4&quot; Sec4<br />
  <br />
SectionEnd ; end the section<br />
Section &quot;5&quot; Sec5<br />
  <br />
SectionEnd ; end the section<br />
Section /o &quot;6&quot; Sec6<br />
  <br />
SectionEnd ; end the section<br />
<br />
<br />
<br />
Var /GLOBAL WasSelectedGrpA<br />
Var /GLOBAL WasSelectedGrpB <br />
Var /GLOBAL WasSelectedGrpC <br />
Function .oninit<br />
  ;this is the critical piece you were missing, you have to memorize who is initial selected for each<br />
  ;mutually exclusive group, otherwise when you get to .onSelChange, you will have 2 selected sections<br />
  ;and won't know which one to deselect because you don't know which is the newly selected<br />
  <br />
  StrCpy $WasSelectedGrpA ${Sec1}<br />
  StrCpy $WasSelectedGrpB ${Sec3}<br />
  StrCpy $WasSelectedGrpC ${Sec5}  <br />
FunctionEnd<br />
<br />
Function .onSelChange<br />
<br />
;If both items are selected, then one of them must be deselected<br />
  ${If} ${SectionIsSelected} ${Sec1}<br />
  ${AndIf} ${SectionIsSelected} ${Sec2}<br />
;unselect old selection<br />
    !insertmacro UnselectSection $WasSelectedGrpA     <br />
  ${EndIf}    <br />
<br />
;memorize current selection<br />
  ${If} ${SectionIsSelected} ${Sec1}<br />
    StrCpy $WasSelectedGrpA ${Sec1}  <br />
  ${ElseIf} ${SectionIsSelected} ${Sec2}<br />
    StrCpy $WasSelectedGrpA ${Sec2}<br />
  ${EndIf} <br />
  <br />
  ${If} ${SectionIsSelected} ${Sec3}<br />
  ${AndIf} ${SectionIsSelected} ${Sec4}<br />
    !insertmacro UnselectSection $WasSelectedGrpB<br />
  ${EndIf}<br />
    ${If} ${SectionIsSelected} ${Sec3}<br />
    StrCpy $WasSelectedGrpB ${Sec3}<br />
  ${ElseIf} ${SectionIsSelected} ${Sec4}<br />
    StrCpy $WasSelectedGrpB ${Sec4}<br />
  ${EndIf}<br />
<br />
  <br />
  ${If} ${SectionIsSelected} ${Sec5}<br />
  ${AndIf} ${SectionIsSelected} ${Sec6}<br />
    !insertmacro UnselectSection $WasSelectedGrpC <br />
  ${EndIf}<br />
    ${If} ${SectionIsSelected} ${Sec5}<br />
    StrCpy $WasSelectedGrpC ${Sec5}<br />
  ${ElseIf} ${SectionIsSelected} ${Sec6}<br />
    StrCpy $WasSelectedGrpC ${Sec6}<br />
  ${EndIf}<br />
<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anach</div><div class="date">26th April 2008, 20:37</div></div><div class="posttext">Thankyou again for dumbing it down for me :P<br />
<br />
Again that makes it much easier and works perfectly. I'm sure the users will be happy to get this next week :)<br />
<br />
I appreciate the help.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>