<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Installation type depending on file existing, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Installation type depending on file existing NSIS Discussion" />
	
	<title> Installation type depending on file existing [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Installation type depending on file existing</div>
<hr />
<div class="pda"><a href="t-263952.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=263952">Installation type depending on file existing</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MikeInVancouver</div><div class="date">18th January 2007, 21:41</div></div><div class="posttext">I am a bit of a newbie to nsis so plesae bear with me if this seems a little confusing.<br />
<br />
I want to look to see if the .jar file we are installing already exists in teh install directory, if it doesnt I would just like to procede to the next page, but if it exists then I would like to have a dialog with 3 radio buttons as options appear. These 3 options would be &quot;upgrade current version&quot; which would overwrite the .jar but not the data. Option 2 wuold be &quot;Clean Install&quot; which would overwrite both the .jar and the data files. The third option would be &quot;Install new in new location&quot; which would just redirect the person back to the current page, where they could choose another directory location. <br />
<br />
I know how to use the overwrite on/off and have a basic script working but I need to get this functionality into the script. Is this possible with a messsage box or do I need to create a custom page. Either way any hints or code examples would be greatly appreciated.<br />
<br />
Thanks in advance,<br />
<br />
Mike</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">18th January 2007, 23:18</div></div><div class="posttext">i guess you know how to check for the file?<br />
(IfFileExists jump_true jump_false)<br />
<br />
then if you really want to have exactly those 3 options, you need indeed a custom page.<br />
<br />
i'm too tired now to code it, but maybe tomorrow i can post some code.<br />
<br />
in the meanwhile, you could browse the forums/wiki/documentation files about installtoptions :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th January 2007, 06:31</div></div><div class="posttext">an example to help you as a starting point :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MikeInVancouver</div><div class="date">19th January 2007, 17:54</div></div><div class="posttext">Thanks Red Wine,<br />
<br />
It has got me started but I am still unsure how to accomplish what I am trying to do. I want the welcome page to appear, then the Directory page and then if the .jar file exists in the directory the user specified then they choose one of the options and the script installs the appropiate files, if the file doesnt exist I want it to skip the page with options and just do a clean install. <br />
<br />
I am wondering at what point is the SEC01 called in nsis? Is it called when the instfiles page is called?  I am trying to figure out exactly how everything ties together and works, I have a basic script working but I am not sure what the proper order/priority the code is executed. <br />
<br />
As I mentioned I am I newbie at this so thank you for your understanding.<br />
<br />
Mike</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">19th January 2007, 18:12</div></div><div class="posttext">all sections are executed in the instfiles page, yes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpodtbc</div><div class="date">19th January 2007, 18:18</div></div><div class="posttext">assuming sec01 is your first section, it is run when the install occurs. so yes it is what is called during your instfiles page. other install sections are also called here if you have them defined.<br />
<br />
to do what you want, you could define the .onInit function (if you haven't already) which is an initialization callback run before any pages are displayed. in this function you could check for the existence of the .jar file and setup your custom page if so. <br />
<br />
<br />
Function .onInit<br />
<br />
IfFileExists &quot;blah.jar&quot; exists notexists<br />
<br />
exists:<br />
 StrCpy $JarExists 1<br />
 !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;myPage.ini&quot;<br />
<br />
notexists:<br />
<br />
FunctionEnd<br />
<br />
<br />
then you would have function that setup your custom page like this. note that abort in a page initialization function context does not abort the installation but only the creation of that page.<br />
<br />
<br />
Function preInitMyPage<br />
${If} $JarExists == 0<br />
 Abort<br />
${EndIf}<br />
<br />
// setup your custom page here<br />
FunctionEnd<br />
<br />
<br />
you'll also need to validate the response from your page with another function like this<br />
<br />
<br />
Function validateMyPage<br />
// get the user response here<br />
FunctionEnd<br />
<br />
<br />
note that using {If} requires that you include LogicLib.nsh in your project. also using the modern ui (MUI) makes custom pages a lot easier.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">19th January 2007, 19:37</div></div><div class="posttext">Originally posted by MikeInVancouver <br />
Thanks Red Wine,<br />
<br />
It has got me started but I am still unsure how to accomplish what I am trying to do. I want the welcome page to appear, then the Directory page and then if the .jar file exists in the directory the user specified then they choose one of the options and the script installs the appropiate files, if the file doesnt exist I want it to skip the page with options and just do a clean install. <br />
<br />
I am wondering at what point is the SEC01 called in nsis? Is it called when the instfiles page is called?  I am trying to figure out exactly how everything ties together and works, I have a basic script working but I am not sure what the proper order/priority the code is executed. <br />
<br />
As I mentioned I am I newbie at this so thank you for your understanding.<br />
<br />
Mike  <br />
Hi Mike,<br />
provided example checks for an installation instead of asking users to point the installation folder. Assumes that the installer knows where/how to search in order to determine the existence of an installation on the target. It's based more or less on the installation structure that you mentioned on your 1st post on the top of this thread. Pages' order could be changed. Sections executed within instfiles page.<br />
Now, the following attached example shows more or less the changed structure.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MikeInVancouver</div><div class="date">23rd January 2007, 19:29</div></div><div class="posttext">Thank you everyone,<br />
<br />
With your help and reading all the documentation I could find I was able to accomplish what I set out to do. I really appreciate all the informative, and helpful  feedback.<br />
<br />
Mike</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>