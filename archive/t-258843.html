<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" setup executed by other program hangs..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  setup executed by other program hangs... NSIS Discussion" />
	
	<title> setup executed by other program hangs... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  setup executed by other program hangs...</div>
<hr />
<div class="pda"><a href="t-258843.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258843">setup executed by other program hangs...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MVI</div><div class="date">3rd November 2006, 18:12</div></div><div class="posttext">Greetings...<br />
<br />
I've some strange problem: when multi-language setup launched by other program (autorun.exe), which sets value for MUI_LANGDLL_REGISTRY_KEY -- setup hangs: it just displayed in processes list (task manager) with no activity (processor usage == 0). But when I starts it by myself (or without setting key) -- it works fine...<br />
<br />
Best regards...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd November 2006, 18:17</div></div><div class="posttext">Does it happen when you don't preset the registry? Does it happen when you run it from another installer? Does it happen with other applications ran by autorun.exe? Do you have a script example reproducing the problem? Which version of NSIS are you using?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MVI</div><div class="date">6th November 2006, 08:53</div></div><div class="posttext">Originally posted by kichik <br />
Does it happen when you don't preset the registry? <br />
no. in this case setup works fine.<br />
<br />
Originally posted by kichik <br />
Does it happen when you run it from another installer?  <br />
it executed not by installer. it executed by some small autorun (using ShellExecute() (also tried CreateProcess)).<br />
Both &quot;Far file manager&quot; and &quot;Total commander&quot; works fine (with and without records in registry). &quot;Common application&quot; also starts fine.<br />
<br />
Originally posted by kichik <br />
Does it happen with other applications ran by autorun.exe? <br />
no. other applications starts fine.<br />
<br />
Originally posted by kichik <br />
Do you have a script example reproducing the problem? <br />
yes. attached.<br />
<br />
Originally posted by kichik <br />
Which version of NSIS are you using?  <br />
2.21</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">6th November 2006, 15:33</div></div><div class="posttext">While ago I made this http://forum.ccleaner.com/index.php?showtopic=6161 portable wrapper for CCleaner with NSIS and some of the users told me that it hangs a very long time when it's runs from CD via autorun and when it's executed normally from the CD it doesn't hang.<br />
<br />
I have confirmed this my self in win2k, but in windows XP I couldn't reproduce it. MVI what operating system you are using?<br />
<br />
The portable wrapper reads and writes in the registry when it starts so I think we have a pattern here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MVI</div><div class="date">6th November 2006, 15:53</div></div><div class="posttext">I'm using Windows XP (pro sp2). Same problem appears on windows 98 and 2000.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2006, 21:32</div></div><div class="posttext">Are you also running it from a CD?<br />
<br />
Can you attach your wrapper application, preferably with source code, so I can have complete way to reproduce this?<br />
<br />
Are you familiar with using a debugger? Could you attach a debugger to to the hung process and see what it's doing?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MVI</div><div class="date">7th November 2006, 09:06</div></div><div class="posttext">Originally posted by kichik <br />
Are you also running it from a CD?<br />
 <br />
no. while testing i'm running it locally.<br />
<br />
Originally posted by kichik <br />
Can you attach your wrapper application, preferably with source code, so I can have complete way to reproduce this?<br />
 <br />
done.<br />
<br />
Originally posted by kichik <br />
Are you familiar with using a debugger? Could you attach a debugger to to the hung process and see what it's doing?  <br />
setup hangs somewhere in ntdll.dll. as there is no debug symbols i cant't say precisely...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">7th November 2006, 11:54</div></div><div class="posttext">Originally posted by kichik <br />
Can you attach your wrapper application, preferably with source code, so I can have complete way to reproduce this?<br />
Done.  :) It won't do anything without CCleaner, but CCleaner isn't needed to reproduce the problem.<br />
<br />
Originally posted by kichik <br />
Are you familiar with using a debugger? Could you attach a debugger to to the hung process and see what it's doing? <br />
I tried Dependency Walker. I din't expect it to hang, but it did. Last thing in the log is GetUserDefaultUILanguage Full log is in the attachment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th November 2006, 19:29</div></div><div class="posttext">MVI, there's no attachment. {_trueparuex^}, I couldn't reproduce it with yours.<br />
<br />
MVI, what's above ntdll.dll in the stack? Addresses in the installer will help as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">9th November 2006, 15:24</div></div><div class="posttext">Originally posted by kichik <br />
{_trueparuex^}, I couldn't reproduce it with yours.<br />
Try Dependency Walker. When I start to profiling the file it hangs and the file doesn't need to be on CD. That GetUserDefaultUILanguage actually was GetProcAddress call to that function, but I have noticed that it doesn't always hang on the same place when profiling.<br />
<br />
MVI you said on your original post that the installer hangs with 0 processor usage. In my case the portable app work as hard as it can while it hangs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2006, 18:14</div></div><div class="posttext">{_trueparuex^}, worked fine for me with without depends.exe on both XP and 2000.<br />
<br />
Are you sure it hangs before .onInit is called? That function does a lot in your code, including registering many external DLL files. You also said it hanged for a long while and not completely as in MVI's case.<br />
<br />
MVI, can you attach the code again? Your last post has no attachment.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MVI</div><div class="date">9th November 2006, 18:42</div></div><div class="posttext">sorry.<br />
http://users.i.com.ua/~hunter_/Autorun.rar<br />
<br />
just after &quot;pause&quot; it 7c90eb94 (command ret)<br />
then (after some &quot;step over&quot;s it &quot;ups&quot; to 01332693 where hangs again on call dword ptr ds:[13330C0h] and &quot;here we go agin&quot; :))</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2006, 18:52</div></div><div class="posttext">Which DLL is loaded at 01330000? Process Explorer (http://www.sysinternals.com/Utilities/ProcessExplorer.html) can tell you that.<br />
<br />
What's above it in the stack? Where is that loop called from?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2006, 18:56</div></div><div class="posttext">MVI, never mind, I found the problem. It's just too good to be true... You pass SW_HIDE to ShellExecute in your program so the dialog comes up hidden. I read about it (http://blogs.msdn.com/oldnewthing/archive/2006/10/23/862750.aspx) not too long ago but dismissed it because you said you've also tried CreateProcess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">9th November 2006, 21:24</div></div><div class="posttext">Originally posted by kichik <br />
{_trueparuex^}, worked fine for me with without depends.exe on both XP and 2000.<br />
<br />
Are you sure it hangs before .onInit is called? That function does a lot in your code, including registering many external DLL files. You also said it hanged for a long while and not completely as in MVI's case.<br />
Oh you are going to love this... I added messageboxs to beginning of .onInit to see if it gets in it and it did. Then I added messageboxes to .onInit to see where it hangs and it hangs somewhere in GetParameters function... Can you see where this is going? :( Shame on me shame on me... Well it's stuck on the first loop. To make it short it gets stuck in endless loop if the commandline doesn't have any quotes or any spaces in it, because one $R2 in the code should be $R0. :p <br />
<br />
Shame on me shame on me. I am sorry I wasted your time. :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2006, 22:58</div></div><div class="posttext">Happy ending. How can I not love it? ;)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>