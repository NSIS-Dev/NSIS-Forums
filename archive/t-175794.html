<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Install var in uninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Install var in uninstall NSIS Discussion" />
	
	<title> Install var in uninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Install var in uninstall</div>
<hr />
<div class="pda"><a href="t-175794.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=175794">Install var in uninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">toroso</div><div class="date">8th April 2004, 08:55</div></div><div class="posttext">Hi,<br />
<br />
I define and use an install-time variable with Var that I use in the installer. Now I would like to use this value also in the uninstaller (with the value that it was given during the install). Is it possible to accomplish this in some way?<br />
<br />
Thanks,<br />
Torbj√∂rn</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilO</div><div class="date">8th April 2004, 09:04</div></div><div class="posttext">Hi :)<br />
<br />
To achieve that, you'll have to write the value of that variable into an 'ini' file, and read that variable from the uninstaller. <br />
<br />
- In the installer: <br />
WriteIniStr &quot;c:\\my_dir\\my_file.ini&quot; &quot;MySection&quot; &quot;MyVarValue&quot; $MyVar <br />
<br />
<br />
- In the uninstaller: <br />
ReadINIStr $MyVar &quot;c:\\my_dir\\my_file.ini&quot; &quot;MySection&quot; &quot;MyVarValue&quot; <br />
<br />
evilO/Olive</div></div><hr />


<div class="post"><div class="posttop"><div class="username">toroso</div><div class="date">8th April 2004, 09:37</div></div><div class="posttext">Thanks, it works great!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">8th April 2004, 13:09</div></div><div class="posttext">Using the registry is faster than using an INI file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilO</div><div class="date">8th April 2004, 13:19</div></div><div class="posttext">True. I guess I'm too used to the 'ini' files as I have plenty of information to store and to retrieve :D..<br />
Therefore I use the registry a less as possible, let's say the installation directory and the usual &quot;Uninstall&quot; keys...<br />
<br />
evilO/Olive</div></div><hr />


<div class="post"><div class="posttop"><div class="username">garu</div><div class="date">26th November 2004, 14:33</div></div><div class="posttext">Excuse me, but i tried to do something similar and i hit the classic &quot;cat chasing his tail&quot; problem.<br />
<br />
To be short, i'd lke to use the installer to build some dynamic directory structures that based in a common root, may have some common nodes, whose names are depending on some parms entered in a configuration page and dinamically build the related uninstallers that when invoked delete the related structure, starting from the leafs up to the point where the nodes are shared with other structures.<br />
<br />
The uninstaller names are dynamically generated depending on parms entered in a configuration page, but given the fact that i cannot pass the installer variables directly into the uninstaller, and i find this a truly bad limitation, i was not able to find any means to link a generated uninstaller with a generated ini file or registry keyword.<br />
<br />
I need some dynamic values in the uninstaller, but i cannot read them because i need another dynamic value to point me to the saved ini file or registry keys that contains them.<br />
<br />
I tried to use the<br />
System::Call 'kernel32::GetModuleFileNameA(i 0, t .R0, i 1024) i r1'<br />
call to get the uninstaller name, to use is as the name of a related ini file, but what i get back is the name with which the uninstaller copies itself into the temporary directory.<br />
<br />
Using that returned name, after cutting away the temp dir part, doesn't allow me to even retrieve the original installer to delete it, so it's completely useless.<br />
<br />
Do you think there's a way to solve this or i have to abort the idea to use NSIS to perform this job?<br />
<br />
Thanks,  Gabriele</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th November 2004, 14:38</div></div><div class="posttext">$EXEDIR.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">garu</div><div class="date">26th November 2004, 15:00</div></div><div class="posttext">What exactly do you mean?<br />
$EXEDIR in a uninstaller returns the<br />
windows TEMP directory path, in short format.<br />
What can i do with that?<br />
<br />
Gabriele.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th November 2004, 15:03</div></div><div class="posttext">Oops. It's $INSTDIR or $OUTDIR.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">garu</div><div class="date">29th November 2004, 08:13</div></div><div class="posttext">Hi kichik,<br />
thanks for you fast response, but from it i guess you didn't understand my problem:)<br />
I don't want to bother you again with the details, since i found myself a bypass for the problem.<br />
I write a uninstall.exe and uninstall.ini in a leaf of the generated structure, so that they can be always written with the same name and uninstall.exe is able to find its ini file using a static name instead of a dynamic one.<br />
Then i write a shortcut to it with the generated name in the common $INSTDIR.<br />
<br />
Anyway my perplexities still remain, and since before answering i spent some more time peeking around in this forum, i see i'm not alone.<br />
<br />
We can create really powerful and customized self contained installers, using variables, but we cannot pass a bit of these information into uninstaller unless we start polluting registry or filesystem with ini files and making strange contorsions like in my case.<br />
<br />
I guess it's not a technical problem, it shouldn't be too difficult to replicate the variable symbol table or whatever you use in your compiler, into the generated uninstaller, but rather a design choice.<br />
<br />
If your concerns are about avoiding that users may uninstall something wrong giving them too much power, i can assure you that i work since 26 years in IT, i have worked with almost all OS that have been invented and with almost all the languages that have been conceived and i have seen generations of designers striving to build foolproof products.<br />
No way, fools are, and will always be, more clever than them and will always find a way to shoot themselves in their feets, no matter what you give in their hands.<br />
<br />
So please make all the variables created in the installer available into the uninstaller and give us the power to kill ourselves at our pleasure without too much fatigue:)<br />
<br />
Thanks Gabriele.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scrose</div><div class="date">29th November 2004, 16:49</div></div><div class="posttext">Hi Gabriele,<br />
<br />
Well stated. I agree with you. The uninstaller would become much more robust if it could use the values of variables as declared in the installer. The uninstaller would achieve greater independence, no longer having to necessarily rely on the registry or INI files to restore the values of needed variables.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th November 2004, 19:30</div></div><div class="posttext">You wanted to get the directory that contained the uninstaller. $INSTDIR contains exactly that.<br />
<br />
As for automatically saving all of the variables from the installer in the uninstaller executable, it's very wasteful. You'll add around 30kb (1kb per variable by default). And if you're thinking of compressing it, you'd need to add the compression code to the exehead which will increase both the installer and uninstaller size by a very noticeable amount (not to mention the hard work to get the compression code to lose clib dependency).<br />
<br />
If you really want to avoid regitry and INI files, you can always append data to the uninstaller yourself. By default, the CRC checksum stops at the end of the data. You can then read this data using FileRead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">M-Force</div><div class="date">22nd June 2006, 15:45</div></div><div class="posttext">Hi,<br />
I want to append data to the unistaller in order to reuse the data in the uninstaller which i defined in the installer. I want to avoid creating an ini file or using the registry for storing such data.<br />
<br />
My question now is how to do that in detail.<br />
<br />
Can somebody help me with that?<br />
<br />
M.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">30th June 2006, 09:25</div></div><div class="posttext">Use FileOpen, FileSeek, FileWrite and FileClose to write data to the uninstaller file. In the uninstaller, use FileRead to get that data. Note that you'll have to disable CRC check for the uninstaller for this to work. Use CRCCheck to do that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">5th October 2007, 13:07</div></div><div class="posttext">At first - I have read http://forums.winamp.com/showthread.php?s=&amp;threadid=249431 and I know how to append data to the uninstaller.<br />
<br />
I was trying to do it myself - posting attachment. Everything was OK until I tried to read from the uninstaller file. FileRead instruction set ErrorFlag and I don't know why.<br />
<br />
Any suggestions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th October 2007, 13:16</div></div><div class="posttext">$EXEDIR is $TEMP in the uninstaller. Use $INSTDIR instead.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">5th October 2007, 13:32</div></div><div class="posttext">Thanks Kichik, I know that. I thought that it doesn't matter from which location I read the uninstaller. Is the problem that FileRead can't read from the file in $TEMP because it is executed?<br />
<br />
Attaching working script:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th October 2007, 13:45</div></div><div class="posttext">It can read itself, but the name is different. So you have to use $EXEPATH instead of $EXEDIR\unDataUninst.exe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">5th October 2007, 13:56</div></div><div class="posttext">Ooops, I forgot this fact. Thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman5007523</div><div class="date">6th December 2007, 01:13</div></div><div class="posttext">I found this post while trying to get an answer to the same question the original poster had. I was trying to set/save a string value of the path to a folder somewhere other than the install path (e.g. $INSTDIR or $EXEDIR). I figured out a different way to accomplish my goal. The following methodology may work for some of your situations. I know it worked well for mine. I don't know why, but it worked for my application. Sample code is attached as a text file. Overview: Declare a global variable outside/before sections (e.g. Var /GLOBAL FormsFolder). Set the value of the variable (StrCpy $FormsFolder &quot;F:\Main\Branch\Twig\Forms&quot;) in the initialization function, an install section (e.g. Section &quot;&quot;), and the uninstall section (i.e. Section &quot;Uninstall&quot;).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>