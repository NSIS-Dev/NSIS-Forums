<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" File Write Access check wont always work.., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  File Write Access check wont always work.. NSIS Discussion" />
	
	<title> File Write Access check wont always work.. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  File Write Access check wont always work..</div>
<hr />
<div class="pda"><a href="t-134167.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=134167">File Write Access check wont always work..</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Balder</div><div class="date">3rd May 2003, 21:58</div></div><div class="posttext">Hi!<br />
I use this method to check if I can start overwriting a exe:<br />
-----------<br />
StrCpy $1 0<br />
<br />
loop:<br />
  FileOpen $0 &quot;$EXEDIR\MYEXE.EXE&quot; &quot;w&quot;<br />
  IfErrors 0 done<br />
    IntOp $1 $1 + 1<br />
    IntCmpU $1 50 done 0 done # if we got to 50 or passed it, enough<br />
    Sleep 500 # wait for 500ms<br />
    Goto loop<br />
done:<br />
  FileClose $0<br />
<br />
  File &quot;MYEXE.EXE&quot;<br />
------------<br />
Sometimes it works fine, but sometimes it doesn't. The EXE is suddenly 0 KB in size...<br />
<br />
Any ideas?<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd May 2003, 22:04</div></div><div class="posttext">Try removing the sleep bit. Maybe having sleep there is stopping FileOpen seeing the file as writable.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">3rd May 2003, 22:20</div></div><div class="posttext">If you want to try whether you can overwrite, you can also use SetOverwrite try and check the error flag.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Balder</div><div class="date">3rd May 2003, 23:29</div></div><div class="posttext">Thanks for the replies.<br />
SetOverwrite Try - worked just fine, TY!!<br />
<br />
Here is what I got in the end..<br />
<br />
----------<br />
Loop:<br />
  File &quot;MYEXE.EXE&quot;<br />
<br />
  IfErrors 0 Done<br />
    IntOp $1 $1 + 1<br />
    IntCmpU $1 50 Error 0 Done # if we got to 50 or passed it, enough<br />
    Sleep 500 # wait for 500ms<br />
    ClearErrors<br />
    GoTo Loop<br />
<br />
Error:<br />
  MessageBox MB_OK|MB_ICONSTOP &quot;Error message!&quot; <br />
<br />
Done:<br />
--------------<br />
<br />
Thanks again for the replies!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th May 2003, 15:06</div></div><div class="posttext">Just so you'll know next time, if the file was emptyed it means FileOpen didn't fail. You probably got an error because you didn't clean the error flag before you called FileOpen, and there was an error somewhere before FileOpen. It failed to reopen the file and looped 50 times because you only close the file after the loop is finished.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">7th May 2003, 15:59</div></div><div class="posttext">Before loop, put ClearErrors (if you haven't already!)<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>