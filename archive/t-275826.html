<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" PassDialog + Experience UI, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  PassDialog + Experience UI NSIS Discussion" />
	
	<title> PassDialog + Experience UI [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  PassDialog + Experience UI</div>
<hr />
<div class="pda"><a href="t-275826.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=275826">PassDialog + Experience UI</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kallan06</div><div class="date">13th August 2007, 08:24</div></div><div class="posttext">Hi all :D !<br />
<br />
I write you for an little problem.<br />
i use this bottom code and  when i call SerialPageShow function , my .exe crash ! why ? please help me <br />
<br />
<br />
<br />
<br />
<br />
#Include<br />
!include LogicLib.nsh<br />
!include &quot;XPUI.nsh&quot;<br />
!include &quot;Sections.nsh&quot;<br />
!include &quot;WinMessages.nsh&quot;<br />
<br />
<br />
<br />
;-----------------------------------------<br />
; General XPUI Settings<br />
XPStyle off<br />
#Splash screen bmp<br />
!define IMG_NAME INST_Mobilegov_SERVER_.bmp<br />
#Skin<br />
!define XPUI_WANSIS_SKIN Bliss<br />
!define XPUI_WANSIS_HEADERIMAGE<br />
#Color Text (white)<br />
!define XPUI_TEXT_COLOR FFFFFF<br />
!define XPUI_TEXT_LIGHTCOLOR FFFFFF<br />
#Color Licence text and BG<br />
!define XPUI_LICENSEBKCOLOR &quot;ffffff&quot;<br />
!define XPUI_BRANDINGTEXT_COLOR_FG &quot;000000&quot;<br />
#define radio button use for license agreement<br />
!define XPUI_LICENSEPAGE_RADIOBUTTONS<br />
!define XPUI_ABORTWARNING<br />
!define XPUI_DISABLEBG<br />
!define UI &quot;XPUI&quot;<br />
<br />
<br />
<br />
;-----------------------------------------<br />
; Installer Page(s)<br />
#page welcome 1<br />
!insertmacro XPUI_PAGE_WELCOME<br />
#license page<br />
LicenseLangString myLicenseData 1033 &quot;license_English.txt&quot;<br />
LicenseLangString myLicenseData 1036 &quot;license_French.txt&quot;<br />
!define MUI_PAGE_CUSTOMFUNCTION_SHOW ComponentsShow<br />
!insertmacro XPUI_PAGE_LICENSE &quot;$(myLicenseData)&quot;<br />
<br />
Page custom SerialPageShow SerialPageLeave<br />
<br />
# install compoment page<br />
!insertmacro XPUI_PAGE_COMPONENTS<br />
#Directory installation<br />
!insertmacro XPUI_PAGE_DIRECTORY<br />
#Confirm install<br />
!insertmacro XPUI_PAGE_INSTCONFIRM<br />
#install files<br />
!insertmacro XPUI_PAGE_INSTFILES<br />
!insertmacro XPUI_PAGE_FINISH<br />
!insertmacro XPUI_PAGE_ABORT<br />
<br />
<br />
<br />
## Displays the serial dialog<br />
Function SerialPageShow<br />
<br />
!insertmacro MUI_HEADER_TEXT &quot;Enter Serial Code&quot; &quot;Enter the software serial code to continue.&quot;<br />
<br />
PassDialog::Dialog Serial \<br />
/HEADINGTEXT 'Please enter the serial code located on the software CD case...' \<br />
/CENTER \<br />
/BOXDASH 12 70 4 '' \<br />
/BOXDASH 92 70 4 '' \<br />
/BOXDASH 172 70 4 '' \<br />
/BOXDASH 252 70 4 '' \<br />
/BOX 332 70 4 ''<br />
<br />
Pop $R0 # success, back, cancel or error<br />
<br />
FunctionEnd<br />
<br />
Function SerialPageLeave<br />
<br />
## Pop values from stack<br />
Pop $R0<br />
Pop $R1<br />
Pop $R2<br />
Pop $R3<br />
Pop $R4<br />
<br />
<br />
## A bit of validation<br />
<br />
StrCpy '$5' '$R0-$R1-$R2-$R3-$R4$\r$\n'<br />
StrCpy $6 0<br />
<br />
Loop:<br />
IntOp $6 $6 + 1<br />
StrCmp $6 500 Bad ;1 more than the # serials in file<br />
Push $6 ;line number to read from<br />
File /oname=$PLUGINSDIR\serial.txt &quot;Numbers.txt&quot;<br />
Push &quot;$PLUGINSDIR\serial.txt&quot; ;text file to read<br />
Call ReadFileLine<br />
Pop $0 ;output string (read from file.txt)<br />
StrCmp $0 $5 Good<br />
Goto Loop<br />
<br />
Bad:<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;The entered username or password is incorrect!&quot;<br />
Delete &quot;$PLUGINSDIR\serial.txt&quot;<br />
Abort<br />
<br />
Good:<br />
Delete &quot;$PLUGINSDIR\serial.txt&quot;<br />
FunctionEnd<br />
<br />
Function ReadFileLine<br />
Exch $0 ;file<br />
Exch<br />
Exch $1 ;line number<br />
Push $2<br />
Push $3<br />
<br />
FileOpen $2 $0 r<br />
StrCpy $3 0<br />
Loop:<br />
IntOp $3 $3 + 1<br />
ClearErrors<br />
FileRead $2 $0<br />
IfErrors +2<br />
StrCmp $3 $1 0 loop<br />
FileClose $2<br />
<br />
Pop $3<br />
Pop $2<br />
Pop $1<br />
Exch $0<br />
<br />
FunctionEnd<br />
<br />
<br />
<br />
thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kallan06</div><div class="date">14th August 2007, 10:05</div></div><div class="posttext">please help me :'( ! <br />
you have any idea why this function crash with experience UI ? <br />
<br />
Thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kallan06</div><div class="date">14th August 2007, 15:56</div></div><div class="posttext">Hi all :) !<br />
<br />
It's good with this code :) ! But when i click on 'cancel' button, he call the function SerialPageLeave instead of display the popup cancel.<br />
<br />
<br />
<br />
<br />
Name    &quot;Pass&quot;<br />
OutFile &quot;PassSerial.exe&quot;<br />
<br />
<br />
## Include headers<br />
!include XPUI.nsh<br />
!include LogicLib.nsh<br />
<br />
!define XPUI_ABORTWARNING<br />
## Pages<br />
<br />
  #page welcome 1<br />
!insertmacro XPUI_PAGE_WELCOME<br />
  #license page<br />
!insertmacro XPUI_PAGE_LICENSE &quot;license_English.txt&quot;<br />
 Page custom SerialPageShow SerialPageLeave<br />
<br />
  #Directory installation<br />
!insertmacro XPUI_PAGE_DIRECTORY<br />
	#Confirm install<br />
!insertmacro XPUI_PAGE_INSTCONFIRM<br />
  #install files<br />
!insertmacro XPUI_PAGE_INSTFILES<br />
!define XPUI_FINISHPAGE_RUN<br />
  # disable cancel button in finish<br />
!insertmacro XPUI_PAGE_FINISH<br />
  #Abord popup confirmation<br />
!insertmacro XPUI_PAGE_ABORT<br />
<br />
!insertmacro XPUI_LANGUAGE English<br />
<br />
## Displays the serial dialog<br />
Function SerialPageShow<br />
<br />
 ;!insertmacro MUI_HEADER_TEXT &quot;Enter Serial Code&quot; &quot;Enter the software serial code to continue.&quot;<br />
	;!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;serial.ini&quot;<br />
		!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;serial.ini&quot; <br />
<br />
	;!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;serial.ini&quot; <br />
 ; Pop $R0 # success, back, cancel or error<br />
<br />
FunctionEnd<br />
<br />
Function .onInit<br />
<br />
  ;Extract InstallOptions files<br />
  ;$PLUGINSDIR will automatically be removed when the installer closes<br />
  <br />
  InitPluginsDir<br />
 !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;serial.ini&quot;<br />
  <br />
FunctionEnd<br />
<br />
## Validate serial numbers<br />
Function SerialPageLeave<br />
<br />
 ## Pop values from stack<br />
 Pop $R0<br />
 Pop $R1<br />
 Pop $R2<br />
 Pop $R3<br />
 Pop $R4<br />
<br />
<br />
 ## A bit of validation<br />
 !insertmacro XPUI_INSTALLOPTIONS_READ $R0 &quot;serial.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
 !insertmacro XPUI_INSTALLOPTIONS_READ $R1 &quot;serial.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
 !insertmacro XPUI_INSTALLOPTIONS_READ $R2 &quot;serial.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
 !insertmacro XPUI_INSTALLOPTIONS_READ $R3 &quot;serial.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
 !insertmacro XPUI_INSTALLOPTIONS_READ $R4 &quot;serial.ini&quot; &quot;Field 6&quot; &quot;State&quot;<br />
<br />
<br />
;StrCpy '$5' '$R0-$R1-$R2-$R3-$R4'<br />
StrCpy '$5' '$R0-$R1-$R2-$R3-$R4$\r$\n'<br />
StrCpy $6 0<br />
<br />
Loop:<br />
IntOp $6 $6 + 1<br />
StrCmp $6 500 Bad ;1 more than the # serials in file<br />
Push $6 ;line number to read from <br />
File /oname=$PLUGINSDIR\serial.txt &quot;Numbers.txt&quot;<br />
Push &quot;$PLUGINSDIR\serial.txt&quot; ;text file to read <br />
Call ReadFileLine <br />
Pop $0 ;output string (read from file.txt) <br />
StrCmp $0 $5 Good<br />
Goto Loop<br />
<br />
Bad:<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;The entered username or password is incorrect!&quot;<br />
Delete &quot;$PLUGINSDIR\serial.txt&quot;<br />
Abort<br />
<br />
Good:<br />
Delete &quot;$PLUGINSDIR\serial.txt&quot;<br />
FunctionEnd<br />
<br />
Function ComponentsPageShow<br />
<br />
 ## Disable the Back button<br />
 GetDlgItem $R0 $HWNDPARENT 3<br />
 EnableWindow $R0 0<br />
<br />
FunctionEnd<br />
<br />
Function ReadFileLine<br />
Exch $0 ;file<br />
Exch<br />
Exch $1 ;line number<br />
Push $2<br />
Push $3<br />
<br />
  FileOpen $2 $0 r<br />
 StrCpy $3 0<br />
Loop:<br />
 IntOp $3 $3 + 1<br />
  ClearErrors<br />
  FileRead $2 $0<br />
  IfErrors +2<br />
 StrCmp $3 $1 0 loop<br />
  FileClose $2<br />
<br />
Pop $3<br />
Pop $2<br />
Pop $1<br />
Exch $0<br />
<br />
FunctionEnd<br />
<br />
## Just a dummy section<br />
Section 'A section'<br />
SectionEnd<br />
<br />
 <br />
<br />
serial.ini<br />
 <br />
<br />
[Settings]<br />
NumFields=10<br />
<br />
[Field 1]<br />
Type=Label<br />
Text=Label<br />
Left=12<br />
Right=265<br />
Top=42<br />
Bottom=61<br />
<br />
[Field 2]<br />
Type=Text<br />
MaxLen=4<br />
Left=18<br />
Right=58<br />
Top=70<br />
Bottom=81<br />
<br />
[Field 3]<br />
Type=Text<br />
MaxLen=4<br />
Left=70<br />
Right=110<br />
Top=70<br />
Bottom=81<br />
<br />
[Field 4]<br />
Type=Text<br />
MaxLen=4<br />
Left=120<br />
Right=160<br />
Top=70<br />
Bottom=81<br />
<br />
[Field 5]<br />
Type=Text<br />
MaxLen=4<br />
Left=170<br />
Right=210<br />
Top=70<br />
Bottom=81<br />
<br />
[Field 6]<br />
Type=Text<br />
MaxLen=4<br />
Left=220<br />
Right=260<br />
Top=70<br />
Bottom=81<br />
<br />
[Field 7]<br />
Type=Label<br />
Text=-<br />
Left=64<br />
Right=66<br />
Top=70<br />
Bottom=78<br />
<br />
[Field 8]<br />
Type=Label<br />
Text=-<br />
Left=114<br />
Right=116<br />
Top=70<br />
Bottom=78<br />
<br />
[Field 9]<br />
Type=Label<br />
Text=-<br />
Left=164<br />
Right=166<br />
Top=70<br />
Bottom=78<br />
<br />
[Field 10]<br />
Type=Label<br />
Text=-<br />
Left=214<br />
Right=216<br />
Top=70<br />
Bottom=78<br />
<br />
 <br />
<br />
you have any idea please ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kallan06</div><div class="date">16th August 2007, 11:06</div></div><div class="posttext">nobody wants to help me :'(<br />
<br />
I've just a last question, it's possible to past at next box when a box has 4 characters ?<br />
Example : &quot;aaaa&quot; next box &quot;aaaa&quot; ...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>