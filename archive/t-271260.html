<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" DeleteRegKey problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  DeleteRegKey problem NSIS Discussion" />
	
	<title> DeleteRegKey problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  DeleteRegKey problem</div>
<hr />
<div class="pda"><a href="t-271260.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=271260">DeleteRegKey problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">selanac</div><div class="date">16th May 2007, 18:20</div></div><div class="posttext">I'm attempting to clean up previous installations detected in the config section. If detected I attempt to clean up a particular registry entry with:<br />
<br />
DeleteRegKey HKCU &quot;Environment\E3ROOT&quot;<br />
<br />
This fails and I don't know why. The entry does in fact exist, and I have admin priveleges. Is there a way to get more details on the cause of the error?<br />
<br />
Script:<br />
<br />
# Auto-generated by EclipseNSIS Script Wizard<br />
# Apr 13, 2007 4:02:47 PM<br />
<br />
Name E3<br />
<br />
# Defines<br />
!define REGKEY &quot;SOFTWARE\$(^Name)&quot;<br />
!define VERSION 4.0<br />
!define COMPANY UC<br />
!define URL &quot;&quot;<br />
<br />
# MUI defines<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-install.ico&quot;<br />
!define MUI_FINISHPAGE_NOAUTOCLOSE<br />
!define MUI_STARTMENUPAGE_REGISTRY_ROOT HKLM<br />
!define MUI_STARTMENUPAGE_NODISABLE<br />
!define MUI_STARTMENUPAGE_REGISTRY_KEY ${REGKEY}<br />
!define MUI_STARTMENUPAGE_REGISTRY_VALUENAME StartMenuGroup<br />
!define MUI_STARTMENUPAGE_DEFAULTFOLDER E3<br />
!define MUI_UNICON &quot;${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico&quot;<br />
!define MUI_UNFINISHPAGE_NOAUTOCLOSE<br />
<br />
# Included files<br />
!include Sections.nsh<br />
!include MUI.nsh<br />
<br />
# Variables<br />
Var StartMenuGroup<br />
<br />
# Installer pages<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_STARTMENU Application $StartMenuGroup<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
!insertmacro MUI_UNPAGE_INSTFILES<br />
<br />
# Installer languages<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
# Installer attributes<br />
OutFile setup.exe<br />
InstallDir $PROGRAMFILES\E3<br />
CRCCheck on<br />
XPStyle on<br />
ShowInstDetails show<br />
VIProductVersion 4.0.0.0<br />
VIAddVersionKey ProductName E3<br />
VIAddVersionKey ProductVersion &quot;${VERSION}&quot;<br />
VIAddVersionKey CompanyName &quot;${COMPANY}&quot;<br />
VIAddVersionKey FileVersion &quot;&quot;<br />
VIAddVersionKey FileDescription &quot;&quot;<br />
VIAddVersionKey LegalCopyright &quot;&quot;<br />
InstallDirRegKey HKLM &quot;${REGKEY}&quot; Path<br />
ShowUninstDetails show<br />
<br />
# Installer sections<br />
Section -Main SEC0000<br />
    SetOutPath $INSTDIR\standalone<br />
    SetOverwrite on<br />
    File /r deploy\standalone\*<br />
    WriteRegStr HKLM &quot;${REGKEY}\Components&quot; Main 1<br />
SectionEnd<br />
<br />
Section -post SEC0001<br />
    WriteRegStr HKLM &quot;${REGKEY}&quot; Path $INSTDIR<br />
    SetOutPath $INSTDIR<br />
    WriteUninstaller $INSTDIR\uninstall.exe<br />
    !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
    SetOutPath $SMPROGRAMS\$StartMenuGroup<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot; $INSTDIR\uninstall.exe<br />
    !insertmacro MUI_STARTMENU_WRITE_END<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayName &quot;$(^Name)&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayVersion &quot;${VERSION}&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; Publisher &quot;${COMPANY}&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayIcon $INSTDIR\uninstall.exe<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; UninstallString $INSTDIR\uninstall.exe<br />
    WriteRegDWORD HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; NoModify 1<br />
    WriteRegDWORD HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; NoRepair 1<br />
SectionEnd<br />
<br />
Section -config SEC0002<br />
    SetOutPath $INSTDIR\standalone<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Case Manager .lnk&quot; $INSTDIR\standalone\E3CaseManager.cmd<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Utility Window .lnk&quot; $INSTDIR\standalone\E3UtilityWindow.cmd<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Admin Tool .lnk&quot; $INSTDIR\standalone\E3AdminTool.cmd<br />
    SetOutPath $PROFILE\e3.config<br />
     IfFileExists $PROFILE\e3.config\e3commonPrefs.xml 0 +4<br />
        MessageBox MB_OK &quot;Detected previous E3 installation... Cleaning up&quot;<br />
        Delete $PROFILE\e3.config\e3commonPrefs.xml<br />
        DeleteRegKey HKCU &quot;Environment\E3ROOT&quot;<br />
        IfErrors 0 +2<br />
          MessageBox MB_OK &quot;Error in DeleteRegKey&quot;<br />
    ClearErrors<br />
    FileOpen $0 $PROFILE\e3.config\e3commonPrefs.xml w<br />
    FileWrite $0 '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;$\n'<br />
    FileWrite $0 '&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;$\n'<br />
    FileWrite $0 &quot;&lt;properties&gt;$\n&quot;<br />
    FileWrite $0 &quot;&lt;comment&gt;E3 Common Preferences&lt;/comment&gt;$\n&quot;<br />
    FileWrite $0 '&lt;entry key=&quot;E3Home&quot;&gt;'<br />
    FileWrite $0 $INSTDIR<br />
    FileWrite $0 &quot;\standalone&quot;<br />
    FileWrite $0 &quot;&lt;/entry&gt;$\n&quot;<br />
    FileWrite $0 &quot;&lt;/properties&gt;$\n&quot;<br />
    FileClose $0<br />
SectionEnd<br />
<br />
# Macro for selecting uninstaller sections<br />
!macro SELECT_UNSECTION SECTION_NAME UNSECTION_ID<br />
    Push $R0<br />
    ReadRegStr $R0 HKLM &quot;${REGKEY}\Components&quot; &quot;${SECTION_NAME}&quot;<br />
    StrCmp $R0 1 0 next${UNSECTION_ID}<br />
    !insertmacro SelectSection &quot;${UNSECTION_ID}&quot;<br />
    GoTo done${UNSECTION_ID}<br />
next${UNSECTION_ID}:<br />
    !insertmacro UnselectSection &quot;${UNSECTION_ID}&quot;<br />
done${UNSECTION_ID}:<br />
    Pop $R0<br />
!macroend<br />
<br />
# Uninstaller sections<br />
Section /o un.Main UNSEC0000<br />
    RmDir /r /REBOOTOK $INSTDIR\standalone<br />
    DeleteRegValue HKLM &quot;${REGKEY}\Components&quot; Main<br />
SectionEnd<br />
<br />
Section un.post UNSEC0001<br />
    DeleteRegKey HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot;<br />
    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\Case Manager .lnk&quot;<br />
    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\Utility Window .lnk&quot; <br />
    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\Admin Tool .lnk&quot;<br />
    Delete /REBOOTOK &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot;<br />
    Delete /REBOOTOK $INSTDIR\uninstall.exe<br />
    Delete $PROFILE\e3.config\e3commonPrefs.xml<br />
    DeleteRegKey /ifempty HKCU &quot;Environment\E3ROOT&quot;<br />
    DeleteRegKey HKCU &quot;Environment\MODTRAN_DATA&quot;<br />
    DeleteRegKey HKCU &quot;Environment\MODTRAN5_DATA&quot;<br />
    DeleteRegValue HKLM &quot;${REGKEY}&quot; StartMenuGroup<br />
    DeleteRegValue HKLM &quot;${REGKEY}&quot; Path<br />
    DeleteRegKey /IfEmpty HKLM &quot;${REGKEY}\Components&quot;<br />
    DeleteRegKey /IfEmpty HKLM &quot;${REGKEY}&quot;<br />
    RmDir /REBOOTOK $SMPROGRAMS\$StartMenuGroup<br />
    RmDir /REBOOTOK $INSTDIR<br />
SectionEnd<br />
<br />
# Installer functions<br />
Function .onInit<br />
    InitPluginsDir<br />
FunctionEnd<br />
<br />
<br />
# Uninstaller functions<br />
Function un.onInit<br />
    ReadRegStr $INSTDIR HKLM &quot;${REGKEY}&quot; Path<br />
    !insertmacro MUI_STARTMENU_GETFOLDER Application $StartMenuGroup<br />
    !insertmacro SELECT_UNSECTION Main ${UNSEC0000}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th May 2007, 18:25</div></div><div class="posttext">Seems like E3ROOT is a value and not a key. You should use DeleteRegValue.DeleteRegValue HKCU Environment E3ROOT</div></div><hr />


<div class="post"><div class="posttop"><div class="username">selanac</div><div class="date">16th May 2007, 19:22</div></div><div class="posttext">kichik, <br />
Thanks alot, that was it. Pardon my ignorance, it's my first attempt with NSIS, chaulk it up to newbee-ism.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>