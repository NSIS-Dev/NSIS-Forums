<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" registry access (vista?), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  registry access (vista?) NSIS Discussion" />
	
	<title> registry access (vista?) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  registry access (vista?)</div>
<hr />
<div class="pda"><a href="t-266934.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=266934">registry access (vista?)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">2nd March 2007, 11:49</div></div><div class="posttext">Hello All!<br />
<br />
I have two questions. One should be a quickie:<br />
<br />
1) What would be the most simple and elegant way to determine whether a user has write access to the registry (for example, to create an uninstall entry) at the beginning of the setup?<br />
<br />
I have been reading some strange posts on this forum that deal with putting shortcuts on the desktop and placing them in the startmenu group under Vista. I haven't had a chance to try out Vista. My second question (based on XP) is:<br />
<br />
2) What exactly are the differences/problems?<br />
<br />
If still possible, I would use &quot;UserInfo::GetAccountType&quot; together with &quot;SetShellVarContext&quot;. Will I be okay?<br />
<br />
To expand on this a little, an administrator will have a checkbox for installing shortcut icons for all users or for the current user. Other users must make do with installing the icons for themselves only.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">2nd March 2007, 15:45</div></div><div class="posttext">For #1:<br />
A quick test would be to write something to the registry and then check for errors.  If errors, you probably don't have access.  (You should then probably try to delete what you just wrote just to keep things clean.)<br />
<br />
For #2:<br />
I wouldn't see a problem with what you suggest.  <br />
<br />
Finally for Vista:<br />
You should make sure you include RequestExecutionLevel and set it to something other than &quot;none&quot;.  The reason is that this will add a manifest into the install and guarantee that the registry virtulization feature in Vista is disabled.<br />
<br />
If you have not done so already, you should really read up on UAC (user account control) (http://technet.microsoft.com/en-us/windowsvista/aa906021.aspx) in Vista.<br />
<br />
Also search the forums for Vista-related info.  There's been quite a few threads about that lately.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">2nd March 2007, 16:06</div></div><div class="posttext">Thx. I'll take your advice and do some more reading.<br />
<br />
Is what you are basically saying that you would only need an extra line of code and everything will work in Windows Vista as it does in XP?<br />
<br />
If it gets much more complicated, maybe it would be best to just upgrade to Vista and test the scenarios. So I ask.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">3rd March 2007, 01:10</div></div><div class="posttext">Is what you are basically saying that you would only need an extra line of code and everything will work in Windows Vista as it does in XP?<br />
For the most part, yes.  But as I'm finding on my own, there may be a few quirky things you could run into as a result of UAC and some of Vista's virtualization (used for registry and folders under certain situtions where the user doens't have full permissions.)<br />
<br />
You may find that having a Vista machine to play with might help spot potential problems. ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">4th March 2007, 18:09</div></div><div class="posttext">In preparing myself for the transition to Vista, I'm attempting something probably pretty asinine, but if getting this to work in XP is possible, I'd be happy temporarily.<br />
<br />
Run setup 2x:<br />
2 installations<br />
2 destinations<br />
2 uninstallers<br />
for which there are 2 registry entries<br />
under HKLM and the other is under HKCU.<br />
<br />
The problem is telling the uninstaller which installation to uninstall, the HKLM one or the HKCU one. The uninstall registry values that specify the install path can be read at runtime, but there are 2. Which one refers to the path you want to remove when clicking on the uninstaller?<br />
<br />
Put differently, how does the uninstaller retrieve a variable for the particular instance that is unique?<br />
<br />
It occurs to me to include a file with one or the other setup. If found, the uninstaller would target the right instance, however isn't there an easier way?<br />
<br />
The uninstall file needs to know which registry entry it was installed with.<br />
<br />
Maybe I can figure something out to do that, but if someone has any suggestions, that would be superb.<br />
<br />
Thx.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">4th March 2007, 19:47</div></div><div class="posttext">A neat trick might be to have uninst.exe return its own location. Then you could compare the location to the registry uninstall string.<br />
<br />
IfThisFileExists???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">5th March 2007, 02:22</div></div><div class="posttext">I've been looking too hard.<br />
<br />
$INSTDIR\uninst.exe is the uninstaller location. I thought $INSTDIR had to be stored somewhere, but the uninstaller remembers it. That means for every install path the uninstaller generated is distinct, and you can read the registry to check the install path. If $INSTDIR\uninst.exe and the uninstall string are a match, the correct instance will be uninstalled.<br />
<br />
Phew...<br />
<br />
I gather, perhaps mistakenly, that among Vista's quirks, it may be expedient to write uninstall keys to HKCU; I'm keeping my fingers crossed this will be useful later.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>