<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Using InstallDirRegKey twice, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Using InstallDirRegKey twice NSIS Discussion" />
	
	<title> Using InstallDirRegKey twice [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Using InstallDirRegKey twice</div>
<hr />
<div class="pda"><a href="t-271410.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=271410">Using InstallDirRegKey twice</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BobL</div><div class="date">19th May 2007, 05:15</div></div><div class="posttext">Hi all,<br />
<br />
I have searched the board but can't find an answer, so here goes....<br />
<br />
I need to read a reg key to set the $INSTDIR variable, then compare it with the default $INSTDIR variable which I am setting earlier.  If they are the same, then I know that the reg key does not exist (or the value could be the same), so I have to read another reg key for the install path.  I am doing this because previous versions of the software put the InstallDir key in the HKCU but current versions put it in HKLM.  So, I have to check HKCU first.  If a value is read from that key, then I don't need to check the HKLM.<br />
<br />
Here's my script:<br />
<br />
; set the default<br />
InstallDir &quot;$PROGRAMFILES\${MUI_APPNAME}&quot;<br />
<br />
; read from my HKCU reg key<br />
InstallDirRegKey HKCU &quot;SOFTWARE\${MUI_APPNAME}&quot; &quot;InstallDir&quot;<br />
<br />
; compare the reg key to my default<br />
; if they are the same, the reg key doesn't exist...<br />
StrCmp $INSTDIR &quot;$PROGRAMFILES\${MUI_APPNAME}&quot; 0<br />
<br />
   ; ... so read the reg key from the HKLM root<br />
    InstallDirRegKey HKLM &quot;SOFTWARE\${MUI_APPNAME}&quot; &quot;InstallDir&quot;<br />
<br />
But, I get compilation errors because StrCmp must be in a Section or Function.  But if I put all of that in a section or function, I get compilation errors because the InstallDir... commands can't be in sections or functions!<br />
<br />
The following doesn't work either:<br />
<br />
InstallDir &quot;$PROGRAMFILES\${MUI_APPNAME}&quot;<br />
InstallDirRegKey HKCU &quot;SOFTWARE\${MUI_APPNAME}&quot; &quot;InstallDir&quot;<br />
InstallDirRegKey HKLM &quot;SOFTWARE\${MUI_APPNAME}&quot; &quot;InstallDir&quot;<br />
<br />
If the HKLM key doesn't exist, it always uses the default $INSTDIR, so it's as if the HKCU key value doesn't matter.<br />
<br />
Is there a way to do this?<br />
<br />
Thanks,<br />
<br />
Bob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BobL</div><div class="date">19th May 2007, 05:55</div></div><div class="posttext">Hi,<br />
<br />
I think I figured it out. Instead of using InstallDirRegKey, I used ReadRegStr because I can use it in a section.<br />
<br />
So here is my code:<br />
<br />
Section GetInstDir<br />
<br />
; read the HKCU reg value<br />
  ReadRegStr $0 HKCU &quot;SOFTWARE\${MUI_APPNAME}&quot; &quot;InstallDir&quot;<br />
<br />
; if the value is empty...<br />
  StrCmp $0 &quot;&quot; 0 dirfound<br />
<br />
; ... read the HKLM reg value<br />
     ReadRegStr $0 HKLM &quot;SOFTWARE\${MUI_APPNAME}&quot; &quot;InstallDir&quot;<br />
<br />
; if that value is empty...<br />
  StrCmp $0 &quot;&quot; 0 dirfound<br />
<br />
; ... use the default value<br />
     StrCpy $0 &quot;$PROGRAMFILES\${MUI_APPNAME}&quot;<br />
<br />
  dirfound:<br />
; copy the value into $INSTDIR<br />
  StrCpy $INSTDIR $0<br />
<br />
SectionEnd<br />
<br />
This seems to give me the results I want, but if anyone has a better way, or if you see a problem with this, please let me know.<br />
<br />
Thanks,<br />
<br />
Bob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th May 2007, 11:31</div></div><div class="posttext">It might be better to use it in .onInit in case you decide to use a directory page.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>