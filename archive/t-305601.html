<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ConfigRead to remember radiobutton settings?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ConfigRead to remember radiobutton settings? NSIS Discussion" />
	
	<title> ConfigRead to remember radiobutton settings? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ConfigRead to remember radiobutton settings?</div>
<hr />
<div class="pda"><a href="t-305601.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305601">ConfigRead to remember radiobutton settings?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">22nd April 2009, 10:19</div></div><div class="posttext">Can ConfigRead be used to remember a user's choices from several pages of radio buttons?<br />
<br />
The goal is this: <br />
<br />
An installer contains 12 custom pages, each with 3 to 5 radiobuttons or checkboxes. At present, each time the installer is run, the default selections for each page are ticked and these must be changed by the user every time. I would like the user's choices on each page to become the defaults the next time the installer is run. <br />
<br />
Creating an extra file to hold the choices in the installation directory is fine, but I would like to avoid writing to the registry. Is ConfigRead what I want for this? How do I translate the values it reads into &quot;states&quot; for the radio button and checkbox pages?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">22nd April 2009, 15:22</div></div><div class="posttext">ConfigRead and ConfigWrite are certainly two options.  However, you could also just as well use ReadINIStr and WriteINIStr , reading from / writing to a .ini style file.<br />
<br />
As for getting the values out to your actual dialogs - first things first.. do you use IntallOptions(2/Ex) or nsDialogs?<br />
<br />
For the installOptions variety, write to the .ini file that specifies the custom page dialog, setting the State value of the appropriate radiobuttons/checkboxes based on what you read from the settings.<br />
<br />
For nsDialogs, use the ${NSD_SetState} functionality.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">22nd April 2009, 16:28</div></div><div class="posttext">Originally posted by Animaether <br />
As for getting the values out to your actual dialogs - first things first.. do you use IntallOptions(2/Ex) or nsDialogs?<br />
 <br />
<br />
I'm using MUI with InstallOptions. I am using WriteIniStr in my custom pages like this:<br />
<br />
WriteIniStr &quot;$PLUGINSDIR\custom1b.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;0&quot; <br />
<br />
and then reading it back like this:<br />
<br />
ReadINIStr $0 &quot;$PLUGINSDIR\custom1b.ini&quot; &quot;field 2&quot; &quot;state&quot;<br />
<br />
but this only persists during single installation sessions. To make these choices persist between sessions, is the solution to use the same system as above, but instead of reading and writing to $PLUGINSDIR to write to a folder within the installation? Would replacing $PLUGINSDIR with something like $INSTDIR\cfg\ work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">22nd April 2009, 18:10</div></div><div class="posttext">yes, to both your questions, but I wouldn't really really use it in that fashion as the installation folder will then have the raw dialog settings.. I'd use parallel WriteIniStr's when saving a setting, and...<br />
1. read from the installation folder ini once<br />
2. read from the pluginsdir one after that.<br />
<br />
so you would have something like...<br />
<br />
WriteIniStr &quot;$PLUGINSDIR\custom1b.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;0&quot;<br />
WriteIniStr &quot;$INSTDIR\installsettings.ini&quot; &quot;main settings&quot; &quot;do something&quot; &quot;0&quot;<br />
<br />
<br />
and<br />
<br />
<br />
${If} ${FileExists} &quot;$PLUGINSDIR\custom1b.ini&quot;<br />
; if that file exists, we'll read from it<br />
ReadINIStr $0 &quot;$PLUGINSDIR\custom1b.ini&quot; &quot;main settings&quot; &quot;do something&quot;<br />
${Else}<br />
; otherwise, we'll extract that file for future use<br />
; do the MUI_INSTALLOPTIONS_EXTRACT bit here<br />
; but we'll be reading from the file in the installation dir<br />
; ( you'll want to make sure it exists, of course )<br />
ReadINIStr $0 &quot;$INSTDIR\installsettings.ini&quot; &quot;main settings&quot; &quot;do something&quot;<br />
${EndUnless}<br />
<br />
off the top of my head - don't have NSIS here at the moment</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">22nd April 2009, 19:07</div></div><div class="posttext">Interesting! I will have to do some tests and try to figure this out. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">23rd April 2009, 10:51</div></div><div class="posttext">I have not been able to get this to work. Writing the ini file is very simple, but I don't understand how to read from it and then take action.<br />
<br />
So, let me go through it step by step:<br />
<br />
At the top of my file I begin with this (formatting lines removed for clarity):<br />
<br />
Function .onInit<br />
InitPluginsDir<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;settings&quot; &quot;numfields&quot; &quot;2&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;0&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;1&quot;<br />
FunctionEnd<br />
<br />
Then in the page itself I have this:<br />
<br />
section &quot;Section 1&quot; SEC01<br />
ReadINIStr $0 &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot;<br />
StrCmp $0 1 0 +4<br />
[Commands to write a file are here]<br />
WriteIniStr &quot;$INSTDIR\cfg\installsettings.ini&quot; &quot;setting 1&quot; &quot;state&quot; &quot;1&quot;<br />
goto next<br />
ReadINIStr $0 &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;state&quot;<br />
StrCmp $0 1 0 +4<br />
[Commands to write a file are here]<br />
WriteIniStr &quot;$INSTDIR\cfg\installsettings.ini&quot; &quot;setting 1&quot; &quot;state&quot; &quot;2&quot;<br />
next:<br />
sectionend<br />
<br />
function customcreate0<br />
InstallOptions::Dialog &quot;$PLUGINSDIR\custom.ini&quot;<br />
pop $0<br />
functionend<br />
<br />
Where do I perform the check on my installsettings.ini? Should it be within the Function .onInit?<br />
Placing the comparison within the &quot;Section 1&quot; area would seem to force the installer to take the same action it took last time, which isn't the goal. I only want to show which of the two options was chosen before.<br />
<br />
The comparison I am trying to use is this:<br />
<br />
${If} ${FileExists} &quot;$INSTDIR\cfg\installsettings.ini&quot;<br />
ReadINIStr $0 &quot;$INSTDIR\cfg\installsettings.ini&quot; &quot;setting 1&quot; &quot;state&quot;<br />
StrCmp $0 1 0 +3<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;1&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;0&quot;<br />
${Else}<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;0&quot;<br />
${EndUnless}<br />
<br />
I realise this comparison is in the opposite direction of the example suggested above, but doesn't it make more sense to make the PLUGINSDIR the default option and only change this if the installsettings.ini exists?<br />
<br />
Any help would be greatly appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd April 2009, 12:09</div></div><div class="posttext">Your StrCmp is not correct. What if $0 is 1? Both your WriteINIStr statements will be executed. If $0 is not 1, neither will execute (+3 jumps over both).<br />
<br />
Instead of using a StrCmp why not just use another nested If...Else...EndIf?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fitzroy_doll</div><div class="date">23rd April 2009, 12:50</div></div><div class="posttext">Originally posted by Afrow UK <br />
Your StrCmp is not correct. What if $0 is 1? Both your WriteINIStr statements will be executed. If $0 is not 1, neither will execute (+3 jumps over both).<br />
<br />
Instead of using a StrCmp why not just use another nested If...Else...EndIf?<br />
<br />
Stu  <br />
<br />
Yes, that was all wrong. This, however, seems to work (4 radiobutton fields with field 2 checked as the default):<br />
<br />
function customcreate0<br />
${If} ${FileExists} &quot;$INSTDIR\cfg\installsettings.ini&quot;<br />
ReadINIStr $0 &quot;$INSTDIR\cfg\installsettings.ini&quot; &quot;setting 1&quot; &quot;state&quot;<br />
           ${If} $0 == &quot;1&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;1&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 3&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 4&quot; &quot;state&quot; &quot;0&quot;<br />
           ${ElseIf} $0 == &quot;3&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 3&quot; &quot;state&quot; &quot;1&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 4&quot; &quot;state&quot; &quot;0&quot;<br />
           ${ElseIf} $0 == &quot;4&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 3&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 4&quot; &quot;state&quot; &quot;1&quot;<br />
           ${Else}<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;1&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 3&quot; &quot;state&quot; &quot;0&quot;<br />
           WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 4&quot; &quot;state&quot; &quot;0&quot;<br />
           ${EndIf}<br />
${Else}<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 1&quot; &quot;state&quot; &quot;0&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 2&quot; &quot;state&quot; &quot;1&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 3&quot; &quot;state&quot; &quot;0&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\custom.ini&quot; &quot;field 4&quot; &quot;state&quot; &quot;0&quot;<br />
${EndIf}<br />
!insertmacro MUI_HEADER_TEXT $(INSTALL_PAGE_8) $(INSTALL_PAGE_8b)<br />
InstallOptions::Dialog &quot;$PLUGINSDIR\custom.ini&quot;<br />
pop $0<br />
functionend<br />
<br />
This reads from an ini file written by the installer as per my previous post. The missing piece was where to put the test that checks the previous settings, the answer being in the function that creates the page - not the section.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>