<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" external DLL, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  external DLL NSIS Discussion" />
	
	<title> external DLL [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  external DLL</div>
<hr />
<div class="pda"><a href="t-137809.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=137809">external DLL</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">4th June 2003, 11:10</div></div><div class="posttext">OK. this is a little hard to explain.<br />
<br />
i have a custom page with 2 textbox. (from an .ini file)<br />
1. the user enters a code in every one of them.<br />
2. when next button is pressed:<br />
3. the content of the both textbox is stored in variables or constants (?)<br />
4. i must use this variables/constants to validate the codes. something like this, with a function:<br />
<br />
function ValidateSerialNumber(myFile, User, Orgn, , , , PrivateKey, Serial: String): Boolean;<br />
<br />
 and then to call the DLL. i found in documentation that is something like this:<br />
<br />
System::Call 'YourDllName::YourDllFunction(i, *i, t) i(.r0, r1, .r2) .r3'<br />
<br />
5. if the codes are not correct the user is not allowed to move on.<br />
<br />
if you have any ideas how to do this, tell me, please,<br />
<br />
becuase i have no idea.:igor:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">4th June 2003, 12:48</div></div><div class="posttext">You can use the System plug-in to call your DLL, but maybe it's easier to create a NSIS plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">4th June 2003, 13:05</div></div><div class="posttext">sorry! you lost me...i am reding the system readme, but noy understanding a thing.<br />
<br />
let's do this step by step:<br />
how do i take the content of the both textbox and store them in variables or constants (?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ramon18</div><div class="date">4th June 2003, 14:01</div></div><div class="posttext">Note that you must implement a dll ( for this example is &quot;MyExternDLL.dll&quot; with export &quot;ValidateUser&quot;) and store the dll in NSISDIR\Plugins<br />
<br />
Just use some source code from other plugin (NSISDIR\Contrib) so that you can start and change the code<br />
<br />
You can debug easily if using VC++, just change project settings and choose your output setup.exe as &quot;Executable for debug session&quot;<br />
<br />
Good luck<br />
Ramon</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th June 2003, 20:20</div></div><div class="posttext">A better way would be checking the leave function. See the example in Contrib\InstallOptions\test.nsi. It does exactly this.<br />
<br />
As for the DLL, you didn't write it right? Do you have the source code for it? If you don't then you'll need to call it using System. Show me the function prototype and I'll help you writing a System::Call line. If you do, then you might want to consider compiling a NSIS plug-in version so it'll be easier to call.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">5th June 2003, 08:22</div></div><div class="posttext">thanks, again, for helping, <br />
<br />
ok. i checked the &quot;Contrib\InstallOptions\test.nsi&quot; script. i have now the codes entered by the user in 2 variables (from the textboxes).<br />
<br />
as for the DLL, i did not write it, i do not have the source code.<br />
i don't know what you mean by &quot;function prototype&quot;. if you are talking about what i made so far, no problem. but until now i have only a custom page with 2 textbox. (btw: one textbox, two textboxes ?, my english is not so good)<br />
<br />
&quot;function ValidateSerialNumber(myFile, User, Orgn, , , , PrivateKey, Serial: String): Boolean;&quot;, this is taken from the DLL readme.<br />
<br />
myFile - is encrypted file (i have it) - OK.<br />
user and orgn - user name, organization name (automatic inside the installer). - OK.<br />
PrivateKey and Serial - the 2 textboxes. - OK.<br />
<br />
all i have to do now is to call the DLL with all this parameters. the DLL returns true or false. if its false, the user will not be allowed to pass.<br />
<br />
to compile a NSIS plugin version? no problem. if it works...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th June 2003, 14:38</div></div><div class="posttext">&quot;function ValidateSerialNumber(myFile, User, Orgn, , , , PrivateKey, Serial: String): Boolean;&quot; is the function prototype, but it doesn't make sense to me. Is another line that looks like that in the readme? Something with char* or LPSTR? Will you be able to attach the readme or mail it to me privately?<br />
<br />
If you haven't written the DLL and you don't have the source you can't compile it as a NSIS plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">5th June 2003, 15:41</div></div><div class="posttext">hello!<br />
<br />
after a few hours spent in &quot;The Archive&quot; and readme files, it's a little better. i can say i'm begining to understand what you're talking about.<br />
<br />
yes, there were some stuff there. i will attach it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th June 2003, 16:28</div></div><div class="posttext">According to this program's readme (download from http://www.mjfreelancing.com/) the call should be:<br />
<br />
System::Call &quot;ISID::ValidateSerialNumber(t, t, t, t, t, t, t, t) i ('keypath', 'user', 'orgn', '', '', '', 'user private key', 'user serial') .s&quot;<br />
Pop $0<br />
<br />
$0 contains the result.<br />
<br />
Make sure the DLL is somewhere System.dll can find it (the current directory set by SetOutPath for example). The best way would probably be extracting the DLL to $PLUGINSDIR and using SetOutPath $PLUGINSDIR.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">6th June 2003, 06:50</div></div><div class="posttext">i tried to make it work, but no. sorry<br />
<br />
i will attach my script, but i cannot attach the DLL, is about 1.3MB. download it from - see above.<br />
<br />
my condition after the DLL sytem call is not good, if you do not enter the right codes you cannot exit the program. even if you press back or cancel.<br />
<br />
and even in the System::call line i did something wrong. the DLL always returns &quot;0&quot; or &quot;false&quot; - if i change from &quot;i&quot; (int) to b(boolean). and the codes are good. i checked. too make it easy i enetered the codes in the ini file.<br />
<br />
here is the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th June 2003, 11:46</div></div><div class="posttext">The wrong thing in the DLL function call is just the order of the last two arguments. Unlock code should come after the private key.<br />
<br />
For the user to be able to exit the installer you must use the leave function of the page. The leave function is only called when the user clicks next. If the DLL returns false you should call Abort to not allow the user to continue to the next page.<br />
<br />
Leave callback funciton is not available in b3 but only in the latest CVS version. Use NSIS Update to get it. If you don't want the latest CVS version you should use something like the code in this page:<br />
<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=87<br />
<br />
You will also notice the $PLUGINSDIR is not deleted. This seems to be a feature of Systemd.dll I have never noticed. It doesn't free DLLs. To make sure the DLL is deleted you can use this trick:<br />
<br />
SetDetailsPrint none<br />
RegDLL $PLUGINSDIR\ISID.dll &quot;a function name that doesn't exist&quot;<br />
SetDetailsPrint both<br />
<br />
This will make NSIS load the DLL and then unload it completely.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">6th June 2003, 14:09</div></div><div class="posttext">sorry. my mistake.<br />
i inverted the last 2 arguments (.r3, .r4 is now .r4, .r3) and still the DLL response is &quot;0&quot; or &quot;false&quot;.<br />
<br />
i don't get it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">6th June 2003, 15:11</div></div><div class="posttext">i changed my script to use the leave function. (i think)<br />
<br />
but now i get this :<br />
<br />
install function ... not referenced - zeroing code ...<br />
<br />
how do i use &quot;abort&quot; ?<br />
<br />
is this correct ? : StrCmp $0 &quot;false&quot; Abort.<br />
i'll answer that. no. then how ?<br />
<br />
my script..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th June 2003, 18:21</div></div><div class="posttext">You should be using:<br />
Page custom &quot;Protect&quot; &quot;Validate&quot; &quot;Title&quot;<br />
<br />
Where &quot;Title&quot; is the title of the custom page (e.g. &quot; - Enter Codes&quot;)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th June 2003, 10:32</div></div><div class="posttext">Remove the dots and it should work:<br />
<br />
System::Call &quot;ISID::ValidateSerialNumber(t, t, t, t, t, t, t, t) i ('$PLUGINSDIR\OwD.iky', r1, r2, '', '', '', r4, r3) .s&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">10th June 2003, 10:23</div></div><div class="posttext">thanks for helping. here is the working script. feel free to use it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">roboldham</div><div class="date">18th June 2003, 23:30</div></div><div class="posttext">That looks pretty good.<br />
<br />
Can anyone think of any way of exposing that DLL to IIS / ASP environment so that the customer can be emailed their registration code automatically after purchasing the download online? (based on the details they enter)<br />
<br />
Cheers<br />
<br />
R</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th June 2003, 12:24</div></div><div class="posttext">If everything else fails you can always write a little NSIS script that will call the DLL, and write the result into a file which the ASP code will read. Use a silent &quot;installer&quot; to do the job.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>