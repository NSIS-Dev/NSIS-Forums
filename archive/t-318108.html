<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How do i get path like &quot;file:///E:/Redist/dllname.dll&quot;, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How do i get path like &quot;file:///E:/Redist/dllname.dll&quot; NSIS Discussion" />
	
	<title> How do i get path like &quot;file:///E:/Redist/dllname.dll&quot; [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How do i get path like &quot;file:///E:/Redist/dllname.dll&quot;</div>
<hr />
<div class="pda"><a href="t-318108.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318108">How do i get path like &quot;file:///E:/Redist/dllname.dll&quot;</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">yyt_sjq</div><div class="date">1st April 2010, 16:54</div></div><div class="posttext">i want to get a file's path in the following mode:<br />
<br />
file:///E:/Redist/dllname.dll<br />
<br />
is it possible in nsis? <br />
<br />
Thank you:p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">1st April 2010, 18:04</div></div><div class="posttext">presuming you already have the file's regular path in e.g. $0<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
!include &quot;StrFunc.nsh&quot; ; string functions header<br />
${StrRep} ; Initialize the string replacement function<br />
<br />
Section<br />
	StrCpy $0 &quot;c:\whatever\file.txt&quot; ; presume this is your input<br />
	${StrRep} $1 $0 &quot;\&quot; &quot;/&quot; ; replace backslash with slash<br />
	StrCpy $2 &quot;file://$1&quot; ; stick file:// in frot<br />
	MessageBox MB_OK &quot;[$0]$\r$\n[$1]$\r$\n[$2]&quot;<br />
SectionEnd<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yyt_sjq</div><div class="date">11th April 2010, 05:34</div></div><div class="posttext">presuming you already have the file's regular path in e.g. $0<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
!include &quot;StrFunc.nsh&quot; ; string functions header<br />
${StrRep} ; Initialize the string replacement function<br />
<br />
Section<br />
	StrCpy $0 &quot;c:\whatever\file.txt&quot; ; presume this is your input<br />
	${StrRep} $1 $0 &quot;\&quot; &quot;/&quot; ; replace backslash with slash<br />
	StrCpy $2 &quot;file://$1&quot; ; stick file:// in frot<br />
	MessageBox MB_OK &quot;[$0]$\r$\n[$1]$\r$\n[$2]&quot;<br />
SectionEnd<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
<br />
thanks very much. It works like a charm:p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">11th April 2010, 21:24</div></div><div class="posttext">Note that with this solution, you might get problem with special characters in path that don't fit the URL encoding scheme..<br />
<br />
You might want to use the System plugin instead and use the UrlCreateFromPath function from shlwapi.dll</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th April 2010, 15:19</div></div><div class="posttext">I do wish you'd give an example... anybody who refers to the System plugin should, actually.  It's magic to most of us lowly users :)<br />
<br />
(<br />
the docs for the function are here:<br />
<br />
http://msdn.microsoft.com/en-us/library/bb773773%28VS.85%29.aspx<br />
<br />
pszPath [in] | LPCTSTR | A null-terminated string of maximum length INTERNET_MAX_URL_LENGTH that contains the MS-DOS path.<br />
suggests a System plugin format of 't' followed by the string...<br />
<br />
pszUrl [out] | LPTSTR | A buffer used to return the URL.<br />
suggests a System plugin format of 'p' (pointer to a buffer which should be allocated first) used for output...<br />
<br />
pcchUrl [in, out] | LPDWORD | The length of pszUrl.<br />
Suggests a System plugin format of 'i' with ${NSIS_MAX_STRLEN} as its length for input presumably.<br />
<br />
dwReserved [in] | DWORD | Reserved. Set this parameter to NULL.<br />
Suggests we can leave that one out.<br />
<br />
Yet suffice to say that the following does not work.  Probably a 'simple' mistake somewhere.<br />
<br />
  StrCpy $0 &quot;c:\whatever\file.txt&quot;<br />
<br />
  System::Alloc ${NSIS_MAX_STRLEN}<br />
  Pop $1<br />
<br />
  System::Call &quot;shlwapi::UrlCreateFromPath(t r0, p.r1, i ${NSIS_MAX_STRLEN} r2)&quot;<br />
  MessageBox MB_OK &quot;[$0][$1][$2]&quot;<br />
<br />
  System::Free $1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">12th April 2010, 15:32</div></div><div class="posttext">I'm not very good with System either<br />
However after a little try, based on the GetUserName example in System.html, I came up with<br />
	StrCpy $0 &quot;c:\whatever\file.txt&quot;<br />
	System::Call &quot;shlwapi::UrlCreateFromPath(t r0, t .r1, *i ${NSIS_MAX_STRLEN} r2, i0)&quot;<br />
 	MessageBox MB_OK &quot;[$0][$1][$2]&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th April 2010, 16:17</div></div><div class="posttext">cool.. that at least does what it's supposed to %)<br />
<br />
I guess the t vs p makes.. sense.. of sorts.. if System ends up allocating a buffer of its own there.  no idea why it would be *i instead of just plain i for the length, though.  *squints at the System plugin some more*</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Wizou</div><div class="date">12th April 2010, 17:21</div></div><div class="posttext">it's __inout  LPDWORD pcchUrl, so you need a pointer to DWORD<br />
<br />
everywhere you see a TCHAR string (LPTSTR or LPCTSTR) use 't' (so you will be compatible with Unicode NSIS)<br />
<br />
and you forgot the dwReserved argument (NULL)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th April 2010, 18:51</div></div><div class="posttext">&quot;it's __inout LPDWORD pcchUrl, so you need a pointer to DWORD&quot;<br />
<br />
aha... okay, makes sense too<br />
<br />
And yes, I forgot the null.. should be fine without, but I suppose technically a &quot;, n&quot; should be added?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>