<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS &amp; Windows Aero, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS &amp; Windows Aero NSIS Discussion" />
	
	<title> NSIS &amp; Windows Aero [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS &amp; Windows Aero</div>
<hr />
<div class="pda"><a href="t-326585.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=326585">NSIS &amp; Windows Aero</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">28th January 2011, 00:11</div></div><div class="posttext">Hi @all<br />
<br />
I use NSIS for a long time to make my installers. And i use it to write little applications too. It produces small and fast files. And the most important hing for me is that you have no depencies to .NET or VC Runtimes... With nsDialogs and ResHacker you could satisfy almost all design whishes. Almost...<br />
<br />
Today (i had a little time) i played around with the system plugin and the DWM API (DwmExtendFrameIntoClientArea) and i had a little success. But some questions too.<br />
<br />
With DwmExtendFrameIntoClientArea you can extend the Aero glass window border behind the client area. You can control it via marginvalues. For example {0,0,0,25} to extend the bottom margin. And if you use negative values (-1) you get the &quot;sheet of glass&quot; effect where you have a complete glass window. Here (http://msdn.microsoft.com/en-us/library/aa969512.aspx) you´ll find more information.<br />
<br />
Here my example code. Put it in the .onGuiInit function:<br />
<br />
SetCtlColors $HWNDPARENT 0xFFFFFF 0x000000          ;set windowbackground to black<br />
System::Call &quot;*(i 0, i 0, i 0, i 35) i .r0&quot;               ; for &quot;sheet of glass&quot; (i -1, i -1, i -1, i -1)<br />
System::Call 'dwmapi::DwmExtendFrameIntoClientArea(i $HWNDPARENT, i r0)'<br />
<br />
And a screenshot:<br />
<br />
http://www.miranda-fusion.de/wp-pics/blog/2011/01/aerotest.jpg<br />
<br />
Now the problems. The text of all controls with glass behind seems to be transparent. First i thought this was because of black as text color. But you can use every color and they seems to be mixed up with the glass. Any idea to fix that?<br />
<br />
Sincerely, <br />
<br />
André</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">28th January 2011, 09:32</div></div><div class="posttext">Hi<br />
I tried this in my installer and I found out that it is not a problem of the text.<br />
I am using SkinnedControls for custom bitmaps and buttons and it seems that there is another layer over button controls, which hides the text...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th January 2011, 11:28</div></div><div class="posttext">The standard windows controls do not work well on glass</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">28th January 2011, 19:23</div></div><div class="posttext">Yup. Using GDI with DWM causes this funny things. :)<br />
<br />
I did a research and it seems like it is as i said it before...<br />
<br />
It so happens that the bit pattern for RGB black (0x00000000) is the same as the bit pattern for 100% transparent ARGB so you can actually draw with “black” GDI brush and assuming you’ve instructed the DWM to blur the painted area, the result will be the desired glass effect.<br />
<br />
but...<br />
<br />
The trouble with using this technique for rendering glass is that anything you might want to draw on your window better not use a black GDI brush otherwise it will also appear translucent.<br />
<br />
I found it here (http://weblogs.asp.net/kennykerr/archive/2006/08.aspx).<br />
<br />
The simple way is to use the SetLayeredWindowAttributes function. With this function we can specify another RGB color than black so that any pixels painted with this color will be transparent. The harder way is the UpdateLayeredWindow function.<br />
<br />
But i dont know how to &quot;convert&quot; these hints into NSIS Code...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th January 2011, 20:41</div></div><div class="posttext">IIRC the SetLayeredWindowAttributes hack broke in Vista SP1.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Highcoder</div><div class="date">28th January 2011, 20:51</div></div><div class="posttext">Uh....<br />
<br />
that sounds bad. So i have to dig deeper in this...<br />
<br />
thx for your replies...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>