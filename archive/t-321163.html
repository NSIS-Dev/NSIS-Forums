<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Silent installer problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Silent installer problem NSIS Discussion" />
	
	<title> Silent installer problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Silent installer problem</div>
<hr />
<div class="pda"><a href="t-321163.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=321163">Silent installer problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">siggel</div><div class="date">26th July 2010, 14:54</div></div><div class="posttext">Hi all,<br />
my installer works great so far, but now I tried how it behaves when using /S on the commandline.<br />
Everything is installed, but some additional functions seem to be ignored. Looks like<br />
<br />
Section <br />
  SetShellVarContext all<br />
  SetOutPath &quot;$PLUGINSDIR&quot;<br />
  File bar.exe<br />
SectionEnd<br />
<br />
Section &quot;foo&quot; xyz<br />
  SetShellVarContext all <br />
  SetOutPath &quot;$CfgDir&quot;<br />
  File /r ...<br />
  Call CustomizeConfiguration<br />
SectionEnd<br />
<br />
...<br />
<br />
Function CustomizeConfiguration<br />
  SetOutPath &quot;$PLUGINSDIR&quot;<br />
  ClearErrors<br />
  DetailPrint &quot;Configuration&quot;<br />
  nsExec::ExecToStack '&quot;$PLUGINSDIR/bar.exe&quot; &quot;$CfgDir/...&quot;'<br />
  ${If} ${Errors}<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Problem&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
 <br />
So what this basically does is install a file and afterwards do a customization of the file using bar.exe which is temporarily unpacked into $PLUGINSDIR. In non-silent mode it works but when running the installer with /S I see the original file in the end without customization. <br />
Any idea why the nsExec::ExecToStack line is not executed when using /S ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">26th July 2010, 15:17</div></div><div class="posttext">Does $cfgdir contain a correct value when running silent? If it's entered by the user...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siggel</div><div class="date">26th July 2010, 15:19</div></div><div class="posttext">Yes, $CfgDir is set. Precisely I should have said I'm using /S /INIFILE=... and I also verified (in non-silent mode) that /INIFILE works.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2010, 18:28</div></div><div class="posttext">Have you put in some debug message boxes? (That one you will never see because nsExec will NOT set the error flag on error - you should check its exit code on the stack). Also why are you using nsExec::ExecToStack if you're not reading the output on the stack or have you just ommitted that code?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siggel</div><div class="date">27th July 2010, 10:13</div></div><div class="posttext">Thanks for your remarks regarding the error handling. I think I used ExecToStack because that was the only version which I managed to run without a box popping up.<br />
<br />
I've now put some debug message boxes at the beginning and the end of the function, so I can have a look into plugins directory. With the presented code I saw that the plugins directory was missing bar.exe, so to me it looks that the sections are treated in a different order in silent mode.<br />
<br />
But when I copy the bar.exe lines<br />
<br />
SetShellVarContext all<br />
SetOutPath &quot;$PLUGINSDIR&quot;<br />
File bar.exe<br />
<br />
to the beginning of the foo section, the plugin directory contains bar.exe at the beginning of my customization function, but there is still no effect of the command.<br />
I'll add further debug messages and also debug output into bar.exe to see what's happening...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2010, 10:24</div></div><div class="posttext">The order of sections does not change. Have you used InitPluginsDir? Also if you look at the nsExec readme, it's nsExec::Exec you want. ExecToStack does exactly that - streams the output to the stack. All nsExec calls hide console windows; that is the purpose of using nsExec.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siggel</div><div class="date">27th July 2010, 10:47</div></div><div class="posttext">Ok, I'll review my nsExec usage. <br />
And with some more debug info I also found the bug in my foo section, thanks for proposing message boxes. The shortened version presented above should indeed work.<br />
So I should only check why my plugins directory was missing bar.exe when unpacking it within a different section, I bet it's also a bug in my script.<br />
Thanks for your help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2010, 11:45</div></div><div class="posttext">The likely candidate is the plugins dir did not yet exist when you tried to extract bar.exe hence why I said to try InitPluginsDir. In a non silent install MUI will have initialized it for you. In this case it was only initialized when you called nsExec.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">siggel</div><div class="date">27th July 2010, 12:49</div></div><div class="posttext">Indeed, that was the remaining problem.<br />
Thanks!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>