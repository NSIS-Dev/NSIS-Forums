<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Best Practice - Read file, edit contents, write new file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Best Practice - Read file, edit contents, write new file NSIS Discussion" />
	
	<title> Best Practice - Read file, edit contents, write new file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Best Practice - Read file, edit contents, write new file</div>
<hr />
<div class="pda"><a href="t-289985.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=289985">Best Practice - Read file, edit contents, write new file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MrEyes</div><div class="date">10th April 2008, 16:45</div></div><div class="posttext">Hello all,<br />
<br />
I am after some best practice advise relating to reading a text file, replacing some information and then writing the data to a new file.<br />
<br />
As an example, my source file contains:<br />
<br />
<br />
com.iplanet.services.debug.level=message<br />
com.iplanet.services.debug.directory=c:/Path/To/Debug<br />
<br />
com.iplanet.am.naming.url=https://naming.com/url<br />
com.iplanet.am.naming.ignoreNamingService=true<br />
<br />
com.iplanet.am.server.protocol=https<br />
com.iplanet.am.server.host=naming.com<br />
com.iplanet.am.server.port=443<br />
<br />
com.iplanet.am.notification.url=http://localserver.com:3700/LocalService/service.svc<br />
<br />
com.iplanet.am.cookie.name=iPlanetDirectoryPro<br />
com.iplanet.am.cookie.encode=true<br />
<br />
com.iplanet.am.jssproxy.trustAllServerCerts=true<br />
<br />
com.iplanet.am.version=6.1<br />
<br />
com.iplanet.security.SecureRandomFactoryImpl=com.iplanet.am.util.SecureRandomFactoryImpl<br />
com.iplanet.security.SSLSocketFactoryImpl=netscape.ldap.factory.JSSESocketFactory<br />
com.iplanet.security.encryptor=com.iplanet.services.util.JCEEncryption<br />
<br />
com.sun.identity.webcontainer=IAS7.0<br />
 <br />
<br />
I need to change the line:<br />
<br />
com.iplanet.services.debug.directory=c:/Path/To/Debug<br />
<br />
to be<br />
<br />
com.iplanet.services.debug.directory=c:/NewPath/Somewhere/Else<br />
<br />
and <br />
<br />
com.iplanet.am.notification.url=http://localserver.com:3700/LocalService/service.svc<br />
<br />
to <br />
<br />
com.iplanet.am.notification.url=http://localserver.com:3700/NewName/service.svc<br />
<br />
I originally started of with something like this:<br />
<br />
<br />
ClearErrors<br />
FileOpen $0 &quot;${sourcefile}&quot; r<br />
FileRead $0 $1<br />
FileClose $0<br />
<br />
${WordReplace} $1 &quot;c:/Path/To/Debug&quot; &quot;c:/NewPath/Somewhere/Else&quot; &quot;E+&quot; $R0<br />
${WordReplace} $R0 &quot;/LocalService/&quot; &quot;/NewName/&quot; &quot;E+&quot; $R1<br />
<br />
ClearErrors<br />
FileOpen $0 &quot;${targetfile}&quot; w<br />
FileWrite $0 $1<br />
FileClose $0<br />
<br />
<br />
However this resulted in some weird results (the target file only contained the first line of the source file)<br />
<br />
So after hunting around the wiki I haven't found a definitive way of doing this. So can anybody point me in the right direction.<br />
<br />
EDIT : After some further hunting, I came across the following:<br />
<br />
http://nsis.sourceforge.net/More_advanced_replace_text_in_file<br />
<br />
Which seems to work.  All I need to do is copy the source for to the target location and then use these functions to make the edits.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabian.rap.more</div><div class="date">10th April 2008, 19:42</div></div><div class="posttext">use ReadIniStr to read the path as it will be easier. then use Copy to copy the file(s) to the target location and then use WriteIniStr to change it in the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">10th April 2008, 19:47</div></div><div class="posttext">You cannot use ReadINIStr if there are no section headers. Use ConfigWrite instead.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fabian.rap.more</div><div class="date">10th April 2008, 20:43</div></div><div class="posttext">Originally posted by Afrow UK <br />
You cannot use ReadINIStr if there are no section headers. Use ConfigWrite instead.<br />
<br />
Stu  <br />
<br />
how did i miss that?? yes ConfigWrite is the way to go on this</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MrEyes</div><div class="date">11th April 2008, 16:07</div></div><div class="posttext">Originally posted by Afrow UK <br />
You cannot use ReadINIStr if there are no section headers. Use ConfigWrite instead.<br />
<br />
Stu  <br />
<br />
I did try config write however one of the changes I needed to work it would have required some workarounds.<br />
<br />
In summary this line in the source file:<br />
<br />
[code]<br />
com.iplanet.am.notification.url=http://localserver.com:3700/NewName/service.svc<br />
[code]<br />
<br />
The &quot;localserver.com&quot; is unique for every install, so I need to keep that and only change the &quot;/NewName/&quot; part.  So I would have had to use configread, then do string replacement, then a config write.  Due to this, in the end it was easier to use the item in the edit.  Unless of course there is a &quot;gotcha&quot; somewhere that I haven't spotted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th April 2008, 16:12</div></div><div class="posttext">Can you not use ConfigRead + WordReplace + ConfigWrite?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ssam</div><div class="date">27th May 2008, 12:32</div></div><div class="posttext">i have the same problem, i uused configread and configwrite, and he changed the first entry, he fond. but the entry i want to change, can be  more then one times in the File. And he should be change every entry. <br />
<br />
How can i change the other entrys, or why he change only one entry?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th May 2008, 12:35</div></div><div class="posttext">WriteINIStr should be your solution according to your other topic.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ssam</div><div class="date">27th May 2008, 12:41</div></div><div class="posttext">can i use writeinistr with every Filetyp?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ssam</div><div class="date">28th May 2008, 08:49</div></div><div class="posttext">ok now i have exactly the same Problem and cant use writeinistr, because i have no [Sections]<br />
<br />
and if i use Configwrite, he adds it at the end of the File. but i want to replace a substring <br />
<br />
<br />
  ... test@&quot;Database name&quot; ...<br />
<br />
<br />
i want change the database name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">28th May 2008, 08:52</div></div><div class="posttext">You have to use StrReplace macro. http://nsis.sourceforge.net/StrReplace_v4</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ssam</div><div class="date">28th May 2008, 11:18</div></div><div class="posttext">ok i will test it</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>