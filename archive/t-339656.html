<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Modify sections at runtime via external config file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Modify sections at runtime via external config file NSIS Discussion" />
	
	<title> Modify sections at runtime via external config file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Modify sections at runtime via external config file</div>
<hr />
<div class="pda"><a href="t-339656.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=339656">Modify sections at runtime via external config file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BreezeUADN</div><div class="date">19th December 2011, 12:49</div></div><div class="posttext">Hi, I've been looking for a simple solution for such situation:<br />
there is a formed components structure filled with SectionGroups and Sections which is set in stone after compilation, but I need an option to remove some sections (at runtime) based on some external list, placed somewhere near setup executable.<br />
The only solution I can think of is reading an .ini (http://nsis.sourceforge.net/Set_section_names_according_ini_file) file with such a list and marking those sections with unselected+hidden attributes... Probably there is a better solution, what do you think?<br />
(the basic idea is to remove or unrestrict some components from installation based on an external &quot;license&quot; file - instead of creating various setup packages there will be just one, but with this feature...)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BreezeUADN</div><div class="date">20th December 2011, 04:11</div></div><div class="posttext">Another solution I have in mind is NSIS sources modification. Customized TreeView on the MUI_PAGE_COMPONENTS should do the trick...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th December 2011, 06:53</div></div><div class="posttext">Probably there is a better solution, what do you think?<br />
Why do you think there is a better solution? Your solution is exactly the way to do it. What's wrong with it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BreezeUADN</div><div class="date">20th December 2011, 10:12</div></div><div class="posttext">Awww I just have a feeling that I'm &quot;doing it wrong&quot;... Well atm. it looks like this:<br />
<br />
license.lic (no true/false analysis yet - maybe will add more options instead of bool)<br />
[allowed]<br />
Gate = true<br />
Gate Client = true<br />
Gate Server = true<br />
...<br />
<br />
<br />
!include &quot;installerSections.nsh&quot;<br />
;--- фильтрация секций по файлу лицензии ---<br />
Function FilterSections<br />
  ${For} $R1 0 ${SECTIONCOUNT}<br />
    SectionGetText $R1 $R2<br />
    ReadINIStr $R0 ${LicensePath} &quot;allowed&quot; &quot;$R2&quot;<br />
    StrCmp $R0 &quot;&quot; +3 0 ;если секция не найдена, переход на следующую, иначе: <br />
      SectionSetFlags $R1 16 ;0+16 = снять выделение + ридонли<br />
      SectionSetText $R1 &quot;&quot; ;скрыть<br />
  ${Next}<br />
FunctionEnd<br />
;------<br />
<br />
${LicensePath} is defined as a result of OpenFileDialog which I call on my custom page, where I call this FilterSections inside of Validate part. <br />
(installerSections.nsh and SECTIONCOUNT is formed by my helper program that allows to visually compose section tree from xml templates)<br />
<br />
The problem is that I had limited time to get acquainted with NSIS so probably many many things can be done in a much more optimal way, thus the doubts...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th December 2011, 17:12</div></div><div class="posttext">Well, that looks pretty good to me. Looks like you've got a better grasp of NSIS than you think. However, you should probably use the macros in NSIS\Include\Sections.nsh, instead of calling SectionSetFlags directly. Right now, you're throwing away all the other section flags just to set flag 0 and 16.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>