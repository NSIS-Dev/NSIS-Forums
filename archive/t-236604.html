<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Strange crashes on Win98 SE, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Strange crashes on Win98 SE NSIS Discussion" />
	
	<title> Strange crashes on Win98 SE [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Strange crashes on Win98 SE</div>
<hr />
<div class="pda"><a href="t-236604.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236604">Strange crashes on Win98 SE</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Bovlk</div><div class="date">28th January 2006, 18:35</div></div><div class="posttext">Hello,<br />
<br />
I'm trying to make an installer for an application written in VB6 that uses MDAC. I encountered a very big problem with it. The original script was basically as follows:<br />
<br />
; Install MDAC 2.5<br />
  file &quot;Files\mdac_typ.exe&quot;<br />
  ExecWait '&quot;$INSTDIR\mdac_typ.exe&quot;  /q:a /c:&quot;setup.exe /QN1&quot;'<br />
  Delete &quot;$INSTDIR\mdac_typ.exe&quot;<br />
<br />
; Install system libraries<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_NOTPROTECTED &quot;files\msvbvm60.dll&quot; &quot;$SYSDIR\msvbvm60.dll&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\oleaut32.dll&quot; &quot;$SYSDIR\oleaut32.dll&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\olepro32.dll&quot; &quot;$SYSDIR\olepro32.dll&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\comcat.dll&quot;   &quot;$SYSDIR\comcat.dll&quot;   &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib DLL    $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\asycfilt.dll&quot; &quot;$SYSDIR\asycfilt.dll&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib TLB    $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\stdole2.tlb&quot;  &quot;$SYSDIR\stdole2.tlb&quot;  &quot;$SYSDIR&quot;<br />
<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\Tabctl32.ocx&quot; &quot;$SYSDIR\Tabctl32.ocx&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\COMDLG32.OCX&quot; &quot;$SYSDIR\COMDLG32.OCX&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\MSDATLST.OCX&quot; &quot;$SYSDIR\MSDATLST.OCX&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\msstdfmt.dll&quot; &quot;$SYSDIR\msstdfmt.dll&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\MSDATGRD.OCX&quot; &quot;$SYSDIR\MSDATGRD.OCX&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\Msflxgrd.OCX&quot; &quot;$SYSDIR\Msflxgrd.OCX&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\Mscomct2.ocx&quot; &quot;$SYSDIR\Mscomct2.ocx&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\MSCOMCTL.OCX&quot; &quot;$SYSDIR\MSCOMCTL.OCX&quot; &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib REGDLL $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\scrrun.dll&quot;   &quot;$SYSDIR\scrrun.dll&quot;   &quot;$SYSDIR&quot;<br />
  !insertmacro InstallLib DLL    $ALREADY_INSTALLED REBOOT_PROTECTED    &quot;files\MSVCRT.DLL&quot;   &quot;$SYSDIR\MSVCRT.DLL&quot;   &quot;$SYSDIR&quot;<br />
<br />
; Reboot<br />
  Reboot<br />
<br />
The problem with this script is that when the systems reboots, the file oleaut32.dll is missing. I found that MDAC 2.5 tries to upgrade it from its original version. When I use the script above, the upgrade fails and the file is deleted but not replaced with a newer version. This leads to complete crash of the system - no application can be started.<br />
<br />
I found that when I change the script to<br />
  install_system_files<br />
  reboot<br />
  install_mdac<br />
  reboot<br />
  install_app<br />
everything works fine (note that this is basically what the original Visual Basic installer does).<br />
<br />
The question I have follows: what's wrong with the first version? And why does the second version work? Is the second version really correct or is there some other problem? I mean some theoretical explanation. I need to be absolutely sure that my scripts work on every system regardless any applications installed etc. So I want a theoretical reason why one or the other script will really work.<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st January 2006, 17:39</div></div><div class="posttext">The MDAC installer already installs oleaut32.dll, so you don't need to install it yourself. I don't know how exactly it got to a situation where you'd be left with no oleaut32.dll. But with more details, like the output of pendmove (http://www.sysinternals.com/Utilities/PendMoves.html) and the contents of the start-up registry keys, we can find out together.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>