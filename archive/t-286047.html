<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" DES in NSIS, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  DES in NSIS NSIS Discussion" />
	
	<title> DES in NSIS [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  DES in NSIS</div>
<hr />
<div class="pda"><a href="t-286047.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=286047">DES in NSIS</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">lushdog</div><div class="date">31st January 2008, 18:19</div></div><div class="posttext">Sorry if this has been answered before but is there any way to invoke DES encryption/decryption from within a NSIS script?<br />
<br />
I want to encrypt/decrypt a string.<br />
<br />
Thanks in advance,</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">31st January 2008, 19:14</div></div><div class="posttext">Probably yes, assuming calling the library via system plugin or recompiling the source of it into nsis portable plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lushdog</div><div class="date">31st January 2008, 19:15</div></div><div class="posttext">Excuse my ignorance but I'm assuming you mean calling a Win32 library via system::call ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lushdog</div><div class="date">31st January 2008, 21:36</div></div><div class="posttext">Ah I see that I can use Advapi32.dll to access the CryptEncrypt function.<br />
<br />
But this CryptEncrypt function needs pointers to data created with the CryptImportKey which in turn needs data created with CryptAcquireContext function.<br />
<br />
Can I string these together, i.e. passing the vars from one system call to another?<br />
<br />
Also I see that some of the functions use a HCRYPTKEY data type.  Is this type supported in system calls from NSIS?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">1st February 2008, 01:10</div></div><div class="posttext">System plugin supports all the return types, the question here is...what would the propper code, there's a system tutorial around here and @ wikis, search the forums about pointers and system plugin, read the docs, so you can know how to :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">1st February 2008, 01:26</div></div><div class="posttext">HCRYPTPROV,HCRYPTKEY and HCRYPTHASH are probably pointer sized, use i and *i</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lushdog</div><div class="date">1st February 2008, 15:44</div></div><div class="posttext">Ok I'll try this out in my spare time.  I've gone through the MSDN and collated the function sigs and here is what I have so far.<br />
<br />
BOOL WINAPI CryptEncrypt(<br />
  __in     HCRYPTKEY hKey,              **CryptImportKey**<br />
  __in     HCRYPTHASH hHash,		**NULL**<br />
  __in     BOOL Final,			**TRUE**<br />
  __in     DWORD dwFlags,		**0 or NULL**<br />
  __inout  BYTE* pbData,		**string to be encrypted** **when function done it contains encrypted**<br />
  __inout  DWORD* pdwDataLen,		**length in bytes of above**<br />
  __in     DWORD dwBufLen		<br />
);<br />
<br />
BOOL WINAPI CryptImportKey(<br />
  __in   HCRYPTPROV hProv,		**returned by CryptAquireContext**<br />
  __in   BYTE* pbData,				<br />
  __in   DWORD dwDataLen,<br />
  __in   HCRYPTKEY hPubKey,<br />
  __in   DWORD dwFlags,			**CRYPT_NO_SALT**<br />
  __out  HCRYPTKEY* phKey		**returned**<br />
);<br />
<br />
<br />
<br />
BOOL WINAPI CryptAcquireContext(<br />
  __out  HCRYPTPROV* phProv,		**returned**<br />
  __in   LPCTSTR pszContainer,		**NULL uses default**<br />
  __in   LPCTSTR pszProvider,		**MS_DEF_PROV** **NULL uses default**<br />
  __in   DWORD dwProvType,		**NULL?**<br />
  __in   DWORD dwFlags			**0**<br />
);<br />
<br />
Am I on the right track here?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st February 2008, 16:04</div></div><div class="posttext">If you're not locked on DES, you could use the Blowfish plug-in.<br />
<br />
http://nsis.sourceforge.net/Blowfish_plug-in</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lushdog</div><div class="date">1st February 2008, 16:42</div></div><div class="posttext">Unfortunately I have to decrypt a string from legacy code (reg entry) that was encrypted in DES.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>