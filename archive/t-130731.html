<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Migrating from MSI: uninstall previous version of application, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Migrating from MSI: uninstall previous version of application NSIS Discussion" />
	
	<title> Migrating from MSI: uninstall previous version of application [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Migrating from MSI: uninstall previous version of application</div>
<hr />
<div class="pda"><a href="t-130731.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=130731">Migrating from MSI: uninstall previous version of application</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">joostn</div><div class="date">2nd April 2003, 21:21</div></div><div class="posttext">Hi,<br />
<br />
I'm sure I'm not the first one migrating from MSI to NSIS.. Anyone have an example how to uninstall the previous version of my application, that was installed using MSI, from an NSIS installer which installs the new version of my application?<br />
<br />
Thanks<br />
Joost</div></div><hr />


<div class="post"><div class="posttop"><div class="username">psyke</div><div class="date">3rd April 2003, 05:32</div></div><div class="posttext">Hi Joost. :)<br />
<br />
Hmmm I can't say for certain if this will help, but you should be able to at least start the uninstall from NSIS with the following command:<br />
ExecWait '&quot;msiexec.exe&quot; /x Example.msi'<br />
The reason I emphasized start is that, provided everything is ok the uninstaller will launch, but if msiexec simply does a little bit and then forks or starts doing the real uninstall work from some temp executable, execwait will return 'early' as far as you're concerned.<br />
<br />
This is actually correct behaviour, ExecWait will wait for msiexec.exe to finish... but you want the *uninstaller* to finish, and msiexec.exe may not be active for the entire duration of the uninstall.<br />
<br />
Anyway, just test out the command and see how it goes. :)<br />
<br />
If you need more info on MSI (which I doubt since you made the MSI installer, but anyway) here's (http://www.microsoft.com/technet/treeview/default.asp?url=/TechNet/prodtechnol/winxppro/proddocs/msiexec.asp) where I found info on the command line parameters to msiexec.<br />
<br />
Salaam/Peace.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">joostn</div><div class="date">3rd April 2003, 07:53</div></div><div class="posttext">Hi Psyke,<br />
<br />
Thanks for the feedback. I need to do a few more things:<br />
<br />
1. find out whether msiexec actually exists on the computer (older Windows versions didn't have MSI)<br />
<br />
2. find out whether my program was installed or not<br />
<br />
Both could probably be determined from the registry, but before I try to reinvent the wheel, I hope that someone has a ready-cooked example..<br />
<br />
Thanks<br />
Joost</div></div><hr />


<div class="post"><div class="posttop"><div class="username">joostn</div><div class="date">3rd April 2003, 10:56</div></div><div class="posttext">Okay, it wasn't that difficult after all:<br />
<br />
Function UninstallMSI<br />
  ; $R0 should contain the GUID of the application<br />
  push $R1<br />
  ReadRegStr $R1 HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\$R0&quot; \<br />
    &quot;UninstallString&quot; ;UninstallString<br />
  StrCmp $R1 &quot;&quot; UninstallMSI_nomsi<br />
    MessageBox MB_YESNOCANCEL|MB_ICONQUESTION  \<br />
      &quot;A previous version of ${MUI_PRODUCT} was found.\<br />
      It is recommended that you uninstall it first.$\n$\n\<br />
      Do you want to do that now?&quot; IDNO UninstallMSI_nomsi IDYES UninstallMSI_yesmsi<br />
      Abort<br />
UninstallMSI_yesmsi:<br />
    ExecWait '&quot;msiexec.exe&quot; /x $R0'<br />
    MessageBox MB_OK|MB_ICONINFORMATION \<br />
      &quot;Click OK to continue upgrading your version of ${MUI_PRODUCT}&quot;<br />
UninstallMSI_nomsi: <br />
  pop $R1<br />
FunctionEnd<br />
 <br />
From the main Section I then do the following:<br />
<br />
push $R0<br />
  StrCpy $R0 &quot;{48E5A72D-whatever-xxxx}&quot;<br />
  Call UninstallMSI<br />
pop $R0<br />
In my case I had to do this for every product code for each previous version of my application.<br />
<br />
NSIS is really great!!<br />
<br />
Joost</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">3rd April 2003, 11:00</div></div><div class="posttext">You should post this code in the NSIS archive (http://nsis.sf.net/archive).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">psyke</div><div class="date">3rd April 2003, 16:16</div></div><div class="posttext">hey Joost, you're quite welcome, wish I could've been more help. :)<br />
<br />
NSIS is indeed, great. :D I'm glad to see you were able to come up with a straightforward way to do what you needed.<br />
<br />
There wasn't a cooked example ready for you, but now that you've done the 'cooking' someone down the road will probably benefit from it. ;)<br />
<br />
Salaam/Peace.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">joostn</div><div class="date">3rd April 2003, 16:33</div></div><div class="posttext">I hope so.. I've added my code to the archives!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd April 2003, 16:52</div></div><div class="posttext">Thank you for your addition. To make your code easier to use, and more standard you can use Exch instead of Push, StrCpy, Call, Pop. For example:<br />
<br />
Function PrintParm<br />
  Exch $0 # parm<br />
  DetailPrint $0<br />
  Pop $0<br />
FunctionEnd<br />
<br />
#...<br />
Push &quot;print this&quot;<br />
Call PrintParm</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">20th June 2006, 19:27</div></div><div class="posttext">Can someone point me to the Archives? I can't find it at http://nsis.sf.net/archive</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">21st June 2006, 00:42</div></div><div class="posttext">It is now called the Developer Center (http://nsis.sourceforge.net/Developer_Center), and now uses a wiki to store the information.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RossW</div><div class="date">21st June 2006, 02:20</div></div><div class="posttext">Thanks Jason, but what section can I find this code?<br />
<br />
Never mind. Found it at http://nsis.sourceforge.net/Uninstalling_a_previous_MSI</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">27th June 2006, 17:24</div></div><div class="posttext">This included delphi file might be of help for some...<br />
at least it is of help for me uninstalling MSI ;)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>