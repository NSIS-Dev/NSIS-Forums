<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How can I easily delete all files created by the installer?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How can I easily delete all files created by the installer? NSIS Discussion" />
	
	<title> How can I easily delete all files created by the installer? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How can I easily delete all files created by the installer?</div>
<hr />
<div class="pda"><a href="t-193392.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=193392">How can I easily delete all files created by the installer?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Diodor Bitan</div><div class="date">13th September 2004, 08:22</div></div><div class="posttext">Upon hearing a horror story of a user that accidentally installed his shareware application in the root of the hard disk, only to have the uninstaller &quot;RMDir /r&quot; his entire hard disk I decided I don't want to use the /r option anymore.<br />
<br />
Am I forced to manually delete each and every single file I create manually with a &quot;Delete&quot; command or is there some easy way to have the uninstaller delete all the files that were created during the installation, but none of the other files it finds?<br />
<br />
Thanks and best regards,<br />
Diodor Bitan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th September 2004, 10:14</div></div><div class="posttext">Why did you use AllowRootDirInstall true? If you don't use that, the user won't be able to install to the root directory.<br />
<br />
You can also use a macro which both includes a file and writes its delete line to another file. You can then include that file in the uninstaller to have all the files copied deleted.<br />
<br />
!macro File file<br />
File &quot;${file}&quot;<br />
!system 'echo Delete &quot;$INSTDIR\${file}&quot; &gt;&gt; $%TEMP%\uninstaller.nsh'<br />
!macroend<br />
<br />
Section uninstall<br />
!include $%TEMP%\uninstaller.nsh<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Diodor Bitan</div><div class="date">13th September 2004, 11:33</div></div><div class="posttext">Original post by kichik<br />
Why did you use AllowRootDirInstall true? If you don't use that, the user won't be able to install to the root directory.<br />
<br />
I'm glad to hear that. The horror story wasn't about my app, so then it seems I was safe in this regard. I still don't want to use either of &quot;RMDir /r&quot; or &quot;Delete *.*&quot; anymore <br />
<br />
You can also use a macro which both includes a file and writes its delete line to another file. You can then include that file in the uninstaller to have all the files copied deleted.<br />
<br />
!macro File file<br />
File &quot;${file}&quot;<br />
!system 'echo Delete &quot;$INSTDIR\${file}&quot; &gt;&gt; $%TEMP%\uninstaller.nsh'<br />
!macroend<br />
<br />
Section uninstall<br />
!include $%TEMP%\uninstaller.nsh<br />
SectionEnd<br />
<br />
<br />
That's nice! I still have to enter a separate line for each file in the application directory, right? <br />
<br />
I wanted to automate this somehow - right now my script adds files with  File 'C:\path\*.*' commands, which is quite convenient as the files change from version to version. <br />
<br />
I guess I'll have to make an external script that scans all the files in the directory and creates files that will therafter be included in my nsis script. <br />
<br />
Thanks to your help I'll be able to call the external script from the nsis one using the !system command, so that should be the end of that :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th September 2004, 11:37</div></div><div class="posttext">never mind, you found the solution on your own<br />
<br />
You can create something similar to, or even based on http://forums.winamp.com/showthread.php?s=&amp;threadid=150770</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Diodor Bitan</div><div class="date">13th September 2004, 12:58</div></div><div class="posttext">Done! <br />
<br />
I add the files with an elegant &quot;File /r c:\*.*&quot; in my installing section. Then in the uninstall section, I add <br />
<br />
!system &quot;delsave.bat&quot;<br />
!include &quot;delsave.nsh&quot;<br />
<br />
<br />
The delsave.bat program:<br />
<br />
dir /s /b /a-d c:\pax\*.* &gt; temp.txt<br />
lua -e &quot;io.input ('temp.txt') io.output ('delsave.nsh') dir = 'c:\\pax'&quot; -l delsave.lua<br />
del temp.txt<br />
<br />
<br />
Which in turns calls the delsave.lua program:<br />
<br />
len = string.len (dir)<br />
<br />
for line in io.lines () do<br />
	assert (dir == string.sub (line, 1, len))<br />
	io.write ('Delete &quot;$INSTDIR', string.sub (line, len + 1), '&quot;\n')<br />
end<br />
<br />
:)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>