<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Window and Control, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Window and Control NSIS Discussion" />
	
	<title> Window and Control [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Window and Control</div>
<hr />
<div class="pda"><a href="t-293694.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=293694">Window and Control</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">27th June 2008, 15:38</div></div><div class="posttext">Hello everybody,<br />
<br />
I create a topic about Windows and Controls because I think it's an important part that is not enough documented.<br />
For exemple, I had difficulties to found information about functions (and their parameters) allowing windows and controls handling (EnableWindow, FindWindow, GetDlgItem, IsWindow, SendMessage, SetCtlColors, ShowWindow).<br />
<br />
So I will have many questions about this topic.<br />
<br />
________________________________________________________________________________<br />
<br />
My first question is :<br />
 - Where can I found the id list of the different controls ??<br />
GetDlgItem $0 $HWNDPARENT &lt;id_control&gt;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">27th June 2008, 15:50</div></div><div class="posttext">Here is a macro I use to enable/disable the &quot;next&quot; button:<br />
<br />
!macro SetNextButtonEnabled flag<br />
  Push $0<br />
  GetDlgItem $0 $HWNDPARENT 1<br />
  !if ${flag} == 0<br />
    EnableWindow $0 0<br />
  !else<br />
    EnableWindow $0 1<br />
  !endif<br />
  Pop $0<br />
!macroend<br />
<br />
This shows how to use GetDlgItem and EnableWindow, but I can't tell you where you can get the &lt;id_control&gt; from. I just copied it from some example code myself...<br />
<br />
<br />
Also the docs say that you can get the handle of the &quot;inner&quot; dialog this way:<br />
<br />
FindWindow $0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">27th June 2008, 16:07</div></div><div class="posttext">Thank you LoRd_MuldeR, I found also different examples on the forum or with the NSIS install.<br />
<br />
But I would like to understand at what control correspond the different ids (1028, 1037, 1256, ...). So a complete list, if it exists, will be perfect !!!!!<br />
<br />
I have read that there are a list in NSIS/Contrib/UIs/resource.h but I haven't this file in my NSIS install.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th June 2008, 16:14</div></div><div class="posttext">Use Resource Hacker and open the UI executable file.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">27th June 2008, 16:32</div></div><div class="posttext">Originally posted by Corpio <br />
I have read that there are a list in NSIS/Contrib/UIs/resource.h but I haven't this file in my NSIS install. [/B] <br />
<br />
That is a source code file. It's a C Header file to be precise. You won't find it in your install, you need to get source codes...<br />
<br />
You can also view the file via SVN:<br />
http://nsis.svn.sourceforge.net/viewvc/nsis/NSIS/trunk/Contrib/UIs/resource.h?revision=4124&amp;view=markup</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">27th June 2008, 17:19</div></div><div class="posttext">Thank you Afrow UK,<br />
<br />
I have look this software quickly, I think it can help me.<br />
<br />
<br />
PS : I may come back on this topic to ask another question about Windows and Controls so see you soon.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">1st July 2008, 15:12</div></div><div class="posttext">Hello,<br />
<br />
I have a problem with a STATIC control on a components page allowing me to write the description of the section flied by the user thanks to the .onMouseOverSection callback.<br />
<br />
When I want to change the control text, I run this code:<br />
SendMessage $hWndControl ${WM_SETTEXT} 0 &quot;STR:${DESCRIPTION}&quot;<br />
   with $hWndControl, the handle to the good destination control<br />
<br />
<br />
It writes the good text at the good place on the good time but it doesn't erase the previous text. So I have texts overlayed and unreadabled.<br />
<br />
Any idea !!!<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">1st July 2008, 15:31</div></div><div class="posttext">for a quick hack, hide then show the window, for a real solution; call InvalidateRect or RedrawWindow with the system plugin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">1st July 2008, 16:05</div></div><div class="posttext">I'm sorry Anders but I tested different solution to hide and show the window without results.<br />
<br />
Maybe I don't use the good solution !!!!!<br />
<br />
Can you help me with little code ??<br />
<br />
Thanks.<br />
<br />
<br />
<br />
PS : I tried this code<br />
SendMessage $HWNDPARENT ${MSG} 0 0<br />
SendMessage $HWNDPARENT ${MSG} 1 0 <br />
with :<br />
 - MSG = WM_ENABLE<br />
 - MSG = WM_SHOWWINDOW</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">1st July 2008, 17:04</div></div><div class="posttext">I'm not sure if I understand what are you trying to manage,<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.1<br />
<br />
http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.14.7</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st July 2008, 21:20</div></div><div class="posttext">Use ShowWindow with ${SW_HIDE} and again with ${SW_SHOW}.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">2nd July 2008, 08:47</div></div><div class="posttext">Hello,<br />
<br />
We were concentrated on the Anders' solution.<br />
for a quick hack, hide then show the window, for a real solution; call InvalidateRect or RedrawWindow with the system plugin<br />
<br />
Actually, the solution is to use the LockWindow function :<br />
Function .onMouseOverSection<br />
    LockWindow on<br />
    ...<br />
    LockWindow off<br />
FunctionEnd<br />
<br />
<br />
PS :<br />
I think I already tried this solution because I had the same problem with an other STATIC control that I have resolved with this. But I tried it in this case without results. I don't insisted because there is a difference between the two cases. And when I retried, it worked, so ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">2nd July 2008, 11:19</div></div><div class="posttext">Hello,<br />
<br />
I have also the problem with the static control on the instfiles page allowing NSIS to write the details of the installation.<br />
I bring back the problem is : when we change the text of a static control, it overlays the previous text that is not removed.<br />
But now I can't use the LockWindow function around the SendMessage calls - allowing to change the static control text - because it's not me who controls this, it's NSIS.<br />
<br />
The problem happens if I use a SetCtlColors to have the static control background transparent. If I take off the SetCtlColors, the problem not produces.<br />
<br />
So I don't know how to resolve this problem in this context !!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">3rd July 2008, 11:23</div></div><div class="posttext">Hello I tried to reproduce the problem in a simple installer to illustrate it.<br />
Name &quot;Test&quot;<br />
OutFile &quot;Test.exe&quot;<br />
<br />
Page instfiles &quot;&quot; InstFilesPageShow<br />
<br />
Function InstFilesPageShow<br />
	FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $R0 $R0 1006<br />
	SetCtlColors $R0 0xFF0000 Transparent<br />
FunctionEnd<br />
<br />
Section &quot;&quot;<br />
	CreateDirectory &quot;$DESKTOP\Dir_1&quot;<br />
	CreateDirectory &quot;$DESKTOP\Dir_1\Dir_1_1&quot;<br />
	CreateDirectory &quot;$DESKTOP\Dir_1\Dir_1_2&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd July 2008, 11:53</div></div><div class="posttext">Try using LockWindow around the SetCtlColors.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">3rd July 2008, 13:19</div></div><div class="posttext">Thanks Afrow UK for your suggestion but it doesn't work.<br />
<br />
<br />
PS :<br />
The code given before works so - if you want - you can just copy/paste it in a .nsi file and test it to see the problem and - if you want - try to help me.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">3rd July 2008, 15:09</div></div><div class="posttext">not sure if this is a bug in nsis or the windows static control, but not all controls can handle transparent backgrounds<br />
<br />
if you really need transparent background, you can use a ugly hack like:<br />
<br />
Section <br />
<br />
<br />
FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $R0 $R0 1006<br />
SetCtlColors $R0 0xFF0000 Transparent<br />
<br />
!macro uglyprinthack x<br />
LockWindow on<br />
detailprint &quot;${x}&quot;<br />
LockWindow off<br />
!macroend<br />
<br />
!insertmacro uglyprinthack aaaaa<br />
sleep 1234 ;do something<br />
!insertmacro uglyprinthack BBBBB<br />
sleep 2222 ;do something<br />
!insertmacro uglyprinthack &quot;&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">3rd July 2008, 15:28</div></div><div class="posttext">Thanks Anders but I repeat, it's not me that change the static control text, it's a default action of the instfiles page.<br />
I take inspiration from your suggestion and I put LockWindow on before and LockWindow off after each line code leading to a display in the control.Name &quot;Test&quot;<br />
OutFile &quot;Test.exe&quot;<br />
<br />
Page instfiles &quot;&quot; InstFilesPageShow<br />
<br />
Function InstFilesPageShow<br />
	FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $R0 $R0 1006<br />
	SetCtlColors $R0 0xFF0000 Transparent<br />
FunctionEnd<br />
<br />
Section &quot;&quot;<br />
	LockWindow on<br />
	CreateDirectory &quot;$DESKTOP\Dir_1&quot;<br />
	LockWindow off<br />
	LockWindow on<br />
	CreateDirectory &quot;$DESKTOP\Dir_1\Dir_1_1&quot;<br />
	LockWindow off<br />
	LockWindow on<br />
	CreateDirectory &quot;$DESKTOP\Dir_1\Dir_1_2&quot;<br />
	LockWindow off<br />
SectionEndIt works but it stay really ugly and impossible to use with bigger sections (I remind this code is just an illustration of the problem, my real code is more important !!!).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">3rd July 2008, 16:38</div></div><div class="posttext">I think this bug can't be resolved simply and neatly on the script. Maybe the solution is to change something in the NSIS source but I think it's not so easy.<br />
Now, I content oneself with a uniform background (whithout image) for this window part.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Corpio</div><div class="date">3rd July 2008, 16:47</div></div><div class="posttext">And I have an other question on this topic !!!!!!!!!<br />
<br />
It's possible to modify controls of the predefined pages as directory, components or instfiles thanks to the modification of the executable containing the resources with Resource Hacker and its reloading with the ChangeUI function.<br />
<br />
Is it possible to use resources contained on this executable on a custom page ????????????????<br />
<br />
In fact, I can add in this executable new dialog resources allowing me to customized the interface of new pages without using a plugin as InstallOption or nsDialog.<br />
But how can I load these new resources ????????<br />
<br />
Thanks. :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BuilderBob</div><div class="date">16th September 2008, 10:17</div></div><div class="posttext">So, anything new with instfile's static transparent background? I'm having the exact same problem now.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>