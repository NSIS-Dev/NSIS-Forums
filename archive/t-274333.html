<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" async Leave callback for MUI page causing evilness, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  async Leave callback for MUI page causing evilness NSIS Discussion" />
	
	<title> async Leave callback for MUI page causing evilness [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  async Leave callback for MUI page causing evilness</div>
<hr />
<div class="pda"><a href="t-274333.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274333">async Leave callback for MUI page causing evilness</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">13th July 2007, 23:43</div></div><div class="posttext">I have a verification function as a callback when you leave the Components Page, i.e.:<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE verifyComponentReqs<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
Unfortunately during this process you can still click on the Components Page.  You can select/deselect components, click install again, which can lead to corrupt installer messages and installer crashes.<br />
<br />
I display a banner in the method, but it takes 1-2 seconds to load the DLL so you can still click on the buttons.  I disable the Install button, but you can still select components.  Is there a way to lock the dialog?  I have a few ideas on workarounds:<br />
<br />
A) Load the banner DLL earlier.  Is there a way to load a plugin DLL explicitly without calling a plugin function?  I suppose I can do &quot;Banner::destroy /NOUNLOAD&quot; but that seem really hacky.<br />
<br />
B) Use the next page's PRE callback instead, and then go back to the Components Page if the conditions aren't met.  But this isn't ideal from a usability standpoint because it will seem to the user that they're already in the install progress, which they're not.<br />
<br />
I'd appreciate any suggestions/corrections.<br />
<br />
Thanks,<br />
bobics</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th July 2007, 02:02</div></div><div class="posttext">why not just disable the component list aswell?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th July 2007, 08:54</div></div><div class="posttext">I cannot reproduce this. Please attach a complete example.<br />
<br />
As for loading the Banner faster, it's probably due to the solid compression. Simply ReserveFile it on the top of the script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">16th July 2007, 20:17</div></div><div class="posttext">I spent some time stripping down my installer and discovered that it has something to do with the FindProcDLL I'm using, http://nsis.sourceforge.net/FindProcDLL_plug-in (although it may not be *specific* to that DLL).  If you double-click on &quot;install&quot; very quickly, you should see the error.  I've included the repro script below, and attached a screenshot of the error.<br />
<br />
<br />
SetCompressor /solid lzma<br />
<br />
;---- MUI ------------------<br />
!include &quot;MUI.nsh&quot;<br />
<br />
; Component selection page<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE verifyComponentReqs<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
;--- Project Settings --------<br />
OutFile &quot;Stripped_Installer.exe&quot;<br />
<br />
Section<br />
	SetOutPath &quot;C:\test_comp_page_click&quot;<br />
	SetOverwrite on<br />
	File /r &quot;C:\Program Files\NSIS\*&quot;<br />
SectionEnd<br />
<br />
Function verifyComponentReqs<br />
	FindProcDLL::FindProc &quot;does_not_exist.exe&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th July 2007, 20:28</div></div><div class="posttext">I still can't reproduce. Which version of NSIS are you using?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">16th July 2007, 20:38</div></div><div class="posttext">NSIS 2.28 - I am using several other plugins (but as I understand it, they won't be include if they aren't used).<br />
<br />
Otherwise the only file that's different from a stock install is the Banner.dll (due to the banner hanging bug,  forums.winamp.com/showthread.php?s=&amp;threadid=270838&amp;highlight=banner)<br />
<br />
You have to double-click very quickly in this sample... perhaps your computer is too fast? :)  In my production script you can wait a few seconds before the second click and still see the error.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">16th July 2007, 23:20</div></div><div class="posttext">Anders - thanks for you suggestion.  In case anyone else might find it useful, I used the following:<br />
<br />
<br />
FindWindow $1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
FindWindow $1 &quot;SysTreeView32&quot; &quot;&quot; $1<br />
EnableWindow $1 0<br />
<br />
<br />
kichik - Since I'm using the above workaround, I think our installer is okay for now but it's still probably better to figure out why the dialog is not blocking.  Would it help if I performed a clean install of NSIS and try to repro?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th July 2007, 23:25</div></div><div class="posttext">Please attach your script.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">16th July 2007, 23:38</div></div><div class="posttext">Hi Stu - I pasted the script in its entirety above, but here it is again as an attachment.<br />
<br />
Thanks - Andy</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th July 2007, 12:43</div></div><div class="posttext">Not that one :D<br />
I mean your actual script because we cannot reproduce the problem with that one.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">17th July 2007, 21:02</div></div><div class="posttext">Unfortunately I don't think my company would allow me to post my script in it's entirety... what I can do is try to come up with a more reproducible case.  I'll post again when I do.  Also if it helps I can make available a compiled setup.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd October 2007, 23:08</div></div><div class="posttext">Thanks, fixed. The decompression function messed with the message loop when it shouldn't have.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">4th October 2007, 02:00</div></div><div class="posttext">Thanks for the fix and update!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bobics</div><div class="date">17th October 2007, 23:23</div></div><div class="posttext">Hmm, I just added a custom dialog using nsDialogs.nsh and I saw the same type of installer crash when clicking on the &quot;Next&quot; button really quickly twice.  So I think this bug still exists.<br />
<br />
I'm using the same workaround of disabling the next button in the leave callback of the custom dialog.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th November 2007, 18:46</div></div><div class="posttext">I can't reproduce. I'll need an example again.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>