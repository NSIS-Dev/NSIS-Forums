<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" system.dll problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  system.dll problem NSIS Discussion" />
	
	<title> system.dll problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  system.dll problem</div>
<hr />
<div class="pda"><a href="t-207432.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=207432">system.dll problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dilox77</div><div class="date">10th February 2005, 17:00</div></div><div class="posttext">Hi everybody, I'm tring to link my nsis installer with ncd by sony.<br />
They give me dll, I put this into code:<br />
System::Call 'libpidex_dll::cdecl_Pid_init(i) i() .r1'<br />
System::Call 'libpidex_dll::cdecl_Pid_query_pid(t, i, *i) i(r2, r3, .r4) .r6'<br />
System::Call 'libpidex_dll::cdecl_Pid_close(t) i() .r7'<br />
<br />
now:<br />
$6 is 24, means lenght of key (ok)<br />
$4 Pointed to buffer for returned query PID strings.<br />
$4 is 16777216<br />
How can I read that pointer (memory address right?) by nsis?<br />
<br />
Thank's in advance.<br />
Regards, Pierluigi Di Lorenzo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th February 2005, 20:42</div></div><div class="posttext">Since you've used *, System.dll read the value pointed to by the pointer for you. The value is 16777216.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dilox77</div><div class="date">11th February 2005, 10:35</div></div><div class="posttext">Thank's kichik, but I think I'm missing something else.<br />
This is Query Pid synopsis:<br />
3: Query PID<br />
    Syntax<br />
	int Pid_query_pid(char *drive, BYTE *key, BYTE *dest);<br />
    Description<br />
	drive: Pointed to NULL terminated drive letter string.  e.g. &quot;D:&quot;<br />
	key:   Reserved. Please set NULL.<br />
	dest:  Pointed to buffer for returned query PID strings.<br />
	       We recommend at least 256 bytes for this buffer.<br />
	return:<br />
	     Negative value = Error code.<br />
	     Positive value = Number of bytes for return data.<br />
	     &quot;dest&quot; buffer structure.<br />
	     Byte 0-2 :Reserved. 3bytes are all zero. <br />
	     Byte 3   :Pid type. 0x00=Basic 0x01=Standard 0x02=Custom <br />
	     Byte 4-7 :Number of bytes for valid PID data from Byte[8].<br />
		       Little endian DWORD value.<br />
	     Byte 8-n :PID Data<br />
<br />
I do not understand c so much.. so I'm not so sure I call System.dll with correct values.<br />
<br />
Moreover.. this is test.cpp they give me:<br />
<br />
pid_init(0);<br />
			pidLen = pid_query_pid(&amp;drive, NULL, pid_data);<br />
<br />
			if(pidLen &gt; 0)<br />
			{<br />
				printf(&quot;\nPID from CD in Drive %c:\n\n%s\n&quot;, drive, CStr().Buffer2Hex(pid_data, pidLen));<br />
			}<br />
			else<br />
			{<br />
				printf(&quot;\nNo valid CD Drive or no PID on CD\n&quot;);<br />
			}<br />
			pid_close();<br />
<br />
After quering pid they have CStr().Buffer2Hex(pid_data, pidLen) function ( and result is something like: 00 00 00 01 10 00 00 00 00 00 00 00 00 00 00 00 00 00 00 04 00 00 27 A0), I think this is what I miss.<br />
<br />
Can somebody help me, please?<br />
Thanks in advance, Pierluigi Di Lorenzo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th February 2005, 11:17</div></div><div class="posttext">If the second parameter needs NULL, don't pass the value of a register such as $2, simply use n.<br />
<br />
Take a look at the only FAQ item in the System readme for information on the third parameter. It explains in detail how to pass a structure to a function and how to get the values of the structure. It's exactly what you should do in this case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dilox77</div><div class="date">11th February 2005, 15:07</div></div><div class="posttext">Great!<br />
I put this into code:<br />
<br />
System::Alloc 256<br />
Pop $4<br />
System::Call 'libpidex_dll::cdecl_Pid_init(i) i() .r1'<br />
System::Call 'libpidex_dll::cdecl_Pid_query_pid(t, i, i) i(r2, n, r4) .r6'<br />
System::Call 'libpidex_dll::cdecl_Pid_close(t) i() .r7'<br />
System::Call &quot;*$4(l.r8, l.r9, l.r10)&quot;<br />
System::Free $4<br />
<br />
and I get this three long:<br />
LONG                    HEX<br />
68753031168--&gt;00 00 00 10 02 00 00 00<br />
0---&gt;00 00 00 00 00 00 00 00<br />
-4612545568545505213---&gt;BF FC F2 3E 64 8B 00 43<br />
<br />
key with test.exe is:<br />
<br />
00 00 00 02 10 00 00 00 00 00 00 00 00 00 00 00 43 00 8B 64 3E F2 FC BF<br />
<br />
Results are the equals inverting longs.<br />
So.. it's possible to read ncd key from nsis :) (by libpidex_dll).<br />
<br />
Thanks again kichik!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>