<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Environment Variables:: Write/Change Them?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Environment Variables:: Write/Change Them? NSIS Discussion" />
	
	<title> Environment Variables:: Write/Change Them? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Environment Variables:: Write/Change Them?</div>
<hr />
<div class="pda"><a href="t-124089.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=124089">Environment Variables:: Write/Change Them?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kikolo</div><div class="date">6th February 2003, 10:18</div></div><div class="posttext">I have read some posts about how to write Environment Variables Permantently, but i need to write/set them on install running to test the DB Connection.<br />
The program that connects with DataBase reads Settings from Environment Variables like DBDATE, DBTEMP, DBSERVER and others that the installer sets into installoptions 'forms'/'pages', but i need them on the environment to test the connection on the next page, but i only read about reading env. vars. and write them on the registry or the autoexec, but this option needs to reboot.<br />
Resume: How Can I write/change Env. Vars. on installer execution?<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2003, 11:23</div></div><div class="posttext">http://nsis.sourceforge.net/archive/viewpage.php?pageid=91</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mark_Ive</div><div class="date">6th February 2003, 11:25</div></div><div class="posttext">Hi there, this is how i would write an environment variable<br />
<br />
WriteRegStr HKEY_LOCAL_MACHINE &quot;SYSTEM\CurrentControlSet\Control\Session Manager\Environment&quot; &quot;Env Name&quot; &quot;Env Value&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2003, 11:26</div></div><div class="posttext">That only works on Windows NT. The functions I have posted above work with Windows 9x too.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kikolo</div><div class="date">6th February 2003, 13:42</div></div><div class="posttext">RePlay: sorry about my english, but maybe i said something different that i thonk (thonk? thinked? what is the past of to think?)<br />
Example:<br />
One Install Script<br />
PAge 1 Welcome<br />
Page 2 License<br />
Page 3 Components<br />
Page 4 Custom Page With Input Text Boxes<br />
Page 5 Custom Page With DB connection test<br />
Page 6 Custon Page that shows information about connection<br />
Page 7 Install Rest of Components<br />
Page 8 Bye Bye<br />
<br />
In The Page 6 i read a file written by Program on Page 5<br />
In The Page 5 i call an executable that read the Environment Variables to Test an DataBase Connection.<br />
In the Page 4 i do an input of the variables that i need in the Page 5.<br />
In The solutions that you give me, i need to install,reboot and test de connection, <br />
if the connection dont work the user must repeat the install!?!?!<br />
<br />
Resume: How Can I Change/SetUp/Write Variables to Environment Directly during execution, not to registry, not to autoexec.bat?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">6th February 2003, 13:53</div></div><div class="posttext">past of think is thought</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th February 2003, 17:10</div></div><div class="posttext">I am sorry. I haven't read your question to the end. :(<br />
<br />
Here is how you do it without the need to create a plug-in:<br />
System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;name&quot;, &quot;value&quot;).r0'<br />
StrCmp $0 0 error<br />
	Exec &quot;other proggie.exe&quot;<br />
<br />
Replace &quot;name&quot; with the name of the environment variable and &quot;value&quot; with it's value. Repeat this line (System::Call...) for every variable you need to set.<br />
<br />
If you don't want to include System.dll in your installer (9KB) then you'll have to write a nice little plug-in that calls SetEnvironmentVariable.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kikolo</div><div class="date">7th February 2003, 08:59</div></div><div class="posttext">thank you! :up:<br />
it works fine,<br />
at the moment i will use the system.dll, in future... maybe a new little dll.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">21st February 2003, 16:04</div></div><div class="posttext">Does this work with nsExec as well?<br />
Or just for the Exec functions?<br />
---<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">21st February 2003, 16:05</div></div><div class="posttext">Yes, it works for nsExec as well as both use CreateProcess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kikolo</div><div class="date">10th March 2003, 09:02</div></div><div class="posttext">--- La Función - The Function ---<br />
System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;name&quot;, &quot;value&quot;).r0'<br />
--- La Función - The Function ---<br />
<br />
--- Post in Spanish ---<br />
Hola<br />
La función System::Call funcionó bien, hasta que empecé a realizar debug y control de errores, fue entonces cuando descubri que cada vez que se utiliza la función, el flag de error se activa, y pierdo el control de los errores, y se me escapa por algun lado.<br />
¿tengo alguna otra manera de hacer lo mismo con otro dll ya existente?<br />
Muchas Gracias y Saludos Totales :P<br />
KiKoLo<br />
--- Post in Spanish ---<br />
--- Post in ... Spanglish? ---<br />
Hi<br />
The Function System::Call worked fine, but when i started to do debug and error hadler control, i discover that when i use the function, the error flag activates, and i miss the control of the error handles and it scapes anywhere.<br />
¿Can i do the same with an existent dll?<br />
Lots of Thanks and SALUDOS TOTALES :P<br />
KiKoLo<br />
--- Post in ... Spanglish? ---<br />
<br />
--- Ejemplo - Example ---<br />
Name &quot;Tester&quot;<br />
OutFile &quot;..\bin\testing.exe&quot;<br />
   Section &quot;Testing&quot;<br />
      Push $R0<br />
      StrCpy $R0 &quot;I&quot;<br />
      DetailPrint &quot;DEBUG_TRACE[$0]: (REG) INFODB = [$R0]&quot;<br />
      System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;INFODB&quot;, &quot;$R0&quot;).r0'<br />
      DetailPrint &quot;DEBUG_TRACE[$0]: (ENV) INFODB = [$R0]&quot;<br />
      Pop $R0<br />
   SectionEnd<br />
--- Ejemplo - Example ---<br />
<br />
Thank you for all darkboy ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">10th March 2003, 20:23</div></div><div class="posttext">!define Spanish_Post :p<br />
<br />
KiKoLo: Tu mensaje en el foro está bien redactado, les explicas que<br />
tienes un error al usar el plugin System al usar Debug, y que este<br />
error no lo puedes controlar.<br />
Ayuda el hecho de que hayas puesto parte de tu código.<br />
<br />
<br />
!define English_Post ;)<br />
<br />
KiKoLo: you post in english is ok. When you use the System plugin with<br />
the debug and error handlers, you starting to recived error that you<br />
can't handle...<br />
It helps that you put part of your code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kikolo</div><div class="date">11th March 2003, 08:02</div></div><div class="posttext">I made a plugin dll (SetEnv.dll) to do this. <br />
And Works when the other way doesnot<br />
explanation...<br />
<br />
Name &quot;Tester&quot;<br />
OutFile &quot;..\bin\testing.exe&quot;<br />
<br />
   Section &quot;Testing&quot;<br />
      Push $R0<br />
      Push $R1<br />
      StrCpy $R0 &quot;PATH&quot;<br />
<br />
      ReadEnvStr $R1 &quot;$R0&quot;<br />
      MessageBox MB_OK &quot;Before Modify Var: PATH = $R1&quot;<br />
<br />
      StrCpy $R1 &quot;C:\MYAPP;$R1&quot;<br />
      MessageBox MB_OK &quot;Before Set Env Var: PATH = $R1&quot;<br />
<br />
      System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(&quot;$R0&quot;, &quot;$R1&quot;).r0'<br />
<br />
      ReadEnvStr $R1 &quot;$R0&quot;<br />
      MessageBox MB_OK &quot;After Set and Get: PATH = $R1&quot;<br />
<br />
      Pop $R1<br />
      Pop $R0<br />
   SectionEnd<br />
<br />
Messages:<br />
Before Modify Var: PATH = C:\Archivos de Programa\TextPad 4;P:\Bin_Unstable;D:\UTILES\MKSNT;C:\WINNT\System32;C:\WINNT;C:\WINNT\System32\WBem;&quot;C:\Archivos de Programa\Norton\Ghost\&quot;;&quot;C:\Archivos de programa\NullSoft\NSIS&quot;;D:\UTILES\COMP<br />
---<br />
Before Set Env Var: PATH = C:\MYAPP;C:\Archivos de Programa\TextPad 4;P:\Bin_Unstable;D:\UTILES\MKSNT;C:\WINNT\System32;C:\WINNT;C:\WINNT\System32\WBem;&quot;C:\Archivos de Programa\Norton\Ghost\&quot;;&quot;C:\Archivos de programa\NullSoft\NSIS&quot;;D:\UTILES\COMP<br />
---<br />
After Set and Get : PATH = <br />
<br />
If I replace the system call with <br />
SetEnv:SetEnvVar &quot;$R0&quot; &quot;$R1&quot;<br />
It Works and the last message shows like<br />
After Set and Get : PATH = C:\MYAPP;C:\Archivos de Programa\TextPad 4;P:\Bin_Unstable;D:\UTILES\MKSNT;C:\WINNT\System32;C:\WINNT;C:\WINNT\System32\WBem;&quot;C:\Archivos de Programa\Norton\Ghost\&quot;;&quot;C:\Archivos de programa\NullSoft\NSIS&quot;;D:\UTILES\COMP<br />
<br />
<br />
The file is the SetEnv Plugin, anybody knows how can i upload it to downloads section in the official page?<br />
Thanks for everybody and... <br />
   ¡¡¡Saludos Totales!!!! <br />
      yeah!<br />
<br />
KiKoLo<br />
NOTAS<br />
NOTA 1: No tengo ni puta idea de C, pero con los ejemplos que tenian, y el msdn, no fue dificil hacerlo.<br />
NOTA 2: Mi inglés es pésimo, está oxidado asi que si alguien no lo entiende, lo siento, es hasta donde puedo llegar<br />
NOTA 3: Descomprimir quedando SenEnv como un directorio mas del Contrib debajo del NSIS (NSIS\Contrib\SetEnv) porque coge el ..\exdll\exdll.h y despues mover el setenv.dll a NSIS\Plugins<br />
<br />
NOTES<br />
NOTE 1: I have no idea about C, but with the examples anda with the MSDN it does not be dificult to do.<br />
NOTE 2: Sorry about my english :D <br />
NOTE 3: Extract It on a Dir behind Contrib 'cause it take the ..\exdll\exdll.h and then move the setenv.dll to NSIS\Plugins</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">11th March 2003, 08:19</div></div><div class="posttext">Please attach in .zip, because someone could not have the WinRAR program. (I don't have!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kikolo</div><div class="date">11th March 2003, 08:32</div></div><div class="posttext">jeje, i don't have winzip :D<br />
but a serious app like winrar give you the posibility to compress to an uneficient algorithm like winzip xDDDD (dont worry, is a joke)<br />
I only have winrar 'cause it give me more flexibility and better ratios, but winzip is more... more... marketizing XD<br />
Saludos Totales</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th March 2003, 15:12</div></div><div class="posttext">The problem is that you have quotes inside that environment variable. You can use it this way:<br />
<br />
StrCpy $R0 &quot;name&quot;<br />
StrCpy $R1 &quot;value&quot;<br />
System::Call 'Kernel32::SetEnvironmentVariableA(t, t) i(R0, R1).r0'<br />
StrCmp $0 0 error<br />
    Exec &quot;other proggie.exe&quot;<br />
<br />
Replace StrCpy with whatever function you need and it should work. If it doesn't try putting a dot  before R0 and R1 in the System::Call line. Try one of them, and try both, not sure which one should work.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>