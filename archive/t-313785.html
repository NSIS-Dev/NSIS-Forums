<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Extract &amp; parse command line output, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Extract &amp; parse command line output NSIS Discussion" />
	
	<title> Extract &amp; parse command line output [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Extract &amp; parse command line output</div>
<hr />
<div class="pda"><a href="t-313785.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=313785">Extract &amp; parse command line output</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">13th October 2009, 20:20</div></div><div class="posttext">What is the best method for parsing the output from a commandline tool?  If this was C#, I'd probably just use a regular expression...<br />
<br />
Sample commandline output:<br />
<br />
CLUSTER_NAME   STATUS   MASTER_HOST               ADMIN    HOSTS  SERVERS<br />
trg7u4         ok       symph9               abcadmin       23       21<br />
trg7demo       ok       foo                  abcadmin       12       11<br />
<br />
I need to extract &quot;trg7u4&quot; and &quot;abcadmin&quot; from that spew.  I'd use something like nsExec::ExecToStack to run the program.  I've ran across the NSISpcre_plug-in (http://nsis.sourceforge.net/NSISpcre_plug-in) for REGEX. Also found arrays plugin (http://nsis.sourceforge.net/Arrays_in_NSIS) which could be another option.<br />
<br />
Any other better/efficient methods to get the data I need?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">19th October 2009, 05:46</div></div><div class="posttext">No recommended methods for parsing commandline output eh?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">19th October 2009, 08:55</div></div><div class="posttext">This can be done using only StrCpy, StrLen and StrCmp. Also, I think ExecToLog is what you're looking for, not ExecToStack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">23rd October 2009, 06:00</div></div><div class="posttext">Originally posted by MSG <br />
This can be done using only StrCpy, StrLen and StrCmp.  <br />
Hows that? The spacing and names of those fields change depending on the users setup.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">23rd October 2009, 07:11</div></div><div class="posttext">I would start with searching for two spaces in a row. Then skip all spaces, and voila I'm at the beginning of the next column. Do this for x columns and you're at the ADMIN column. Similarly, reading the entry would simply be a matter of reading all data until the first double space. (Or the first space, if the data cannot contain spaces.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">BSOD2600</div><div class="date">23rd October 2009, 09:50</div></div><div class="posttext">Ended up using a ghetto solution in conjunction with StrTok<br />
<br />
<br />
    nsExec::ExecToStack /TIMEOUT=${EXECTIMEOUT} '&quot;command&quot;'<br />
    Pop $0 # return value/error/timeout<br />
    Pop $1 # printed text, up to ${NSIS_MAX_STRLEN}<br />
        ; Need better way to skip to the 2nd line of the LSCLUSTERS command output...<br />
        <br />
        ;write COMMAND output to file to easily read/parse<br />
        FileOpen $0 $PLUGINSDIR\command.log w        <br />
        FileWrite $0 &quot;$1&quot;        <br />
        FileClose $0<br />
        <br />
        ;re-open file we just wrote. skip to the 2nd line<br />
        FileOpen $0 $PLUGINSDIR\command.log r<br />
        FileRead $0 $1  ; headers<br />
        FileRead $0 $2  ; first row, which should be the localhost details<br />
        FileClose $0<br />
        MessageBox MB_OK &quot;command_2: $2&quot;        <br />
        ${StrTok} $5 &quot;$2&quot; &quot; &quot; &quot;0&quot; &quot;1&quot;   ;cluster name<br />
        ${StrTok} $6 &quot;$2&quot; &quot; &quot; &quot;2&quot; &quot;1&quot;   ;cluster master<br />
        ${StrTok} $7 &quot;$2&quot; &quot; &quot; &quot;3&quot; &quot;1&quot;   ;cluster admin<br />
        MessageBox MB_OK &quot;tok0: $5. tok2: $6. tok3: $7.&quot;<br />
        <br />
        StrLen $R1 $5 ;cluster name<br />
        ${If} $R1 &gt; 0<br />
            StrCpy $Cluster_Name $5            <br />
        ${EndIf}<br />
        <br />
        StrLen $R1 $6 ;cluster master<br />
        ${If} $R1 &gt; 0<br />
            StrCpy $Cluster_Master $6<br />
        ${EndIf}<br />
        <br />
        StrLen $R1 $7 ;cluster admin<br />
        ${If} $R1 &gt; 0<br />
            StrCpy $Cluster_User $7<br />
            !insertmacro INSTALLOPTIONS_WRITE &quot;cluster_account.ini&quot; &quot;Field 1&quot; &quot;State&quot; &quot;.\$Cluster_User&quot;<br />
        ${EndIf}</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>