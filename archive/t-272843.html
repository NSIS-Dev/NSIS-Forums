<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How can I execute a batch file?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How can I execute a batch file? NSIS Discussion" />
	
	<title> How can I execute a batch file? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How can I execute a batch file?</div>
<hr />
<div class="pda"><a href="t-272843.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=272843">How can I execute a batch file?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">15th June 2007, 06:06</div></div><div class="posttext">I'm trying to execute a .bat file in a function. I used<br />
<br />
Exec $INSTDIR\installRCB.bat<br />
<br />
But the file is not executed. I see a command window pop up very briefly, but nothing more. Is Exec supposed to work only with .exe files? Is there a way to execute the .bat file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">15th June 2007, 06:39</div></div><div class="posttext">There are several ways to execute a batch file. Check this forum thread (http://forums.winamp.com/showthread.php?postid=2054461#post2054461) for several ways. It depends whether you want the script to wait, if you want the command window to be visible, if you need to capture or redirect the batch output.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">15th June 2007, 06:43</div></div><div class="posttext">I've seen other examples where batch files are executed with Exec, so I must be doing something wrong. Here's how I invoke the function<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE installServices<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
and here's the function:<br />
<br />
Function installServices<br />
    Exec '$INSTDIR\installRCB.bat'<br />
FunctionEnd<br />
<br />
The file installRCB.bat is verified to be in $INSTDIR, and if I execute it manually it runs properly. But when executed from the installer, nothing happens. I've tried ExecWait also, and every permutation of single and double quotes, to no avail.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">15th June 2007, 07:00</div></div><div class="posttext">Looks like I had more of a scripting problem than an NSIS issue. I had relative path references in my batch file, which were not working when the script was executed from the installer. The script was written assuming it would be executed from the directory that equates to $INSTDIR in the installer. But apparently .bat files run from within the installer do not execute from $INSTDIR. Thanks for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">15th June 2007, 07:04</div></div><div class="posttext">NSIS Exec can start binary file only, bat files managed by shell. First way is to use ExecShell, but this flashes black console window. So find something sutable for you in the forum 'search' on ComSpec keyword http://forums.winamp.com/search.php?s=&amp;action=showresults&amp;searchid=8848027&amp;sortby=lastpost&amp;sortorder=descending</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">15th June 2007, 13:01</div></div><div class="posttext">Actually it's working now. I was trying to say that in my last post, but I wasn't very clear. I was executing a .bat file that had two lines in it. Each line was calling another .bat script, identifying them using relative path references whose base path is the path location where the first .bat file was executing (the directory that the NSIS installer knows as $INSTDIR).<br />
<br />
Since the NSIS installer was executing from the location where the setup file was located, which is not $INSTDIR, it was unable to resolve the two relative path references in the .bat file I was calling from the installer. That's why I was seeing the cmd window pop up momentarily. It was executing the .bat file, but it was unable to find any command that was meaningful.<br />
<br />
To resolve the problem I eliminated the .bat file that was calling the other two .bat files. Instead I just call each of those .bat files directly from the installer, using two successive Exec commands.<br />
<br />
Because of this, and several other examples I saw by searching the forum, it seems clear that Exec does indeed support execution of .bat files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th June 2007, 13:02</div></div><div class="posttext">I would recommend that you use COMSPEC /C (as suggested) to execute the batch files just in case.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">15th June 2007, 22:01</div></div><div class="posttext">OK I see what COMSPEC is about, and I'll use that if you think it's a more universal solution. But what about using nsExec instead of the /C switch with COMSPEC? I imagine COMSPEC /C will still flash the cmd window momentarily, while nsExec won't? And should i still use COMSPEC with nsExec?<br />
<br />
But more to the point, how do I get info on how to use nsExec? I went to the NSIS plug-in page and it's not listed. I have the .dll file in my NSIS plug-ins directory, but the only info I can gather is a list of nsExec functions at the top of my compiler output.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">15th June 2007, 23:32</div></div><div class="posttext">Originally posted by MidnightJava <br />
OK I see what COMSPEC is about, and I'll use that if you think it's a more universal solution. But what about using nsExec instead of the /C switch with COMSPEC? I imagine COMSPEC /C will still flash the cmd window momentarily, while nsExec won't? And should i still use COMSPEC with nsExec?<br />
<br />
But more to the point, how do I get info on how to use nsExec? I went to the NSIS plug-in page and it's not listed. I have the .dll file in my NSIS plug-ins directory, but the only info I can gather is a list of nsExec functions at the top of my compiler output.  <br />
I think you have point here, probably nsExec would do the job as you mentioned.<br />
<br />
See under your local nsis installation into folders documents and examples for info about nsExec.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th June 2007, 12:18</div></div><div class="posttext">nsExec with COMSPEC will work fine.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MidnightJava</div><div class="date">17th June 2007, 05:15</div></div><div class="posttext">Just to close the loop here:<br />
<br />
Both Exec and nsExec worked fine and did what I needed. I implemented as follows:<br />
<br />
Function installServices<br />
    ReadEnvStr $0 COMSPEC<br />
    nsExec::Exec  '$0 /c &quot;$INSTDIR\RCBClient\bin\InstallRCBClient-NT.bat&quot;'<br />
    nsExec::Exec  '$0 /c &quot;$INSTDIR\RCBServer\bin\InstallRCBServer-NT.bat&quot;'<br />
FunctionEnd<br />
<br />
Using Exec /c instead of nsExec::Exec worked similarly. In the former case, the cmd window shows up briefly and then disappears after the .bat file completes execution. With nsExec, the cmd window never shows up. Interestingly, the /C is needed with nsExec; otherwise the services are not installed.<br />
<br />
Since it worked without COMSPEC, I believe the rationale for adding COMSPEC was to ensure compatibility with W2K and XP. However, I'm still having trouble reconciling what I've seen with Takhir's statement that NSIS Exec only works with binary files, and that ExecShell is needed for .bat files. I've read the documentation on Exec and ExecShell, and I'm still not clear on what the distinction is and when to use either of them. The documentation supports Takhir's statement, but my experience seems to bely what the documentation says.<br />
<br />
But it is working, and I'm grateful for all the helpful comments.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th June 2007, 06:42</div></div><div class="posttext">Exec uses CreateProcess and ExecShell uses ShellExecute (ExecShell can launch anything, a url, a text file, a pdf)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th June 2007, 09:22</div></div><div class="posttext">You might want to put quotes around $0 in the execution line in case the path contains spaces.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>