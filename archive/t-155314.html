<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System Restore Point, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System Restore Point NSIS Discussion" />
	
	<title> System Restore Point [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System Restore Point</div>
<hr />
<div class="pda"><a href="t-155314.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=155314">System Restore Point</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">6th November 2003, 06:00</div></div><div class="posttext">Is there a way to get an NSIS installer to create a Windows System Restore Point.  Also how does the system restore descide which files it should 'protect'?<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2003, 11:15</div></div><div class="posttext">MSDN is your best friends when it comes to Windows API:<br />
<br />
http://msdn.microsoft.com/library/en-us/sr/sr/system_restore_api.asp</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">6th November 2003, 22:04</div></div><div class="posttext">After a look at MSDN pages related to this I think that the easiest thing would be to use the system plugin to do this.<br />
<br />
One question since I am not very familiar with the MSDN:  The RESTOREPOINTINFO structure has a couple of DWORD parameters, e.g. BEGIN_SYSTEM_INSTALL and APPLICATION_INSTALL etc. Where do I find the definitions of these constants so I can define them in NSIS.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th November 2003, 23:19</div></div><div class="posttext">You need to dig it from the header files. The MSDN page specifies which one it is. In this case, SRRestorePtAPI.h. The header files come with the Platform SDK, which is freely available for download from MSDN. To save you the trouble:<br />
<br />
!define MIN_EVENT 100<br />
!define BEGIN_SYSTEM_CHANGE 100<br />
!define END_SYSTEM_CHANGE 101<br />
!define BEGIN_NESTED_SYSTEM_CHANGE 102 # for Whistler only - use this to prevent nested restore pts<br />
!define END_NESTED_SYSTEM_CHANGE 103 # for Whistler only - use this to prevent nested restore pts<br />
!define MAX_EVENT 103<br />
<br />
#<br />
# Type of Restore Points<br />
#<br />
<br />
!define MIN_RPT 0<br />
!define APPLICATION_INSTALL 0<br />
!define APPLICATION_UNINSTALL 1<br />
!define DESKTOP_SETTING 2 # Not implemented<br />
!define ACCESSIBILITY_SETTING 3 # Not implemented<br />
!define OE_SETTING 4 # Not implemented<br />
!define APPLICATION_RUN 5 # Not implemented<br />
!define RESTORE 6<br />
!define CHECKPOINT 7<br />
!define WINDOWS_SHUTDOWN 8 # Not implemented<br />
!define WINDOWS_BOOT 9 # Not implemented<br />
!define DEVICE_DRIVER_INSTALL 10<br />
!define FIRSTRUN 11<br />
!define MODIFY_SETTINGS 12<br />
!define CANCELLED_OPERATION 13 # Only valid for END_SYSTEM_CHANGE<br />
!define BACKUP_RECOVERY 14</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">7th November 2003, 01:06</div></div><div class="posttext">Sorry about this but do you need to specify the dll file that contains the 'SRSetRestorePoint' function when you use the system::call and if so does anyone know which dll that would be?<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">7th November 2003, 03:29</div></div><div class="posttext">It's alright I figgured out which dll has the right function.  However when I call it it does not seem to create a restore point.<br />
<br />
When called it returns the error code 127, not sure what that actually means.  Is it possible that a restore point is only created if there was a system change?<br />
<br />
Attached is a test script.<br />
<br />
Vytautas :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th November 2003, 08:04</div></div><div class="posttext">127 means the function could not be found. Use this program (http://www.gregorybraun.com/MSWinErr.html) to convert error code to text. There are a lot others, but this one came first on Google. If you're using the latest CVS version it's probably because the System plug-in couldn't findSRSetRestorePoint so it looked for SRSetRestorePointA and kept the error behind. If you're not using the latest CVS version, you must append the A to the function name.<br />
<br />
Now, for the reason it's not working... You can't pass the struct's items as function parameters. You must allocate memory for the struct and pass a pointer to it. See System examples for an example of allocating and using a struct (WNDCLASS for example).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>