<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Dynamically changing the text of labels with transparent Bg, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Dynamically changing the text of labels with transparent Bg NSIS Discussion" />
	
	<title> Dynamically changing the text of labels with transparent Bg [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Dynamically changing the text of labels with transparent Bg</div>
<hr />
<div class="pda"><a href="t-319481.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319481">Dynamically changing the text of labels with transparent Bg</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">27th May 2010, 16:26</div></div><div class="posttext">I need to change some labels on a custom page, based on user input. That normally wouldn't be a problem but I changed the labels' colors, with Bgcolor set to transparent, and so when I change a label, the old text remains and overlaps with the new one. I could use a solid Bgcolor but it looks crappy. I could also recolor the whole dialog and all the controls but I was hoping for a more elegant solution.<br />
My real problem is that SetCtlColors doesn't accept variables. If it did, I could get the dialog Bgcolor at runtime and use that instead of transparent (I already coded that part before I remembered I can't use it).<br />
Any possible workarounds? It's not like it would kill me to use the default font color but I'd like to know. If there's no relatively simple solution, don't bother because it's not worth it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th May 2010, 17:53</div></div><div class="posttext">This has been discussed before. One possible simple solution is to hide and show the window with ShowWindow but for some reason it does not work in all cases.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">27th May 2010, 17:58</div></div><div class="posttext">Here's the code I use which I haven't seen failing yet.. but it's far from ideal.<br />
<br />
<br />
!macro RedrawControl control<br />
  Push $0<br />
  StrCpy $0 ${control}<br />
  EnableWindow $0 0<br />
  System::Call &quot;user32::InvalidateRect(i,i,i)i (r0, 0, 1)&quot;<br />
  EnableWindow $0 1<br />
  Pop $0<br />
!macroend<br />
!define RedrawControl `!insertmacro RedrawControl`<br />
<br />
<br />
There's a use example in this post:<br />
http://forums.winamp.com/showthread.php?p=2499582</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th May 2010, 18:00</div></div><div class="posttext">Why is the first EnableWindow before the StrCpy and not after?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">27th May 2010, 18:40</div></div><div class="posttext">because I fail at plucking the code out and pasting it into posts ;)<br />
( to answer the question.. the code I had pasted is not even wrong )<br />
<br />
Edit: and to answer a potential follow-up question of 'why are you using EnableWindow in the first place'; can't find the check-in notes after moving from CVS to SVN, but it was probably because of some redraw issue.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">27th May 2010, 20:28</div></div><div class="posttext">Thanks, InvalidateRect does the job. Only it doesn't work when I pass hwnd of a single control, I have to redraw the whole dialog (which is also fine).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">28th May 2010, 10:46</div></div><div class="posttext">I would still appreciate any tips on how to replace SetCtlColors with api calls. If I could use variables, I could finally get around that win theming issue and change the color of chkboxes and other controls that turn black when Bg is set to transparent, black was never transparent enough for my standards.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th May 2010, 16:03</div></div><div class="posttext">Today is your lucky day :)<br />
http://nsis.sourceforge.net/SetCtlColors_with_variables<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">28th May 2010, 16:57</div></div><div class="posttext">:up: :up: :up: :up: :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">28th May 2010, 19:25</div></div><div class="posttext">Tested and works like a charm. Thank you so much!<br />
<br />
I'd like to contribute my code for retrieving the dialog Bgcolor, for usage with your function:<br />
System::Call &quot;user32::GetSysColor(i 15) i. R0&quot;<br />
IntFmt $R0 &quot;%06X&quot; $R0<br />
StrCpy $1 $R0 2 4<br />
StrCpy $0 $R0 2 2<br />
StrCpy $1 $1$0<br />
StrCpy $0 $R0 2<br />
StrCpy $DlgBgColor &quot;0x$1$0&quot;<br />
...<br />
${SetCtlColors} $HWND_Ctl_x ${FgColor} $DlgBgColor $Memory_Ctl_x<br />
This code will fail aesthetically in case the user decides to change the theme while the page is shown, but the chances of that happening are small enough.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th May 2010, 19:37</div></div><div class="posttext">You don't need to convert the return value from GetSysColor to hexadecimal. The first IntOp in the SetCtlColors function converts it to an integer anyway (before it is converted to BBGGRR). In other words, this function accepts integer or hexadecimal colour values.<br />
<br />
Edit: And just to be sure for anyone who uses the code; $Memory_Ctl_x must be freed on installer close:<br />
Function .onGUIEnd<br />
System::Free $Memory_Ctl_x<br />
FunctionEnd<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">29th May 2010, 00:58</div></div><div class="posttext">I realized I still can't recolor checkboxes. Bg doesn't turn black anymore but the text color is always stuck to default (when I first tested, all controls were set to a dark color so I didn't notice the difference). Disabling theming seems to be the only working solution again, but instead of using XPStyle Off, I learned how to disable it for a a specific control (also courtesy of Afrow UK):<br />
System::Call &quot;uxtheme::SetWindowTheme(i$HWND,w' ',w' ')&quot;<br />
And the custom SetCtlColors wasn't coded in vain, it solves the issue for which I started this thread. It beats the InvalidateRect method because the dialog is not redrawn so there's no flickering.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">29th May 2010, 09:18</div></div><div class="posttext">Good job. Your other option would be to use a static text (label) next to the check box and assign an onclick to it. This way is simpler though (even if the theme is gone). These kind of macros could be included in nsDialogs.nsh, except the annoyance with SetCtColors having to free the allocated memory yourself. Will see what kichik thinks.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>