<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" admin right to set up, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  admin right to set up NSIS Discussion" />
	
	<title> admin right to set up [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  admin right to set up</div>
<hr />
<div class="pda"><a href="t-331115.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=331115">admin right to set up</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">shazia.parveen</div><div class="date">31st May 2011, 13:10</div></div><div class="posttext">How can I make sure the user installing my software has admin rights as i am making setup using Nsis  scripting language, and should applicable for all OS (Windows,XP).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">31st May 2011, 15:32</div></div><div class="posttext">1) In .onInit, use the UserInfo plugin to verify admin access. If it's not admin, throw a messagebox error and quit.<br />
2) To allow Vista/7 UAC to handle things more gracefully, you may also want to add 'requestexecutionlevel admin' to your script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shazia.parveen</div><div class="date">31st May 2011, 16:22</div></div><div class="posttext">Thanks MSG for your reply<br />
how can i use the userinfo plugin ,can you provide me any link or any code help where i can get all the details</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">31st May 2011, 20:23</div></div><div class="posttext">Hmm... Try googling for 'nsis userinfo plugin'. Also, the userinfo plugin comes shipped with NSIS, so check NSIS\Examples\UserInfo\UserInfo.nsi .<br />
<br />
As you can see, all the information is out there. You just need to be brave enough to search for it, before asking others for the solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st May 2011, 20:24</div></div><div class="posttext">http://pastebin.com/EvMkyLLt</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">31st May 2011, 20:29</div></div><div class="posttext">Say Anders, does Windows automatically set an errorlevel if UAC elevation fails?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st May 2011, 22:04</div></div><div class="posttext">Say Anders, does Windows automatically set an errorlevel if UAC elevation fails?<br />
<br />
Errorlevel is really a DOS/batch thing, windows processes have exit codes.<br />
<br />
Most of the elevation operation takes place in the parent process (ShellExecuteEx calls the UAC service, that service probably calls CreateProcessAsUser or something like that) If the error happens there, ShellExecuteEx would return false and you would call GetLastError to get the error code (No process was created so there is no process exit code) You can get ERROR_CANCELLED etc from GetLastError.<br />
<br />
It is also possible to get a process that dies early (never really gets started, missing dll import etc) with a valid SHELLEXECUTEINFO.hProcess, you could call GetExitCodeProcess on that handle and get a process exit code. ShellExecuteEx would return true here since it did actually start the process, the problem is with the child process. What the exit code is would be up to the windows loader, c runtime or the code in WinMain depending on where the error happens or if the process runs as normal.<br />
<br />
As far as NSIS goes, ExecShell will set the error _flag_ if it fails but there is no way to get the actual error code from ShellExecute without calling it directly with the system plugin...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st June 2011, 05:09</div></div><div class="posttext">Err yeah, exit code. Very informative, thank you!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shazia.parveen</div><div class="date">1st June 2011, 12:32</div></div><div class="posttext">Thanks Anders for your help <br />
i made changes it and run on both  XP and Vista system but only the difference is that in Xp message box is shown &quot;Administrator rights required!&quot; but in vista no message box is coming with the same code,as you have provided in the link waiting for the reply<br />
============================================<br />
Outfile &quot;RequireAdmin.exe&quot;<br />
<br />
RequestExecutionLevel admin ;Require admin rights on NT6+ (When UAC is turned on)<br />
<br />
!include LogicLib.nsh<br />
<br />
Function .onInit<br />
UserInfo::GetAccountType<br />
pop $0<br />
${If} $0 != &quot;admin&quot; ;Require admin rights on NT4+<br />
 MessageBox mb_iconstop &quot;Administrator rights required!&quot;<br />
 SetErrorLevel 740 ;ERROR_ELEVATION_REQUIRED<br />
 Quit<br />
${EndIf}<br />
FunctionEnd<br />
<br />
  Section<br />
  SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shazia.parveen</div><div class="date">1st June 2011, 12:35</div></div><div class="posttext">Hmm... Try googling for 'nsis userinfo plugin'. Also, the userinfo plugin comes shipped with NSIS, so check NSIS\Examples\UserInfo\UserInfo.nsi .<br />
<br />
As you can see, all the information is out there. You just need to be brave enough to search for it, before asking others for the solution.<br />
<br />
Thanks MSG</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st June 2011, 12:51</div></div><div class="posttext">in Xp message box is shown &quot;Administrator rights required!&quot; but in vista no message box is coming<br />
Then that probably means that you're already an admin user, on your Vista PC.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shazia.parveen</div><div class="date">1st June 2011, 12:59</div></div><div class="posttext">Hi Msg actually after running the setup with no admin right account only  it is showing the login page for administrator to login for administrative right it is not showing the message box &quot;Administrator rights required!&quot; in Vista as it was showing in Xp.<br />
<br />
Actually when i turned off UAC in case of Vista then  it is showing the message box &quot;Administrator rights required!&quot; but when UAC is turned on in case of Vista no message box is coming only it is showing the login page for administrator .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shazia.parveen</div><div class="date">1st June 2011, 14:17</div></div><div class="posttext">In no admin right account when i turned off UAC in case of Vista then it is showing the message box &quot;Administrator rights required!&quot; but when UAC is turned on in case of Vista no message box is coming only it is showing the login page for administrator . waiting for the reply.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">1st June 2011, 15:28</div></div><div class="posttext">It's doing exactly what it should - this is how UAC is designed to operate. There is nothing you can do about it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">1st June 2011, 21:41</div></div><div class="posttext">If you always want the messagebox, use &quot;RequestExecutionLevel user&quot; (There is no reason to do this, and the exe will not get the UAC icon overlay)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">2nd June 2011, 06:11</div></div><div class="posttext">Not only is there no reason to do that, but it also makes things worse: Many users don't know how to 'Run as Admin', because they rely on UAC to do the elevation for them. If you request user, and then enforce admin, many people won't understand how to use the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shazia.parveen</div><div class="date">2nd June 2011, 11:44</div></div><div class="posttext">Thanks so much for your support</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>