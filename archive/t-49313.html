<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Better compression, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Better compression NSIS Discussion" />
	
	<title> Better compression [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Better compression</div>
<hr />
<div class="pda"><a href="t-49313.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=49313">Better compression</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nels</div><div class="date">8th May 2001, 23:01</div></div><div class="posttext">Hi everybody,<br />
<br />
After many tests, it seemed that BZIP2 was much better than ZLIB (espacially for text files). Is it possible to include BZIP2 compression in NSIS? Are there any problems in doing this? If so, maybe I can help (a bit because I'm not a hardcore coder ;).<br />
<br />
Thanks for the great software ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">9th May 2001, 19:11</div></div><div class="posttext">I'm not really an expert on this but you have to keep in mind:<br />
- how big is the decompression routine? NSIS tries to be only 36 KB. Maybe the bzip2 routine is more complex?<br />
- Is Bzip2 open-source/unpatented? It may be open-source, but the advantage of ZLib is that it doesn't contain any patented stuff, thus it can't infringe them or cause legal problems.<br />
<br />
Then again, only justin himself knows why he choose ZLib (I've been using it for about a year now and I like it - fast and nice compression).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nels</div><div class="date">9th May 2001, 20:49</div></div><div class="posttext">-The man at http://sources.redhat.com/bzip2/ (homepage of bzip2) says it's patent free &quot;as far as [he] knows&quot;...<br />
-It's open source.<br />
<br />
For the routine size, I don't really know but I can make some tests.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">9th May 2001, 21:13</div></div><div class="posttext">I said I was no expert ;)<br />
Really, only Justin can answer this one. And my reasons were only suggestions of course.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Edgewize</div><div class="date">9th May 2001, 21:16</div></div><div class="posttext">From what I've known about bzip2 before (I haven't tried it recently) it is much slower at compression and decompression than zlib, though it does a better job.<br />
<br />
It is open-source but not GPL (exact same license as zlib), and I supposed it could be optimized for size to end up as small as or smaller than the current zlib implementation.<br />
<br />
I don't know how high the priority for this sort of thing is, since Justin keeps promising a reboot-flagging-and-prompting system (I'm still waiting :)).  But it should be do-able.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">10th May 2001, 01:25</div></div><div class="posttext">I actually made a bz2 using nsis 1.1 a while back. The exe header was marginally larger. bz2 appears to be patent free, and is open source (under a similar license to zlib, I believe), but here are the drawbacks:<br />
<br />
<br />
 bz2 requires more memory during the decompress phase. A lot more than zlib - it is also variable, so there is potential for half way through the install getting &quot;out of memory&quot;<br />
 bz2 is really only good for large blocks. On small files (i.e. &lt; 1MB) zlib usually wins. <br />
<br />
 One option to make bz2 work better, would be to compress the entire datablock at once (instead of per-file etc). This would require considerable reworking of the exe header.<br />
<br />
<br />
<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Uhop</div><div class="date">10th May 2001, 17:18</div></div><div class="posttext">I like zlib/gzip and bzip2. But I think there is one option overlooked: MS compress/cabarc + standard Data Decompression library (LZInit/LZread/LZCopy/LZClose). It is preinstalled on all win32 platforms.<br />
<br />
Pros:<br />
1) Virtually 0 (zero) overhead for installer. You don’t need to carry zlib or bzip2 library.<br />
2) It compresses better than zlib.<br />
<br />
Cons:<br />
1) There is no Data Compression library. You have to run &quot;compress&quot; or &quot;cabarc&quot; utilities from NSIS using command line.<br />
2) These utilities are free but not part of any OS. Developer should download them from MS. (Is it possible to redistribute them?)<br />
<br />
More on Pro#2. In order to automatically distribute my stuff I use NSIS installer packed in .cab. Initially I created compressed installer with compressed header and cab it using no compression (it will not compress anyway). But I found that if I use _uncompressed_ installer and cab it with highest compression (LZX:21) it is 20% smaller. I run several tests on my files and “compress” was significantly better than zlib.<br />
<br />
I think this alternative is worth adding to NSIS. It reduces installer size on both fronts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">10th May 2001, 19:13</div></div><div class="posttext">I can say only 1 thing: It's a Microsoft compression Lib. Now, how come there aren't any compression libs for it? Because it isn't open-source and it contains loads of patents no doubt.<br />
<br />
If you really want the best compression, you'd have to use WinRAR to create self-extracting things, or maybe WinACE. But they add 32 KB of overhead themselves (minimum!).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Uhop</div><div class="date">10th May 2001, 19:53</div></div><div class="posttext">Are we still talking about Win32 installer? ;)<br />
<br />
I don't advocate to use LZ* stuff for all-purpose apps. In my opinion it is smart choice for Win32 installer.<br />
<br />
We don't care about load of patents because installer will not carry any proprietary code but calls to standard Win32 API. It uses Win32 API now and nobody got sued. :)<br />
<br />
NSIS (compiler) will not have any proprietary code but calls to external utilities. It does it now to compress header. :)<br />
<br />
I don't see any problem in this particular case. Possibly WinRAR will compress better but we are concern with overall installer size, don't we? It means that if we are to make judgement on compressors, we have to take into account &quot;compressed data&quot; + &quot;decompression library overhead&quot;. The latter is 0 (zero) for LZ* stuff. And it compresses better than currently used zlib. Anyway small decomp lib size will be crucial for small size components.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mcgarrah</div><div class="date">15th May 2001, 03:07</div></div><div class="posttext">I know I've seen code floating around for doing <br />
Microsoft LZ compression like the original COMPRESS.EXE<br />
and EXPAND.EXE suite from Windows 3.x.<br />
<br />
LZEXPAND.DLL comes with every version of Windows at this<br />
point so it could be used with almost zero overhead.  I<br />
wonder if the trade off is worth it.<br />
How big is the zlib code?  Would this really buy back<br />
enough space to make it worthwhile?<br />
<br />
The new COMPRESS.EXE include a &quot;mszip&quot; compression that<br />
is not backwards compatible with all versions of Windows.<br />
I've not seen code for generating those yet and since <br />
it don't exist everywhere is probably not useful.<br />
<br />
I'm not fond of CAB file format and the new MSI crap<br />
but I'll probably have to learn it too.<br />
<br />
NSIS is going to continue getting a workout for my<br />
installs at least for the near future.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>