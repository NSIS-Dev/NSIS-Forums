<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nsExec got a serious problem?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nsExec got a serious problem? NSIS Discussion" />
	
	<title> nsExec got a serious problem? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nsExec got a serious problem?</div>
<hr />
<div class="pda"><a href="t-152924.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=152924">nsExec got a serious problem?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zwuba</div><div class="date">17th October 2003, 11:33</div></div><div class="posttext">Hi there!<br />
<br />
I just tried to execute a small app I wrote which spawns a XCopy (spawnlp) - when I execute it with ExecWait everything works fine but if I try to use nsExec nothing happens ... it that possible just because I'm creating another child process in my app?<br />
<br />
It's not very urgent but very strange isn't it? :eek:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th October 2003, 12:04</div></div><div class="posttext">Please post details and script code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zwuba</div><div class="date">17th October 2003, 12:12</div></div><div class="posttext">This is the working script code:<br />
<br />
SetOutPath &quot;$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}&quot;<br />
	File &quot;${SOURCE_BASE_DIR}\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe&quot;<br />
	ExecWait &quot;$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe $INSTDIR\${TOOL_TYPE_DIR}&quot;<br />
<br />
If I replace ExecWait with nsExec::Exec nothing happens :(<br />
<br />
What more details do you need?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th October 2003, 13:06</div></div><div class="posttext">Are you sure the application does not start, or is there nothing on the screen?<br />
<br />
You should get the nsExec return value from the stack to see what happends.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">17th October 2003, 13:29</div></div><div class="posttext">or try the modified version here (http://forums.winamp.com/showthread.php?postid=1126974#post1126974) with the ExecToLog option to see if the application is running, if it is then you should see an indicator going around<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th October 2003, 15:45</div></div><div class="posttext">There are a few major faults with the execution line to start with.<br />
<br />
&quot;$\&quot;$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe$\&quot; $\&quot;$INSTDIR\${TOOL_TYPE_DIR}$\&quot;&quot;<br />
<br />
If $INSTDIR or other paths in the string have spaces, then the file may not be executed, and the parameters will become two or more parameters instead of one.<br />
<br />
Use:<br />
&quot;$\&quot;$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe$\&quot; $\&quot;$INSTDIR\${TOOL_TYPE_DIR}$\&quot;&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">17th October 2003, 20:56</div></div><div class="posttext">Is not better to explain with single quotes (')? (I know, is the same thing, but appear more &quot;clean&quot;)<br />
<br />
'&quot;$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\Backup.exe&quot; &quot;$INSTDIR\${TOOL_TYPE_DIR}&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zwuba</div><div class="date">20th October 2003, 07:35</div></div><div class="posttext">hi again - some news for this issue..<br />
<br />
I just tried using ExecToLog and found the following output in my log:<br />
Wait Until backup is finished...<br />
Backup created in: &quot;C:\Backups\Backup20031020-083352&quot;<br />
<br />
That's output from my exe but no backup was created - not even the directory!<br />
<br />
Here is the source of my exe - I'm using a xcopy to create the directory as you can see in the last line in main()<br />
<br />
void main(int argc, char* argv[])<br />
{<br />
	SYSTEMTIME st;<br />
	int i;<br />
	HANDLE hStdOut;<br />
	COORD dwSize;<br />
<br />
<br />
	if(argc &lt; 2) <br />
	{<br />
		printf(&quot;USAGE: SEZBackup c:\\CDS323\n&quot;);<br />
		printf(&quot; or    SEZBackup c:\\SP323\n&quot;);<br />
		printf(&quot; got the idea?\n&quot;);<br />
		exit(1);<br />
	}<br />
	strcpy(szBackupSourceDirectory,argv[1]);<br />
<br />
	// Build Backup Directory Name<br />
	GetLocalTime(&amp;st);<br />
	sprintf(szBackupTargetDirectory,&quot;C:\\Backups\\Backup%04d%02d%02d-%02d%02d%02d&quot;,st.wYear,st.wMonth,st.wDay,st.wHour,st.wMinute,st.wSecond);<br />
<br />
	SetConsoleTitle(&quot;Backup Started...&quot;);<br />
	printf(&quot;Wait Until backup is finished...\n&quot;);<br />
<br />
	//////////////////////////////////////////////<br />
	// Set Screen Buffer size of Handler window //<br />
	//////////////////////////////////////////////<br />
	hStdOut = GetStdHandle(STD_OUTPUT_HANDLE);<br />
	if (hStdOut != INVALID_HANDLE_VALUE)<br />
	{<br />
		dwSize.X = 50;<br />
		dwSize.Y = 3;<br />
		SetConsoleScreenBufferSize(hStdOut, dwSize);<br />
	}	<br />
	printf(&quot;Backup created in: \&quot;%s\&quot;\n&quot;,szBackupTargetDirectory);<br />
	i=_spawnlp( _P_WAIT, &quot;Xcopy.exe&quot;, &quot;Xcopy.exe&quot;, szBackupSourceDirectory, szBackupTargetDirectory,&quot;/V&quot;,&quot;/Q&quot;,&quot;/E&quot;,&quot;/I&quot;,&quot;/H&quot;,&quot;/R&quot;, NULL);<br />
}<br />
<br />
I'll now to use exec instead of _spawnlp maybe this will help ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zwuba</div><div class="date">20th October 2003, 08:10</div></div><div class="posttext">_execlp and _execlpe also didn't help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2003, 12:19</div></div><div class="posttext">Why use an external program for something NSIS can do? Use CopyFiles. If you really want XCopy you can use it from NSIS too. Just use nsExec to execute it so you won't get a console window.<br />
<br />
To get the date you can use nsisdt from the Archive's download page or a System.dll call (Archive has some examples for that one I think. If not, there are some in the forum).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zwuba</div><div class="date">20th October 2003, 13:53</div></div><div class="posttext">thx kichik for the hint - I wrote this app just because I didn't know how to get the actual timestamp for the directory - I tried using nsisdt but I only got this -&gt; &quot;Error: The file you requested could not be found!&quot;<br />
<br />
.. but even thou there is a problem with nsExec I believe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">20th October 2003, 13:59</div></div><div class="posttext">Are you sure the filename is correct (add a dir too)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">20th October 2003, 14:04</div></div><div class="posttext">also it seems that you never test the value of i to determine if the process that you're trying to run was succesfully called or not.<br />
<br />
saying that since you do the printf(&quot;Backup created in: \&quot;%s\&quot;\n&quot;,szBackupTargetDirectory); before anything has been done.<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zwuba</div><div class="date">20th October 2003, 15:43</div></div><div class="posttext">Yes I'm really sure that all paths and filenames are correct because if I replace nsexec::ExecToLog with ExecWait everything works fine<br />
<br />
I also disabled the silent mode of xcopy and with ExecToLog I got no more output in the log than i posted above but I should get at least one line for each copied file!<br />
<br />
@Joost<br />
Sorry I forgot to mention that I got this message when trying to download the zip file from the archive server :rolleyes:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">20th October 2003, 16:00</div></div><div class="posttext">can you post an example to work with?<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th October 2003, 22:45</div></div><div class="posttext">Try downloading again. Somehow all of the files got deleted :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zwuba</div><div class="date">21st October 2003, 07:53</div></div><div class="posttext">@kichik<br />
downloads are now working fine - thx<br />
<br />
@DrO<br />
If attached the source of the backup tool (Backup.zip) and here is a part of my script where i do the call <br />
<br />
Section &quot;-CreateBackupSection&quot;<br />
	;SectionIn RO<br />
	<br />
	CreateDirectory &quot;$INSTDIR\${TOOL_TYPE_DIR}\${RestoreRegistry_DIR}&quot;<br />
<br />
	; Registry<br />
	nsExec::ExecToLog &quot;regedit /e /s $INSTDIR\${TOOL_TYPE_DIR}\${RestoreRegistry_DIR}\RollbackRegistry.txt HKEY_LOCAL_MACHINE\${SEZ_REG_ROOTKEY}&quot;<br />
<br />
	SetOutPath &quot;$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}&quot;<br />
	File /r &quot;${SOURCE_BASE_DIR}\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\SEZBackup.exe&quot;<br />
	ExecWait &quot;$INSTDIR\${TOOL_TYPE_DIR}\${SW_TOOLS_DIR}\SEZBackup.exe $INSTDIR\${TOOL_TYPE_DIR}&quot;<br />
<br />
	; delete Rollback.exe in Instdir<br />
	Delete &quot;$INSTDIR\${TOOL_TYPE_DIR}\Rollback.exe&quot;<br />
	RMDir /r &quot;$INSTDIR\${TOOL_TYPE_DIR}\${RestoreRegistry_DIR}&quot;<br />
		<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">22nd October 2003, 13:07</div></div><div class="posttext">zwuba is right, there does seem to be a problem with nsExec.<br />
<br />
i tried the code posted and it is fine when run under Execwait but when you run it under nsExec there is no output seen from xcopy (i even tried just doing &quot;xcopy /?&quot; in ExecToLog(..) and nothing came out :eek: ).<br />
<br />
will check things more as to what the processes in nsExec are doing as soon as i can.<br />
<br />
-daz</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>