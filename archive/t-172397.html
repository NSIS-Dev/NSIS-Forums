<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" delete problem, please help., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  delete problem, please help. NSIS Discussion" />
	
	<title> delete problem, please help. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  delete problem, please help.</div>
<hr />
<div class="pda"><a href="t-172397.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172397">delete problem, please help.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">coolice</div><div class="date">7th March 2004, 12:48</div></div><div class="posttext">Hi !<br />
<br />
I am in a great trouble as I can not fix a last issue with my installer for a month now, and this is my last hope.<br />
<br />
Fact details :<br />
<br />
- I am using NSIS 2.0<br />
- I had created nsis script for a ToolBar aI had created.<br />
- Everything is perfect, except that in case Uninstall, the installation directory not deleted, most probably because of the unregistered DLL.<br />
- Because of the toolbar speciality, I have to remove all files instant, no reboot or mark for reboot is possible.<br />
- I tested the dll, and it is perfectly possible to delete manually, so I am suer I am doing something wrong in my script.<br />
- What am I doing : search and close all IE instances, unregister the dll, and delete the hole folder.<br />
- I pleaced enough Sleeps as well at least I believe.<br />
<br />
Here it is :<br />
<br />
;-----------------------------------------------<br />
Section &quot;Uninstall&quot;<br />
<br />
	SetAutoClose false<br />
	SetOutPath $INSTDIR<br />
	SetDetailsView show<br />
	<br />
	loop:<br />
    		FindWindow $0 &quot;IEFrame&quot;<br />
    		IntCmp $0 0 done<br />
    		IsWindow $0 0 done<br />
		System::Call 'user32::PostMessageA(i,i,i,i) i($0,16,0,0)'<br />
    		Sleep 200<br />
    		Goto loop<br />
	done:<br />
	<br />
	Sleep 2000<br />
<br />
	UnRegDLL &quot;$INSTDIR\toolbar.dll&quot;<br />
<br />
	Sleep 2000<br />
<br />
	RMDir /r &quot;$INSTDIR&quot;		<br />
<br />
	Sleep 2000<br />
<br />
  	DeleteRegKey HKCU Software\Toolbar6<br />
	DeleteRegKey HKLM SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\MyToolbar<br />
<br />
	Exec '&quot;$PROGRAMFILES\Internet Explorer\IEXPLORE.EXE&quot; &quot;http://www.sample.com&quot;'<br />
<br />
	Sleep 2000<br />
<br />
	BringToFront<br />
<br />
SectionEnd ;<br />
;-----------------------------------------------<br />
<br />
Can You help me please ?<br />
<br />
Big thank you in advance,<br />
<br />
Moore</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 13:09</div></div><div class="posttext">So what is the result? A folder with a DLL or an empty folder?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coolice</div><div class="date">7th March 2004, 13:12</div></div><div class="posttext">The result is, that directory stays with vary number of files. <br />
<br />
toolbar.dll stays, and everything under as well, and if there is any subdir, it stays as well.<br />
<br />
Hoever, my target is to remove the hole dir with everything in it. Thats why I am using RMDir /r.<br />
<br />
BIG THANKS FOR YOUR EFFORT, I am really lost...<br />
<br />
Moore</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 13:17</div></div><div class="posttext">Then the file is still in use by Internet Explorer or the Windows Explorer. Maybe a reboot is required, why is this such a problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coolice</div><div class="date">7th March 2004, 13:21</div></div><div class="posttext">No, the file not used at least I can delete it with File Explorer easily. <br />
<br />
This toolbar is used on high central servers, therefore they can NOT be removed or logged off easily.<br />
<br />
But back to the problem : <br />
<br />
- If I can delete it manually, but NSIS cant. What can be the different ? I think nothing more than time. So is there anyway, I can wait until the file would be deleted ? As giving higher value for Sleep is not the visest idea..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 13:38</div></div><div class="posttext">Using sleep is never a good idea. But does it work if you wait a little longer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coolice</div><div class="date">7th March 2004, 13:40</div></div><div class="posttext">No, it seems ony, if I delete it manually. I really dont understand it....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 13:41</div></div><div class="posttext">Are you sure all browsers are closed? Can you even remove the whole folder at once in Windows Explorer?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coolice</div><div class="date">7th March 2004, 13:44</div></div><div class="posttext">Yes, I can remove the complete folder as well. And yes, I am sure that all IE closed. Very strange. But I have to solve it somehow...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Cecilio</div><div class="date">7th March 2004, 14:12</div></div><div class="posttext">I have no idea but try to do:<br />
<br />
Delete &quot;$INSTDIR\toolbar.dll&quot;<br />
<br />
to find if it possible to delete the dll from the uninstaller</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coolice</div><div class="date">7th March 2004, 15:50</div></div><div class="posttext">I have a new info.<br />
<br />
If I close IE windows manually, the hole uninstall process working OK, the directory instantly removed !<br />
<br />
So it seems the IE clos routine part visible closing IE windows but not practically. However tas manager dont show them...<br />
<br />
Any idea ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 17:26</div></div><div class="posttext">Try using SendMessage instead of that PostMessage call.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coolice</div><div class="date">7th March 2004, 17:32</div></div><div class="posttext">Can you correct that part of my code please ? As when I simply rewritten it to SendMessage it did not compiled.<br />
<br />
THANKS A LOT,<br />
<br />
Moore</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">7th March 2004, 19:11</div></div><div class="posttext">SendMessage $0 16</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>