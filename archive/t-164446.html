<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Locked file handling?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Locked file handling? NSIS Discussion" />
	
	<title> Locked file handling? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Locked file handling?</div>
<hr />
<div class="pda"><a href="t-164446.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=164446">Locked file handling?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">gbeardsl</div><div class="date">12th January 2004, 03:54</div></div><div class="posttext">Kind folk,<br />
    During any installation, it's best to assume that the files you're installing may already be present on the target system, and may be locked.<br />
<br />
To properly handle this condition, I'm using the &quot;Rename&quot; function with the &quot;/REBOOTOK&quot; option. This appears to be the only method within NSIS for handling locked file conditions. Using this method will set the reboot flag if the target file is currently locked.<br />
<br />
The error that I'm experiencing is that if the file is present on the user system at all, then the reboot flag get's set, even if the file is not locked.<br />
<br />
I've put many days into using the NSIS installer, and so hate to revert to InstallShield. However, if locked files can't be properly handled, I may have no choice.<br />
<br />
This is a really common need; does anybody know of this bug, how to work around, or what is considered proper protocol in NSIS for handling locked files?<br />
<br />
I'm using version 1.98 for a variety of reasons.<br />
<br />
Thanks so much!<br />
I'm desperate,<br />
Gary</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th January 2004, 07:38</div></div><div class="posttext">There are many known bugs in the old 1.98 version you are using, it has not been updated for two years.<br />
<br />
Upgrade to NSIS 2 and it should work fine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbeardsl</div><div class="date">12th January 2004, 07:50</div></div><div class="posttext">Thanks Joost. After reading some of the other related topics, I may choose to be lazy for the moment and simply delete it first with /REBOOTOK. If it's locked, the reboot flag will be set. If it's not locked, then Rename will do the deed without the failure.<br />
<br />
But again, Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th January 2004, 15:26</div></div><div class="posttext">Almost all NSIS 2 features are backwards compatible, upgrading is highly recommended because it will fix several issues.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbeardsl</div><div class="date">12th January 2004, 17:27</div></div><div class="posttext">Point taken. However, I must ship today, and QA time is insufficient to gamble on any other failures. The delete fix works, so it's going out the door. Will use new version next build.<br />
<br />
Thanks,<br />
Gary</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbeardsl</div><div class="date">26th January 2004, 20:37</div></div><div class="posttext">Joost,<br />
    Thanks for your communications and work on this codebase! Per your suggestion, I did of course update to the latest version of NSIS.<br />
<br />
I need to ask about the current methodology for handling locked files. The support for this is still pretty convoluted if I understand it correctly. There's a high percentage of the files that I install which could potentially be locked, and realistically, I always assume any file could be locked when building an InstallShield installer. It's simply good practice and eliminates error.<br />
<br />
For installing potentially locked files with NSIS, I cannot merely use the 'File' command. I must first unpack the files in a temp folder, then use 'Rename' to move it to the target, then check the error flag and manually set the reboot flag which I will check at the end of install to see if I should reboot.<br />
<br />
This seems to be the only current approach; is this correct? It would certainly be nice if this functionality was all contained in the 'File' command with a 'Locked' flag. I've considered adding this myself, but am new to NSIS and don't want to start screwing with source if this effort is already underway by somebody and until I'm hooked for sure.<br />
<br />
Any comments you have would be appreciated.<br />
<br />
Thanks!<br />
Gary</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">26th January 2004, 22:07</div></div><div class="posttext">There is no other method. InstallShield will have to do the same thing.<br />
<br />
You can put the code in a macro it you need to use it multiple times.<br />
<br />
The included UpgradeDLL macro handles version checks and upgrades.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">gbeardsl</div><div class="date">26th January 2004, 22:50</div></div><div class="posttext">Thanks Joost! I will check the &quot;included UpgradeDLL macro&quot;.<br />
<br />
FYI - InstallShield must do this also of course, but all the user does is click a checkbox for &quot;potentially locked&quot;.<br />
<br />
gb</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>