<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" $INSTDIR with a variable, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  $INSTDIR with a variable NSIS Discussion" />
	
	<title> $INSTDIR with a variable [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  $INSTDIR with a variable</div>
<hr />
<div class="pda"><a href="t-258513.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=258513">$INSTDIR with a variable</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TYT</div><div class="date">29th October 2006, 04:13</div></div><div class="posttext">Alrighty, let's see if I can explain this properly.  In my script I set variables for commonly used words like the directory where I have the files installed to.  So first I do this..<br />
<br />
# Macro<br />
!macro setVars ;sets variables for the start page and the folder which contains the shortcut icon.<br />
  StrCpy $1 &quot;MyProgram&quot; ;Sets the name for the install dir.<br />
 <br />
 !macroend<br />
<br />
Then, further down the script I have my install directory setup like this..<br />
<br />
# Installer attributes<br />
OutFile &quot;E:\Temp\Releasing\MyFile.exe&quot;<br />
InstallDir &quot;$DOCUMENTS\$1&quot;<br />
<br />
Below that, I have<br />
<br />
Function .onInit<br />
    !insertmacro setVars<br />
FunctionEnd<br />
<br />
With the .onInit loading with the Welcome page.<br />
<br />
In theory, the installer should default to My Documents\MyProgram, but it doesn't.  When you first get to the directory page all you see in the text field is the path to My Documents.  If you browse to a new folder or drive, the &quot;MyProgram&quot; bit is added to the end, but if you just hit next without browsing, everything is dumped into the My Documents folder.  I can rectify this by changing the variable in the InstallDir path to say &quot;$DOCUMENTS\MyProgram&quot; but the program name is different between programs and I like just using one script for all of them, and I just edit the variables for the different programs.<br />
<br />
Do I need to add some different variables?  Maybe change the placement of the Function?  Start the .onInit function somewhere else?  If you have any clue, please let me know.<br />
<br />
I've attached my .nsi file to this post, it's a frankenstein script and I know it's messy but it does what it's ( mostly ) supposed to do.<br />
<br />
Thanks to all in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TYT</div><div class="date">29th October 2006, 04:19</div></div><div class="posttext">And it seems I can't even attach a file, it's no wonder I can't seem to script an installer...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">29th October 2006, 07:19</div></div><div class="posttext">The value from InstallDir is processed before .onInit is called. You should manually copy a new value to $INSTDIR in .onInit.Function .onInit<br />
  StrCpy $INSTDIR $DOCUMENTS\MyProgram<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TYT</div><div class="date">29th October 2006, 13:40</div></div><div class="posttext">That explains it, thanQ very much.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>