<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help with Nsis7z::ExtractWithCallback plugin, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help with Nsis7z::ExtractWithCallback plugin NSIS Discussion" />
	
	<title> Help with Nsis7z::ExtractWithCallback plugin [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help with Nsis7z::ExtractWithCallback plugin</div>
<hr />
<div class="pda"><a href="t-316649.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316649">Help with Nsis7z::ExtractWithCallback plugin</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">dorakey</div><div class="date">29th January 2010, 12:05</div></div><div class="posttext">Hi, I need to retrieve the install progress when running silent install, so I try to use Nsis7z::ExtractWithCallback to output the status. This method works fine when the archived file is not large, but when the 7zip archive exceed certain limit, the callback function return me negative integer value :(<br />
<br />
My code:<br />
<br />
Function Callback<br />
  Pop $R8<br />
  Pop $R9<br />
  System::Int64Op $R8 * 100<br />
  Pop $R7<br />
  System::Int64Op $R7 / $R9<br />
  Pop $R6<br />
  FileSeek $R5 0 END<br />
  FileWrite $R5 &quot;INSTALL_PERCENTAGE:$R6 $\n&quot;<br />
FunctionEnd<br />
<br />
Section<br />
...<br />
  FileOpen $R5 &quot;$INSTDIR\log&quot; a<br />
  GetFunctionAddress $R9 Callback<br />
  Nsis7z::ExtractWithCallback &quot;test.7z&quot; $R9<br />
  FileWrite $R5 &quot;INSTALL_COMPLETE&quot;<br />
  FileClose $R5<br />
SectionEnd<br />
<br />
<br />
I also tried to create the 7z archive with volume, but NSIS doesn't seems to work with volume archives..? <br />
Have any other way to get this done? Please advise.<br />
Thanks!!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CG!</div><div class="date">29th January 2010, 12:23</div></div><div class="posttext">Mmhhh... if you try to access a file that is already opened/written to, you should get a blank file as far as i know.<br />
Maybe this messes it up?<br />
<br />
And i never tried 7z volumes because i'm pretty sure it wouldn't work. And i use the plugin in almost any installer i make with NSiS. But i really wish i could integrate another progress bar just for the plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dorakey</div><div class="date">29th January 2010, 12:32</div></div><div class="posttext">Originally posted by CG! <br />
Mmhhh... if you try to access a file that is already opened/written to, you should get a blank file as far as i know.<br />
Maybe this messes it up?<br />
<br />
And i never tried 7z volumes because i'm pretty sure it wouldn't work. And i use the plugin in almost any installer i make with NSiS. But i really wish i could integrate another progress bar just for the plugin.  <br />
I got try to display the value with DetailPrint instead of write to file, return value is negative as well :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CG!</div><div class="date">29th January 2010, 13:05</div></div><div class="posttext">May have to do with your intOp.<br />
My CallBack looks like this:<br />
<br />
Function CallbackTest<br />
	Pop $R8<br />
	Pop $R9<br />
	SetDetailsPrint textonly<br />
	${if} $LANGUAGE = ${LANG_GERMAN}<br />
		DetailPrint &quot;aktueller Fortschritt: $R8 bytes / $R9 bytes...&quot;<br />
	${else}<br />
		DetailPrint &quot;Current Progress: $R8 bytes / $R9 bytes...&quot;<br />
	${endif}<br />
	SetDetailsPrint both<br />
FunctionEnd<br />
<br />
Ya, it's the original function. Just slightly edited.<br />
But why should i change a winning concept? ^^</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dorakey</div><div class="date">1st February 2010, 03:46</div></div><div class="posttext">Originally posted by CG! <br />
May have to do with your intOp.<br />
My CallBack looks like this:<br />
<br />
Function CallbackTest<br />
	Pop $R8<br />
	Pop $R9<br />
	SetDetailsPrint textonly<br />
	${if} $LANGUAGE = ${LANG_GERMAN}<br />
		DetailPrint &quot;aktueller Fortschritt: $R8 bytes / $R9 bytes...&quot;<br />
	${else}<br />
		DetailPrint &quot;Current Progress: $R8 bytes / $R9 bytes...&quot;<br />
	${endif}<br />
	SetDetailsPrint both<br />
FunctionEnd<br />
<br />
Ya, it's the original function. Just slightly edited.<br />
But why should i change a winning concept? ^^  <br />
I try on this example, return me negative value as well. This only happen when archive size is big, and mine is more than 700Mb :( <br />
I download nsis7z plugin source and found that the size was cast to &quot;int&quot; from &quot;UInt64&quot;(under CallbackProgressHandler function), wonder is it because of the casting caused the incorrect value... :igor:</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>