<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Error with RMDir, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Error with RMDir NSIS Discussion" />
	
	<title> Error with RMDir [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Error with RMDir</div>
<hr />
<div class="pda"><a href="t-191730.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=191730">Error with RMDir</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">29th August 2004, 02:31</div></div><div class="posttext">I would like to report a error with the command RMDir /r or RMDir /rebootok<br />
<br />
I have some lines in my scipt that require the script to create a dir place some files into it, execute those files and then delete the dir using RMDir /r<br />
<br />
Now the the is the last good build I have of NSIS is from 6th June 2004, with this build the dir's are deleted so I'm not sure when this error has come about.<br />
<br />
I have tried it with the /rebootok command, my pc rebooted but the dir's remained<br />
<br />
I downloaded the lasted build dated Thu, 26 Aug 2004, 22:50:12 GMT but this made no differance, still the dir's did not delete.<br />
<br />
So I tried the new 2.01 rc1, I had the same result the dir's didn't delete but after reinstalling the build from 6th June 2004 everthing was fine and the dir's where deleted.<br />
<br />
I'm sorry I can't be more specific with the dates.<br />
<br />
I've just looked through the change log and it seems some updates to the RMDIR where made on the<br />
<br />
2004-08-06 17:03 Amir Szekely (kichik)<br />
<br />
Docs/src/basic.but, Source/exehead/Main.c, Source/exehead/exec.c, Source/exehead/fileform.h, Source/exehead/util.c, Source/exehead/util.h, Source/script.cpp, Source/tokens.cpp: converted RMDir back from SHFileOperation to the good old manual method<br />
- RMDir can now be used with both /r and /REBOOTOK<br />
- RMDir /r no longer leaves lots of files behind if one file removal failed<br />
- The plug-ins directory is now always deleted, if not immediately, then after reboot<br />
- RMDir /r prints a detailed log of its actions<br />
<br />
<br />
So its just a guess that it might have happened with this update.<br />
<br />
Hope this can be sorted out<br />
<br />
Thanks<br />
<br />
Tony</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st August 2004, 19:38</div></div><div class="posttext">Are you creating the directories using SetOutPath? If so, you must use SetOutPath again to another directory before deleting it. The current working directory can not be deleted. I guess SHFileOperation, which was used before, had a little workaround for it.<br />
<br />
If this is not the case, attach a minimal working example so I can reproduce the problem.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">31st August 2004, 20:09</div></div><div class="posttext">First I'm creating the dir or diectories as there is one inside the other due to the way it works<br />
Then SetOutPath to install the files<br />
SetOutPath &quot;$INSTDIR\Patch&quot;<br />
File &quot;Text1.txt&quot;<br />
File &quot;text2.txt&quot;<br />
<br />
and so on<br />
then I use<br />
nsExec::Exec '&quot;$INSTDIR\Patch\install.bat&quot;'<br />
<br />
Yes I know I'm using a batch file and most of the time NSIS can do this, but I prefer my way as I couldn't find a script that I wanted<br />
<br />
and then I use <br />
RMDir /r &quot;$INSTDIR\Patch&quot;<br />
<br />
The basic script looks like this<br />
<br />
CreateDirectory &quot;$INSTDIR\Patch&quot;<br />
CreateDirectory &quot;$INSTDIR\Patch\PatchFiles&quot;<br />
SetFileAttributes &quot;$INSTDIR\Patch&quot; HIDDEN<br />
SetOutPath &quot;$INSTDIR\Patch&quot;<br />
File &quot;Patch\install.bat&quot;<br />
SetOutPath &quot;$INSTDIR\Patch\PatchFiles&quot;<br />
File &quot;Patch\PatchFiles\txt.1&quot;<br />
File &quot;Patch\PatchFiles\txt.2&quot;<br />
File &quot;Patch\PatchFiles\txt.3&quot;<br />
File &quot;Patch\PatchFiles\txt.4&quot;<br />
File &quot;Patch\PatchFiles\txt.5&quot;<br />
File &quot;Patch\PatchFiles\txt.6&quot;<br />
File &quot;Patch\PatchFiles\data.1&quot;<br />
File &quot;Patch\PatchFiles\XXXX.exe&quot;<br />
File &quot;Patch\PatchFiles\XXX.exe&quot;<br />
nsExec::Exec '&quot;$INSTDIR\Patch\install.bat&quot;'<br />
RMDir /r &quot;$INSTDIR\Patch&quot;<br />
<br />
The Batch file does the rest and works perfectly in milliseconds, one thing I did notice is that all the files that where in the directories where deleted, but not the directories themselves, but there is no command in the above script to delete those files.<br />
<br />
Like I said with the older NSIS version the directories where deleted.<br />
<br />
You will probably suggest that I use a temp directory to place the files in but then the batch file won't work correctly. Basically the script creates a temp directory within the desired install path, (I must say there are too other executable files installed also but I can't divulge what they are, just to say they change mulitple lines in text files) sorry but I couldn't find a archive nsis file to do what I want it to do, without creating one myself, which I'm not that advance with scripting to do.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st August 2004, 20:16</div></div><div class="posttext">Use SetOutPath again with another directory ($INSTDIR for example) before deleting $INSTDIR\Patch.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">31st August 2004, 20:21</div></div><div class="posttext">Hmm.. I don't see what you mean<br />
<br />
Would you insert it into the script so I can see<br />
<br />
thanks Kichik</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">31st August 2004, 20:24</div></div><div class="posttext">SetOutPath $INSTDIR<br />
RMDir /r $INSTDIR\Patch</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">31st August 2004, 20:25</div></div><div class="posttext">ah ok thanks<br />
<br />
I'll try is with the recent NSIS :)<br />
<br />
Cheers mate</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TonyDS</div><div class="date">31st August 2004, 20:41</div></div><div class="posttext">That worked perfectly thanks again and sorry for reporting a incorrect error :(</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>