<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Cancelling during MUI_PAGE_INSTFILES, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Cancelling during MUI_PAGE_INSTFILES NSIS Discussion" />
	
	<title> Cancelling during MUI_PAGE_INSTFILES [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Cancelling during MUI_PAGE_INSTFILES</div>
<hr />
<div class="pda"><a href="t-294938.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=294938">Cancelling during MUI_PAGE_INSTFILES</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">hazmatt</div><div class="date">22nd July 2008, 23:02</div></div><div class="posttext">The cancel buttons on the installer is grayed out when it it is installing files.  Is it possible enable that? is there an option I don't know about for that?<br />
Its one of our test center requirements that a user be able to cancel during install.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">22nd July 2008, 23:47</div></div><div class="posttext">You can force the button to be enabled like this:<br />
<br />
Section &quot;&quot;<br />
  GetDlgItem $0 $HWNDPARENT 2<br />
  EnableWindow $0 1<br />
SectionEnd<br />
<br />
But I doubt it will work properly...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">hazmatt</div><div class="date">23rd July 2008, 00:00</div></div><div class="posttext">Yeah, would be nice to get hitting that as a callback.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd July 2008, 01:00</div></div><div class="posttext">wouldn't that end up calling .onUserAbort (haven't tested), or its MUI equivalent?<br />
<br />
If so, you could set a variable before InstFiles, then unset it after.  Then in the user abort handler, check for that variable and if it is set, run special 'abort' code specific to aborting while installing files?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">23rd July 2008, 01:26</div></div><div class="posttext">The problem is, that even if .onUserAbort is invoked, calling &quot;Abort&quot; in that function has a special meaning and would actually prevent the installer from aborting...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd July 2008, 01:49</div></div><div class="posttext">sure.. but perhaps you can check for a variable set in userAbort ( still not sure if it's invoked ;) ) in your sections before each File command and, if it's set, abort the section.. and any subsequent sections.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd July 2008, 02:02</div></div><div class="posttext">Looks like that should, at least in theory, work.  Example code:<br />
<br />
<br />
outFile &quot;test2008Jul22.exe&quot;<br />
<br />
var installingFiles<br />
var abortAbortAbort<br />
<br />
Section<br />
	GetDlgItem $0 $HWNDPARENT 2<br />
	EnableWindow $0 1<br />
<br />
	StrCpy $installingFiles 1<br />
<br />
	messagebox MB_OK &quot;Always trigger&quot;<br />
	<br />
	StrCpy $0 0<br />
	_again:<br />
	IntOp $0 $0 + 1<br />
	IntCmp $0 10 +3<br />
	    sleep 250<br />
	    goto _again<br />
<br />
	StrCmp $abortAbortAbort 1 _aborted<br />
		messagebox MB_OK &quot;Only trigger if not aborted&quot;<br />
		goto _skip<br />
	_aborted:<br />
	    messagebox MB_OK &quot;Only trigger if aborted&quot;<br />
	_skip:<br />
	StrCpy $installingFiles 0<br />
SectionEnd<br />
<br />
Function .onUserAbort<br />
	MessageBox MB_OK &quot;onUserAbort called&quot;<br />
	StrCmp $installingFiles 1 0 _skip<br />
	MessageBox MB_OK &quot;onUserAbort called during instFiles&quot;<br />
	StrCpy $abortAbortAbort 1<br />
	Abort<br />
	_skip:<br />
FunctionEnd<br />
<br />
<br />
Edit: hmm not sure if it's a limit of messageboxes, but if you don't click through the .onUserAbort messageboxes quickly enough, the Section code will continue to run in the background, the timer will hit 10, and the script will continue to think it was not aborted.  Easily fixed by moving the messageboxes around.. or not using them all, they're only there for debuggery/demonstration purposes.. but it does mean that the aborting may not be *instant* if the Section's File commands continue in the background as well.  Extracting files should be a fair bit slower than setting that variable, though - but I've not tested.  3am here, not going to test it fully right now either :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tintera</div><div class="date">20th May 2009, 13:06</div></div><div class="posttext">Just tried to add such section on MUI2 based installer.<br />
The cancel button is still dissabled.<br />
Would be nice to enable the cancel button when installing, but it's not must have for my installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th April 2010, 01:18</div></div><div class="posttext">Old thread - just ran into it again (my topic watch stopped working somewhere along the timeline of life) and, after reading a more recent question asking the same thing, decided to give it another stab.<br />
<br />
Results are in:<br />
http://nsis.sourceforge.net/InstFiles_Cancel_-_Allowing_a_user_to_cancel_installation_during_InstFiles<br />
( InstFiles Cancel - Allowing a user to cancel installation during InstFiles )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tintera</div><div class="date">6th April 2010, 11:18</div></div><div class="posttext">Thank you for the article. Seems complex but will use it if I do some next NSIS based installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th April 2010, 11:32</div></div><div class="posttext">yep.. one wasn't meant to do this sort of thing with NSIS - the Cancel button was disabled on purpose, after all :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>