<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Get Correct User Dekstop path on uninstall Vista/Win7, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Get Correct User Dekstop path on uninstall Vista/Win7 NSIS Discussion" />
	
	<title> Get Correct User Dekstop path on uninstall Vista/Win7 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Get Correct User Dekstop path on uninstall Vista/Win7</div>
<hr />
<div class="pda"><a href="t-318781.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318781">Get Correct User Dekstop path on uninstall Vista/Win7</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">323846</div><div class="date">29th April 2010, 16:44</div></div><div class="posttext">I install <br />
<br />
- Program files in the program files folder<br />
- Data in the APPDATA folder (C:\users\user\appdata\roaming\...)<br />
- Shortcut on desktop<br />
<br />
this works fine when installing. When uninstalling however, there seems to be no way to get the correct ShellFolderPath (desktop, appdata etc) ... it returns either the admin folder, or the public (all users) folder.<br />
<br />
I'm using UAC plugin, RequestExecutionLevel user. <br />
Both calling ${UAC.CallFunctionAsUser} as Call (as admin) don't work. <br />
Have tried  UAC::GetShellFolderPath ... doesn't work.<br />
Have tried a console app which returns the vars ... doesn't work.<br />
Have tried method of passing parameters through user/admin process ... doesn't work.<br />
<br />
I'm searching for this for 2 days now and I'm about to loose it.   :-)<br />
<br />
Can you even do this, and how ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th April 2010, 17:12</div></div><div class="posttext">If you install to programfiles &amp; HKLM, you are doing a all users aka machine install and your app can be uninstalled by any user with admin rights. You can use http://nsis.sourceforge.net/GetUserShellFolderFromRegistry to try to clean up, but there is no guarantee that it will succeed. Since Vista+ will force elevation when the uninstaller is started from Add/Remove Programs (When uninstall entry is in HKLM) there is no way for the UAC plugin to have a &quot;user&quot; context.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">29th April 2010, 19:49</div></div><div class="posttext">Since Vista+ will force elevation when the uninstaller is started from Add/Remove Programs (When uninstall entry is in HKLM) there is no way for the UAC plugin to have a &quot;user&quot; context.<br />
There is a workaround for this, as Anders posted here: http://forums.winamp.com/showthread.php?threadid=277801</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>