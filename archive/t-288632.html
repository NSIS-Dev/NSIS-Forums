<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Duplication in NSIS archives, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Duplication in NSIS archives NSIS Discussion" />
	
	<title> Duplication in NSIS archives [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Duplication in NSIS archives</div>
<hr />
<div class="pda"><a href="t-288632.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=288632">Duplication in NSIS archives</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">17th March 2008, 13:08</div></div><div class="posttext">I've been looking inside my NSIS installer executable with 7-Zip.<br />
<br />
In our project there are is one program that can be called using either of two names -- it inspects argv[0] to find out how it was called and behaves accordingly. This is done to save space in the archive, as the program contains a lot of library code that would be duplicated if the functionality was provided by two separate programs.<br />
<br />
This is similar in concept to the old unix trick of having a single program that provides two functions, and calling it through a symlink to access the second function -- in unix that means the whole program is only stored once even after it has been installed.<br />
<br />
In the NSIS installer for our programs we have something like:<br />
  File prog1.exe<br />
  File /oname=prog2.exe prog1.exe<br />
<br />
I expected that this would lead to prog1.exe being stored in the archive, and being unpacked twice during the install, once as prog1.exe and once as prog2.exe. It appears, though, that it doesn't work like that and that both prog1.exe and prog2.exe are stored in the archive (so the archive contains duplicate copies of the same file, and so is bigger).<br />
<br />
Am I understanding this correctly?<br />
<br />
Is there a good reason for NSIS to work this way, or is it just that nobody has ever needed to install two identical files in this way before.<br />
<br />
I now think that the best thing to do would be to copy prog1.exe to prog2.exe after installing it (but still within the NSIS script). Is there a better way? It feels wrong to have to do that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">{_trueparuex^}</div><div class="date">17th March 2008, 14:47</div></div><div class="posttext">No. The data for that file isn't in the installer twice, because NSIS uses datablock optimizations.<br />
<br />
You can use &quot;SetDatablockOptimize off&quot; in your script to disable the datablock optimizations and see how big the installer would be without it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Daniel James</div><div class="date">17th March 2008, 23:38</div></div><div class="posttext">Originally posted by {_trueparuex^} <br />
No. The data for that file isn't in the installer twice, because NSIS uses datablock optimizations. <br />
OK, thanks for that. Is this an optimization specific to NSIS? to 7-Zip? I'd like to learn more about it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>