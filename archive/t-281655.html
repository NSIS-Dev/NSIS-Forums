<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Execute Function Until a window comes pop up, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Execute Function Until a window comes pop up NSIS Discussion" />
	
	<title> Execute Function Until a window comes pop up [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Execute Function Until a window comes pop up</div>
<hr />
<div class="pda"><a href="t-281655.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281655">Execute Function Until a window comes pop up</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">18th November 2007, 00:41</div></div><div class="posttext">Hi<br />
<br />
I am working to close WFP (Windows File Protection) window<br />
and find a solution in this forum to close WFP i need to call a function -closeWFP that can close WFP.<br />
<br />
so what is my problem:<br />
<br />
as you know WFP appears when you are trying to delete/modify protected files<br />
<br />
so in my installation i need to delete a dll and after that it takes 5-10 seconds to WFP appears and if i call function before it pop nothing happend<br />
<br />
for this issue i use sleep 10000 (ms) command bedfore calling  -closeWFP<br />
<br />
but i want to know<br />
1) is there any way for me to detect WFP window and then call -closeWFP?<br />
<br />
or <br />
<br />
2) Is trhere any way to still running closeWFP function untill WFP window pop?<br />
<br />
3) do you have any other suggestion for me?<br />
i need your help urgently<br />
Thanks in advanced</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">18th November 2007, 07:37</div></div><div class="posttext">ding!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th November 2007, 15:02</div></div><div class="posttext">Try FindWindow. To get the window class (if it has one) you'd need to use Spy++ or a similar tool.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">18th November 2007, 17:35</div></div><div class="posttext">hi <br />
Afrow UK<br />
listen i can detect the windows and can close them too by calling a function so it is not my problem<br />
<br />
as i told before it takes 5-10 seconds to apear windows<br />
so i need wait for it and then call my function to close it<br />
<br />
i asked a way to detect window immediately and close it<br />
<br />
or <br />
<br />
 any way to still running closeWFP function untill WFP window pop<br />
....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th November 2007, 22:44</div></div><div class="posttext">If you can detect the window then what is the problem? Just loop until you get a valid window handle (but ensure you don't loop infinitely as well).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">19th November 2007, 06:35</div></div><div class="posttext">thanks for answering...<br />
<br />
i don't know how can i loop until i am newbie :)<br />
<br />
<br />
this is a part of code that i told:<br />
<br />
<br />
Function closeWFP<br />
     Sleep 10000<br />
    ;Find and close first dialog<br />
    FindWindow $0 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_COMMAND},2,0)'<br />
<br />
    ;Find and close second dialog<br />
    FindWindow $1 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($1,${WM_COMMAND},6,0)'<br />
FunctionEnd<br />
<br />
<br />
<br />
Section -kbdfadll<br />
SetOutPath &quot;$SYSDIR&quot;<br />
  SetOverwrite on<br />
  File &quot;kbdfa.dll&quot;<br />
  ;!insertmacro InstallLib REGDLL NOTSHARED NOREBOOT_NOTPROTECTED kbdfa.dll $SYSDIR\kbdfa.dll $SYSDIR<br />
SectionEnd<br />
<br />
after this the window apear after 5 - 10 seconds  <br />
<br />
and i close it y calling closeWFP function<br />
<br />
<br />
Section -WFP2<br />
;nsExec::Exec '&quot;$INSTDIR\CWFP.exe&quot;'<br />
call closeWFP<br />
SectionEnd<br />
<br />
<br />
so tell me how can  put it too a loop thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th November 2007, 15:12</div></div><div class="posttext">Use IsWindow on $0. Again put in a Sleep 500 and a counter so you don't loop forever.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">19th November 2007, 21:17</div></div><div class="posttext">thanks i did it and it worked good<br />
<br />
one anothr qudtion:<br />
<br />
how can i repeat loop for x time<br />
i mean like this:<br />
for i=0 to 50<br />
do it<br />
<br />
i want this because in some case WFP windows will not pop and if i run this loop it wont break so i need repaet loop for 10 times only for example and if no window pop go to the end of function<br />
this is my idea<br />
<br />
but have you any other idea for my issue?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th November 2007, 21:30</div></div><div class="posttext">With LogicLib, ${For} $R0 1 1000 ... ${Next}<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">19th November 2007, 23:03</div></div><div class="posttext">i write it with Do while but it didn't work what is wrong with it:<br />
<br />
Function closeWFP<br />
<br />
${Do}<br />
;Find and close first dialog<br />
     FindWindow $0 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_COMMAND},2,0)'<br />
<br />
;Find and close second dialog<br />
    FindWindow $1 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($1,${WM_COMMAND},6,0)'<br />
    Sleep 500<br />
     <br />
  ${LoopUntil} $0 == '1' <br />
FunctionEnd<br />
 <br />
<br />
how can i tell LoopUntil window is not pop?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th November 2007, 08:46</div></div><div class="posttext">You cannot do it safely without a counter. Use a For loop.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">20th November 2007, 12:36</div></div><div class="posttext">i try to use for and while but i couldn't would you plz help more or write this loop for me?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">20th November 2007, 13:05</div></div><div class="posttext">Offf I get tired of recoding to find solution<br />
please some one take a look of this and tell me why it dowse not work correct<br />
<br />
<br />
Function closeWFP<br />
<br />
nok:<br />
${If} $R1 &lt;= 10<br />
    Iswindow $0 0 ok<br />
    FindWindow $0 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_COMMAND},2,0)'<br />
<br />
    FindWindow $1 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($1,${WM_COMMAND},6,0)'<br />
    <br />
    MessageBox MB_OK &quot;found a window&quot;<br />
    goto Break<br />
    <br />
    ok:<br />
    Sleep 1000<br />
    IntOp $R1 $R1 + 1<br />
    goto nok<br />
${Else}<br />
 goto Break<br />
${EndIf}<br />
<br />
Break:<br />
<br />
FunctionEnd<br />
 <br />
<br />
or tell me how can i  break the loop   after window find and closed<br />
<br />
Function closeWFP<br />
<br />
${For} $R1 1 10<br />
<br />
 ;Find and close first dialog<br />
     FindWindow $0 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($0,${WM_COMMAND},2,0)'<br />
<br />
;Find and close second dialog<br />
    FindWindow $1 &quot;&quot; &quot;Windows File Protection&quot;<br />
    System::Call 'user32::PostMessageA(i,i,i,i) i($1,${WM_COMMAND},6,0)'<br />
<br />
Sleep 1000<br />
${Next}<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th November 2007, 17:59</div></div><div class="posttext">Function closeWFP<br />
${For} $R0 1 25<br />
  FindWindow $R1 &quot;&quot; &quot;Windows File Protection&quot;<br />
  StrCmp $R1 0 0 Close<br />
  Sleep 1000<br />
${Next}<br />
Return<br />
Close:<br />
  System::Call 'user32::PostMessageA(i,i,i,i) i($R1,${WM_COMMAND},2,0)'<br />
  FindWindow $R1 &quot;&quot; &quot;Windows File Protection&quot;<br />
  System::Call 'user32::PostMessageA(i,i,i,i) i($R1,${WM_COMMAND},6,0)'<br />
FunctionEnd<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">20th November 2007, 18:15</div></div><div class="posttext">Yes! it works :)<br />
this is because i did not know StrCmp<br />
<br />
Thank you so much for your time</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th November 2007, 18:17</div></div><div class="posttext">I used StrCmp instead of IsWindow because FindWindow returns 0 if no windows are found. It could have been IsWindow $R1 Close as well.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">20th November 2007, 18:37</div></div><div class="posttext">i make a win Macro for an alternative to close WFP maybe it helps someone :)<br />
you can download it in attachment</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">21st November 2007, 04:25</div></div><div class="posttext">i write it with Iswindow and it works too as you told :)<br />
<br />
Function closeWFP<br />
${For} $R0 1 100<br />
  FindWindow $R1 &quot;&quot; &quot;Windows File Protection&quot;<br />
  Iswindow $R1 Close 0<br />
  Sleep 100<br />
${Next}<br />
Return<br />
Close:<br />
  System::Call 'user32::PostMessageA(i,i,i,i) i($R1,${WM_COMMAND},2,0)'<br />
  FindWindow $R1 &quot;&quot; &quot;Windows File Protection&quot;<br />
  System::Call 'user32::PostMessageA(i,i,i,i) i($R1,${WM_COMMAND},6,0)'<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>