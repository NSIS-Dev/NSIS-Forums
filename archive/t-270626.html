<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Getsection + Nsisdl, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Getsection + Nsisdl NSIS Discussion" />
	
	<title> Getsection + Nsisdl [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Getsection + Nsisdl</div>
<hr />
<div class="pda"><a href="t-270626.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270626">Getsection + Nsisdl</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Shadow913</div><div class="date">4th May 2007, 22:16</div></div><div class="posttext">I'm trying to use the function here:<br />
<br />
http://nsis.sourceforge.net/Get_all_entries_in_section_of_INI_file<br />
http://nsis.sourceforge.net/Get_all_entries_in_section_of_INI_file<br />
<br />
Along with nsisdl to loop through an ini file with a url per line. Unfortunately once I nsisdl gets called, getsection  breaks and doesn't call my function after the initial download. Simplified code:<br />
<br />
Calling line:<br />
${GetSection} $R2\ver.ini &quot;patches&quot; &quot;GetPatch&quot;<br />
<br />
And my function:<br />
Function GetPatch<br />
		DetailPrint &quot;Downloading patch...&quot;<br />
		NSISdl::download http://???/patches/$9 &quot;$R2\$9&quot;<br />
		Push $0<br />
FunctionEnd<br />
<br />
Example ini file:<br />
[patches]<br />
1.zip<br />
2.zip<br />
3.zip<br />
<br />
Unfortunately I don't really understand how stack work so I'm not clear on how to fix this. If i comment out nsisdl it works fine and getpatch gets called for each of the 3 zip files, but with it in there it only gets called for the first one.<br />
<br />
Can anyone lend a hand?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th May 2007, 22:29</div></div><div class="posttext">You forgot to Pop the result of NSISdl. Add Pop $1 or some other variable right after NSISdl::download. You should also compare $1 to &quot;success&quot; to make sure the download succeeded.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Shadow913</div><div class="date">7th May 2007, 18:48</div></div><div class="posttext">No luck, I added a pop after the nsisdl and the variable gets populated with &quot;success&quot;, but it still doesn't continue downloading the patches :(<br />
<br />
Edit: Never mind, adding a second pop seemed to solve the problem, thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PoRtAbLe_StEaLtH</div><div class="date">28th December 2012, 18:19</div></div><div class="posttext">i know this post is old.. but it relates to GetSection im having problems with...<br />
<br />
1. i have !include GetSection (http://nsis.sourceforge.net/Get_all_entries_in_section_of_INI_file).nsh<br />
2. ${GetSection} &quot;$EXEDIR\${NAME}Settings.ini&quot; &quot;${NAME}Settings&quot; &quot;GetRegistrySection&quot;<br />
3. and in the callback:<br />
Function GetRegistrySection<br />
MessageBox MB_OK &quot;$9&quot;<br />
Push $0<br />
FunctionEnd<br />
<br />
nothing.. no response.. <br />
i've tried different locations,, variables, files, sections, etc.<br />
i also tried copying the script bypassing the !include.. <br />
<br />
is it me or is the script faulty?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">PoRtAbLe_StEaLtH</div><div class="date">31st December 2012, 07:04</div></div><div class="posttext">i know this post is old.. but it relates to GetSection im having problems with...<br />
<br />
1. i have !include GetSection (http://nsis.sourceforge.net/Get_all_entries_in_section_of_INI_file).nsh<br />
2. <br />
3. and in the callback:<br />
Function GetRegistrySection<br />
MessageBox MB_OK &quot;$9&quot;<br />
Push $0<br />
FunctionEnd<br />
<br />
nothing.. no response.. <br />
i've tried different locations,, variables, files, sections, etc.<br />
i also tried copying the script bypassing the !include.. <br />
<br />
is it me or is the script faulty?<br />
<br />
<br />
it's not unicode compatible<br />
System::Call &quot;kernel32::GetPrivateProfileSectionA<br />
System::Call 'kernel32::lstrlenA(t) i(i r4) .r6'<br />
<br />
i looked these up and found the Unicode variable by switching A to W, but the script has to be rewritten.. instead of reading line by line in the INI section.. it reads char by char on each line.<br />
<br />
<br />
i ended up using FileOpen, FileRead, etc... in a loop:<br />
<br />
	ClearErrors<br />
	FileOpen $0 &quot;$SETTINGSDIRECTORY\${NAME}Settings.ini&quot; r<br />
	StrCpy $R0 &quot;0&quot; # initialize index<br />
	${Do}<br />
		ClearErrors<br />
		FileRead $0 $2 <br />
		IfErrors endINISec<br />
		StrCpy $3 $2 4<br />
			${If} $3 == HKLM<br />
				${Trim} $2 ; trim carriage return<br />
				StrCpy $4 $2 -2 ; remove last 2 char<br />
				;StrCpy $1 $4 &quot;&quot; 5 ; remove first 5 char<br />
				${Registry::RestoreBackupKey} &quot;$4&quot;<br />
				;MessageBox MB_OK `DEBUG: $4`<br />
				;MessageBox MB_OK `DEBUG: $1`<br />
			${ElseIf} $3 == HKCU<br />
				${Trim} $2 ; trim carriage return<br />
				StrCpy $4 $2 -2 ; remove last 2 char<br />
				;StrCpy $1 $4 &quot;&quot; 5 ; remove first 5 char<br />
				${Registry::RestoreBackupKey} &quot;$4&quot;<br />
				;MessageBox MB_OK `DEBUG: $4`<br />
				;MessageBox MB_OK `DEBUG: $1`<br />
			${EndIf}<br />
		IntOp $R0 $R0 + 1 ; $R0 must be incremented to move to next key<br />
	${LoopWhile} $2 != &quot;&quot;<br />
	endINISec:<br />
	FileClose $0</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>