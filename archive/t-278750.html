<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Trouble with file attributes, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Trouble with file attributes NSIS Discussion" />
	
	<title> Trouble with file attributes [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Trouble with file attributes</div>
<hr />
<div class="pda"><a href="t-278750.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=278750">Trouble with file attributes</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Quib</div><div class="date">11th October 2007, 21:19</div></div><div class="posttext">I have two objectives that I'm having difficulty with:<br />
1) Removing a single attribute flag from a file (I want to remove the archive flag from a set of files, but not change anything else on them).<br />
2) Copy a folder without copying the files/folders within the folder.<br />
<br />
For issue 1, ${GetFileAttributes} and SetFileAttributes are proving difficult to work with; should I just make exec calls to attrib.exe? My main concern is efficiency as my utility may be working on 1000+ files at a time.<br />
<br />
For issue 2, currently I'm just checking the existence of the folder name I want to copy at the target location and using CreateDirectory. Unfortunately, this means the folder may have differing attribute flags.<br />
SetFileAttributes &quot;$TARGETDIRECTORY$R0&quot; NORMAL<br />
${GetFileAttributes} &quot;$SOURCEDIRECTORY$R0&quot; &quot;ALL&quot; $R3<br />
SetFileAttributes &quot;$TARGETDIRECTORY$R0&quot; $R3<br />
doesn't work because SetFileAttributes doesn't seem to accept a variable as input.<br />
<br />
Anyhow, any feedback'd be appreciated and hopefully this post will generate some searchable help on the subject. I couldn't find beans when searching about this type of thing.<br />
<br />
QM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Quib</div><div class="date">12th October 2007, 20:47</div></div><div class="posttext">Well, I might've solved problem 2 like so:<br />
System::Call 'kernel32::GetFileAttributes(t &quot;$SOURCEDIRECTORY$R0&quot;)i .R8'<br />
System::Call 'kernel32::GetFileAttributes(t &quot;$TARGETDIRECTORY$R0&quot;)i .R9'<br />
IntCmp $R8 $R9 Jump_Past_Set<br />
System::Call 'kernel32::SetFileAttributes(t &quot;$TARGETDIRECTORY$R0&quot;, i R8)'<br />
The IntCmp jumps past the SetFileAttributes if the attributes are already equal.<br />
<br />
Is this acceptable to do? Will I run into issues on various versions of Windows or anything? I only have a 98SE and XP machine to test on.<br />
<br />
I haven't gotten to problem 1 yet, but I imagine I'll use System::Call there as well.<br />
<br />
QM</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">12th October 2007, 22:13</div></div><div class="posttext">#1: Call GetFileAttributes(A/W)  (http://msdn2.microsoft.com/en-us/library/aa364944.aspx) then subtract from the output value FILE_ATTRIBUTE_ARCHIVE with an IntOp, then call SetFileAttributes(A/W)  (http://msdn2.microsoft.com/en-us/library/aa365535.aspx) and push the modified attributes.<br />
<br />
You will still have to figure out though how to deal with the case that the archive attribute was not set on a file, but you still subtracted FILE_ATTRIBUTE_ARCHIVE from the list of attributes ...<br />
<br />
Are the file attributes different between files? If not then you could just check the attributes of one file then set the same (+ or - anything) to the rest of the files in that folder.<br />
<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Quib</div><div class="date">13th October 2007, 00:30</div></div><div class="posttext">Originally posted by CancerFace <br />
#1: Call GetFileAttributes(A/W)  (http://msdn2.microsoft.com/en-us/library/aa364944.aspx) then subtract from the output value FILE_ATTRIBUTE_ARCHIVE with an IntOp, then call SetFileAttributes(A/W)  (http://msdn2.microsoft.com/en-us/library/aa365535.aspx) and push the modified attributes.<br />
<br />
...<br />
<br />
CF <br />
This is exactly what I wound up doing. I simply check if a file has the archive flag set before subtracting it and jump past if the file doesn't have the flag.<br />
<br />
I'll have something to show for this pretty soon. I wrote a file backup/synchronize/archive utility using NSIS and I'm putting it through testing now.<br />
<br />
QM</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>