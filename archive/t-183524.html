<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Make the uninstaller &quot;remember&quot; what was installed?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Make the uninstaller &quot;remember&quot; what was installed? NSIS Discussion" />
	
	<title> Make the uninstaller &quot;remember&quot; what was installed? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Make the uninstaller &quot;remember&quot; what was installed?</div>
<hr />
<div class="pda"><a href="t-183524.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=183524">Make the uninstaller &quot;remember&quot; what was installed?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">16th June 2004, 16:18</div></div><div class="posttext">Hi.<br />
<br />
I know this is most likely a very newbie question, and is probably very easily solved(maybe even the uninstaller solves it for me automatically), but I can't seem to find this exact info.<br />
<br />
What I need to know, is:<br />
<br />
How can I make the uninstaller &quot;remember&quot; what files the user chose to install, and then only attempt to remove those files?<br />
<br />
You're probably thinking &quot;Why don't you just list all the files in the uninstaller, so it will remove all of them, disregarding the files it doesn't find?&quot;<br />
<br />
Well, the problem there is that - let's say a &quot;client&quot; of mine chooses to only install one of my files. So he checks that checkbox only in the installer.<br />
<br />
Then later he downloads files that another guy has made, and installs those. In my case, those files will have the exact same file names that I use, and I can't change that.<br />
<br />
So let's say he now decides to use my uninstaller to remove the one file he installed from me.<br />
<br />
-Now my uninstaller will remove all the files it finds(that I have listed I mean), and that will include the files he downloaded from the other guy.<br />
<br />
And I don't want that.<br />
<br />
(unless I'm mistaken and the uninstaller already 'knows' what to uninstall based on what the user installed)<br />
<br />
So somehow I need the uninstaller to know what files the user chose to install, and only remove those files.<br />
<br />
Is this easily done? Or does the uninstaller somehow already sort this out automatically?<br />
<br />
Sorry if this has been answered numerous times already.<br />
I searched the forum for &quot;uninstall&quot; and didn't find this.<br />
<br />
In case it's a special script, please give me a short example of how to use it.<br />
<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th June 2004, 16:35</div></div><div class="posttext">It's not that difficult. Depending on what you need, you can store the filenames in a registry key or file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">16th June 2004, 17:53</div></div><div class="posttext">That would work for basics Joost. However, he stated that the files could be replaced by another application, therefore, meaning they'd have the same name and be in the same location.<br />
<br />
What you will need to do is store the information as Joost explained, then check the file attributes using the system plugin to verify that the file is actually yours by comparing the file version tab information with the hard coded information you had stored in the installer at compile time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">16th June 2004, 18:32</div></div><div class="posttext">Originally posted by zimsms <br />
That would work for basics Joost. However, he stated that the files could be replaced by another application, therefore, meaning they'd have the same name and be in the same location.<br />
<br />
What you will need to do is store the information as Joost explained, then check the file attributes using the system plugin to verify that the file is actually yours by comparing the file version tab information with the hard coded information you had stored in the installer at compile time.  <br />
<br />
Thanks(both of you).<br />
<br />
Woah - a little more complicated than I thought...<br />
<br />
So - I use a WriteRegStr for each of the install file sections, and then in each of the uninstall file sections, I use a ReadRegStr and somehow compare the read string with the written string(?).<br />
<br />
But hey - I really need an example here.<br />
<br />
-How do I use the System.dll to find this info, how do I make it compare what it finds with the install reg keys, and how do I tell it to use that info to not uninstall the files that don't match the original reg key?<br />
<br />
I found this (http://nsis.sourceforge.net/archive/viewpage.php?pageid=312) script - can I use any of that with a few modifications?<br />
<br />
I'm beginning to think this is a bit over my head...<br />
<br />
 Or - come to think of it - maybe I could write a registry key for each installed file, then make the uninstall section search for each of those strings one by one. -If it then finds 'my' string, it will delete both the file and the reg string. If it doesn't find my reg string for that file, it will not touch the file. <br />
And so on for all files.<br />
<br />
Would that be a solution, you think?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">16th June 2004, 18:48</div></div><div class="posttext">It would take me too long to actually provide a complete example. <br />
<br />
Here's a little pseudocode for ya:<br />
<br />
During install loop through the files and write the complete install information to an ini file (for easier access), or the registry. Both have their pros and cons. ie Files can be deleted, registry can be restored etc. The above loop would contain the same System call as defined below in the uninstall; only this time for the file being installed.<br />
<br />
On uninstall you will need to read in a value from the step above looping until there are no values left. This part is easier in an ini file. Within the loop you will want to perform a system call to the GetFileInfo function and obtain the desired information. I believe there is an example of calling this function in the new system plugin. <br />
Then you use a StrCmp to compare the stored value against the obtained values.<br />
<br />
It is a big process, however, there are many examples of doing each of the pieces seperately.<br />
<br />
I hoped the above can help you. If I get any free time I will attempt to make an example. Though I don't see this happening in the near future.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zimsms</div><div class="date">16th June 2004, 18:52</div></div><div class="posttext">Or - come to think of it - maybe I could write a registry key for each installed file, then make the uninstall section search for each of those strings one by one. -If it then finds 'my' string, it will delete both the file and the reg string. If it doesn't find my reg string for that file, it will not touch the file.  <br />
<br />
This would work for files with filenames that you don't know about, but not for files that may of had the same name which replaced your files. This was one of the snags you requested.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">John P.</div><div class="date">16th June 2004, 19:01</div></div><div class="posttext">Yes, I see you're obviously right, when I just get my brain working. :D <br />
<br />
I'll have a look at what you wrote, and see if I can make it work. Could be I end up ignoring the problem and just give a warning that the files he has installed(other than mine) may be deleted. But I'll try to make this work first.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JamesF1</div><div class="date">17th June 2004, 20:27</div></div><div class="posttext">The best way is definately to store the filenames installed in the registry and then read them back out to the installer and then compare versions.  Pretty much foolproof.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>