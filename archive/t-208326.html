<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Conditional Compilation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Conditional Compilation NSIS Discussion" />
	
	<title> Conditional Compilation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Conditional Compilation</div>
<hr />
<div class="pda"><a href="t-208326.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=208326">Conditional Compilation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">20th February 2005, 07:59</div></div><div class="posttext">For some times i'm searching for a method to control the compile process, that for example compiling with an old version aborts the compile or changes a (few) line(s) because of limitations in the old versions.<br />
<br />
I found the following in the RFE on Sourcefoge:<br />
<br />
<br />
!define &quot;ver_${NSIS_VERSION}&quot;<br />
!ifdef &quot;ver_v2.05&quot;<br />
    File /r /x .svn &quot;${QUELLE_TC}\*.*&quot;<br />
!else<br />
    File /r &quot;${QUELLE_TC}\*.*&quot;<br />
!endif<br />
 <br />
<br />
Unfortunatley this only works for a specific version. Is there a solution for any future versions? The sample above differs between pre 2.05 and 2.05 or higher. Perhaps something like the code below would be possible.<br />
<br />
<br />
<br />
!ifdef &quot;$NSIS_VERSION&quot; &gt;= &quot;v2.05&quot;<br />
    File /r /x .svn &quot;${QUELLE_TC}\*.*&quot;<br />
!else<br />
    File /r &quot;${QUELLE_TC}\*.*&quot;<br />
!endif<br />
 <br />
<br />
I don't want to change the code with every new nsis release.<br />
<br />
Regards flizebogen</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th February 2005, 12:36</div></div><div class="posttext">Do you know when NSIS_VERSION was introduced into NSIS?<br />
I couldn't find it at all in the change log. If it was added recently, then you could do a straight !ifdef NSIS_VERSION, because older versions might not have it defined.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th February 2005, 13:05</div></div><div class="posttext">Ok, so it seems NSIS_VERSION was added in v2.0, so this will work.<br />
!define &quot;CheckVer_${NSIS_VERSION}&quot;<br />
!ifdef &quot;CheckVer_&quot; | &quot;CheckVer_v2.0&quot; | &quot;CheckVer_v2.01&quot; | &quot;CheckVer_v2.02&quot; | &quot;CheckVer_v2.03&quot; | &quot;CheckVer_v2.04&quot;<br />
    File /r &quot;${QUELLE_TC}\*.*&quot;<br />
!else<br />
    File /r /x .svn &quot;${QUELLE_TC}\*.*&quot;<br />
!endif<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">20th February 2005, 14:02</div></div><div class="posttext">What a workaround. Not very pretty as the list increases with every new version for new commands. In my opinion the &quot;!ifdef&quot; command should have the posibility for value checks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">20th February 2005, 14:46</div></div><div class="posttext">doing a &gt;= on of ifdef doesn't really work with the whole idea of a ifdef i think since it's just there to see if the value is defined and not to do a conditional test. maybe you could create some sort of normal function and then do some string based checks on that which would set a variable/register value that you could then compare against. it's not great solution but it's an alternative work around.<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">flizebogen</div><div class="date">20th February 2005, 18:07</div></div><div class="posttext">The problem is that it has to be processed at compile-time and the list of compile-time commands isn't this big.<br />
<br />
Maybe we need a complete new command life !if ? How about it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">21st February 2005, 23:39</div></div><div class="posttext">Another workaround, but should do the trick nicely (unless you're compiling on &lt; Win2k...)!ifdef NSIS_VERSION<br />
  !system `(if /i &quot;${NSIS_VERSION}&quot; geq &quot;v2.05&quot; echo !define FILE_X_SUPPORTED) &gt;&quot;$%TEMP%\temp.nsh&quot;`<br />
  !include $%TEMP%\temp.nsh<br />
  !system `del &quot;$%TEMP%\temp.nsh&quot;`<br />
!endif<br />
<br />
OutFile iftest.exe<br />
Section<br />
  !ifdef FILE_X_SUPPORTED<br />
    MessageBox MB_OK &quot;Yes&quot;<br />
  !else<br />
    MessageBox MB_OK &quot;No&quot;<br />
  !endif<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Larsen</div><div class="date">3rd March 2006, 10:28</div></div><div class="posttext">Originally posted by eccles <br />
[B]Another workaround, but should do the trick nicely (unless you're compiling on &lt; Win2k...) <br />
<br />
That solved my problem, too. Thanks.<br />
I compile my script via batch file that asks the user which versionnumber to use.<br />
<br />
As I find it better to check for a missing versionnumber in the script (instead of several batch files) I now use this:<br />
<br />
<br />
!system `(if &quot;${VERSION}&quot; equ &quot;&quot; echo !define NO_VERSION) &gt;&quot;$%TEMP%\temp.nsh&quot;`<br />
!include $%TEMP%\temp.nsh<br />
!system `del &quot;$%TEMP%\temp.nsh&quot;`<br />
<br />
!ifdef NO_VERSION<br />
    !error &quot;No version defined!&quot;<br />
!endif<br />
<br />
<br />
<br />
I would appreciate it if there was a !if function that could check for empty strings. I guess this would be helpful for several other people.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd March 2006, 10:44</div></div><div class="posttext">Do you mean empty constants?<br />
<br />
!define &quot;Empty_${Define}&quot;<br />
<br />
!ifdef Empty_<br />
 !error &quot;Define -&gt; Empty&quot;<br />
!else<br />
 !echo  &quot;Define -&gt; OK&quot;<br />
!end if<br />
<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd March 2006, 10:47</div></div><div class="posttext">Originally posted by Larsen <br />
I would appreciate it if there was a !if function that could check for empty strings. I guess this would be helpful for several other people. 2.15 will have !if. You can check it out with the nightly build (http://nsis.sourceforge.net/nightly/nsis.zip).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Larsen</div><div class="date">3rd March 2006, 11:02</div></div><div class="posttext">@Stu: Thanks for the workaround.<br />
<br />
@kichik: ThatÂ´s good news.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>