<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Writing license text to file, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Writing license text to file NSIS Discussion" />
	
	<title> Writing license text to file [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Writing license text to file</div>
<hr />
<div class="pda"><a href="t-259455.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259455">Writing license text to file</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">13th November 2006, 18:54</div></div><div class="posttext">Is there any way to write a license text to file during installation (e.g. -&gt;&quot;License.txt&quot;) in a multilanguage installer (provided that I have a LangString and a LicenseLangString with corresponding source file name)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">14th November 2006, 01:33</div></div><div class="posttext">Hi Ippi!<br />
<br />
As far as I can see, just write the content of the variable $(MUILicense) with FileOpen, FileWrite to a file.<br />
<br />
This should work.<br />
<br />
Have a nice day!<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">14th November 2006, 08:24</div></div><div class="posttext">Originally posted by Ippi <br />
Is there any way to write a license text to file during installation (e.g. -&gt;&quot;License.txt&quot;) in a multilanguage installer (provided that I have a LangString and a LicenseLangString with corresponding source file name)? <br />
What are you want to do?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">14th November 2006, 09:58</div></div><div class="posttext">Originally posted by bholliger<br />
As far as I can see, just write the content of the variable $(MUILicense) with FileOpen, FileWrite to a file.<br />
Thanks, Bruno, I'll try this method today. Actually, I'm confused by the statement about the LicenseLangString from the NSIS manual: &quot;Does the same as LangString only it loads the string from a text/RTF file and defines a special LangString that can be used only by LicenseData&quot;.<br />
<br />
Originally posted by glory_man<br />
What are you want to do? <br />
Sorry if I was unclear.<br />
I want to copy to destination location only one of the licenses included with my multilanguage installer - the one that corresponds to selected language. Also I want to rename the license file to &quot;License.txt&quot; while copying (writing?).<br />
<br />
Of course, I can do something like multiple &quot;IntCmp $LANGUAGE ${LANG_language} ...&quot; and &quot;File /oname=License.txt &quot;${_language_LICENSE_FILE_}&quot;&quot;, but I was looking for more elegant solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">14th November 2006, 10:07</div></div><div class="posttext">Hi Ippi!<br />
<br />
Yes, this will do the job:<br />
<br />
<br />
ClearErrors<br />
FileOpen $0 $INSTDIR\license.txt w<br />
IfErrors done<br />
FileWrite $0 &quot;$(MUILicense)&quot;<br />
FileClose $0<br />
done:<br />
<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">14th November 2006, 16:50</div></div><div class="posttext">Hi, Bruno!<br />
<br />
It does not work really as it should.<br />
It writes only first 1022 bytes of license text, prepending the license data with 0x01 byte (1023 bytes total).<br />
<br />
:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">14th November 2006, 17:05</div></div><div class="posttext">Yoy can use following code<br />
!include &quot;LogicLib.nsh&quot;<br />
...<br />
LangString name ${LANG_ENGLISH} &quot;eng_name&quot;<br />
LangString name ${LANG_RUSSIAN} &quot;rus_name&quot;<br />
LangString name ${LANG_FRENCH} &quot;fr_name&quot;<br />
...<br />
;copy license file - somewhere in section<br />
${Switch} $LANGUAGE<br />
   ${Case} ${LANG_ENGLISH}<br />
      File &quot;/oname=license.txt&quot; &quot;eng_lic.txt&quot;<br />
   ${Break}<br />
   ${Case} ${LANG_RUSSIAN}<br />
      File &quot;/oname=license.txt&quot; &quot;rus_lic.txt&quot;<br />
   ${Break}<br />
   ${Case} ${LANG_FRENCH}<br />
      File &quot;/oname=license.txt&quot; &quot;fr_lic.txt&quot;<br />
   ${Break}<br />
${EndSwitch}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">14th November 2006, 17:22</div></div><div class="posttext">Originally posted by glory_man <br />
Yoy can use following code<br />
It's exactly what I meant byOf course, I can do something like multiple &quot;IntCmp $LANGUAGE ${LANG_language} ...&quot; and &quot;File /oname=License.txt &quot;${_language_LICENSE_FILE_}&quot;&quot;, but I was looking for more elegant solution.slightly brushed by LogicLib macroses :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">15th November 2006, 08:27</div></div><div class="posttext">What about this code:<br />
<br />
LangString name ${LANG_ENGLISH} &quot;lic_eng.txt&quot;<br />
LangString name ${LANG_RUSSIAN} &quot;lic_rus.txt&quot;<br />
  <br />
LicenseLangString MUILicense ${LANG_ENGLISH} &quot;lic_eng.txt&quot;<br />
LicenseLangString MUILicense ${LANG_RUSSIAN} &quot;lic_rus.txt&quot;<br />
<br />
.....<br />
<br />
ClearErrors<br />
FileOpen $0 license.txt w<br />
FileOpen $3 $(name) r<br />
IfErrors done<br />
read:<br />
  FileRead $3 $1<br />
  IfErrors readfin<br />
  Push $1<br />
  Pop $1<br />
  FileWrite $0 &quot;$1&quot;<br />
  goto read<br />
readfin:<br />
  FileClose $0<br />
done:<br />
....<br />
<br />
Is this more elegant solution :)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bholliger</div><div class="date">15th November 2006, 10:53</div></div><div class="posttext">Hi glory_man!<br />
<br />
I might be wrong, but I think the file $(name) is not present at runtime. Except you have all the files in the same directory as the installer. Is this the case?<br />
<br />
Have a nice day!<br />
<br />
Cheers<br />
<br />
Bruno</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">15th November 2006, 11:26</div></div><div class="posttext">Originally posted by glory_man <br />
[B]What about this code:[/B<br />
bholliger is right, there are no unpacked license files at runtime on a target system.<br />
<br />
&quot;File /oname=License.txt $(name)&quot; also does not work (actually, this approach was the first I've tried some days ago ;))</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">15th November 2006, 17:09</div></div><div class="posttext">So, i think easest way is use something like this:<br />
Setoutpath $PLUGINSDIR<br />
File /r &quot;lic\*&quot;<br />
CopyFiles /SILENT &quot;$PLUGINSDIR\$(name)&quot; &quot;PATH\license.txt&quot;<br />
<br />
i.e. unpack license file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">15th November 2006, 18:14</div></div><div class="posttext">nope, that won't work as stated earlier: licence text is parsed on compile time, not on runtime... no license files are present in $PLUGINSDIR.<br />
<br />
what i did to solve it is quite easy:<br />
LangString name [...]<br />
<br />
SetOutPath &quot;$INSTDIR\licenses&quot;<br />
File &quot;ger_lic.txt&quot;<br />
File &quot;eng_lic.txt&quot;<br />
[...]<br />
Rename &quot;$INSTDIR\licenses\$(name)&quot; &quot;$INSTDIR\license.txt&quot;<br />
RMDir /r &quot;$INSTDIR\licenses&quot;<br />
<br />
basically: extract all files, rename the chosen one to  the correct name, delete the rest.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">15th November 2006, 21:38</div></div><div class="posttext">Originally posted by Comm@nder21 <br />
extract all files, rename the chosen one to  the correct name, delete the rest.<br />
No, thanks :) I'd rather use the dumb ${Switch}...${Case} method :rolleyes:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">15th November 2006, 22:06</div></div><div class="posttext">2 NSIS developers<br />
<br />
Why the LicenseLangString is so special that it cannot be written back to file? Look how people are suffering from this :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">16th November 2006, 09:33</div></div><div class="posttext">Originally posted by Comm@nder21 <br />
nope, that won't work as stated earlier: licence text is parsed on compile time, not on runtime... no license files are present in $PLUGINSDIR.<br />
<br />
My example worked.<br />
Move your licenses in to &quot;lic&quot; folder.<br />
Following code extract them in to the PLUGINSDIR<br />
<br />
Setoutpath $PLUGINSDIR<br />
File /r &quot;lic\*&quot;<br />
After that just copy file with $(name). After installation temporary files will be deleted.<br />
<br />
Originally posted by Ippi <br />
I'd rather use the dumb ${Switch}...${Case} method<br />
<br />
:)<br />
Ð§Ñ‚Ð¾ Ð·Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð¿Ð¾ÑˆÐ»Ð¸ - Ñ‚Ð¾ Ð½Ðµ ÑÑ‚Ð°Ðº, ÑÑ‚Ð¾ Ð½Ðµ Ñ‚Ð°Ðº.<br />
:D :D :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">16th November 2006, 11:00</div></div><div class="posttext">yes, this will work but does not differ very much from my method :) except of the folder the licenses are extracted to on runtime :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">16th November 2006, 11:12</div></div><div class="posttext">Originally posted by glory_man <br />
Ð§Ñ‚Ð¾ Ð·Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð¿Ð¾ÑˆÐ»Ð¸ - Ñ‚Ð¾ Ð½Ðµ ÑÑ‚Ð°Ðº, ÑÑ‚Ð¾ Ð½Ðµ Ñ‚Ð°Ðº.<br />
:D :D :D<br />
I don't like the glory_man-Comm@nder21 (:)) approach because it unnecessarily burdens the CPU, HDD/file system, anti-viral software and still not so elegant as that hypothetic method I've expected to find :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">16th November 2006, 11:22</div></div><div class="posttext">Originally posted by Comm@nder21 <br />
yes, this will work but does not differ very much from my method :) except of the folder the licenses are extracted to on runtime :) <br />
:D :D :D<br />
You doesn't need to remember which licenses must be extracted. You can add new license file, and all that you need to do is add one LangString.<br />
:) ;) :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">16th November 2006, 11:55</div></div><div class="posttext">2 Ippi<br />
<br />
Also you can use macro like this:<br />
!macro addlicense language licname folder var1name var2name<br />
!insertmacro MUI_LANGUAGE &quot;${language}&quot;<br />
LangString ${var1name} '&quot;$$&quot;&quot;{LANG_${language}&quot;}' &quot;${licname}&quot;<br />
LicenseLangString ${var2name} '&quot;$$&quot;&quot;{LANG_${language}&quot;}' &quot;${folder}\${licname}&quot;<br />
!macroend<br />
After that add language, langstring and license using macro, like this code:<br />
!insertmacro addlicense ENGLISH &quot;historyeng.txt&quot; &quot;lic&quot; name MUILicense<br />
!insertmacro addlicense RUSSIAN &quot;historyeng.txt&quot; &quot;lic&quot; name MUILicense<br />
!insertmacro addlicense FRENCH &quot;historyfr.txt&quot; &quot;lic&quot; name MUILicense<br />
<br />
Code to extract of license stay previous.<br />
<br />
ADD: Is this solution not elegant? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ippi</div><div class="date">16th November 2006, 12:32</div></div><div class="posttext">Originally posted by glory_man <br />
Code to extract of license stay previous.<br />
Just the extraction code embarrasses me, not the declaration part ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">glory_man</div><div class="date">17th November 2006, 10:58</div></div><div class="posttext">Originally posted by Ippi <br />
Just the extraction code embarrasses me, not the declaration part ;)  <br />
I think extraction of few files of some kilobytes will not make heavy CPU load.<br />
<br />
and<br />
2 NSIS developers<br />
Originally posted by Ippi <br />
Why the LicenseLangString is so special that it cannot be written back to file? Look how people are suffering from this :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th November 2006, 11:11</div></div><div class="posttext">The license string is too large. It's over the 1024 bytes limit of internal strings.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>