<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" WinXP x64 redirects system32 files to WOW64 directory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  WinXP x64 redirects system32 files to WOW64 directory NSIS Discussion" />
	
	<title> WinXP x64 redirects system32 files to WOW64 directory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  WinXP x64 redirects system32 files to WOW64 directory</div>
<hr />
<div class="pda"><a href="t-237297.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=237297">WinXP x64 redirects system32 files to WOW64 directory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">guido666</div><div class="date">6th February 2006, 04:03</div></div><div class="posttext">I have tried these three different commands to write a file to the C:/Windows/System32/ directory under WinXP x64.<br />
<br />
InstallDir &quot;C:\windows\system32&quot; ; Won't work with 9x<br />
InstallDir &quot;$WINDIR\system32&quot; ; Won't work with 9x<br />
InstallDir &quot;$SYSDIR&quot;<br />
<br />
Every single time it will write the file to the C:\Windows\WOW64\ directory (only on x64 machines, not XP/2003/9x).<br />
<br />
I figure it is a self protection measure by Windows x64 to keep 32-bit software from mingling with the 64-bit software. <br />
<br />
I'm trying to make a program that installs the system OEM info, in the system properties box.  This costists of two files, &quot;oeminfo.ini&quot; and &quot;oemlogo.bmp&quot;, and they must be placed in the system directory (C:\Windows\System\ on 9x, and C:\Windows\System32\ on XP\2000\2003\x64).<br />
<br />
Any help or ideas how to circumvent this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">guido666</div><div class="date">6th February 2006, 04:15</div></div><div class="posttext">Some more info from Microsoft's site:<br />
http://www.microsoft.com/windowsxp/using/64bit/russel_x64faq.mspx<br />
<br />
Q.<br />
What is the SysWOW64 directory? 	<br />
A.<br />
The \Windows\SysWOW64 directory is where 32-bit system files are installed. 64-bit system files are in the \Windows\system32 directory for compatibility reasons.<br />
<br />
Q.<br />
Why do some of my programs install into the Program Files Directory, and others into the Program Files (X86) directory?	<br />
A.<br />
Windows XP Professional x64 Edition redirects the \Program Files directory for all programs that are 32-bit during the installation to the \Program Files(x86) directory. Programs that 64-bit are installed into the \Program Files directory.<br />
<br />
More here too:<br />
http://www.sysinternals.com/blog/2005/05/running-everyday-on-64-bit-windows.html<br />
<br />
Windows 2003 SDK API to turn redirect off:<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/fs/wow64disablewow64fsredirection.asp</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2006, 18:38</div></div><div class="posttext">You can call Wow64DisableWow64FsRedirection using the System plug-in:System::Call &quot;kernel32::Wow64DisableWow64FsRedirection(*i)&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">guido666</div><div class="date">7th February 2006, 18:43</div></div><div class="posttext">Cool, so do I just call that, then call the enable function again to put it back?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th February 2006, 18:50</div></div><div class="posttext">Yes, that should work. Just make sure you call it before $SYSDIR is actually parsed. In InstallDir's case, that's impossible. InstallDir is parsed before any of your code is executed. You'd have to call this in .onInit, copy $SYSDIR into $INSTDIR (using StrCpy) and then call the enable function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbguy</div><div class="date">17th July 2006, 18:56</div></div><div class="posttext">Originally posted by guido666 <br />
Cool, so do I just call that, then call the enable function again to put it back?  <br />
<br />
Actually, unless you want your installer to redirect again there is no need to enable redirection again.<br />
<br />
From MSDN documentation:<br />
<br />
The Wow64DisableWow64FsRedirection function disables file system redirection for the calling thread.<br />
<br />
So, disabling redirection in your installer doesn't disable redirection system wide.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">landaquinn</div><div class="date">6th October 2008, 22:29</div></div><div class="posttext">This is not working for me, using System::Call &quot;kernel32::Wow64DisableWow64FsRedirection(*i)&quot;<br />
  Is there any way to get a return value from this instruction?  documentation says the function returns a bool.  Is there a way to tell if there is an error in the syntax?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">landaquinn</div><div class="date">10th October 2008, 17:25</div></div><div class="posttext">I got it working, i don't know what stupid thing I must have been doing before.  It also works with simply:<br />
<br />
System::call  &quot;kernel32::Wow64DisableWow64FsRedirection()&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">11th October 2008, 13:01</div></div><div class="posttext">You can also use the macros in x64.nsh, which is included with the current NSIS releases.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>