<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Weird section validation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Weird section validation NSIS Discussion" />
	
	<title> Weird section validation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Weird section validation</div>
<hr />
<div class="pda"><a href="t-268855.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268855">Weird section validation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fishsauce</div><div class="date">3rd April 2007, 08:47</div></div><div class="posttext">I'm having problems with trying to activate/deactivate components/sections depending on what the user selects.<br />
<br />
I have 4 sections:<br />
- Section 0 (Read only, always selected)<br />
- Section 1<br />
- Section 2<br />
- Section 3 (This section is independent of the others)<br />
<br />
The thing is section 1 is a dependency of section 2, so when section 2 is selected I want section 1 to be selected automatically, and when section 1 is deselected I want section 2 to be deselected automatically as well.  However, section 1 should also be free of section 2 in that when section 2 is not selected, section 1 can still be selected anyways.<br />
<br />
So far I've only been able to get the two to be selected/deselected at the same time based on what I've found in this board and in the docs, but I haven't been able to let section 1 be selected when section 2 is not selected.  Also this only allows one of the sections to be checked/unchecked; the other is always locked in the checked state, which is undesirable.  I should probably note that the NSIS logic syntax feels awkward to me so I might be missing something that is really simple.<br />
<br />
Here's my code (all section flags are initially set to the checked state):<br />
<br />
Function .onSelChange<br />
<br />
  Push $0<br />
<br />
  SectionGetFlags ${Section2} $0<br />
  IntOp $0 $0 &amp; ${SF_SELECTED}<br />
  SectionsetFlags ${Section1} $0<br />
<br />
  Pop $0<br />
<br />
FunctionEnd<br />
<br />
<br />
Thanks in advance for your help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd April 2007, 09:21</div></div><div class="posttext">You have two mistakes here. The first being always setting section1's flags to the same value of section2's. The second is that you set only the SF_SELECTED flag and remove all the rest.<br />
<br />
What you should do is get section2's flags, check if SF_SELECTED is on. If it is, get section1's flags, add SF_SELECTED to it and set the flags to the new value.<br />
<br />
You can do all that very simply with Sections.nsh.!include LogicLib.nsh<br />
!include Sections.nsh<br />
<br />
Function .onSelChange<br />
<br />
  ${If} ${SectionIsSelected} ${Section2}<br />
    !insertmacro SelectSection ${Section1}<br />
  ${EndIf}<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fishsauce</div><div class="date">4th April 2007, 06:08</div></div><div class="posttext">Thanks!  I got it partially working with this code (the macros didn't seem to want to work so I wrote it out by hand)<br />
<br />
<br />
Function .onSelChange<br />
  Push $0<br />
  ${If} ${SectionIsSelected} ${Section2}<br />
    SectionGetFlags ${Section1} $0<br />
    IntOp $0 $0 | ${SF_SELECTED}<br />
    SectionSetFlags ${Section1} $0<br />
  ${EndIf}<br />
  Pop $0<br />
FunctionEnd<br />
<br />
<br />
However, this locks the Section1 checkbox whenever Section2 is enabled.  Is it possible to uncheck Section2 when the Section1 checkbox is cleared?  It seems kind of hard because NSIS doesn't seem to know which checkbox is clicked, so the two conditions conflict.<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th April 2007, 16:45</div></div><div class="posttext">You can probably do that if you remember the state of Section1 in .onSelChange. If it's changed from unselected to selected, select Section2. If it hasn't changed, do nothing.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>