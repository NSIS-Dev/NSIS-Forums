<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" setting a file's permissions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  setting a file's permissions NSIS Discussion" />
	
	<title> setting a file's permissions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  setting a file's permissions</div>
<hr />
<div class="pda"><a href="t-259654.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=259654">setting a file's permissions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tdodge</div><div class="date">16th November 2006, 05:10</div></div><div class="posttext">Hello,<br />
<br />
I am very new to writing .nsi scripts but need to modify an existing one.  I need to set a file's permissions so that it is read-only.  Through some searches on this forum, I discovered the AccessControl plug-in but I must be doing something incorrect because it doesn't seem to be working.  Here are some examples of what I have tried ...<br />
<br />
AccessControl::SetOnFile \<br />
    &quot;$INSTDIR\iTMSTransporter.woa\Contents\Resources\testFile&quot; &quot;Everyone&quot; &quot;GenericRead&quot;<br />
<br />
AccessControl::SetOnFile \<br />
    &quot;$INSTDIR\iTMSTransporter.woa\Contents\Resources\testFile&quot; &quot;(BU)&quot; &quot;GenericRead&quot;<br />
<br />
Also, I am not even sure what trustee to use.  If anyone can suggest a &quot;default&quot; one that all (or most) users would have, that would be great.<br />
<br />
Any help or suggestions would be greatly appreciated.<br />
<br />
Thanks kindly,<br />
Tiff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">szornyu</div><div class="date">16th November 2006, 08:15</div></div><div class="posttext">Weirdly enough, I struggle with same issue! :)<br />
Can any of You, gurus, give us the solution?<br />
S-1-1-0 and S-1-5-32-545 doesn't seem to work.<br />
thanks in advance<br />
szornyu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">16th November 2006, 11:07</div></div><div class="posttext">do you really want to set file access permissions (altering the windows ACLs) or just to set the +r attribute?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">colm</div><div class="date">16th November 2006, 11:38</div></div><div class="posttext">Suggestion - use:<br />
<br />
Exec &quot;CACLS ...&quot;<br />
<br />
Instead. Type cacls /? to find out how to use it...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">szornyu</div><div class="date">16th November 2006, 14:28</div></div><div class="posttext">Hi.<br />
I want to alter the access permissions of a folder ($INSTDIR\keys) <br />
Actually, I want to extend existing &quot;Read &amp; execute&quot;, &quot;Read&quot; and &quot;List folder context&quot; by adding &quot;Modify&quot; and &quot;Write&quot;.<br />
It is a folder to store *.pkr and *.skr files of a PKI based authentication mechanism..<br />
If additional permissions are not granted, my application returns a &quot;Public KeyRing update error: file operation error&quot;. <br />
By manually granting the above mentioned permissions, everything works fine. But I want to include this feature into the patch I want to deploy, to make the application Windows Vista-ready. :)<br />
<br />
Thanks for the cacls tip, for everybody's information, Vista uses iCACLS ... <br />
Doesn't seem to work... <br />
What I'm doing wrong???<br />
szornyu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">colm</div><div class="date">16th November 2006, 14:30</div></div><div class="posttext">Does it work if you use iCACLS manually on vista?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">colm</div><div class="date">16th November 2006, 14:31</div></div><div class="posttext">Possible cause is lack of privileges. You could try nsExec, and getting the results of the command back in the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">szornyu</div><div class="date">16th November 2006, 16:14</div></div><div class="posttext">Yes, de utility works, but not on every folder.<br />
Let me give a picture of the situation:<br />
- application installed under user member of Administrators group<br />
- folder I am having trouble with has only Read, Execute, anf List permissions<br />
- by using iCACLS I'm unable to set the desired permission.<br />
<br />
Only for testing purposes I created a new folder under C:\ and, By the gods!, everything work fine!<br />
<br />
The user I'm logged in with, is member of administrator, but I think I'mentined this before...<br />
szornyu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">colm</div><div class="date">16th November 2006, 16:27</div></div><div class="posttext">Do..<br />
<br />
nsExec::ExecToStack &quot;'iCACLS' your command line options&quot;<br />
Pop $1<br />
Pop $2<br />
<br />
MessageBox MB_OK $1<br />
MessageBox MB_OK $1<br />
<br />
What does it say?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tdodge</div><div class="date">17th November 2006, 01:06</div></div><div class="posttext">Hello,<br />
<br />
Thank you everyone for your replies!<br />
<br />
After a little more research, it looks like ATTRIB is what I want to use.  I do not know, though, which Windows support it.  I know XP does (since that is what I tested it on) and I think NT does.  Does anyone know if 2000, 98, and Vista supports ATTRIB?<br />
<br />
Also, I guessing I can do something like this in the .nsi script ...<br />
nsExec::ExecToStack &quot;'ATTRIB' your command line options&quot;<br />
But feel free to let me know if that is wrong.  :)<br />
<br />
Thanks again,<br />
Tiff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th November 2006, 02:09</div></div><div class="posttext">no need for external program, just use SetFileAttributes (And ATTRIB goes back to the days of dos)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tdodge</div><div class="date">17th November 2006, 02:43</div></div><div class="posttext">Thank you!  Thank you!  Thank  you!<br />
<br />
The installer now successfully sets the permissions of a file to read-only.<br />
<br />
This worked ..<br />
nsExec::ExecToStack '&quot;ATTRIB&quot; +R filename'<br />
<br />
But this is better ...<br />
setFileAttributes &quot;filename&quot; READONLY<br />
<br />
Again, thank you everyone for your help!<br />
Tiff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">szornyu</div><div class="date">17th November 2006, 13:41</div></div><div class="posttext">Okay, just not to left the without an answer those who were kind enough to write to the topic, I managed to set permission to the desired folder.<br />
I used AccessControl::GrantOnFile &quot;$INSTDIR\foldername&quot; &quot;(S-1-5-32-545)&quot; &quot;GenericRead + GenericWrite + GenericExecute + Delete&quot;<br />
The only trick I wasn't aware is that You need bloody administrator rights to do it. <br />
Odd thing: the user I was logged in with, had admin rights ( as a matter of fact, he was the only visible member of the Administrators group ), he wasn't able to set those permissions ( got access denied error ).<br />
Running the installer &quot;As Administrator&quot; (from the context menu), everything worked as it should.<br />
Thanks for everyone's help.<br />
szornyu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">szornyu</div><div class="date">17th November 2006, 13:43</div></div><div class="posttext">tdodge, hope You don't mind I was shoving into Your topic... <br />
szornyu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tdodge</div><div class="date">17th November 2006, 17:30</div></div><div class="posttext">Oh goodness, no need to worry!  :)  I'm glad that you added more information to the thread and posted yor solution!<br />
<br />
Take Care,<br />
Tiff</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">21st November 2006, 12:31</div></div><div class="posttext">Thanks &quot;szornyu&quot; for posting your additional information ,really appriciated.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>