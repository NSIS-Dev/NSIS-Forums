<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" &quot;!if cond || cond&quot; conditional compilation, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  &quot;!if cond || cond&quot; conditional compilation NSIS Discussion" />
	
	<title> &quot;!if cond || cond&quot; conditional compilation [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  &quot;!if cond || cond&quot; conditional compilation</div>
<hr />
<div class="pda"><a href="t-281630.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281630">&quot;!if cond || cond&quot; conditional compilation</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">David B. Trout</div><div class="date">17th November 2007, 18:08</div></div><div class="posttext">I'd like to be able to do:<br />
<br />
  !if ((${A} == ${B}) || (${A} == ${C}))<br />
   ...(code)...<br />
  !endif<br />
<br />
How do I do that??</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th November 2007, 20:17</div></div><div class="posttext">If you really want to create such a compile-time condition, you have two hackish solutions I can think of. Double the !if, use !macro inside.!macro blah<br />
# ...(code)...<br />
!macroend<br />
!if &quot;${A}&quot; == &quot;${B}&quot;<br />
!insertmacro blah<br />
!else if &quot;${A}&quot; == &quot;${B}&quot;<br />
!insertmacro blah<br />
!endif Use !ifdef.!define A_test_${B}<br />
!define A_test_${C}<br />
!ifdef A_test_${A}<br />
# ...(code)...<br />
!endifBut most new users want runtime check. For that you have the LogicLib. !if is only for the preprocessor.!include LogicLib.nsh<br />
#...<br />
${If} $A == $B<br />
${OrIf} $A == $C<br />
# ...(code)...<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">David B. Trout</div><div class="date">18th November 2007, 05:04</div></div><div class="posttext">I may be [relatively] new to NSIS kichik, but I'm definitely NOT new to programming (having been one for for over 30 years). I *do* know the difference between compile-time and run-time checking, and I'm here to tell you this is most definitely *NOT* a run-time need. :)<br />
<br />
Thus your closing suggestion is unfortunately completely out of the question.<br />
<br />
And your first &quot;hackish&quot; suggestion is also rejected for being too, .. well, .. (forgive me) F'ing UGLY.  ;)<br />
<br />
(Besides, IMO simply calling a function instead (which I had already considered and rejected BTW) would be much cleaner/clearer than invoking a macro)<br />
<br />
Your second hackish suggestion however, looks somewhat intriguing and MIGHT be a possibility -- if only I actually understood what you were suggesting that is! (which I don't!)  :(<br />
<br />
Could you do me a favor and explain it a bit more please?<br />
<br />
Thanks.<br />
<br />
Thanks for the quick reply and thanks for NSIS itself too. Much appreciated. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">18th November 2007, 14:45</div></div><div class="posttext">David,<br />
Let me offer a suggestion:<br />
!if &quot;${A}&quot; == &quot;${B}&quot;<br />
!define AequalBorC<br />
!endif<br />
!if &quot;${A}&quot; == &quot;${C}&quot;<br />
!define AequalBorC<br />
!endif<br />
!ifdef ${AequalBorC}<br />
 ...code...<br />
!endif<br />
<br />
<br />
It's a crappy temp define name, but you see the idea.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th November 2007, 14:56</div></div><div class="posttext">For the 2nd example that kichik has posted, let's say A (99) is equal to B (99):<br />
<br />
!define A_test_${B} # defines A_test_99<br />
!define A_test_${C} # defines A_test_128<br />
!ifdef A_test_${A} # A is 99 (A_test_99 is defined) therefore A==B.<br />
# ...(code)...<br />
!endifEdit: You should probably wrap the two !defines in !ifdefs in case B==C (you will get a compiler error)!<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">David B. Trout</div><div class="date">19th November 2007, 04:34</div></div><div class="posttext">Originally posted by demiller9<br />
<br />
David,<br />
Let me offer a suggestion:<br />
!if &quot;${A}&quot; == &quot;${B}&quot;<br />
!define AequalBorC<br />
!endif<br />
!if &quot;${A}&quot; == &quot;${C}&quot;<br />
!define AequalBorC<br />
!endif<br />
!ifdef ${AequalBorC}<br />
 ...code...<br />
!endifIt's a crappy temp define name, but you see the idea.<br />
<br />
DonYes, thanks, that is what I decided to go with in the interim since luckily I don't (yet) have too many combinations to deal with. As the number of tests (comparison combinations) increases though, it could become quite cumbersome, which is what I was hoping to avoid.<br />
<br />
'Tis a shame though that NSIS doesn't (yet?) support the format/style I originally posted. Any chance of that perhaps sometime changing in the [hopefully] near future?? &lt;hint! hint!&gt; ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">David B. Trout</div><div class="date">19th November 2007, 05:21</div></div><div class="posttext">Originally posted by Afrow UK<br />
<br />
For the 2nd example that kichik has posted, let's say A (99) is equal to B (99):<br />
<br />
!define A_test_${B} # defines A_test_99<br />
!define A_test_${C} # defines A_test_128<br />
!ifdef A_test_${A} # A is 99 (A_test_99 is defined) therefore A==B.<br />
# ...(code)...<br />
!endifEdit: You should probably wrap the two !defines in !ifdefs in case B==C (you will get a compiler error)!<br />
<br />
Stu(DOH!) Thanks Stu. Makes perfect sense now. Don't know why I didn't see it the first time. &lt;embarassed&gt;<br />
<br />
Unfortunately however, this technique, while slick, doesn't exactly help uncomplicate my code any. :(<br />
<br />
I mean, in order to use it the way I want to use it, I'd have to do something like:<br />
!define _STD_INSTALLER  1  /* NORMAL installer WITHOUT any developer files */<br />
!define _DEV_INSTALLER  2  /* With FishLib DEVELOPMENT FILES also embedded */<br />
!define _MIN_INSTALLER  3  /* ONLY FishLib, to embed into other installers */<br />
!define _WEB_INSTALLER  4  /* NO FILES embedded at all, downloaded instead */<br />
<br />
<br />
/* We wish to test if INSTALLER_TYPE == 2 or INSTALLER_TYPE == 4 */<br />
<br />
!define INSTALLER_TYPE_2                    /* (define what to test for) */<br />
!define INSTALLER_TYPE_4                    /* (define what to test for) */<br />
<br />
!ifdef INSTALLER_TYPE_${_INSTALLER_TYPE}    /* (perform the actual test) */<br />
<br />
  ...(code)...<br />
<br />
!endif<br />
!undef  INSTALLER_TYPE_2                    /* (must always cleanup too) */<br />
!undef  INSTALLER_TYPE_4                    /* (must always cleanup too) */<br />
<br />
  ... (bunch of unrelated code) ...<br />
<br />
/* NOW we need to test a completely different combination... */<br />
<br />
!define INSTALLER_TYPE_1                    /* (define what to test for) */<br />
!define INSTALLER_TYPE_3                    /* (define what to test for) */<br />
<br />
!ifdef INSTALLER_TYPE_${_INSTALLER_TYPE}    /* (perform the actual test) */<br />
<br />
  ...(code)...<br />
<br />
!endif<br />
!undef  INSTALLER_TYPE_1                    /* (must always cleanup too) */<br />
!undef  INSTALLER_TYPE_3                    /* (must always cleanup too) */<br />
<br />
  ...(etc)...As you can see, using this particular technique doesn't exactly make the code neat and clean, does it?<br />
<br />
Thanks anyway Stu and kichik, but I think I'm going to stick with Don's suggestion (which I had already figured out on my own) until such time as NSIS can be fixed. At least with his technique I can hide all my needed !defines in a !included header somewhere and then just use a simple, SINGLE, !ifdef whereever I need to, thereby preserving the simplicity/readability (and thus maintainability) of my code.<br />
<br />
Thanks for everyone's help folks. Much appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mr Inches</div><div class="date">21st November 2007, 13:40</div></div><div class="posttext">Hi David<br />
<br />
Depending on how your bitwise logical operator skills are, you could also use an approach similar to this (which is based on using bitmasks in C) by getting creative with the /math option for !define: <br />
<br />
<br />
!define Standard    0x00000001<br />
!define Development 0x00000002<br />
!define Web         0x00000004<br />
<br />
!define /math InstallerType ${Standard} | ${Development}<br />
<br />
!define /math IsStandardInstaller            ${InstallerType} &amp; ${Standard}<br />
!define /math IsDevelopmentInstaller         ${InstallerType} &amp; ${Development}<br />
!define /math IsStandardDevelopmentInstaller ${IsStandardInstaller} &amp; ${Development}<br />
<br />
!if ${IsStandardInstaller}<br />
    !echo &quot;standard installation&quot;<br />
!endif<br />
<br />
!if ${IsDevelopmentInstaller}<br />
    !echo &quot;development installation&quot;<br />
!endif<br />
<br />
!if ${IsStandardDevelopmentInstaller}<br />
    !echo &quot;standard and development installation&quot;<br />
!endif<br />
<br />
<br />
and so on.<br />
<br />
I don't know how this would work out for you, but it could be worth trying out, particularly if work through some of the other combinations of the bitmasks to reflect your desired logic.<br />
<br />
Duncan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Fightin_Foo</div><div class="date">23rd November 2007, 22:31</div></div><div class="posttext">Maybe I am making this all too simple but have you tried the OrIf in the LogicLib?<br />
<br />
${If} &quot;${A}&quot; == &quot;${B}&quot;<br />
   ;;<br />
${OrIf} &quot;${A}&quot; == &quot;${C}&quot;<br />
   ;;<br />
${EndIf}<br />
<br />
It was just a thought, like I said probably making the problem too simple</div></div><hr />


<div class="post"><div class="posttop"><div class="username">David B. Trout</div><div class="date">24th November 2007, 06:12</div></div><div class="posttext">Originally posted by Fightin_Foo <br />
Maybe I am making this all too simple but have you tried the OrIf in the LogicLib?<br />
<br />
${If} &quot;${A}&quot; == &quot;${B}&quot;<br />
   ;;<br />
${OrIf} &quot;${A}&quot; == &quot;${C}&quot;<br />
   ;;<br />
${EndIf}<br />
<br />
It was just a thought, like I said probably making the problem too simple(SIGH!)<br />
<br />
Please read the complete thread before posting.<br />
<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">David B. Trout</div><div class="date">24th November 2007, 07:14</div></div><div class="posttext">Originally posted by Mr Inches:<br />
<br />
Hi David<br />
<br />
Depending on how your bitwise logical operator skills are, you could also use an approach similar to this (which is based on using bitmasks in C) by getting creative with the /math option for !define:&lt;code snipped&gt;<br />
and so on.<br />
<br />
I don't know how this would work out for you, but it could be worth trying out, particularly if work through some of the other combinations of the bitmasks to reflect your desired logic.<br />
<br />
DuncanMy bitwise operator skills are just fine Duncan, but your suggestion is unfortunately no better than Don's (and in many ways worse). Thanks anyway.  :(<br />
<br />
<br />
-------------------------<br />
&lt;hint&gt; Try changing your &quot;InstallerType&quot; to just &quot;Standard&quot; (it will NEVER be more than one value at the same time!!) and then show the code necessary to test whether the passed &quot;InstallerType&quot; is EITHER &quot;Standard&quot; -OR- &quot;Development&quot;. Do that and I think you'll see your technique is actually worse than Don's since it takes more code to setup the combination-value tests.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>