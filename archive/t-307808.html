<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Username/Password Integration, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Username/Password Integration NSIS Discussion" />
	
	<title> Username/Password Integration [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Username/Password Integration</div>
<hr />
<div class="pda"><a href="t-307808.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=307808">Username/Password Integration</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">29th June 2009, 22:08</div></div><div class="posttext">So im building a NSIS installer for one of the servers that im allowing that lets agents bridge their software to my db.<br />
<br />
On my PHP form it takes their login/password and stores it then installs with those settings.<br />
<br />
<br />
Is there a way to do this with NSIS?<br />
<br />
Specifically, I would like it to prompt for a username/password in a window just after language setting, then transport that to one of the installer files.<br />
<br />
<br />
Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 10:33</div></div><div class="posttext">nsDialogs/InstallOptions. Or you can use the PassDialog plug-in but nsDialogs may be best.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 15:11</div></div><div class="posttext">Ok so I got the user/pass to store to a variable, now all I need to do is print it to a .php file (it can be text, its just going to need to be there so that it can be found by another person)<br />
<br />
FileOpen $9 asim_ini.php w<br />
FileWrite $9 &quot; &lt;?php&quot;<br />
FileWrite $9 &quot; //bridge file created Mon, 29 Jun 2009 15:43:29 -0500 for user $uNameRem&quot;<br />
#FileWrite $9 &quot; $asim_install_dir = &quot;&quot;;&quot;<br />
#FileWrite $9 &quot; $bridge_company = &quot;A&quot;;&quot;<br />
#FileWrite $9 &quot; $asim_bridge_upload_url = &quot;&quot;<br />
#FileWrite $9 &quot; $asim_bridge_server = &quot;&quot;<br />
#FileWrite $9 &quot; $asim_bridge_pub_key = &quot;&quot;<br />
#FileWrite $9 &quot; $browser_path = &quot;&quot;<br />
#FileWrite $9 &quot; $test_bridge_file_name = &quot;&quot;<br />
#FileWrite $9 &quot; $agent_auth = &quot;&quot;<br />
#FileWrite $9 &quot; $detect_os = &quot;&quot;<br />
FileWrite $9 &quot; //if this is an nt machine but %OS% is custom, uncomment next line and add custom value.&quot;<br />
#FileWrite $9 &quot; $custom_nt_os_env = &quot;&quot;;&quot;<br />
#FileWrite $9 &quot; $wl_user_name = &quot;$uNameRem&quot;;&quot;<br />
#FileWrite $9 &quot; $wl_user_password = &quot;$pWord&quot;;&quot;<br />
#FileWrite $9 &quot; $proxy_host = &quot;&quot;;&quot;<br />
#FileWrite $9 &quot; $proxy_port = &quot;&quot;;//8080 and 3128 are common proxy ports&quot;<br />
#FileWrite $9 &quot; $proxy_user = &quot;&quot;;&quot;<br />
#FileWrite $9 &quot; $proxy_pass = &quot;&quot;;&quot;<br />
FileWrite $9 &quot; ?&gt;&quot;<br />
FileClose $9 <br />
<br />
Thats what I have for my filewrite, but 2 things are the problem,<br />
<br />
1. Its not writing the file and including it in the install....it doesnt show up in the folder with the install.<br />
<br />
2. Im getting some random errors about it wanting 3 parameters instead of 6.<br />
<br />
Ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 15:16</div></div><div class="posttext">1. Specify a full path.<br />
2. You have some quotes inside quotes. Either escape them using $\ or change the outer quotes to ` or '.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 15:17</div></div><div class="posttext">Specify a full path for which, the <br />
<br />
FileOpen $9 asim_ini.php w ?<br />
<br />
i.e. FileOpen $9 C:\asim_ini.php w ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 16:05</div></div><div class="posttext">Correct. Otherwise it writes to the working directory (whatever $OUTDIR is).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 16:16</div></div><div class="posttext">Originally posted by Afrow UK <br />
Correct. Otherwise it writes to the working directory (whatever $OUTDIR is).<br />
<br />
Stu  <br />
<br />
Ok, so here is my code. Everythign compiles without errors, but in the install Dir, the asim_ini.php is not showing up.<br />
<br />
Am I doing something wrong? I changed the format of my code a bit.<br />
<br />
Function asimwrite<br />
         !macro WriteLine Line<br />
         FileWrite $R0 `${Line}$\r$\n`<br />
         !macroend<br />
         !define WriteLine `!insertmacro WriteLine`<br />
<br />
         Push $R0<br />
         FileOpen $R0 `$INSTDIR\asim_ini.php` w<br />
         ${WriteLine} ' &lt;?php'<br />
         ${WriteLine} ' '<br />
         ${WriteLine} ' '<br />
         ${WriteLine} ' $bridge_company = &quot;&quot;;'<br />
         ${WriteLine} ' $asim_bridge_upload_url = &quot;&quot;;'<br />
         ${WriteLine} ' $asim_bridge_server = &quot;&quot;;'<br />
         ${WriteLine} ' $asim_bridge_pub_key = &quot;5740dbb403b4c2c3bd7525e05364785ce84f23bc&quot;;'<br />
         ${WriteLine} ' $browser_path = &quot;C:\\Program Files\\Internet Explorer\\iexplore.exe&quot;;'<br />
         ${WriteLine} ' $test_bridge_file_name = &quot;test_brg.txt&quot;;'<br />
         ${WriteLine} ' $agent_auth = &quot;Y&quot;;'<br />
         ${WriteLine} ' $detect_os = &quot;Y&quot;;'<br />
         ${WriteLine} ' //if this is an nt machine but %OS% is custom, uncomment next line and add custom value.'<br />
         ${WriteLine} ' $custom_nt_os_env = &quot;&quot;;'<br />
         ${WriteLine} ' $wl_user_name = &quot;$uNameRem&quot;;'<br />
         ${WriteLine} ' $wl_user_password = &quot;$pWord&quot;;'<br />
         ${WriteLine} ' $proxy_host = &quot;&quot;;'<br />
         ${WriteLine} ' $proxy_port = &quot;&quot;;//8080 and 3128 are common proxy ports'<br />
         ${WriteLine} ' $proxy_user = &quot;&quot;;'<br />
         ${WriteLine} ' $proxy_pass = &quot;&quot;;'<br />
         ${WriteLine} ' ?&gt;'<br />
         ${WriteLine} ' The write File is working!'<br />
         FileClose $R0<br />
         Pop $R0<br />
FunctionEnd<br />
<br />
<br />
<br />
All I need it to do is to make sure that text is in the .ini text file so that when it is called from another program that file is existant.<br />
<br />
<br />
Ideas (thanks for all the help!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 16:20</div></div><div class="posttext">Does $INSTDIR exist before you call this function?<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 16:21</div></div><div class="posttext">Oh crap im dumb.<br />
<br />
Okay so at the end of the install function, just call this function?<br />
<br />
What is the code to call a function in NSIS?<br />
<br />
Call {lkjsdklfjsd}?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 16:22</div></div><div class="posttext">If you looked up Call you'd find out!<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 16:23</div></div><div class="posttext">Doing that now!<br />
<br />
Thanks for all the help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 16:26</div></div><div class="posttext">God im dumb, it worked.<br />
<br />
Wrote the file extremely well.....such a big help.<br />
<br />
<br />
Now, when I do my username/login, its not writing the proper value that I had stored in the var.<br />
<br />
Here is my code,<br />
<br />
Var uNameRem<br />
Var pWord<br />
<br />
Function myPage<br />
nsDialogs::Create 1018<br />
<br />
!insertmacro MUI_HEADER_TEXT &quot;Producer Login&quot; &quot;Please login to the server.&quot;<br />
${NSD_CreateLabel} 0 0 300u 48u &quot;To continue with installation you will need to login.$\n$\n$\n$\nPlease enter your producer code and password.&quot;<br />
${NSD_CreateLabel} 20u 60u 60u 12u &quot;Producer Code: &quot;<br />
${NSD_CreateText} 80u 58u 150u 12u $uNameRem<br />
Pop $uNameRem<br />
${NSD_CreateLabel} 20u 80u 60u 12u &quot;Password: &quot;<br />
${NSD_CreateText} 80u 78u 150u 12u &quot;&quot; $pWord<br />
Pop $pWord<br />
GetDlgItem $0 $HWNDPARENT 1<br />
SendMessage $0 ${WM_SETTEXT} 0 &quot;STR:Login&quot;<br />
nsDialogs::Show<br />
<br />
MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you sure you producer code is $uNameRem and your password is $pWord?&quot; IDYES +2<br />
FunctionEnd<br />
<br />
<br />
when I call the $uNameRem and $pWord is just gives a big long number rather than what was entered. Is there a more explicit way to call this variable so it displays the correct variable?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 17:07</div></div><div class="posttext">That is because they contain the text box control handles not the texts. You need to store the texts in 2 other variables and read the texts using NSD_GetText.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 17:15</div></div><div class="posttext">Im not sure I follow you on this one, is there an example of this somewhere?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 17:19</div></div><div class="posttext">There are many examples. The nsDialogs doc shows it quite well too.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 17:28</div></div><div class="posttext">${NSD_CreateLabel} 20u 60u 60u 12u &quot;Producer Code: &quot;<br />
${NSD_CreateText} 80u 58u 150u 12u &quot;&quot;<br />
Pop $uNameRem<br />
<br />
${NSD_CreateLabel} 20u 80u 60u 12u &quot;Password: &quot;<br />
${NSD_CreateText} 80u 78u 150u 12u &quot;&quot; <br />
Pop $pWord<br />
<br />
${NSD_GetText} $uNameRem $Name<br />
${NSD_GetText} $pWord $Pass<br />
<br />
<br />
Thats what I have now, the problem is its not storing the information correctly.<br />
<br />
I have the vars defined properly, but I have a feeling im missing something minor</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 17:39</div></div><div class="posttext">You have to get the text in the leave function.<br />
<br />
Edit: Also for the two CreateText lines rather than passing an empty string you could pass the two text variables instead so that the user does not have to enter again, but that is up to you.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 17:43</div></div><div class="posttext">Originally posted by Afrow UK <br />
You have to get the text in the leave function.<br />
<br />
Edit: Also for the two CreateText lines rather than passing an empty string you could pass the two text variables instead so that the user does not have to enter again, but that is up to you.<br />
<br />
Stu  <br />
<br />
I dont follow you on the leave function....<br />
<br />
Function nsDialogsPageLeave<br />
<br />
	${NSD_GetText} $Text $0<br />
	MessageBox MB_OK &quot;You typed:$\n$\n$0&quot;<br />
<br />
FunctionEnd<br />
<br />
<br />
<br />
Thats the only example of a leave function I could find</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 17:56</div></div><div class="posttext">All the examples use a leave function.<br />
<br />
Page Custom ShowFunction LeaveFunction<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 18:28</div></div><div class="posttext">Got it, thanks for the help afrow.<br />
<br />
<br />
Next question: How can I convert the password string to an MD5 HASH?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 18:34</div></div><div class="posttext">If you search the wiki for MD5 you will find 2 plugins.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 18:50</div></div><div class="posttext">Got that far, just couldnt get it to display the proper hash value;<br />
<br />
My code for it is;<br />
<br />
Function LoginLeave<br />
<br />
	${NSD_GetText} $uNameRem $0<br />
	${NSD_GetText} $pWord $1<br />
	MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you SURE your producer code [$0] &amp; password [$1] are correct?&quot; IDYES +2<br />
	Crypto::HashData &quot;MD5&quot; &quot;$1&quot;<br />
        Pop $2<br />
<br />
FunctionEnd<br />
<br />
<br />
Do I need to add a Get function in order to save that hash data for when it writes to the file?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 19:40</div></div><div class="posttext">You should probably use the MD5 plug-in. I'm sure it's smaller in size.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 19:53</div></div><div class="posttext">New Code with MD5 still isnt working....hmmmm<br />
<br />
	${NSD_GetText} $uNameRem $0<br />
	${NSD_GetText} $pWord $1<br />
	MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 &quot;Are you SURE your producer code [$0] &amp; password [$1] are correct?&quot; IDYES +2<br />
        md5dll::GetMD5String &quot;$1&quot;<br />
        Pop $2<br />
<br />
<br />
<br />
Edit: Do i need to add an output variable to the end of the md5 string?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th June 2009, 20:01</div></div><div class="posttext">The Pop $2 puts the return value in $2.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 20:03</div></div><div class="posttext">thats what I thought, but when I display that value when im writing it to my file from earlier, it displays a null value.<br />
<br />
Im assuming I need to write a function in that file writing function to call the md5 hash conversion?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 20:07</div></div><div class="posttext">got it, thanks for everything afrow</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ryanpager</div><div class="date">30th June 2009, 22:03</div></div><div class="posttext">Out of curiosity, for a password field, is there a way to get the text to show in the box as ******** rather than 12345676?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">2nd July 2009, 19:06</div></div><div class="posttext">http://nsis.sourceforge.net/NsDialogs_FAQ#How_to_create_a_Text_Password_control</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>