<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with search &amp; replace and latest version of NSIS, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with search &amp; replace and latest version of NSIS NSIS Discussion" />
	
	<title> Problem with search &amp; replace and latest version of NSIS [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with search &amp; replace and latest version of NSIS</div>
<hr />
<div class="pda"><a href="t-125728.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=125728">Problem with search &amp; replace and latest version of NSIS</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">20th February 2003, 08:14</div></div><div class="posttext">Dear folks,<br />
<br />
I have a problem with the search &amp; replace function written by KiCHiK<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=73&amp;instances=0,44<br />
<br />
I took this function into my script and compiled it with the old version of NSIS (sorry old means 2.0b0). Means I had to search in several files and replace several lines. So I copied this function, renamed it and everything went fine.<br />
<br />
NOW, I am working with CVS version (2.0b2) and everything went wrong. Calling this function two times: one time to replace four lines in FILE A and  replace two lines in FILE B. Depending on which FILE is called first, the other one is getting 0KB size.<br />
<br />
So calling the function for FILE A first, makes FILE B output 0KB and vice versa.<br />
<br />
Thing this is not normal?<br />
Is anybody out ther to verify this behaviour or telling me what I am doing wrong? Perhaps I can place the code somewhere...<br />
<br />
I am using other functions too (e.g. PATH manipulation, service check and so on). Could this be a problem?<br />
<br />
Regards <br />
Mo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">20th February 2003, 09:33</div></div><div class="posttext">Function ReplaceAPParams<br />
FileOpen $0 &quot;$INSTDIR\\Path\\to\\file_A.conf.tmp&quot; &quot;r&quot;<br />
GetTempFileName $R0<br />
FileOpen $1 $R0 &quot;w&quot;<br />
loop:<br />
   FileRead $0 $2<br />
   IfErrors done<br />
   StrCmp $2 &quot;++ServerRoot++$\\r$\\n&quot; 0 +3<br />
      FileWrite $1 &quot;ServerRoot $\\&quot;$INSTDIR\\Apache2$\\&quot;$\\r$\\n&quot;<br />
      Goto loop<br />
   StrCmp $2 &quot;++DocumentRoot++$\\r$\\n&quot; 0 +3<br />
      FileWrite $1 &quot;DocumentRoot $\\&quot;$INSTDIR\\Apache2\\htdocs$\\&quot;$\\r$\\n&quot;<br />
      Goto loop<br />
   StrCmp $2 &quot;++php_value include_path++$\\r$\\n&quot; 0 +3<br />
      FileWrite $1 &quot;php_value include_path = $\\&quot;.;$INSTDIR\\Apache2\\htdocs\\php$\\&quot;$\\r$\\n&quot;<br />
      Goto loop<br />
   StrCmp $2 &quot;++mod_gzip_temp_dir++$\\r$\\n&quot; 0 +3<br />
      FileWrite $1 &quot;mod_gzip_temp_dir = $\\&quot;$INSTDIR\\Apache2\\tmp$\\&quot;$\\r$\\n&quot;<br />
      Goto loop<br />
   FileWrite $1 $2<br />
      Goto loop<br />
<br />
done:<br />
   FileClose $0<br />
   FileClose $1<br />
   Delete &quot;$INSTDIR\\Path\\to\\file_A.conf.tmp&quot;<br />
   Rename $R0 &quot;$INSTDIR\\Path\\to\\file_A.conf&quot;<br />
FunctionEnd<br />
<br />
<br />
This really works fine on this file_A. I call this function in the corresponding section with:<br />
<br />
Call ReplaceAPParams<br />
<br />
<br />
What it does: Replacing the 4 lines beginning with:<br />
++ServerRoot++<br />
++DocumentRoot++<br />
++php_value include_path++<br />
++mod_gzip_temp_dir++<br />
<br />
AND: it really does what it should<br />
<br />
BUT: After this function I call another (ReplacePHPParams), and it's really the same except it's another file to be opened and some other values to be replaced.<br />
<br />
I call this (other) function in ITS corresponding section also with <br />
<br />
<br />
Call ReplacePHPParams<br />
<br />
<br />
The output when the installer is called:<br />
file_A.conf    39KB<br />
file_B.conf     0KB<br />
<br />
Turning this around (calling ReplacePHPParams first) makes it looking like that:<br />
file_A.conf     0KB<br />
file_B.conf    39KB<br />
<br />
(Both files have 39KB so the size should only be a indicator that it is written or not.)<br />
<br />
Thx for help <br />
Mo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th February 2003, 13:11</div></div><div class="posttext">Try b1, try the latest CVS version and if nither works attach the full script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">20th February 2003, 14:01</div></div><div class="posttext">KiCHiK -<br />
(Thx for ya offer:-)<br />
<br />
I did it already. I tried all of them. BUT my old 2.0b0 strikes after installation of a later release.... It tells me something like:  Error: Can't find &quot;MUI.nsh&quot; <br />
<br />
So here is the script! (attached)<br />
Eventually it is rubbish in some parts, that's because I extracted it from the big one....<br />
(some messy parts: SplashScreen, etc)<br />
<br />
Thx in advance<br />
Mo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th February 2003, 15:59</div></div><div class="posttext">I think the &quot;IfErrors done&quot; line does this. The error flag must have been set somewhere along the way and when it got to the function it just skipped it all because it thought there is an error. I have added ClearErrors at the top of my script in the archive and so should you for your script.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">20th February 2003, 16:23</div></div><div class="posttext">Sorry, could you be a bit more specific?<br />
:-)<br />
-------[edit]<br />
commenting this line makes my system hang @installation time ---------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th February 2003, 16:29</div></div><div class="posttext">Add ClearErrors at the top of each function that replaces lines in your script and uses my code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Mosestycoon</div><div class="date">20th February 2003, 16:30</div></div><div class="posttext">got it, sorry my fault<br />
<br />
COOL<br />
Thx for debugging!<br />
<br />
<br />
------ [edit]<br />
<br />
It's working again, yiiieeeepppiiii<br />
Now let's go on working<br />
<br />
Luv ya guys ;-)<br />
<br />
----------------</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>