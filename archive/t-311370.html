<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Error on exiting Installer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Error on exiting Installer NSIS Discussion" />
	
	<title> Error on exiting Installer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Error on exiting Installer</div>
<hr />
<div class="pda"><a href="t-311370.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=311370">Error on exiting Installer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Diddler</div><div class="date">2nd September 2009, 15:05</div></div><div class="posttext">Hi all,<br />
<br />
I'm getting an Application Error when Installer exists. Error message says: &quot;Instruction at &quot;0x01a01c51&quot; referenced memory at &quot;0x00000004&quot;. The memory could not be &quot;read&quot;. Click OK to terminate the program.<br />
<br />
Installer does everything it is supposed to, but this annoying message pops up in the end. Any pointers as to what I should be looking for or check to get rid of the error?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Diddler</div><div class="date">4th September 2009, 12:16</div></div><div class="posttext">Update;<br />
<br />
I have now identified when this runtime error occurs. It happens every time I use a specific call to an external DLL through System::Call. Call has following signature:<br />
<br />
bool APIENTRY GetSomeStuff( char *Buffer, int BufferLength )<br />
<br />
Call from NSIS is:<br />
System::Call &quot;Mydllfilename::GetSomeStuff(t .r7, i 30) i .r0&quot;<br />
<br />
I have experimented with different ways/parameters in the System::Call, but nothing seems to make a difference. The call produces the desired results, but for some reason I always get an Application error when Installer exits. The error does not occur if this call is not made. Any ideas as to why this happens? A bug in the dll? The same dll has been earlier used with InstallShield without issue. Also, it seems to work fine when called otherwise outside of NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">4th September 2009, 15:48</div></div><div class="posttext">InstallShield? is this function cdecl by any chance? Or to put it another way, what is APIENTRY defined to?<br />
<br />
You could try adding the cdecl flag to the system call, see the system readme for more info</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">4th September 2009, 16:18</div></div><div class="posttext">APIENTRY is defined in windef.h:#define WINAPI      __stdcall<br />
...<br />
#define APIENTRY    WINAPI</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">4th September 2009, 16:50</div></div><div class="posttext">You you have the source to this thing, you could try to replace the body of the function with something simple like <br />
lstrcpynA(Buffer,&quot;foobarbaz&quot;,BufferLength);<br />
return 1;</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>