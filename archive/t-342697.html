<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Reuse same logic on several files to choose which files to install., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Reuse same logic on several files to choose which files to install. NSIS Discussion" />
	
	<title> Reuse same logic on several files to choose which files to install. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Reuse same logic on several files to choose which files to install.</div>
<hr />
<div class="pda"><a href="t-342697.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=342697">Reuse same logic on several files to choose which files to install.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">warp-9.9</div><div class="date">27th February 2012, 19:21</div></div><div class="posttext">Hello.  I'm new to NSIS, but have been searching Wiki, FAQ, manual, forum, and Google for hours and can't make progress.  If you can point me in the right direction, thanks.<br />
<br />
I have a handful of files.  I want them all stuck into the installer, in case they are needed.  For each file, I want the installer to check if the destination exists.  If it exists, then I want to make a backup by renaming with a .bak extension.  If the backup exists, I don't want to touch the backup.  I do not want to clobber any files.  If there is a backup, and no original (for whatever odd reason), then I'll just install the file, but not touch the .bak.<br />
<br />
I have worked out the logic to achieve this.  I was trying to stick this logic into a Function or a Macro, so that I could reuse it.  This would mean passing the file name as a parameter.  I keep getting an error from the File command, because it apparently does not like variables.  I have fiddled with the /oname switch, but File still requires a static name at the end.<br />
<br />
Wiki Examples 3.2.1 and 3.2.2 (http://nsis.sourceforge.net/Macro_vs_Function#File_command) clearly show File being passed as a variable inside both a Macro and a Function, which is the first relevant document I read.  It appears these examples are incorrect.  Or else it fails to demonstrate how to achieve this.<br />
<br />
This is the only Section in my .nsi file.  The little bit of logic is what I was trying to avoid typing over and over manually, as it is ugly and hard to follow.  If there's another way to achieve the same result, I'd be interested to consider that as well.  Other syntax, techniques or modules.<br />
<br />
Section &quot;-noop&quot;<br />
    SetOutPath $INSTDIR<br />
<br />
    # Logic to Check for Installed and Backups, Rename or Copy<br />
    # but never overwrite<br />
    IfFileExists &quot;INSTALL.txt&quot; 0 +3<br />
        IfFileExists &quot;INSTALL.txt.bak&quot; +3 0         #  I  B -&gt; !R !C<br />
            Rename &quot;INSTALL.txt&quot; &quot;INSTALL.txt.bak&quot;  #  I !B -&gt;  R  C<br />
            File &quot;INSTALL.txt&quot;                      # !I  B -&gt; !R  C - same<br />
                                                    # !I !B -&gt; !R  C - same<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th February 2012, 19:34</div></div><div class="posttext">Example 3.2.2 is broken, the macro should work... (You cannot pass a variable as the file source path/name)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">warp-9.9</div><div class="date">27th February 2012, 22:51</div></div><div class="posttext">Example 3.2.2 is broken, the macro should work... (You cannot pass a variable as the file source path/name)<br />
<br />
Ok, thanks for clarifying.  Before posting, I tried a pure Function, a pure Macro, and a Hybrid.  I must have mistyped the Macro somehow, because it works fine now.<br />
<br />
I'm still a bit confused about the parameter passed to the macro not being a variable.  Is it that everything that touches the macro, including the parameters, are just copy/pasted internally just before compilation?<br />
<br />
Also not sure I understand the reasoning behind the restriction of File not using variables for cases like this.  Whether I mistype the string literal now, or mistype a variable name that later references that string literal, it makes little difference.  In either case I'd get a file not found error when compiling, and then go fix the typo.<br />
<br />
My code here was simple enough for a macro, so it doesn't matter in this case.  But if my per-file logic or list of total files got bigger, the macro technique could cause bloat.  That'd be a concern.  How do people normally work around this?<br />
<br />
Anyways, thanks again.  Cheers.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">27th February 2012, 23:32</div></div><div class="posttext">A macro can take variables as parameters but the File instruction can not since variables are used at runtime (on the end users machine) and the file instruction needs a filename at compile time (/oname (destination) can use parameters)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>