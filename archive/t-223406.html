<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to 'normalize' file path?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to 'normalize' file path? NSIS Discussion" />
	
	<title> How to 'normalize' file path? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to 'normalize' file path?</div>
<hr />
<div class="pda"><a href="t-223406.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=223406">How to 'normalize' file path?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">5th August 2005, 12:34</div></div><div class="posttext">The problem with long paths came back.<br />
I write the following line:<br />
<br />
  File /r &quot;..\..\..\..\..\bin\JBossSources\*.*&quot;<br />
<br />
and this leads to file paths exceeding 255.<br />
How can I transform this relative path to absolute path without '..\'?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">5th August 2005, 13:12</div></div><div class="posttext">This one might help in combination with the System plug-in.<br />
<br />
http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/reference/shlwapi/path/pathcanonicalize.asp</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">5th August 2005, 13:17</div></div><div class="posttext">This sort of depends on how much you know about the directory structure.<br />
<br />
E.g. If the path ends up as: &quot;C:\Program Files\Miscellaneous\Keep\Productname\Files\Exe\bin\JbossSources\&quot;, and you know everything from Productname onwards, then you can simply get the current path (using GetFullPathName) and remove the requisite number of characters to find the path you want.<br />
<br />
So if you wanted to put files into &quot;C:\Program Files\Miscellaneous\Keep\Productname&quot; and you're in &quot;C:\Program Files\Miscellaneous\Keep\Productname\Files\Exe\bin\JbossSources\&quot;:<br />
GetFullPathName $0 &quot;.&quot;<br />
StrLen $1 $0<br />
IntOp $1 $1-27<br />
StrCpy $0 $0 $1<br />
That'd shorten the full pathname by 27 characters (ie. &quot;\Files\Exe\bin\JbossSources\&quot;) and give you the required path.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">5th August 2005, 17:15</div></div><div class="posttext">In some of my VBScripts, I use a call to 'System.FileSystemObject' that allows me to get the short path of any path.  system.FileSystemObject is contained in SCRRUN.DLL, which gets registered with the Windows Scripting Host.  <br />
<br />
The function returns a DOS file name using the 8.3 format.  (using tildes (&quot;~&quot;) to truncate file names longer than 8 characters.  For example, &quot;C:\Program files&quot; would usually return &quot;C:\Progra~1&quot;.<br />
<br />
Problem is, I'm not sure if there is anything similiar that could be called via NSIS.  (I was thinking that perhaps this is also a file property setting you might be able to read with the proper plugin, but I'm not 100% sure.)<br />
<br />
PS:  if you need an example of a VBScript function, let me know.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">8th August 2005, 12:50</div></div><div class="posttext">BTW, I thought a little and decided that actually it is NSIS problem, not mine. I'm providing NSIS with the correct (relative) path, and absolute path to my files is within 255, so why should I be aware that NSIS is not smart enough and just concatenates current folder and relative path? I shouldn't be aware of this inside implementation details. Moreover - even now I'm just guessing why the error occurs.<br />
<br />
My proposal is to implement paths canonization within NSIS itself.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">8th August 2005, 16:10</div></div><div class="posttext">Can't use PathCanonicalize since this could be called in runtime, but my problem is compile-time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">9th August 2005, 10:00</div></div><div class="posttext">@Comperio: There is an API function (GetShortPathName) which can be called by NSIS/System.dll to get the short filename. But be aware that there may exist files which don't have a short filename under some filesystems (had this problem with Windows 2000 and NTFS).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">9th August 2005, 10:04</div></div><div class="posttext">It is useful as long as being called in runtime. The error I'm getting is occured on File statement in compile-time.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">stb</div><div class="date">9th August 2005, 10:09</div></div><div class="posttext">@Yurik: I know. I don't have your problem, but I agree NSIS should normalize path on compile time. You may build a workaround using &quot;!cd&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">9th August 2005, 10:10</div></div><div class="posttext">thanks, stb, I will try!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobGrant</div><div class="date">9th August 2005, 14:07</div></div><div class="posttext">Ooh.<br />
<br />
If you want to be quick about it, write a program in C or C++ or Perl or something that splits the path down into / (or \)-separated chunks, then checks the length of each chunk and truncates it if necessary?<br />
<br />
P.S. this can be done in NSIS.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yurik</div><div class="date">9th August 2005, 14:23</div></div><div class="posttext">Thank, RobGrant. For now I've made a simple thing - before calling my script which is performed from a batch file, I normalize the path using batch commands (%~f1) and pass the result to the script as a define. But I hope later it will be implemented in NSIS.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>