<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Cancel / Revert changes when DLL is locked, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Cancel / Revert changes when DLL is locked NSIS Discussion" />
	
	<title> Cancel / Revert changes when DLL is locked [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Cancel / Revert changes when DLL is locked</div>
<hr />
<div class="pda"><a href="t-320665.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=320665">Cancel / Revert changes when DLL is locked</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">TheGrudge</div><div class="date">9th July 2010, 10:54</div></div><div class="posttext">Hi,<br />
<br />
I want to cancel the deinstaller when a DLL file is still openend by another app, like IE.<br />
How can I detect this?<br />
<br />
I used the following code:<br />
	# check if IE is locking 'hbxie.dll'<br />
	ClearErrors<br />
	FileOpen $R0 &quot;$INSTDIR\hbxie.dll&quot; w<br />
	${If} ${Errors}<br />
	 # File is locked.<br />
	${Else}<br />
	 FileClose $R0<br />
	${EndIf}<br />
<br />
but this only works when INSTALLING, not deinstalling.<br />
Also I'd like to revert changes when an error occured and the user clicked &quot;cancel&quot;.<br />
Is this possible?<br />
<br />
I searched the forum, but the only solution I came up with so far is the above makro, which doesn't work when removing the file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">9th July 2010, 12:01</div></div><div class="posttext">Take a look at the LockedList plugin.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TheGrudge</div><div class="date">9th July 2010, 12:05</div></div><div class="posttext">Yes, I already found out about this one, and it seems to work fine :-)<br />
But thanks for the tipp :)<br />
<br />
The only thing I'm not sure how to do now is to do a revert.<br />
Let's say installation fails at 67%, reasons unknown. The user presses Cancel, but the already installed files and registry keys are not removed. <br />
<br />
Is there a built-in solution?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">9th July 2010, 12:19</div></div><div class="posttext">There is no built-in solution. There are however some header files that can help with semi-automated deletion of installed files:<br />
http://nsis.sourceforge.net/Uninstall_only_installed_files<br />
http://nsis.sourceforge.net/Advanced_Uninstall_Log_NSIS_Header<br />
<br />
I've never used them myself, so I can't help you there. Personally, I prefer doing everything myself, at least that way I know exactly what's going on. What I do is create the uninstaller as the first step in the installation process. That way I can rollback installation even if it fails halfway. (My uninstallers only remove what I know I installed myself, like every good uninstaller should.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th July 2010, 13:13</div></div><div class="posttext">Another option:<br />
http://nsis.sourceforge.net/Install_on_reboot<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>