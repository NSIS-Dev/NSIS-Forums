<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" InstallOptions and aborting the uninstaller, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  InstallOptions and aborting the uninstaller NSIS Discussion" />
	
	<title> InstallOptions and aborting the uninstaller [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  InstallOptions and aborting the uninstaller</div>
<hr />
<div class="pda"><a href="t-240193.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=240193">InstallOptions and aborting the uninstaller</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">7th March 2006, 17:51</div></div><div class="posttext">Hi all,<br />
<br />
I need to do the following: when uninstalling, a custom page should be shown with 2 radio buttons:<br />
a)- if one is selected I have to check that the user is admin and in case it is go further, if not abort the uninstaller with an error<br />
b)- if the other radio-button is selected I have to run an .exe from the installation directory and abort right away the uninstaller (doesn't need to wait until the exe is finished)<br />
<br />
What I did:<br />
=============<br />
- defined the page:<br />
UninstPage custom un.UninstallModePage un.ValidateSelection ;Custom page<br />
- reserve:<br />
ReserveFile &quot;UninstallMode.ini&quot;<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
- Extract InstallOptions INI files<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;UninstallMode.ini&quot;<br />
- show it:<br />
Function un.UninstallModePage ;UninstallModePage defined with Page command<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;UninstallMode.ini&quot;<br />
FunctionEnd<br />
- I added the un.ValidateSelection in order to do here  the needed things for a) and b)<br />
Function un.ValidateSelection ; when the user finished with the selection<br />
  ; check if the selection is the second radio button and if yes for now do a MsgBox and abort the whole uninstaller<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $INI_VALUE &quot;UninstallMode.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  StrCmp $INI_VALUE &quot;1&quot; 0 +3<br />
    MessageBox MB_OK &quot;Here we should run another exe and then abort&quot;<br />
    Abort ; abort somehow the whole uninstaller !!!<br />
    <br />
  ; check if the selection is the first radio button and if yes check that the current user is admin otherwise abort the whole uninstaller<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $INI_VALUE &quot;UninstallMode.ini&quot; &quot;Field 1&quot; &quot;State&quot;<br />
  StrCmp $INI_VALUE &quot;1&quot; 0 done<br />
    ClearErrors<br />
    UserInfo::GetAccountType<br />
    Pop $1<br />
    StrCmp $1 &quot;Admin&quot; 0 +3<br />
      MessageBox MB_OK 'User is in the Administrators group'<br />
      Goto done<br />
    MessageBox MB_OK 'User is NOT in the Administrators group, so we should ABORT here somehow'<br />
    Abort ; abort somehow the whole uninstaller !!!<br />
done:<br />
FunctionEnd<br />
<br />
Problems:<br />
===========<br />
- In both cases a) and b) I need to at some point completely abort the uninstaller. Those points are showed in un.ValidateSelection, check for &quot;abort somehow the whole uninstaller !!!&quot;. How can I abort the whole uninstaller in those cases? For b) with no error message, and for a) with a MsgBox saying that the current user needs to be admin?<br />
- In case of b) where and how should I run the exe just before aborting the whole uninstaller?<br />
<br />
Sorry for the long post and thx in advance,<br />
Viv</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">7th March 2006, 18:57</div></div><div class="posttext">I think you want to use Quit instead of Abort. Example:<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_READ $INI_VALUE &quot;UninstallMode.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
StrCmp $INI_VALUE &quot;1&quot; 0 +3<br />
 Exec app.exe<br />
 Quit<br />
<br />
<br />
For the case where you want to message the user that they are not an admin, use Quit immediately after your MessageBox.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">7th March 2006, 20:44</div></div><div class="posttext">Using Quit would kill the installer, without cleaning up anything in $PLUGINSDIR.  The best choice here would be Return.<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dienjd</div><div class="date">7th March 2006, 21:02</div></div><div class="posttext">Ah, thanks for the clarification. I learn new things even when giving faulty advice to others!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th March 2006, 22:02</div></div><div class="posttext">dandaman32, that's not true. The $PLUGINSDIR clean-up has nothing to do with Quit. It's always done. There may a problem deleting InstallOptions.dll, if it's still in use, but it will be removed after reboot.<br />
<br />
coco_vc, please use [ code ] or attach your scripts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">8th March 2006, 02:17</div></div><div class="posttext">dandaman32, that's not true. The $PLUGINSDIR clean-up has nothing to do with Quit. It's always done. There may a problem deleting InstallOptions.dll, if it's still in use, but it will be removed after reboot.<br />
<br />
Interesting.  According to the docs, Quit closes the installer almost immediately.  In the ExperienceUI I call .onGUIend (which cleans stuff up from $PLUGINSDIR) and then use Quit.<br />
<br />
Anyway Return would have just jumped to the next page, now that I think about it.  If you're using the ExperienceUI you could use StrCpy $XPUI_ABORTED 1<br />
Return to trigger the Abort page if that's enabled.<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">coco_vc</div><div class="date">8th March 2006, 12:59</div></div><div class="posttext">kichik, I will [ code ] next time. Sorry, wasn't aware of this.<br />
<br />
The Quit did the trick. Thx.<br />
So it's ok that I did all of these in the un.ValidateSelection?<br />
<br />
Thx,<br />
Viv</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>