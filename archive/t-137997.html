<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Could not find symbol... (Creating a .DLL Plug-In), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Could not find symbol... (Creating a .DLL Plug-In) NSIS Discussion" />
	
	<title> Could not find symbol... (Creating a .DLL Plug-In) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Could not find symbol... (Creating a .DLL Plug-In)</div>
<hr />
<div class="pda"><a href="t-137997.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=137997">Could not find symbol... (Creating a .DLL Plug-In)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DITMan</div><div class="date">5th June 2003, 20:39</div></div><div class="posttext">Hi, reading some posts in the forum, and with the answers I got in the other thread I started, I'm still wondering how to close MSN Messenger... well, I've found this piece of code, and I'm TRYING to turn it into a NSIS .DLL Plug-In, but whenever I try to load it, I get this messages:<br />
<br />
Output folder: C:\DOCUME~1\DITMan\CONFIG~1\Temp<br />
Extract: C:\DOCUME~1\DITMan\CONFIG~1\Temp\nst624.tmp<br />
Could not find symbol: KillProc<br />
Completed<br />
<br />
I'll attach the source code for the .DLL, and my .NSI (I know, everything is UGLY, but it should work)<br />
<br />
BTW, I think I'm exporting the KillProc function right, but I have NO idea in windows programming, so every feedback will be VERY VERY appreciated, and I think this plug-in is quite useful for NSIS :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th June 2003, 20:54</div></div><div class="posttext">The problem is that your DLL is written in C++ but the export must be C style. Take a look at the InstallOptions code (written in C++ too) and you'll see that every exported function declaration starts with extern &quot;C&quot;.<br />
<br />
Looking at your DLLs code I see that it tries to terminate the messenger process. This is not a good idea. Terminating a process must be the last resort and only when the process is frozen or misbehaving. It would be better to only find out if the process is running and cancel the installation.<br />
<br />
It's also not a good idea to kill a process by name because you can't be sure the user haven't changed the name of the EXE file or maybe even ran another process with the same name that has nothing to do with your installation.<br />
<br />
BTW, If you're using NSIS 2 it would be simpler to put your compiled DLL in the plugins directory and call it using DLLName::Function</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th June 2003, 20:56</div></div><div class="posttext">Oh, and WM_DESTROY means nothing in the script, it's just a text. When converting to a number NSIS will think it's 0. You shuold use ${WM_DESTROY}, it's a define. You should also include WinMessages.nsh that defines this, or else, again, it will be treated as 0.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DITMan</div><div class="date">6th June 2003, 16:37</div></div><div class="posttext">Thanks... i need to terminate the process because many people I distributed the .DLL as a separate installer didn't know how to fully close MSN Messenger, and my previous install method (a simple .ZIP Self Extractor) didn't do its job. I send the raw DLL to those people who know what are they doing (and who can rename programs, etc...) but for my John Users ;P I need to kill the process :)<br />
<br />
Thanks a lot, I'll have a look at that code :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DITMan</div><div class="date">6th June 2003, 16:41</div></div><div class="posttext">OMG! I just had to add extern &quot;C&quot; to the function I was exporting... I thought it would be more difficult :P<br />
<br />
Now I'll investigate how to get a string out from the stack :P<br />
<br />
popstring(string_where_i_want_to_keep_the_parameter) will do ???:P</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DITMan</div><div class="date">6th June 2003, 17:06</div></div><div class="posttext">Okey... I think my DLL works but when scripting, if I use the 'summarized' form for calling the function in the DLL, I get a compilation error :(<br />
<br />
Invalid command: KillProcDLL::KillProc<br />
Error in script &quot;C:\Archivos de programa\NSIS\Examples\kaka.nsi&quot; on line 23 -- aborting creation process<br />
<br />
I've also tried using KillProcDLL.dll::KillProc :(<br />
<br />
I'm using NSIS 2.0b3 (I think so :P)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DITMan</div><div class="date">6th June 2003, 17:10</div></div><div class="posttext">Okaaaay solved too... :P I should try more things before posting... My dll works now like a charm and does what it is expected to do :D<br />
<br />
How would you all DLL programmers return values from the DLL? with pushstring or storing it in another variable?? It's to keep the current DLL Plug-In style :)   thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th June 2003, 18:27</div></div><div class="posttext">When you're dll is done, make sure to put it on the archive!!!<br />
A nice thing to add would be a...<br />
<br />
KillProcDLL::KillProc &quot;App Name&quot;<br />
<br />
Where App Name could be some common Windows programs, which you would list in the readme.<br />
<br />
<br />
Good work!<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DITMan</div><div class="date">6th June 2003, 19:36</div></div><div class="posttext">Okay, that's easy... but it's quite easy by now... you can erase any process by its name, like msnmsgr.exe or notepad.exe...<br />
<br />
It's almost done, it returns the error code in $R0, so push it before calling this function...<br />
<br />
It needs some more testing, but it's close to 'final release' :P, i've got tu put up the documentation and give credits to the real author (and remove the pre-generated comments by VC++ :P)<br />
<br />
C ya!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th June 2003, 11:07</div></div><div class="posttext">I'd choose reboot over termination every time possible. As stated in the MSDN documentation for TerminateProcess:<br />
<br />
The TerminateProcess function is used to unconditionally cause a process to exit. Use it only in extreme circumstances. The state of global data maintained by dynamic-link libraries (DLLs) may be compromised if TerminateProcess is used rather than ExitProcess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th June 2003, 18:51</div></div><div class="posttext">Originally posted by DITMan <br />
How would you all DLL programmers return values from the DLL? with pushstring or storing it in another variable?? It's to keep the current DLL Plug-In style :)   thanks.  <br />
<br />
The convention is to push the return value on the stack.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>