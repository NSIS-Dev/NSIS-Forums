<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to detect Windows 8 ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to detect Windows 8 ? NSIS Discussion" />
	
	<title> How to detect Windows 8 ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to detect Windows 8 ?</div>
<hr />
<div class="pda"><a href="t-365416.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=365416">How to detect Windows 8 ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">alex0001</div><div class="date">4th July 2013, 15:56</div></div><div class="posttext">Hello,<br />
can somebody please tell me how can i detect if a NSIS 2.46 setup file is running under Windows 8 ?<br />
<br />
I have made a context menu dll for the windows explorer and want to install the Visual C++ 2012 redistributable packages only if Windows 8 is installed.<br />
<br />
I know the rest,i simply do not know how to detect the version of Windows.<br />
<br />
Thank you !</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">4th July 2013, 18:50</div></div><div class="posttext">Use WinVer.nsh. The documentation and usage examples are included in the header. But the one that comes with v2.46 doesn't support Win 8 so replace it with the updated version linked here (Ansi; tell me if you need the version for Unicode NSIS):<br />
http://forums.winamp.com/showpost.php?p=2874737&amp;postcount=71</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jmichae3</div><div class="date">6th July 2013, 00:03</div></div><div class="posttext">the windows version should be 6.3 for 8.1 and 6.2 for 8 I think, and 6.1 for 7.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">th_mi</div><div class="date">7th July 2013, 16:29</div></div><div class="posttext">the windows version should be 6.3 for 8.1 and 6.2 for 8 I think, and 6.1 for 7.<br />
That is correct, but NSIS will not detect Windows 8.1 as version 6.3. The problem is a missing compatibility manifest in the executable.<br />
<br />
See here:<br />
http://msdn.microsoft.com/en-us/library/windows/desktop/dn302074.aspx<br />
<br />
Without this manifest GetVersion(Ex) will return version 6.2.2900 and not 6.3.9431 that is the version for the current public preview version.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">7th July 2013, 19:02</div></div><div class="posttext">I already compile my scripts with code that adds Win 8 compatibility to the manifest. With 8.1 added, it's:<br />
!define ExecutionLevel requireAdministrator # ...|asInvoker|highestAvailable<br />
!tempfile CustomManifest<br />
!appendfile &quot;${CustomManifest}&quot; '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&lt;assembly xmlns=&quot;urn:schemas-microsoft-com:asm.v1&quot; manifestVersion=&quot;1.0&quot;&gt;&lt;assemblyIdentity version=&quot;1.0.0.0&quot; processorArchitecture=&quot;X86&quot; name=&quot;Nullsoft.NSIS.exehead&quot; type=&quot;win32&quot;/&gt;&lt;description&gt;Nullsoft Install System ${NSIS_VERSION}&lt;/description&gt;&lt;dependency&gt;&lt;dependentAssembly&gt;&lt;assemblyIdentity type=&quot;win32&quot; name=&quot;Microsoft.Windows.Common-Controls&quot; version=&quot;6.0.0.0&quot; processorArchitecture=&quot;X86&quot; publicKeyToken=&quot;6595b64144ccf1df&quot; language=&quot;*&quot; /&gt;&lt;/dependentAssembly&gt;&lt;/dependency&gt;&lt;trustInfo xmlns=&quot;urn:schemas-microsoft-com:asm.v3&quot;&gt;&lt;security&gt;&lt;requestedPrivileges&gt;&lt;requestedExecutionLevel level=&quot;${ExecutionLevel}&quot; uiAccess=&quot;false&quot;/&gt;&lt;/requestedPrivileges&gt;&lt;/security&gt;&lt;/trustInfo&gt;&lt;compatibility xmlns=&quot;urn:schemas-microsoft-com:compatibility.v1&quot;&gt;&lt;application&gt;&lt;supportedOS Id=&quot;{1f676c76-80e1-4239-95bb-83d0f6d0da78}&quot;/&gt;&lt;supportedOS Id=&quot;{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}&quot;/&gt;&lt;supportedOS Id=&quot;{35138b9a-5d96-4fbd-8e2d-a2440225f93a}&quot;/&gt;&lt;supportedOS Id=&quot;{e2011457-1546-43c5-a5fe-008deee3d3f0}&quot;/&gt;&lt;/application&gt;&lt;/compatibility&gt;&lt;/assembly&gt;'<br />
!packhdr &quot;$%TEMP%\exehead.tmp&quot; '&quot;%ProgramFiles%\Resource Hacker\ResHacker.exe&quot; -addoverwrite &quot;%TEMP%\exehead.tmp&quot;, &quot;%TEMP%\exehead.tmp&quot;, &quot;${CustomManifest}&quot;, 24,1,1033'<br />
I also updated WinVer.nsh. Now if only someone would actually test this. :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th July 2013, 04:34</div></div><div class="posttext">You can add whatever GUID you want to the manifest in the alpha and the next alpha version has &quot;real&quot; support</div></div><hr />


<div class="post"><div class="posttop"><div class="username">th_mi</div><div class="date">8th July 2013, 06:34</div></div><div class="posttext">I already compile my scripts with code that adds Win 8 compatibility to the manifest. With 8.1 added, it's:<br />
...<br />
I also updated WinVer.nsh. Now if only someone would actually test this. :D<br />
Nice idea, I never notices this possibility on manipulating the contained ressources this way. Thanks for sharing this :up: I'll check the attached scripts today on a 8.1 preview system... :)<br />
You can add whatever GUID you want to the manifest in the alpha and the next alpha version has &quot;real&quot; support<br />
At all good to see this will be done in NSIS 3. But for productive setups it is not recommended using Alpha versions. Therefore I'm still @2.46.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">th_mi</div><div class="date">8th July 2013, 17:41</div></div><div class="posttext">I'll check the attached scripts today on a 8.1 preview system... :)<br />
For me it works :) Thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">8th July 2013, 18:20</div></div><div class="posttext">Lovely jubbly. Thanks for testing and for pointing out the issue in the first place.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th July 2013, 22:48</div></div><div class="posttext">At all good to see this will be done in NSIS 3. But for productive setups it is not recommended using Alpha versions. Therefore I'm still @2.46.<br />
<br />
The exehead/stubs and plugins have not changed that much, mostly a merge of the Unicode fork. Most of the changes are related to the compiler and build system...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">11th July 2013, 17:29</div></div><div class="posttext">You're seeing it from NSIS dev perspective. His is that of a person who uses NSIS to package products. Alpha/beta suffix is a scarecrow for users who take their business seriously. 3.0a may be perfectly stable but it won't really matter until it's officially released as such.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kolorowy</div><div class="date">1st August 2013, 20:36</div></div><div class="posttext">ReadRegStr $R0 HKLM &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot; CurrentVersion<br />
<br />
Seam to do the trick from me.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>