<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" GetLastError always returns 126, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  GetLastError always returns 126 NSIS Discussion" />
	
	<title> GetLastError always returns 126 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  GetLastError always returns 126</div>
<hr />
<div class="pda"><a href="t-283735.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283735">GetLastError always returns 126</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">atiquh</div><div class="date">25th December 2007, 11:23</div></div><div class="posttext">Hello,<br />
<br />
Consider following script<br />
<br />
FileWrite $0 &quot;abc&quot;<br />
IfErrors +1 +2<br />
Call CheckError<br />
Push &quot;Stop&quot;<br />
<br />
Function CheckError<br />
	<br />
System::Call &quot;Kernel32::GetLastError() i() .r1&quot;	<br />
MessageBox MB_ICONINFORMATION|MB_OK &quot;Error code: $1 &quot;<br />
	<br />
FunctionEnd<br />
<br />
The error code returned is 126. From MSDN: ERROR_MOD_NOT_FOUND 126 The specified module could not be found. Now I always get this error code as 126, what ever erroneous instruction i use in first line. Like i tried removing windows directory, 126. I gave an invalid source path in CopyFiles, 126. I am expecting different and meaningful error codes but I always get 126. What could possibly going wrong here?<br />
<br />
Basically I am trying to write a function to detect and log details of an error using GetLastError() and FormatMessage(). I will call this function on IfErrors. Im using windows XP to develop the installer.<br />
<br />
Thanks in anticipation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">25th December 2007, 11:59</div></div><div class="posttext">You can't get error codes with nsis, you can only tell if something failed. If you really need error codes, you can call the api directly with the system plugin (kernel32::WriteFile or whatever) and use the ?e option so the system plugin will put the win32 error code on top of the stack</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atiquh</div><div class="date">25th December 2007, 12:43</div></div><div class="posttext">I think I got what you are saying.<br />
<br />
the call System::Call &quot;Kernel32::GetLastError() i() .r1&quot;  will only be valid if i make a call (kernel32::WriteFile or whatever) first, but not valid after the instruction FileWrite $0 &quot;abc&quot;, correct?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th December 2007, 18:09</div></div><div class="posttext">No. That call will never be valid as the System plug-in affects the last error flag in so many ways before it even calls GetLastError(). However, the System plug-in can get the last error code for you for calls it made by itself. For that, you need to append &quot;?e&quot; to the call.System::Call kernel32::WriteFile(...)?eThe error code will wait on the stack.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">atiquh</div><div class="date">26th December 2007, 04:03</div></div><div class="posttext">Anders, Chik<br />
<br />
Thanks guys! :up: <br />
<br />
I guess I am one of those most people who always look and ask for help and point out lackings. I wish I can do some contribution soon :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>