<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" UpdateResource(), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  UpdateResource() NSIS Discussion" />
	
	<title> UpdateResource() [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  UpdateResource()</div>
<hr />
<div class="pda"><a href="t-244686.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=244686">UpdateResource()</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">prsTM</div><div class="date">26th April 2006, 19:41</div></div><div class="posttext">I want to stamp an affiliate ID into our installer without rebuilding it. I tried writing a small utility that would add a resource to the setup.exe using BeginUpdateResource(), UpdateResource(), and EndUpdateResource(), closely following the example on MSDN.<br />
<br />
Yes, I realize I'd need to set CRCCheck off.<br />
<br />
However, after my utility exited, I see my installer has been truncated from ~480K to ~40K. The utility works properly on itself, so it must be due to the format of the installer itself. <br />
<br />
Anyone know how make this work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th April 2006, 12:09</div></div><div class="posttext">Use !packhdr and then CRCCheck will work and the installer won't be truncated because there'll be nothing to truncate at that stage.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prsTM</div><div class="date">28th April 2006, 14:41</div></div><div class="posttext">I'm not sure I understand.<br />
<br />
I think I take away from your post that tweaking the resources blows up because the executable header is compressed, right?<br />
<br />
So are you saying this problem is unique to the NSIS proprietary compression, and that say, UPX won't enable the corruption?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th April 2006, 14:50</div></div><div class="posttext">No, I'm saying you should execute your executable editor using !packhdr instead of executing it after the installer is created. That's what !packhdr is for. It's for modifying the stub before anything is added to it and before the CRC is calculated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prsTM</div><div class="date">28th April 2006, 15:08</div></div><div class="posttext">Ah! Now I understand. <br />
<br />
Unfortunately, that doesn't fit my requirements. Forgive me if I wasn't clear in my original post, but what I want to do is to distribute the completed installer along with my resource tweek utility so that affiliates can stamp their own ID into it.<br />
<br />
The fallback solution is to ask them to install the NSIS compiler, and distribute nsi script and install files. Then they could build the installer with their affiliate ID as an argument. But then I wouldn't need my resource tweeker to get the ID into the installer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th April 2006, 15:12</div></div><div class="posttext">In this case you can use CResourceEditor from the NSIS source code, instead of UpdateResource(). It will not truncate the data tacked to the installer. Though the CRC check will still fail.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">prsTM</div><div class="date">28th April 2006, 15:15</div></div><div class="posttext">Cool, I didn't know that was there. Thanks very much!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>