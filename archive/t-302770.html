<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Validate DirRequest control Path., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Validate DirRequest control Path. NSIS Discussion" />
	
	<title> Validate DirRequest control Path. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Validate DirRequest control Path.</div>
<hr />
<div class="pda"><a href="t-302770.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302770">Validate DirRequest control Path.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">parag_NSIS</div><div class="date">4th February 2009, 10:07</div></div><div class="posttext">Hi,<br />
<br />
<br />
How can I validate the path entered in the DirRequest control.<br />
?<br />
I am using this control on the .ini page.<br />
<br />
Right now even if I enters some random characters inside the DirRequest control manually instead of browsing the path. It allows me to go on to the next page.<br />
<br />
How can I restrict the user to go on next page until and unless he enters the valid path.<br />
<br />
means (e.g. the path should be D:\New\One something like this.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th February 2009, 10:28</div></div><div class="posttext">Use the page's leave function to read the entered value back from the ini file and check if it is a valid path. If it is invalid, call the 'abort' command to stay in the current page (ie stop leaving the page).<br />
<br />
How to check a path for validity is is a bit tricky. For existing paths you can use IfFilExists &quot;yourpath\*.*&quot;. For a new folder you could perhaps let it try to create the folder and see if it throws an error...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">parag_NSIS</div><div class="date">4th February 2009, 10:46</div></div><div class="posttext">Hi,<br />
<br />
Thanks for the reply.<br />
<br />
How to catch the errors while creating the directory?<br />
<br />
I am using the follwing code......<br />
<br />
IfFileExists &quot;$DirectoryPath&quot; 0 CheckForDirectory<br />
strcpy $DIREXISTS &quot;already exists&quot;<br />
CheckForDirectory:<br />
Createdirectory &quot;$DirectoryPath&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th February 2009, 10:56</div></div><div class="posttext">ClearErrors<br />
Createdirectory &quot;$DirectoryPath&quot;<br />
${If} ${Errors}<br />
  ;Path is invalid, or user doesn't have access rights to create this directory, or etc etc...<br />
${Else}<br />
  ;Path is valid<br />
${EndIf}Note that this is using LogicLib (link) (http://nsis.sourceforge.net/LogicLib), which I recommend you use. If you don't want to, use the IfErrors command.<br />
<br />
See http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.3.3<br />
and http://nsis.sourceforge.net/Docs/Chapter4.html#4.9.4.9<br />
<br />
<br />
Edit: Note that it's a good idea to remove the directory immediately after this test. The user might later go back to this page and change the path, and you don't want to leave behind empty directories in that case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">4th February 2009, 10:59</div></div><div class="posttext">As you're using a .INI file, I have to presume you're using InstallOptions(2/Ex).<br />
<br />
I would highly recommend changing to nsDialogs if you can as this makes it a lot more flexible.<br />
<br />
However...<br />
<br />
For InstallOptions, give the directory control a NOTIFY flag.  Then when the page 'exits', check whether the exit call came from the directory control, check the path, and call Abort (to prevent the page from actually exiting).<br />
If the path is invalid, disable the Next button (plenty of threads on that topic)<br />
<br />
For the user entering text..<br />
As you're using InstallOptions(2), you're stuck to checking the value of the directory control when the user clicks Next - then Abort it if the path is invalid, probably pop up a message that the path they entered manually is invalid.<br />
<br />
If you were using InstallOptionsEx, then you could verify the text as the user changes it - just set up a 'ONTEXTCHANGE' flag in the NOTIFY settings for the text field (InstallOptionsEx does not have a single directory, instead relying on a combination of a text control and a button control).<br />
If the path is invalid, disable the Next button.<br />
<br />
Again, I recommend looking into nsDialogs if you can.. otherwise, give InstallOptionsEx a shot - it's very similar to InstallOptions, almost being a drop-in replacement (you do have to tweak things!), but gives you a lot more control.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">parag_NSIS</div><div class="date">4th February 2009, 13:46</div></div><div class="posttext">Hi, MSG<br />
<br />
I tried according to your code given but I used IfErrors.<br />
<br />
My code is as follows...<br />
In the $FilePath variable the path I am giving is &quot;AAAsssss&quot;<br />
<br />
Createdirectory &quot;$FilePath&quot;<br />
IfErrors 0 ValidPath<br />
MessageBox MB_OK|MB_ICONEXCLAMATION &quot;Invalid path.&quot;<br />
ValidPath:<br />
<br />
SO the error flag should set the value right?<br />
But It's not happening. Am I missing something?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th February 2009, 15:10</div></div><div class="posttext">Probably CreateDirectory created it as $INSTDIR\AAAssssss or $EXEDIR\AAAssssss or $TEMP\AAAsssss or something like that. You'll have to figure out what exactly it created.<br />
<br />
You could StrCpy $0 INSTDIR, StrCpy $INSTDIR &quot;&quot; first and afterwards StrCpy $INSTDIR $0... Though that doesn't win a beauty contest.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>