<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System Call WNetAddConnection2, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System Call WNetAddConnection2 NSIS Discussion" />
	
	<title> System Call WNetAddConnection2 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System Call WNetAddConnection2</div>
<hr />
<div class="pda"><a href="t-210361.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=210361">System Call WNetAddConnection2</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">papavero64</div><div class="date">14th March 2005, 09:32</div></div><div class="posttext">Hi,<br />
i need to call the function WNetAddConnection2 in my installation program.<br />
this is my code:<br />
<br />
!define RESOURCETYPE_DISK                  0x00000001<br />
!define RESOURCEDISPLAYTYPE_SHARE          0x00000003<br />
!define CONNECT_UPDATE_PROFILE             0x00000001<br />
<br />
StrCpy $R5 &quot;\\\\PARIS-2000--JB\\Temp1&quot;<br />
StrCpy $R6 &quot;Z:&quot;<br />
System::Call &quot;*(i, i, i, i, t, t, t, t)i.s&quot; ;struct NETRESOURCE<br />
Pop $8<br />
System::Call &quot;*$8(n, i ${RESOURCETYPE_DISK}, i ${RESOURCEDISPLAYTYPE_SHARE}, n, t R6, t R5, n, n)&quot;<br />
System::Call &quot;kernel32::WNetAddConnection2(i r8, n, n,i ${CONNECT_UPDATE_PROFILE}) i .r9&quot;<br />
MessageBox MB_OK &quot;ris = [$9]&quot;<br />
<br />
When execute The MessageBox print &quot;ris = [error]&quot;.<br />
What's wrong?<br />
Thanks in advance.<br />
Paolo<br />
<br />
<br />
This is the correct &quot;c&quot; code: <br />
NETRESOURCE nr;<br />
memset (&amp;nr, 0x00, sizeof(NETRESOURCE));<br />
nr.dwType=RESOURCETYPE_DISK;<br />
strcpy(nr.lpLocalName,&quot;Z:&quot;);<br />
strcpy(nr.lpRemoteName,&quot;\\\\PARIS-2000--JB\\Temp1&quot;);<br />
nr.dwDisplayType = RESOURCEDISPLAYTYPE_SHARE; <br />
res=WNetAddConnection2(&amp;nr,NULL,NULL,CONNECT_UPDATE_PROFILE);</div></div><hr />


<div class="post"><div class="posttop"><div class="username">papavero64</div><div class="date">14th March 2005, 16:30</div></div><div class="posttext">Hi all,<br />
I changed the library &quot;kernel32&quot; with &quot;mpr.dll&quot; <br />
System::Call &quot;kernel32::WNetAddConnection2(i r8, n, n,i ${CONNECT_UPDATE_PROFILE}) i .r9&quot; <br />
and now the the MessageBox print &quot;ris = [487]&quot;.<br />
I don't know if the struct NETRESOURCE is allocated, filled<br />
correctly.<br />
<br />
many thanks<br />
Paolo</div></div><hr />


<div class="post"><div class="posttop"><div class="username">papavero64</div><div class="date">15th March 2005, 08:01</div></div><div class="posttext">Someone can help me?<br />
I need to know if the struct is used correctly.<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">15th March 2005, 12:43</div></div><div class="posttext">Use single slash in path<br />
$5=r5 in System plugin, $R6=r16<br />
Extract data from struct to check content<br />
<br />
!define NR &quot;(i,i,i,i,t,t,t,t) .i&quot;<br />
<br />
StrCpy $5 &quot;\\p401\arch&quot;<br />
StrCpy $6 &quot;x:&quot;<br />
System::Call &quot;*${NR}(0,${RESOURCETYPE_DISK},${RESOURCEDISPLAYTYPE_SHARE},0,r6,r5,n,n) .r8&quot;<br />
System::Call &quot;*$8${NR}(.r0,.r1,.r2,.r3,.r4,.r7)&quot;<br />
MessageBox MB_OK &quot;$0, $1, $2, $3, $4, $7&quot;<br />
System::Call 'mpr::WNetAddConnection2(i r8, t n, t n, i ${CONNECT_UPDATE_PROFILE}) i .r9'<br />
MessageBox MB_OK &quot;ris = [$9]&quot;<br />
System::Free $8<br />
<br />
Works on my comp ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">papavero64</div><div class="date">15th March 2005, 13:37</div></div><div class="posttext">Thank you very much !!<br />
Works very well.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>