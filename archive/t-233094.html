<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstall won't do it!, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstall won't do it! NSIS Discussion" />
	
	<title> Uninstall won't do it! [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstall won't do it!</div>
<hr />
<div class="pda"><a href="t-233094.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=233094">Uninstall won't do it!</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">badoddbob</div><div class="date">13th December 2005, 20:07</div></div><div class="posttext">...well sort of. I've tried looking through the fourm going back quite a while and have tried various things but to no avail, so hopefully someone can help me.<br />
<br />
The software I'm working on needs to install into multiple folders (legacy thing as it's old software) and has to be allowed to install on mapped drives (for Citrix types). So I've set the $INSTDIR to C:\ and added files ond folders from there. So far so good, works like a charm.<br />
<br />
But, when I come to undo all of this and uninstall, it gets rid of files, but not the folders. Here's the code:<br />
<br />
 Section &quot;Uninstall&quot;<br />
  ;## If they are set install context to 'All Users'<br />
  SetShellVarContext all<br />
  ;## remove registry keys<br />
 DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot;<br />
  SetOutPath $INSTDIR<br />
  ;## remove files.<br />
  SetOutPath &quot;$INSTDIR\CTP&quot;<br />
  Delete &quot;$INSTDIR\CTP\*.*&quot;<br />
  SetOutPath &quot;$INSTDIR\Program Files\The Exchange\Exweb&quot;<br />
  Delete &quot;$INSTDIR\Program Files\The Exchange\Exweb\*.*&quot;<br />
  ;## remove directories used.<br />
  SetOutPath &quot;$INSTDIR\CTP&quot;<br />
  RMDir /r &quot;$INSTDIR\CTP&quot;<br />
  SetOutPath &quot;$INSTDIR\Program Files\The Exchange\Exweb&quot;<br />
  RMDir /r &quot;$INSTDIR\Program Files\The Exchange\Exweb&quot;<br />
  ;## remove shortcut<br />
  Delete &quot;$DESKTOP\Launch Exweb.lnk&quot;<br />
  ;## remove files.<br />
  Delete &quot;$SMPROGRAMS\The Exchange\*.*&quot;<br />
  ;## remove program group<br />
  SetOutPath &quot;$SMPROGRAMS\The Exchange&quot;<br />
  RMDir /r &quot;$SMPROGRAMS\The Exchange&quot;<br />
SectionEnd <br />
<br />
This has got to be the 30th recompile with minor and major tweaks including a re-wriet of the Uninstall section. But each time, the files go buthe file structure and folders remain.<br />
<br />
Yours pleadingly.<br />
<br />
Rob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">scully13</div><div class="date">13th December 2005, 21:36</div></div><div class="posttext">The uninstall won't delete the current directory so try commenting out your SetOutPath lines.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">onad</div><div class="date">14th December 2005, 01:11</div></div><div class="posttext">Do a setoutpath to \ (backslash) , this is the root in the top of your script before deleting folders<br />
<br />
Then leave out all the setoutpaths. <br />
<br />
TIP:<br />
Also close via sendmessage, or forcedkill of running applications still locking a folder and preventing deletion<br />
<br />
adding the /REBOOTOK option to RMDis can come in handy.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">badoddbob</div><div class="date">14th December 2005, 08:27</div></div><div class="posttext">OK, amended my code so uit now reads:<br />
<br />
 Section &quot;Uninstall&quot;<br />
  SetOutPath &quot;$INSTDIR\&quot;<br />
  ;## If they are set install context to 'All Users'<br />
  SetShellVarContext all<br />
  ;## remove registry keys<br />
  DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot;<br />
  ;## remove files.<br />
  Delete &quot;$INSTDIR\CTP\*.*&quot;<br />
  Delete &quot;$INSTDIR\Program Files\The Exchange\Exweb\*.*&quot;<br />
  Delete &quot;$SMPROGRAMS\The Exchange\*.*&quot;<br />
  ;## remove shortcut<br />
  Delete &quot;$DESKTOP\Launch Exweb.lnk&quot;<br />
  ;## remove directories used.<br />
  RMDir /r &quot;$INSTDIR\CTP&quot;<br />
  RMDir /r &quot;$INSTDIR\Program Files\The Exchange\Exweb&quot;<br />
  ;## remove program group<br />
  RMDir /r &quot;$SMPROGRAMS\The Exchange&quot;<br />
SectionEnd <br />
<br />
But it still does not work. It removes the desktop shortcut, but still the folders remain.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">badoddbob</div><div class="date">14th December 2005, 12:31</div></div><div class="posttext">I think I may have done something n eh code before which has made it break. Can anyone have a quick look and help out?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th December 2005, 14:00</div></div><div class="posttext">You missunderstood onad.<br />
SetOutPath &quot;$INSTDIR\&quot; is the same as <br />
SetOutPath &quot;$INSTDIR&quot;<br />
This is setting the working directory to $INSTDIR which is why you cannot delete it (because it is locked).<br />
<br />
As onad has already mentioned, use:<br />
SetOutPath &quot;\&quot;<br />
Or<br />
SetOutPath &quot;$TEMP&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">badoddbob</div><div class="date">14th December 2005, 15:32</div></div><div class="posttext">Onad and Afrow UK, thanks for the help. <br />
<br />
Nearly there now. Still maintains some of the file structure which I can live with for now. <br />
<br />
Rob</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>