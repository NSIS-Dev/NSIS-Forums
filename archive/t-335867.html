<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Skip deleting Modified/Added files and folders duirng Uninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Skip deleting Modified/Added files and folders duirng Uninstall NSIS Discussion" />
	
	<title> Skip deleting Modified/Added files and folders duirng Uninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Skip deleting Modified/Added files and folders duirng Uninstall</div>
<hr />
<div class="pda"><a href="t-335867.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335867">Skip deleting Modified/Added files and folders duirng Uninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">balu.g12</div><div class="date">12th October 2011, 08:50</div></div><div class="posttext">Hi,<br />
<br />
Presently i am deleting the Installed files/folders in uninstall section by using RMDIR /r $INSTDIR<br />
<br />
<br />
But user may modify some installed files or he may add some directoires/files anywhere under $INSTDIR after installation.<br />
<br />
I wanted to know,<br />
During uninstallation, if there is any way to skip the deletion of some folder and its contents, if that folder has a modified files in it..<br />
<br />
Can some body suggest me the solution with small example please?<br />
<br />
Appreciate your help!<br />
<br />
Regards,<br />
Balaji.G</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">12th October 2011, 12:05</div></div><div class="posttext">You should never rmdir /r $instdir, exactly because of the reason you mention: The user might have added files of his/her own.  (Also, the $INSTDIR variable in the uninstaller only contains the directory where uninstall.exe is stored. So if the user moves uninstall.exe, you'll end up deleting files not belonging to your app at all!)<br />
<br />
The solution is however not to 'exclude' some files. The solution is to include only those files that you KNOW you want to delete. To do this, you must simply add a delete command for every single file that you install.<br />
<br />
If you think that's ugly, keep in mind that the user will never see the code to begin with. They will however notice what you end up deleting from their system. And deleting the entire Program Files folder just because the user installed there instead of in a subdir, now THAT is ugly.<br />
<br />
<br />
(Note: to circumvent the problem with $instdir in the uninstaller, you need to verify that the folder is the correct one: Load the install path from registry, and/or check for some marker files specific to your application.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">balu.g12</div><div class="date">12th October 2011, 13:21</div></div><div class="posttext">Hi, <br />
Just before posting my question, i read about consequences of using rmdir /r $instdir and i have planned to load the install path from registry instead of using rmdir /r $instdir.<br />
Thanks for the suggestion.<br />
<br />
##simply add a delete command for every single file that you install##<br />
some of the problems, why i have left this idea is :<br />
1) I have Thousands of files which i i will copy during installation.<br />
2) I don't have any/proper idea on how to checkfor/getthelist of  modified/New files.<br />
<br />
{{My thinking is as follows:<br />
while copying the files(File /r dir\*.*) during installation -  redirect the each filename with path and time stamp to a file_timestamp.log file<br />
while uninstallation - from the file_timestamp.log read every filename and verify if the time stamp is matching or not.<br />
If the file timestamp is changed donot delete the parent folder and its contents.<br />
Else Delete the file and empty directories.<br />
<br />
?? but i am not sure how to get the file timestamp of a file and verify it??<br />
}}<br />
<br />
I am new to NSIS, Can you please suggest me how to proceed on this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">12th October 2011, 14:16</div></div><div class="posttext">To do that, you'll need to create an exe/vbs/bat file that creates a filelist at compiletime, and saves it as NSIS code such as &quot;File dir\subdir\file1.ext&quot;, with the appropriate SetOutPath commands for the subdirs. Then !include that nsh code so that that the compiler can add them to the installer exe. You can create a textfile with timestamps at the same time, and parse that in the uninstaller (use File &quot;dir\timestamps.txt&quot; in the uninstaller section, and then some parsing functions from for example wordfunc.nsh). Tricky, but possible.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>