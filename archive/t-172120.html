<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Structure definition, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Structure definition NSIS Discussion" />
	
	<title> Structure definition [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Structure definition</div>
<hr />
<div class="pda"><a href="t-172120.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172120">Structure definition</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mantty</div><div class="date">5th March 2004, 09:25</div></div><div class="posttext">Hi all!<br />
<br />
I want to make change of a description of a service. And to do this i must call:<br />
<br />
C++ code<br />
	SERVICE_DESCRIPTION sd;<br />
	sd.lpDescription = (char*)SvcDescription.c_str();<br />
     ChangeServiceConfig2( hService, SERVICE_CONFIG_DESCRIPTION, &amp;sd)<br />
<br />
NSIS:<br />
System::Call 'advapi32::ChangeServiceConfig2( hService, SERVICE_CONFIG_DESCRIPTION, &amp;sd)'<br />
<br />
The problem that i have is how do i declare in NSIS sd structure?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th March 2004, 11:36</div></div><div class="posttext">See http://nsis.sourceforge.net/index.php?id=19&amp;backPID=15&amp;tx_faq_faq=35<br />
<br />
One of the links on this page is for the Service Library which uses System and some structures.<br />
<br />
Other System.dll structure examples can be found in Contrib\System.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KirillKr</div><div class="date">5th March 2004, 12:37</div></div><div class="posttext">When I can download nopey now?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th March 2004, 12:42</div></div><div class="posttext">Contact the author. If you can get a copy, I or another archive admin will upload it so it won't get lost again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KirillKr</div><div class="date">5th March 2004, 13:08</div></div><div class="posttext">Who is author?<br />
<br />
Nopey - system setting tool   |  |  |   <br />
<br />
--------------------------------------------------------------------------------<br />
Written by doberlec 2003-03-21 07:37:41  Last updated by joost 2003-10-08 13:03:52</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th March 2004, 13:13</div></div><div class="posttext">doberlec. I think he also has a forum user so you can use that to PM or e-mail.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">evilO</div><div class="date">5th March 2004, 13:17</div></div><div class="posttext">Hi :) !<br />
<br />
I've got what you're looking for, altough I'm not the author... <br />
<br />
I downloaded it a couple of months ago, and it is still on my HD.. :D <br />
<br />
evilO/Olive</div></div><hr />


<div class="post"><div class="posttop"><div class="username">KirillKr</div><div class="date">5th March 2004, 13:21</div></div><div class="posttext">evilO, thank you very much.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mantty</div><div class="date">5th March 2004, 13:26</div></div><div class="posttext">Thanks guys for information.<br />
I tried to make my own job, but i have some difficulties. Can some of you tell me what i did wrong?<br />
<br />
this is what i have to do from c++:<br />
<br />
typedef struct _SERVICE_DESCRIPTION {<br />
  LPTSTR    lpDescription;<br />
} SERVICE_DESCRIPTION, *LPSERVICE_DESCRIPTION;<br />
<br />
BOOL ChangeServiceConfig2(<br />
  SC_HANDLE hService,  // handle to service<br />
  DWORD dwInfoLevel,   // information level<br />
  LPVOID lpInfo        // new data<br />
);<br />
<br />
and i did this in script:<br />
<br />
   !define SERVICE_ALL_ACCESS 0xF01FF<br />
   !define SC_MANAGER_ALL_ACCESS 0x3F<br />
   !define stSERVICE_DESCRIPTION &quot;(t)i&quot;<br />
    System::Call 'advapi32::OpenSCManagerA(n, n, i ${SC_MANAGER_ALL_ACCESS}) i'<br />
    IntCmp $1 0 lbl_done<br />
    StrCpy $2 &quot;0x10&quot;<br />
    StrCpy $3 &quot;0x3&quot;<br />
    StrCpy $4 $ServiceName<br />
    StrCpy $5 $ProjectName<br />
    StrCpy $6 $MyPath<br />
    System::Call `advapi32::CreateServiceA(i r1, t r4, t r5, i ${SERVICE_ALL_ACCESS}, i r2, i r3, i 0, t r6, n, n, n, n, n) i.r7`<br />
    StrCmp $7 0 lbl_done lbl_good<br />
    lbl_good:<br />
             System::Call '${stSERVICE_DESCRIPTION}(&quot;My Description&quot;) .r8'<br />
             System::Call 'advapi32::ChangeServiceConfig2( i r7, i 1, i r8) i.r9'<br />
             StrCmp $9 0 0 +1<br />
    lbl_done:<br />
             System::Call 'advapi32::CloseServiceHandle(i r1) n'<br />
<br />
The service it is installing ok, but the description it is not working.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th March 2004, 13:33</div></div><div class="posttext">See this recent thread:<br />
<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=171553<br />
<br />
You have the exact same problem in your code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mantty</div><div class="date">5th March 2004, 14:23</div></div><div class="posttext">kichik, <br />
<br />
thank you very much for the info. I saw that post but i still don't get it working. Can you help me with the right code :-( ... thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">6th March 2004, 01:50</div></div><div class="posttext">Try this (NOT TESTED), probably at least it will be closer to work correctly:<br />
<br />
!define SERVICE_ALL_ACCESS 0xF01FF<br />
!define SC_MANAGER_ALL_ACCESS 0x3F<br />
!define SERVICE_CONFIG_DESCRIPTION 1<br />
!define stSERVICE_DESCRIPTION &quot;(i)i&quot;<br />
<br />
System::Call 'advapi32::OpenSCManagerA(n, n, \\<br />
i ${SC_MANAGER_ALL_ACCESS}) i'<br />
<br />
IntCmp $1 0 lbl_done<br />
StrCpy $2 &quot;0x10&quot;<br />
StrCpy $3 &quot;0x3&quot;<br />
StrCpy $4 $ServiceName<br />
StrCpy $5 $ProjectName<br />
StrCpy $6 $MyPath<br />
<br />
System::Call `advapi32::CreateServiceA(i r1, t r4, t r5, \\<br />
i ${SERVICE_ALL_ACCESS}, i r2, i r3, i 0, t r6, n, n, n, \\<br />
n, n) i.r7`<br />
<br />
StrCmp $7 &quot;&quot; 0 lbl_good<br />
  SetErrors<br />
  Goto lbl_end<br />
<br />
lbl_good:<br />
System::Call '*${stSERVICE_DESCRIPTION} .r8'<br />
System::Call 'advapi32::ChangeServiceConfig2(i r7, \\<br />
i ${SERVICE_CONFIG_DESCRIPTION}, i r8) i.r9'<br />
StrCmp $9 0 0 +2<br />
  SetErrors<br />
<br />
lbl_done:<br />
System::Call 'advapi32::CloseServiceHandle(i r1) n'<br />
<br />
lbl_end:<br />
It will set errors if the description wasn't put correctly or if it didn't found the service handle.<br />
<br />
(I read all about these APIs, I think it's really gonna work now)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th March 2004, 10:40</div></div><div class="posttext">Uploaded noepy.zip to archive:<br />
<br />
http://nsis.sourceforge.net/archive/download.php?file=nopey.zip</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mantty</div><div class="date">8th March 2004, 09:25</div></div><div class="posttext">thanks deguix for the code. I works almost perfect, but i still don't know how to set the value for the description in structure:<br />
<br />
!define stSERVICE_DESCRIPTION &quot;(i)i&quot;<br />
System::Call '*${stSERVICE_DESCRIPTION} .r8'<br />
<br />
I want to have somethig like &quot;My descripton there&quot;<br />
<br />
Thnaks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">8th March 2004, 10:06</div></div><div class="posttext">Try this:<br />
<br />
!define DESCRIPTION &quot;My Description&quot;<br />
<br />
!define SERVICE_ALL_ACCESS 0xF01FF <br />
!define SC_MANAGER_ALL_ACCESS 0x3F <br />
!define SERVICE_CONFIG_DESCRIPTION 1 <br />
!define stSERVICE_DESCRIPTION &quot;(t)i&quot; <br />
<br />
System::Call 'advapi32::OpenSCManagerA(n, n, \\<br />
i ${SC_MANAGER_ALL_ACCESS}) i' <br />
<br />
IntCmp $1 0 lbl_done <br />
StrCpy $2 &quot;0x10&quot; <br />
StrCpy $3 &quot;0x3&quot; <br />
StrCpy $4 $ServiceName <br />
StrCpy $5 $ProjectName <br />
StrCpy $6 $MyPath <br />
<br />
System::Call `advapi32::CreateServiceA(i r1, t r4, t r5, \\ <br />
i ${SERVICE_ALL_ACCESS}, i r2, i r3, i 0, t r6, n, n, n, \\ <br />
n, n) i.r7` <br />
<br />
StrCmp $7 &quot;&quot; 0 lbl_good <br />
  SetErrors <br />
  Goto lbl_end <br />
<br />
lbl_good: <br />
System::Call '*${stSERVICE_DESCRIPTION}(&quot;${DESCRIPTION}&quot;) .r8' <br />
System::Call 'advapi32::ChangeServiceConfig2(i r7, \\ <br />
i ${SERVICE_CONFIG_DESCRIPTION}, i r8) i.r9' <br />
StrCmp $9 0 0 +2 <br />
  SetErrors <br />
<br />
lbl_done: <br />
System::Call 'advapi32::CloseServiceHandle(i r1) n' <br />
<br />
lbl_end:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mantty</div><div class="date">8th March 2004, 10:49</div></div><div class="posttext">thank you very, very much deguix.<br />
<br />
evrything is working perfert!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>