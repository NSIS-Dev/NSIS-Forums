<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Joining 2 different examples to 1 script, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Joining 2 different examples to 1 script NSIS Discussion" />
	
	<title> Joining 2 different examples to 1 script [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Joining 2 different examples to 1 script</div>
<hr />
<div class="pda"><a href="t-212987.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=212987">Joining 2 different examples to 1 script</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">12th April 2005, 15:17</div></div><div class="posttext">Hi all, <br />
<br />
After a lot of searching through this forum, and trying out different examples, I finally started developping the Installer I need.<br />
<br />
I have 3 DVD's, containing Technical Data, that has to be installed on our engineers laptop. To do this, I used the CopyFiles command.<br />
<br />
This works fine, but when swapping from Disc 1 to Disc 2, I get the error Wrong Volume (bla bla bla)....<br />
To solve this, I found a script in these forums. This script works fine, but doesn't have the MUI I like.<br />
<br />
Can anyone help me to join these two scripts into one working script that suits my needs? <br />
All help is appreciated... <br />
<br />
PS.: I'll attach the two scripts, to get some background information. Setup2.nsi contains the MUI, test.nsi contains &quot;the swapping script&quot;.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">12th April 2005, 15:18</div></div><div class="posttext">Number 2</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">12th April 2005, 15:50</div></div><div class="posttext">You need to copy (and modify) the whole .onInit Function from test.nsi to your script.<br />
Then copy the GetNextParm Function too.<br />
<br />
That should be enough to make it work.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">12th April 2005, 15:54</div></div><div class="posttext">Okay, <br />
<br />
Thanks for the help!<br />
<br />
Does it matter where I place the functions?<br />
I mean, do I have to put it in the beginning, or can I just add it at the end of the script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">14th April 2005, 12:32</div></div><div class="posttext">Hi all, <br />
<br />
I've modified the setup.nsi file as described above, and my installer still doesn't work.<br />
What am I doing wrong? In fact, the installer starts at the first disc, works fine, and then pops a message box that ask me to insert disc two. After doing this (and clicking OK), the message box keeps returning and the script hangs. :mad: <br />
<br />
I can't seem to figure out what I'm doing wrong... :confused: <br />
<br />
Heeeelp please... :cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">14th April 2005, 13:28</div></div><div class="posttext">In addition, I can attach a printscreen of the error I get.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th April 2005, 15:18</div></div><div class="posttext">It loops because of this:<br />
<br />
<br />
promptCD:<br />
MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION &quot;Please insert Disc 2.&quot;<br />
<br />
IfFileExists &quot;$EXEDIR\DATA\SECT_RIC\RICOH_OLD\CD2.id&quot; secondCD promptCD<br />
<br />
<br />
&quot;$EXEDIR\DATA\SECT_RIC\RICOH_OLD\CD2.id&quot; obviously does not exist.<br />
What is $EXEDIR at that time (put it in your MessageBox to find out).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">14th April 2005, 15:28</div></div><div class="posttext">Obviously, it goes to the TEMP dir.<br />
<br />
And the CD2.id file is on the disc.<br />
<br />
How do I direct the script to my CD-ROM drive?<br />
Is there a special variable for this? <br />
I don't want to specify the drive letter in the script, as this may vary from user to user.<br />
<br />
Attached: Printscreen $EXEDIR in MB</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th April 2005, 16:03</div></div><div class="posttext">In .onInit, you can get the CD-Rom drive letter from $EXEDIR like so:<br />
StrCpy $CDDRIVE $EXEDIR 2<br />
; $CDDRIVE will be e.g. E:<br />
<br />
Don't forget to declare the $CDDRIVE var with Var CDDRIVE<br />
<br />
Edit: No that won't work.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th April 2005, 16:15</div></div><div class="posttext">Updated .onInit function to fix it:<br />
<br />
<br />
Var CDDRIVE<br />
<br />
Function .oninit<br />
  IfFileExists &quot;$TEMP\tempCD.tmp&quot; fromHD<br />
<br />
   CopyFiles &quot;$EXEDIR\setup.exe&quot; &quot;$TEMP&quot;<br />
   WriteINIStr &quot;$TEMP\tempCD.tmp&quot; &quot;CD&quot; &quot;Drive&quot; &quot;$EXEDIR&quot;<br />
<br />
   Exec &quot;'$TEMP\setup.exe'&quot;<br />
   Abort<br />
<br />
  fromHD:<br />
   ReadINIStr $CDDRIVE &quot;$TEMP\tempCD.tmp&quot; &quot;CD&quot; &quot;Drive&quot;<br />
   Delete &quot;$TEMP\tempCD.tmp&quot;<br />
<br />
FunctionEnd<br />
<br />
I've used a completely different method here (much simpler).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">15th April 2005, 07:37</div></div><div class="posttext">So this replaces the whole .onInit function?<br />
<br />
Thanks Stu, you da man!!<br />
<br />
I'll try it out later on today, and comment it here in this thread.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">18th April 2005, 10:09</div></div><div class="posttext">Ok, here are my comments on the script.<br />
<br />
Everything works fine, except for one small error.<br />
<br />
After compiling the script, the .exe file is made.<br />
<br />
When executing the file, it doesn't start.<br />
<br />
When executing the same file a second time, it works.<br />
<br />
Odd...<br />
<br />
Can this be fixed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th April 2005, 13:21</div></div><div class="posttext">I'll have a look when I get home. There's probably something that I over-looked.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">18th April 2005, 19:47</div></div><div class="posttext">I found the problem was with Exec. For some reason I had two lots of quotes on there (probably from the old script when it had parameters with it).<br />
<br />
It also fails if you change the OutFile name, so I've added a define which will make things easier incase you decide to change the OutFile to something other than 'setup.exe':<br />
<br />
!define OutFile &quot;setup.exe&quot;<br />
!define TempCD  &quot;$TEMP\tempCD.tmp&quot;<br />
OutFile &quot;${OutFile}&quot;<br />
<br />
Var CDDRIVE<br />
<br />
Function .oninit<br />
  IfFileExists &quot;${TempCD}&quot; fromHD<br />
<br />
   CopyFiles &quot;$EXEDIR\${OutFile}&quot; &quot;$TEMP&quot;<br />
   WriteINIStr &quot;${TempCD}&quot; &quot;CD&quot; &quot;Drive&quot; &quot;$EXEDIR&quot;<br />
<br />
   Exec &quot;$TEMP\${OutFile}&quot;<br />
   Abort<br />
<br />
  fromHD:<br />
   ReadINIStr $CDDRIVE &quot;${TempCD}&quot; &quot;CD&quot; &quot;Drive&quot;<br />
   Delete &quot;${TempCD}&quot;<br />
<br />
FunctionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">9th June 2005, 10:32</div></div><div class="posttext">Hi, <br />
<br />
It has been a long time since I've posted here.<br />
<br />
I still have an error.<br />
The setup file has to copy itself to the temp-directory, and then copy all the files from the DVD's to the Installation Directory.<br />
<br />
The part of the TEMP directory works fine, but everything that comes next, doesn't work.<br />
<br />
Can anyone help me out?<br />
<br />
Please?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">9th June 2005, 11:21</div></div><div class="posttext">Originally posted by DBE <br />
Hi, <br />
<br />
It has been a long time since I've posted here.<br />
<br />
I still have an error.<br />
The setup file has to copy itself to the temp-directory, and then copy all the files from the DVD's to the Installation Directory.<br />
<br />
The part of the TEMP directory works fine, but everything that comes next, doesn't work.<br />
<br />
Can anyone help me out?<br />
<br />
Please?  <br />
<br />
OK, I restarted my test, and found out that the copying to the temp-directory works fine, and the removing of the old data works like a charm.<br />
The Copy Process fails at the first disc. That's where the problems start.<br />
I also discovered that it isn't possible to select the root of the partition (for example D:\). The install button is grayed out when I select this.<br />
<br />
Is there a fix for these problems?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">9th June 2005, 11:29</div></div><div class="posttext">Originally posted by DBE <br />
OK, I restarted my test, and found out that the copying to the temp-directory works fine, and the removing of the old data works like a charm.<br />
The Copy Process fails at the first disc. That's where the problems start.<br />
I also discovered that it isn't possible to select the root of the partition (for example D:\). The install button is grayed out when I select this.<br />
<br />
Is there a fix for these problems?  <br />
<br />
My guess is that the script can't find the DATA on the DVD.<br />
Is the $EXEDIR in this script the DVD or the Temp-directory?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th June 2005, 12:12</div></div><div class="posttext">You need to use $CDDRIVE rather than $EXEDIR. $EXEDIR will indeed be the same as $TEMP (as that is where the installer exe is residing).<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">9th June 2005, 14:31</div></div><div class="posttext">Originally posted by Afrow UK <br />
You need to use $CDDRIVE rather than $EXEDIR. $EXEDIR will indeed be the same as $TEMP (as that is where the installer exe is residing).<br />
<br />
-Stu  <br />
<br />
Thanks Stu, that's the solution...<br />
<br />
If you have a solution for the other problem, please share :-)<br />
<br />
I mean this problem<br />
<br />
&quot;I also discovered that it isn't possible to select the root of the partition (for example D:\). The install button is grayed out when I select this.&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">9th June 2005, 19:34</div></div><div class="posttext">Try using AllowRootDirInstall</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DBE</div><div class="date">10th June 2005, 07:35</div></div><div class="posttext">Thanks guys, <br />
<br />
You've solved my problems!<br />
<br />
I really love this community... :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>