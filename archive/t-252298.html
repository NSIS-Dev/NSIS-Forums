<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Create Registry Value, but only if it doesn't exist, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Create Registry Value, but only if it doesn't exist NSIS Discussion" />
	
	<title> Create Registry Value, but only if it doesn't exist [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Create Registry Value, but only if it doesn't exist</div>
<hr />
<div class="pda"><a href="t-252298.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=252298">Create Registry Value, but only if it doesn't exist</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">grzech</div><div class="date">31st July 2006, 00:29</div></div><div class="posttext">I want to write a DWORD into Windows Registry, but only if such value doesn't exist already. Unfortunately WriteRegDWORD will overwrite existing value if it exists. <br />
<br />
How can I do this?<br />
<br />
TIA</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">31st July 2006, 04:07</div></div><div class="posttext">Try ReadRegDWORD  <br />
From the docs:<br />
<br />
The error flag will be set and $x will be set to an empty string (&quot;&quot; which is 0) if the DWORD is not present.<br />
<br />
So, if the return value from ReadRegDWORD is an empty string (&quot;&quot;) and the error flag is set after reading, then you'll know the value does not exist and you can proceed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grzech</div><div class="date">31st July 2006, 13:14</div></div><div class="posttext">I have read documentation on ReadRegDWORD before, the point is I cannot find anything about &quot;error flag&quot; in the docs.<br />
How do I check if it has been set?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2006, 14:37</div></div><div class="posttext">ClearErrors first, IfErrors after.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grzech</div><div class="date">31st July 2006, 15:04</div></div><div class="posttext">Thanks.<br />
So I have made something like this:<br />
Var myvalue<br />
ClearErrors<br />
myvalue = ReadRegDword ...<br />
${If} $myvalue == 0<br />
  IfErrors 0 +3<br />
    WriteRegDWORD ...<br />
    WriteRegDWORD ...<br />
${EndiF}<br />
Is this correct?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2006, 15:07</div></div><div class="posttext">You can do ${If} ${Errors} with LogicLib too.<br />
<br />
${If} $myvalue == 0<br />
${AndIf} ${Errors}<br />
WriteRegDWORD ...<br />
WriteRegDWORD ...<br />
${EndIf}<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grzech</div><div class="date">31st July 2006, 17:12</div></div><div class="posttext">I have problem with declaring variable<br />
<br />
I got error: &quot;Invalid command: Var&quot; on line:<br />
Var myvalue<br />
<br />
?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2006, 17:15</div></div><div class="posttext">Unless /GLOBAL is specified, you must use Var outside Sections and Functions.<br />
You might as well just put Var instructions at the top of your script.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grzech</div><div class="date">31st July 2006, 17:39</div></div><div class="posttext">Ok, forget it I don't want to use any library.<br />
So back to the drawing board:<br />
<br />
ClearErrors<br />
ReadRegDword $0 ...<br />
StrCmp $0 0 0 +4  ;I would like something better here? How to compare DWORD?<br />
IfErrors 0 +3<br />
  WriteRegDWORD ...<br />
  WriteRegDWORD ...<br />
<br />
Is that Ok?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grzech</div><div class="date">31st July 2006, 19:38</div></div><div class="posttext">There shoud be:<br />
StrCmp $0 &quot;&quot; 0 +4 <br />
<br />
instead of:<br />
StrCmp $0 0 0 +4<br />
<br />
And it works now.<br />
Thanks Afrow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">31st July 2006, 23:03</div></div><div class="posttext">It might be wise to do the IfErrors check before the StrCmp, although it probably won't matter, but it's good practice.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">grzech</div><div class="date">1st August 2006, 22:38</div></div><div class="posttext">Yes, you're right. I am not very familiar yet with this NSIS syntax so my code is far from being perfect. I'll change it to:<br />
<br />
<br />
ClearErrors<br />
ReadRegDword $0 ...<br />
IfErrors 0 +4<br />
  StrCmp $0 &quot;&quot; 0 +3 <br />
    WriteRegDWORD ...<br />
    WriteRegDWORD ...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>