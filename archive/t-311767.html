<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System:Call works only on dev machine, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System:Call works only on dev machine NSIS Discussion" />
	
	<title> System:Call works only on dev machine [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System:Call works only on dev machine</div>
<hr />
<div class="pda"><a href="t-311767.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=311767">System:Call works only on dev machine</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">shlomifr</div><div class="date">8th September 2009, 08:33</div></div><div class="posttext">Hi All,<br />
<br />
I'm using System::Call to call a custom dll during the installation. It works fine on my machine, but when I try to install on another machine the dll doesn't get called.<br />
<br />
Any ideas?<br />
<br />
My code:<br />
<br />
<br />
SetPluginUnload alwaysoff<br />
SetOutPath &quot;$PLUGINSDIR&quot;<br />
File MyDll.dll <br />
; Put something in $R0<br />
System::Call &quot;MyDll::myFunction(m ${R0}) v&quot;<br />
SetPluginUnload manual<br />
 <br />
<br />
BTW<br />
<br />
The installer packs the dll, but where is it taking it from?<br />
<br />
Thanks,<br />
Shlomi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">8th September 2009, 08:51</div></div><div class="posttext">You may have to supply the path to the dll in the call, like:<br />
System::Call &quot;$PLUGINSDIR\MyDll::myFunction(m ${R0}) v&quot;<br />
<br />
As for the compiler, it takes the files from the same directory as the nsi file, unless you specify a different working directory (not even sure if that's possible, actually).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shlomifr</div><div class="date">8th September 2009, 09:05</div></div><div class="posttext">Hi MSG,<br />
<br />
Thanks for you reply. I tried:<br />
System::Call &quot;$PLUGINSDIR\MyDll::myFunction(m ${R0}) v&quot;<br />
<br />
It still doesn't work on the machine I'm testing on.<br />
<br />
Any way of debugging it or watching a log file of the installation?<br />
<br />
Thanks,<br />
Shlomi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th September 2009, 09:07</div></div><div class="posttext">You should make sure the dll can be loaded, check the dll on the _failing_ machine with http://www.dependencywalker.com<br />
<br />
As far as using a plugin goes, just stick it somewhere nsis can find it (nsis plugin dir or !addpluginsdir), then you don't need to supply a full path or even include it with File<br />
<br />
Your system syntax is also wrong unless you have a define named R0, you probably want (m R0) or (m .R0), not sure if you are using R0 as input or output</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shlomifr</div><div class="date">8th September 2009, 11:19</div></div><div class="posttext">Well, my dll depends on MSVCR90.DLL, so it might be this.<br />
<br />
How should I include it in my installation?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shlomifr</div><div class="date">8th September 2009, 11:32</div></div><div class="posttext">I tried adding the C/C++ runtime dlls (including MSVCR90.DLL), but my dll is still not called.<br />
<br />
If there is a dependency missing why don't I get any error message?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th September 2009, 11:52</div></div><div class="posttext">you have to install that stupid runtime, you can't just copy the dlls (or better yet, build your dll without linking to them (static link or don't use CRT at all))</div></div><hr />


<div class="post"><div class="posttop"><div class="username">shlomifr</div><div class="date">8th September 2009, 17:34</div></div><div class="posttext">I test the dll on the &quot;failing&quot; machine with dependecy walker.<br />
<br />
Here is the result:<br />
<br />
Error: The Side-by-Side configuration information for &quot;c:\documents and settings\markz\local settings\temp\nsud1.tmp\MYDLL.DLL&quot; contains errors. This application has failed to start because the application configuration is incorrect. Reinstalling the application may fix this problem (14001).<br />
<br />
Error: At least one required implicit or forwarded dependency was not found.<br />
<br />
I see that the missing dlls are some debug CRT dlls.<br />
This is weird because I build in Release.<br />
<br />
Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">8th September 2009, 17:57</div></div><div class="posttext">Like I said in my previous post, static link or don't use the CRT at all</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>