<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Automatically Expire software, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Automatically Expire software NSIS Discussion" />
	
	<title> Automatically Expire software [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Automatically Expire software</div>
<hr />
<div class="pda"><a href="t-226706.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=226706">Automatically Expire software</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tudza</div><div class="date">23rd September 2005, 02:38</div></div><div class="posttext">I would have thought this was the job of the software being installed, but I was asked whether NSIS supported a mechanism by which a piece of software could be disabled after a certain amount of time has passed since installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">23rd September 2005, 03:22</div></div><div class="posttext">Well, there is one thing you could try. You can create an &quot;extractor&quot; that extracts the original file to somewhere in the computer disguised as the original program. Then, you can use NSIS codes to retrieve information for the installation and expiration date, and to stop the execution of the program if it's desired. This wouldn't need any changes to the original application.<br />
<br />
The only problem with this simple method is that you need to extract it to somewhere in the users computer. I just don't know if there is a way to extract the application directly to the RAM so that there would be rarely a way of copying the extracted file and removing the expiration time. This area is quite unknown for me, though...<br />
<br />
Thus, I recommend changing the program's source for this or to use other tools. NSIS is not used for tough security, you know. NSIS is in continuous development and it is open-source.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">finx</div><div class="date">1st March 2006, 02:09</div></div><div class="posttext">Originally posted by tudza <br />
I would have thought this was the job of the software being installed, but I was asked whether NSIS supported a mechanism by which a piece of software could be disabled after a certain amount of time has passed since installation.  <br />
<br />
<br />
What I would like to have is an expiration date lock _in_ the installation program. I mean if the the date has expired, the installation program will not work anymore. It just gives a message &quot;The installation program has expired&quot;<br />
How to script this in NSIS?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">1st March 2006, 07:23</div></div><div class="posttext">Use Manual, 5.2 Predefines {__DATE__} for compillation date, E.1.6 GetTime sample for installation time, show message box if difference is bigger then your limit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">1st March 2006, 07:43</div></div><div class="posttext">I wrote a library to do this with NSIS, including an activation key system that allows for expiring keys.  If I can modify it enough to post it here without giving away the original algorithm at all I can post it here.<br />
<br />
You can do some cool stuff with this.  What I do is I code installers for people, and I protect the installer with a 30-day trial period (what you're looking for) but I also use DcryptDll to encrypt the installer's source code and package it into the installer.  When my client buys a license to use the installer commercially, I send them an activation key (which expires after a set number of days) and a decryption key, which unlocks the installer's source code.  When the activation and decryption keys have been validated, the installer decrypts/extracts the installer's source code, spawns an NSIS compiler (about 500kb packed with LZMA compression) and rebuilds an installer without the protection, encryption, or 500 extra kb of overhead.<br />
<br />
If all that sounded a little complicated, don't worry.  The secure clock library (affectionately called &quot;ClockLock&quot;) is relatively easy to implement and can allow for custom code upon validation success/failure.  It also protects against clock set-backs (an old cheat) and fraud keys.  It even confuses registry-monitoring programs like SysInternals Regmon.<br />
<br />
Again, I cannot post it here unless I drastically change it, because then my clients can steal the installer sort of.  I can privately license it to you for a negotiable price (it took me a long time to develop) and provide tech support, examples, a keygen, and several other tools or I can just post the thing here but I can't provide any considerable help for it.<br />
<br />
One major bug: Nothing works across years.  Of course this is March, so this isn't a problem for now.<br />
<br />
Here's a working example: http://www.freewebtown.com/dandaman32/clocklock/SecureNotepad.exe<br />
<br />
This example only has one big vulnerability: it extracts the program file and runs it.  User can copy it to another folder and rename it, voila no time limit.  But everything else seems to work fine.<br />
<br />
Unlock key: 635433-955166-776584-010880-182012 (expires 90 days from this post)<br />
<br />
To do some cool stuff with registration: run SecureNotepad.exe /RegInfo.<br />
<br />
I have a sample encrypted installer too, if anyone wants to see that...<br />
<br />
-dandaman32<br />
<br />
Contains windows notepad, (c) micros0ft</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">1st March 2006, 08:17</div></div><div class="posttext">OK all, here is an encrypted installer.<br />
<br />
Activation key:<br />
635448-027515-102882-028320-224000<br />
(expires 120 days from this post)<br />
<br />
Decryption key:<br />
7F12DBEA-8C6DA3D3-863AD317-9D11EB85<br />
<br />
Importable key package attached, unzip before using.<br />
<br />
Download binary: http://www.freewebtown.com/dandaman32/clocklock/EncryptedInstaller.exe<br />
<br />
BTW, do NOT use the ExperienceUI version included with this.  I realize that I am giving an unofficial beta of XPUI 1.11, but be warned: this is undocumented and I had to modify it just to get this script to compile properly.<br />
<br />
Disclaimer: while this installer does not contain any malcious code, it does contain unreleased, pre-alpha builds of certain tools, including ExperienceUI 1.11 and Component Manager 0.3.  If this shreds your system, I am not responsible for it.  Period.<br />
<br />
The source for the installer (minus the trial library) is included.  To compile, you will NEED to move the ExperienceUI language file insert (!insertmacro XPUI_LANGUAGE English) up before pages unless you use the pre-alpha version of the XPUI included with this package.  (edit: Well, sort of included.  You have to decrypt the thing first :) )<br />
<br />
-dandaman32<br />
<br />
Contains windows notepad, (c) micros0ft</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">1st March 2006, 08:35</div></div><div class="posttext">Sorry, forgot to attach...<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">finx</div><div class="date">2nd March 2006, 22:02</div></div><div class="posttext">Thanks for your hints!<br />
<br />
After reading the manual I tried to write the most simple expiration checking code there can be, I think... What I'm looking for just now is just a very simple static expiration date checking.<br />
This seem to work for me. What do you say?<br />
By the way, what's the difference between &quot;Local time&quot; (getTime option 'L') and &quot;System time&quot; (getTime option 'LS')really?<br />
<br />
<br />
SAMPLE CODE **************************<br />
<br />
;for getTime function:<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro GetTime<br />
<br />
;for StrCpy function:<br />
!include &quot;StrFunc.nsh&quot;<br />
<br />
;greate variable for installation day<br />
VAR /GLOBAL MYINSTALLDAY<br />
<br />
;greate variable for static expiration day<br />
VAR /GLOBAL MYEXPIRATIONDAY<br />
<br />
;=== get date =====================<br />
Section<br />
${GetTime} &quot;&quot; &quot;L&quot; $0 $1 $2 $3 $4 $5 $6<br />
	; $0=&quot;01&quot;      day<br />
	; $1=&quot;04&quot;      month<br />
	; $2=&quot;2006&quot;    year<br />
	; $3=&quot;Friday&quot;  day of week name<br />
	; $4=&quot;16&quot;      hour<br />
	; $5=&quot;05&quot;      minute<br />
	; $6=&quot;50&quot;      seconds<br />
<br />
;The day when user executes the installer.<br />
;It's &quot;20060401&quot; in this sample.<br />
strCpy $MYINSTALLDAY &quot;$2$1$0&quot;<br />
<br />
;my static expiration day 31th of march 2006<br />
strCpy $MYEXPIRATIONDAY &quot;20060331&quot;<br />
<br />
<br />
;expiration checking.<br />
;If the installing date is<br />
;bigger than expiration date<br />
;installer quits. Otherwise it goes on normally.<br />
<br />
${if} $MYINSTALLDAY &gt; $MYEXPIRATIONDAY<br />
MessageBox MB_OK &quot;Sorry! Installer expired. Please update the program&quot;<br />
;quit installer<br />
Abort<br />
${EndIf}<br />
<br />
SectionEnd<br />
;==================================<br />
<br />
<br />
END OF SAMPLE CODE ************************<br />
<br />
<br />
Thanks for your feedback!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">3rd March 2006, 06:07</div></div><div class="posttext">If you really want go go secure, make the program check the time on the Internet.  In NSIS:<br />
<br />
<br />
; User should be connected to the 'net at this point.<br />
; Use Dialer plugin and ConnectInternet function<br />
; (function is in Dialer docs I believe) to connect.<br />
nsisDl::download_quiet &quot;http://www.mysite.com/time.php&quot; &quot;$TEMP\timecheck.ini&quot;<br />
StrCpy $MYEXPIRATIONDAY &quot;20060331&quot;<br />
ReadINIStr $0 $TEMP\timecheck.ini &quot;Time&quot; &quot;CurrentTime&quot;<br />
Delete $TEMP\timecheck.ini<br />
IntCmp $0 $MYEXPIRATIONDAY good good bad<br />
bad:<br />
  ; Time expired<br />
  MessageBox MB_OK &quot;Expired!&quot;<br />
  Return<br />
good:<br />
; continue installer<br />
<br />
<br />
And in http://www.mysite.com/time.php:<br />
<br />
&lt;?php<br />
$date=date(&quot;omd&quot;);<br />
echo &quot;[Time]\nCurrentTime=&quot;.$date.&quot;\n&quot;;<br />
?&gt;<br />
<br />
<br />
I just realized how buggy the encrypted installer is.  It's fixed now.  http://www.freewebtown.com/dandaman32/clocklock/EncryptedInstaller.exe<br />
<br />
New decryption key: AD378091-0952C988-340E0CF3-D2BC7201<br />
Activation key (same as before): 635448-027515-102882-028320-224000<br />
<br />
Updated key import file attached (hopefully).<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">3rd March 2006, 07:10</div></div><div class="posttext">Local time includes _timezone and _daylight (summer) shifts. &quot;The /GLOBAL flag is not required (if var declared) outside of sections and functions.&quot;<br />
By default, internet connection request from new program first displays Windows Firewall window, a bit disturbing for user, so it might be better to use internet if this is really need only.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sissy</div><div class="date">3rd March 2006, 08:40</div></div><div class="posttext">this thread is quite interesting :)<br />
<br />
dandaman32 - id certainly like to see some source if you can change enough not to effect your algorithm from being exploited, thats is if your willing to share of course.<br />
<br />
Originally posted by Takhir <br />
By default, internet connection request from new program first displays Windows Firewall window, a bit disturbing for user, so it might be better to use internet if this is really need only. <br />
dont you mean local time, since the windows FW popup is going to scare the user?<br />
<br />
i can certainly see the internet one will be secure as system time fiddling will have no effect :)<br />
<br />
all in all learnt a couple of new tricks thanks to you guys.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dandaman32</div><div class="date">11th March 2006, 06:44</div></div><div class="posttext">@sissy: The library I used for that is not open source because I use it for my installer development services.  If you're interested in privately licensing it you can contact me.  <br />
<br />
I have a lot of projects going on right now, so it will be awhile before I have the time to rewrite that library.  Essentially what you would get by privately licensing it (assuming you're interested) is priority.<br />
<br />
And I see the key package still isn't attached on the last post.  Forum admins, if you're reading this, vB 3.5 is out, maybe you should upgrade...<br />
<br />
-dandaman32</div></div><hr />


<div class="post"><div class="posttop"><div class="username">karabey</div><div class="date">18th May 2006, 02:34</div></div><div class="posttext">@dandaman<br />
<br />
I have downloaded the DcryptDll Script and its looking a little bit hard for me with NCrypts (i am a beginner with NSIS). I need myself also a Protection with Serial or 30-Days Evaluation. The NOTEPAD.exe you have created is really wonderfull. Is there a way to get written Script for it?<br />
<br />
Hope to hear from you. Thx</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>