<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" LZMA Compression vs. 7zip SFX, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  LZMA Compression vs. 7zip SFX NSIS Discussion" />
	
	<title> LZMA Compression vs. 7zip SFX [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  LZMA Compression vs. 7zip SFX</div>
<hr />
<div class="pda"><a href="t-236126.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=236126">LZMA Compression vs. 7zip SFX</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">RobertStrong</div><div class="date">22nd January 2006, 05:42</div></div><div class="posttext">I have noticed that I am unable to get NSIS LZMA to compress as much as 7zip SFX. For example, with the exact same files LZMA SOLID will give me an exe that is 4.98 MB while using 7zip SFX with the same files and the NSIS installer will give me an exe of 4.73 MB.<br />
<br />
Though it may not seem like much size is extremely critical in this case and I am wondering if there is a way to get NSIS to improve the compression to the same level when using LZMA?<br />
<br />
Thanks,<br />
Robert</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">22nd January 2006, 06:08</div></div><div class="posttext">Have you tried increasing the dictionary size by using SetCompressorDictSize?<br />
<br />
I found this from the 7-zip help file:<br />
<br />
...Usually higher Dictionary size gives more compression ratio. But compressing can be slower and it can require more memory.<br />
<br />
Memory (RAM) usage for LZMA compressing is about 10 times more than dictionary size. Memory usage for LZMA decompressing is close to value of dictionary size. Memory usage for PPMd compressing and decompressing is almost equal to dictionary size...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobertStrong</div><div class="date">22nd January 2006, 07:47</div></div><div class="posttext">Yes, with the default size of 8 MB the exe size is 5.0 MB<br />
with SetCompressorDictSize 16 and above the size is 4.98 MB<br />
<br />
With the following 7zip packaging I get an exe of 4.73 MB<br />
7z a -t7z out.7z &lt;path to files&gt;\*.* &lt;path to NSIS exe&gt;\installer.exe -mx -m0=BCJ2 -m1=LZMA:d24 -m2=LZMA:d19 -m3=LZMA:d19  -mb0:1 -mb0s1:2 -mb0s2:3<br />
upx --best 7zSD.sfx<br />
copy /b 7zSD.sfx+config.txt+out.7z setup.exe<br />
<br />
Except for the File /r &quot;&lt;path to files&gt;\*&quot; in the installer both installers are the same.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">22nd January 2006, 17:20</div></div><div class="posttext">The only explaination I can come up with is the BCJ2 option you have in your 7-zip command line.  7z docs indicate that BCJ2 is a method that allows 32-bit x86 executables to be compressed even further--a feature that may not be implemented in NSIS.<br />
<br />
I found more info about this at http://en.wikipedia.org/wiki/LZMA<br />
<br />
There may be other reasons.  Perhaps someone with more programming experience can give a more detailed (and possibly more accurate) explanation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">22nd January 2006, 20:29</div></div><div class="posttext">another possibility:<br />
once lzma has been implemented in NSIS, the devs took a version of the lzma sdk and modified it to match nsis' structure.<br />
<br />
i don't know, if it ever has been updated since then.<br />
because lzma itself has been updated more than one time and improved speed and compression quality.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DrO</div><div class="date">22nd January 2006, 20:59</div></div><div class="posttext">nsis's version of lzma hasn't been updated in a while and yes, it was taken from the sdk and then tweaked (quite extensively from memory) to fit into the size constraints expected from zlib and bzip methods<br />
<br />
-daz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobertStrong</div><div class="date">22nd January 2006, 23:28</div></div><div class="posttext">Thanks for the responses.... I was thinking that it may be due to using the older SDK or not using the BCJ2 option... if the reason could be confirmed I might attempt updating NSIS to the latest SDK or adding the BCJ2 option.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th January 2006, 17:40</div></div><div class="posttext">Only the decoder was tweaked to fit the size limits. The encoder itself wasn't touched. The code was indeed not updated for a while, but I don't recall seeing any improved compressions in latest versions. BCJ2 is not used in NSIS and can result in better ratios, if you compress 32-bit executables.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RobertStrong</div><div class="date">24th January 2006, 18:13</div></div><div class="posttext">kichik - thanks! It does appear to be due to BCJ2... the size difference is approximately the same. I'll take a look at what it would entail implementing BCJ2 in NSIS in the next month or two. If you know of anyone caveats / issues with implementing this I'd appreciate hearing about them.<br />
<br />
Cheers,<br />
Robert</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th January 2006, 18:18</div></div><div class="posttext">There's one issue of aggregating the compression decoder and BCJ2's decoder. BCJ2 doesn't work with single bytes, it needs 5 due to op size. Because streams aren't used, this is a bit harder. You can either go over the entire data again after it's extracted, or preserve a state in the BCJ2 decoder.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">24th January 2006, 18:22</div></div><div class="posttext">would it be possible to upgrade NSIS with latest LZMA codecs?<br />
<br />
maybe something for the TODO list :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th January 2006, 18:27</div></div><div class="posttext">It's on the TODO, but it's not that important. I haven't seen anything too exciting in the change log. However, if a patch is submitted... ;)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>