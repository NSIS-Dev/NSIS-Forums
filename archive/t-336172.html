<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Time difference between two files - ${FileTimeDiff}, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Time difference between two files - ${FileTimeDiff} NSIS Discussion" />
	
	<title> Time difference between two files - ${FileTimeDiff} [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Time difference between two files - ${FileTimeDiff}</div>
<hr />
<div class="pda"><a href="t-336172.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=336172">Time difference between two files - ${FileTimeDiff}</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Lloigor</div><div class="date">17th October 2011, 21:59</div></div><div class="posttext">I thought maybe this can be useful to some.. works great for me.<br />
<br />
<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
;; Get the difference between two file times<br />
;; P1 :i: File name A.<br />
;; P2 :i: File name B.<br />
;; P3 :o: Number of seconds between the two files, can be negative of positive<br />
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;<br />
!define FileTimeDiff &quot;!insertmacro _FileTimeDiff&quot;<br />
!macro _FileTimeDiff _File1_ _File2_ _Diff_<br />
   Push $0  ;; File Search Handle / File Time (UTC) (100 ns unit, 64bit int)<br />
   Push $3  ;; File Info (struct) / File-2 Time (UTC) (Seconds)<br />
   Push $4  ;; File-1 Time (UTC) (Seconds)<br />
<br />
   System::Call '*(i, l, l, l, i, i, i, i, &amp;t260, &amp;t14) i .r3'  ;; Create WIN32_FIND_DATA Struct<br />
<br />
   !insertmacro ___FileTimeUTCSeconds &quot;${_File1_}&quot;  ;; Get File1 UTC Time in Seconds<br />
   Pop $4<br />
   !insertmacro ___FileTimeUTCSeconds &quot;${_File2_}&quot;  ;; Get File2 UTC Time in Seconds<br />
   Pop $3<br />
   System::Int64Op $4 - $3                          ;; Calculate File Time Difference<br />
   Pop $0<br />
<br />
   _ftdexit:<br />
   Pop $4<br />
   Pop $3<br />
   Exch $0<br />
   Pop ${_Diff_}<br />
!macroend<br />
!macro ___FileTimeUTCSeconds _File_<br />
   System::Call 'kernel32::FindFirstFileA(t, i) i(&quot;${_File_}&quot;, r3) .r0'  ;; Find file info<br />
   IntCmp $0 -1 0 0 +4  ;; if handle &lt;= -1 : not ok<br />
      Push &quot;&quot;<br />
      Pop $0<br />
      Goto _ftdexit     ;; do not even check the other file<br />
;; Else (valid handle)<br />
      System::Call 'kernel32::FindClose(i) i(r0)'  ;; Close file search<br />
<br />
      System::Call '*$3(i, l, l, l, i, i, i, i, &amp;t260, &amp;t14) i (,,, .r0)'  ;; Get File time<br />
      System::Int64Op $0 / 10000000  ;; Conversion From '100 ns' &gt;TO&gt; '1 sec' unit<br />
!macroend<br />
;<br />
<br />
ex.: ${FileTimeDiff} &quot;${SAVEDIR}\${FILETOCHECK}&quot; &quot;${BKPDIR}${BKPNUM}\${FILETOCHECK}&quot; $0<br />
<br />
<br />
Just began nsis scripting about a month ago, so feel free to suggest a better coding for this.  ;)<br />
.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">18th October 2011, 06:20</div></div><div class="posttext">Nice work!<br />
Maybe you could add new parameter where user could choose which times to compare?<br />
Example:<br />
1:  ftCreationTime;<br />
2:  ftLastAccessTime;<br />
3:  ftLastWriteTime;<br />
<br />
Do not forget to add this article to wiki! :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lloigor</div><div class="date">20th October 2011, 19:09</div></div><div class="posttext">Added. :)<br />
http://nsis.sourceforge.net/FileTimeDiff<br />
Also made it 3-modes.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>