<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Iterate over all listbox values not just selected, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Iterate over all listbox values not just selected NSIS Discussion" />
	
	<title> Iterate over all listbox values not just selected [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Iterate over all listbox values not just selected</div>
<hr />
<div class="pda"><a href="t-297530.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297530">Iterate over all listbox values not just selected</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">max0davis</div><div class="date">17th September 2008, 21:33</div></div><div class="posttext">I have an interface where I add IP addresses to a listbox using a textbox and I want to then iterate over all of those IP addresses in the &quot;Leave&quot; function of my page... how do I get each string in a listbox one at a time to do something with it? Here is some code I have so far:<br />
<br />
<br />
Function VersusConcentratorPage<br />
	nsDialogs::Create /NOUNLOAD 1018<br />
	Pop $VERSUS_IP_DIALOG<br />
	${If} $VERSUS_IP_DIALOG == error<br />
		Abort<br />
	${EndIf}<br />
	${NSD_CreateGroupBox} 0u 0u 150u 140u &quot;Versus Concentrator IP List&quot;<br />
	${NSD_CreateListBox} 10u 15u 131u 76u &quot;&quot;<br />
	Pop $VERSUS_IP_LISTBOX<br />
	${NSD_CreateText} 10u 97u 131u 14u &quot;&quot;<br />
	Pop $VERSUS_IP_TEXTBOX<br />
	${NSD_CreateButton} 10u 117u 51u 16u &quot;Add Conc IP&quot;<br />
	Pop $VERSUS_IP_ADD_BUTTON<br />
	${NSD_OnClick} $VERSUS_IP_ADD_BUTTON VersusConcentratorAddIP<br />
	${NSD_CreateButton} 70u 117u 71u 16u &quot;Remove Conc IP&quot;<br />
	Pop $VERSUS_IP_REM_BUTTON<br />
	${NSD_OnClick} $VERSUS_IP_REM_BUTTON VersusConcentratorRemIP<br />
	${NSD_CreateGroupBox} 170u 0u 130u 140u &quot;Instructions&quot;<br />
	${NSD_CreateLabel} 190u 20u 91u 101u &quot;Enter the IP of each versus conentrator here.&quot;<br />
	nsDialogs::Show <br />
FunctionEnd<br />
<br />
Function VersusConcentratorLeave<br />
	<br />
<br />
	<br />
FunctionEnd<br />
<br />
Function VersusConcentratorAddIP<br />
	${NSD_GetText} $VERSUS_IP_TEXTBOX $0<br />
	${NSD_LB_AddString} $VERSUS_IP_LISTBOX $0<br />
	${NSD_SetText} $VERSUS_IP_TEXTBOX &quot;&quot;<br />
FunctionEnd<br />
<br />
Function VersusConcentratorRemIP<br />
	${NSD_LB_GetSelection} $VERSUS_IP_LISTBOX $0<br />
	${NSD_LB_DelString} $VERSUS_IP_LISTBOX $0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">17th September 2008, 21:48</div></div><div class="posttext">LB_GETCOUNT and LB_GETTEXT messages, see MSDN for details</div></div><hr />


<div class="post"><div class="posttop"><div class="username">max0davis</div><div class="date">17th September 2008, 22:07</div></div><div class="posttext">Yeah, I was looking at this page:<br />
<br />
http://msdn.microsoft.com/en-us/library/bb761313(VS.85).aspx<br />
<br />
But I can't quite put it together.<br />
<br />
Had something like this:<br />
<br />
SendMessage $VERSUS_IP_LISTBOX ${LB_GETTEXT} 0 0 $1<br />
  System::Call user32::SendMessage(i$VERSUS_IP_LISTBOX,i${LB_GETTEXT},ir1,t.r1)<br />
<br />
But it didn't seem to pull a string value out of the listbox, what am I doing wrong there? Do you see it?<br />
<br />
I am not very familiar with the syntax of user32::SendMessage, what does that all mean? Is there a good doc on it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">max0davis</div><div class="date">17th September 2008, 22:39</div></div><div class="posttext">Tried this:<br />
<br />
<br />
	SendMessage $VERSUS_IP_LISTBOX ${LB_GETCURSEL} 0 0 $0<br />
	${IF} $0 &gt;= 0<br />
		IntOp $1 $0 + 0;<br />
		SendMessage $VERSUS_IP_LISTBOX ${LB_GETTEXT} $1 $0 $2<br />
		System::Call user32::SendMessage(i$VERSUS_IP_LISTBOX,i${LB_GETTEXT},i$INDEX,t.$0)<br />
		MessageBox MB_OK '0: $0, 1: $1, 2: $2'<br />
	${ENDIF}<br />
<br />
<br />
But I got this warning:<br />
<br />
1 warning:<br />
unknown variable/constant &quot;INDEX,t.$0)&quot; detected, ignoring (C:\Documents and Settings\Max Davis\Desktop\setup.nsi:269)<br />
<br />
And it doesn't work.<br />
<br />
Assuming it is talking about $INDEX not being set... when I set it (Var INDEX) I got this:<br />
<br />
1 warning:<br />
Variable &quot;INDEX&quot; not referenced or never set, wasting memory!<br />
<br />
And it still didn't work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">max0davis</div><div class="date">17th September 2008, 23:11</div></div><div class="posttext">I was able to get the first string in the select box with this:<br />
<br />
<br />
	SendMessage $VERSUS_IP_LISTBOX ${LB_GETTEXT} 0 $0<br />
	System::Call user32::SendMessage(i$VERSUS_IP_LISTBOX,i${LB_GETTEXT},iR0,t.R0)<br />
	MessageBox MB_OK $0<br />
 <br />
<br />
What is a good way to now loop to get all of them?<br />
<br />
Can someone give me an example syntax using:<br />
Do[While|Until]..{ExitDo|Continue|Break}..Loop[While|Until]<br />
From logicLib?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">max0davis</div><div class="date">17th September 2008, 23:40</div></div><div class="posttext">This is where I am currently at:<br />
<br />
<br />
Function VersusConcentratorLeave<br />
<br />
	${NSD_LB_GetCount} $VERSUS_IP_LISTBOX $R0<br />
	IntOp $R1 $R1 &amp; 0<br />
	<br />
	IPLoop:<br />
	SendMessage $VERSUS_IP_LISTBOX ${LB_GETTEXT} 0 $0<br />
	System::Call user32::SendMessage(i$VERSUS_IP_LISTBOX,i${LB_GETTEXT},iR1,t.R1)<br />
	MessageBox MB_OK $0<br />
	IntOp $R1 $R1 + 1<br />
	StrCmp &quot;$R1&quot; &quot;$R0&quot; 0 End<br />
	GOTO IPLoop<br />
	End:<br />
		<br />
FunctionEnd<br />
 <br />
<br />
But it only outputs the last string in the listbox.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">18th September 2008, 13:02</div></div><div class="posttext">in that code, the text would be in $R1, not $0. You can remove the non system plugin sendmessage, it is never going to work</div></div><hr />


<div class="post"><div class="posttop"><div class="username">max0davis</div><div class="date">18th September 2008, 17:06</div></div><div class="posttext">This is the final working script to add values to a listbox and then iterate over them in the leave:<br />
<br />
 <br />
Function VersusConcentratorPage<br />
	nsDialogs::Create /NOUNLOAD 1018<br />
	Pop $VERSUS_IP_DIALOG<br />
	${If} $VERSUS_IP_DIALOG == error<br />
		Abort<br />
	${EndIf}<br />
	${NSD_CreateGroupBox} 0u 0u 150u 140u &quot;Versus Concentrator IP List&quot;<br />
	${NSD_CreateListBox} 10u 15u 131u 76u &quot;&quot;<br />
	Pop $VERSUS_IP_LISTBOX<br />
	${NSD_CreateText} 10u 97u 131u 14u &quot;&quot;<br />
	Pop $VERSUS_IP_TEXTBOX<br />
	${NSD_CreateButton} 10u 117u 51u 16u &quot;Add Conc IP&quot;<br />
	Pop $VERSUS_IP_ADD_BUTTON<br />
	${NSD_OnClick} $VERSUS_IP_ADD_BUTTON VersusConcentratorAddIP<br />
	${NSD_CreateButton} 70u 117u 71u 16u &quot;Remove Conc IP&quot;<br />
	Pop $VERSUS_IP_REM_BUTTON<br />
	${NSD_OnClick} $VERSUS_IP_REM_BUTTON VersusConcentratorRemIP<br />
	${NSD_CreateGroupBox} 170u 0u 130u 140u &quot;Instructions&quot;<br />
	${NSD_CreateLabel} 190u 20u 91u 101u &quot;Enter the IP of each versus conentrator here.&quot;<br />
	nsDialogs::Show <br />
FunctionEnd<br />
<br />
Function VersusConcentratorLeave<br />
	${NSD_LB_GetCount} $VERSUS_IP_LISTBOX $R3<br />
	IntOp $R2 $R2 &amp; 0<br />
	Loop:<br />
	System::Call user32::SendMessage(i$VERSUS_IP_LISTBOX,i${LB_GETTEXT},iR2,t.R1)<br />
	messageBox MB_OK $R1 # DO SOMETHING WITH EACH ONE HERE<br />
	IntOp $R2 $R2 + 1<br />
	IntCmp $R2 $R3 0 Loop<br />
FunctionEnd<br />
<br />
Function VersusConcentratorAddIP<br />
	${NSD_GetText} $VERSUS_IP_TEXTBOX $0<br />
	${NSD_LB_AddString} $VERSUS_IP_LISTBOX $0<br />
	${NSD_SetText} $VERSUS_IP_TEXTBOX &quot;&quot;<br />
FunctionEnd<br />
<br />
Function VersusConcentratorRemIP<br />
	${NSD_LB_GetSelection} $VERSUS_IP_LISTBOX $0<br />
	${NSD_LB_DelString} $VERSUS_IP_LISTBOX $0<br />
FunctionEnd<br />
<br />
<br />
Anyone is free to reuse this code for their purpose. I used it as a way to collect IP addresses to create config file.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>