<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Possible bug, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Possible bug NSIS Discussion" />
	
	<title> Possible bug [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Possible bug</div>
<hr />
<div class="pda"><a href="t-238213.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=238213">Possible bug</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Programmer</div><div class="date">16th February 2006, 17:54</div></div><div class="posttext">Using the following INI file (lines marked by &gt;):<br />
<br />
&gt;;		Title<br />
&gt;;<br />
&gt;;	Header block.<br />
&gt;<br />
&gt;[Settings]<br />
&gt;NumFields=1<br />
&gt;<br />
&gt;;	Description.<br />
&gt;<br />
&gt;[Field 1]<br />
&gt;Type=Checkbox<br />
&gt;Text=Use it<br />
&gt;Flags=NOTIFY<br />
&gt;State=1<br />
&gt;Left=10<br />
&gt;Right=100<br />
&gt;Top=20<br />
&gt;Bottom=30<br />
&gt;<br />
&gt;;	Terminal text, for whatever purpose.<br />
&gt;<br />
&gt;<br />
<br />
If the above INI file is used, examination of the working copy during processing shows that the HWND keyword shows up as so:<br />
<br />
&gt;Right=100<br />
&gt;Top=20<br />
&gt;Bottom=30<br />
&gt;<br />
&gt;;	Terminal text, for whatever purpose.<br />
&gt;<br />
&gt;HWND=14681514<br />
<br />
However, subsequent reads via:<br />
<br />
  ReadINIStr ${hWND} &quot;${Temp}&quot; &quot;Field 1&quot; &quot;HWND&quot;<br />
<br />
will not find it, as far as I can tell.  I used:<br />
<br />
  MessageBox	MB_ICONEXCLAMATION|MB_OK \<br />
			&quot;hWND = ${hWND}&quot;<br />
<br />
to try to see the results, but I got nothing.<br />
<br />
Changing the end of the INI file to:<br />
<br />
&gt;Right=100<br />
&gt;Top=20<br />
&gt;Bottom=30<br />
&gt;<br />
&gt;[End]<br />
&gt;;	Terminal text, for whatever purpose.<br />
&gt;<br />
&gt;<br />
<br />
results in the HWND keyword showing in the correct location, but I'm still seeing nothing with my MessageBox.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">16th February 2006, 18:58</div></div><div class="posttext">However, subsequent reads via:<br />
<br />
ReadINIStr ${hWND} &quot;${Temp}&quot; &quot;Field 1&quot; &quot;HWND&quot;<br />
<br />
will not find it, as far as I can tell. I used:<br />
<br />
MessageBox MB_ICONEXCLAMATION|MB_OK \<br />
&quot;hWND = ${hWND}&quot;<br />
<br />
this will never work.<br />
<br />
this one will:<br />
<br />
ReadINIStr $hWND &quot;$PLUGINSDIR\yourini.ini&quot; &quot;Field 1&quot; &quot;HWND&quot;<br />
MessageBox MB_ICONEXCLAMATION|MB_OK \<br />
&quot;hWND = $hWND&quot;<br />
<br />
you mixed up runtime ($variable) with compile time (${define}).<br />
<br />
also, you set the wrong path to your ini file. (you should always extract your installer related files, like installoption files, plugins, pictures and other stuff just needed in the installer, not in the installed application, to $PLUGINSDIR, not to $TEMP!!!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Programmer</div><div class="date">16th February 2006, 21:33</div></div><div class="posttext">!define hWND $0<br />
!define TempA &quot;$PLUGINSDIR\TempA.ini&quot;<br />
<br />
ReadINIStr ${hWND} &quot;${TempA}&quot; &quot;Field 1&quot; &quot;HWND&quot;<br />
MessageBox	MB_ICONEXCLAMATION|MB_OK \<br />
		&quot;hWND = ${hWND}&quot;<br />
<br />
These are the original lines from the code in question.  The two defines I removed while chopping down to the relevant lines.  The TempA I reduced to Temp figuring that it would be clearer.<br />
<br />
I found the actual reason the Read/Msg was failing while I was chopping the above out for you; I had TempB where I should have had TempA.  I was reading from the wrong INI file.<br />
<br />
The possible bug as described still exists; the HWND keyword is being misplaced if there are blank or comment lines following the last keyword in the last section of the INI file.<br />
<br />
Interestingly, if there are blank and comment lines between sections, it gets it right; it steps back to the last line of the previous section and puts the HWND in the correct spot.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th February 2006, 09:15</div></div><div class="posttext">As far as I know WriteINIStr (and ReadINIStr) just call a Windows API to do the job. If this is the case (I'm pretty sure it is because the programmers would have wanted to cut down on as much overhead as possible) then you shouldn't have comments in between section key values. I for one have never seen an INI file like this. Comments have always appeared above section tags. Then again I could be wrong :)<br />
<br />
What happens if you call the Windows API's (whatever they are!)?<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>