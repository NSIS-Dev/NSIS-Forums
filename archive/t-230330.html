<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" INSTDIR vs Component, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  INSTDIR vs Component NSIS Discussion" />
	
	<title> INSTDIR vs Component [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  INSTDIR vs Component</div>
<hr />
<div class="pda"><a href="t-230330.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=230330">INSTDIR vs Component</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">sandal1306</div><div class="date">7th November 2005, 08:25</div></div><div class="posttext">Hi All -<br />
<br />
Does anyone know how to have the choice of the installation directory for each component I got in the code?<br />
<br />
Is there an easy way to proceed using the standard Page or do I have to create a custom one?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">sandal1306</div><div class="date">7th November 2005, 10:57</div></div><div class="posttext">Adding some precision:<br />
<br />
How can I have in a Directory Page several lines corresponding of the install path of the different components selected in the Component Page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th November 2005, 11:30</div></div><div class="posttext">There's at least two simple ways you could do this... both require you to put multiple Directory pages behind the Components page.<br />
<br />
The following is assuming you're using the Modern UI.  It's a bit untested, but should be fine.<br />
<br />
<br />
# variables to hold the installation directories<br />
var Component1Dir<br />
var Component2Dir<br />
var Component3Dir<br />
<br />
# components page<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
# multiple directory pages<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE Component1DirPre<br />
!define MUI_DIRECTORYPAGE_VARIABLE Component1Dir<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE Component2DirPre<br />
!define MUI_DIRECTORYPAGE_VARIABLE Component2Dir<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE Component3DirPre<br />
!define MUI_DIRECTORYPAGE_VARIABLE Component3Dir<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
# The file installation 'page'<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
# The components (sections)<br />
Section Component1<br />
  # stuff here. Be sure to use the directory variable corresponding<br />
  # to the directory page used. In this case, for example:<br />
  SetOutPath &quot;$Component1Dir&quot;<br />
    File &quot;somefile&quot;<br />
    File &quot;someotherfile&quot;<br />
SectionEnd<br />
<br />
Section Component2<br />
  # stuff here<br />
  SetOutPath &quot;$Component2Dir&quot;<br />
    File &quot;somefile&quot;<br />
    File &quot;someotherfile&quot;<br />
SectionEnd<br />
<br />
Section Component3<br />
  # stuff here<br />
  SetOutPath &quot;$Component3Dir&quot;<br />
    File &quot;somefile&quot;<br />
    File &quot;someotherfile&quot;<br />
SectionEnd<br />
<br />
# Functions run before showing each directory page.<br />
# Here we'll call Abort to stop the page from showing up<br />
#  if the user didn't select the component<br />
Function Component1DirPre<br />
  # Get the flags for the section<br />
  SectionGetFlags ${Component1} $R0<br />
  # Binary 'and' with value '1' (selected or not)<br />
  IntOp $R0 $R0 &amp; 1<br />
  # If it is not selected<br />
  IntCmp $R0 0 0 +2<br />
    # Then Abort. This will prevent the page from showing up<br />
    Abort<br />
  # Otherwise, continue<br />
FunctionEnd<br />
<br />
Function Component2DirPre<br />
  SectionGetFlags ${Component2} $R0<br />
  IntOp $R0 $R0 &amp; 1<br />
  IntCmp $R0 0 0 +2<br />
    Abort<br />
FunctionEnd<br />
<br />
Function Component3DirPre<br />
  SectionGetFlags ${Component3} $R0<br />
  IntOp $R0 $R0 &amp; 1<br />
  IntCmp $R0 0 0 +2<br />
    Abort<br />
FunctionEnd<br />
<br />
<br />
--------------------------------------------------<br />
<br />
Another method, where you wouldn't require multiple directory variables, would be to put the actual file installation/operation instructions in the Directory pages' Post functions.  This is less desirable for various reasons - mostly the log display won't be right.  If you don't care about that, though, it might be easier to work with as all the code corresponding to a particular directory is right there in the directory handling functions.<br />
<br />
--------------------------------------------------<br />
<br />
Lastly, you could make a custom page with multiple directory fields.  This would look cleaner (having a user go through 5 directory pages, for example, would be a bit ick), but also require much more work (think hiding fields if the components aren't selected, still have to store multiple directory variables, etc.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">7th November 2005, 11:32</div></div><div class="posttext">To specifically answer your second post : yes, you'd have to create a custom page.<br />
I've done one with two directories myself, and it's not impossible, but it's not supersimple either :)<br />
The most limiting factor is dialog real-estate.  You'd need a bigger dialog if you want a whole bunch of directory fields.  That, or put up with a relatively ugly page.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>