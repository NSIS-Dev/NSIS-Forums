<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MUI_PAGE_INSTFILES progress bar doesn't show 100%, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MUI_PAGE_INSTFILES progress bar doesn't show 100% NSIS Discussion" />
	
	<title> MUI_PAGE_INSTFILES progress bar doesn't show 100% [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MUI_PAGE_INSTFILES progress bar doesn't show 100%</div>
<hr />
<div class="pda"><a href="t-301336.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301336">MUI_PAGE_INSTFILES progress bar doesn't show 100%</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Ivan Andreevich</div><div class="date">23rd December 2008, 02:25</div></div><div class="posttext">The progress bar is behaving strangely on my MUI instfiles page. When the installation is complete and all that's left to do is to press the &quot;Close&quot; button, the it stops at around 80%. <br />
<br />
Any way to force it to be 100% at this point? I seem to remember seeing a way of doing it, but I can't find it any more. Or, perhaps, someone has an idea about why it's at 80%?<br />
<br />
Ivan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">23rd December 2008, 03:28</div></div><div class="posttext">are you exiting a Section early, perhaps?  The progress bar depends on the number of commands in each section combined, increasing with each command passed.  If you bail out of a section early using some other method than a goto, it might not catch that the installer is actually 'done' as far as you're concerned.<br />
<br />
as far as changing the progress bar:<br />
<br />
OutFile &quot;c:\testsetup.exe&quot;<br />
<br />
Page InstFiles<br />
<br />
!define PBM_SETPOS 0x0402<br />
Function SetProgress<br />
	IntOp $R9 $R9 * 300<br />
    FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $R0 $R0 0x3ec<br />
	SendMessage $R0 ${PBM_SETPOS} $R9 &quot;&quot;<br />
	; MessageBox to show the progress in example<br />
	MessageBox MB_OK &quot;.&quot;<br />
FunctionEnd<br />
<br />
Section<br />
	StrCpy $R9 10<br />
	Call SetProgress<br />
	StrCpy $R9 50<br />
	Call SetProgress<br />
	StrCpy $R9 30<br />
	Call SetProgress<br />
	StrCpy $R9 100<br />
	Call SetProgress<br />
SectionEnd<br />
<br />
<br />
You'd stick something like that (sans the messagebox) in the installfiles page's exit function, perhaps, making sure to set it to 100%.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ivan Andreevich</div><div class="date">25th December 2008, 02:04</div></div><div class="posttext">I was exiting via &quot;Return&quot;. Switched to using GoTo and a label at the end of the section. For some reason it's still showing around 95% completion, but much better than before.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">26th December 2008, 17:59</div></div><div class="posttext">Try using a Nop (placeholder) at the very end of the section.<br />
<br />
[edit] I'm a programmer and goto's are evil (for me anyway).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ivan Andreevich</div><div class="date">5th January 2009, 18:56</div></div><div class="posttext">Awesome, dude - Nop did the trick perfectly :) Progress bar is now at 100%.<br />
<br />
I don't like goto's as well, but in this case what do you suggest?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">7th January 2009, 06:45</div></div><div class="posttext">I would suggest LogicLib.nsh, which is included in nsis. It makes the code easier to read and you don't have to worry about label names for goto's. It also makes the code look more like the 'if' statement from C. Example:<br />
${if} $0 == 1<br />
  ; $0 equals 1 (its a True statement in boolean terms).<br />
${else}<br />
  ; $0 not equal, so do something else (False statement).<br />
${endif}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Ivan Andreevich</div><div class="date">7th January 2009, 20:13</div></div><div class="posttext">I do use LogicLib, but in this case I need to be at the end of the section for the progress bar to show 100%. I don't see how it helps here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">9th January 2009, 23:58</div></div><div class="posttext">Well, the progress bar is calculated on how many instructions are in the section(s). So if you have a compare statement and it jumps to the end of the section, the progress bar won't change to 100% because there are no more instructions in that section to execute. Thats why putting Nop at the end of that section makes the progress show 100%. Nop executes as an instruction but it does nothing, so its great as a placeholder.<br />
<br />
I'm not sure how to solve your code (because I haven't seen it), but you could try wrapping that entire section of code in an if statement, and when its false it skips the code in the if statement (same as a jump-to).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>