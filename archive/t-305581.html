<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Add/Remove Programs icons and overwrite, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Add/Remove Programs icons and overwrite NSIS Discussion" />
	
	<title> Add/Remove Programs icons and overwrite [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Add/Remove Programs icons and overwrite</div>
<hr />
<div class="pda"><a href="t-305581.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=305581">Add/Remove Programs icons and overwrite</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">21st April 2009, 21:07</div></div><div class="posttext">I have a couple of questions regarding Add/Remove Programs that I've looked high and low for answers but have found nothing that solves my problems.  I hope someone here can help.<br />
<br />
I want to add an icon in A/R P but the code I am using does not seem to work.  Here's the line of code in Section -Post.<br />
For clarity:<br />
PURK = PRODUCT_UNINST_ROOT_KEY, PUK = PRODUCT_UNINST_KEY)<br />
<br />
WriteRegStr ${PURK} &quot;${PUK}&quot; &quot;DisplayIcon&quot; &quot;${NSISDIR}\Contrib\Graphics\Icons\uninstall.ico&quot;<br />
<br />
Also, my installer adds an entry into A/R P just fine, except for the above tweak.  Or so I thought.  When I built and ran an installer that had a different version of the same product I expected to find a second entry in A/R P.  Instead, I find that the new entry overwrites the original.  Here is the code:<br />
<br />
  WriteRegStr ${PURK} &quot;${PUK}&quot; &quot;DisplayName&quot; &quot;$(^Name)&quot;<br />
  WriteRegStr ${PURK} &quot;${PUK}&quot; &quot;UninstallString&quot; &quot;$INSTDIR\uninst.exe&quot;<br />
  WriteRegStr ${PURK} &quot;${PUK}&quot; &quot;DisplayVersion&quot; &quot;${PRODUCT_VERSION}&quot;<br />
  WriteRegStr ${PURK} &quot;${PUK}&quot; &quot;Publisher&quot; &quot;${PRODUCT_PUBLISHER}&quot;<br />
<br />
One last question, where does $(^Name) come from?  I've tried to view it using MessageBox but was unable.  What is the carat doing?<br />
<br />
<br />
Thanks.<br />
p.s., in the name of full disclosure I'm forced to use NSIS version 2.39 so, if there are fixes in later versions to these problems, please let me know so I can build a case.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">21st April 2009, 22:43</div></div><div class="posttext">&quot;$(^Name)&quot;<br />
comes from the Installer &quot;Name&quot; directive.<br />
<br />
&quot;${NSISDIR}\Contrib\Graphics\Icons\uninstall.ico&quot;<br />
wouldn't work on any machine other than those who have that icon file in the exact same location on their machine; which is probably not your end-users.<br />
Best is to use an icon in the uninstaller itself, btw - ARP will use that icon from the executable automatically.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">22nd April 2009, 01:47</div></div><div class="posttext">Thanks for the .ico observation - doh!  I should have known that.<br />
<br />
Are you saying that ${^Name} is the same as ${PRODUCT_NAME}?  If so, why the alias and what's with the ^?<br />
<br />
My most pressing question though is why I can't get multiple versions of uninstallers in Add/Remove Programs.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">22nd April 2009, 02:19</div></div><div class="posttext">no, ${PRODUCT_NAME} is probably a define somewhere in the script you're working with; sounds like an HMSoft NIS Edit default define name.<br />
<br />
$(^Name) (not ${^Name} - curly braces here) is a so-called 'langstring' variable.  It changes the string based on whatever language your installer uses (in some installers, that can be decided by the user, typically on startup). <br />
<br />
--<br />
<br />
as for your ARP.. if you want multiple entries, you'll need separate registry key files.  Try adding the version number or so to the registry key.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">28th April 2009, 00:52</div></div><div class="posttext">I got the ARP entries to be unique per build - thank you.<br />
<br />
But I still can't get the icon in ARP to work.  I put a copy of the .ico file in the same directory as my .nsi file but that didn't help.  Here's what I do have that works as desired:<br />
<br />
; The icon in the top right corner of the installer windows and the desktop icon.<br />
!define MUI_ICON &quot;${NSISDIR}\Contrib\Graphics\Icons\my_1.ico&quot;<br />
<br />
; The icon for the installer in the directory, not in Add or Remove Programs.<br />
!define MUI_UNICON &quot;${NSISDIR}\Contrib\Graphics\Icons\my_1_un.ico&quot;<br />
<br />
...<br />
<br />
And this does not work as desired:<br />
<br />
Section -Post<br />
...<br />
  <br />
; Shows up as a registry Name/Data entry.  ARP icon not changed.<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;my_uninstall.ico,4&quot;<br />
<br />
; Also tried, with similar results (no icon index):<br />
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;my_uninstall.ico&quot;<br />
<br />
...<br />
<br />
I suspect I'm missing something obvious but I just don't see it.  Thanks again for your help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">28th April 2009, 01:09</div></div><div class="posttext">I think you have to specify the -full path- to the resource file (in your case, &quot;my_uninstall.ico&quot;) - so including any &quot;c:\program files\myApp\my_uninstall.ico&quot; bits.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th April 2009, 12:10</div></div><div class="posttext">a .ico does not have a icon index, its just one icon, so just using the full path without a index should work</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">28th April 2009, 20:01</div></div><div class="posttext">I hate to sound dense but I'm still not there yet.  I modified the line in my .nsi script in Section -Post:<br />
   WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;${NSISDIR}\Contrib\Graphics\Icons\my_uninstall.ico&quot;<br />
<br />
by replacing ${NSISDIR} with its explicit c:\... path.<br />
<br />
I still don't see the icon I want in ARP.  In fact, it is using an icon from the folder of one of the tools.  Should I expect to see the .ico in the delivered product?  Should I be using the path to this icon?  That doesn't seem right.  I thought it would be incorporated into the installer's .exe like it does the other icons.<br />
<br />
The .ico file I am using is composed of four separate images of different sizes.  I thought that was standard for .ico files that are used as resources.<br />
<br />
Is there some sample code someone can point me to?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">28th April 2009, 20:11</div></div><div class="posttext">${NSISDIR} is a path on your system, not the users system.<br />
<br />
try:<br />
Section<br />
SetOutPath $instdir<br />
File &quot;${NSISDIR}\\Contrib\\Graphics\\Icons\\my_uninstall.ico&quot;<br />
WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} &quot;${PRODUCT_UNINST_KEY}&quot; &quot;DisplayIcon&quot; &quot;$instdir\\my_uninstall.ico&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">28th April 2009, 22:33</div></div><div class="posttext">Okay, thanks.  But that puts a copy of the .ico file into my deliverable.  Is this how it's supposed to work, the .ico file has to be installed?  None of the other icon files, like those that adorn the install window, are installed.  Why would this be different?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">28th April 2009, 22:55</div></div><div class="posttext">yes, it has to be installed because the end-user's machine needs to be able to find that icon file.<br />
<br />
The icons for the installer itself (top-left corner, usually, and explorer views of the installer, etc. etc.) are inside the .exe itself.  So if you place that .exe on the machine's computer, that icon is, in a way, placed on the end-user's machine as well.<br />
<br />
If you don't want to install the icon file, you may be able to add the uninstall icon to the uninstaller executable, and then reference it using e.g. &quot;$instdir\uninstaller.exe,N&quot;, where N would the icon index within the uninstaller.<br />
But I suspect that might be more trouble than it's worth.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">abcdgoldfish</div><div class="date">28th April 2009, 23:52</div></div><div class="posttext">Thanks.  It's making sense.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>