<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Mui_page_directory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Mui_page_directory NSIS Discussion" />
	
	<title> Mui_page_directory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Mui_page_directory</div>
<hr />
<div class="pda"><a href="t-269539.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=269539">Mui_page_directory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">14th April 2007, 14:34</div></div><div class="posttext">I have a problems.<br />
<br />
1. in my installer i setup my files and Firebird.<br />
First i use ExecWait tu setup firebird. After then i show<br />
MUI_PAGE_DIRECTORY and add path of Firebird there.<br />
    <br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !define MUI_DIRECTORYPAGE_VARIABLE $test_val<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_FINISH<br />
..................some code cut..........................<br />
<br />
Section &quot;Main Section&quot; SecMain<br />
<br />
.............some code cut.....................<br />
  <br />
  ReadRegStr $test_val HKLM &quot;Software\Firebird  Project\Firebird Server\Instances&quot;&quot;DefaultInstance&quot;<br />
  StrCmp $test_val &quot;&quot; &quot;&quot; +2<br />
         StrCpy $test_val &quot;C:\Program Files\Firebird\&quot;<br />
  StrCpy $1 $test_val<br />
<br />
  StrCpy $2 &quot;Data\&quot;<br />
  StrCpy &quot;$test_val&quot; &quot;$1$2&quot;<br />
<br />
  SetOutPath &quot;$test_val&quot;<br />
  <br />
  File &quot;B2.FDB&quot;<br />
SectionEnd<br />
<br />
<br />
this  code serching path of Firebird and write it into Directory page path field.<br />
When user change path in this field installer copy file not in new path, it use  old path ($test_val).<br />
<br />
2. How can i change value (space required) on directory page ?<br />
 Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th April 2007, 14:44</div></div><div class="posttext">Sections are executed in the INSTFILES page. Therefore, whatever changes you make to $test_val after the INSTFILES page will not affect anything run in sections.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">14th April 2007, 15:53</div></div><div class="posttext">thx very mach!<br />
and what to do?<br />
how about number 2 question?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th April 2007, 15:58</div></div><div class="posttext">That's a sum of the size required by each selected section. To change the size required by a section, use AddSize or SectionSetSize on runtime.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">14th April 2007, 16:14</div></div><div class="posttext">thx again.<br />
and how use 2 directory page? show different path in each of them, and different free space requirement and diferent files install?<br />
thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">14th April 2007, 16:16</div></div><div class="posttext">PS and how connect 1 section to 1 directory page?<br />
sorry for so many questions</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th April 2007, 16:35</div></div><div class="posttext">To show a different path, use MUI_DIRECTORYPAGE_VARIABLE as you already have and modify that variable so it's different than $INSTDIR.<br />
<br />
To handle the required space, you must unselect all of the sections you don't want installed before showing the directory page. This way, their size won't be in the sum and they won't be executed. See the following example.<br />
<br />
http://nsis.sourceforge.net/Two_installations_in_one_installer</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">18th April 2007, 21:28</div></div><div class="posttext">how can i change install path in directory page if before then i set MUI_DIRECTORYPAGE_VARIABLE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th April 2007, 19:04</div></div><div class="posttext">Change the variable that you pass on to MUI_DIRECTORY_VARIABLE. In your example, it should be:Function .onInit<br />
StrCpy $test_val $PROGRAMFILES\Test<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">19th April 2007, 21:57</div></div><div class="posttext">:( it is not worked</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th April 2007, 22:03</div></div><div class="posttext">What exactly didn't work? What exactly did you do? I can't help you without any details.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">19th April 2007, 22:03</div></div><div class="posttext">function .oninit start before then i get $test_val, because <br />
$test_val i can get, after installer setup firebird</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th April 2007, 22:06</div></div><div class="posttext">Then set it once you get it, as long as it's set before the directory page that uses it shows.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">20th April 2007, 12:45</div></div><div class="posttext">thx, i did it( for example i setup before directory page   c:\Firebird\data), but if user change path in directory page (for example d:\temp\), installer put my file .....<br />
into c:\Firebird\data anyway. :cry:<br />
how can i do it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th April 2007, 12:54</div></div><div class="posttext">If it put the file in that directory, you told it to put it there. Try following the logic of your installer with message boxes so you see exactly when everything is executed. For example, add a message box saying &quot;installing into test_val $test_val&quot; and you'll see where and when it copies the files there.<br />
<br />
Also read the tutorial (http://nsis.sourceforge.net/Docs/Chapter2.html) for details about how everything works together. Pay special attention to Script Execution (http://nsis.sourceforge.net/Docs/Chapter2.html#2.3.6).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">22nd April 2007, 11:33</div></div><div class="posttext">Is someone know, how change MUI_DIRECTORYPAGE_VARIABLE from<br />
MUI_PAGE_DIRECTORY .<br />
thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">22nd April 2007, 19:26</div></div><div class="posttext">This is in the MUI documentation:<br />
Just insert !define MUI_DIRECTORYPAGE_VARIABLE $yourvariable just before you add the page.<br />
<br />
Take some time to read through the rest of the MUI documentation included with NSIS. And see Kichik's last reply. <br />
<br />
There is a lot of good info out there--you just have to reach out and grab it.  :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">22nd April 2007, 20:02</div></div><div class="posttext">I read it, i use logic whith MessageBox, but i dont understend how chenge the path<br />
<br />
;--------------------------------<br />
;Include Modern UI<br />
  !include &quot;MUI.nsh&quot;<br />
;--------------------------------<br />
;General<br />
  XPStyle on<br />
  ;Name and file<br />
  Name &quot;B2&quot;<br />
  OutFile &quot;setup.exe&quot;<br />
  ;Default installation folder<br />
 InstallDir &quot;$PROGRAMFILES\B\B2&quot;<br />
;--------------------------------<br />
;Interface Settings<br />
<br />
  !define MUI_ABORTWARNING<br />
;--------------------------------<br />
<br />
  Var test_val<br />
<br />
;Pages<br />
<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  !insertmacro MUI_PAGE_LICENSE &quot;${NSISDIR}\Docs\Modern UI\License.txt&quot;<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !define MUI_DIRECTORYPAGE_VARIABLE $test_val<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_FINISH<br />
<br />
;--------------------------------<br />
Section &quot;Dummy Section&quot; SecDummy<br />
<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  File &quot;Firebird-1.5.3.4870-0-Win32.exe&quot;<br />
<br />
  Delete $INSTDIR\Firebird-1.5.3.4870-0-Win32.exe<br />
  RMDir $INSTDIR<br />
<br />
  ReadRegStr $test_val HKLM &quot;Software\Firebird Project\Firebird Server\Instances&quot;&quot;DefaultInstance&quot;<br />
  StrCmp $test_val &quot;&quot; &quot;&quot; +2<br />
         StrCpy $test_val &quot;C:\Program Files\Firebird\&quot;<br />
  StrCpy $1 $test_val<br />
<br />
  StrCpy $2 &quot;Data\&quot;<br />
  StrCpy &quot;$test_val&quot; &quot;$1$2&quot;<br />
  StrCpy $INSTDIR &quot;$test_val&quot;<br />
<br />
  File &quot;B2.FDB&quot;<br />
<br />
SectionEnd<br />
<br />
<br />
;--------------------------------<br />
;Installer Functions<br />
<br />
Function .onInit<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">22nd April 2007, 20:04</div></div><div class="posttext">please, try to use my code.<br />
maybe it is error there</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">22nd April 2007, 20:33</div></div><div class="posttext">Well, right off the bat, I see some syntax errors with your use (or lack of) the backslash character:<br />
<br />
Examples:<br />
<br />
 You set INSTDIR at the beginning to $PROGRAMFILESBB2.  There is no such variable.  You probably mean to use &quot;$PROGRAMFILES\BB2&quot;<br />
<br />
 Delete $INSTDIRFirebird-1.5.3.4870-0-Win32.exe should be:<br />
Delete $INSTDIR\Firebird-1.5.3.4870-0-Win32.exe<br />
<br />
 ReadRegStr $test_val HKLM &quot;SoftwareFirebird ProjectFirebird ServerInstances&quot;&quot;DefaultInstance&quot;  should use this syntax:<br />
ReadRegStr $test_val HKLM &quot;Software\Firebird ProjectFirebird ServerInstances&quot;&quot;DefaultInstance&quot;<br />
(I'm not sure the full registry path here, so you may need other \ characters in your path)<br />
<br />
  StrCpy $test_val &quot;C:Program FilesFirebird\&quot; should be<br />
StrCpy $test_val &quot;C:\Program Files\Firebird\&quot; <br />
(note:  you might not need the trailing backslash here, depending on what you trying to acomplish.)<br />
<br />
Other than that, I think your code looks ok.  (or if anything, it should get you a bit further.)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">22nd April 2007, 20:48</div></div><div class="posttext">Comperio<br />
thx, but it is not syntax error(that errors appear when i insert my code in forum- message), it is logical error.<br />
Becauese, when appeare MUI_PAGE_DIRECTORY it is use path from MUI_DIRECTORYPAGE_VARIABLE (it is equal $test_val)<br />
BUT WHEN USER CHANGING PATH, AND NEW PATH APPEAR IN PATH-LINE ON PAGE, installer use old path (it is equal $test_val)<br />
 why???????????????????????</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">22nd April 2007, 21:21</div></div><div class="posttext">Sorry, I didn't realize using [php] stripped the backslashes... (I guess this shows that [code] should be used instead of [php] in the forums when dealing with NSIS code.)<br />
<br />
So back to your question:<br />
Do you expect something to happen execute after MUI_PAGE_DIRECTORY?  If so, you need to add a function for that.<br />
<br />
Since you already used the sections when you inserted MUI_PAGE_INSTFILES, you'll have to execute the 2nd part using a leave function (which you can define with MUI_PAGE_CUSTOMFUNCTION_LEAVE)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd April 2007, 21:54</div></div><div class="posttext">Where in that example do you use $test_val beyond the directory page? It's set in the sections, displayed and modified by the directory page and then ignored.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">22nd April 2007, 22:16</div></div><div class="posttext">please show me how to do it.<br />
thx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd April 2007, 22:19</div></div><div class="posttext">That strictly depends on what you actually want to do. You let the user modify $test_val and then do nothing with it. What do you want to do with it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">22nd April 2007, 22:23</div></div><div class="posttext">yes. i want move  File &quot;B2.FDB&quot; to user input path</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd April 2007, 13:33</div></div><div class="posttext">Then why is the directory page after the instfiles page where the copy itself is made? If it's only for that ReadRegStr, put it in .onInit.Function .onInit<br />
ReadRegStr $test_val HKLM \<br />
  &quot;Software\Firebird Project\Firebird Server\Instances&quot; \<br />
  &quot;DefaultInstance&quot; <br />
FunctionEnd<br />
<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  !insertmacro MUI_PAGE_LICENSE &quot;license.txt&quot;<br />
  !define MUI_DIRECTORYPAGE_VARIABLE $test_val<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !insertmacro MUI_PAGE_FINISH</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">23rd April 2007, 19:47</div></div><div class="posttext">no!<br />
i setup firebird in my installer, after .oninit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">24th April 2007, 03:13</div></div><div class="posttext">If it's just the one file you want to copy, then I'd try this:  First, remove this code from the end of your section:<br />
<br />
StrCpy $INSTDIR &quot;$test_val&quot; <br />
 <br />
then try this:<br />
<br />
<br />
;Pages<br />
<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  !insertmacro MUI_PAGE_LICENSE &quot;${NSISDIR}DocsModern UILicense.txt&quot;<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !define MUI_DIRECTORYPAGE_VARIABLE $test_val<br />
  !define MUI_PAGE_CUSTOMFUNCTION_LEAVE MoveFile<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  <br />
  !insertmacro MUI_PAGE_FINISH<br />
  <br />
  Section<br />
	... your original section code here...<br />
  SectionEnd<br />
  <br />
  Function MoveFile<br />
	; I asume these paths are correct.  If not you may need to modify...<br />
	Rename &quot;$INSTDIR\B2.FDB&quot; &quot;$test_val\B2.FDB&quot;<br />
  FunctionEnd<br />
<br />
<br />
Or, if the FDB file is large and you want to see some progress, you could use the CopyFiles function to copy the file and then delete the file in the original location.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">24th April 2007, 11:53</div></div><div class="posttext">Comperio, thx but no, i show a part of code. i cann't do your variant.<br />
Maybe someone know how move only some file to place in path string ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th April 2007, 12:33</div></div><div class="posttext">You can have your installer gather all of the required installation details for Firebird and pass them on to their installer.ExecWait '$PLUGINSDIR\FirebirdSetup.exe /DIR=&quot;$test_val&quot; \<br />
  /SP /VERYSILENT /NORESTART'This way, you can show the directory page before the instfiles page and know exactly what the Firebird installer did.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">AstraS</div><div class="date">24th April 2007, 13:08</div></div><div class="posttext">thx all!!!!!!!!!!!!!!!!!!!!!!<br />
I do it!<br />
If it is interesting i'll show it there.(its Comperio<br />
variant whith some changes)<br />
thx all!!!!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>