<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" System variable for system AppData, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  System variable for system AppData NSIS Discussion" />
	
	<title> System variable for system AppData [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  System variable for system AppData</div>
<hr />
<div class="pda"><a href="t-316434.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316434">System variable for system AppData</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jdt2oo7</div><div class="date">21st January 2010, 02:32</div></div><div class="posttext">Hi all,<br />
<br />
I am wondering if NSIS installer has a system variable to point to this location:<br />
<br />
$SYSDIR\config\systemprofile\AppData\Roaming\<br />
<br />
or at least variable for &quot;AppData&quot;. This is system not user's AppData.<br />
<br />
Many thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st January 2010, 02:42</div></div><div class="posttext">When running as system (In a service or whatever), $APPDATA should point there (I have never tried)<br />
<br />
But I'm guessing you are really asking how to get that folder when running as admin so you can put data there for your service/driver/whatever. I don't think you are really supposed to do that. There are several hacky ways to get that path, but unless you have a very specific need for something microsoft specific stored there, I would suggest you just store $instdir (or whatever files you need access to) somewhere in the HKLM part of the registry (If it is for a service, your service key will have a parameters subkey etc)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jdt2oo7</div><div class="date">21st January 2010, 03:01</div></div><div class="posttext">Thanks Anders!<br />
Yep, I want to remove service log at that location. Our application stores service log there, so I need to remove it when uninstall.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st January 2010, 04:26</div></div><div class="posttext">Well, there are many ways to skin this cat:<br />
<br />
A) Store the log somewhere else (Why the hell would you store it there? No user is ever going to check it)<br />
<br />
B) Use the system even log, that's what it is there for (Unless you are logging lots of stuff)<br />
<br />
C) Use ControlServiceEx and send custom control codes to the service so the service can perform the action for you<br />
<br />
D) The service could store the AppData path somewhere in the registry when it starts so you can read it in any app (If you can't change the service itself, create a helper service or taskscheduler app that can)<br />
<br />
E) Hack#1: Get path to profile from HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\S-1-5-18 and hardcode the rest or search the subfolders for your log<br />
<br />
F) Hack#2: Somehow ;) get a copy of the system token and call ShGet*() functions with it<br />
<br />
---<br />
<br />
This is just off the top of my head, I'm sure there are more (and possibly) better ways to go about this</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jdt2oo7</div><div class="date">21st January 2010, 19:54</div></div><div class="posttext">Thanks Anders! I am asking the client to update a HKLM entry &quot;LogDirectory&quot; that installer will create when run installation. Upon un-installation, I'll read that entry then remove the log. Will that work?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">21st January 2010, 21:07</div></div><div class="posttext">It'll work, assuming that the directory has not been changed since the regkey was last updated. But you don't need to create the regkey during installation, you can let the service create it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>