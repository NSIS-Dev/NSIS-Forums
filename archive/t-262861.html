<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with NSIS install, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with NSIS install NSIS Discussion" />
	
	<title> Problem with NSIS install [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with NSIS install</div>
<hr />
<div class="pda"><a href="t-262861.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=262861">Problem with NSIS install</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">jens_lynild</div><div class="date">2nd January 2007, 10:54</div></div><div class="posttext">Hi<br />
<br />
I have a problem with the install file I have made with NSIS. When I make the exe file it all works fine and I can run the Install shield and then the program that I want to install is installed. But then I place the file on a ftp server and something goes wrong. I can download the file but when I go through some of the custom made windows the install wizard freezes just before it should start installing the files. Is there any one that has had the same problem and knows how to fix it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">2nd January 2007, 14:06</div></div><div class="posttext">when I go through some of the custom made windows the install wizard freezes<br />
I suppose by that you mean that your installer includes InstallOptions custom page(s). If this is indeed the case, verify that you've include the proper ini for each custom page, and that the ini is extracted and called properly.<br />
e.g.<br />
 Function .onInit<br />
        InitPluginsDir<br />
        File /oname=$PLUGINSDIR\custom.ini custom.ini<br />
FunctionEnd<br />
<br />
Section -<br />
        ReadIniStr $R0 '$PLUGINSDIR\custom.ini' 'Field 1' 'State'<br />
        WriteIniStr '$PLUGINSDIR\custom.ini' 'Field 1' 'State' 'boo'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jens_lynild</div><div class="date">2nd January 2007, 14:59</div></div><div class="posttext">This is how I have used the custom page:<br />
<br />
; Customer page<br />
Page custom SetCustom ValidateCustom<br />
; Instfiles page<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
When I press on install from the page det install wizard freezes.<br />
<br />
the .onInit look like this<br />
<br />
Function .onInit<br />
<br />
  !insertmacro MUI_LANGDLL_DISPLAY<br />
 <br />
FunctionEnd<br />
<br />
I don't know way the wizard stopped working.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Backland</div><div class="date">2nd January 2007, 15:01</div></div><div class="posttext">yes, not extracting to $PLUGINSDIR can cause many issues, so you might want to check that all external files referenced in your code are properly extracted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">2nd January 2007, 15:06</div></div><div class="posttext">If you don't mind attach the script, only the 2 functions SetCustom ValidateCustom.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jens_lynild</div><div class="date">2nd January 2007, 15:15</div></div><div class="posttext">Function SetCustom<br />
<br />
  !insertmacro MUI_HEADER_TEXT &quot;$(LABEL_TITEL)&quot; &quot;&quot;<br />
<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;Custom.ini&quot;<br />
<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;Custom.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;$(LABEL_NAME)&quot;<br />
<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;Custom.ini&quot; &quot;Field 2&quot; &quot;Text&quot; &quot;$(LABEL_NAME_TEXT)&quot;<br />
<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;Custom.ini&quot;<br />
<br />
FunctionEnd<br />
<br />
Function ValidateCustom<br />
<br />
  ReadINIStr $0 &quot;$PLUGINSDIR\Custom.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
<br />
  StrCmp $0 &quot;&quot; message1 done<br />
<br />
  message1:<br />
  MessageBox MB_ICONEXCLAMATION|MB_OK &quot;$(LABEL_MESSAGE1)&quot;<br />
       Abort<br />
<br />
  done:<br />
  ${GetTime} &quot;&quot; &quot;LS&quot; $3 $4 $5 $6 $7 $8 $9<br />
<br />
  ClearErrors<br />
  FileOpen $2 $INSTDIR\Programs\ls.ini w<br />
  IfErrors done<br />
  FileWrite $2 &quot;#X Â© Defaults$\r$\n&quot;<br />
  FileWrite $2 &quot;#Date=$3/$4/$5 ($6)Time=$7:$8:$9$\r$\n&quot;<br />
  FileWrite $2 &quot;Name=$0$\r$\n&quot;<br />
  ${WordReplace} $INSTDIR &quot;\&quot; &quot;/&quot; &quot;+&quot; $3<br />
  FileWrite $2 &quot;defaultDataDir=$3/Data$\r$\n&quot;<br />
  FileWrite $2 &quot;Company=X$\r$\n&quot;<br />
<br />
  StrCmp &quot;1030&quot; &quot;$LANGUAGE&quot; languageWriteDK languageWriteEN<br />
<br />
  languageWriteDK:<br />
  FileWrite $2 &quot;defaultLanguage=da&quot;<br />
  Goto close<br />
<br />
  languageWriteEN:<br />
  FileWrite $2 &quot;defaultLanguage=en&quot;<br />
  Goto close<br />
<br />
  close:<br />
  FileClose $2<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">2nd January 2007, 15:26</div></div><div class="posttext">Function .onInit<br />
InitPluginsDir<br />
File /oname=$PLUGINSDIR\custom.ini custom.ini<br />
!insertmacro MUI_LANGDLL_DISPLAY<br />
FunctionEnd<br />
<br />
Function SetCustom<br />
!insertmacro MUI_HEADER_TEXT &quot;$(LABEL_TITEL)&quot; &quot;&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\Custom.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;$(LABEL_NAME)&quot;<br />
WriteIniStr &quot;$PLUGINSDIR\Custom.ini&quot; &quot;Field 2&quot; &quot;Text&quot; &quot;$(LABEL_NAME_TEXT)&quot;<br />
push $R0<br />
InstallOptions::Dialog &quot;$PLUGINSDIR\Custom.ini&quot;<br />
pop $R0<br />
pop $R0<br />
FunctionEnd<br />
<br />
EDIT:<br />
Also I noticed that you're referring $INSTDIR on ValidateCustom function.<br />
$INSTDIR has to be initialized either in directory page (that you probably already had before the custom page), or in InstallDir if you don't include directory page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jens_lynild</div><div class="date">2nd January 2007, 15:39</div></div><div class="posttext">It seams to work but I will try to test it some on another machine tomorrow thanks for the help :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>