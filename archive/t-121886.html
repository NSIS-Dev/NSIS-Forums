<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Variables error, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Variables error NSIS Discussion" />
	
	<title> Variables error [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Variables error</div>
<hr />
<div class="pda"><a href="t-121886.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=121886">Variables error</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">FreeGeG</div><div class="date">18th January 2003, 14:40</div></div><div class="posttext">I have tryed for first time to use NSIS * it's rules :cool:  * <br />
<br />
I'm still newbie, and can get the Variable set and Get to work... loog this code and tell whats wrong?<br />
<br />
<br />
LicenseData &quot;${NSISDIR}\Contrib\Modern UI\License.txt&quot;<br />
<br />
  ;Component-selection page<br />
    ;Descriptions<br />
    LangString DESC_SecCopyUI ${LANG_Danish} &quot;Installer Left Alone beta 0.019&quot;<br />
<br />
;--------------------------------<br />
;Folder-selection page<br />
<br />
<br />
EnumRegValue $REGINSTALL HKLM &quot;SOFTWARE\Sierra OnLine\Setup\HALFLIFE&quot; &quot;Directory&quot;<br />
InstallDir &quot;$REGINSTALL&quot;<br />
<br />
  <br />
  !insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
  !insertmacro MUI_RESERVEFILE_SPECIALINI<br />
  !insertmacro MUI_RESERVEFILE_SPECIALBITMAP<br />
  <br />
;--------------------------------<br />
;Modern UI System<br />
<br />
!insertmacro MUI_SYSTEM<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;Left Alone&quot; SecCopyUI<br />
  ;Add your stuff here<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  File &quot;C:\la\test.html&quot;<br />
<br />
;--------------------------------<br />
;Create uninstaller<br />
  <br />
   WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;<br />
<br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Descriptions<br />
<br />
!insertmacro MUI_FUNCTIONS_DESCRIPTION_BEGIN<br />
  !insertmacro MUI_DESCRIPTION_TEXT ${SecCopyUI} $(DESC_SecCopyUI)<br />
!insertmacro MUI_FUNCTIONS_DESCRIPTION_END<br />
<br />
;--------------------------------<br />
;Uninstaller Section<br />
<br />
Section &quot;Uninstall&quot;<br />
<br />
  ;Add your stuff here<br />
<br />
  Delete &quot;$INSTDIR&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
<br />
  !insertmacro MUI_UNFINISHHEADER<br />
<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">18th January 2003, 14:57</div></div><div class="posttext">Use ReadRegStr instead of EnumRegValue, since EnumRegValue returns the name of the x'th registry value in a key, not the value of a specified registry value. ReadRegStr does that for strings and ReadRegDWORD for DWORDs.<br />
<br />
See also: 3.7.2.11 ReadRegStr (http://nsis.sourceforge.net/Docs/Chapter3.html#3.7.2.11).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th January 2003, 15:01</div></div><div class="posttext">Commands that are not setting installer settings (name, caption, pages, etc.) can not be outside of functions or sections. NSIS must know when to execute the command so it must be in a function or a section.<br />
<br />
Also $REGINSTALL is not a NSIS variable. NSIS have only 20 variables available for you to use: $0, $1, $2, ..., $9, $R0, $R1, $R2, ..., $R9 and $INSTDIR, $EXEDIR, etc. which are used for other things.<br />
<br />
To set the installation directory according to the registry use InstallDirRegKey (http://nsis.sourceforge.net/Docs/Chapter3.html#3.6.1.19) (outside of a function or a section because it sets an installer settings which is an automatic installation directory retrival from the registry).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">FreeGeG</div><div class="date">18th January 2003, 15:09</div></div><div class="posttext">Now it's working thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">virtlink</div><div class="date">18th January 2003, 15:09</div></div><div class="posttext">kichik still knows more about it than i do. Damn!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">FreeGeG</div><div class="date">18th January 2003, 15:16</div></div><div class="posttext">is there a way to add a dir to the InstallDirRegKey ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th January 2003, 15:46</div></div><div class="posttext">Edit $INSTDIR in .onInit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">FreeGeG</div><div class="date">18th January 2003, 16:14</div></div><div class="posttext">Sorry to ask you, but how do i Edit it?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th January 2003, 16:48</div></div><div class="posttext">For example:<br />
<br />
StrCpy $INSTDIR $INSTDIR\MyProg</div></div><hr />


<div class="post"><div class="posttop"><div class="username">FreeGeG</div><div class="date">18th January 2003, 22:33</div></div><div class="posttext">Aghhh it's working, thanks many times, i have many more questions, but i make a subject there match.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">greg9504</div><div class="date">14th August 2003, 13:06</div></div><div class="posttext">Hi,<br />
<br />
I think there is a bug in the solution.  I had <br />
<br />
StrCpy $INSTDIR $INSTDIR\MyProg<br />
<br />
in my .onInit function.  It seemed to work, then something odd started to happen.  Instead of seeing <br />
<br />
C:\Program Files\mycompany\MyProg<br />
<br />
in the directory dialog (modern UI) I was seeing<br />
<br />
C:\Program Files\mycompany\MyProg\MyProg\MyProg\MyProg<br />
<br />
After a bit of thought I figured it was a copy in place problem and changed the script to:<br />
<br />
Function .onInit<br />
   StrCpy $0 $INSTDIR\MyProg<br />
   StrCpy $INSTDIR $0<br />
FunctionEnd<br />
<br />
<br />
This seems to have fixed it.<br />
<br />
I would like to say what version I am using but can't seem to find that anywhere and can't remember what version I installed.  It was 2 something... I most likely took the latest install from a week ago or so, so 2.0 beta 3a.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">greg9504</div><div class="date">14th August 2003, 13:22</div></div><div class="posttext">Arg! that didn't fix it, well it worked once.  Now I am getting <br />
<br />
C:\Program Files\MyCompany\MyApp\MyApp<br />
<br />
when all I want is<br />
<br />
C:\Program Files\MyCompany\MyApp<br />
<br />
in the directory dialog.  My script looks like:<br />
<br />
<br />
!define MUI_PRODUCT &quot;MyCompany&quot;<br />
#...<br />
InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}&quot;<br />
InstallDirRegKey HKCU &quot;Software\${MUI_PRODUCT}&quot; &quot;&quot;<br />
#...<br />
Function .onInit<br />
   StrCpy $0 $INSTDIR\MyApp<br />
   StrCpy $INSTDIR $0<br />
FunctionEnd<br />
<br />
Please don't copy and paste huge scripts. Attach them. Irrelevant parts of the script deleted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th August 2003, 13:32</div></div><div class="posttext">That is wrong.<br />
You should set $INSTDIR with<br />
<br />
InstallDir &quot;C:\program files\blah&quot;<br />
<br />
Also, you are using the old NSIS 2.0b3. It is recommended that you download the latest Development version from http://nsis.sourceforge.net<br />
Note that you may have to change a lot in your script (Modern UI has changed a lot too)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th August 2003, 13:57</div></div><div class="posttext">If there is no backslash at the end of InstallDir definition the part after the last backslash will be automatically appended to the user selected directory, if he chose it using the browse button.<br />
<br />
If your InstallDir is $PROGRAMFILES\MyCompany and $INSTDIR is $PROGRAMFILES\MyApp in .onInit then its value is probably taken from InstallDirRegKey. Make sure the value is empty before trying again.<br />
<br />
You don't need .onInit anyway. Just set InstallDir to be the desired value directly. Example:<br />
<br />
InstallDir $PROGRAMFILES\MyCompany\MyApp</div></div><hr />


<div class="post"><div class="posttop"><div class="username">greg9504</div><div class="date">14th August 2003, 14:20</div></div><div class="posttext">The date on my makensis.exe is 3/17/2003...<br />
<br />
Should I be using the latest development build and not the 3abeta release?<br />
<br />
Kichik, I tried setting <br />
<br />
InstallDir $PROGRAMFILES\MyCompany\MyApp<br />
<br />
using:<br />
<br />
InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}\MyApp&quot;<br />
<br />
However in the directory dialog I only saw<br />
<br />
&quot;$PROGRAMFILES\${MUI_PRODUCT}&quot;<br />
<br />
displayed as the default install dir.  However if I chose the default it would install to<br />
<br />
&quot;$PROGRAMFILES\${MUI_PRODUCT}\MyApp&quot;<br />
<br />
Anyway, you were correct and my repeating problem was due to InstallDirRegKey not being cleaned up.<br />
<br />
Thanks.<br />
<br />
[on edit]<br />
<br />
I just tried setting <br />
InstallDir &quot;$PROGRAMFILES\${MUI_PRODUCT}\MyApp&quot;<br />
<br />
and it is working like it should (displayed in directory dialog).  I guess it had to due with an old InstallDirRegKey.  <br />
<br />
Thanks again.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>