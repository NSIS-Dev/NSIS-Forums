<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" InstallOptions, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  InstallOptions NSIS Discussion" />
	
	<title> InstallOptions [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  InstallOptions</div>
<hr />
<div class="pda"><a href="t-65778.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=65778">InstallOptions</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">16th November 2001, 05:19</div></div><div class="posttext">I just played around with the new contrib InstallOptions and noticed the following:<br />
<br />
 - Window doesn't update correctly<br />
 - edit controls dont autoscroll<br />
<br />
Attached is a patch which fixes bot issues and adds a new feature<br />
for controls of type &quot;DirRequest&quot;:<br />
By setting Text=... you can set a root directory to browse in.<br />
I use that now for a dialog which enables selection of program<br />
group for installing shortcuts in startmenu.<br />
Another change, i made is allocating the HWNDList dynamically.<br />
<br />
Apart from these issues, InstallOptions a very useful extension.<br />
 -Fritz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">alexj</div><div class="date">16th November 2001, 08:09</div></div><div class="posttext">I've got that problem too.<br />
<br />
Can You tell me how to apply that patch, <br />
which utilities are needed, etc... ?<br />
<br />
Or, maybe, you can post the patched <br />
InstallerOptions.cpp file itself?<br />
It is not that big, especially zipped :)<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">16th November 2001, 08:44</div></div><div class="posttext">Originally posted by alexj <br />
I've got that problem too.<br />
<br />
Can You tell me how to apply that patch, <br />
which utilities are needed, etc... ?<br />
<br />
Or, maybe, you can post the patched <br />
InstallerOptions.cpp file itself?<br />
It is not that big, especially zipped :)<br />
<br />
Thanks in advance <br />
<br />
diff and patch are the usual tools for distributing source changes<br />
in the Unix (Linux) world.<br />
I use patch.exe which is part of cygwin, a very useful<br />
posix environment, freely available at http://sources.redhat.com/cygwin/<br />
<br />
Unpack the zipfile, then<br />
cd into the directory where your original .cpp is and run<br />
patch -p0 &lt; /path/where/you/unzipped/InstallerOption.patch<br />
<br />
Ciao<br />
 -Fritz<br />
<br />
BTW:<br />
Hardcore programmers also can read the .patch (it's a text-file) and apply the changes by hand ;) :<br />
<br />
Each change begins with a line<br />
<br />
@@ -o1,o2 +n1,n2<br />
<br />
where<br />
  o1 is the start line-number in the old file<br />
  o2 is the end line-number in the old file<br />
  n1 is the start line-number in the new file<br />
  n2 is the end line-number in the new file<br />
<br />
Then (in unified diffs like this) 2 lines of unchanged context<br />
follow, followed by the changed lines, followed by another 2 lines<br />
of unchanged context. The changed lines are simply prefixed by '-'<br />
or '+'. '-' means &quot;delete that line&quot;, '+' means &quot;add that line&quot;.<br />
<br />
Pretty simple, eh?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">alexj</div><div class="date">16th November 2001, 09:00</div></div><div class="posttext">Thanks .<br />
<br />
Actually, that's what I did while waiting for Your answer :)<br />
<br />
But next time I'll use patch, sure.<br />
<br />
- Alex J.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">locnar42</div><div class="date">16th November 2001, 18:53</div></div><div class="posttext">One quick point about this patch. <br />
The HWNDList is not used for the controls which you define, but rather for the controls on the main NSIS dialog.  The reason they aren't allocated dynamically is because it would require counting the enumerating the controls an extra time.<br />
Anyway, the patch has a bug if the number of controls on the NSIS window is greater than 2*(number of option controls+10).<br />
This will work most all the time, but it is a potential bug (not that the hardcoded limit of 150 is much better).<br />
<br />
I'll merge the changes into the Install Options source and let you know when it's done.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">18th November 2001, 00:45</div></div><div class="posttext">Originally posted by locnar42 <br />
One quick point about this patch. <br />
The HWNDList is not used for the controls which you define, but rather for the controls on the main NSIS dialog.<br />
<br />
<br />
Of course you are right. I realized that when i looked closer into the source (my patch was a 5min quickhack to get what i wanted). But you don't need to count them. I now changed the HWNDList to a linked list where elements get added on initial traversal of the window-hierachy. Size of exe is still the same and number of windows is now virtually unlimited.<br />
More in a PM ...<br />
<br />
-Fritz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">locnar42</div><div class="date">19th November 2001, 01:33</div></div><div class="posttext">Ok, so I posted a new version of Install Options to the website (http://installoptions.sourceforge.net).  Click here (http://installoptions.sourceforge.net/io.zip) to download it.<br />
<br />
This version adds a couple of things.<br />
 Listbox controls (single or multi select).<br />
 Edit controls will autoscroll.<br />
 Window should draw properly.<br />
 Added ROOT property to dirrequest controls to specify the root.  Used this instead of TEXT because TEXT can be used to specify an initial directory.<br />
<br />
Also, I went ahead and wrote the code to allocate HWNDList dynamically.<br />
<br />
Let me know if you experience any problems, or if you have any other requests.<br />
<br />
michael</div></div><hr />


<div class="post"><div class="posttop"><div class="username">felfert</div><div class="date">21st November 2001, 06:16</div></div><div class="posttext">Well, it still has some display flaws.<br />
The initial display is correct, but when some other window is moved above (e.g. The BrowseForDir-Window), then the &quot;old&quot; contents of the installer window gets partially displayed (see attached jpg). I think, the main reason for that is the wait-loop in the ExecWait function of NSIS which still dispatches WM_PAINT messages. But i may be wrong with that (Im a UnixGuru not a WinGuru).<br />
<br />
Meanwhile i have &quot;DLLified&quot; InstallerOptions and added 3 things to NSIS:<br />
[list=1]<br />
 An ExecDLL command for running a function in a DLL (basically LoadLibrary(), GetProcAddress(), calling external func, pushing result on stack)<br />
 The .onDlgPage feature described in my Post &quot;A better integration of InstallOptions&quot;<br />
 An additional variable $SECTIONS which reflects the current selected components. (For running some dialogs conditionally)<br />
[/list=1]<br />
<br />
When running as DLL, this has several advantages. For example, the caller (NSIS) can provide some additional internals to the called function. Also, the existing Buttons and Icons can be reused. I simply change the DialogProc temporarily, so that the Cancel, Back and Next Buttons are used instead of the Ok. (The Ok seems to appear somewhat surprising, especially because the the user thinks that he is still using the same program). The Icon is kept and the &quot;ComponentText&quot; temporaily replaced.<br />
The only disadvantage is size. The same code results in 24k when compiled as DLL. Luckily, most of this added space seems to be good compressable relocation table or so. Compressed size is still app. 5k.<br />
<br />
-Fritz</div></div><hr />


<div class="post"><div class="posttop"><div class="username">locnar42</div><div class="date">21st November 2001, 21:07</div></div><div class="posttext">felfert,<br />
What version of windows are you using?<br />
Also, what is your localized language?<br />
<br />
The main reason IO isn't a DLL is the main NSIS distribution doesn't support it.  If Justin adds this support, then I'd agree and would probably switch it.  Until then, I would much rather it work with all versions.  I think my biggest complaint with the current workings is there is no way to run it until after the installation starts copying files.<br />
<br />
From my perspective, if I was going to modify NSIS to run the DLL, then I would much rather add all of IO into NSIS by adding Dialog/DialogEnd commands (which is actually where I started).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Tresni</div><div class="date">24th November 2001, 19:48</div></div><div class="posttext">I'm running Windows 98 SE and my local language is English..  I get the exact same redraw problems mentioned in this post..<br />
<br />
Is this just my system or a real problem?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>