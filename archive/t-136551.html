<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" File versions help, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  File versions help NSIS Discussion" />
	
	<title> File versions help [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  File versions help</div>
<hr />
<div class="pda"><a href="t-136551.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=136551">File versions help</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2003, 11:56</div></div><div class="posttext">I'm going to have to use GetFileTime to do this...<br />
<br />
I have jeff.wal in 1&gt;C:\textures<br />
I also have jeff.wal in 2&gt;C:\temp\textures<br />
<br />
If jeff.wal in dir1 is newer than jeff.wal in dir2, then I want to copy jeff.wal across to update jeff.wal in dir2.<br />
<br />
Is this possible with GetFileTime?<br />
<br />
All I currently can do is if GetFileTime of jeff.wal in dir1 is different to GetFileTime of jeff.wal in dir2 (StrCmp), then copy across.<br />
The problem is, jeff.wal in dir2 may be newer than jeff.wal in dir1, therefore the old file will overwrite the newer one.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">25th May 2003, 12:41</div></div><div class="posttext">Yes, you have only to compare the first DWORD given of the C:\textures one with the first of the C:\temp\textures one jeff.wal, if the result is equal, compare second of the DWORD give with each one. So will be like this:<br />
<br />
<br />
<br />
# $0 is &quot;C:\\Textures\\jeff.wal&quot;, $1 is &quot;C:\\Temp\\Textures\\jeff.wal&quot; (results of the custom page)<br />
<br />
# Get File Times in two 32-bits DWORDs<br />
<br />
GetFileTime $0 $R0 $R1<br />
GetFileTime $1 $R2 $R3<br />
<br />
# Now compare<br />
<br />
IntCmp $R2 $R0 0 Old New<br />
IntCmp $R3 $R1 Same Old New<br />
<br />
# Put the codes here<br />
<br />
Old: ;If the first file is new than the second<br />
 CopyFiles $1 $0<br />
  Goto EndComparation<br />
<br />
New: ;If the second file is new than the first<br />
 CopyFiles $0 $1<br />
  Goto EndComparation<br />
<br />
Same: ;If the two are equal (nothing to do here)<br />
<br />
EndComparation: ;The end of the comparation, put normal codes here</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th May 2003, 14:18</div></div><div class="posttext">Comparing the first DWORD is not enough. The first DWORD can only contain 2^32 which is around 430,000 seconds which is only 120 hours.<br />
<br />
Comparing the two DWRODs as shown in this example (http://forums.winamp.com/showthread.php?s=&amp;threadid=102030&amp;highlight=getfiletime) is a lot better. Two DWORDs give you a resulotion of 58494241 years.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2003, 14:20</div></div><div class="posttext">If file 2 is newer than file 1, then I don't want to copy file 2 over file 1<br />
I'll just replace<br />
<br />
IntCmp $R2 $R0 0 Old New<br />
IntCmp $R3 $R1 Same Old New<br />
with<br />
<br />
IntCmp $R2 $R0 0 Old 0<br />
IntCmp $R3 $R1 Same Old Same<br />
And remove the new copy bit<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2003, 14:22</div></div><div class="posttext">But how would I go about changing that script that Kichik has shown me - I don't want to use GetFileTime local.<br />
<br />
What script shall I use?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th May 2003, 14:25</div></div><div class="posttext">GetFileTimeLocal and GetFileTime return the same values, therefor you can just change GetFileTimeLocal to GetFileTime.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">25th May 2003, 14:47</div></div><div class="posttext">Kichik, I compare the two DWORDs.<br />
AfrowUK, if is new, I will don't want to compare the second DWORD, because it is not needed. Only if the first DWORD of the two files are equal.<br />
<br />
And to fix the code:<br />
<br />
Ops, don't need the goto<br />
<br />
<br />
# I want to detect only if the file 1 is new to overwrite the 2.<br />
<br />
# $0 is &quot;C:\Textures\jeff.wal&quot;, $1 is &quot;C:\Temp\Textures\jeff.wal&quot; (results of the custom page)<br />
<br />
# Get File Times in two 32-bits DWORDs<br />
<br />
GetFileTime $0 $R0 $R1<br />
GetFileTime $1 $R2 $R3<br />
<br />
# Now compare<br />
<br />
IntCmp $R0 $R2 0 EndComparation +2<br />
IntCmp $R1 $R3 EndComparation EndComparation 0<br />
<br />
# If is new<br />
<br />
 CopyFiles $0 $1<br />
<br />
EndComparation: ;The end of the comparation, put normal codes here<br />
<br />
<br />
I don't put the IntCmpU because these DWORDs can be negative.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">25th May 2003, 14:50</div></div><div class="posttext">Right, sorry, my bad.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2003, 15:15</div></div><div class="posttext">Well, here it is then!<br />
<br />
# Copy<br />
StrCmp ${INPUT_DIR2} &quot;&quot; skipcopy2<br />
 IfFileExists &quot;${INPUT_DIR1}\env\$2*&quot; 0 skipcopy2<br />
 FindFirst $R1 $R2 &quot;${INPUT_DIR2}\env\$2*&quot;<br />
 IfErrors errorcopy2<br />
 DetailPrint &quot;File env\$7$R2&quot;<br />
<br />
	IfFileExists &quot;${OUTPUT_DIR}\env\$7$R2&quot; 0 copyfile2_1<br />
	GetFileTime &quot;${INPUT_DIR2}\env\$7$R2&quot; $R0 $R1<br />
	GetFileTime &quot;${OUTPUT_DIR}\env\$7$R2&quot; $R2 $R3<br />
<br />
	IntCmp $R0 $R2 0 copyloop2 +2<br />
	IntCmp $R1 $R3 copyloop2 copyloop2 0<br />
<br />
	Delete &quot;${OUTPUT_DIR}\env\$7$R2&quot;<br />
<br />
copyfile2_1:<br />
  CopyFiles &quot;${INPUT_DIR2}\env\$7$R2&quot; &quot;${OUTPUT_DIR}\env\$7$R2&quot;<br />
copyloop2:<br />
 FindNext $R1 $R2<br />
 IfErrors donecopy2<br />
 DetailPrint &quot;File env\$7$R2&quot;<br />
<br />
	IfFileExists &quot;${OUTPUT_DIR}\env\$7$R2&quot; 0 copyfile2_2<br />
	GetFileTime &quot;${INPUT_DIR2}\env\$7$R2&quot; $R0 $R1<br />
	GetFileTime &quot;${OUTPUT_DIR}\env\$7$R2&quot; $R2 $R3<br />
<br />
	IntCmp $R0 $R2 0 copyloop2 +2<br />
	IntCmp $R1 $R3 copyloop2 copyloop2 0<br />
<br />
	Delete &quot;${OUTPUT_DIR}\env\$7$R2&quot;<br />
<br />
copyfile2_2:<br />
  CopyFiles &quot;${INPUT_DIR2}\env\$7$R2&quot; &quot;${OUTPUT_DIR}\env\$7$R2&quot;<br />
Goto copyloop2<br />
donecopy2:<br />
 ClearErrors<br />
 FindClose $R1<br />
Goto skipcopy2<br />
errorcopy2:<br />
 FindClose $R1<br />
 DetailPrint &quot;Error: No $2 in ${INPUT_DIR2}&quot;<br />
skipcopy2:<br />
<br />
-Stu :o</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>