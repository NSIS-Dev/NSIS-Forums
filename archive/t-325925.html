<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" RunAs with Windows 7 does not work, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  RunAs with Windows 7 does not work NSIS Discussion" />
	
	<title> RunAs with Windows 7 does not work [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  RunAs with Windows 7 does not work</div>
<hr />
<div class="pda"><a href="t-325925.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=325925">RunAs with Windows 7 does not work</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">happyhippo</div><div class="date">13th January 2011, 15:22</div></div><div class="posttext">I am using the NSIS RunAs plugin in order to call another install program if the user has only user privileges. In XP the RunAs is working fine. Under Win7 the RunAs always exits with error. <br />
<br />
I have tried both methods:<br />
<br />
1.    <br />
StrCpy $1 $ADMIN_LOGON<br />
StrCpy $2 $ADMIN_PASSWD<br />
StrCpy $3 â€œ$INST_TEMP\Update_Monitor\UpdateMon_Installer.exe &quot;<br />
StrCpy $4 0<br />
System::Call 'RunAs::RunAsW(w r1,w r2,w r3,*w .r4) i .r0 ? u'<br />
<br />
2. <br />
RunAs::RunAs `&quot;$INST_TEMP\Update_Monitor\UpdateMon_Installer.exe` `$ADMIN_LOGON` `$ADMIN_PASSWD`<br />
<br />
Any ideas why this works does not work anymore on Win7?<br />
<br />
Many thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">13th January 2011, 22:04</div></div><div class="posttext">2 is never going to work, this thing is not a NSIS plugin...<br />
<br />
As to why 1 does not work is hard to say when you don't post the error message. But I'd say this &quot;plugin&quot; code is horrible and buggy, it leaks handles and the error string buffer.<br />
<br />
To get the error string, you would have to treat $4 as a WCHAR* and extract it with the system::call struct syntax, then you will get a error string that may give some hints as to why it is failing, alternatively, do something like system::call 'user32::MessageBoxW(i0,i r4,i0,i0)i'<br />
After that you can pass $4 to LocalFree, but there is no way to close the two leaked handles, that needs to be fixed in the source</div></div><hr />


<div class="post"><div class="posttop"><div class="username">happyhippo</div><div class="date">20th January 2011, 15:44</div></div><div class="posttext">I have found the runas problem.<br />
<br />
Method 1 is another runas plugin for NSIS and I have used this dll to run method 2.<br />
<br />
The good thing with method 1 was that it does not require any dll file to be located with the installer. But as the method does not longer work with Windows 7 I have to switch to the other runas plugin.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>