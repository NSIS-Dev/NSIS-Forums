<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to create a service EXE which calls a BATCH file., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to create a service EXE which calls a BATCH file. NSIS Discussion" />
	
	<title> How to create a service EXE which calls a BATCH file. [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to create a service EXE which calls a BATCH file.</div>
<hr />
<div class="pda"><a href="t-316908.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=316908">How to create a service EXE which calls a BATCH file.</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">pillairohit</div><div class="date">9th February 2010, 10:22</div></div><div class="posttext">I went to http://nsis.sourceforge.net/NSIS_Service_Lib and included &quot;servicelib.nsh&quot;.<br />
I have a batch (.BAT) file which I wanted to add as a Windows Service.<br />
I have written an EXE, Its code is given below:<br />
<br />
outfile &quot;Gateway-Start.exe&quot;<br />
<br />
!include servicelib.nsh<br />
!define InstallDir &quot;Gateway&quot;<br />
InstallDir &quot;$PROGRAMFILES\${InstallDir}&quot;<br />
<br />
# create a default section.<br />
section<br />
       call executeGateway       <br />
       setOutPath $INSTDIR<br />
sectionEnd<br />
<br />
Function executeGateway<br />
         # I tried using EXEC but no success.<br />
         # Exec &quot;$INSTDIR\bin\gateway.start.bat&quot;;<br />
         ExecShell &quot;open&quot; &quot;$INSTDIR\bin\gateway.start.bat&quot;;         <br />
FunctionEnd<br />
<br />
If I double click above EXE the gateway BATCH files starts, but if I add this EXE as a Windows Service the BATCH file executes but the status in services.msc never changes to STARTED.<br />
<br />
Its very urgent please help and thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CG!</div><div class="date">9th February 2010, 11:44</div></div><div class="posttext">Maybe it's because the exe closed itself after the batch is started and the batch is closing as well after the eof is reached?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pillairohit</div><div class="date">9th February 2010, 11:57</div></div><div class="posttext">The BATCH file executes successfuly as I do see java.exe instance alive in Task Manager.<br />
<br />
But NSIS EXE gets closed after I receive a PopUp saying &quot;Error 1053: The service did not respond to the start or control request in timely fashion&quot; in my services.msc window.<br />
<br />
Even if the NSIS EXE gets closed the java.exe (the BATCH file) still persist in Task Manager which is correct.<br />
<br />
The problem is, in services.msc the status for my service is not saying STARTED, it just says STARTING... and then no status.<br />
<br />
Please help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CG!</div><div class="date">9th February 2010, 13:40</div></div><div class="posttext">Erm... it's java that is running and not the batch.<br />
Windows is only watching the file, the service is associated to (like service.exe).<br />
<br />
if the service is the batch file itself, try starting java with &quot;Start /W&quot;. This will keep the batch running until java is closed.<br />
Maybe the msc will then tell the correc status, but i can't say this for sure because i never build a service on a batch.<br />
But i did serveral times using VB.<br />
<br />
Using VB makes own serices easy because i can watch the started process (like java) and if it was closed, stop the service or restart the program. Maybe this is an option for you?<br />
You can use NSiS for such a program too, but in my opinion it's harder with NSiS to get the pid of a specific process.<br />
<br />
Edit:<br />
Forgot to mention that the service exe, which starts the program, is made to stay in memory. Won't work else.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>