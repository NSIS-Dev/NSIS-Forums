<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to replace old program version with new one?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to replace old program version with new one? NSIS Discussion" />
	
	<title> How to replace old program version with new one? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to replace old program version with new one?</div>
<hr />
<div class="pda"><a href="t-297469.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297469">How to replace old program version with new one?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">qforce3</div><div class="date">16th September 2008, 15:44</div></div><div class="posttext">Hello everybody,<br />
<br />
I'm new to NSIS and creating installers went very well so far for me. However, what I'm wondering about is this: What do you do if an older version of your program is already installed?<br />
<br />
 Deinstall it first, then install the new version?<br />
 Overwrite everything and hope there's no garbage left?<br />
 Manually maintain a list of file 'differences' between each version and take that into account during installation?<br />
<br />
Some more questions:<br />
<br />
 What if you want to transfer the settings of the old version to the new one?<br />
 What if the user tries to install an older version over a newer one?<br />
<br />
Thanks for any help you guys can give me!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">16th September 2008, 15:56</div></div><div class="posttext">When my installer finds an older version, it goes into upgrade mode: It overwrites only those files that I know have changed since any previous version. I'm the release engineer, I know which files have to be overwritten, so I just put those File commands in a separate section. All other File commands (for all unchanged files) are only executed in Reinstall and Newinstall modes.<br />
<br />
If the installer finds a newer version of my project installed, it issues a warning &quot;you're trying to install an older version than [previously installed version]&quot;. If the user chooses to continue, I once again do the all-knowing trick: I design the source code so that it can handle this situation. Any files I know were different (or not present yet, or are missing now) I extract. Any other files I leave alone.<br />
<br />
As for overwriting settings, that's never been a problem for my projects.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">qforce3</div><div class="date">16th September 2008, 16:32</div></div><div class="posttext">So if I understand correctly, that means, if you have the following versions:<br />
- noob-app-1.0<br />
- noob-app-1.1<br />
- noob-app-1.2<br />
- noob-app-1.3 &lt;= current version<br />
then you would manually maintain a list of differences between 1.0 and 1.3, 1.1 and 1.3, and 1.2 and 1.3, right?<br />
<br />
Huh... sounds very laborious to me, especially if there are many files to keep track of. Isn't there any way to automate this task?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">16th September 2008, 19:59</div></div><div class="posttext">I think the easiest way would be to call the prior version's uninstall program (maybe in silent mode) before installing the new version.  This would ensure that you replaced all the files and that any unnecessary (old) files were cleaned up.<br />
<br />
If the app in question follows Microsoft best practices, then the settings should be separate from the application (like under the user's %AppData% folder), so re-installing shouldn't affect those.  But if not, then you'll need to first save the old settings somewhere before you delete them during the uninstall.<br />
<br />
If you want to prevent installing an older version on top of a new version, you'll need to do a version check right off the bat (in .OnInit, for example).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">setdosa</div><div class="date">17th September 2008, 17:21</div></div><div class="posttext">Hi, I am also trying the same way but I am not getting the required setup. can you please help me on how I can do this? say after the .OnInit what should I use to make the installer do a self verification of its previopus version???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">17th September 2008, 18:41</div></div><div class="posttext">You'd need to get the version from somewhere--like maybe the registry or from the file itself.   Then, use VersionCompare to compare the versions.  See the help file for info on usage.  Basically, it would look something like this:!include logiclib.nsh<br />
!include wordfunc.nsh<br />
!insertmacro VersionCompare<br />
...<br />
Function .onInit<br />
   ; assume $OldVersion is already set and that ${ThisVersion} is already defined<br />
   ; set $0ldVersion to &quot;0.0.0.0&quot; if old version is not found<br />
   ${VersionCompare} &quot;$OldVersion&quot; &quot;${ThisVersion}&quot; $0<br />
   ${If} $0 = 1<br />
      ; this version is OLDER<br />
      MessageBox MB_OK &quot;This version is older than than existing!&quot;<br />
      Abort<br />
   ${EndIf}<br />
   ...<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>