<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" GetWindowsVer, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  GetWindowsVer NSIS Discussion" />
	
	<title> GetWindowsVer [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  GetWindowsVer</div>
<hr />
<div class="pda"><a href="t-169445.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=169445">GetWindowsVer</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">15th February 2004, 12:39</div></div><div class="posttext">hello!<br />
<br />
i have a small problem. i tried to fix this, but i don't know what to do. in my script i use GetWindowsVer for my shortcuts. if it is win9x platform i use rundll32 from WINDIR, else from SYSDIR. the problem is that the shortcut is created always with WINDIR path. a part from the script is attached. i do not understand this. i tested on WinXP, Win2000, and WinMe.<br />
<br />
thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th February 2004, 12:47</div></div><div class="posttext">Maybe it's related to LogicLib, try using standard commands.<br />
<br />
Does rundll32 only exist in WINDIR on Win9x?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">15th February 2004, 12:51</div></div><div class="posttext">i will try and see the results.<br />
rundll32 exists in:<br />
<br />
windir - win9x<br />
and<br />
sysdir - winnt/2000/xp<br />
<br />
thanks.<br />
<br />
edit:<br />
<br />
i modified the code to look like this :<br />
<br />
Call GetWindowsVersion<br />
MessageBox MB_OK &quot;= $R0 =&quot;<br />
Pop $R0<br />
MessageBox MB_OK &quot;= $R0 =&quot;<br />
<br />
the 1st message box show : &quot;1&quot;<br />
and the second - nothing.<br />
<br />
is this ok ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th February 2004, 13:01</div></div><div class="posttext">The value of the first one has nothing to do with GetWindowsVersion.<br />
The second one should show the version.<br />
<br />
That means that the problem is related to GetWindowsVersion. Can you check the registry keys used by this function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">15th February 2004, 13:33</div></div><div class="posttext">well, i got it - almost.<br />
<br />
i changed $R0 to $R6 and it worked.<br />
<br />
$R0 - i am using this a lot before this<br />
$R6 - i am not using this in my script.<br />
<br />
the funny thing is that after that, i changed back to $R0 and (surprise) it works. :igor: so at this point i can't make it to NOT work.<br />
<br />
i revert my windows (system restore) and try again with $R6 or $R0 and it does NOT work. :igor: i don't get it.<br />
<br />
if you want to investigate, i will attach the whole script.<br />
<br />
thanks.<br />
<br />
edit:<br />
<br />
i tried with a messagebox inside the GetWindowsVersion function. i got the same result - nothing inside $R0.<br />
maybe this is important - the function GetWindowsVersion is not in my script. i include it : &quot; !include &quot;include\WindowsVer.nsh&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">VegetaSan</div><div class="date">15th February 2004, 15:14</div></div><div class="posttext">Are you making a Codec Pack. If awnser yes <br />
Then you arent the only one, me too<br />
<br />
What do you really want. <br />
Do you want to Detect the Windowd Version <br />
and if it is Win98 then you want to create this<br />
ShortCut <br />
<br />
CreateShortCut &quot;$SMPROGRAMS\$STARTMENU_FOLDER\Matrix Mixer Configuration.lnk&quot; &quot;$WINDIR\rundll32.exe&quot; '&quot;$INSTDIR\MatrixMixer\matrix_mixer.ax&quot;,config'<br />
<br />
Is this what you want?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">15th February 2004, 15:16</div></div><div class="posttext">Maybe at least you (o_owd) can answer Joost's question.<br />
<br />
Can you check the registry keys used by this [GetWindowsVersion] function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">VegetaSan</div><div class="date">15th February 2004, 15:34</div></div><div class="posttext">Just go to <br />
<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=531&amp;instances=0<br />
<br />
My Script :) :) :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">15th February 2004, 15:37</div></div><div class="posttext">Originally posted by deguix <br />
Maybe at least you (o_owd) can answer Joost's question.  <br />
<br />
i am working on it. i am checking. there's no need to jump up (deguix)...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">15th February 2004, 17:05</div></div><div class="posttext">Originally posted by VegetaSan <br />
Just go to <br />
<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=531&amp;instances=0<br />
<br />
My Script :) :) :)  <br />
<br />
The link is wrong. Is going to NSIS Archive but not showing any page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">VegetaSan</div><div class="date">15th February 2004, 20:30</div></div><div class="posttext">Just go to the NSIS Archive and search for <br />
author &quot;VegetaSan&quot; and look for Windows Decection</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th February 2004, 20:48</div></div><div class="posttext">There is already a Windows version detection function available. There is no need to create duplicate things.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">VegetaSan</div><div class="date">15th February 2004, 20:50</div></div><div class="posttext">Sorry didnt knew</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pgpatron</div><div class="date">16th February 2004, 19:19</div></div><div class="posttext">I know it is not the same thing but I have a extrange problem with that function. I am trying to use the GetWindowsVersion updated by Joost:<br />
<br />
I enclosed it to my install script and I have been trying it only in w2000. It runs ok. It returns '2000' correctly. <br />
<br />
But now, I start to work in the links for my program for the start menu folder.<br />
<br />
I added the registry key:<br />
!define MUI_STARTMENUPAGE_REGISTRY_ROOT &quot;HKCU&quot;<br />
!define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;Software\${GROUP}\${APPNM}&quot;<br />
!define MUI_STARTMENUPAGE_REGISTRY_VALUENAME &quot;Start Menu Folder&quot;<br />
as it is shown in the startmenu.nsi example<br />
and the GetWindowsVersion returns '' now!!<br />
<br />
I have been doing some test and if I comment the last <br />
!define the GetWindowsVersion returns again '2000'.<br />
<br />
Can you tell me why?<br />
<br />
Thanks.<br />
<br />
Pedro</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th February 2004, 20:30</div></div><div class="posttext">That should have nothing to do with this function.<br />
<br />
Please attach a script that can be compiled on every system and reproduces this behavior.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">17th February 2004, 20:49</div></div><div class="posttext">well, i do not understand why it does not work.<br />
<br />
a strange thing i noticed : i tested with my script (lets say &quot;prog1&quot;) and it does not work. i created a new script that containes only GetWindowsVersion (&quot;prog2&quot;). i tested it (prog2) and, of course it works. but!!! after that i tested again my script (prog1) and it works too.<br />
<br />
i don't know if you understand me, but i simply don't get it. maybe it's something that i don't see, something very simple. i run prog1 and it does not work. then i run prog2 - it works - and after that prog1 works too !?!<br />
<br />
the whole script it's attached. :cry:<br />
thanks.<br />
<br />
PS: thanks Joost Verburg, pgpatron (i cannot reproduce that), VegetaSan, deguix,  kichik, and all the others. thanks for your help and support, sorry for being sometimes a pain in the a.. .</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">18th February 2004, 07:54</div></div><div class="posttext">Can you please attach a script that compiles on every system? I can't test this one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">18th February 2004, 11:39</div></div><div class="posttext">Try to use dumpstate::debug before and after you call the function and after you pop a variable from stack (You can find that in the Archive -&gt; Downloads section), and say the results it give.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">18th February 2004, 17:09</div></div><div class="posttext">thanks deguix! this really helped me.<br />
<br />
i will attach a &quot;smaller&quot; script that should compile on every system. you only need dumpstate from the arhive. the link is above.<br />
<br />
the first time i run it, it does not work.<br />
if i run it again it works.<br />
<br />
please tell me if you can reproduce this.<br />
<br />
thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">18th February 2004, 18:11</div></div><div class="posttext">What about a single GetWindowsVersion call? Does that work?<br />
<br />
If it does the problem is related to something else.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Freezerman350</div><div class="date">20th July 2004, 21:16</div></div><div class="posttext">SetOutPath &quot;$INSTDIR\dataeasydeal&quot;<br />
    File &quot;dataeasydeal\data.mdb&quot;<br />
    File &quot;dataeasydeal\dealerinf.mdb&quot;<br />
    File &quot;dataeasydeal\rsharedveh.mdb&quot;<br />
<br />
    ;==================PARTAGE VÉRIF WIN==========================<br />
     StrCpy $1 &quot;$windir&quot;<br />
     IfFileExists &quot;$1\winver.exe&quot; +2<br />
     StrCpy $1 &quot;$sysdir&quot;<br />
     GetDllVersion &quot;$1\winver.exe&quot; $R0 $R1<br />
     IntOp $R2 $R0 / 0x00010000<br />
     IntOp $R3 $R0 &amp; 0x0000FFFF<br />
     IntOp $R4 $R1 / 0x00010000<br />
     IntOp $R5 $R1 &amp; 0x0000FFFF<br />
     StrCpy $0 &quot;$R2.$R3.$R4.$R5&quot;<br />
<br />
     StrCmp $0 '5.1.2600.0' WinXP NotWinXP<br />
     WinXP:<br />
     messagebox mb_ok &quot;Ver = XP&quot;<br />
     nsExec::Exec 'net share dataeasydeal=c:\dataeasydeal'<br />
     NotWinXP:<br />
<br />
     StrCmp $0 '4.0.1381.336' WinNT NotWinNT<br />
     WinNT:<br />
        messagebox mb_ok &quot;Ver = NT&quot;<br />
     NotWinNT:<br />
<br />
     StrCmp $0 '5.0.2195.6703' Win2000 NotWin2000<br />
     Win2000:<br />
        messagebox mb_ok &quot;Ver = 2000&quot;<br />
     NotWin2000:<br />
<br />
     StrCmp $0 '5.2.3790.0' Win2003 NotWin2003<br />
     Win2003:<br />
        messagebox mb_ok &quot;Ver = 2003&quot;<br />
     NotWin2003:<br />
<br />
     StrCmp $0 '4.10.0.2222' Win98 NotWin98<br />
     Win98:<br />
        messagebox mb_ok &quot;Ver = 98&quot;<br />
     NotWin98:<br />
<br />
     ; 2003 = 5.2.3790.0<br />
     ;   XP = 5.1.2600.0<br />
     ;   2K = 5.0.2195.6703<br />
     ;   NT = 4.0.1381.336<br />
     ;   ME = 4.90.0.3000<br />
     ; 98SE = 4.10.0.2222<br />
     ;   98 = 4.10.0.1998<br />
     ; 95S2 = ???<br />
     ;   95 = 4.00.950</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>