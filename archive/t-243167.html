<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to get what files to install on compile time?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to get what files to install on compile time? NSIS Discussion" />
	
	<title> How to get what files to install on compile time? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to get what files to install on compile time?</div>
<hr />
<div class="pda"><a href="t-243167.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=243167">How to get what files to install on compile time?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">11th April 2006, 10:11</div></div><div class="posttext">Hi...I stopped using NSIS about an year ago. I know that then it was not possible to define in an .ini file which files the NSIS executable should contain.<br />
So, my question is this: Is it possible to tell the NSIS compiler to get the files from an .ini file.<br />
I want to have a generic setup script to install some patches for my application. And because different patches may contain different files, I do not want to be forced to reedit the script when those files change. I want just to edit an .ini file and the NSIS compiler should look at that file and get from there the files.<br />
Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th April 2006, 10:33</div></div><div class="posttext">http://nsis.sourceforge.net/Invoking_NSIS_run-time_commands_on_compile-time<br />
<br />
Create another NSIS installer which is executed at compile time to use ReadINIStr and write a list of NSIS File instructions in a seperate .nsi file which is later !include-d by the main .nsi script.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">11th April 2006, 10:43</div></div><div class="posttext">Thank you. I will try that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th April 2006, 11:51</div></div><div class="posttext">If you're going to use Afrow's RecFind (http://nsis.sourceforge.net/RecFind:_Recursive_FindFirst%2C_FindNext%2C_FindClose) you'll make your life easy. :-)<br />
<br />
1. Create the header<br />
 !define PatchDir 'D:\Patch1'<br />
!define Header 'Patch1_Files.nsh'<br />
<br />
OutFile 'CreateHeader.exe'<br />
<br />
!include RecFind.nsh<br />
<br />
Section<br />
  SetOutPath '$EXEDIR'<br />
  FileOpen $R2 ${Header} w<br />
  ${RecFindOpen} &quot;${PatchDir}&quot; $R0 $R1<br />
  ${RecFindFirst}<br />
  FileWrite $R2 'File &quot;${PatchDir}$R0\$R1&quot;$\r$\n'<br />
  ${RecFindNext}<br />
  ${RecFindClose}<br />
  FileClose $R2<br />
SectionEnd <br />
2. Create your Installation<br />
!define Header 'Patch1_Files.nsh'<br />
!system CreateHeader.exe<br />
!include ${Header}<br />
This way you only need to edit the two defines each time you  want to add a new patch. :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th April 2006, 12:20</div></div><div class="posttext">Nice script Red Wine!<br />
Just one thing though,<br />
<br />
!include ${Header}<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Chilli24</div><div class="date">11th April 2006, 12:49</div></div><div class="posttext">Thank you. I am glad that there is a solution for my problem. I will try to do this a.s.a.p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th April 2006, 12:59</div></div><div class="posttext">@ Stu<br />
hmm a typo! that's me! :-)<br />
<br />
@ Chilli24<br />
to include subdirs as well place the line bellow under   ${RecFindOpen} &quot;${PatchDir}&quot; $R0 $R1:<br />
FileWrite $R2 'SetOutPath &quot;$$INSTDIR$R0&quot;$\r$\n'<br />
Section<br />
  SetOutPath '$EXEDIR'<br />
  FileOpen $R2 ${Header} w<br />
  ${RecFindOpen} &quot;${PatchDir}&quot; $R0 $R1<br />
   FileWrite $R2 'SetOutPath &quot;$$INSTDIR$R0&quot;$\r$\n'<br />
  ${RecFindFirst}<br />
   FileWrite $R2 'File &quot;${PatchDir}$R0\$R1&quot;$\r$\n'<br />
  ${RecFindNext}<br />
  ${RecFindClose}<br />
  FileClose $R2<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">11th April 2006, 14:51</div></div><div class="posttext">Just posted an article at wiki (http://nsis.sourceforge.net/One_Installer_with_Different_Installation_Files_Each_Time)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">12th April 2006, 00:55</div></div><div class="posttext">It is also possible to compile and run a premade script from your installer at compile time:!define PatchType 'Patch1_Files'<br />
!define PatchPath 'C:\${PatchType}' <br />
<br />
!system '&quot;${NSISDIR}\makensis.exe&quot; /D PatchDir &quot;${PatchPath}&quot; /D Header &quot;${PatchType}&quot; &quot;CreateHeader.nsi&quot;'<br />
!system 'CreateHeader.exe'<br />
<br />
Section<br />
!include '${PatchType}.nsh'<br />
SectionEndCreateHeader.nsi contains the code above by Red Wine, and remove the top two lines of the script as they are defined on the command line :). Now all you have to change is the patch type at the top of my script :).<br />
Typo: 'bellow' is spelled 'below' :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">12th April 2006, 04:04</div></div><div class="posttext">Sorry, just found an error: forgot the extenstion on the command line.<br />
!define PatchType 'Patch1_Files'<br />
!define PatchPath 'C:\${PatchType}' <br />
<br />
!system '&quot;${NSISDIR}\makensis.exe&quot; /D PatchDir &quot;${PatchPath}&quot; /D Header &quot;${PatchType}.nsh&quot; &quot;CreateHeader.nsi&quot;'<br />
!system 'CreateHeader.exe'<br />
<br />
Section<br />
!include '${PatchType}.nsh'<br />
SectionEnd<br />
Just ran out of time to edit my post, so I replied again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">12th April 2006, 14:18</div></div><div class="posttext">@ Jason<br />
I really appreciate your notice for my spelling, though, don't expect I will not do it again.:-)<br />
If you don't mind, please contribute your extension on the above mentioned article (http://nsis.sourceforge.net/One_Installer_with_Different_Installation_Files_Each_Time) <br />
regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">JasonFriday13</div><div class="date">12th April 2006, 23:22</div></div><div class="posttext">Will do.  Done.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>