<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Text Box, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Text Box NSIS Discussion" />
	
	<title> Text Box [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Text Box</div>
<hr />
<div class="pda"><a href="t-287631.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=287631">Text Box</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">csquared</div><div class="date">26th February 2008, 21:46</div></div><div class="posttext">I have searched the forums for this but have not found something that works.   I have a custom page that has a text box in it, Field 4.  I want to read from the user's registry and insert a value into this text box.  The reading from the registry appears to be working but the writing to the text box appears not to be working.  I have tried the following:<br />
<br />
ReadRegStr $DatabaseServer HKLM &quot;SOFTWARE\test&quot; &quot;TestServer&quot;<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;DatabaseLogin.ini&quot; &quot;Field 4&quot; &quot;State&quot; $DatabaseServer<br />
<br />
----<br />
<br />
ReadRegStr $DatabaseServer HKLM &quot;SOFTWARE\test&quot; &quot;TestServer&quot;<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;DatabaseLogin.ini&quot; &quot;Field 4&quot; &quot;Text&quot; $DatabaseServer<br />
<br />
---<br />
<br />
ReadRegStr $DatabaseServer HKLM &quot;SOFTWARE\test&quot; &quot;TestServer&quot;<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;DatabaseLogin.ini&quot; &quot;Field 4&quot; &quot;State&quot; $DatabaseServer<br />
<br />
----<br />
<br />
WriteINIStr '$PLUGINSDIR\DatabaseLogin.ini' &quot;Field 4&quot; &quot;State&quot; $DatabaseServer<br />
    <br />
<br />
I think it may have to do with where I'm placing it I do not know for sure.  I've tried before and after this section of code:<br />
<br />
 !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;DatabaseLogin.ini&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;DatabaseLogin.ini&quot;<br />
<br />
in my Form show area.  Please let me know if you need more information or if you can help.<br />
Thank you!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">26th February 2008, 23:09</div></div><div class="posttext">are you writing this to the ini-file before displaying the page?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">csquared</div><div class="date">27th February 2008, 04:55</div></div><div class="posttext">I don't know 100% what you mean.  I have done it before and after I call the function for the page and before and after this line and it has made no difference.  Can you maybe clarify more?<br />
<br />
 !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;DatabaseLogin.ini&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">27th February 2008, 06:09</div></div><div class="posttext">Just 3 steps:<br />
1st extract the INI<br />
2nd modify it<br />
3rd display it</div></div><hr />


<div class="post"><div class="posttop"><div class="username">csquared</div><div class="date">27th February 2008, 06:31</div></div><div class="posttext">Right after the extract I tried setting the value and it still did not work.  I have no clue what I'm doing wrong.  When I go to the page that should have the value change it still says the default value.  Here is what I tried:<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;DatabaseLogin.ini&quot;<br />
<br />
!insertmacro MUI_INSTALLOPTIONS_WRITE &quot;DatabaseLogin.ini&quot; &quot;Field 4&quot; &quot;State&quot; &quot;Hello&quot;<br />
        <br />
WriteINIStr '$PLUGINSDIR\DatabaseLogin.ini' &quot;Field 4&quot; &quot;State&quot; &quot;test&quot;<br />
<br />
WriteINIStr '$PLUGINSDIR\DatabaseLogin.ini' &quot;Field 4&quot; &quot;Text&quot; &quot;test2&quot;<br />
<br />
None of the values were in the text box as I would have expected.  Just 127.0.0.1 was in the text box which is the default value that I set when creating the text box on the page.<br />
<br />
Thank you!  Sorry I'm having such a hard time with this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">27th February 2008, 07:33</div></div><div class="posttext">outfile test.exe<br />
showinstdetails show<br />
<br />
!include winmessages.nsh<br />
<br />
Page license<br />
Page custom CreateCustom<br />
page Instfiles<br />
<br />
Function CreateCustom<br />
InitPluginsDir<br />
WriteINIStr &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;1&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Field 1&quot; &quot;Type&quot; &quot;Text&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Field 1&quot; &quot;Top&quot; &quot;59&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Field 1&quot; &quot;Bottom&quot; &quot;-59&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Field 1&quot; &quot;Left&quot; &quot;20&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Field 1&quot; &quot;Right&quot; &quot;-20&quot;<br />
WriteINIStr &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Field 1&quot; &quot;State&quot; &quot;Hello, I am a text field.&quot;<br />
<br />
push $0<br />
InstallOptions::InitDialog /NOUNLOAD &quot;$PLUGINSDIR\Cust.ini&quot;<br />
ReadRegStr $R0 HKLM &quot;SOFTWARE\NSIS&quot; &quot;&quot;<br />
messagebox mb_ok &quot;$R0&quot;<br />
ReadINIStr $R1 &quot;$PLUGINSDIR\Cust.ini&quot; &quot;Field 1&quot; &quot;hwnd&quot;<br />
SendMessage $R1 ${WM_SETTEXT} 0 &quot;STR:$R0&quot;<br />
<br />
pop $0<br />
InstallOptions::Show &quot;$PLUGINSDIR\Cust.ini&quot;<br />
pop $0<br />
pop $0<br />
FunctionEnd<br />
<br />
<br />
section<br />
<br />
sectionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">csquared</div><div class="date">27th February 2008, 15:00</div></div><div class="posttext">In order for this to work, do I have to create the INI file in the fly like you did?  I think my issue is that I have created the ini file in a separate file already with a GUI editor in Eclipse, and I'm calling and using that.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">csquared</div><div class="date">27th February 2008, 15:25</div></div><div class="posttext">Here is what I have maybe this will help.<br />
<br />
My DatabaseLogin.ini file<br />
<br />
[Settings]<br />
NumFields=7<br />
<br />
[Field 1]<br />
Type=Label<br />
Left=41<br />
Top=49<br />
Right=101<br />
Bottom=58<br />
Text=Database Server:<br />
<br />
[Field 2]<br />
Type=Label<br />
Left=41<br />
Top=66<br />
Right=112<br />
Bottom=75<br />
Text=Database Username:<br />
<br />
[Field 3]<br />
Type=Label<br />
Left=41<br />
Top=84<br />
Right=112<br />
Bottom=94<br />
Text=Database Password:<br />
<br />
[Field 4]<br />
Type=Text<br />
Left=120<br />
Top=46<br />
Right=252<br />
Bottom=59<br />
State=127.0.0.1<br />
<br />
[Field 5]<br />
Type=Text<br />
Left=120<br />
Top=64<br />
Right=252<br />
Bottom=77<br />
State=sa<br />
<br />
[Field 7]<br />
Type=Label<br />
Left=41<br />
Top=15<br />
Right=228<br />
Bottom=38<br />
Text=Please enter your database connection information below.<br />
[Field 6]<br />
Type=Password<br />
Left=120<br />
Top=82<br />
Right=252<br />
Bottom=95<br />
<br />
<br />
Installer Code - I kind of chopped it up a little so some basic stuff may be missing.<br />
<br />
ReserveFile &quot;DatabaseLogin.ini&quot;<br />
<br />
!insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
; The name of the installer<br />
Name &quot;Installer&quot;<br />
<br />
; The file to write<br />
OutFile &quot;setup.exe&quot;<br />
<br />
; The default installation directory<br />
InstallDir &quot;C:\Installer&quot;<br />
<br />
;Uninstall mode<br />
!insertmacro UNATTENDED_UNINSTALL<br />
<br />
; Pages<br />
!insertmacro MUI_PAGE_WELCOME<br />
Page custom SQLLoginInfoShow SQLLoginInfoLeave<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
;Page components<br />
<br />
## Languages<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
; Variables<br />
var InstallSQL<br />
var DatabaseServer<br />
var DatabaseUsername<br />
var DatabasePassword<br />
var Upgrade<br />
<br />
UninstPage uninstConfirm<br />
UninstPage instfiles<br />
<br />
;--------------------------------<br />
<br />
Function .onInit<br />
    Call CheckIISVersion    <br />
FunctionEnd<br />
<br />
Function SQLLoginInfoShow<br />
    ${if} $InstallSQL == 1<br />
        Abort<br />
    ${Endif}  <br />
    <br />
    WriteINIStr '$PLUGINSDIR\DatabaseLogin.ini' &quot;Field 4&quot; &quot;State&quot; &quot;blah&quot;<br />
    <br />
    !insertmacro MUI_HEADER_TEXT &quot;Database Login Information&quot; &quot;Please enter your database login inforation below.&quot;<br />
    ;ReserveFile &quot;DatabaseLogin.ini&quot;<br />
    <br />
    !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;DatabaseLogin.ini&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;DatabaseLogin.ini&quot;<br />
    <br />
    <br />
FunctionEnd<br />
<br />
Function SQLLoginInfoLeave<br />
    readinistr $DatabaseServer '$PLUGINSDIR\DatabaseLogin.ini' 'Field 4' 'State'<br />
    readinistr $DatabaseUsername '$PLUGINSDIR\DatabaseLogin.ini' 'Field 5' 'State'<br />
    readinistr $DatabasePassword '$PLUGINSDIR\DatabaseLogin.ini' 'Field 6' 'State'<br />
    ;check to make sure they can login to the db provided<br />
    MSSQL_OLEDB::SQL_Logon /NOUNLOAD &quot;$DatabaseServer&quot; &quot;$DatabaseUsername&quot; &quot;$DatabasePassword&quot;<br />
    pop $0<br />
    ${if} $0 == 1<br />
        ;Error connecting to SQL Database<br />
        pop $0<br />
        MSSQL_OLEDB::SQL_GetError /NOUNLOAD<br />
        Pop $0<br />
        Pop $0<br />
        MessageBox MB_OK $0<br />
        Abort<br />
    ${Endif}<br />
    <br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">27th February 2008, 16:01</div></div><div class="posttext">Of course there's no need to create the INI on the fly, I did so just for convenience.<br />
Taking a look at your code,<br />
remove the line !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;DatabaseLogin.ini&quot; and add it into function .onInit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">csquared</div><div class="date">27th February 2008, 16:19</div></div><div class="posttext">Awesome!  that was it.  Thank you and sorry I was difficult :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>