<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Billboarding images, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Billboarding images NSIS Discussion" />
	
	<title> Billboarding images [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Billboarding images</div>
<hr />
<div class="pda"><a href="t-291815.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291815">Billboarding images</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">xplct0</div><div class="date">15th May 2008, 01:40</div></div><div class="posttext">Newbie question #2:<br />
<br />
I am interested in placing marketing images during program installation.  As of now, to simply display images, I am making use of<br />
http://nsis.sourceforge.net/ModernUI_Mod_to_Display_Images_while_installing_files<br />
<br />
And the process by which I am billboarding is as follows:<br />
<br />
!insertmacro DisplayImage 'c:\Bilboard0.bmp'<br />
CopyFiles /SILENT 'C:\Users\david.DOMAIN\Desktop\COMPANY\Main\Build\Sound\01\*' &quot;$INSTDIR\Sound&quot;<br />
<br />
!insertmacro DisplayImage 'c:\Bilboard1.bmp'<br />
CopyFiles /SILENT 'C:\Users\david.DOMAIN\Desktop\COMPANY\Main\Build\Sound\02\*' &quot;$INSTDIR\Sound&quot; <br />
<br />
So my question is related to the process by which these files should be split apart.  As far as I understand, the function CopyFiles makes use of os functionality to literally copy files from location A to location B.  If I am wrong in this respect, is it possible for me to register some sort of callback for notification on events ( FunctionCallOnTenPercentComplete() ), or maybe even a callback that gets called on some sort of interval( FunctionCallOncePerFrame() or FunctionCallOnceEveryTenSeconds() )?  <br />
Ideally, I would like to examine the copy progress of an entire directory, and display a billboard based on a percentage completed.<br />
<br />
Option number 2, is to dynamically figure out how to subdivide our assets into temp folders of specified size, and somehow automate the setup in NSIS.  I really need some advice on how to best accomplish this if anyone would be so kind, because I'm willing to bet I'm missing the practical option here.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th May 2008, 18:21</div></div><div class="posttext">I know no available solution but to manually split.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xplct0</div><div class="date">17th May 2008, 00:24</div></div><div class="posttext">Alrighty, thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xplct0</div><div class="date">19th May 2008, 22:18</div></div><div class="posttext">I noticed that you are able to make win32 dll calls.  I'm looking at solving this issue by making use of CopyFilesEx.<br />
<br />
CopyFileEx Function:<br />
Copies an existing file to a new file, notifying the application of its progress through a callback function. <br />
<br />
But first I'm having some issues figuring out how to manually call functions in general.  I'm starting out with duplicating the functionality of MessageBox, but I've run into a few quirks.<br />
<br />
Here's the function definition:<br />
int MessageBox( HWND hWnd, // handle to owner window<br />
<br />
              LPCTSTR lpText, // text in message box<br />
<br />
              LPCTSTR lpCaption, // message box title<br />
<br />
              UINT uType // message box style );<br />
<br />
<br />
And here's my attempt to invoke it from NSIS:<br />
<br />
strcpy $R0 &quot;title&quot;<br />
strcpy $R1 &quot;text&quot;<br />
System::Call &quot;user32::MessageBoxA(i, t, t, i) (0, $R0, $R1, 1)&quot;<br />
<br />
The message box pops up, however both the title and the text are empty.  I'm not sure if &quot;&quot; automatically appends '\0'.  On the same note, I'm not sure what NSIS uses for NULL.<br />
<br />
Looking through the tutorial, I find myself very confused about:<br />
System::Call 'YourDllName::YourDllFunction(i, *i, t) i(.r0, r1, .r2) .r3'<br />
<br />
I haven't seen anything in the documentation that says what '.r0' means.  (I know what $r0 is...)<br />
<br />
I'm doubly confused when later, we see the example:<br />
(function definition)<br />
int CmGetHotSyncExecPath(TCHAR *pPath, int *piSize);<br />
(nsis declaration)<br />
CmGetHotSyncExecPath(t, *i) i<br />
(nsis invocation)<br />
System::Call 'CondMgr::CmGetHotSyncExecPath(t, *i) i(.r0, r1r1).r2'<br />
<br />
What is r1r1???  And once again, what is '.r0'?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xplct0</div><div class="date">19th May 2008, 22:21</div></div><div class="posttext">Here's the link for the above example:<br />
http://nsis.sourceforge.net/Calling_an_external_DLL_using_the_System.dll_plugin#Using_System.dll::Call</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xplct0</div><div class="date">20th May 2008, 04:06</div></div><div class="posttext">If anyone is interested, I found a way to display images based on a %copy complete (of single files).  This is just sandbox code, but here's the entire script:<br />
<br />
<br />
!include 'MUI.nsh'<br />
!include 'Image.nsh'<br />
<br />
!define AppName `Sand`<br />
Name '${AppName}'<br />
OutFile 'Sandbox.exe'<br />
InstallDir '$PROGRAMFILES\${AppName}'<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
#Dumpstate::debug<br />
# Fix the rukus vista has been causing with shortcut removals.<br />
RequestExecutionLevel admin<br />
<br />
Section 'CD_ONE'<br />
    <br />
    strcpy $9 'ladeda'<br />
    SetPluginUnload alwaysoff<br />
    System::Get &quot;(l,l.R1,l,l,i,i,i,i,i)isr1&quot;<br />
    pop $0<br />
    System::Call 'kernel32::CopyFileEx(t &quot;c:\from\test.txt&quot;, t &quot;c:\to\test.txt&quot;,k r0,i,i,i)i.r9'<br />
    <br />
    loop:<br />
        StrCmp $1 &quot;callback1&quot; 0 done<br />
    <br />
        IntCmp $R1 40000000 0 lessthan40mb morethan40mb<br />
        lessthan40mb:<br />
          strcmp $9 '0' doneCmp +1<br />
          !insertmacro DisplayImage 'c:\Bilboard0.bmp'<br />
          strcpy $9 '0'<br />
          Goto doneCmp<br />
          <br />
        morethan40mb:<br />
          strcmp $9 '1' doneCmp +1<br />
          !insertmacro DisplayImage 'c:\Bilboard1.bmp'<br />
          strcpy $9 '1'<br />
          Goto doneCmp<br />
        doneCmp:<br />
        <br />
        Push 0 # return value of the callback<br />
        StrCpy $1 &quot;&quot; # clear $R0 in case there are no more callback calls<br />
        System::Call $0 # tell system to return from the callback<br />
        <br />
        Goto loop<br />
    done:<br />
    SetPluginUnload manual<br />
    System::Free $0<br />
 <br />
SectionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>