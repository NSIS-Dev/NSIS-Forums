<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" exDll with MFC Support, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  exDll with MFC Support NSIS Discussion" />
	
	<title> exDll with MFC Support [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  exDll with MFC Support</div>
<hr />
<div class="pda"><a href="t-245706.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=245706">exDll with MFC Support</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Netdiver030</div><div class="date">8th May 2006, 18:45</div></div><div class="posttext">Has anyone a template that can be linked? (XP &amp; VC7)<br />
I stumbled around for a long time and read a lot of threads.<br />
C++ is not the issue, but using normal Mfc functions like registry and other bumpf behind it would be a nice feature.<br />
<br />
NetDiver030</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th May 2006, 20:16</div></div><div class="posttext">Doesn't creating MFC DLL with the VC wizards work? That should be enough, I think. If not, probably some MFC initialization functions must be called.<br />
<br />
But I'd highly recommend you don't create plug-ins using MFC. Using MFC to create plug-ins would require any installer using them to install the MFC runtimes before it could even start running.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">8th May 2006, 20:38</div></div><div class="posttext">unless you linked statically the runtimes :\</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Netdiver030</div><div class="date">9th May 2006, 06:04</div></div><div class="posttext">Unfortunately the normal VC wizard MFC Dll as a PlugIn Dll does not work.<br />
Only the calling of my MfcStuffDll functions via System::Call works fine. But as far as I get it this requires that my MfcStuffDll is installed first.<br />
<br />
Or is there a way to use my dll from within the installer archive? - I haven't look too closely at the usage of temporary files. Maybe that way.<br />
Or has anyone an exDll example with mfc support?<br />
<br />
(static linking. Currently there is enough discspace to waste for this project :-) )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th May 2006, 13:05</div></div><div class="posttext">How do you pass the stack pointer and the variables pointer using System::Call? Have you used the correct function parameters for the functions you wish the export? What about the calling convention?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Netdiver030</div><div class="date">9th May 2006, 14:26</div></div><div class="posttext">Thanks for your support so far.<br />
<br />
Your hint with the system::call function was very helpful.<br />
I found a workaround which is fine for me because my software requires administrator priviliges anyway.<br />
<br />
I just stuffed all my MFC code in an ordinary MFC Dll.<br />
And in the init part of my installer script I install this dll in the system32 folder. Than I call my mfc functions and retrieve my system analysis and after that I remove the temporarly installed Dll from system32 and continue with the installation of the software.<br />
Works fine - but like I mentioned only for installations with administrator prviliges.<br />
<br />
Btw. I tried the normal calling convention from the exDll example: <br />
MyDll:MyFunction ...<br />
on the MFC Dll.<br />
<br />
Now I use the <br />
System::Call &quot;MyDll::MyCheck()i().r0&quot;<br />
to find out if some things.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th May 2006, 14:43</div></div><div class="posttext">That's not the calling convention I'm talking about. I'm talking about __stdcall and __cdecl. I'm talking about how you define the function in your DLL. Its header should look exactly like the functions in exdll.c, except the name. If not, you won't be able to call them the script like a normal plug-in and you'll have to use the System plug-in. Judging by the System call that does work for you, you've got the wrong function header.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>