<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Customizing File command?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Customizing File command? NSIS Discussion" />
	
	<title> Customizing File command? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Customizing File command?</div>
<hr />
<div class="pda"><a href="t-322324.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=322324">Customizing File command?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">siggel</div><div class="date">10th September 2010, 08:37</div></div><div class="posttext">Hi all,<br />
I have some quite complicated requirements for using the File command, in order to overwrite program files, but not overwrite configuration etc. Unfortunately I don't even know which files are contained, but I know, that such configuration files end on e.g. .cfg Therefore I need to use /r instead of specifying each file separately.<br />
<br />
Overwriting the program files is quite easy:<br />
File /nonfatal /r /x *.cfg patch\partA\*.*<br />
<br />
But for the *.cfg files I'd like to check whether they already exist, differ and take according actions like putting a file aside the existing one with &quot;.new&quot; appended to the name. And a summary file would be fine, so when running silently the user has a chance to know, which files need to be checked.<br />
<br />
My first idea would be to unpack them to another location and implement my own script for diffing etc. Does that sound reasonable or are there macros available already for things like that. Or maybe can I implement a &quot;custom&quot; SetOverwrite mode?<br />
<br />
Thx<br />
siggel<br />
<br />
PS: I have no influence on the incoming files, so I have no chance to do more sophisticated patching. Just in case you wonder...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">10th September 2010, 09:07</div></div><div class="posttext">The File command itself can't really be extended/customized for this purpose.<br />
You're on the right track with extracting to a separate location, then enumerating the files extract, and using CopyFiles conditionally, as that is what gives you access to details about the source files, and the destination files (if existing).<br />
<br />
Can't say there's an existing library.  I started one a while back but realized that for a custom project it's pretty simple.. but for a generic solution you run into a whole host of problems stemming directly from the File command's complexity.<br />
I.e. if you create a macro to wrap the File command, you'll either need separate macros for File /x, File /r, File /r /x, etc. or have a single Macro but with optional flags for everything; which would often go un-used.. meaning that a user's script might look like `${File} SomeFile.ext &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;`<br />
<br />
The way I started to solve that was using context defines.. e.g.<br />
!define file.recursive<br />
!define file.exclude *.svn<br />
${File} &quot;somefolder\*.*&quot;<br />
<br />
Where the defines would cause the actual File command being used to be `File /r /x *.svn &quot;somefolder\*.*&quot;`<br />
But I'm not really working too actively on it.<br />
<br />
Ideally the File command would trigger callbacks with some filled variables.. one before writing a file (so that you can Abort it if you decide not to write out the file), and one after writing it (so that you can perform logging or whatever, for use with /r mostly).<br />
<br />
The other option that is generally used is to generate a file using another utility (or even another NSIS installer) that has single commands for each individual file - essentially replacing /r in a way - for inclusion in your main installer.  You could use that to generate a more complex variant (wrapping the config files with a ${Unless} ${FileExists}) as well.  Never been fond of that route, myself, though :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>