<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" ExecWait failing 10% of the time, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  ExecWait failing 10% of the time NSIS Discussion" />
	
	<title> ExecWait failing 10% of the time [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  ExecWait failing 10% of the time</div>
<hr />
<div class="pda"><a href="t-283356.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=283356">ExecWait failing 10% of the time</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">fifthnormal</div><div class="date">18th December 2007, 03:38</div></div><div class="posttext">Hi,<br />
<br />
I have an installer that's executed about 1000 times per day.<br />
<br />
I bundle three sub installers within the main installer, kind of like this:<br />
<br />
MainInstall.exe<br />
--SubInstall1.exe<br />
--SubInstall2.exe<br />
--SubInstall3.exe<br />
<br />
My script uses NSISdl to log data to my web server so that I know how many times the installer is run.<br />
<br />
I send a log message from within MainInstall.exe right before I call ExecWait SubInstall1.exe. <br />
<br />
Then when SubInstall1.exe runs it uses NSISdl to log to the web server that it started running.<br />
<br />
The logs show that ~10% of the time MainInstall.exe launches SubInstall1.exe, but SubInstall1.exe doesn't log that it started up. <br />
<br />
I'm curious if anyone knew of any reasons that this might be occurring. <br />
<br />
Thanks in advance,<br />
<br />
Daniel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">18th December 2007, 06:24</div></div><div class="posttext">Hi Daniel, it seems that my installers has similar problems with ExecWait instruction.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th December 2007, 19:16</div></div><div class="posttext">Are you sure it's not just some packet loss or firewall blocking the request? Can you really be sure SubInstall1.exe hasn't been executed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fifthnormal</div><div class="date">18th December 2007, 19:46</div></div><div class="posttext">Hi kichik,<br />
<br />
I can rule out a firewall issue since we are logging so much data through the install. All of it is being logged correctly in other parts of the installer. So, this should rule out the firewall as an issue.<br />
<br />
I suppose a packet loss might be a possible issue. However since it is being run across almost 1000 computers per day I would expect the packet loss to be a much smaller percentage. <br />
<br />
Also, each SubInstaller contains other logging by third-party vendors which correspond with our data. <br />
<br />
Here are the relevant lines of code from the Main Installer. Note that I changed the url.<br />
<br />
#Install the Weather Partner - Begin<br />
NSISdl::download &quot;http://base.fakeurl.com/logImage.php?t=8&amp;c=6&amp;a=8&amp;b=0&amp;display=0&amp;e=Main%20Install%20Weather%20Start&quot; $INSTDIR\logging<br />
<br />
ExecWait '&quot;$INSTDIR\weather_install.exe&quot;'<br />
<br />
NSISdl::download &quot;http://base.fakeurl.com/logImage.php?t=8&amp;c=6&amp;a=8&amp;b=0&amp;display=0&amp;e=Main%20Install%20Weather%20Finish&quot; $INSTDIR\logging<br />
#Install the Weather Partner - End<br />
<br />
This actually launches the weather.com installer that you helped me with a few weeks ago. <br />
<br />
Thanks for any help!<br />
<br />
Daniel</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th December 2007, 21:48</div></div><div class="posttext">Are you sure all of the installers use the same download method? Maybe some methods have different proxy detections than others. What do the other installers use?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fifthnormal</div><div class="date">18th December 2007, 23:36</div></div><div class="posttext">Hi kichik,<br />
<br />
Yes they all use the same code. Here is the code from the weather_install.exe nsis installer:<br />
<br />
Function .onInit<br />
<br />
	InitPluginsDir<br />
<br />
	NSISdl::download &quot;http://base.fakeurl.com/logImage.php?t=8&amp;c=6&amp;a=8&amp;b=0&amp;display=0&amp;e=Weather%20Install%20Initializing&quot; $INSTDIR\logging<br />
<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th December 2007, 19:13</div></div><div class="posttext">If it's constantly just SubInstall1.exe, I have no other suggestions but a bug in its .onInit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th December 2007, 21:21</div></div><div class="posttext">My first thought here is what is $INSTDIR set to?<br />
If the folder does not exist then NSISdl would fail in theory.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">fifthnormal</div><div class="date">20th December 2007, 05:10</div></div><div class="posttext">Hi Afrow UK,<br />
<br />
I've done some more testing and can replicate it now in the lab. This has turned out to be an issue with the NSISdl rather than ExecWait. The SubInstall1.exe was running, but the logging within the onInit was not occurring 10% of the time.<br />
<br />
This was actually due to a bug in my script. In some cases the $INSTDIR does not exist at the time the SubInstall1.exe initializes. Thus causing the initialize logging to not happen. Later on in the default section this folder is automatically created, which causes the logging to start working. <br />
<br />
We'll deploy the installer and monitor it for a couple days. I'm anticipating that this fixes the issue though.<br />
<br />
Thanks for the help!<br />
<br />
Daniel</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>