<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Writing a DLL with delphi, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Writing a DLL with delphi NSIS Discussion" />
	
	<title> Writing a DLL with delphi [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Writing a DLL with delphi</div>
<hr />
<div class="pda"><a href="t-173751.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=173751">Writing a DLL with delphi</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">raveolution</div><div class="date">17th March 2004, 21:31</div></div><div class="posttext">Hello,<br />
<br />
I need help for writing a DLL, which checks, if a Process is running. Actually I have the following source, but it is wrong! I hope anyone of you can tell me where the mistake is!?<br />
<br />
library Process;<br />
<br />
uses<br />
  nsis,<br />
  Windows, <br />
  SysUtils, <br />
  Classes, <br />
  TLHelp32;<br />
<br />
{$R *.RES}<br />
<br />
function CheckProcess(const hwndParent: HWND; const string_size: integer; <br />
const variables: PChar; const stacktop: pointer):Integer; cdecl;<br />
var<br />
  hSnap: THandle;<br />
  ProcEntry: TProcessEntry32;<br />
  s,erg: String;<br />
  sl : TStringList;<br />
  i : Integer;<br />
begin<br />
  // set up global variables<br />
  Init(hwndParent, string_size, variables, stacktop);<br />
  GetUserVariable(INST_0);<br />
<br />
  hSnap := CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);<br />
  if (hSnap &lt;&gt; INVALID_HANDLE_VALUE) then<br />
  begin<br />
    sl := TStringList.Create;<br />
    ProcEntry.dwSize := SizeOf(ProcessEntry32);<br />
    if (Process32First(hSnap, ProcEntry)) then<br />
    begin<br />
      s := ProcEntry.szExeFile;<br />
      sl.Add(UPPERCASE(ExtractFileName(s)));<br />
<br />
      while Process32Next(hSnap, ProcEntry) do<br />
      begin<br />
        s := ProcEntry.szExeFile;<br />
        sl.Add(UPPERCASE(ExtractFileName(s)));<br />
      end;<br />
    end;<br />
  end;<br />
<br />
  for i:=0 to sl.Count-1 do<br />
      if UPPERCASE(INST_0) = UPPERCASE(sl.Strings[i]) then<br />
      //--&gt; at this comparison is one of the mistakes, <br />
      //becuase INST_0 is not a String<br />
         erg := '1'<br />
      else<br />
         erg := '0';<br />
<br />
  CloseHandle(hSnap);<br />
  sl.free;<br />
  PushString(erg);<br />
  SetUserVariable(INST_0, erg);<br />
end;<br />
<br />
exports<br />
    CheckProcess;<br />
<br />
begin<br />
<br />
end.<br />
<br />
I hope you can help me! Please do not say, that I should use the Plugin, which is posted here in the forum, because I tried it and it doesn't function. Thats why I decided to wrote my own Plug-In!<br />
<br />
Thank you!<br />
raveolution<br />
<br />
P.S.: I am sorry, if my english is not the best! <br />
:rolleyes:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">18th March 2004, 00:39</div></div><div class="posttext">Here are good Delphi plugin devs...<br />
I'm sure they will help you.<br />
<br />
Now why isn't the plugin working? What's the error?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">raveolution</div><div class="date">18th March 2004, 07:01</div></div><div class="posttext">Thank you for your answer! I found the mistake and now it works fine! ;) I tested it with Win XP Pro and Win ME and there were no problems anymore!<br />
<br />
Bye!<br />
raveolution</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>