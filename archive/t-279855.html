<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Batch file to delete only installed files, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Batch file to delete only installed files NSIS Discussion" />
	
	<title> Batch file to delete only installed files [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Batch file to delete only installed files</div>
<hr />
<div class="pda"><a href="t-279855.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=279855">Batch file to delete only installed files</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">General Barron</div><div class="date">24th October 2007, 08:41</div></div><div class="posttext">Hello all, I'm a little lazy to make a Wiki account at the moment, but I have something here that others might find useful. I'm about to remove it from my HDD, so I thought I'd first post it here for others to use.<br />
<br />
-------<br />
<br />
Here is a windows batch file that is useful for making an uninstaller only delete the files that were added by the installer:<br />
<br />
<br />
@echo off<br />
set _b=%~dp0<br />
<br />
del &quot;%~dp0uninstall_files.nsh&quot;<br />
<br />
::list all files<br />
dir /s /b /a:-d &quot;%~dp0PROJECT&quot; &gt; __temp__<br />
for /f &quot;delims=&quot; %%L in ('type __temp__') do call :delfile %%L<br />
<br />
::list all folders<br />
<br />
echo ;end &gt; __temp2__<br />
type __temp2__ &gt; __temp3__<br />
<br />
dir /s /b /a:d /o:n &quot;%~dp0PROJECT&quot; &gt; __temp__<br />
for /f &quot;delims=&quot; %%L in ('type __temp__') do call :delfolder %%L<br />
<br />
type __temp2__ &gt;&gt; &quot;%~dp0uninstall_files.nsh&quot;<br />
del __temp__<br />
del __temp2__<br />
del __temp3__<br />
exit /b<br />
<br />
<br />
<br />
<br />
:delfile <br />
<br />
set _a=%*<br />
set _a=%_a:*PROJECT\=%<br />
<br />
echo delete &quot;$INSTDIR\%_a%&quot; &gt;&gt; &quot;%~dp0uninstall_files.nsh&quot;<br />
<br />
goto :eof<br />
<br />
<br />
<br />
<br />
:delfolder <br />
<br />
set _a=%*<br />
set _a=%_a:*PROJECT\=%<br />
<br />
::reverse order of our output (add to top of file not bottom)<br />
echo RMDir &quot;$INSTDIR\%_a%&quot; &gt; __temp3__<br />
type __temp2__ &gt;&gt; __temp3__<br />
type __temp3__ &gt; __temp2__<br />
<br />
goto :eof<br />
<br />
<br />
<br />
Here is how to use it:<br />
<br />
-You need to have one big folder that you are installing via the 'file' instruction, including all files and subfolders. The outdir for this file must be the instdir. Let's say it is C:\myprogram.<br />
<br />
-Place the batch file in the parent folder (in our example it would be C:\).<br />
<br />
-Find/replace all of the words PROJECT in the above code, with the name of the folder to be processed (in our example it would be myprogram).<br />
<br />
-Run the batch file. It will create a file called &quot;uninstall_files.nsh&quot;.<br />
<br />
-!include this file in the uninstall section of your .nsi file.<br />
<br />
-------<br />
<br />
Basically, the created .nsh file has a list of 'delete' instructions to delete all files added by the installer. Then it has a bunch of 'rmdir' instructions, to remove all directories, if they are empty.<br />
<br />
It is simple, ugly and inelegant, but it works. Enjoy!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pospec</div><div class="date">24th October 2007, 09:17</div></div><div class="posttext">I use UnList.exe and it works fine. Described here: http://forums.winamp.com/showthread.php?postid=1862656</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">24th October 2007, 20:43</div></div><div class="posttext">You don't need a Wiki account to share. Anyone can create a page.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>