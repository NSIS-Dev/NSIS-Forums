<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Writing to registry becomes terribly slow, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Writing to registry becomes terribly slow NSIS Discussion" />
	
	<title> Writing to registry becomes terribly slow [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Writing to registry becomes terribly slow</div>
<hr />
<div class="pda"><a href="t-351715.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=351715">Writing to registry becomes terribly slow</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zumbo</div><div class="date">9th November 2012, 17:09</div></div><div class="posttext">My installer seems to be &quot;stuck&quot; in the middle of execution for about a minute. Debugging revealed that two harmless looking registry commands each take about 30 seconds:<br />
<br />
WriteRegBin HKLM &quot;SYSTEM\ControlSet001\services\openmapdrive&quot;  &quot;FailureActions&quot; 80510100000000000000000003000000140000000100000060ea000000000000000000000000000000000000<br />
<br />
WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Run&quot; &quot;OpenMapSysTray&quot; &quot;$INSTDIR\drive\OpenmapSystray.exe&quot;<br />
<br />
It only happens when I install a large amount of data (&gt; 100 MB) some lines before. It works fine when I comment out this data, and also if I comment out the two registry commands (previous and subsequent calls to WriteRegStr work OK). I have no idea what could cause these commands to become so slow. Any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th November 2012, 18:34</div></div><div class="posttext">I don't know what might be causing this other than the disk cache forcing the registry be paged out but I do know that writing to ControlSet001 is probably wrong, 99.99% of the time you want the currentcontrolset!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">10th November 2012, 08:11</div></div><div class="posttext">Here's a crazy idea: How about first writing to registry, and then installing the &gt;100MB data files?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zumbo</div><div class="date">12th November 2012, 10:56</div></div><div class="posttext">@Anders: Thanks for pointing out the ControlSet problem. The speed problem, however, can't be caused by the disk cache, since it happens invariably at the same two lines, on different machines, with different memory sizes. It must be caused by some memory problem internal to NSIS. <br />
<br />
@MSG: I tried that as a workaround, but now the installer freezes at the end, that is, the &quot;Finish&quot; button stays grayed out for about 40 seconds, although installation is complete. Which strengthens my suspicion that NSIS has problems handling the memory it has allocated for the 100MB+ of data.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">12th November 2012, 14:27</div></div><div class="posttext">Could it be related to a virusscanner hogging your system? A good way to test would be to disable all security software and compare results.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zumbo</div><div class="date">12th November 2012, 16:11</div></div><div class="posttext">@MSG: Yes, indeed, when I disable my virus scanner, the lockup is gone. Thanks! Although I still don't understand why the lockup happens at two specific lines in the script. Also, when I replace the NSIS registry commands with nsExec::ExecToStack &quot;reg add [...]&quot;, it becomes much faster (about 15 s instead of 30 s lockup per call).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>