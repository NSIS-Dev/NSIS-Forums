<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" if makensis could choose compress method, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  if makensis could choose compress method NSIS Discussion" />
	
	<title> if makensis could choose compress method [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  if makensis could choose compress method</div>
<hr />
<div class="pda"><a href="t-67902.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=67902">if makensis could choose compress method</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">hotice</div><div class="date">7th December 2001, 01:14</div></div><div class="posttext">for example<br />
bz2<br />
cab<br />
ace<br />
rar<br />
and so on<br />
<br />
I don't know which of them is open source.<br />
but i found the ratio of nsis isn't the best.<br />
but her head blcok seems tiny.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">liquidmotion</div><div class="date">8th December 2001, 02:43</div></div><div class="posttext">that is one of the best features: low over head size.  you have to enlarge the size when you add new features.<br />
<br />
adding all of those compression formats could add a but much, but i'm not really an expert (justin?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">8th December 2001, 02:55</div></div><div class="posttext">Well, here's the deal.<br />
<br />
zlib is good and balanced and free.<br />
bzip2 can be better, but isn't always, and has other downsides.<br />
rar is great, but is it free?<br />
likewise all the others. If there was some way of using lz32.dll or whatever that didn't have downsides, I'd be up for it. <br />
<br />
Anyway, perhaps I will make it easier to swap out codecs, but it will still require a recompile of makensis and exehead.<br />
<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Cristian Adam</div><div class="date">8th December 2001, 13:23</div></div><div class="posttext">Cab SDK can be downloaded from here: http://msdn.microsoft.com/library/en-us/dnsamples/cab-sdk.exe.<br />
Maybe justin can do something with it... (delete it<br />
afterwards :)<br />
<br />
cristi.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">8th December 2001, 18:51</div></div><div class="posttext">Originally posted by justin <br />
Well, here's the deal.<br />
<br />
zlib is good and balanced and free.<br />
bzip2 can be better, but isn't always, and has other downsides.<br />
rar is great, but is it free?<br />
likewise all the others. If there was some way of using lz32.dll or whatever that didn't have downsides, I'd be up for it. <br />
<br />
Anyway, perhaps I will make it easier to swap out codecs, but it will still require a recompile of makensis and exehead.<br />
<br />
<br />
-Justin <br />
<br />
I hacked up v 1.44 using LZ compression and the microsoft compress.exe. The problem is that unlike with zlib there doesn't seem to be a way to expand data that is simply in memory.. <br />
Besides, I think it is the MS-ZIP quantum compression that really whips the llama's behind, which is not LZ.<br />
The latter problem I can live with, but having to write out the data block to a temporary file seems a bit inelegant. I am searching on usenet now to try and figure out a solution.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">8th December 2001, 20:01</div></div><div class="posttext">I'm all for making multiple compression mechanisms available from an #define in config.h.. Just a quick test of microsoft's lz32 (compress.exe) shows that for me it is not as good as zlib, as far as compression ratio at least (obviously it would require less code than zlib). Perhaps we could integrate bzip2, but then we'd really want to compress the whole datablock together, across file boundaries... Anyway..<br />
<br />
-Justin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">8th December 2001, 21:24</div></div><div class="posttext">yep, agreed microsoft's LZ isn't as good as ZLIB.<br />
Using the -zq7 option with compress.exe .. on makensis.exe (a recompiled version, admittedly) 85436 - 89769, 95% saving.<br />
But of course to expand this you need the blockbuster lib in the cab sdk.. just the sample application to expand cab files comes in at 55kb (using the CRT, I couldn't be bothered to rewrite it in raw win32 code, but that may shave 20kb or so off).<br />
<br />
--&gt; for all but very small installers, LZ is useless... I vote for zlib.<br />
<br />
/me will shut up now giving useless ideas..</div></div><hr />


<div class="post"><div class="posttop"><div class="username">justin</div><div class="date">10th December 2001, 09:59</div></div><div class="posttext">I'm figuring that bzip2 (as well as zlib) would do a lot better in terms of compression if it could work across more than one file at a time. I'm going to implement compile-time options for both compression system (zlib, bzip2, or whatever) as well as whether it is in the current easy method (meaning you can seek around in the data a lot, each file compressed separately), or the slower hopefully more efficient space-wize method of compressing them all together. The problem is, the installer may need to move around in the compressed data. The solutions:<br />
<br />
  write out the uncompressed data as it is uncompressed to a temp file.<br />
  when a seek back is needed, start from the beginning and get seekign.<br />
<br />
<br />
The benefits of the first one is that if the installer has to jump around a lot, it already has teh data cached and is less CPU intensive. But it can require a bit of disk space, and be more disk intensive. The benefits of the second method are that it requires no extra disk space, and as long as the items in the installer are sequencial (and especially if the datablock optimizer is off), it will be even faster.<br />
<br />
Perhaps the installer can pick one of the two modes, based on disk space, as well as how much out-of-order code there is in the installer. I'll be experimenting with this.<br />
<br />
So there will basically be in config.h:<br />
<br />
#define NSIS_COMPRESS_FILE<br />
or<br />
#define NSIS_COMPRESS_WHOLE<br />
<br />
and<br />
<br />
#define NSIS_COMPRESS_AS_ZLIB<br />
or<br />
#define NSIS_COMPRESS_AS_BZIP2<br />
or<br />
#define NSIS_COMPRESS_AS_LZ32 // maybe, heh.<br />
or (maybe eventually)<br />
#define NSIS_COMPRESS_AS_CAB // maybe<br />
<br />
<br />
anyway.<br />
<br />
-Justin<br />
<br />
P.S. and this will be for 1.90 or maybe 2.0. heh.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Repzilon</div><div class="date">11th December 2001, 00:37</div></div><div class="posttext">Be sure to check out my thread about solid compression (http://forums.winamp.com/showthread.php?threadid=62704).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CodeSquid</div><div class="date">11th December 2001, 10:22</div></div><div class="posttext">Originally posted by justin <br />
I'm figuring that bzip2 (as well as zlib) would do a lot better in terms of compression if it could work across more than one file at a time. I'm going to implement compile-time options for both compression system (zlib, bzip2, or whatever) as well as whether it is in the current easy method (meaning you can seek around in the data a lot, each file compressed separately), or the slower hopefully more efficient space-wize method of compressing them all together. The problem is, the installer may need to move around in the compressed data. The solutions:<br />
<br />
  write out the uncompressed data as it is uncompressed to a temp file.<br />
  when a seek back is needed, start from the beginning and get seekign.<br />
<br />
<br />
The benefits of the first one is that if the installer has to jump around a lot, it already has teh data cached and is less CPU intensive. But it can require a bit of disk space, and be more disk intensive. The benefits of the second method are that it requires no extra disk space, and as long as the items in the installer are sequencial (and especially if the datablock optimizer is off), it will be even faster.<br />
<br />
Perhaps the installer can pick one of the two modes, based on disk space, as well as how much out-of-order code there is in the installer. I'll be experimenting with this.<br />
<br />
So there will basically be in config.h:<br />
<br />
#define NSIS_COMPRESS_FILE<br />
or<br />
#define NSIS_COMPRESS_WHOLE<br />
<br />
A good solution to the above problems would be a third option:<br />
#define NSIS_COMPRESS_COMPONENT<br />
Only files within one component will be compressed together.<br />
<br />
Justin, I'm sure you'll find the best solution :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>