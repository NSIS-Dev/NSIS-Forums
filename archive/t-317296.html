<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Call $Var, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Call $Var NSIS Discussion" />
	
	<title> Call $Var [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Call $Var</div>
<hr />
<div class="pda"><a href="t-317296.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=317296">Call $Var</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">lazlot</div><div class="date">25th February 2010, 17:52</div></div><div class="posttext">Just wondering if it is possible do this within a section?<br />
<br />
Call $Var<br />
<br />
I have many Functions on a particular installer and have $Var set prior to using Call. However, compilation fails with install function &quot;variablename&quot; not referenced</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">26th February 2010, 12:34</div></div><div class="posttext">You could make it one big function with a ${Select} $Var / ${Case} inside it. But why do you think you need this? Functions are defined at compile-time, so function names are as well. Runtime-dynamic function names therefore make no sense.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lazlot</div><div class="date">27th February 2010, 14:01</div></div><div class="posttext">Thanks for the reply MSG. Here is the situation:<br />
<br />
I have a huge dropdown list and of course when the user selects an option a variable is populated.<br />
<br />
I have specific functions set for each available item in that dropdown list.<br />
<br />
In a section, I currently use If and ElseIf to compare the variable and then call the corresponding section for that selection. <br />
<br />
As you can see, the larger the dropdown list becomes, the more of a mess I end up with. I simply want to trim the fat!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lazlot</div><div class="date">27th February 2010, 14:53</div></div><div class="posttext">What I am trying to do is replace If and ElseIf portions in Section DoStuff with something like Call $ItName <br />
<br />
Here is a small example of how the code currently looks. Maybe someone can direct me to a better way to do this?<br />
<br />
<br />
OutFile &quot;test.exe&quot;<br />
SetCompressor LZMA<br />
CRCCheck On<br />
XPStyle on<br />
!include MUI2.nsh<br />
<br />
Var Dialog<br />
Var Selection<br />
Var It<br />
Var ItName<br />
<br />
Page custom CustomPage<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
Function CustomPage <br />
  nsDialogs::Create 1018<br />
  Pop $Dialog<br />
  ${NSD_CreateLabel} 0 0 100% 15 &quot;Choose Something&quot;<br />
  Pop $Selection   <br />
  ${NSD_CreateDroplist} 0 20 45% 15 &quot;&quot;<br />
  Pop $It   <br />
  ${NSD_OnChange} $It OnSelectIt  <br />
  ${NSD_CB_AddString} $It &quot;one&quot;<br />
  ${NSD_CB_AddString} $It &quot;two&quot; <br />
  ${NSD_CB_AddString} $It &quot;three&quot; <br />
  ${NSD_CB_SelectString} $It $ItName  <br />
  nsDialogs::Show <br />
FunctionEnd<br />
<br />
Function OnSelectIt<br />
  Pop $It<br />
  ${NSD_GetText} $It $ItName <br />
  StrCpy $ItName &quot;$ItName&quot;   <br />
FunctionEnd  <br />
<br />
Function &quot;Main one&quot; <br />
 MessageBox MB_OK &quot;One was selected&quot;<br />
FunctionEnd  <br />
<br />
Function &quot;Main two&quot;<br />
 MessageBox MB_OK &quot;Two was selected&quot;<br />
FunctionEnd  <br />
<br />
Function &quot;Main three&quot;<br />
 MessageBox MB_OK &quot;Three was selected&quot;<br />
FunctionEnd <br />
<br />
Section DoStuff<br />
 ${If} $ItName == &quot;one&quot;<br />
  Call &quot;Main one&quot;<br />
 ${ElseIf} $ItName == &quot;two&quot;  <br />
  Call &quot;Main two&quot;<br />
 ${ElseIf} $ItName == &quot;three&quot;  <br />
  Call &quot;Main three&quot;<br />
 ${EndIf} <br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">28th February 2010, 09:05</div></div><div class="posttext">It seems like you want to decrease the amount of code, but that is of course impossible: You want different behavior for each option, so you need to code each option separately.<br />
<br />
Anyway, if you'd make a function for every option, you'd only be increasing the fat, not reducing it. If you want the code out of your nsi file, simply add a macro:<br />
<br />
!macro mymacro<br />
${If} $ItName == &quot;one&quot;<br />
  Call &quot;Main one&quot;<br />
${ElseIf} $ItName == &quot;two&quot;  <br />
  Call &quot;Main two&quot;<br />
${ElseIf} $ItName == &quot;three&quot;  <br />
  Call &quot;Main three&quot;<br />
${EndIf}<br />
!macroend<br />
<br />
and save it as mymacro.nsh, then add !include mymacro.nsh to the top of your .nsi and in your section do !insertmacro mymacro.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lazlot</div><div class="date">28th February 2010, 15:16</div></div><div class="posttext">That is the perfect compromise and solution MSG. The sample I gave above was just thrown together as a single example file. Most probably noticed that it would make more sense to eliminate the Main functions and simply include the if else statements in the section.<br />
<br />
My actual installer does use a separate .nsh file containing those Main functions to reduce clutter. However, it appears to have slipped my mind that those could have been condensed into a macro (eliminating redundancy). A simple solution I overlooked. <br />
<br />
Thanks for the help MSG!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">lazlot</div><div class="date">28th February 2010, 16:25</div></div><div class="posttext">For anyone else who may be wondering how the completed results look. Here is a finished example:<br />
<br />
Test.nsi<br />
<br />
<br />
OutFile &quot;test.exe&quot;<br />
SetCompressor LZMA<br />
CRCCheck On<br />
XPStyle on<br />
!include MUI2.nsh<br />
<br />
Var Dialog<br />
Var Selection<br />
Var It<br />
Var ItName<br />
<br />
Page custom CustomPage<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
Function CustomPage<br />
  nsDialogs::Create 1018<br />
  Pop $Dialog<br />
  ${NSD_CreateLabel} 0 0 100% 15 &quot;Choose Something&quot;<br />
  Pop $Selection   <br />
  ${NSD_CreateDroplist} 0 20 45% 15 &quot;&quot;<br />
  Pop $It   <br />
  ${NSD_OnChange} $It OnSelectIt  <br />
  ${NSD_CB_AddString} $It &quot;one&quot;<br />
  ${NSD_CB_AddString} $It &quot;two&quot;<br />
  ${NSD_CB_AddString} $It &quot;three&quot;<br />
  ${NSD_CB_SelectString} $It $ItName  <br />
  nsDialogs::Show<br />
FunctionEnd<br />
<br />
Function OnSelectIt<br />
  Pop $It<br />
  ${NSD_GetText} $It $ItName<br />
  StrCpy $ItName &quot;$ItName&quot;   <br />
FunctionEnd  <br />
<br />
!include &quot;MainMacro.nsh&quot;<br />
<br />
Section DoStuff<br />
 !insertmacro Main<br />
SectionEnd<br />
 <br />
<br />
And MainMacro.nsh<br />
<br />
<br />
!macro Main<br />
${If} $ItName == &quot;one&quot;<br />
 MessageBox MB_OK &quot;One was selected&quot;<br />
${ElseIf} $ItName == &quot;two&quot;<br />
 MessageBox MB_OK &quot;Two was selected&quot;<br />
${ElseIf} $ItName == &quot;three&quot;<br />
 MessageBox MB_OK &quot;Three was selected&quot;<br />
${EndIf}<br />
!macroend</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>