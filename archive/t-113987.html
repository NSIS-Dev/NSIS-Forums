<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need some help..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need some help... NSIS Discussion" />
	
	<title> Need some help... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need some help...</div>
<hr />
<div class="pda"><a href="t-113987.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=113987">Need some help...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Beaver</div><div class="date">13th November 2002, 18:05</div></div><div class="posttext">I have read through the messages on the boards and tried to re-use some of the posted code but to no avail...<br />
<br />
Here is the nature of the problem:<br />
<br />
I have created a simple installer that copy's 25 files in to the $INSTDIR.  However this is an upgrade... I need a way to move files to $INSTDIR\backup directory *before* they get overwritten by the installer...  Can anyone help?  (BTW... I am Sooooo Not a programer...)<br />
<br />
<br />
Beaver</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th November 2002, 18:11</div></div><div class="posttext">CreateDirectory $INSTDIR\backup<br />
CopyFiles /SILENT $INSTDIR\*.* $INSTDIR\backup<br />
<br />
That should do the trick.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Beaver</div><div class="date">13th November 2002, 18:20</div></div><div class="posttext">I will try that.  Is there any way to just backup the files that it is going to replace?<br />
<br />
Beaver</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th November 2002, 18:29</div></div><div class="posttext">Well, you can if you want check for the existance of every every file and move it. You can make a simple macro out it:<br />
<br />
!macro BackupAndExtract FILE ONAME<br />
  IfFileExists &quot;$INSTDIR\${ONAME}&quot; 0 +2<br />
    Rename &quot;$INSTDIR\\${ONAME}&quot; &quot;$INSTDIR\\backup\\${ONAME}&quot;<br />
  File &quot;/oname=${ONAME}&quot; &quot;${FILE}&quot;<br />
!macroend<br />
<br />
To use it:<br />
<br />
CreateDirectory $INSTDIR\\backup<br />
!insertmacro BackupAndExtract &quot;C:\\dev\\whateverfile.something&quot; &quot;outputname.st&quot;<br />
# NSIS will only delete this dir if it's empty<br />
RMDir $INSTDIR\\backup</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Beaver</div><div class="date">13th November 2002, 18:46</div></div><div class="posttext">OK  So I am obviously doing something very wrong....<br />
<br />
<br />
Can you look at the attached and tell me where I am missing the point....<br />
<br />
*Waits to be hit by the ClueX4*<br />
<br />
Beaver</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th November 2002, 19:02</div></div><div class="posttext">You have read the old post :(<br />
<br />
I have edited it since you have read it... Please read it again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Beaver</div><div class="date">13th November 2002, 19:23</div></div><div class="posttext">Ok saw the new post.  Made some changes.  But getting a compilation error:<br />
<br />
File: &quot;Core.dll&quot;-&gt;&quot;outputname.st&quot; 2338816 bytes<br />
File: &quot;Customize.dll&quot;-&gt;&quot;outputname.st&quot; 786432 bytes<br />
File: &quot;Editor.dll&quot;-&gt;&quot;outputname.st&quot; 2637824 bytes<br />
File: &quot;file.dll&quot;-&gt;&quot;outputname.st&quot; 241664 bytes<br />
File: &quot;file.exe&quot;-&gt;&quot;outputname.st&quot; 204800 bytes<br />
File: &quot;Generator.dll&quot;-&gt;&quot;outputname.st&quot; 327680 bytes<br />
Usage: File ([/a] [/r] filespec [...]|/oname=outfile one_file_only)<br />
Error in macro BackupAndExtract on macroline 3<br />
Error in script &quot;C:\Documents and Settings\mbeaver\My Documents\Development\NSIS\betapatch.nsi&quot; on line 27 -- aborting creation process<br />
<br />
<br />
Any thoughts?  We are getting closer BTW... thanks!<br />
<br />
Beaver</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th November 2002, 19:30</div></div><div class="posttext">You need to replcae outputname.st with the output name of your file. For example:<br />
<br />
!insertmacro BackupAndExtract &quot;C:\dev\Core.dll&quot; &quot;Core.dll&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Beaver</div><div class="date">13th November 2002, 19:57</div></div><div class="posttext">OK this works:<br />
!insertmacro BackupAndExtract &quot;C:\dev\Core.dll&quot; &quot;Core.dll&quot;<br />
<br />
<br />
But if I have a file:<br />
!insertmacro BackupAndExtract &quot;C:\dev\XML\stuff.xsl&quot; &quot;stuff.xsl&quot;<br />
<br />
It does not get backed up...<br />
<br />
<br />
Any thoughts?<br />
<br />
Beaver</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th November 2002, 19:58</div></div><div class="posttext">Attach the script please.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th November 2002, 20:25</div></div><div class="posttext">Here is the new version that works with sub folders too:<br />
!macro BackupAndExtract DIR FILE<br />
  SetOutPath &quot;$INSTDIR\\${DIR}&quot;<br />
  IfFileExists &quot;$OUTDIR\\${FILE}&quot; 0 +3<br />
    CreateDirectory &quot;$INSTDIR\\backup\\${DIR}&quot;<br />
    Rename &quot;$OUTDIR\\${FILE}&quot; &quot;$INSTDIR\\backup\\${DIR}\\${FILE}&quot;<br />
  File &quot;&lt;insert app dir here&gt;\\${DIR}\\${FILE}&quot;<br />
!macroend<br />
<br />
!insertmacro BackupAndExtract &quot;&quot; &quot;Core.dll&quot;<br />
!insertmacro BackupAndExtract &quot;subfolder&quot; &quot;AnotherDLL.dll&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Beaver</div><div class="date">13th November 2002, 22:18</div></div><div class="posttext">That Worked!  Thanks you VERY much for your help today.  With out it I do not think we could have met our deadline...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>