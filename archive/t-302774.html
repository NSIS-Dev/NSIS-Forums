<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Check if user selected &quot;Reboot now&quot; when using SetRebootFlag, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Check if user selected &quot;Reboot now&quot; when using SetRebootFlag NSIS Discussion" />
	
	<title> Check if user selected &quot;Reboot now&quot; when using SetRebootFlag [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Check if user selected &quot;Reboot now&quot; when using SetRebootFlag</div>
<hr />
<div class="pda"><a href="t-302774.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302774">Check if user selected &quot;Reboot now&quot; when using SetRebootFlag</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Crazytje</div><div class="date">4th February 2009, 12:38</div></div><div class="posttext">While installing my application I use the SetRebootFlag. On the finish page, I want to know what the user selected after pressing finish.<br />
<br />
The reason I need to know is because if &quot;Reboot Manually Later&quot; is selected I want to start the application. <br />
<br />
I've searched around and can't seem to get it working.<br />
One thing I read about is using the page callback function, but how do I do this? And how do I know what the user selected?<br />
<br />
Any help is welcome!, I really need all the help I can get for this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">4th February 2009, 14:11</div></div><div class="posttext">add a 'MUI_PAGE_CUSTOMFUNCTION_LEAVE function' before your MUI Finish page, then based on whether you use MUI or MUI2, do something like the following in that callback function:<br />
<br />
MUI:<br />
Read $PLUGINSDIR\ioSpecial.ini [Field 4] State<br />
Read $PLUGINSDIR\ioSpecial.ini [Field 5] State<br />
<br />
If Field 4's State = 1, then the user chose 'reboot now'.<br />
If Field 5's State = 1, then the user chose 'I want to manually reboot later'.<br />
<br />
MUI2:<br />
<br />
	FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $0 $R0 0x4b3<br />
	${NSD_GetState} $0 $1<br />
	GetDlgItem $0 $R0 0x4b4<br />
	${NSD_GetState} $0 $2<br />
	MessageBox MB_OK &quot;Reboot now: [$1]$\r$\nReboot later: [$2]&quot;<br />
	Abort<br />
<br />
And perform the desired action (Reboot / Launch your app) based on the states of $1 and $2.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Crazytje</div><div class="date">5th February 2009, 13:36</div></div><div class="posttext">Thank you!<br />
<br />
I got it working.<br />
<br />
Thx for helping me :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">5th February 2009, 19:21</div></div><div class="posttext">No prob :)<br />
<br />
I wonder if MUI2 could store these pre-set dialogs' settings in pre-defined variables.  Would waste a bit of memory if unused, but I think there's been a steady trend of making NSIS a bit easier to use at the cost of superlean installers (e.g. recommendations to use LogicLib, despite the overhead that generates) - so maybe they'll add that.  I'm glad the above works, regardless :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mx450</div><div class="date">11th February 2009, 09:45</div></div><div class="posttext">@Animaether<br />
Thanks for your info.<br />
<br />
One question, is there any way to get status of the MUI_FINISHPAGE_SHOWREADME checkbox?<br />
<br />
I used to use<br />
!insertmacro INSTALLOPTIONS_READ $MUI_TEMP1 &quot;ioSpecial.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
to get the state of it. Now I use MUI2 and nsDialog. it doesn't work any more as there is no ioSpecial.ini in MUI2. <br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">11th February 2009, 09:58</div></div><div class="posttext">Use WinSpy / WinSpy++ / process explorer / whathaveyou to get the control ID of that checkbox, then use GetDlgItem to get the hwnd for that control, after which you should be able to use '${NSD_GetState} &lt;hwnd&gt; &lt;out var&gt;' to get its checked state.<br />
The control ID should never vary (until somebody mucks with the resources of MUI2), the hwnd does, so you have to look that up via the aforementioned.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mx450</div><div class="date">11th February 2009, 11:15</div></div><div class="posttext">Originally posted by Animaether <br />
Use WinSpy / WinSpy++ / process explorer / whathaveyou to get the control ID of that checkbox, then use GetDlgItem to get the hwnd for that control, after which you should be able to use '${NSD_GetState} &lt;hwnd&gt; &lt;out var&gt;' to get its checked state.<br />
The control ID should never vary (until somebody mucks with the resources of MUI2), the hwnd does, so you have to look that up via the aforementioned.  <br />
I did use winspy++ to check the control id, it is 0x4b4.<br />
<br />
This is what i tried to do:<br />
<br />
FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $0 $R0 0x4b4<br />
${NSD_GetState} $0 $1<br />
MessageBox MB_OK &quot;State of SHOW_READ_ME checkbox: $1&quot;<br />
<br />
But, it always shows 0.<br />
Do i do anything wrong?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">11th February 2009, 12:05</div></div><div class="posttext">not sure how you got the 0x4b4 - I think it should be 0x4b3 (as stated in WinSpy++ , don't add 1)<br />
<br />
<br />
!include &quot;MUI2.NSH&quot;<br />
outfile 'finishpage_readme_checkbox_test.exe'<br />
<br />
Section<br />
SectionEnd<br />
<br />
!define MUI_FINISHPAGE_SHOWREADME &quot;http://www****n.com/&quot;<br />
!define MUI_FINISHPAGE_SHOWREADME_TEXT &quot;HELLO&quot;<br />
!define MUI_FINISHPAGE_SHOWREADME_FUNCTION myFunc<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveFunc<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
Function myFunc<br />
	MessageBox MB_OK &quot;Test&quot;<br />
FunctionEnd<br />
<br />
Function LeaveFunc<br />
	MessageBox MB_OK &quot;Leave&quot;<br />
	FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $0 $R0 0x4b3<br />
	${NSD_GetState} $0 $1<br />
	MessageBox MB_OK &quot;State of SHOW_READ_ME checkbox: $1&quot;<br />
	Abort<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mx450</div><div class="date">11th February 2009, 12:32</div></div><div class="posttext">Originally posted by Animaether <br />
not sure how you got the 0x4b4 - I think it should be 0x4b3 (as stated in WinSpy++ , don't add 1)<br />
<br />
<br />
!include &quot;MUI2.NSH&quot;<br />
outfile 'finishpage_readme_checkbox_test.exe'<br />
<br />
Section<br />
SectionEnd<br />
<br />
!define MUI_FINISHPAGE_SHOWREADME &quot;http://www****n.com/&quot;<br />
!define MUI_FINISHPAGE_SHOWREADME_TEXT &quot;HELLO&quot;<br />
!define MUI_FINISHPAGE_SHOWREADME_FUNCTION myFunc<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveFunc<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
Function myFunc<br />
	MessageBox MB_OK &quot;Test&quot;<br />
FunctionEnd<br />
<br />
Function LeaveFunc<br />
	MessageBox MB_OK &quot;Leave&quot;<br />
	FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
	GetDlgItem $0 $R0 0x4b3<br />
	${NSD_GetState} $0 $1<br />
	MessageBox MB_OK &quot;State of SHOW_READ_ME checkbox: $1&quot;<br />
	Abort<br />
FunctionEnd<br />
  <br />
it is 0x4b4 for me and i know why mine doesn't work. i didnt use leavefunc, i place it in somewhere else. Probably it calls after this control has been removed.<br />
<br />
Thanks for your kindly help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">11th February 2009, 12:45</div></div><div class="posttext">huh.. that's odd.  I wonder why it would be 0x4b4 for you as, again, that number shouldn't change.. anyway, glad the sample code helped resolve it regardless :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">5th November 2010, 10:40</div></div><div class="posttext">i tried to build upon this, as i'm trying to enable/disable MUI_FINISHPAGE_SHOWREADME at runtime.<br />
FindWindow $R0 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $0 $R0 0x4b4<br />
${If} $WebsiteURL == &quot;&quot;		<br />
	EnableWindow $0 0<br />
${Else}<br />
	EnableWindow $0 1<br />
${EndIf}<br />
didn't work, any ideas?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">5th November 2010, 13:16</div></div><div class="posttext">Probably the wrong ID again.. seems this varies a bit between versions.  Of course using the ID directly is unnecessary with most of MUI as it actually stores the hwnds in variables internally.  You can peek at the files in &quot;\Contrib\Modern UI 2\&quot; to find those variables.<br />
<br />
In this case, $mui.FinishPage.ShowReadme should be it.<br />
<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
<br />
OutFile &quot;$%temp%\temp.exe&quot;<br />
<br />
Section<br />
SectionEnd<br />
<br />
!define MUI_FINISHPAGE_SHOWREADME &quot;c:\test.txt&quot;<br />
!define MUI_PAGE_CUSTOMFUNCTION_SHOW finish.show<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
Function finish.show<br />
	EnableWindow $mui.FinishPage.ShowReadme 0<br />
FunctionEnd<br />
<br />
!insertmacro MUI_LANGUAGE English<br />
<br />
<br />
You might want to add code that unchecks the checkbox as well as the above 'as is' can lead to the situation of the control being disabled but checked... which is atypical behavior (but may be desired).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>