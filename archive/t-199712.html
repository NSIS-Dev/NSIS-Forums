<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Need help w/ files copy (loop?), media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Need help w/ files copy (loop?) NSIS Discussion" />
	
	<title> Need help w/ files copy (loop?) [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Need help w/ files copy (loop?)</div>
<hr />
<div class="pda"><a href="t-199712.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=199712">Need help w/ files copy (loop?)</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">20th November 2004, 00:50</div></div><div class="posttext">Hello all.  What I need to do is copy a bunch of *.mdb files out of an unknown number of folders of which I do not know the name of (I know what your saying, this sounds fun already!).  I tried the following, and it did not work, but I think it will give you the idea of what I’m trying to do.<br />
<br />
CopyFiles &quot;c:\source\*\*.mdb&quot; &quot;C:\destination\&quot;<br />
<br />
The first * in the above line is my problem.  I don't know the name of the folders in the &quot;source&quot; directory, and I don't know how many there are.  I only know there is 1 .mdb file in each folder.<br />
<br />
I don't know much about push, pop, and the stack, but it seems to me a loop could first be set up to read in (push) in each of the folder names in the &quot;source&quot; directory into the stack.  Then a second loop could run that would pop the stack 1 at a time to set the $0 variable.  The CopyFiles command would run after each pop, until the stack was empty, like this.<br />
<br />
CopyFiles &quot;c:\source\$0\*.mdb&quot; &quot;C:\destination\&quot;<br />
<br />
Would this work?  Any help, or code examples would be great.  Thanks all.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Erpo</div><div class="date">20th November 2004, 04:55</div></div><div class="posttext">CopyFiles &quot;c:\source\*\*.mdb&quot; &quot;C:\destination\&quot;<br />
<br />
I think no matter how you eventually get it to work, the above is going to be the most intuitive syntax for accomplishing your task. Maybe, if you ask nicely, the developers will add support for multiple wildcards.<br />
<br />
<br />
For now, here's something that might work. I'm not sure if the &quot;C:\source\*.*&quot; part will match directories in C:\source\ as well as files, but if it's consistent with the rest of the scripting language it should (e.g. File /r &quot;C:\source\*.*&quot;).<br />
<br />
Push $0<br />
Push $1<br />
FindFirst $0 $1 &quot;C:\source\*.*&quot;<br />
loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  CopyFiles &quot;$1\*.mdb&quot; &quot;C:\destination\&quot;<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
Pop $1<br />
Pop $0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">20th November 2004, 07:55</div></div><div class="posttext">Some remarks :)<br />
First of all we are talking about files copy on user's comp (CopyFiles parameter is filespec_on_destsys).<br />
Pop and Push are optional - if you want to save vars content.<br />
Folder names may not inclide &quot;.&quot;, so original syntax &quot;*&quot; looks better for me then &quot;*.*&quot;<br />
FindFirst/Next also finds &quot;.&quot; and &quot;..&quot;<br />
If your source folder may include files, you need to check that name is directory, not file.<br />
This works but with pauses, may be I forgot something :) ?<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
<br />
  CreateDirectory &quot;$INSTDIR&quot;<br />
  FindFirst $0 $1 &quot;$EXEDIR\*&quot;<br />
loop:<br />
  ;MessageBox MB_OK &quot;All files $1&quot;<br />
  StrCmp $1 &quot;&quot; done<br />
  IfFileExists &quot;$1\*&quot; 0 +4<br />
  StrCmp $2 &quot;..&quot; +3<br />
  StrCmp $2 &quot;.&quot; +2<br />
  CopyFiles /FILESONLY &quot;$1\*.mdb&quot; &quot;$INSTDIR&quot;<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
<br />
sectionend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th November 2004, 09:04</div></div><div class="posttext">You missed FindClose $0 at the end. It's always a good idea to use Push and Pop's no matter how small the code may be. Otherwise new people tend to wonder why their variable datas have changed.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">20th November 2004, 09:45</div></div><div class="posttext">FindClose is a good idea :) , and $1 in StrCmp, not $2, but I still see 1-2 second pauses on Win98 SE between 2 MessageBoxes<br />
<br />
Section &quot;Dummy Section&quot; SecDummy<br />
<br />
  CreateDirectory &quot;$INSTDIR&quot;<br />
  FindFirst $0 $1 &quot;$EXEDIR\*&quot;<br />
loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  IfFileExists &quot;$1\*&quot; 0 fndnxt<br />
  StrCmp $1 &quot;..&quot; fndnxt<br />
  StrCmp $1 &quot;.&quot; fndnxt<br />
  MessageBox MB_OK &quot;Dir exists $1&quot;<br />
  CopyFiles /FILESONLY &quot;$1\*.mdb&quot; &quot;$INSTDIR&quot;<br />
  MessageBox MB_OK &quot;After CopyFiles&quot;<br />
fndnxt:<br />
  FindNext $0 $1<br />
  Goto loop<br />
done:<br />
FindClose $0<br />
<br />
sectionend<br />
<br />
This not happens on WinXP Pro. Who knows whY? System bug?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">20th November 2004, 19:02</div></div><div class="posttext">Thanks everyone, Takhir's code is working perfectly.  You all rock!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">23rd November 2004, 16:11</div></div><div class="posttext">Hey guys, I was wondering if someone could check this for a bug.  The code below is working perfectly, however on my Win2K Pro workstation, I get the 3-4 second pause during execution as Takhir was talking about.  I get no pause at home on my XP Pro PC.  I have isolated the pause to the &quot;CopyFiles&quot; line.  I put a message box before and after that line, that’s where the pause is.  It seems there is about a 1 second pause each time that line is hit, so for a loop of 70 folders, that’s a really long pause.  Any help would be most appreciated.<br />
<br />
<br />
OutFile CollectMDBs.exe<br />
AutoCloseWindow True<br />
<br />
Var SourceFolder<br />
Var DestFolder<br />
<br />
Section &quot;&quot;<br />
<br />
  ReadINIStr $SourceFolder $EXEDIR\Collect.ini Source SourceFolder<br />
  ReadINIStr $DestFolder $EXEDIR\Collect.ini Destination DestFolder<br />
<br />
  FindFirst $0 $1 &quot;$SourceFolder\*&quot;<br />
  loop:<br />
  StrCmp $1 &quot;&quot; done<br />
  IfFileExists &quot;$SourceFolder\$1\*&quot; 0 fndnxt<br />
  StrCmp $1 &quot;..&quot; fndnxt<br />
  StrCmp $1 &quot;.&quot; fndnxt<br />
  CopyFiles /FILESONLY &quot;$SourceFolder\$1\*.mdb&quot; &quot;$DestFolder&quot;<br />
  fndnxt:<br />
  FindNext $0 $1<br />
  Goto loop<br />
  done:<br />
  FindClose $0<br />
<br />
sectionend<br />
<br />
<br />
p.s. Click HERE (http://webpages.charter.net/orum/Collect.zip) to download a Zip file with a sample directory structure to test this code, thanks.<br />
<br />
p.p.s If someone can tell me how to put an attachment on this post, that would be great, i could not see how.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">23rd November 2004, 17:00</div></div><div class="posttext">If you click the &quot;Post a reply&quot; button you'll get a page which lets you enter your message and attach a file to it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">23rd November 2004, 17:13</div></div><div class="posttext">Thanks pengyou, I didn't see that because I was &quot;editing&quot; my post, but I see it now on a new reply.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd November 2004, 18:12</div></div><div class="posttext">Have you checked that the $DestFolder exists already?<br />
You should also use IfErrors to check when FindNext has finished:IfFileExists &quot;$DestFolder\*&quot; +2<br />
 CreateDirectory $DestFolder<br />
<br />
  ClearErrors<br />
   FindFirst $0 $1 &quot;$SourceFolder\*&quot;<br />
   IfErrors done<br />
  loop:<br />
   IfFileExists &quot;$SourceFolder\$1\*&quot; 0 fndnxt<br />
   StrCmp $1 &quot;..&quot; fndnxt<br />
   StrCmp $1 &quot;.&quot; fndnxt<br />
    CopyFiles /FILESONLY &quot;$SourceFolder\$1*.rmf&quot; &quot;$DestFolder&quot;<br />
  fndnxt:<br />
  ClearErrors<br />
   FindNext $0 $1<br />
   IfErrors 0 loop<br />
  done:<br />
  FindClose $0-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">23rd November 2004, 18:18</div></div><div class="posttext">Afrow UK, thanks for the suggestion.  Yes, the $DestFolder does exist.  And that’s good to know about the IfErrors, but does anyone know about the strange delay?  Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">23rd November 2004, 18:32</div></div><div class="posttext">This is system bug, C code below shows 1006 - 1020 ms delay on my comp under Win98 (with or without dir, files exist or not..) It's SHFileOperation().<br />
<br />
        op.fFlags=FOF_FILESONLY|FOF_NOCONFIRMATION ;<br />
        t1 = GetTickCount();<br />
        res=SHFileOperation(&amp;op);<br />
        sprintf(buf2, &quot;time %d ms, res %d&quot;, GetTickCount() - t1, res);<br />
        MessageBox(NULL, buf2, &quot;Time&quot;, 0);<br />
<br />
exec.c NSIS file, SHFileOperation - what instead?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">23rd November 2004, 18:32</div></div><div class="posttext">If that doesn't fix the problem then it must be either an internal problem with NSIS or with Windows itself.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">23rd November 2004, 22:18</div></div><div class="posttext">Takhir, your last post was a bit over my head, I’m not sure I understand.  So is there anything I can do about the delay or no?  Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">24th November 2004, 07:07</div></div><div class="posttext">Jnuw, looking from my corner situation is following: MS forgot Sleep(1 sec) in the SHFileOperation API call (Win98 and Win2K, not WinXP). I see 3 ways:<br />
1) try to create second findfile-filecopy loop for mdb files and do copy using NSIS CopyFiles (for single file - not tested) or using System plug-in and CopyFile() API call.<br />
2) Wait a little - may be NSIS developers can do something with this in exec.c file (current version or 2.03?).<br />
3) write a plug-in (C program).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>