<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Help w/ mysql script, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Help w/ mysql script NSIS Discussion" />
	
	<title> Help w/ mysql script [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Help w/ mysql script</div>
<hr />
<div class="pda"><a href="t-172715.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=172715">Help w/ mysql script</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">StanLogan</div><div class="date">9th March 2004, 18:26</div></div><div class="posttext">Hi,<br />
<br />
On a previous thread, there was information about execting a .sql script against mysql. I'm trying this, but having no luck.<br />
<br />
I'm running the installer on WindowsME, so I've changed from cmd to command. Also, I've always run mysqld.exe, rather than mysql.exe, so I changed the path to point to that. I confirm that I am executing the statement that I expect to run the script, but basically, nothing happens. Can anyone help? Here's my code:<br />
<br />
    ; unpack the mysql update<br />
    SetOutPath            &quot;$INSTDIR&quot;<br />
    File                  &quot;schema.sql&quot;<br />
<br />
    ; execute the update against mysql<br />
    StrCpy $mySQLEXE &quot;C:\mysql\bin\mysqld.exe&quot;<br />
    StrCpy $dbUser &quot;root&quot;<br />
    StrCpy $dbPassword &quot;rootpass&quot;<br />
    StrCpy $dbHost &quot;localhost&quot;<br />
    StrCpy $dbPort &quot;3306&quot;<br />
MessageBox MB_OK &quot;pre exec&quot;<br />
    nsExec::ExecToStack 'command /C &quot;$mySQLEXE&quot; -u$dbUser -p$dbPassword -h$dbHost -P$dbPort &lt; &quot;$INSTDIR\schema.sql&quot;'<br />
MessageBox MB_OK &quot;post exec&quot;<br />
<br />
Thanks!<br />
Stan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Spatacoli</div><div class="date">9th March 2004, 18:47</div></div><div class="posttext">I thought that mysqld.exe is the server and mysql.exe is the client. Running the server isn't going to do anything but start mySQL again. I use mysql.exe because I need a client application to run scripts against a server that is already running.<br />
<br />
But if I'm wrong do these two things. First, run it from the command line to ensure it works there. Second, try it without all the variables. What I mean is spell out all those variables such as:<br />
<br />
 nsExec::ExecToStack 'command /C &quot;C:\mysql\bin\mysqld.exe&quot; -u$root -prootpass -hlocalhost -P3306 &lt; &quot;$INSTDIR\schema.sql&quot;'<br />
<br />
Good luck</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StanLogan</div><div class="date">9th March 2004, 18:59</div></div><div class="posttext">Hi,<br />
<br />
I started out trying to execute mysql.exe, both before and after I had launched mysqld.exe. It makes sense though that it's client and server - I thought mysql.exe was the non-debug version (it's been almost 2 years since I looked at a local install of mysql - it took me 10 minutes to figure out how to shut it down last night :) ).<br />
<br />
I'll go try it from the command line and see what happens.<br />
<br />
Stan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StanLogan</div><div class="date">9th March 2004, 20:06</div></div><div class="posttext">Working from the command line, I found several issues - one was my user was not set up correctly in mysql, and the schema doc itself needed a fix.<br />
<br />
Now, it works fine from the command line, like this:<br />
<br />
C:\mysql\bin\&gt;mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; C:\INSTEST\schema.sql<br />
<br />
However, this doesn't work:<br />
<br />
nsExec::ExecToLog 'command /C C:\mysql\bin\mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; &quot;$INSTDIR\schema.sql&quot;'<br />
<br />
Nor does this:<br />
<br />
nsExec::ExecToLog 'command /C C:\mysql\bin\mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; $INSTDIR\schema.sql'<br />
<br />
$INSTDIR is set to C:\INSTEST.<br />
<br />
Does anyone have more suggestions?<br />
<br />
Thanks,<br />
Stan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">9th March 2004, 20:16</div></div><div class="posttext">There have been several topics about this subject, please use the search.<br />
<br />
&lt; is a feature of the console and not a normal command line syntax.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StanLogan</div><div class="date">9th March 2004, 20:55</div></div><div class="posttext">Hi Joost,<br />
<br />
I had read several of the previous posts. I may not have gotten the point, but I did read them :).<br />
<br />
I went back and read some more, and here is what I found I needed to do to make it work (on WindowME anyway) - I had to add this line:<br />
<br />
ExpandEnvStrings $0 &quot;%COMSPEC%&quot;<br />
<br />
to get the actual path to 'command' into $0, and then I quoted that in the statement, like this:<br />
<br />
nsExec::ExecToLog '&quot;$0&quot; /C &quot;C:\mysql\bin\mysql.exe&quot; -utheuser -pthepass -hlocalhost -P3306 &lt; &quot;$INSTDIR\schema.sql&quot;'<br />
<br />
My question now is, will this form work on all versions of windows?<br />
<br />
Thanks for everyone's help.<br />
Stan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">9th March 2004, 21:05</div></div><div class="posttext">Yes, that should work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StanLogan</div><div class="date">9th March 2004, 21:16</div></div><div class="posttext">Very good.<br />
<br />
Thanks again!<br />
Stan</div></div><hr />


<div class="post"><div class="posttop"><div class="username">StanLogan</div><div class="date">12th March 2004, 00:33</div></div><div class="posttext">Just a clarification here, for future archive searchers.<br />
<br />
This line:<br />
<br />
nsExec::ExecToLog '&quot;$0&quot; /C &quot;C:\mysql\bin\mysql.exe&quot; -utheuser -pthepass -hlocalhost -P3306 &lt; &quot;$INSTDIR\schema.sql&quot;'<br />
<br />
Did not work on Windows XP. The problem seemed to be quoting the path to the executable. It gave an error of 'The filename, directory name or volume label syntax is incorrect'. The working version would be:<br />
<br />
nsExec::ExecToLog '&quot;$0&quot; /C C:\mysql\bin\mysql.exe -utheuser -pthepass -hlocalhost -P3306 &lt; &quot;$INSTDIR\schema.sql&quot;'<br />
<br />
Enjoy!<br />
Stan</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>