<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" After call to function section code isn't executed, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  After call to function section code isn't executed NSIS Discussion" />
	
	<title> After call to function section code isn't executed [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  After call to function section code isn't executed</div>
<hr />
<div class="pda"><a href="t-276629.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=276629">After call to function section code isn't executed</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mergisius</div><div class="date">29th August 2007, 11:23</div></div><div class="posttext">After I call the function which displays custom page, code after the fucniton call isn't executed and buttons are disabled. <br />
<br />
It means, that messagebox never appears. But the buttons aren't active, so it's imposible to press them. So how to leave the function code?<br />
<br />
Well, I got this:<br />
<br />
Section &quot;DB paruoÅ¡imas&quot; Server_Recreate<br />
	; Call here!<br />
	Call SettingsPageDB<br />
        ; this MessageBox never appears <br />
	MessageBox MB_OK &quot;SettingsPageDB done&quot;<br />
	SetOutPath $INSTDIR<br />
	<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $DBSERVER_NAME &quot;ServerSettingsPageDB.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
	!insertmacro MUI_INSTALLOPTIONS_READ $DATABASE_NAME &quot;ServerSettingsPageDB.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
<br />
	SetOutPath &quot;$TEMP\EMC&quot;<br />
	<br />
File ..\EMC.Setup\bin\C5.dll<br />
File ..\EMC.Setup\bin\Castle.ActiveRecord.dll<br />
File ..\EMC.Setup\bin\Castle.Components.Validator.dll<br />
....................<br />
[quote]<br />
<br />
And the function:<br />
[quote]<br />
Function SettingsPageDB<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;ServerSettingsPageDB.ini&quot;<br />
FunctionEnd<br />
<br />
<br />
And the ServerSettingsPageDB.ini:<br />
<br />
[Settings]<br />
NumFields=5<br />
<br />
[Field 1]<br />
Type=groupBox<br />
Text=Nurodykite Ä¯diegimo parametrus<br />
Left=0<br />
Right=-1<br />
Top=5<br />
Bottom=182<br />
<br />
[Field 2]<br />
Type=label<br />
Text=DuomenÅ³ bazÄ—s serverio vardas<br />
Left=10<br />
Right=-10<br />
Top=20<br />
Bottom=30<br />
<br />
[Field 3]<br />
Type=text<br />
Left=10<br />
Right=-10<br />
Top=30<br />
Bottom=42<br />
MinLen=1<br />
ValidateText=Nurodykite duomenÅ³ bazÄ—s serverio vardÄ…<br />
<br />
[Field 4]<br />
Type=label<br />
Text=DuomenÅ³ bazÄ—<br />
Left=10<br />
Right=-10<br />
Top=50<br />
Bottom=60<br />
<br />
[Field 5]<br />
Type=text<br />
Left=10<br />
Right=-10<br />
Top=60<br />
Bottom=72<br />
MinLen=1<br />
ValidateText=Nurodykite duomenÅ³ bazÄ—s pavadinimÄ…<br />
<br />
<br />
Also tried this:<br />
<br />
Function FuncSettingsPageDB<br />
  ${If} ${SectionIsSelected} ${Server_Recreate}<br />
    MessageBox MB_OK &quot;Server_Recreate is selected&quot;<br />
	InstallOptions::dialog &quot;ServerSettingsPageDB.ini&quot;<br />
  ${EndUnless}<br />
	MessageBox MB_OK &quot;Serve_Recreate isn't selected&quot;<br />
FunctionEnd<br />
<br />
<br />
In both ways the result is the same. I can't click any buttons on the window, but content of the window is what i want it to be.<br />
<br />
Here is the picture:<br />
http://www.talpykla.com/files/1305/ServerDB.jpg<br />
<br />
So, how to make button &quot;next&quot; clickable? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 11:36</div></div><div class="posttext">Don't call the SettingsPageDB function in section. Use the Page command outside the sections.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mergisius</div><div class="date">29th August 2007, 11:39</div></div><div class="posttext">Originally posted by Laslie <br />
Don't call the SettingsPageDB function in section. Use the Page command outside the sections.  <br />
<br />
I need to show this page ONLY if section is selected.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 12:12</div></div><div class="posttext">Use pre function for Page command and check in the section is selected or not. If section is not selected use abort command.<br />
for example:<br />
...<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
Page custom ServerSettingsPageDBShow ServerSettingsPageDBLeave &quot;&quot;<br />
;other pages<br />
...<br />
<br />
Function ServerSettingsPageDBShow<br />
  !insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2<br />
  Abort<br />
  <br />
 !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;ServerSettingsPageDB.ini&quot;<br />
  <br />
FunctionEnd<br />
<br />
Function ServerSettingsPageDBLeave<br />
 ..<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $DBSERVER_NAME &quot;ServerSettingsPageDB.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
!insertmacro MUI_INSTALLOPTIONS_READ $DATABASE_NAME &quot;ServerSettingsPageDB.ini&quot; &quot;Field 5&quot; &quot;State&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mergisius</div><div class="date">29th August 2007, 12:32</div></div><div class="posttext">Error: could not resolve label &quot;Abort&quot; in function &quot;ServerSettingsPageDBShow&quot;<br />
Error - aborting creation process<br />
<br />
Well, i tried like this<br />
<br />
  Function ServerSettingsPageDBShow<br />
	!insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2 abort<br />
	!insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;ServerSettingsPageDB.ini&quot;<br />
	Goto end<br />
	abort:<br />
		Abort<br />
	end:	<br />
  FunctionEnd<br />
<br />
<br />
And now the error is:<br />
[quote]<br />
Processed 1 file, writing output:<br />
Adding plug-ins initializing function... Done!<br />
Error: resolving create-page function &quot;SettingsPageDBShow&quot; in install pages<br />
Note: uninstall functions must begin with &quot;un.&quot;, and install functions must not<br />
Error - aborting creation process<br />
[/qoute]<br />
<br />
What it's trying to say?<br />
<br />
And &quot;Abort&quot; function will exit only the function or whole installation?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 12:44</div></div><div class="posttext">Oops, sorry! Miss 0.<br />
<br />
Correct script:<br />
...<br />
Function ServerSettingsPageDBShow<br />
!insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2 0<br />
Abort<br />
...<br />
<br />
Abort calling from Page Pre CallBack function mean: don't show the page, post Page CallBack function: don't leave the page. Other place exit installation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mergisius</div><div class="date">29th August 2007, 13:07</div></div><div class="posttext">Yes, it works fine ;) thank you for your time ;)<br />
<br />
And i got one more question. What about this:<br />
<br />
Function PickDirectory<br />
  !insertmacro SectionFlagIsSet ${Server_Docs} ${SF_SELECTED} +2 0<br />
  Abort<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
FunctionEnd<br />
<br />
<br />
Error:<br />
<br />
!insertmacro: MUI_PAGE_DIRECTORY<br />
Error: command PageEx not valid in Function<br />
Error in macro MUI_PAGE_DIRECTORY on macroline 12<br />
Error in script &quot;Dlc_Install_server.nsi&quot; on line 252 -- aborting creation proces<br />
s<br />
<br />
<br />
So, I will need to make new macro &quot;MUI_PAGE_DIRECTORY&quot;? Or is there any way to pass this limitation, that I cannot use it in a function?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 13:24</div></div><div class="posttext">Don't mention it. :)<br />
<br />
Yes, you cannot use it in a function.<br />
Rightly:<br />
...<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
Page custom ServerSettingsPageDBShow ServerSettingsPageDBLeave &quot;&quot;<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE PickDirectory<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
...<br />
<br />
You create PickDirectory function, and you put the check in this function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 13:29</div></div><div class="posttext">The 3 functions together need using!<br />
...<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE PickDirectoryPre<br />
!define MUI_PAGE_CUSTOMFUNCTION_SHOW PickDirectoryShow<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE PickDirectoryLeave<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mergisius</div><div class="date">29th August 2007, 13:50</div></div><div class="posttext">As far as I know !define just makes some global variables like (it's from nsis help):<br />
<br />
!define USE_SOMETHING<br />
!define VERSION 1.2<br />
!define /date NOW &quot;%H:%M:%S %d %b, %Y&quot;<br />
!define /math RESULT 3 + 10<br />
!define /math REST 15 % ${RESULT}<br />
<br />
<br />
So, 3 defined variables does what? &quot;!define&quot; gives to variables PickDirectoryPre,  PickDirectoryShow, PickDirectoryLeave value  according if function &quot;PickDirectory&quot; was executed?<br />
<br />
So, this function should be called in the section which requires to pick directory.<br />
<br />
If yes, then what to write in the &quot;PickDirectory&quot; function to skip or run &quot;!insertmacro MUI_PAGE_DIRECTORY&quot; according to selected section?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 14:13</div></div><div class="posttext">To create the global variable use Var command, not !define.<br />
If you need show or not pick directory page check it in PickDirectoryPre function. Pages code running before section code running. Section code running after last page.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mergisius</div><div class="date">29th August 2007, 14:19</div></div><div class="posttext">But how to do it?<br />
<br />
Function PickDirectoryPre<br />
	!insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} 0 end<br />
  ;what to write here?<br />
  end:<br />
FunctionEnd<br />
<br />
<br />
I check it, and what to do if i don't need to show directory page? The part I don't get is, that i don't know how to make it not to appear in the screen.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 14:24</div></div><div class="posttext">The other way round.<br />
Function PickDirectoryPre<br />
!insertmacro SectionFlagIsSet ${Server_Recreate} ${SF_SELECTED} +2 0<br />
Abort ; hide screen<br />
<br />
; show screen<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 14:26</div></div><div class="posttext">So, 3 defined variables does what? &quot;!define&quot; gives to variables PickDirectoryPre, PickDirectoryShow, PickDirectoryLeave value according if function &quot;PickDirectory&quot; was executed? <br />
The MUI know this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mergisius</div><div class="date">29th August 2007, 14:32</div></div><div class="posttext">Yes it works, but this way only:<br />
<br />
Function PickDirectoryPre<br />
	!insertmacro SectionFlagIsSet ${Server_Docs} ${SF_SELECTED} end here<br />
	here:<br />
	Abort<br />
	end:<br />
FunctionEnd<br />
<br />
<br />
It's something strange with that numbers.. I make it work corectly only with labels. I, also made other custom pages with labels, because numbers didn't work for me.<br />
<br />
Well, i thought, that &quot;Abort&quot; will only exits the function.<br />
<br />
Thank you very much :)*</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Laslie</div><div class="date">29th August 2007, 14:36</div></div><div class="posttext">Try this:<br />
Function PickDirectoryPre<br />
!insertmacro SectionFlagIsSet ${Server_Docs} ${SF_SELECTED} end &quot;&quot;<br />
Abort<br />
end:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">wraithdu</div><div class="date">29th August 2007, 15:42</div></div><div class="posttext">I ran into that problem with relative jumps and macros too.  It's because when the script is compiled the macro is expanded into all its lines of code.  So a relative jump will jump somewhere into those lines.<br />
<br />
So you are correct to use labels.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>