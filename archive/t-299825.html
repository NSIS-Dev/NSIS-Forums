<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS Ant and Eclipse, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS Ant and Eclipse NSIS Discussion" />
	
	<title> NSIS Ant and Eclipse [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS Ant and Eclipse</div>
<hr />
<div class="pda"><a href="t-299825.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=299825">NSIS Ant and Eclipse</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">curmudgeon69</div><div class="date">12th November 2008, 13:38</div></div><div class="posttext">I realize this may not be the proper place to post a question about the NSIS Ant Task but that project appears to be dead so I thought I would ask here to see if any one else has had this problem and/or knows how to resolve it.<br />
<br />
I use the NSIS Ant Task to run NSIS from my ant script. Everything used to work fine in eclipse 3.3.2 but when I upgraded to eclipse 3.4.1 I had problems with the NSIS part of the ant script. Everything starts fine. I can see logging messages from NSIS where it is going through the !define statements then starts the !include statements but after the log message to !include MUI.nsh there is a line to !include System.nsh and then it just hangs. I've tried letting it run for several minutes but it never comes back.<br />
<br />
Any help would be greatly appreciated.<br />
<br />
Thanks,<br />
Scott<br />
<br />
Here is the output when running ant:<br />
<br />
     [nsis] MakeNSIS v2.40 - Copyright 1995-2008 Contributors<br />
     [nsis] See the file COPYING for license details.<br />
     [nsis] Credits can be found in the Users Manual.<br />
     [nsis] Command line defined: &quot;CLIENT_VERSION=5.1&quot;<br />
     [nsis] Command line defined: &quot;CLIENT_BUILD=b&quot;<br />
     [nsis] Command line defined: &quot;IRFANVIEW_VERSION=3.95&quot;<br />
     [nsis] Command line defined: &quot;JRE_VERSION=1.6.0_07&quot;<br />
     [nsis] Command line defined: &quot;OUTDIR=C:/java/eclipse/workspace/ASBS/deployable-jars/install/war&quot;<br />
     [nsis] Command line defined: &quot;OUTFILE=asbs-install.exe&quot;<br />
     [nsis] Command line defined: &quot;DOWNLOAD_SERVER=http://xyz:8080/asbs-install&quot;<br />
     [nsis] Command line defined: &quot;ENVIRONMENT=xyz&quot;<br />
     [nsis] Processing config: <br />
     [nsis] Processing plugin dlls: &quot;C:\Program Files\NSIS\Plugins\*.dll&quot;<br />
     [nsis]  - AdvSplash::show<br />
     [nsis]  - Banner::destroy<br />
     [nsis]  - Banner::getWindow<br />
     [nsis]  - Banner::show<br />
     [nsis]  - BgImage::AddImage<br />
     [nsis]  - BgImage::AddText<br />
     [nsis]  - BgImage::Clear<br />
     [nsis]  - BgImage::Destroy<br />
     [nsis]  - BgImage::Redraw<br />
     [nsis]  - BgImage::SetBg<br />
     [nsis]  - BgImage::SetReturn<br />
     [nsis]  - BgImage::Sound<br />
     [nsis]  - Dialer::AttemptConnect<br />
     [nsis]  - Dialer::AutodialHangup<br />
     [nsis]  - Dialer::AutodialOnline<br />
     [nsis]  - Dialer::AutodialUnattended<br />
     [nsis]  - Dialer::GetConnectedState<br />
     [nsis]  - InstallOptions::dialog<br />
     [nsis]  - InstallOptions::initDialog<br />
     [nsis]  - InstallOptions::show<br />
     [nsis]  - LangDLL::LangDialog<br />
     [nsis]  - Math::Script<br />
     [nsis]  - NSISArray::ArrayCount<br />
     [nsis]  - NSISArray::ArrayExists<br />
     [nsis]  - NSISArray::Clear<br />
     [nsis]  - NSISArray::Concat<br />
     [nsis]  - NSISArray::Copy<br />
     [nsis]  - NSISArray::Cut<br />
     [nsis]  - NSISArray::Debug<br />
     [nsis]  - NSISArray::Delete<br />
     [nsis]  - NSISArray::ErrorStyle<br />
     [nsis]  - NSISArray::Exists<br />
     [nsis]  - NSISArray::ExistsI<br />
     [nsis]  - NSISArray::FreeUnusedMem<br />
     [nsis]  - NSISArray::Join<br />
     [nsis]  - NSISArray::New<br />
     [nsis]  - NSISArray::Pop<br />
     [nsis]  - NSISArray::Push<br />
     [nsis]  - NSISArray::Put<br />
     [nsis]  - NSISArray::ReDim<br />
     [nsis]  - NSISArray::Read<br />
     [nsis]  - NSISArray::ReadToStack<br />
     [nsis]  - NSISArray::Reverse<br />
     [nsis]  - NSISArray::Search<br />
     [nsis]  - NSISArray::SearchI<br />
     [nsis]  - NSISArray::SetAutoReDim<br />
     [nsis]  - NSISArray::SetSize<br />
     [nsis]  - NSISArray::Shift<br />
     [nsis]  - NSISArray::SizeOf<br />
     [nsis]  - NSISArray::Sort<br />
     [nsis]  - NSISArray::Splice<br />
     [nsis]  - NSISArray::Subtract<br />
     [nsis]  - NSISArray::Swap<br />
     [nsis]  - NSISArray::Unload<br />
     [nsis]  - NSISArray::Unshift<br />
     [nsis]  - NSISArray::Write<br />
     [nsis]  - NSISArray::WriteList<br />
     [nsis]  - NSISArray::WriteListC<br />
     [nsis]  - NSISdl::download<br />
     [nsis]  - NSISdl::download_quiet<br />
     [nsis]  - Splash::show<br />
     [nsis]  - StartMenu::Init<br />
     [nsis]  - StartMenu::Select<br />
     [nsis]  - StartMenu::Show<br />
     [nsis]  - System::Alloc<br />
     [nsis]  - System::Call<br />
     [nsis]  - System::Copy<br />
     [nsis]  - System::Free<br />
     [nsis]  - System::Get<br />
     [nsis]  - System::Int64Op<br />
     [nsis]  - System::Store<br />
     [nsis]  - TypeLib::GetLibVersion<br />
     [nsis]  - TypeLib::Register<br />
     [nsis]  - TypeLib::UnRegister<br />
     [nsis]  - UserInfo::GetAccountType<br />
     [nsis]  - UserInfo::GetName<br />
     [nsis]  - UserInfo::GetOriginalAccountType<br />
     [nsis]  - VPatch::GetFileCRC32<br />
     [nsis]  - VPatch::GetFileMD5<br />
     [nsis]  - VPatch::vpatchfile<br />
     [nsis]  - ZipDLL::extractall<br />
     [nsis]  - ZipDLL::extractfile<br />
     [nsis]  - inetc::get<br />
     [nsis]  - inetc::head<br />
     [nsis]  - inetc::post<br />
     [nsis]  - inetc::put<br />
     [nsis]  - nsDialogs::Create<br />
     [nsis]  - nsDialogs::CreateControl<br />
     [nsis]  - nsDialogs::CreateItem<br />
     [nsis]  - nsDialogs::GetUserData<br />
     [nsis]  - nsDialogs::OnBack<br />
     [nsis]  - nsDialogs::OnChange<br />
     [nsis]  - nsDialogs::OnClick<br />
     [nsis]  - nsDialogs::OnNotify<br />
     [nsis]  - nsDialogs::SelectFileDialog<br />
     [nsis]  - nsDialogs::SelectFolderDialog<br />
     [nsis]  - nsDialogs::SetRTL<br />
     [nsis]  - nsDialogs::SetUserData<br />
     [nsis]  - nsDialogs::Show<br />
     [nsis]  - nsExec::Exec<br />
     [nsis]  - nsExec::ExecToLog<br />
     [nsis]  - nsExec::ExecToStack<br />
     [nsis] !define: &quot;MUI_INSERT_NSISCONF&quot;=&quot;&quot;<br />
     [nsis] Changing directory to: &quot;C:\java\eclipse\workspace\ASBS\build\install\files&quot;<br />
     [nsis] Processing script file: &quot;C:\java\eclipse\workspace\ASBS\build\install\files\asbs.nsi&quot;<br />
     [nsis] !define: &quot;DOWNLOAD_SERVER_NAME&quot;=&quot;http://xyz:8080/asbs-install&quot;<br />
     [nsis] !define: &quot;OUTDIR_NAME&quot;=&quot;C:/java/eclipse/workspace/ASBS/deployable-jars/install/war&quot;<br />
     [nsis] !define: &quot;OUTFILE_NAME&quot;=&quot;asbs-install.exe&quot;<br />
     [nsis] !define: &quot;LOGICLIB_SECTIONCMP&quot;=&quot;&quot;<br />
     [nsis] !define: &quot;INSTALLER_VERSION&quot;=&quot;1.0.2.0&quot;<br />
     [nsis] !define: &quot;APP_NAME_LONG&quot;=&quot;Selection Board System&quot;<br />
     [nsis] !define: &quot;APP_NAME_SHORT&quot;=&quot;SBS&quot;<br />
     [nsis] !define: &quot;ARCHIVE_NAME&quot;=&quot;Archive Viewer&quot;<br />
     [nsis] !define: &quot;COPYRIGHT_YEAR&quot;=&quot;2008&quot;<br />
     [nsis] !define: &quot;APP_ROOT_REG_KEY&quot;=&quot;Software\$(^Name)\ahrc00wkg2360&quot;<br />
     [nsis] !define: &quot;INSTALL_DIR_REG_KEY&quot;=&quot;Install Directory&quot;<br />
     [nsis] !define: &quot;APPDATA_DIR_REG_KEY&quot;=&quot;Application Data Directory&quot;<br />
     [nsis] !define: &quot;USER_TYPE_REG_KEY&quot;=&quot;User Type&quot;<br />
     [nsis] !define: &quot;START_MENU_FOLDER_REG_KEY&quot;=&quot;Start Menu Folder&quot;<br />
     [nsis] !define: &quot;CLASSPATH_REG_KEY&quot;=&quot;Classpath&quot;<br />
     [nsis] !define: &quot;COMPONENTS_REG_KEY&quot;=&quot;Components&quot;<br />
     [nsis] !define: &quot;CLIENT_COMP_REG_KEY&quot;=&quot;Client&quot;<br />
     [nsis] !define: &quot;IRFANVIEW_COMP_REG_KEY&quot;=&quot;IrfanView&quot;<br />
     [nsis] !define: &quot;JRE_COMP_REG_KEY&quot;=&quot;JRE&quot;<br />
     [nsis] !define: &quot;VERSION_REG_KEY&quot;=&quot;Version&quot;<br />
     [nsis] !define: &quot;BUILD_REG_KEY&quot;=&quot;Build&quot;<br />
     [nsis] !define: &quot;TEMP_DOWNLOAD_DIRECTORY&quot;=&quot;$TEMP\asbs_install&quot;<br />
     [nsis] !define: &quot;INSTALL_PROPS_FILENAME&quot;=&quot;install.properties&quot;<br />
     [nsis] !define: &quot;CLIENT_JAR_FILENAME&quot;=&quot;lib\asbs-client.jar&quot;<br />
     [nsis] !define: &quot;INSTALL_TYPE_FULL&quot;=&quot;full&quot;<br />
     [nsis] !define: &quot;INSTALL_TYPE_UPGRADE&quot;=&quot;upgrade&quot;<br />
     [nsis] !define: &quot;INSTALL_USER_SCRUBBER&quot;=&quot;Scrubber&quot;<br />
     [nsis] !define: &quot;INSTALL_USER_VOTER&quot;=&quot;Voter&quot;<br />
     [nsis] !define: &quot;INSTALL_USER_INI&quot;=&quot;InstallUser.ini&quot;<br />
     [nsis] !define: &quot;ARCHIVE_VIEWER_INI&quot;=&quot;ArchiveViewer.ini&quot;<br />
     [nsis] !define: &quot;INSTALL_READY_INI&quot;=&quot;InstallReady.ini&quot;<br />
     [nsis] !define: &quot;SETTINGS_FILENAME&quot;=&quot;settings.ini&quot;<br />
     [nsis] !define: &quot;CONFIG_PROPS_FILENAME&quot;=&quot;config.properties&quot;<br />
     [nsis] !define: &quot;RELEASE_NOTES_FILENAME&quot;=&quot;Release Notes.doc&quot;<br />
     [nsis] !define: &quot;APP_ICO_FILENAME&quot;=&quot;UncleSam.ico&quot;<br />
     [nsis] !define: &quot;APP_EXE_FILENAME&quot;=&quot;asbs.cmd&quot;<br />
     [nsis] !define: &quot;ARCHIVE_ICO_FILENAME&quot;=&quot;ArchiveViewer.ico&quot;<br />
     [nsis] !define: &quot;ARCHIVE_EXE_FILENAME&quot;=&quot;archive.cmd&quot;<br />
     [nsis] !define: &quot;UNINSTALLER_FILENAME&quot;=&quot;Uninstall.exe&quot;<br />
     [nsis] SetCompressor: /FINAL /SOLID lzma<br />
     [nsis] !include: &quot;C:\Program Files\NSIS\Include\MUI.nsh&quot;<br />
     [nsis] !include: &quot;C:\Program Files\NSIS\Contrib\Modern UI\System.nsh&quot;<br />
<br />
<br />
Here is the .nsi script:<br />
<br />
; asbs.nsi<br />
;<br />
; This script creates an installer for the Selection Board System.<br />
;<br />
; Command Line Flags (specified via /D command line switch):<br />
; CLIENT_VERSION    - required - The version of ASBS to be installed.<br />
; CLIENT_BUILD      - required - The build of ASBS to be installed.<br />
; IRFANVIEW_VERSION - required - The version of IrfanView to be installed.<br />
; JRE_VERSION       - required - The version of Java Runtime Environment to be<br />
;                                installed.<br />
; DOWNLOAD_SERVER   - required - The name and port of the server which will host<br />
;                                the files to be downloaded by this installer.<br />
; ENVIRONMENT       - required - The application environment (e.g., dev,<br />
;                                stl-dev, qa, prod, stl-prod).<br />
; OUTDIR            - optional - The directory where the installer executable<br />
;                                will be saved (e.g., C:\temp, ..\install).<br />
;                                Default: same directory as this file<br />
; OUTFILE           - optional - The name of the installer executable created by<br />
;                                this script. The default value should always be<br />
;                                used except for debugging purposes.<br />
;                                Default: asbs_install.exe<br />
<br />
<br />
;-------------------------------------------------------------------------------<br />
;Configuration<br />
<br />
  !ifndef CLIENT_VERSION<br />
    !error &quot;CLIENT_VERSION flag must be specified.&quot;<br />
  !endif<br />
  !ifndef CLIENT_BUILD<br />
    !error &quot;CLIENT_BUILD flag must be specified.&quot;<br />
  !endif<br />
  !ifndef IRFANVIEW_VERSION<br />
    !error &quot;IRFANVIEW_VERSION flag must be specified.&quot;<br />
  !endif<br />
  !ifndef JRE_VERSION<br />
    !error &quot;JRE_VERSION flag must be specified.&quot;<br />
  !endif<br />
  !ifndef DOWNLOAD_SERVER<br />
    !error &quot;DOWNLOAD_SERVER flag must be specified.&quot;<br />
  !else<br />
    !define DOWNLOAD_SERVER_NAME &quot;${DOWNLOAD_SERVER}&quot;<br />
  !endif<br />
  !ifndef ENVIRONMENT<br />
    !error &quot;ENVIRONMENT flag must be specified.&quot;<br />
  !endif<br />
<br />
  !ifdef OUTDIR<br />
    !if &quot;${OUTDIR}&quot; == &quot;&quot;<br />
      !define OUTDIR_NAME &quot;.&quot;<br />
    !else<br />
      !define OUTDIR_NAME &quot;${OUTDIR}&quot;<br />
    !endif<br />
  !else<br />
    !define OUTDIR_NAME &quot;.&quot;<br />
  !endif<br />
<br />
  !ifdef OUTFILE<br />
    !if &quot;${OUTFILE}&quot; == &quot;&quot;<br />
      !define OUTFILE_NAME &quot;asbs-install.exe&quot;<br />
    !else<br />
      !define OUTFILE_NAME &quot;${OUTFILE}&quot;<br />
    !endif<br />
  !else<br />
    !define OUTFILE_NAME &quot;asbs-install.exe&quot;<br />
  !endif<br />
<br />
  !define LOGICLIB_SECTIONCMP<br />
  !define INSTALLER_VERSION &quot;1.0.2.0&quot;<br />
  !define APP_NAME_LONG &quot;Selection Board System&quot;<br />
  !define APP_NAME_SHORT &quot;ASBS&quot;<br />
  !define ARCHIVE_NAME &quot;Archive Viewer&quot;<br />
  !define /date COPYRIGHT_YEAR &quot;%Y&quot;<br />
  !define APP_ROOT_REG_KEY &quot;Software\$(^Name)\${ENVIRONMENT}&quot;<br />
  !define INSTALL_DIR_REG_KEY &quot;Install Directory&quot;<br />
  !define APPDATA_DIR_REG_KEY &quot;Application Data Directory&quot;<br />
  !define USER_TYPE_REG_KEY &quot;User Type&quot;<br />
  !define START_MENU_FOLDER_REG_KEY &quot;Start Menu Folder&quot;<br />
  !define CLASSPATH_REG_KEY &quot;Classpath&quot;<br />
  !define COMPONENTS_REG_KEY &quot;Components&quot;<br />
  !define CLIENT_COMP_REG_KEY &quot;Client&quot;<br />
  !define IRFANVIEW_COMP_REG_KEY &quot;IrfanView&quot;<br />
  !define JRE_COMP_REG_KEY &quot;JRE&quot;<br />
  !define VERSION_REG_KEY &quot;Version&quot;<br />
  !define BUILD_REG_KEY &quot;Build&quot;<br />
  !define TEMP_DOWNLOAD_DIRECTORY &quot;$TEMP\asbs_install&quot;<br />
  !define INSTALL_PROPS_FILENAME &quot;install.properties&quot;<br />
  !define CLIENT_JAR_FILENAME &quot;lib\asbs-client.jar&quot;<br />
  !define INSTALL_TYPE_FULL &quot;full&quot;<br />
  !define INSTALL_TYPE_UPGRADE &quot;upgrade&quot;<br />
  !define INSTALL_USER_SCRUBBER &quot;Scrubber&quot;<br />
  !define INSTALL_USER_VOTER &quot;Voter&quot;<br />
  !define INSTALL_USER_INI &quot;InstallUser.ini&quot;<br />
  !define ARCHIVE_VIEWER_INI &quot;ArchiveViewer.ini&quot;<br />
  !define INSTALL_READY_INI &quot;InstallReady.ini&quot;<br />
  !define SETTINGS_FILENAME &quot;settings.ini&quot;<br />
  !define CONFIG_PROPS_FILENAME &quot;config.properties&quot;<br />
  !define RELEASE_NOTES_FILENAME &quot;Release Notes.doc&quot;<br />
  !define APP_ICO_FILENAME &quot;UncleSam.ico&quot;<br />
  !define APP_EXE_FILENAME &quot;asbs.cmd&quot;<br />
  !define ARCHIVE_ICO_FILENAME &quot;ArchiveViewer.ico&quot;<br />
  !define ARCHIVE_EXE_FILENAME &quot;archive.cmd&quot;<br />
  !define UNINSTALLER_FILENAME &quot;Uninstall.exe&quot;<br />
<br />
  !macro AddConfirmItem item list delim<br />
    ${If} ${list} == &quot;&quot;<br />
      StrCpy ${list} &quot;${item}&quot;<br />
    ${Else}<br />
      StrCpy ${list} &quot;${list}${delim}${item}&quot;<br />
    ${EndIf}<br />
  !macroend<br />
<br />
  !macro CheckStartMenu<br />
    ; check to see if shortcuts were created during a previous install<br />
    ReadRegStr $R0 &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}&quot; &quot;${START_MENU_FOLDER_REG_KEY}&quot;<br />
    ${If} ${Errors}<br />
      StrCpy $SKIP_STARTMENU ${FALSE}   ; do not skip start menu page<br />
    ${Else}<br />
      StrCpy $SKIP_STARTMENU ${TRUE}    ; skip start menu page<br />
      StrCpy $STARTMENU_FOLDER $R0<br />
    ${EndIf}<br />
  !macroend<br />
<br />
  SetCompressor /SOLID /FINAL lzma<br />
<br />
;--------------------------------<br />
;Includes<br />
<br />
  !include MUI.nsh<br />
  !include WinMessages.nsh<br />
  !include Sections.nsh<br />
  !include LogicLib.nsh<br />
  !include StrFunc.nsh<br />
  !include ZipDLL.nsh<br />
  !include TextFunc.nsh<br />
  !include FileFunc.nsh<br />
  !include NSISArray.nsh<br />
  ${StrLoc}<br />
  !insertmacro ConfigRead<br />
  !insertmacro Locate<br />
<br />
;--------------------------------<br />
;Variables<br />
<br />
  Var SECTION_DESC_CLIENT<br />
  Var SECTION_DESC_IRFANVIEW<br />
  Var SECTION_DESC_JRE<br />
  Var CLIENT_ZIP_FILENAME<br />
  Var IRFANVIEW_ZIP_FILENAME<br />
  Var JRE_ZIP_FILENAME<br />
  Var INSTALLED_CLIENT_VER<br />
  Var INSTALLED_CLIENT_BUILD<br />
  Var INSTALLED_IRFANVIEW_VER<br />
  Var INSTALLED_JRE_VER<br />
  Var DO_INSTALL_CLIENT<br />
  Var DO_INSTALL_IRFANVIEW<br />
  Var DO_INSTALL_JRE<br />
  Var INSTALL_TYPE<br />
  Var STARTMENU_FOLDER<br />
  Var SKIP_STARTMENU<br />
  Var INSTALL_USER<br />
  Var INSTALL_ARCHIVE_VIEWER<br />
  Var CHECK_INSTALL_ARCHIVE_VIEWER<br />
  Var RETRIEVED_HEADERS<br />
  Var INSTALL_DIR_PREEXISTS<br />
  Var APP_DATA_DIR_PREEXISTS<br />
  Var APP_DATA_DIRECTORY<br />
  Var LOGS_DIRECTORY<br />
  Var SETTINGS_DIRECTORY<br />
  ${Array} &quot;LogsArray&quot; 7 50<br />
  ${ArrayFunc} WriteListC<br />
  ${ArrayFunc} SizeOf<br />
  ${ArrayFunc} Read<br />
<br />
;--------------------------------<br />
;Configuration<br />
  ;Names<br />
  Name &quot;${APP_NAME_SHORT}&quot;<br />
  Caption &quot;$(^Name) ${CLIENT_VERSION} Setup&quot;<br />
  OutFile &quot;${OUTDIR_NAME}\${OUTFILE_NAME}&quot;<br />
<br />
  SetDateSave on<br />
  SetDatablockOptimize on<br />
  CRCCheck force<br />
  SilentInstall normal<br />
  BGGradient off<br />
  InstallColors /windows<br />
  XPStyle on<br />
  AllowSkipFiles off<br />
  AutoCloseWindow false<br />
  ShowInstDetails hide<br />
  BrandingText &quot;Human Resources&quot;<br />
<br />
  ;Default installation folder<br />
  InstallDir &quot;$PROGRAMFILES\$(^Name)&quot;<br />
<br />
  ;Get installation folder from registry if available<br />
  InstallDirRegKey &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}&quot; &quot;${INSTALL_DIR_REG_KEY}&quot;<br />
<br />
  ;Interface Settings<br />
  !define MUI_CUSTOMFUNCTION_Abort myUserAbort<br />
  !define MUI_ICON &quot;setup.ico&quot;<br />
  !define MUI_UNICON &quot;uninstall.ico&quot;<br />
  !define MUI_HEADERIMAGE<br />
  !define MUI_HEADERIMAGE_BITMAP &quot;.\UncleSamHeader.bmp&quot;<br />
  !define MUI_HEADERIMAGE_UNBITMAP &quot;${NSISDIR}\Contrib\Graphics\Header\win.bmp&quot;<br />
  !define MUI_COMPONENTSPAGE_CHECKBITMAP &quot;${NSISDIR}\Contrib\Graphics\Checks\modern.bmp&quot;<br />
  !define MUI_COMPONENTSPAGE_SMALLDESC<br />
  !define MUI_UNWELCOMEFINISHPAGE_BITMAP &quot;${NSISDIR}\Contrib\Graphics\Wizard\win.bmp&quot;<br />
  !define MUI_ABORTWARNING<br />
<br />
;--------------------------------<br />
;Pages<br />
<br />
  !define MUI_WELCOMEPAGE_TITLE &quot;Welcome to the $(^Name) ${CLIENT_VERSION} Setup Wizard&quot;<br />
  !define MUI_WELCOMEPAGE_TEXT &quot;This wizard will guide you through the installation of $(^Name) (${APP_NAME_LONG}) ${CLIENT_VERSION}.\r\n\r\n$_CLICK&quot;<br />
  !define MUI_COMPONENTSPAGE_TEXT_TOP &quot;The following components will be installed for $(^Name). $_CLICK&quot;<br />
  !define MUI_COMPONENTSPAGE_TEXT_COMPLIST &quot;Components to be installed:&quot;<br />
  !define MUI_FINISHPAGE_TITLE &quot;$(^Name) ${CLIENT_VERSION} Setup Complete&quot;<br />
  !define MUI_FINISHPAGE_TEXT &quot;${APP_NAME_LONG} ${CLIENT_VERSION} has been installed successfully.\r\n\r\n$_CLICK&quot;<br />
  !define MUI_FINISHPAGE_SHOWREADME &quot;$INSTDIR\${RELEASE_NOTES_FILENAME}&quot;<br />
  !define MUI_FINISHPAGE_SHOWREADME_TEXT &quot;Show Release Notes&quot;<br />
  !define MUI_FINISHPAGE_RUN_FUNCTION FinishPageRun<br />
  !define MUI_FINISHPAGE_RUN<br />
<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE PreWelcomePage<br />
  !define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveWelcomePage<br />
  !insertmacro MUI_PAGE_WELCOME<br />
  Page custom CreateInstallTypePage LeaveInstallTypePage<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE PreComponentsPage<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW ShowComponentsPage<br />
  !insertmacro MUI_PAGE_COMPONENTS<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW ShowDirectoryPage<br />
  !define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveDirectoryPage<br />
  DirText &quot;&quot; &quot;&quot; &quot;&quot; &quot;Select the folder in which to install $(^Name) (note: you must have rights to the selected folder):&quot;<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  Page custom CreateArchiveViewerPage LeaveArchiveViewerPage<br />
  !define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;${APP_NAME_LONG}&quot;<br />
  !define MUI_STARTMENUPAGE_REGISTRY_ROOT &quot;HKLM&quot; <br />
  !define MUI_STARTMENUPAGE_REGISTRY_KEY &quot;${APP_ROOT_REG_KEY}&quot; <br />
  !define MUI_STARTMENUPAGE_REGISTRY_VALUENAME &quot;${START_MENU_FOLDER_REG_KEY}&quot;<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE PreStartMenuPage<br />
  !insertmacro MUI_PAGE_STARTMENU Application $STARTMENU_FOLDER<br />
  Page custom CreateInstallReadyPage<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
  !define MUI_FINISHPAGE_NOAUTOCLOSE<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE PreFinishPage<br />
  !define MUI_PAGE_CUSTOMFUNCTION_SHOW ShowFinishPage<br />
  !define MUI_PAGE_CUSTOMFUNCTION_LEAVE LeaveFinishPage<br />
  !insertmacro MUI_PAGE_FINISH<br />
<br />
  !insertmacro MUI_UNPAGE_WELCOME<br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  !insertmacro MUI_UNPAGE_INSTFILES<br />
  !define MUI_UNFINISHPAGE_NOAUTOCLOSE<br />
  !define MUI_PAGE_CUSTOMFUNCTION_PRE un.PreFinishPage<br />
  !insertmacro MUI_UNPAGE_FINISH<br />
  <br />
;--------------------------------<br />
;Languages<br />
 <br />
  !insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
;--------------------------------<br />
;Version Information<br />
<br />
  VIProductVersion &quot;${INSTALLER_VERSION}&quot;<br />
  VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;ProductName&quot; &quot;${APP_NAME_SHORT}&quot;<br />
  VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;Comments&quot; &quot;Install ${APP_NAME_LONG}&quot;<br />
  VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;CompanyName&quot; &quot;Human Resources&quot;<br />
  VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;LegalCopyright&quot; &quot;Â© ${COPYRIGHT_YEAR} XYZ&quot;<br />
  VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;OriginalFilename&quot; &quot;${OUTFILE_NAME}&quot;<br />
  VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;FileDescription&quot; &quot;${APP_NAME_SHORT} Installer&quot;<br />
  VIAddVersionKey /LANG=${LANG_ENGLISH} &quot;FileVersion&quot; &quot;${CLIENT_VERSION}${CLIENT_BUILD}&quot;<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;-Initialization&quot;<br />
  ${If} ${FileExists} $APP_DATA_DIRECTORY<br />
    StrCpy $APP_DATA_DIR_PREEXISTS ${TRUE}<br />
  ${Else}<br />
    StrCpy $APP_DATA_DIR_PREEXISTS ${FALSE}<br />
    CreateDirectory $APP_DATA_DIRECTORY ; create the application data folder<br />
  ${EndIf}<br />
  ${Unless} ${FileExists} $LOGS_DIRECTORY<br />
    CreateDirectory $LOGS_DIRECTORY<br />
  ${EndUnless}<br />
  ${Unless} ${FileExists} $SETTINGS_DIRECTORY<br />
    CreateDirectory $SETTINGS_DIRECTORY<br />
  ${EndUnless}<br />
<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_FULL}&quot;<br />
    ClearErrors<br />
    ${If} ${FileExists} $INSTDIR<br />
      StrCpy $INSTALL_DIR_PREEXISTS ${TRUE}<br />
    ${Else}<br />
      StrCpy $INSTALL_DIR_PREEXISTS ${FALSE}<br />
      CreateDirectory $INSTDIR ; create the folder where ASBS will be installed<br />
    ${EndIf}<br />
    ${If} ${Errors}<br />
      MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
        &quot;Could not create installation directory. Verify you have the proper permissions on your PC.$\r$\nInstallation will be aborted.&quot; \<br />
        /SD IDOK<br />
      Call AbortInstall<br />
    ${EndIf}<br />
  ${EndIf}<br />
SectionEnd<br />
<br />
SectionGroup /e &quot;${APP_NAME_LONG}&quot; SecASBS<br />
  Section &quot;$(^Name) Client Software&quot; SecClient<br />
    SectionIn RO<br />
<br />
    ${If} $DO_INSTALL_CLIENT == ${TRUE}<br />
      inetc::get /TIMEOUT 30000 \<br />
        &quot;${DOWNLOAD_SERVER_NAME}/files/$CLIENT_ZIP_FILENAME&quot; \<br />
        &quot;${TEMP_DOWNLOAD_DIRECTORY}\$CLIENT_ZIP_FILENAME&quot;<br />
      Pop $0<br />
      ${If} $0 != &quot;OK&quot;<br />
        MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
          &quot;Unable to download client files from server '${DOWNLOAD_SERVER_NAME}'.$\r$\nInstallation will be aborted.$\r$\n$\r$\nError: $0&quot; \<br />
          /SD IDOK<br />
        Call AbortInstall<br />
      ${EndIf}<br />
      SetDetailsPrint both<br />
      DetailPrint &quot;Client download complete&quot;<br />
      SetDetailsPrint listonly<br />
      ClearErrors<br />
      !insertmacro ZIPDLL_EXTRACT &quot;${TEMP_DOWNLOAD_DIRECTORY}\$CLIENT_ZIP_FILENAME&quot; &quot;$INSTDIR&quot; &quot;&lt;ALL&gt;&quot;<br />
      ${If} ${Errors}<br />
        MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
          &quot;Error occurred extracting $CLIENT_ZIP_FILENAME.$\r$\nInstallation will be aborted.&quot; \<br />
          /SD IDOK<br />
        Abort<br />
      ${EndIf}<br />
      ${If} $INSTALL_ARCHIVE_VIEWER == ${FALSE}<br />
        Delete &quot;$INSTDIR\${ARCHIVE_EXE_FILENAME}&quot;<br />
        Delete &quot;$INSTDIR\${ARCHIVE_ICO_FILENAME}&quot;<br />
      ${EndIf}<br />
      ${If} $INSTALL_USER == ${INSTALL_USER_SCRUBBER}<br />
        Delete &quot;$INSTDIR\lib\${CONFIG_PROPS_FILENAME}&quot;<br />
        Rename /REBOOTOK &quot;$INSTDIR\lib\scrubber_${CONFIG_PROPS_FILENAME}&quot; &quot;$INSTDIR\lib\${CONFIG_PROPS_FILENAME}&quot;<br />
        Delete /REBOOTOK &quot;$INSTDIR\lib\voter_${CONFIG_PROPS_FILENAME}&quot;<br />
      ${ElseIf} $INSTALL_USER == ${INSTALL_USER_VOTER}<br />
        Delete &quot;$INSTDIR\lib\${CONFIG_PROPS_FILENAME}&quot;<br />
        Rename /REBOOTOK &quot;$INSTDIR\lib\voter_${CONFIG_PROPS_FILENAME}&quot; &quot;$INSTDIR\lib\${CONFIG_PROPS_FILENAME}&quot;<br />
        Delete /REBOOTOK &quot;$INSTDIR\lib\scrubber_${CONFIG_PROPS_FILENAME}&quot;<br />
      ${EndIf}<br />
      SetDetailsPrint both<br />
      DetailPrint &quot;Client installation complete&quot;<br />
      SetDetailsPrint listonly<br />
    ${EndIf}<br />
  SectionEnd<br />
<br />
  Section &quot;IrfanView Software&quot; SecIrfanView<br />
    SectionIn RO<br />
<br />
    ${If} $DO_INSTALL_IRFANVIEW == ${TRUE}<br />
      inetc::get /TIMEOUT 30000 \<br />
        &quot;${DOWNLOAD_SERVER_NAME}/files/$IRFANVIEW_ZIP_FILENAME&quot; \<br />
        &quot;${TEMP_DOWNLOAD_DIRECTORY}\$IRFANVIEW_ZIP_FILENAME&quot;<br />
      Pop $0<br />
      ${If} $0 != &quot;OK&quot;<br />
        MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
          &quot;Unable to download IrfanView files from server '${DOWNLOAD_SERVER_NAME}'.$\r$\nInstallation will be aborted.$\r$\n$\r$\nError: $0&quot; \<br />
          /SD IDOK<br />
        Call AbortInstall<br />
      ${EndIf}<br />
      SetDetailsPrint both<br />
      DetailPrint &quot;IrfanView download complete&quot;<br />
      SetDetailsPrint listonly<br />
      ClearErrors<br />
      !insertmacro ZIPDLL_EXTRACT &quot;${TEMP_DOWNLOAD_DIRECTORY}\$IRFANVIEW_ZIP_FILENAME&quot; &quot;$INSTDIR&quot; &quot;&lt;ALL&gt;&quot;<br />
      ${If} ${Errors}<br />
        MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
          &quot;Error occurred extracting $IRFANVIEW_ZIP_FILENAME.$\r$\nInstallation will be aborted.&quot; \<br />
          /SD IDOK<br />
        Abort<br />
      ${EndIf}<br />
      SetDetailsPrint both<br />
      DetailPrint &quot;IrfanView installation complete&quot;<br />
      SetDetailsPrint listonly<br />
    ${EndIf}<br />
  SectionEnd<br />
SectionGroupEnd<br />
<br />
Section &quot;Java Runtime Environment&quot; SecJRE<br />
  SectionIn RO<br />
<br />
  ${If} $DO_INSTALL_JRE == ${TRUE}<br />
    SetDetailsPrint both<br />
    DetailPrint &quot;Removing previous JRE&quot;<br />
    SetDetailsPrint listonly<br />
    RMDir /r $INSTDIR/jre<br />
    ClearErrors<br />
    SetDetailsPrint both<br />
    DetailPrint &quot;Downloading JRE&quot;<br />
    SetDetailsPrint listonly<br />
    inetc::get /TIMEOUT 30000 \<br />
      &quot;${DOWNLOAD_SERVER_NAME}/files/$JRE_ZIP_FILENAME&quot; \<br />
      &quot;${TEMP_DOWNLOAD_DIRECTORY}\$JRE_ZIP_FILENAME&quot;<br />
    Pop $0<br />
    ${If} $0 != &quot;OK&quot;<br />
      MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
        &quot;Unable to download Java Runtime Environment files from server '${DOWNLOAD_SERVER_NAME}'.$\r$\nInstallation will be aborted.$\r$\n$\r$\nError: $0&quot; \<br />
        /SD IDOK<br />
      Call AbortInstall<br />
    ${EndIf}<br />
    SetDetailsPrint both<br />
    DetailPrint &quot;JRE download complete&quot;<br />
    SetDetailsPrint listonly<br />
    ClearErrors<br />
    !insertmacro ZIPDLL_EXTRACT &quot;${TEMP_DOWNLOAD_DIRECTORY}\$JRE_ZIP_FILENAME&quot; &quot;$INSTDIR&quot; &quot;&lt;ALL&gt;&quot;<br />
    ${If} ${Errors}<br />
      MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
        &quot;Error occurred extracting $JRE_ZIP_FILENAME.$\r$\nInstallation will be aborted.&quot; \<br />
        /SD IDOK<br />
      Abort<br />
    ${EndIf}<br />
    SetDetailsPrint both<br />
    DetailPrint &quot;JRE installation complete&quot;<br />
    SetDetailsPrint listonly<br />
  ${EndIf}<br />
SectionEnd<br />
<br />
Section &quot;-Finalization&quot;<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_UPGRADE}&quot;<br />
    SetDetailsPrint textonly<br />
    DetailPrint &quot;Removing old files...&quot;<br />
    SetDetailsPrint listonly<br />
    Delete /REBOOTOK $APP_DATA_DIRECTORY\.keystore<br />
    Delete /REBOOTOK $INSTDIR\ASBS_RELEASE_NOTES.RTF<br />
    Delete /REBOOTOK $INSTDIR\lib\commons-collections-3.2.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\commons-io-1.1.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\commons-lang-2.1.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\l2fprod-common-directorychooser.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\jcalendar.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\jcommon-1.0.0.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\jcommon-1.0.10.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\jfreechart-1.0.0.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\jfreechart-1.0.6.jar<br />
    Delete /REBOOTOK $INSTDIR\lib\ojdbc14[10.2.0.3].jar<br />
    Delete /REBOOTOK $INSTDIR\lib\ojdbc14_10g[10.1.0.5.0].jar<br />
    Delete /REBOOTOK $INSTDIR\lib\oracle-thin[10g-1.4].jar<br />
    Delete /REBOOTOK $INSTDIR\lib\swinglabs.jar<br />
  ${EndIf}<br />
<br />
  SetDetailsPrint textonly<br />
  DetailPrint &quot;Updating registry...&quot;<br />
  SetDetailsPrint listonly<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_FULL}&quot;<br />
    ; write general application values<br />
    WriteRegStr HKLM &quot;${APP_ROOT_REG_KEY}&quot; &quot;${INSTALL_DIR_REG_KEY}&quot; &quot;$INSTDIR&quot;<br />
    WriteRegStr HKLM &quot;${APP_ROOT_REG_KEY}&quot; &quot;${APPDATA_DIR_REG_KEY}&quot; &quot;$APP_DATA_DIRECTORY&quot;<br />
    WriteRegStr HKLM &quot;${APP_ROOT_REG_KEY}&quot; &quot;${USER_TYPE_REG_KEY}&quot; &quot;$INSTALL_USER&quot;<br />
  ${EndIf}<br />
<br />
  ; write specific component values<br />
  ${If} $DO_INSTALL_CLIENT == ${TRUE}<br />
    WriteRegStr HKLM &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${CLIENT_COMP_REG_KEY}&quot; &quot;${VERSION_REG_KEY}&quot; &quot;${CLIENT_VERSION}&quot;<br />
    WriteRegStr HKLM &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${CLIENT_COMP_REG_KEY}&quot; &quot;${BUILD_REG_KEY}&quot; &quot;${CLIENT_BUILD}&quot;<br />
  ${EndIf}<br />
  ${If} $DO_INSTALL_IRFANVIEW == ${TRUE}<br />
    WriteRegStr HKLM &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${IRFANVIEW_COMP_REG_KEY}&quot; &quot;${VERSION_REG_KEY}&quot; &quot;${IRFANVIEW_VERSION}&quot;<br />
  ${EndIf}<br />
  ${If} $DO_INSTALL_JRE == ${TRUE}<br />
    WriteRegStr HKLM &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${JRE_COMP_REG_KEY}&quot; &quot;${VERSION_REG_KEY}&quot; &quot;${JRE_VERSION}&quot;<br />
  ${EndIf}<br />
<br />
  ; write uninstall strings<br />
  StrCpy $R0 &quot;$(^Name) (${APP_NAME_LONG})&quot;<br />
  ${If} ${ENVIRONMENT} != &quot;prod&quot;<br />
    StrCpy $R0 &quot;$R0 - ${ENVIRONMENT}&quot;<br />
  ${EndIf}<br />
  WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)-${ENVIRONMENT}&quot; &quot;DisplayName&quot; &quot;$R0&quot;<br />
  WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)-${ENVIRONMENT}&quot; &quot;UninstallString&quot; '&quot;$INSTDIR\${UNINSTALLER_FILENAME}&quot;'<br />
<br />
  SetDetailsPrint textonly<br />
  DetailPrint &quot;Creating uninstaller...&quot;<br />
  SetDetailsPrint listonly<br />
<br />
  SetOutPath $INSTDIR<br />
  WriteUninstaller &quot;${UNINSTALLER_FILENAME}&quot;<br />
<br />
  !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
    SetDetailsPrint textonly<br />
    DetailPrint &quot;Creating application shortcuts...&quot;<br />
    SetDetailsPrint listonly<br />
<br />
    ;Create shortcuts<br />
    SetOutPath &quot;$INSTDIR&quot;<br />
    SetShellVarContext all<br />
    CreateDirectory &quot;$SMPROGRAMS\$STARTMENU_FOLDER&quot;<br />
    CreateShortCut &quot;$SMPROGRAMS\$STARTMENU_FOLDER\$(^Name).lnk&quot; &quot;$INSTDIR\${APP_EXE_FILENAME}&quot; &quot;&quot; &quot;$INSTDIR\${APP_ICO_FILENAME}&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;${APP_NAME_LONG}&quot;<br />
    ${If} $INSTALL_ARCHIVE_VIEWER == ${TRUE}<br />
      CreateShortCut &quot;$SMPROGRAMS\$STARTMENU_FOLDER\${ARCHIVE_NAME}.lnk&quot; &quot;$INSTDIR\${ARCHIVE_EXE_FILENAME}&quot; &quot;&quot; &quot;$INSTDIR\${ARCHIVE_ICO_FILENAME}&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;$(^Name) ${ARCHIVE_NAME}&quot;<br />
    ${EndIf}<br />
    CreateShortCut &quot;$SMPROGRAMS\$STARTMENU_FOLDER\Release Notes.lnk&quot; &quot;$INSTDIR\${RELEASE_NOTES_FILENAME}&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;$(^Name) Release Notes&quot;<br />
    CreateShortCut &quot;$SMPROGRAMS\$STARTMENU_FOLDER\Uninstall $(^Name).lnk&quot; &quot;$INSTDIR\${UNINSTALLER_FILENAME}&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;Remove $(^Name) Application&quot;<br />
    SetShellVarContext current<br />
  !insertmacro MUI_STARTMENU_WRITE_END<br />
<br />
  ; set files to not have readonly attribute, otherwise errors will occur during upgrade<br />
  ${Locate} &quot;$INSTDIR&quot; &quot;/L=FD /M=*.*&quot; &quot;LocateCallback&quot;<br />
  ${If} ${Errors}<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
      &quot;Error occurred trying to set file attributes.$\r$\nInstallation will be aborted.&quot; \<br />
      /SD IDOK<br />
    Abort<br />
  ${EndIf}<br />
<br />
  SetDetailsPrint textonly<br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Functions<br />
<br />
Function LocateCallback<br />
  ; set file to not have any attributes (readonly, etc.)<br />
  SetFileAttributes $R9 FILE_ATTRIBUTE_NORMAL<br />
  Push $0<br />
FunctionEnd<br />
<br />
Function CleanUp<br />
  ; delete temporary directory used to store downloaded files<br />
  RMDir /r /REBOOTOK ${TEMP_DOWNLOAD_DIRECTORY}<br />
<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_UPGRADE}&quot;<br />
    ; delete this installer on upgrades<br />
    Delete /REBOOTOK $EXEDIR\${OUTFILE_NAME}<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function AbortCleanUp<br />
  ${If} $INSTALL_TYPE == ${INSTALL_TYPE_FULL}<br />
    ; a full installation was aborted so check for folders to delete<br />
    ${If} $APP_DATA_DIR_PREEXISTS == &quot;${FALSE}&quot;<br />
      ; delete application data folder<br />
      RMDir /r /REBOOTOK &quot;$APP_DATA_DIRECTORY&quot;<br />
    ${EndIf}<br />
    ${If} $INSTALL_DIR_PREEXISTS == &quot;${FALSE}&quot;<br />
      ; delete install folder<br />
      RMDir /r /REBOOTOK $INSTDIR<br />
    ${EndIf}<br />
  ${EndIf}<br />
<br />
  Call CleanUp<br />
FunctionEnd<br />
<br />
Function AbortInstall<br />
  Call AbortCleanUp<br />
  Quit<br />
FunctionEnd<br />
<br />
Function .onInstFailed<br />
  Call AbortInstall<br />
FunctionEnd<br />
<br />
Function myUserAbort<br />
  Call AbortCleanUp<br />
FunctionEnd<br />
<br />
Function .onInit<br />
  InitPluginsDir<br />
  File /oname=$PLUGINSDIR\install.bmp &quot;.\UncleSamInstall.bmp&quot;<br />
  File /oname=$PLUGINSDIR\upgrade.bmp &quot;.\UncleSamUpgrade.bmp&quot;<br />
<br />
  StrCpy $APP_DATA_DIRECTORY &quot;$APPDATA\${APP_NAME_SHORT}\${ENVIRONMENT}&quot;<br />
  StrCpy $LOGS_DIRECTORY &quot;$APP_DATA_DIRECTORY\logs&quot;<br />
  StrCpy $SETTINGS_DIRECTORY &quot;$APP_DATA_DIRECTORY\settings&quot;<br />
  ${If} ${ENVIRONMENT} != &quot;prod&quot;<br />
    StrCpy $INSTDIR &quot;$INSTDIR-${ENVIRONMENT}&quot;<br />
  ${EndIf}<br />
<br />
  ; create temporary directory to store downloaded files<br />
  CreateDirectory ${TEMP_DOWNLOAD_DIRECTORY}<br />
  StrCpy $RETRIEVED_HEADERS ${FALSE}<br />
<br />
  StrCpy $DO_INSTALL_CLIENT ${TRUE}<br />
  StrCpy $DO_INSTALL_IRFANVIEW ${TRUE}<br />
  StrCpy $DO_INSTALL_JRE ${TRUE}<br />
  StrCpy $INSTALL_ARCHIVE_VIEWER ${TRUE}<br />
  ${If} ${FileExists} $INSTDIR\${ARCHIVE_EXE_FILENAME}<br />
    StrCpy $CHECK_INSTALL_ARCHIVE_VIEWER ${FALSE}<br />
  ${Else}<br />
    StrCpy $CHECK_INSTALL_ARCHIVE_VIEWER ${TRUE}<br />
  ${EndIf}<br />
<br />
  ; determine if need to perform full install or upgrade<br />
  ReadRegStr $R0 &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}&quot; &quot;${INSTALL_DIR_REG_KEY}&quot;<br />
  ${If} ${Errors}<br />
    ; registry key does not exist so need to perform a full install<br />
    StrCpy $INSTALL_TYPE ${INSTALL_TYPE_FULL}<br />
  ${Else}<br />
    ; registry key exists so need to perform an upgrade<br />
    StrCpy $INSTALL_TYPE ${INSTALL_TYPE_UPGRADE}<br />
    ReadRegStr $INSTALL_USER &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}&quot; &quot;${USER_TYPE_REG_KEY}&quot;<br />
    ReadRegStr $INSTALLED_CLIENT_VER &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${CLIENT_COMP_REG_KEY}&quot; &quot;${VERSION_REG_KEY}&quot;<br />
    ReadRegStr $INSTALLED_CLIENT_BUILD &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${CLIENT_COMP_REG_KEY}&quot; &quot;${BUILD_REG_KEY}&quot;<br />
    ReadRegStr $INSTALLED_IRFANVIEW_VER &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${IRFANVIEW_COMP_REG_KEY}&quot; &quot;${VERSION_REG_KEY}&quot;<br />
    ReadRegStr $INSTALLED_JRE_VER &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}\${JRE_COMP_REG_KEY}&quot; &quot;${VERSION_REG_KEY}&quot;<br />
<br />
    ${If} $INSTALLED_CLIENT_VER == &quot;${CLIENT_VERSION}&quot;<br />
    ${AndIf} $INSTALLED_CLIENT_BUILD == &quot;${CLIENT_BUILD}&quot;<br />
      StrCpy $DO_INSTALL_CLIENT ${FALSE}       ; client versions are equal<br />
    ${EndIf}<br />
<br />
    ${If} $INSTALLED_IRFANVIEW_VER == &quot;${IRFANVIEW_VERSION}&quot;<br />
      StrCpy $DO_INSTALL_IRFANVIEW ${FALSE}    ; IrfanView versions are equal<br />
    ${EndIf}<br />
<br />
    ${If} $INSTALLED_JRE_VER == &quot;${JRE_VERSION}&quot;<br />
      StrCpy $DO_INSTALL_JRE ${FALSE}          ; JRE versions are equal<br />
    ${EndIf}<br />
<br />
    !insertmacro CheckStartMenu<br />
  ${EndIf}<br />
<br />
  ; load custom pages<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;${INSTALL_USER_INI}&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;${ARCHIVE_VIEWER_INI}&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;${INSTALL_READY_INI}&quot;<br />
<br />
  ; disable ASBS section group<br />
  !insertmacro SetSectionFlag ${SecASBS} ${SF_RO}<br />
<br />
  StrCpy $R0 &quot;is up-to-date and will not be upgraded&quot;<br />
  ${If} $DO_INSTALL_CLIENT == ${TRUE}<br />
    StrCpy $SECTION_DESC_CLIENT &quot;$(^Name) core files&quot;<br />
  ${Else}<br />
    SectionGetText ${SecClient} $0<br />
    StrCpy $SECTION_DESC_CLIENT &quot;$0 $R0&quot;<br />
  ${EndIf}<br />
  ${If} $DO_INSTALL_IRFANVIEW == ${TRUE}<br />
    StrCpy $SECTION_DESC_IRFANVIEW &quot;IrfanView application for image manipulation&quot;<br />
  ${Else}<br />
    SectionGetText ${SecIrfanView} $0<br />
    StrCpy $SECTION_DESC_IRFANVIEW &quot;$0 $R0&quot;<br />
  ${EndIf}<br />
  ${If} $DO_INSTALL_JRE == ${TRUE}<br />
    StrCpy $SECTION_DESC_JRE &quot;Java Runtime Environment used to launch $(^Name)&quot;<br />
  ${Else}<br />
    SectionGetText ${SecJRE} $0<br />
    StrCpy $SECTION_DESC_JRE &quot;$0 $R0&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function .onGUIEnd<br />
  Call CleanUp<br />
FunctionEnd<br />
<br />
Function PreWelcomePage<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_FULL}&quot;<br />
    ; this is a full install<br />
    StrCpy $R0 &quot;$PLUGINSDIR\install.bmp&quot;<br />
  ${ElseIf} $INSTALL_TYPE == &quot;${INSTALL_TYPE_UPGRADE}&quot;<br />
    ; this is an upgrade<br />
    StrCpy $R0 &quot;$PLUGINSDIR\upgrade.bmp&quot;<br />
  ${EndIf}<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;$R0&quot;<br />
<br />
  ${If} $DO_INSTALL_CLIENT == ${FALSE}<br />
  ${AndIf} $DO_INSTALL_IRFANVIEW == ${FALSE}<br />
  ${AndIf} $DO_INSTALL_JRE == ${FALSE}<br />
    ; exit install if no newer versions found<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Field 3&quot; &quot;Text&quot; \<br />
      &quot;The current installation of $(^Name) is completely up-to-date.\r\n\r\nClick $(^CancelBtn) to exit.&quot;<br />
    GetDlgItem $0 $HWNDPARENT 1    ; gets the Next button<br />
    EnableWindow $0 0              ; disables the Next button<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function LeaveWelcomePage<br />
  ${If} $RETRIEVED_HEADERS == ${FALSE}<br />
    inetc::get /NOCANCEL /TIMEOUT 30000 \<br />
      /CAPTION &quot;$(^Name) ${CLIENT_VERSION} Setup&quot; \<br />
      /BANNER &quot;Downloading installation properties from server.$\r$\n$\r$\nPlease Wait...&quot; \<br />
      ${DOWNLOAD_SERVER_NAME}/files/${INSTALL_PROPS_FILENAME} \<br />
      ${TEMP_DOWNLOAD_DIRECTORY}\${INSTALL_PROPS_FILENAME} /END<br />
    Pop $0<br />
    ${If} $0 != &quot;OK&quot;<br />
      MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
        &quot;Unable to download installation properties file from server '${DOWNLOAD_SERVER_NAME}'.$\r$\nInstallation will be aborted.$\r$\n$\r$\nError: $0&quot; \<br />
        /SD IDOK<br />
      Call AbortInstall<br />
    ${EndIf}<br />
<br />
    ${If} $DO_INSTALL_CLIENT == ${TRUE}<br />
      ${ConfigRead} &quot;${TEMP_DOWNLOAD_DIRECTORY}\${INSTALL_PROPS_FILENAME}&quot; &quot;CLIENT_COMPRESSED_FILENAME=&quot; $CLIENT_ZIP_FILENAME<br />
      ${ConfigRead} &quot;${TEMP_DOWNLOAD_DIRECTORY}\${INSTALL_PROPS_FILENAME}&quot; &quot;CLIENT_SIZE_UNCOMPRESSED=&quot; $R1<br />
      ; set section size in kilobytes<br />
      IntOp $R1 $R1 / 1024<br />
      SectionSetSize SecClient $R1<br />
    ${EndIf}<br />
<br />
    ${If} $DO_INSTALL_IRFANVIEW == ${TRUE}<br />
      ${ConfigRead} &quot;${TEMP_DOWNLOAD_DIRECTORY}\${INSTALL_PROPS_FILENAME}&quot; &quot;IRFANVIEW_COMPRESSED_FILENAME=&quot; $IRFANVIEW_ZIP_FILENAME<br />
      ${ConfigRead} &quot;${TEMP_DOWNLOAD_DIRECTORY}\${INSTALL_PROPS_FILENAME}&quot; &quot;IRFANVIEW_SIZE_UNCOMPRESSED=&quot; $R2<br />
      ; set section size in kilobytes<br />
      IntOp $R2 $R2 / 1024<br />
      SectionSetSize SecIrfanView $R2<br />
    ${EndIf}<br />
<br />
    ${If} $DO_INSTALL_JRE == ${TRUE}<br />
      ${ConfigRead} &quot;${TEMP_DOWNLOAD_DIRECTORY}\${INSTALL_PROPS_FILENAME}&quot; &quot;JRE_COMPRESSED_FILENAME=&quot; $JRE_ZIP_FILENAME<br />
      ${ConfigRead} &quot;${TEMP_DOWNLOAD_DIRECTORY}\${INSTALL_PROPS_FILENAME}&quot; &quot;JRE_SIZE_UNCOMPRESSED=&quot; $R3<br />
      ; set section size in kilobytes<br />
      IntOp $R3 $R3 / 1024<br />
      SectionSetSize SecJRE $R3<br />
    ${EndIf}<br />
<br />
    StrCpy $RETRIEVED_HEADERS ${TRUE}<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function CreateInstallTypePage<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_FULL}&quot;<br />
    !insertmacro MUI_HEADER_TEXT &quot;Choose Installation Type&quot; &quot;Choose the type of installation.&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;${INSTALL_USER_INI}&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;Select the type of installation to be performed. This should be based on the type user who will be running $(^Name) once installed. Click Next to continue.&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;${INSTALL_USER_INI}&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function LeaveInstallTypePage<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\${INSTALL_USER_INI}&quot; &quot;Field 3&quot; &quot;State&quot;  ; scrubber<br />
  ReadINIStr $R1 &quot;$PLUGINSDIR\${INSTALL_USER_INI}&quot; &quot;Field 4&quot; &quot;State&quot;  ; voter<br />
  ${If} $R0 = ${TRUE}<br />
    StrCpy $INSTALL_USER ${INSTALL_USER_SCRUBBER}<br />
  ${ElseIf} $R1 = ${TRUE}<br />
    StrCpy $INSTALL_USER ${INSTALL_USER_VOTER}<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function PreComponentsPage<br />
  ; uncheck sections which will not be installed<br />
  ${If} $DO_INSTALL_CLIENT == ${FALSE}<br />
    !insertmacro UnselectSection ${SecClient}<br />
  ${EndIf}<br />
  ${If} $DO_INSTALL_IRFANVIEW == ${FALSE}<br />
    !insertmacro UnselectSection ${SecIrfanView}<br />
  ${EndIf}<br />
  ${If} $DO_INSTALL_JRE == ${FALSE}<br />
    !insertmacro UnselectSection ${SecJRE}<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function ShowComponentsPage<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_FULL}&quot;<br />
    !insertmacro MUI_HEADER_TEXT &quot;Components&quot; &quot;$(^Name) features to be installed.&quot;<br />
  ${ElseIf} $INSTALL_TYPE == &quot;${INSTALL_TYPE_UPGRADE}&quot;<br />
    !insertmacro MUI_HEADER_TEXT &quot;Components&quot; &quot;$(^Name) features to be updated.&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function ShowDirectoryPage<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_UPGRADE}&quot;<br />
    !insertmacro MUI_HEADER_TEXT &quot;Install Location&quot; &quot;Current location of $(^Name).&quot;<br />
  ${EndIf}<br />
<br />
  FindWindow $R1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
  ReadRegStr $R0 &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}&quot; &quot;${INSTALL_DIR_REG_KEY}&quot;<br />
  ${If} ${Errors}<br />
    ; enable page so user can specify a destination folder<br />
    GetDlgItem $R2 $R1 1019 # Dir box<br />
    EnableWindow $R2 1<br />
    GetDlgItem $R2 $R1 1001 # Browse button<br />
    EnableWindow $R2 1<br />
  ${Else}<br />
    ; ASBS already installed so disbale page and install into same folder<br />
    GetDlgItem $R2 $R1 1006 # Dir box<br />
    SendMessage $R2 ${WM_SETTEXT} 1 &quot;STR:Setup will install $(^Name) in the following folder.  $_CLICK&quot;<br />
    GetDlgItem $R2 $R1 1019 # Dir box<br />
    EnableWindow $R2 0<br />
    GetDlgItem $R2 $R1 1001 # Browse button<br />
    EnableWindow $R2 0<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function LeaveDirectoryPage<br />
  ${If} $INSTALL_TYPE == &quot;${INSTALL_TYPE_FULL}&quot;<br />
  ${AndIf} ${FileExists} $INSTDIR<br />
    MessageBox MB_YESNO|MB_ICONQUESTION \<br />
      &quot;The selected folder already exists. Are you sure you want to install $(^Name) in$\r$\n$INSTDIR?&quot; \<br />
      /SD IDNO IDYES proceed IDNO stop<br />
    stop:<br />
      Abort<br />
    proceed:<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function CreateArchiveViewerPage<br />
  ${If} $CHECK_INSTALL_ARCHIVE_VIEWER = ${TRUE}<br />
    !insertmacro MUI_HEADER_TEXT &quot;${ARCHIVE_NAME}&quot; &quot;Install ${ARCHIVE_NAME}.&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;${ARCHIVE_VIEWER_INI}&quot; &quot;Field 1&quot; &quot;Text&quot; &quot;Select whether or not to install the ${ARCHIVE_NAME}. Click Next to continue.&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;${ARCHIVE_VIEWER_INI}&quot; &quot;Field 2&quot; &quot;Text&quot; &quot;Install ${ARCHIVE_NAME}?&quot;<br />
    !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;${ARCHIVE_VIEWER_INI}&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function LeaveArchiveViewerPage<br />
  ReadINIStr $R0 &quot;$PLUGINSDIR\${ARCHIVE_VIEWER_INI}&quot; &quot;Field 3&quot; &quot;State&quot;  ; no<br />
  ReadINIStr $R1 &quot;$PLUGINSDIR\${ARCHIVE_VIEWER_INI}&quot; &quot;Field 4&quot; &quot;State&quot;  ; yes<br />
  ${If} $R0 = ${TRUE}<br />
    StrCpy $INSTALL_ARCHIVE_VIEWER ${FALSE}<br />
  ${ElseIf} $R1 = ${TRUE}<br />
    StrCpy $INSTALL_ARCHIVE_VIEWER ${TRUE}<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function PreStartMenuPage<br />
  ${If} $SKIP_STARTMENU = ${TRUE}<br />
    Abort<br />
  ${EndIf}<br />
<br />
  ${If} ${ENVIRONMENT} != &quot;prod&quot;<br />
    StrCpy $STARTMENU_FOLDER &quot;${APP_NAME_LONG} (${ENVIRONMENT})&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function CreateInstallReadyPage<br />
  !insertmacro MUI_HEADER_TEXT &quot;Install Confirmation&quot; &quot;The installation wizard is ready to install.&quot;<br />
  Var /GLOBAL ConfirmList<br />
  Var /GLOBAL DELIMITER<br />
  StrCpy $ConfirmList &quot;&quot;<br />
  StrCpy $DELIMITER &quot;\r\n&quot;<br />
<br />
  !insertmacro AddConfirmItem &quot;User type: $INSTALL_USER&quot; $ConfirmList $DELIMITER<br />
  ${If} ${SectionIsSelected} ${SecClient}<br />
    SectionGetText ${SecClient} $0<br />
    !insertmacro AddConfirmItem &quot;Install $0&quot; $ConfirmList $DELIMITER<br />
  ${EndIf}<br />
  ${If} $CHECK_INSTALL_ARCHIVE_VIEWER = ${TRUE}<br />
    ${Switch} $INSTALL_ARCHIVE_VIEWER<br />
      ${Case} ${FALSE}<br />
        !insertmacro AddConfirmItem &quot;Do not install ${ARCHIVE_NAME}&quot; $ConfirmList $DELIMITER<br />
        ${Break}<br />
      ${Case} ${TRUE}<br />
        !insertmacro AddConfirmItem &quot;Install ${ARCHIVE_NAME}&quot; $ConfirmList $DELIMITER<br />
    ${EndSwitch}<br />
  ${EndIf}<br />
  ${If} ${SectionIsSelected} ${SecIrfanView}<br />
    SectionGetText ${SecIrfanView} $0<br />
    !insertmacro AddConfirmItem &quot;Install $0&quot; $ConfirmList $DELIMITER<br />
  ${EndIf}<br />
  ${If} ${SectionIsSelected} ${SecJRE}<br />
    SectionGetText ${SecJRE} $0<br />
    !insertmacro AddConfirmItem &quot;Install $0&quot; $ConfirmList $DELIMITER<br />
  ${EndIf}<br />
  !insertmacro AddConfirmItem &quot;Destination: $INSTDIR&quot; $ConfirmList $DELIMITER<br />
  ${StrLoc} $0 &quot;$STARTMENU_FOLDER&quot; &quot;&gt;&quot; &quot;&gt;&quot;<br />
  ${If} $0 == 0<br />
    !insertmacro AddConfirmItem &quot;Do not create shortcuts&quot; $ConfirmList $DELIMITER<br />
  ${Else}<br />
    !insertmacro AddConfirmItem &quot;Start menu folder: $STARTMENU_FOLDER&quot; $ConfirmList $DELIMITER<br />
  ${EndIf}<br />
<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;${INSTALL_READY_INI}&quot; &quot;Field 2&quot; &quot;State&quot; &quot;$ConfirmList&quot;  <br />
  !insertmacro MUI_INSTALLOPTIONS_INITDIALOG &quot;${INSTALL_READY_INI}&quot;<br />
  Pop $R0 # HWND<br />
  GetDlgItem $R1 $R0 1201<br />
  SetCtlColors $R1 0x000000 0xFFFFFF<br />
  !insertmacro MUI_INSTALLOPTIONS_SHOW<br />
FunctionEnd<br />
<br />
Function PreFinishPage<br />
  GetDlgItem $R0 $HWNDPARENT 1<br />
  SendMessage $R0 ${WM_SETTEXT} &quot;&quot; &quot;STR:Finish&quot;<br />
<br />
  ; add checkbox to allow user to specify whether to create desktop shortcut<br />
  !define CREATE_DESKTOP_SHORTCUT_FIELD &quot;Field 7&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;Settings&quot; &quot;NumFields&quot; &quot;7&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;Text&quot; &quot;Create Desktop Shortcut&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;Type&quot; &quot;CheckBox&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;Left&quot; &quot;120&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;Right&quot; &quot;315&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;Top&quot; &quot;130&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;Bottom&quot; &quot;140&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_WRITE &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;State&quot; &quot;1&quot;<br />
FunctionEnd<br />
<br />
Function ShowFinishPage<br />
  GetDlgItem $MUI_TEMP1 $MUI_HWND 1206 ; ID for Create Desktop Shortcut checkbox<br />
  SetCtlColors $MUI_TEMP1 &quot;&quot; &quot;${MUI_BGCOLOR}&quot;<br />
<br />
  GetDlgItem $0 $HWNDPARENT 2    ; gets the Cancel button<br />
  EnableWindow $0 0              ; disables the Cancel button<br />
FunctionEnd<br />
<br />
Function LeaveFinishPage<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $MUI_TEMP1 &quot;ioSpecial.ini&quot; &quot;${CREATE_DESKTOP_SHORTCUT_FIELD}&quot; &quot;State&quot;<br />
  ${If} $MUI_TEMP1 = ${TRUE}<br />
    ; create desktop shortcut(s)<br />
    SetShellVarContext all<br />
    StrCpy $R0 &quot;$(^Name)&quot;<br />
    ${If} ${ENVIRONMENT} != &quot;prod&quot;<br />
      StrCpy $R0 &quot;$R0 (${ENVIRONMENT})&quot;<br />
    ${EndIf}<br />
    CreateShortCut &quot;$DESKTOP\$R0.lnk&quot; &quot;$INSTDIR\${APP_EXE_FILENAME}&quot; &quot;&quot; &quot;$INSTDIR\${APP_ICO_FILENAME}&quot; &quot;&quot; &quot;&quot; &quot;&quot; &quot;${APP_NAME_LONG}&quot;<br />
    SetShellVarContext current<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
Function FinishPageRun<br />
  ; check if user selected checkbox to launch application on finish<br />
  !insertmacro MUI_INSTALLOPTIONS_READ $R0 &quot;ioSpecial.ini&quot; &quot;Field 4&quot; &quot;State&quot;<br />
  ${If} $R0 = ${TRUE}<br />
    Exec &quot;${APP_EXE_FILENAME}&quot;<br />
  ${EndIf}<br />
FunctionEnd<br />
<br />
;--------------------------------<br />
;Descriptions<br />
<br />
  ;Assign language strings to sections<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecASBS} &quot;Main application&quot;<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecClient} &quot;$SECTION_DESC_CLIENT&quot;<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecIrfanView} &quot;$SECTION_DESC_IRFANVIEW&quot;<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecJRE} &quot;$SECTION_DESC_JRE&quot;<br />
  !insertmacro MUI_FUNCTION_DESCRIPTION_END<br />
  !insertmacro MUI_UNFUNCTION_DESCRIPTION_BEGIN<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecASBS} &quot;Main application&quot;<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecClient} &quot;$SECTION_DESC_CLIENT&quot;<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecIrfanView} &quot;$SECTION_DESC_IRFANVIEW&quot;<br />
    !insertmacro MUI_DESCRIPTION_TEXT ${SecJRE} &quot;$SECTION_DESC_JRE&quot;<br />
  !insertmacro MUI_UNFUNCTION_DESCRIPTION_END<br />
<br />
;--------------------------------<br />
; Uninstaller<br />
<br />
Section &quot;Uninstall&quot;<br />
  ReadRegStr $R0 &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}&quot; &quot;${INSTALL_DIR_REG_KEY}&quot;<br />
  ${If} ${Errors}<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
      &quot;Registry setting not found (HKLM\${APP_ROOT_REG_KEY}\${INSTALL_DIR_REG_KEY}).$\r$\nUninstallation will be aborted.&quot; \<br />
      /SD IDOK<br />
    Quit<br />
  ${EndIf}<br />
  ReadRegStr $APP_DATA_DIRECTORY &quot;HKLM&quot; &quot;${APP_ROOT_REG_KEY}&quot; &quot;${APPDATA_DIR_REG_KEY}&quot;<br />
  ${If} ${Errors}<br />
    MessageBox MB_OK|MB_ICONEXCLAMATION \<br />
      &quot;Registry setting not found (HKLM\${APP_ROOT_REG_KEY}\${APPDATA_DIR_REG_KEY}).$\r$\nUninstallation will be aborted.&quot; \<br />
      /SD IDOK<br />
    Quit<br />
  ${EndIf}<br />
<br />
  ; remove registry entries<br />
  SetDetailsPrint both<br />
  DetailPrint &quot;Removing Registry Keys...&quot;<br />
  SetDetailsPrint listonly<br />
  DeleteRegKey /ifempty HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)-${ENVIRONMENT}&quot;<br />
  DeleteRegKey HKLM &quot;${APP_ROOT_REG_KEY}\${COMPONENTS_REG_KEY}&quot;<br />
  DeleteRegKey /ifempty HKLM &quot;${APP_ROOT_REG_KEY}&quot;<br />
<br />
  ; remove shortcuts<br />
  SetDetailsPrint both<br />
  DetailPrint &quot;Removing Shortcuts...&quot;<br />
  SetDetailsPrint listonly<br />
  SetShellVarContext all<br />
  RMDir /r /REBOOTOK &quot;$SMPROGRAMS\$STARTMENU_FOLDER&quot;<br />
  StrCpy $R1 &quot;$(^Name)&quot;<br />
  ${If} ${ENVIRONMENT} != &quot;prod&quot;<br />
    StrCpy $R1 &quot;$R1 (${ENVIRONMENT})&quot;<br />
  ${EndIf}<br />
  Delete /REBOOTOK &quot;$DESKTOP\$R1.lnk&quot;<br />
  SetShellVarContext current<br />
<br />
  ; remove files<br />
  SetDetailsPrint both<br />
  DetailPrint &quot;Removing $(^Name) Core Files...&quot;<br />
  SetDetailsPrint listonly<br />
  RMDir /r /REBOOTOK &quot;$R0\lib&quot;<br />
  Delete /REBOOTOK &quot;$R0\*&quot;<br />
  SetDetailsPrint both<br />
  DetailPrint &quot;Removing IrfanView Application...&quot;<br />
  SetDetailsPrint listonly<br />
  RMDir /r /REBOOTOK &quot;$R0\IrfanView&quot;<br />
  SetDetailsPrint both<br />
  DetailPrint &quot;Removing Java Runtime Environment...&quot;<br />
  SetDetailsPrint listonly<br />
  RMDir /r /REBOOTOK &quot;$R0\jre&quot;<br />
  RMDir /r /REBOOTOK &quot;$R0&quot;<br />
  SetDetailsPrint both<br />
  DetailPrint &quot;Removing Application Data...&quot;<br />
  SetDetailsPrint listonly<br />
  RMDir /r /REBOOTOK &quot;$APP_DATA_DIRECTORY&quot;<br />
<br />
  SetDetailsPrint textonly<br />
<br />
SectionEnd<br />
<br />
Function un.onInit<br />
  !insertmacro CheckStartMenu<br />
FunctionEnd<br />
<br />
Function un.PreFinishPage<br />
  GetDlgItem $R0 $HWNDPARENT 1<br />
  SendMessage $R0 ${WM_SETTEXT} &quot;&quot; &quot;STR:Finish&quot;<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red27</div><div class="date">13th September 2009, 18:49</div></div><div class="posttext">I have exactly the same problem....<br />
<br />
Using NSISAnt1.2 and Eclipse 3.4, the NSIS Ant Task fires off the makensis command (and the installer is created successfully - you can see the makensis exe working under task manager, then finishing) but control never returns to Ant, so the target cannot complete.<br />
<br />
Any suggestions?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jairainbow</div><div class="date">2nd November 2009, 05:06</div></div><div class="posttext">i am new to this nsis ant.can you please post the sample ant script to compile the nsis.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>