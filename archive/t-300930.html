<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uninstall files copied with CopyFiles *.*, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uninstall files copied with CopyFiles *.* NSIS Discussion" />
	
	<title> Uninstall files copied with CopyFiles *.* [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uninstall files copied with CopyFiles *.*</div>
<hr />
<div class="pda"><a href="t-300930.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=300930">Uninstall files copied with CopyFiles *.*</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">srinke</div><div class="date">11th December 2008, 14:53</div></div><div class="posttext">Hello.<br />
<br />
How can I uninstall files which have been copied during installation with following command:<br />
<br />
CopyFiles /SILENT &quot;$EXEDIR\User-Plugins\*.*&quot; &quot;$INSTDIR\User-Plugins&quot;  <br />
<br />
Only the copied files should be deleted, NOT the files previously existed in the directory.<br />
<br />
Thanks for help, Stefan.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">12th December 2008, 06:29</div></div><div class="posttext">Keep a log of the files you copied, read that log when it is time to uninstall.<br />
<br />
I *think* CopyFiles ends up in the install details window, so you could grab from there.. otherwise, use FindFirst, FindNext, FindClose to get the files matching your file spec one-by-one so you can log them.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">srinke</div><div class="date">12th December 2008, 07:08</div></div><div class="posttext">Thank you. <br />
<br />
That's what I have already thought about.<br />
Has anybody a sample how to do this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">12th December 2008, 14:29</div></div><div class="posttext">You can try: unList (http://forums.winamp.com/showthread.php?postid=1862656#post1862656)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">srinke</div><div class="date">13th January 2009, 15:48</div></div><div class="posttext">Thank you. I've tried unlist, but it imports the files which I tried to copy dynamically.<br />
<br />
I wrote following which does what I need:<br />
<br />
Name &quot;UnCopy&quot;<br />
OutFile &quot;UnCopy.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\UnCopy&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro un.GetFileAttributes<br />
<br />
!include &quot;TextFunc.nsh&quot;<br />
!insertmacro FileJoin<br />
!insertmacro un.FileReadFromEnd<br />
!insertmacro un.TrimNewLines<br />
<br />
Section<br />
	InitPluginsDir<br />
	ExpandEnvStrings $R0 %COMSPEC%<br />
<br />
	SetOutPath &quot;$INSTDIR\User-Plugins&quot;<br />
  CopyFiles /SILENT &quot;$EXEDIR\User-Plug-ins\*.*&quot; &quot;$INSTDIR\User-Plugins&quot;<br />
	nsExec::Exec '&quot;$R0&quot; /C DIR &quot;$INSTDIR\User-Plugins\*.*&quot; /A-D /B /S /ON&gt;&quot;$INSTDIR\AdditionalPlugins.log&quot;'<br />
	nsExec::Exec '&quot;$R0&quot; /C DIR &quot;$INSTDIR\User-Plugins\*.*&quot; /AD /B /S /ON&gt;&quot;$INSTDIR\Directories.log&quot;'<br />
	${FileJoin} &quot;$INSTDIR\Directories.log&quot; &quot;$INSTDIR\AdditionalPlugins.log&quot; &quot;$INSTDIR\AdditionalPlugins.log&quot;<br />
	Delete &quot;$INSTDIR\Directories.log&quot;<br />
SectionEnd<br />
<br />
Function .onInstSuccess<br />
	WriteUninstaller $INSTDIR\uninstall.exe<br />
FunctionEnd<br />
<br />
<br />
Section Uninstall<br />
	${un.FileReadFromEnd} &quot;$INSTDIR\AdditionalPlugins.log&quot; un.FilesCallback<br />
	Delete &quot;$INSTDIR\AdditionalPlugins.log&quot;<br />
	RMDir &quot;$INSTDIR\User-PlugIns&quot;<br />
	Delete &quot;$INSTDIR\uninstall.exe&quot;<br />
  RMDir &quot;$INSTDIR&quot;<br />
SectionEnd<br />
<br />
<br />
Function un.FilesCallback<br />
	System::Call 'user32::OemToChar(t r9, t .r9)'<br />
	${un.TrimNewLines} '$9' $9<br />
	${un.GetFileAttributes} '$9' &quot;DIRECTORY&quot; $R0<br />
	IntCmp $R0 0 0 DeleteAsDir DeleteAsDir<br />
	Delete '$9'	<br />
	goto FilesCallbackEnd<br />
	<br />
	DeleteAsDir:<br />
	RMDir '$9'<br />
	<br />
	FilesCallbackEnd:	<br />
	Push 0<br />
FunctionEnd<br />
<br />
It copies files and directories recursivly from the installers subdirectory &quot;User-Plug-ins&quot; to the destination paths subdirectory &quot;User-Plugins&quot;. The uninstaller will remove exactly this files and directories and nothing else!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>