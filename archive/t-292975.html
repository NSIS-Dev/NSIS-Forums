<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" multiple files - multiple includes and defines - confusion, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  multiple files - multiple includes and defines - confusion NSIS Discussion" />
	
	<title> multiple files - multiple includes and defines - confusion [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  multiple files - multiple includes and defines - confusion</div>
<hr />
<div class="pda"><a href="t-292975.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=292975">multiple files - multiple includes and defines - confusion</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">10th June 2008, 21:10</div></div><div class="posttext">Hi all,<br />
<br />
There has to be a standard way to do this, but I just can't find it...<br />
<br />
Its the standard multiple include/define problem that you see in C, where I am getting things multiply defined/included.<br />
<br />
I am trying to split up my installer source code to have multiple source files, very much like MUI2 does with its Pages.<br />
<br />
Lets say I have main.nsi, file1.nsh, file2.nsh and file3.nsh<br />
<br />
main.nsi includes file1.nsh, file2.nsh and file3.nsh<br />
<br />
Now, lets say that file1.nsh needs to use StrTrimNewLines... So I include StrFunc.nsh...<br />
Like:<br />
	!include &quot;StrFunc.nsh&quot;<br />
	${UnStrTrimNewLines}<br />
<br />
Thats fine...<br />
But oh wait, now I also need to include it in main.nsh as well.<br />
If I try to do the include again there, I get errors.  Presumably this is because I am including and defining a function twice...<br />
<br />
Okay, so perhaps I can do the usual trick under C, which is to check to see if something is defined, and only include the header file if its not defined yet...<br />
However, this doesn't seem to work either...<br />
<br />
What is the typical way to solve this problem with NSIS?<br />
<br />
Yes, I know I could include it just once in main.nsi, and then include my file1.nsh and file2.nsh files below that... But I don't want to do that, because then file1.nsi and file2.nsi isn't &quot;standalone&quot;, but instead requires someone above it to include things for it... Which I don't want...<br />
<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">10th June 2008, 22:42</div></div><div class="posttext">I usually define something in the beginning and then wrap the entire NSH code inside a !if statment.  (Many of the included files with NSIS do the same.)<br />
<br />
Use File1.nsh as an example.  You'd do something like this:<br />
<br />
!ifndef File1_Included<br />
   !define File1_included<br />
   ...<br />
   [your code here]<br />
   ...<br />
!endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">11th June 2008, 01:18</div></div><div class="posttext">Yeah, I tried that as well, but the problem is that the macro's are actually being inserted in both files.<br />
Thus it ends up having the same function defined twice!<br />
<br />
Like my example above:<br />
<br />
If I do this at the top of file1.nsh:<br />
!include &quot;StrFunc.nsh&quot;<br />
${UnStrTrimNewLines}<br />
<br />
Which I have to do, because this file actually requires the UnStrTrimNewLines function.<br />
So this ends up inserting the function into file1.nsh.<br />
<br />
But what happens if I need the same function in main.nsi ?<br />
If I do the:<br />
!include &quot;StrFunc.nsh&quot;<br />
${UnStrTrimNewLines}<br />
<br />
This will insert the function yet again, but this time into my main.nsi file.<br />
<br />
So now, if main.nsi !include's file1.nsh, I have a duplicate function name of UnStrTrimNewLines...<br />
<br />
How the heck do you resolve this problem?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th June 2008, 09:46</div></div><div class="posttext">Bit ugly but should work:<br />
<br />
!include StrFunc.nsh<br />
!if `${UnStrTrimNewLines}` == `!insertmacro FUNCTION_STRING_UnStrTrimNewLines`<br />
  ${UnStrTrimNewLines}<br />
!endif<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sheik</div><div class="date">11th June 2008, 15:36</div></div><div class="posttext">Hi Stu,<br />
<br />
Wow!  That actually works PERFECTLY!<br />
<br />
Thanks for your help on this one, I was expecting to have to spend the greater part of today trying to find a way around this problem, and you just solved it for me in like 2 minutes! =)<br />
<br />
Thanks again!<br />
Scott</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">11th June 2008, 15:51</div></div><div class="posttext">ARGH!  I didn't realize that StrFunc was so messy!  :eek: <br />
<br />
While Afrow's solution works ok, I could see that getting very tedious if you had to use more than just that one function from StrFunc.nsh.<br />
<br />
Personally, I prefer using FileFunc.nsh or WordFunc.nsh instead.  You get pretty much the same functionality as you would using StrFunc, but it's much easier to work with--especially when using multiple includes as in your example.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">11th June 2008, 16:08</div></div><div class="posttext">The simple way to find the value of ${UnStrTrimNewLines} (and any others) for comparison is to do !error `${UnStrTrimNewLines}` at the top and then copy its value from the makensis log.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">********</div><div class="date">16th September 2008, 13:59</div></div><div class="posttext">!ifndef StrTok_INCLUDED<br />
  ${StrTok}<br />
!endif<br />
 <br />
<br />
But it is still a bad solution for header files, because if the header file with ${StrTok} definition is included before ${StrTok} is used in main file - it will cause errors. <br />
<br />
I bet many people will struggle with the same problem with officially distributed StrFunc.nsh<br />
<br />
How about to add this info in header or deprecate ${StrTok} calls in favor of usual !insertmacro ?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>