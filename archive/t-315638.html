<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Use !define conditionally, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Use !define conditionally NSIS Discussion" />
	
	<title> Use !define conditionally [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Use !define conditionally</div>
<hr />
<div class="pda"><a href="t-315638.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=315638">Use !define conditionally</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">HSorgYves</div><div class="date">23rd December 2009, 22:05</div></div><div class="posttext">I want to use the !define UMUI_ALTERNATIVESTARTMENUPAGE_SETSHELLVARCONTEXT statement only if the current user has administrator priviledges. How is this possible?<br />
<br />
Thanks,<br />
Yves</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">24th December 2009, 01:44</div></div><div class="posttext">You can't set SetShellVarContext based on what privileges are available?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HSorgYves</div><div class="date">24th December 2009, 10:48</div></div><div class="posttext">I can and I do, but that only influences some directory variables not the page displayed by UMUI...<br />
<br />
I am even using<br />
!define UMUI_DEFAULT_SHELLVARCONTEXT $UMUI_DEFAULT_SHELLVARCONTEXT<br />
and then setting $UMUI_DEFAULT_SHELLVARCONTEXT conditionally, but this method doesn't work for<br />
!define UMUI_ALTERNATIVESTARTMENUPAGE_SETSHELLVARCONTEXT<br />
as it has no argument.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">24th December 2009, 12:34</div></div><div class="posttext">Most probably you'll have to edit the UMUI header file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HSorgYves</div><div class="date">24th December 2009, 13:30</div></div><div class="posttext">That's what I wanted to avoid...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">24th December 2009, 23:39</div></div><div class="posttext">I would try to implement this feature soon.<br />
The method that I will use is to try to create a file in the Program Files to determine if the application has administrator rights and if this is not the case, disable radio buttons on the start menu page.<br />
Unless you have a better method for determining the level?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HSorgYves</div><div class="date">24th December 2009, 23:59</div></div><div class="posttext">I am currently using:<br />
xtInfoPlugin::IsAdministrator<br />
Pop $0<br />
StrCmp $0 &quot;true&quot;<br />
<br />
Something like:<br />
!define UMUI_ALTERNATIVESTARTMENUPAGE_SETSHELLVARCONTEXT true|false<br />
would thus be enough. You could make such an argument optional and thus not break backward compatibility.<br />
<br />
Best Regards,<br />
Yves</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">25th December 2009, 00:24</div></div><div class="posttext">Originally posted by SuperPat <br />
Unless you have a better method for determining the level? UserInfo::GetAccountType from UserInfo.dll already included in NSIS. http://nsis.sourceforge.net/IsUserAdmin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">25th December 2009, 00:39</div></div><div class="posttext">Originally posted by redxii <br />
UserInfo::GetAccountType from UserInfo.dll already included in NSIS. http://nsis.sourceforge.net/IsUserAdmin  <br />
<br />
I think this function does not return the right answer on a windows Vista/7 with a administrateur account if the RequestExecutionLevel is set as user?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">25th December 2009, 01:10</div></div><div class="posttext">http://nsis.sourceforge.net/Examples/UserInfo/UserInfo.nsi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">redxii</div><div class="date">25th December 2009, 07:42</div></div><div class="posttext">Well, even if the account is an Administrator in UAC approval mode, if they don't elevate the setup they can't create shortcuts for all users anyway, only for themselves and it's as if they are non-admins.<br />
<br />
UserInfo returns the right answer for what privileges the installer has. You don't want to use GetOriginalAccountType to see that they are really an administrator, the installer isn't running elevated, and assume that the context should be set to 'all'.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HSorgYves</div><div class="date">25th December 2009, 10:07</div></div><div class="posttext">I have tested this on Vista. If &quot;RequestExecutionLevel user&quot; is set, UserInfo::GetAccountType will not return Admin, but the user has no write acces to Program Files for example, so the answer is correct as redxii says.<br />
<br />
Best Regards,<br />
Yves</div></div><hr />


<div class="post"><div class="posttop"><div class="username">SuperPat</div><div class="date">25th December 2009, 11:16</div></div><div class="posttext">Very good</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HSorgYves</div><div class="date">25th December 2009, 17:33</div></div><div class="posttext">Problem solved in today's release. Thanks for your quick development!<br />
<br />
Best Regards,<br />
Yves</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>