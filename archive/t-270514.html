<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Spawned uninstaller instance, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Spawned uninstaller instance NSIS Discussion" />
	
	<title> Spawned uninstaller instance [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Spawned uninstaller instance</div>
<hr />
<div class="pda"><a href="t-270514.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270514">Spawned uninstaller instance</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">2nd May 2007, 18:00</div></div><div class="posttext">Hello.<br />
I need to insert MUI_UNPAGE_CONFIRM and disable a message in my uninstaller while running it from the installer. To detect if the uninstaller was spawned, I made-up a commandline switch &quot;/U&quot;.ExecWait &quot;$UNINSTSTR /U _?=$UNINST\\bin&quot;Is there an easier way?<br />
<br />
The problem is inserting the confirm unpage macro inside a function that causes a compile-time error: command PageEx not valid in a Function.; Un-Confirm page<br />
<br />
Function un.confirm<br />
  StrCmp $SPAWN &quot;1&quot; done<br />
  !insertmacro MUI_UNPAGE_CONFIRM<br />
  done:<br />
FunctionEndBy way of explaining how I arrived at this point, I have two functions in the uninstaller that test for the /U switch.; Variables<br />
Var SPAWN<br />
<br />
; Search in a string from right to left<br />
; Usage:<br />
;  Push &quot;this is a long ass string&quot;<br />
;  Push &quot;ass&quot;<br />
;  Call (un.)StrStrRight<br />
;  Pop $R0<br />
;  ($R0 at this point is &quot;ass string&quot;)<br />
Function un.StrStrRight<br />
  Exch $R1 ; st=haystack,old$R1, $R1=needle<br />
  Exch    ; st=old$R1,haystack<br />
  Exch $R2 ; st=old$R1,old$R2, $R2=haystack<br />
  Push $R3<br />
  Push $R4<br />
  Push $R5<br />
  StrLen $R3 $R1<br />
  StrLen $R4 $R2<br />
  IntOp $R4 $R4 - 1<br />
  loop:<br />
    StrCpy $R5 $R2 $R3 $R4<br />
    StrCmp $R5 $R1 done<br />
    StrCmp $R5 &quot;&quot; done<br />
    IntOp $R4 $R4 - 1<br />
    Goto loop<br />
done:<br />
  IntOp $R4 $R4 + 1<br />
  StrCpy $R1 $R2 &quot;&quot; $R4<br />
  Pop $R5<br />
  Pop $R4<br />
  Pop $R3<br />
  Pop $R2<br />
  Exch $R1<br />
FunctionEnd<br />
<br />
; Return length from end of string<br />
; Usage:<br />
;  user variable &quot;SPAWN&quot; equals characters to end of string<br />
;  where &quot;/U&quot; is the last commandline parameter, the output contains 1<br />
Function un.spawn<br />
  Push $CMDLINE<br />
  Push &quot;/U&quot;<br />
  Call un.StrStrRight<br />
  Pop $R0<br />
  StrLen $SPAWN $R0<br />
FunctionEnd<br />
<br />
Function un.onInit<br />
  Call un.spawn <br />
...<br />
FunctionEndPS: Potentially, you could hard-code the switch and query with 'IfSpawned', similar to 'IfSilent' ... just an idea.<br />
<br />
edit:<br />
<br />
Almost forgot. &quot;Normally&quot; you skip pages with an Abort call in a custom function. Normally. Aborting unpage confirm, aborts the uninstaller.; Un-Confirm page<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE un.confirm<br />
!insertmacro MUI_UNPAGE_CONFIRM<br />
<br />
Function un.confirm<br />
  StrCmp $SPAWN &quot;1&quot; done<br />
    Abort<br />
  done:<br />
FunctionEndWhy?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">2nd May 2007, 20:13</div></div><div class="posttext">My uninstaller script has few twists in it. It should be straightforward and yet pages aren't skipped. I've tried Abort with MUI_UNPAGE_WELCOME too and it only aborts the application. When I run the uninstaller alone or, when I launch it from the installer without any precondition, a pure Abort page callback, simply, well... aborts.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">2nd May 2007, 20:51</div></div><div class="posttext">Yep. Calling the Abort function in un.onInit wasn't the brightest thing I ever did. Crap happens.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd May 2007, 18:47</div></div><div class="posttext">So does Abort in the pre function work or not?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">4th May 2007, 00:20</div></div><div class="posttext">The PRE function works, it skips the page. It did not abort the uninstaller. I was confused. The uninstaller aborted from un.onInit and you can't put !insertmacro MUI_UNPAGE_CONFIRM into a function that skips the page. Really confused.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">4th May 2007, 04:15</div></div><div class="posttext">ExecWait:<br />
The NSIS documentation insists on an extra pair of quotes to delimit the command proper from the commandline parameters, or &quot;it [ExecWait] will not work on Windows 9x with or without parameters&quot;. I'm less than convinced this applies also where the command is stored in a variable. I ran an uninstaller with ExecWait on 95 and 98 and not having additional quotes didn't give me problems, although putting the command in quotes is probably safer.ExecWait '&quot;$UNINSTSTR&quot; /U _?=$UNINST\\bin'It works.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>