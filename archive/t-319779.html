<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" 'scan for hardware changes' via NSIS?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  'scan for hardware changes' via NSIS? NSIS Discussion" />
	
	<title> 'scan for hardware changes' via NSIS? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  'scan for hardware changes' via NSIS?</div>
<hr />
<div class="pda"><a href="t-319779.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319779">'scan for hardware changes' via NSIS?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">9th June 2010, 00:40</div></div><div class="posttext">got a bit of an odd report, but that's Windows and devices for ya...<br />
<br />
Our installer currently (pre-)installs a hardware device driver through DPInst, simply to prevent any specific tweaks needing to be made through Windows versions, 32bit vs 64bit, and all that.  This works very well, so no problems there.<br />
<br />
Then a curious user decides to remove the installed hardware device from the Device Manager.  No problem.. if the user wants to be silly, that's totally up to them.<br />
<br />
But then when they re-install the hardware device driver through the installer, instead of DPInst installing, it performs a pre-install.  After all, it thinks the hardware is gone (the user removed it from the device manager).<br />
Now personally I think this is pretty much expected behavior if the user forces this, and if the user scans for hardware after installation, it will use the pre-installed package just dandy.<br />
But from a user-friendliness point of view, the expected behavior probably -is- that the device becomes available again after driver package installation.<br />
<br />
So to solve this, I have to force the equivalent of the Device Manager's &quot;scan for hardware changes&quot; functionality - preferably without opening the device manager console and sending a mouseclick to the button ;)<br />
<br />
The 'scanHardware' configuration flag for DPInst sounded 100% promising but of course what it actually means is 'scan the currently recognized devices and only install the package if it is a better match than the current package installed for that device'.<br />
<br />
Neither the InstDrv plug-in nor 'Driver installation and update' wiki topics seem to touch on device list refreshing.<br />
<br />
Which leaves me with the maze that is MSDN, which tells me I should be running what is explained here...<br />
http://support.microsoft.com/kb/259697<br />
whose functions are described in Cfgmgr32.dll<br />
...through the System plugin.<br />
<br />
Would that be the appropriate route to take, or is there a more obvious method that I glossed over?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">9th June 2010, 08:09</div></div><div class="posttext">You might want to have a look at the devcon tool from the Windows DDK:<br />
http://support.microsoft.com/kb/311272<br />
<br />
Though I'm not sure Vista or  Win7 support this tool.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">9th June 2010, 11:33</div></div><div class="posttext">I forgot to mention that one...<br />
<br />
1. Yes, the page doesn't say anything about Vista+ support<br />
<br />
but even if it did, there's a dealbreaker in there<br />
<br />
2. DevCon is not redistributable. It is provided for use as a debugging and development tool. <br />
emphasis mine</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">9th June 2010, 12:18</div></div><div class="posttext">DevCon is not redistributable. It is provided for use as a debugging and development tool.<br />
<br />
Hmm, missed that.<br />
<br />
Then I think your only option is to use the functions you mentioned in the first post.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">11th June 2010, 12:45</div></div><div class="posttext">Yup, seemed like it.  Just wanted to double-check - thanks :)<br />
<br />
Function calls are now implemented... I made a wiki page for it with fully annotated macro:<br />
http://nsis.sourceforge.net/Scan_for_hardware_changes<br />
<br />
I still wrestle with System sometimes, so if I'm using a wrong type somewhere.. please do (help) fix; as far as I can tell, though, it works.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>