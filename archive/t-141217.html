<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to register extensions and map them to my program?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to register extensions and map them to my program? NSIS Discussion" />
	
	<title> How to register extensions and map them to my program? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to register extensions and map them to my program?</div>
<hr />
<div class="pda"><a href="t-141217.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=141217">How to register extensions and map them to my program?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">5th July 2003, 19:17</div></div><div class="posttext">I am trying to register .mpo and .mmx with a program which should be safe to run on OSes as early as 95. I would like it very much if these extensions can register globally for any user.<br />
<br />
I did some searching and have come up with the following resources.<br />
<br />
Path Manipulation - NSIS Archive<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=91<br />
<br />
Path Manipulation - Windows 2000 - thread<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=140083<br />
<br />
Search path functions - thread<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=77904&amp;highlight=refreshenv<br />
<br />
Am I hitting this search on the head? Am I way off? Can this be done and is it safe on all operating systems? No telling now unless I try...<br />
<br />
Someone help guide me a little?<br />
<br />
Thanks in advance :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th July 2003, 19:29</div></div><div class="posttext">Isn't this what you're looking for?<br />
http://nsis.sourceforge.net/archive/nsisweb.php?page=337&amp;instances=0,11<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">5th July 2003, 19:50</div></div><div class="posttext">Thank you Afrow UK,<br />
<br />
This looks like its going to be easy (I hope). I am pasting the code back in here with my modifications, just guide and correct me where I go wrong if you could, thanks again!<br />
  ; back up old value of .mmx<br />
  ReadRegStr $1 HKCR &quot;.mmx&quot; &quot;&quot;<br />
  StrCmp $1 &quot;&quot; NoBackup<br />
    StrCmp $1 &quot;OptionsFile&quot; NoBackup<br />
    WriteRegStr HKCR &quot;.nsi&quot; &quot;backup_val&quot; $1 Whats the .NSI doing here?<br />
  NoBackup:<br />
  WriteRegStr HKCR &quot;.mmx&quot; &quot;&quot; &quot;OptionsFile&quot;<br />
  ReadRegStr $0 HKCR &quot;Options File&quot; &quot;&quot;<br />
  StrCmp $0 &quot;&quot; 0 skipOPTAssoc<br />
	WriteRegStr HKCR &quot;OptionsFile&quot; &quot;&quot; &quot;Options File&quot;<br />
	WriteRegStr HKCR &quot;OptionsFile\shell&quot; &quot;&quot; &quot;open&quot;<br />
	WriteRegStr HKCR &quot;OptionsFile\DefaultIcon&quot; &quot;&quot; $INSTDIR\mypathto\myprogram.exe,1<br />
  skipOPTAssoc:<br />
  WriteRegStr HKCR &quot;OptionsFile\shell\open\command&quot; &quot;&quot; '$INSTDIR\mypathto\myprogram.exe<br />
&quot;%1&quot;'<br />
  WriteRegStr HKCR &quot;OptionsFile\shell\edit&quot; &quot;&quot; &quot;Edit Options File&quot;<br />
  WriteRegStr HKCR &quot;OptionsFile\shell\edit\command&quot; &quot;&quot; '$INSTDIR\mypathto\myprogram.exe<br />
&quot;%1&quot;'<br />
I am really excited about this... Have I got it right so far?<br />
<br />
I must place this at the end of the install section correct?<br />
<br />
Thank you for pointing this out Afrow UK :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th July 2003, 20:28</div></div><div class="posttext">This script was only posted about 5 days ago, so you were lucky to ask for it now and not 5 days ago :)<br />
This script was used in the NSIS b4 installer exe to register the .nsi and .nsh files to have the special logo and to open with notepad.exe!<br />
<br />
Therefore, just replace all the .nsi bits with you're own extension (I presume!)<br />
<br />
I've never used this script, so hope it works!<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">5th July 2003, 20:53</div></div><div class="posttext">It works with one quirk I've not managed to get around. How do I map an icon to the new extension? It works but the files look like files on Windows without an associated program...<br />
<br />
Also, how do I call two sections during uninstall? Its pretty easy to embed the uninstall script into the uninstall section but unfortunately I can only embed the script once. Adding it a second time causes a conflict.<br />
<br />
Thank you Afrow UK for your point in the right direction!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">5th July 2003, 21:08</div></div><div class="posttext">If you're on Windows 9x the icon doesn't update immediately. See this page (http://nsis.sourceforge.net/archive/viewpage.php?pageid=202) for a possible solution.<br />
<br />
As for the uninstall sections, you can only have one. If you need to pass on data from the installer to the uninstaller to know what to uninstall do so in the registry or in an INI file.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">5th July 2003, 22:53</div></div><div class="posttext">I am on WinXP SP1 fully updated. This script works and will register the mmx and mpo extensions but it will not give the file its associated icon. This is the current script. The blue text is where along the script this section is currently located. The crimson text is the only changes I've made. I also numbered this to make help a little easier. Thanks :)<br />
<br />
01. !insertmacro MUI_FUNCTIONS_DESCRIPTION_END<br />
02. Section ;Register mmx Extension<br />
03.   ; back up old value of .mmx<br />
04.   ReadRegStr $1 HKCR &quot;.mmx&quot; &quot;&quot;<br />
05.   StrCmp $1 &quot;&quot; NoBackup<br />
06.     StrCmp $1 &quot;OptionsFile&quot; NoBackup<br />
07.     WriteRegStr HKCR &quot;.nsi&quot; &quot;backup_val&quot; $1<br />
08.   NoBackup:<br />
09.   WriteRegStr HKCR &quot;.mmx&quot; &quot;&quot; &quot;OptionsFile&quot;<br />
10.   ReadRegStr $0 HKCR &quot;Mark Master File&quot; &quot;&quot;<br />
11.   StrCmp $0 &quot;&quot; 0 skipOPTAssoc<br />
12. 	WriteRegStr HKCR &quot;OptionsFile&quot; &quot;&quot; &quot;Mark Master File&quot;<br />
13. 	WriteRegStr HKCR &quot;OptionsFile\shell&quot; &quot;&quot; &quot;open&quot;<br />
14. 	WriteRegStr HKCR &quot;OptionsFile\DefaultIcon&quot; &quot;&quot; $INSTDIR\mmx.exe,1<br />
15.   skipOPTAssoc:<br />
16.   WriteRegStr HKCR &quot;OptionsFile\shell\open\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
17.   WriteRegStr HKCR &quot;OptionsFile\shell\edit&quot; &quot;&quot; &quot;Edit Mark Master File&quot;<br />
18.   WriteRegStr HKCR &quot;OptionsFile\shell\edit\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
19. SectionEnd<br />
20. Function un.onUninstSuccess<br />
The above code will register the mmx extension but fails in giving the associated files the executable icon.<br />
<br />
The below code is what I have for uninstall. To be honest I do not think it is uninstalling any registry entries. I'll explain later.<br />
<br />
01.   Section Uninstall<br />
02.   ;start of restore script<br />
03.   ReadRegStr $1 HKCR &quot;.mmx&quot; &quot;&quot;<br />
04.   StrCmp $1 &quot;OptionsFile&quot; 0 NoOwn ; only do this if we own it<br />
05.     ReadRegStr $1 HKCR &quot;.mmx&quot; &quot;backup_val&quot;<br />
06.     StrCmp $1 &quot;&quot; 0 RestoreBackup ; if backup == &quot;&quot; then delete the whole key<br />
07.       DeleteRegKey HKCR &quot;.mmx&quot;<br />
08.     Goto NoOwn<br />
09.     RestoreBackup:<br />
10.       WriteRegStr HKCR &quot;.mmx&quot; &quot;&quot; $1<br />
11.      DeleteRegValue HKCR &quot;.mmx&quot; &quot;backup_val&quot;<br />
12.   NoOwn:<br />
13.   ;rest of script<br />
14.   ...<br />
<br />
I checked my registry with regedit before a test install and I noticed I had no registry entries to my program. After install I checked again but didn't see any. Once I launched an associated file the registry entries kicked in. When I decided to uninstall the application and check the registry again, it seemed some entries were left behind.<br />
<br />
These are just a few entries left behind which were never in the system to begin with.<br />
[HKEY_CLASSES_ROOT\Applications\mmx.exe]<br />
<br />
[HKEY_CLASSES_ROOT\Applications\mmx.exe\shell]<br />
@=&quot;open&quot;<br />
<br />
[HKEY_CLASSES_ROOT\Applications\mmx.exe\shell\edit]<br />
@=&quot;Edit Mark Master File&quot;<br />
<br />
[HKEY_CLASSES_ROOT\Applications\mmx.exe\shell\edit\command]<br />
@=&quot;C:\\mmx\\mmx.exe \&quot;%1\&quot;&quot;<br />
<br />
[HKEY_CLASSES_ROOT\Applications\mmx.exe\shell\open]<br />
<br />
[HKEY_CLASSES_ROOT\Applications\mmx.exe\shell\open\command]<br />
@=&quot;C:\\mmx\\mmx.exe \&quot;%1\&quot;&quot;<br />
<br />
I am really trying but build after build I do not know what left to do in order to get the icon to map and the uninstall to fully uninstall the registry entries. I would appreciate backing up an original and replacing it but I am doing this without original registry entries.<br />
<br />
How do I map the icons and fully uninstall the reg entries?<br />
<br />
Thanks in advance :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">6th July 2003, 01:33</div></div><div class="posttext">I tested your script on a WinXP machine and default icon seems to work only after restart of the machine.  As for the registry entries the current uninstall anly deleted the association entries and leaves the main entries intact.  I'll try to fix this and post back when done.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">6th July 2003, 03:08</div></div><div class="posttext">Still working on the uninstall function but I also found an error in my original archive page.  Line 10 of your script should be 10.   ReadRegStr $0 HKCR &quot;OptionsFile&quot; &quot;&quot; Also note that you should use a more descriptive and unique replacement for &quot;OptionsFile&quot;, e.g. it should reflect the file description in some way preferably with the name of you program to avoid other programs overwriting your association accidentally.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">6th July 2003, 10:23</div></div><div class="posttext">I am not too worried about the icon file because this script is fabulous at what it does now. I modified the script so to register both the mmx and mpo extensions... I also added the new lines in your latest update. Also the new orange color shows how I incremented the code to work for two extensions. Take note of the green snippets the second time around and how they're suffixed with a 2. I am simply trying to accomplish registering two extension in one section. This works but is this right?<br />
<br />
00. !insertmacro MUI_FUNCTIONS_DESCRIPTION_END<br />
01.   Section<br />
02.   ;Register mmx Extension<br />
03.   ; back up old value of .mmx<br />
04.   ReadRegStr $1 HKCR &quot;.mmx&quot; &quot;&quot;<br />
05.   StrCmp $1 &quot;&quot; NoBackup<br />
06.     StrCmp $1 &quot;MarkMasterFile&quot; NoBackup<br />
07.     WriteRegStr HKCR &quot;.nsi&quot; &quot;backup_val&quot; $1<br />
08.   NoBackup:<br />
09.   WriteRegStr HKCR &quot;.mmx&quot; &quot;&quot; &quot;MarkMasterFile&quot;<br />
10.     ReadRegStr $0 HKCR &quot;MarkMasterFile&quot; &quot;&quot;<br />
11.   StrCmp $0 &quot;&quot; 0 skipOPTAssoc<br />
12.	WriteRegStr HKCR &quot;MarkMasterFile&quot; &quot;&quot; &quot;Program Options File&quot;<br />
13. 	WriteRegStr HKCR &quot;MarkMasterFile\shell&quot; &quot;&quot; &quot;open&quot;<br />
14. 	WriteRegStr HKCR &quot;MarkMasterFile\DefaultIcon&quot; &quot;&quot; $INSTDIR\mmx.exe,1<br />
15.   skipOPTAssoc:<br />
16.   WriteRegStr HKCR &quot;MarkMasterFile\shell\open\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
17.   WriteRegStr HKCR &quot;MarkMasterFile\shell\edit&quot; &quot;&quot; &quot;Edit Mark Master File&quot;<br />
18.   WriteRegStr HKCR &quot;MarkMasterFile\shell\edit\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
19.  <br />
20.   ;Register mpo Extension<br />
21.   ; back up old value of .mpo<br />
22.   ReadRegStr $1 HKCR &quot;.mpo&quot; &quot;&quot;<br />
23.   StrCmp $1 &quot;&quot; NoBackup2<br />
24.     StrCmp $1 &quot;MarkMasterFile2&quot; NoBackup2<br />
25.     WriteRegStr HKCR &quot;.nsi&quot; &quot;backup_val&quot; $1<br />
26.   NoBackup2:<br />
27.   WriteRegStr HKCR &quot;.mpo&quot; &quot;&quot; &quot;MarkMasterFile2&quot;<br />
28.     ReadRegStr $0 HKCR &quot;MarkMasterFile2&quot; &quot;&quot;<br />
29.   StrCmp $0 &quot;&quot; 0 skipOPTAssoc2<br />
30.	WriteRegStr HKCR &quot;MarkMasterFile2&quot; &quot;&quot; &quot;Program Options File&quot;<br />
31. 	WriteRegStr HKCR &quot;MarkMasterFile2\shell&quot; &quot;&quot; &quot;open&quot;<br />
32. 	WriteRegStr HKCR &quot;MarkMasterFile2\DefaultIcon&quot; &quot;&quot; $INSTDIR\mmx.exe,1<br />
33.   skipOPTAssoc2:<br />
34.   WriteRegStr HKCR &quot;MarkMasterFile2\shell\open\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
35.   WriteRegStr HKCR &quot;MarkMasterFile2\shell\edit&quot; &quot;&quot; &quot;Edit Mark Master File&quot;<br />
36.   WriteRegStr HKCR &quot;MarkMasterFile2\shell\edit\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
37. SectionEnd<br />
38. Function un.onUninstSuccess<br />
<br />
I hope the above code is correct. My greatest worry is leaving behind registry entries after an uninstall. In theory, should the uninstall script restore the association if any and if their wasn't any then completely remove all newly created associations?<br />
<br />
Thank you so much for this powerful script Vytautas. I am not too worried about the icons if they pop up at some point but would definitely stress removing them during uninstall... Personally I do not like the idea of a program leaving anything behind.<br />
<br />
It is so far awesome and I have just two questions. Is the above code correct for registering two extensions (mmx, mpo)? It works for me but I would really just like to make sure and not sit on a time bomb.<br />
<br />
How is the uninstall coming along?<br />
<br />
Thank you again Vytautas :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">6th July 2003, 10:47</div></div><div class="posttext">I know of a way of making the uninstall work properly, however I am having problems with that approach in Win2K/WinXP and possibly NT, waiting for reply on another thread before I can finish this.<br />
00. !insertmacro MUI_FUNCTIONS_DESCRIPTION_END<br />
01.   Section<br />
02.   ;Register mmx Extension<br />
03.   ; back up old value of .mmx<br />
04.   ReadRegStr $1 HKCR &quot;.mmx&quot; &quot;&quot;<br />
05.   StrCmp $1 &quot;&quot; NoBackup<br />
06.     StrCmp $1 &quot;MarkMasterFile&quot; NoBackup<br />
07.     WriteRegStr HKCR &quot;.mmx&quot; &quot;backup_val&quot; $1<br />
08.   NoBackup:<br />
09.   WriteRegStr HKCR &quot;.mmx&quot; &quot;&quot; &quot;MarkMasterFile&quot;<br />
10.   ; back up old value of .mpo<br />
11.   ReadRegStr $1 HKCR &quot;.mpo&quot; &quot;&quot;<br />
12.   StrCmp $1 &quot;&quot; NoBackup2<br />
13.     StrCmp $1 &quot;MarkMasterFile&quot; NoBackup2<br />
14.     WriteRegStr HKCR &quot;.mpo&quot; &quot;backup_val&quot; $1<br />
15.   NoBackup2:<br />
16.   WriteRegStr HKCR &quot;.mpo&quot; &quot;&quot; &quot;MarkMasterFile&quot;<br />
17.   ;Check Associations<br />
18.   ReadRegStr $0 HKCR &quot;MarkMasterFile&quot; &quot;&quot;<br />
19.   StrCmp $0 &quot;&quot; 0 skipAssoc<br />
20.	    WriteRegStr HKCR &quot;MarkMasterFile&quot; &quot;&quot; &quot;Program Options File&quot;<br />
21.   	WriteRegStr HKCR &quot;MarkMasterFile\shell&quot; &quot;&quot; &quot;open&quot;<br />
22.   	WriteRegStr HKCR &quot;MarkMasterFile\DefaultIcon&quot; &quot;&quot; $INSTDIR\mmx.exe,1<br />
23.   skipAssoc:<br />
24.     WriteRegStr HKCR &quot;MarkMasterFile\shell\open\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
25.     WriteRegStr HKCR &quot;MarkMasterFile\shell\edit&quot; &quot;&quot; &quot;Edit Mark Master File&quot;<br />
26.     WriteRegStr HKCR &quot;MarkMasterFile\shell\edit\command&quot; &quot;&quot; '$INSTDIR\mmx.exe &quot;%1&quot;'<br />
27. SectionEnd<br />
28. Function un.onUninstSuccess This code should be simpler and work as long as the commands for both file types are identical.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">6th July 2003, 11:13</div></div><div class="posttext">Excellent, so the code I had earlier would be better if the program was different? Very cool, thank you for your knowledge and expertise on this issue Vytautas.<br />
<br />
I certainly do look forward to an enhanced uninstall indeed. Thank you again for your time :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">8th July 2003, 12:56</div></div><div class="posttext">Sorry vbgunz, as can be seen from the discusion in this thread (http://forums.winamp.com/showthread.php?s=&amp;threadid=141249) the script for complete removal and restoration of previous registry keys will become very complicated and does not have a lot of benifits.  Most if not all other programs leave similar registry entries after their removal.  I will not completely give up on this topic and if I ever figgure out a simpler way of achieving this goal I will post it here.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">8th July 2003, 15:16</div></div><div class="posttext">Hello Vytautas,<br />
<br />
At the moment I am forced to leave behind the registry entries in which my program created during install? I would really like to then completely remove those entries without restoration to a previous association. <br />
<br />
Is this a real possibility? I believe it is simply sloppy of a program to leave anything behind. I hope you understand. Is it possible to completely remove the keys without worrying about restoring any previous ones?<br />
<br />
Thank you Vytautas :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">9th July 2003, 03:04</div></div><div class="posttext">Yes you can just delete the other key using this command.DeleteRegKey HKEY_CLASSES_ROOT &quot;MarkMasterFile&quot;Just be carefull to try and use a key which is unlikely to be registered to other programs, e.g. do not use a key such as 'txtfile'.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vbgunz</div><div class="date">9th July 2003, 19:11</div></div><div class="posttext">Thank you Vytautas, this does the trick :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>