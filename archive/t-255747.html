<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Uncheck Section IfFileExists, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Uncheck Section IfFileExists NSIS Discussion" />
	
	<title> Uncheck Section IfFileExists [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Uncheck Section IfFileExists</div>
<hr />
<div class="pda"><a href="t-255747.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=255747">Uncheck Section IfFileExists</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">18th September 2006, 18:25</div></div><div class="posttext">How do I unckeck a Section with IfFileExists?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Filus</div><div class="date">19th September 2006, 08:12</div></div><div class="posttext">Look at macros in Section.nsh file, probably you should use UnSelectSection macro.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">19th September 2006, 16:26</div></div><div class="posttext">Shouldn't this work?<br />
<br />
<br />
Function CheckInstall<br />
  IfFileExists $WINDIR\notepad.exe Skip<br />
  !insertmacro ReverseSection SecTest<br />
  Skip:<br />
FunctionEnd<br />
 <br />
<br />
Section &quot;Test&quot; SecTest<br />
  Call CheckInstall<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">20th September 2006, 18:08</div></div><div class="posttext">anyone?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2006, 18:19</div></div><div class="posttext">Not quite.<br />
The Section needs to be above the Function and the ReverseSection line needs to look like this:<br />
<br />
  !insertmacro ReverseSection ${SecTest}<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2006, 18:20</div></div><div class="posttext">Actually, you should use the UnselectSection macro.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">20th September 2006, 18:34</div></div><div class="posttext">I did as you said, but it doesn't work. :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2006, 18:39</div></div><div class="posttext">Your code is logically faulty. You can't unselect a section while it running!<br />
You should call your CheckInstall in the Components page leave function.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">20th September 2006, 18:42</div></div><div class="posttext">leave function? I need to run it before the component page load otherwise... it makes no sense. Call function needs to be in a Selection to function I read.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th September 2006, 18:45</div></div><div class="posttext">Sorry, I meant Pre function.<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE ComponentsPagePre<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
Function ComponentsPagePre<br />
...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">20th September 2006, 19:26</div></div><div class="posttext">Still no luck. Now it looks like this...<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE ComponentsPagePre<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
Function ComponentsPagePre<br />
 Call CheckInstall<br />
FunctionEnd<br />
<br />
Section &quot;Test&quot; SecTest<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  SetOverwrite ifnewer<br />
  ;Files Here<br />
SectionEnd<br />
<br />
Function CheckInstall<br />
  IfFileExists $WINDIR\NOTEPAD.EXE Skip<br />
   !insertmacro UnselectSection ${SecTest}<br />
  Skip:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">20th September 2006, 21:22</div></div><div class="posttext">IfFileExists &quot;$WINDIR\NOTEPAD.EXE&quot; Skip<br />
<br />
use quotes :) its safer.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">20th September 2006, 21:59</div></div><div class="posttext">Scripting an installer is hopeless, and looking at the number of threads in this forum I can see I'm not the only one haveing a hard time. I'll just have to use the zip2exe wizard.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">21st September 2006, 03:18</div></div><div class="posttext">You just have to have a little patience, really... if all you need to have is an auto-extracting .zip file.. sure, zip2exe or Winzip's functionalities are just dandy if not preferable.<br />
<br />
If you want a more complex system, NSIS is the way to go.<br />
<br />
If you could indicate whether Comm@nder21's last comment helped at all or not, we could have a closer look - as far as I can see things should work fine though.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st September 2006, 11:05</div></div><div class="posttext">Just to confirm, I'm assuming that you want to uncheck the Section if Notepad doesn't exist?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">22nd September 2006, 16:17</div></div><div class="posttext">If the file already exists, then uncheck.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd September 2006, 18:15</div></div><div class="posttext">You should read the docs again on IfFileExists. You're skipping your code if the file exists.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">22nd September 2006, 21:20</div></div><div class="posttext">Documentation.<br />
4.9.4.10 IfFileExists<br />
file_to_check_for jump_if_present [jump_otherwise]<br />
Checks for existence of file(s) file_to_check_for (which can be a wildcard, or a directory), and Gotos jump_if_present if the file exists, otherwise Gotos jump_otherwise. If you want to check to see if a file is a directory, use IfFileExists DIRECTORY\*.*<br />
<br />
IfFileExists $WINDIR\notepad.exe 0 +2<br />
  MessageBox MB_OK &quot;notepad is installed&quot;<br />
<br />
You shouldn't assume a normal person understand what is written in the manual. I don't understand it. It doesn't say how to do something if a file exist. Only option is jump.<br />
<br />
WTF is 0 +2? :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd September 2006, 21:27</div></div><div class="posttext">The jumps are explained earlier in the manual. But a better method is explained even earlier, in the tutorial (http://nsis.sourceforge.net/Docs/Chapter2.html#2.3.5.1).${If} ${FileExists} $WINDIR\notepad.exe<br />
  DetailPrint &quot;notepad found&quot;<br />
${Else}<br />
  DetailPrint &quot;notepad not found&quot;<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">22nd September 2006, 21:40</div></div><div class="posttext">Thanks. I managed to figure it out though. :)<br />
<br />
<br />
  IfFileExists &quot;file&quot; uncheck leave<br />
   uncheck:<br />
   !insertmacro UnselectSection ${SecTest}<br />
   leave:<br />
<br />
<br />
Though I still don't know what 0 +2 is. And I don't care. The ^tutorial only said yadi yadi yada to me. :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd September 2006, 23:34</div></div><div class="posttext">0 means don't jump anywhere, i.e. carry on onto the next instruction. +2 would mean jump over the proceding instruction onto the one after (i.e. 2 instructions from the current statement).<br />
+1 would be the same as 0.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">23rd September 2006, 09:17</div></div><div class="posttext">Ok so if I understand you correct, this code would do the same thing as the code above?<br />
<br />
<br />
IfFileExists &quot;file&quot; 0 +2<br />
   !insertmacro UnselectSection ${SecTest}<br />
<br />
<br />
EDIT: Tried but it didn't work. Unselect was always run.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">23rd September 2006, 09:25</div></div><div class="posttext">No, because macros are not one instruction. Macros often contain more than one instruction.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">em3</div><div class="date">23rd September 2006, 09:28</div></div><div class="posttext">Ok. Thank you.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">51819</div><div class="date">24th July 2007, 02:36</div></div><div class="posttext">!include &quot;MUI.nsh&quot;<br />
OutFile &quot;S32.exe&quot;<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE ComponentsPage1Pre<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
Function ComponentsPage1Pre<br />
  Call Check1<br />
  Call Check2<br />
  Call Check3<br />
  Call Check4<br />
  Call Check5<br />
FunctionEnd<br />
<br />
Function Check1<br />
IfFileExists $PROGRAMFILES\NSIS\NSIS.exe skip<br />
   !insertmacro UnselectSection ${Sec60}<br />
  skip:<br />
FunctionEnd<br />
<br />
Function Check2<br />
IfFileExists $PROGRAMFILESA\A.exe skip<br />
   !insertmacro UnselectSection ${Sec20}<br />
  skip:<br />
FunctionEnd<br />
<br />
Function Check3<br />
IfFileExists $PROGRAMFILES\DAEMON Tools\DAEMON.exe skip<br />
   !insertmacro UnselectSection ${Sec30}<br />
  skip:<br />
FunctionEnd<br />
<br />
Function Check4<br />
IfFileExists $PROGRAMFILES\QQGAME\Game.exe skip<br />
   !insertmacro UnselectSection ${Sec40}<br />
  skip:<br />
FunctionEnd<br />
<br />
Function Check5<br />
IfFileExists $windir\notepad skip<br />
   !insertmacro UnselectSection ${Sec50}<br />
  skip:<br />
FunctionEnd <br />
<br />
It had another methods?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">24th July 2007, 10:40</div></div><div class="posttext">Look at IfFileExists again.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">51819</div><div class="date">24th July 2007, 12:15</div></div><div class="posttext">oh.yes!!!thanks<br />
<br />
i know how to do it.<br />
!include Sections.nsh<br />
 <br />
Name TestSelectSection<br />
OutFile &quot;TestSelectSection.exe&quot;<br />
 <br />
Page components<br />
Page instfiles<br />
ShowInstDetails show<br />
 <br />
; This file will exist on most computers<br />
Section /o &quot;autoexec.bat detected&quot; autoexec_detected<br />
MessageBox MB_OK autoexec<br />
SectionEnd<br />
 <br />
Section /o &quot;Boot.ini detected&quot; boot_detected<br />
MessageBox MB_OK boot<br />
SectionEnd<br />
 <br />
Section /o &quot;non-existing file detected&quot; missing_detected<br />
MessageBox MB_OK missing<br />
SectionEnd<br />
 <br />
Function .onInit<br />
IfFileExists C:\autoexec.bat AutoexecExists PastAutoexecCheck<br />
AutoexecExists:<br />
  ; This is what is done by sections.nsh SelectSection macro<br />
  SectionGetFlags &quot;${autoexec_detected}&quot; $0<br />
  IntOp $0 $0 | ${SF_SELECTED}<br />
  SectionSetFlags &quot;${autoexec_detected}&quot; $0<br />
 <br />
PastAutoexecCheck:<br />
IfFileExists C:\boot.ini BootExists PastBootCheck<br />
BootExists:<br />
  ; Use the macro from sections.nsh<br />
  !insertmacro SelectSection ${boot_detected}<br />
 <br />
PastBootCheck:<br />
IfFileExists C:\xyz_missing.xyz MissingExists PastMissingCheck<br />
MissingExists:<br />
  !insertmacro SelectSection ${missing_detected}<br />
 <br />
PastMissingCheck:<br />
FunctionEnd</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>