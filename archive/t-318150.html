<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MUI2 InstFiles Leave custom function call order should change?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MUI2 InstFiles Leave custom function call order should change? NSIS Discussion" />
	
	<title> MUI2 InstFiles Leave custom function call order should change? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MUI2 InstFiles Leave custom function call order should change?</div>
<hr />
<div class="pda"><a href="t-318150.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318150">MUI2 InstFiles Leave custom function call order should change?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">4th April 2010, 03:24</div></div><div class="posttext">I was poking at a little something something and realized that I can use...<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE FunctionName<br />
...all I want, but if I'm using it to change the header text controls $mui.Header.Text and $mui.Header.SubText, then MUI2 is going to happily override that change with its internal code; it calls the custom function first, and runs its own code second.<br />
<br />
Shouldn't that be the other way around?<br />
<br />
( The same actually applies to the Pre function as well and probably applies to other pages. )<br />
<br />
Because MUI uses defines to set those texts, I can't override them during runtime in order to get MUI to use my own strings either.  Nor can I cheat by using 'goto mui.endheader_done' because it calls a Function - from which that won't work :D<br />
<br />
As far as I can tell - at least in the case of the InstFiles page - there's no harm in swapping the order either.<br />
<br />
Thoughts?<br />
<br />
Sample script:<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
!include &quot;winmessages.nsh&quot;<br />
<br />
outfile &quot;test.exe&quot;<br />
ShowInstDetails show<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE InstFilesLeave<br />
!insertmacro MUI_PAGE_INSTFILES<br />
<br />
Section<br />
SectionEnd<br />
<br />
Function InstFilesLeave<br />
  sendMessage $mui.Header.Text ${WM_SETTEXT} 0 &quot;STR: This doesn't stick&quot;<br />
  sendMessage $mui.Header.SubText ${WM_SETTEXT} 0 &quot;STR: ...neither does this&quot;<br />
  MessageBox MB_OK &quot;Now it's there... click OK and *poof*&quot;<br />
FunctionEnd<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th April 2010, 13:43</div></div><div class="posttext">Aren't you trying to set the next page's texts doing this? Unless you have omitted MUI_FINISHPAGE_NOAUTOCLOSE (SetAutoClose false).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">4th April 2010, 14:19</div></div><div class="posttext">No, I'm definitely trying to affect the IntFiles page's header text :)<br />
<br />
The MUI_FINISHPAGE_NOAUTOCLOSE define doesn't really play any role in this except that if one were to autoclose the InstFiles page, and the next page is the MUI Finish page (doesn't affect other pages) setting the text would be moot (well, ephemeral to the point of being moot).<br />
<br />
<br />
!include &quot;MUI2.nsh&quot;<br />
!include &quot;winmessages.nsh&quot;<br />
<br />
outfile &quot;test.exe&quot;<br />
ShowInstDetails show<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE InstFilesLeave<br />
!define MUI_FINISHPAGE_NOAUTOCLOSE<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
Section<br />
	Nop<br />
SectionEnd<br />
<br />
Function InstFilesLeave<br />
  sendMessage $mui.Header.Text ${WM_SETTEXT} 0 &quot;STR: This doesn't stick&quot;<br />
  sendMessage $mui.Header.SubText ${WM_SETTEXT} 0 &quot;STR: ...neither does this&quot;<br />
  MessageBox MB_OK &quot;Now it's there... click OK and *poof*&quot;<br />
FunctionEnd<br />
<br />
!insertmacro MUI_LANGUAGE &quot;English&quot;<br />
<br />
<br />
You should see the function, and MUI's own code*, being triggered without going to any next page.. the nomer &quot;Leave&quot; isn't entirely correct for the InstFiles page given its behavior, I suppose.<br />
<br />
* In MUI's own code, defined in Contrib\Modern UI 2\Pages\InstallFiles.nsh, this behavior is used to toggle between the two define'able texts wrt the installation being successful / having failed (Abort having been called during InstFiles).<br />
<br />
In theory this would probably affect the next page (presuming a page with a MUI header; the Finish page is not one of those) except that MUI always uses a Pre function to adjust that page's Header itself (either by the user-defined header texts, or its own internal ones).<br />
<br />
So anyway, the problem is that after I press OK in the MessageBox, my custom text disappears - I don't think it should.. thoughts? :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">5th April 2010, 12:40</div></div><div class="posttext">Perhaps you should submit a feature request.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">5th April 2010, 13:51</div></div><div class="posttext">Sounds good - just wanted to make sure I didn't miss something (non)-obvious that would prevent having to change MUI code :)<br />
<br />
In this particular case, a runtime toggle could also be added that would simply tell MUI to skip its UI handling code.<br />
<br />
I'll check into the other pages and such and see what the ramifications of call order changes might be.<br />
<br />
Request ticket logged in the mean time - thanks :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">5th April 2010, 15:19</div></div><div class="posttext">*smacks forehead*<br />
<br />
Of course, one can use a variable in MUI's defines for MUI_INSTFILESPAGE_FINISHHEADER_(SUB)TEXT and MUI_INSTFILESPAGE_ABORTHEADER_(SUB)TEXT<br />
<br />
I still think the call order is *technically* wrong, so I'll leave that ticket op and amend it - but the obvious workaround hit me anyway.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">6th April 2010, 10:45</div></div><div class="posttext">Yes I was going to say that but it isn't very elegant.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">6th April 2010, 10:57</div></div><div class="posttext">I think it's as elegant as it's going to get within the MUI framework... and beats adjusting the source at the moment :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>