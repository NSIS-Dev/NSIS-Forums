<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Selectively display pages?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Selectively display pages? NSIS Discussion" />
	
	<title> Selectively display pages? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Selectively display pages?</div>
<hr />
<div class="pda"><a href="t-268983.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=268983">Selectively display pages?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Snixtor</div><div class="date">5th April 2007, 05:55</div></div><div class="posttext">I'm trying to write an installed using the ModernUI that selectively displays certain pages.  In particular the installation directory page.  I want to create a single installer that can either install my program, or update an existing install (finding its directory from a registry key).  If it finds that registry key, I obviously don't need to be asking the user where to install the program, because the key tells me, and worst of all, if the user tries to change it, things won't happen as they'd expect.<br />
<br />
I've been trawling through the MUI include file to find some clues but it's incredibly hard to follow with so many function and macro names and calls being defined by variables (shouldn't this be illegal?) and very few comments.<br />
<br />
How can this be done?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">5th April 2007, 07:29</div></div><div class="posttext">Add abort in MUI_PAGE_CUSTOMFUNCTION_PRE</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Snixtor</div><div class="date">5th April 2007, 08:07</div></div><div class="posttext">That's got it! :up:  Except there is no MUI_PAGE_CUSTOMFUNCTION_PRE in the include file, instead it's hidden behind a myriad of macro's and functions using variables in their name declarations.  So it's more like:<br />
<br />
<br />
!macro MUI_FUNCTION_LICENSEPAGE PRE SHOW LEAVE<br />
<br />
  Function &quot;${PRE}&quot;<br />
    abort<br />
    ...<br />
  FunctionEnd<br />
<br />
  ...<br />
<br />
!macroend<br />
<br />
<br />
I'll probably be back with more questions later. :D<br />
<br />
<br />
Hang on, I think I see now what you meant, more like:<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_PRE MyCustom<br />
; License page<br />
!insertmacro MUI_PAGE_LICENSE &quot;mylicensefile.txt&quot;<br />
<br />
<br />
Where MyCustom is a function that contains abort, or the code to check if it should be aborted.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">5th April 2007, 08:33</div></div><div class="posttext">Except there is no MUI_PAGE_CUSTOMFUNCTION_PRE in the include file, ...Cute ;)<br />
What about taking a look on MUI documentation?<br />
<br />
http://nsis.sourceforge.net/Docs/Modern%20UI/Readme.html#customFunctions</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Snixtor</div><div class="date">5th April 2007, 08:57</div></div><div class="posttext">Originally posted by Red Wine <br />
Cute ;)<br />
:confused: <br />
<br />
<br />
Referring to my above edit, I got that now.  The scripting language in NSIS is totally new to me, so that it even has function pointers is a bit of a surprise.<br />
<br />
I'm trying to understand the underlying operation here, I can see that...<br />
<br />
<br />
!macro MUI_FUNCTION_LICENSEPAGE PRE SHOW LEAVE<br />
  Function &quot;${PRE}&quot;<br />
    !insertmacro MUI_PAGE_FUNCTION_CUSTOM PRE<br />
    ...<br />
  FunctionEnd<br />
...<br />
!macroend<br />
<br />
<br />
Calls<br />
<br />
<br />
!macro MUI_PAGE_FUNCTION_CUSTOM TYPE<br />
  !ifdef MUI_PAGE_CUSTOMFUNCTION_${TYPE}<br />
    Call &quot;${MUI_PAGE_CUSTOMFUNCTION_${TYPE}}&quot;<br />
  !undef MUI_PAGE_CUSTOMFUNCTION_${TYPE}<br />
  !endif<br />
!macroend<br />
<br />
<br />
Which in turn calls whatever function I've defined MUI_PAGE_CUSTOMFUNCTION_PRE to point to.  But what I can't figure out is how this:<br />
<br />
<br />
PageCallbacks ${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}... <br />
<br />
<br />
Ends up calling this:<br />
<br />
!macro MUI_FUNCTION_LICENSEPAGE PRE SHOW LEAVE<br />
  Function &quot;${PRE}&quot;<br />
  ...<br />
<br />
<br />
I can see by the behaviour that it does, but I don't understand the translation of &quot;${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}&quot; to that function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">8th April 2007, 16:14</div></div><div class="posttext">That last macro gets &quot;${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}&quot; as PRE and creates a function named ${PRE}. That function is defined by PageCallbacks as the pre callback function of the page and is therefore called by the paging system.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Snixtor</div><div class="date">10th April 2007, 05:14</div></div><div class="posttext">Originally posted by kichik <br />
That function is defined by PageCallbacks as the pre callback function of the page and is therefore called by the paging system. <br />
I understand that part, because it's like any callback or function pointer.  What I don't follow is the function signatures.  I've been an OO programmer for quite a while now, and I've been used to recognising function calls by their signature.  So you'll have:<br />
public void MyFunction(someparams)<br />
{<br />
  // Declarations in here<br />
}<br />
<br />
and call it by:<br />
MyFunction(someparams);<br />
<br />
I don't understand how the call &quot;${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}&quot; gets to:<br />
<br />
!macro MUI_FUNCTION_LICENSEPAGE PRE SHOW LEAVE<br />
  Function &quot;${PRE}&quot;<br />
<br />
The names are completely different, the signatures don't match.  Is there an intermediary involved that I'm not seeing?  Does it have something to do with this line?<br />
<br />
!insertmacro MUI_FUNCTION_LICENSEPAGE${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}<br />
${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicenseShow_${MUI_UNIQUEID}<br />
${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicenseLeave_${MUI_UNIQUEID}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">10th April 2007, 20:14</div></div><div class="posttext">That's explained in the first part of my post that you didn't quote ;)<br />
<br />
Again, the MUI_FUNCTION_LICENSEPAGE macro accepts three arguments. One of them is PRE, which is defined as the value passed in !insertmacro. On the macro insertion, &quot;${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}&quot; is passed as the first argument which is PRE. Therefore, when the macro is processed, PRE will be defined as &quot;${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}&quot;. In the macro itself, PRE is used as the function name for the pre callback function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Snixtor</div><div class="date">11th April 2007, 00:37</div></div><div class="posttext">Ok so the answer to:<br />
&quot;The names are completely different, the signatures don't match. Is there an intermediary involved that I'm not seeing? Does it have something to do with this line?&quot;<br />
is yes?<br />
<br />
That line:<br />
!insertmacro MUI_FUNCTION_LICENSEPAGE <br />
${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicensePre_${MUI_UNIQUEID}<br />
 ${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicenseShow_${MUI_UNIQUEID}<br />
 ${MUI_PAGE_UNINSTALLER_FUNCPREFIX}mui.LicenseLeave_${MUI_UNIQUEID}<br />
Is used to create the actual functions with their names as defined in that call?  So if I changed that to something like:<br />
!insertmacro MUI_FUNCTION_LICENSEPAGE Func1 Func2 Func3<br />
The PageCallbacks line would then be:<br />
PageCallbacks Func1 Func2 Func3<br />
Correct?<br />
<br />
If so, then I suppose my last question would be why it's done this way?  Why not simply have 3 functions defined as MUI_FUNCTION_LICENSEPAGE_PRE, SHOW and LEAVE?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th April 2007, 20:46</div></div><div class="posttext">The answer to first question is yes. There is an intermediary step and it's the macro insertion where PRE is defined as the function name.<br />
<br />
The second question also gets a yes. That's how macro parameters work.<br />
<br />
Why do it this way? So you can have multiple pages of the same type. That's what ${MUI_UNIQUEID} is for. The other define is for uninstaller pages.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>