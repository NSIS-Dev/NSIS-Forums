<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Wierd, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Wierd NSIS Discussion" />
	
	<title> Wierd [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Wierd</div>
<hr />
<div class="pda"><a href="t-127734.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=127734">Wierd</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 19:27</div></div><div class="posttext">Something has just started to my sections. The first section is never selected, even though I have told it to...<br />
<br />
.onInit<br />
<br />
	StrCpy $R1 ${secBSPnew} ; Gotta remember which section we are at now...<br />
	SectionGetFlags ${SecBSPreq} $R0<br />
	IntOp $R0 $R0 | ${SF_SELECTED}<br />
	SectionSetFlags ${SecBSPreq} $R0<br />
<br />
	SectionGetFlags ${SecBSPnew} $R0<br />
	IntOp $R0 $R0 | ${SF_SELECTED}<br />
	SectionSetFlags ${SecBSPnew} $R0<br />
<br />
	SectionGetFlags ${SecBSPold} $R0<br />
	IntOp $R0 $R0 &amp; ${SECTION_OFF}<br />
	SectionSetFlags ${SecBSPold} $R0<br />
<br />
	StrCpy $3 ${secVISfull} ; Gotta remember which section we are at now...<br />
	SectionGetFlags ${SecVISreq} $2<br />
	IntOp $2 $2 | ${SF_SELECTED}<br />
	SectionSetFlags ${SecVISreq} $2<br />
<br />
	SectionGetFlags ${SecVISfull} $2<br />
	IntOp $2 $2 | ${SF_SELECTED}<br />
	SectionSetFlags ${SecVISfull} $2<br />
<br />
	SectionGetFlags ${SecVISfast} $2<br />
	IntOp $2 $2 &amp; ${SECTION_OFF}<br />
	SectionSetFlags ${SecVISfast} $2<br />
<br />
	StrCpy $5 ${secRADextra} ; Gotta remember which section we are at now...<br />
	SectionGetFlags ${SecRADreq} $4<br />
	IntOp $4 $4 | ${SF_SELECTED}<br />
	SectionSetFlags ${SecRADreq} $4<br />
<br />
	SectionGetFlags ${SecRADextra} $4<br />
	IntOp $4 $4 | ${SF_SELECTED}<br />
	SectionSetFlags ${SecRADextra} $4<br />
<br />
	SectionGetFlags ${SecRADnormal} $4<br />
	IntOp $4 $4 | ${SF_SELECTED}<br />
	SectionSetFlags ${SecRADnormal} $4<br />
<br />
	SectionGetFlags ${SecRADfast} $4<br />
	IntOp $4 $4 &amp; ${SECTION_OFF}<br />
	SectionSetFlags ${SecRADfast} $4<br />
<br />
<br />
.onSecChange<br />
<br />
StrCpy $1 ${SF_SELECTED}<br />
SectionGetFlags ${secVISreq} $0<br />
IntOp $1 $1 &amp; $0<br />
SectionGetFlags ${secVISfull} $0<br />
IntOp $1 $1 &amp; $0<br />
SectionGetFlags ${secVISfast} $0<br />
IntOp $1 $1 &amp; $0<br />
StrCmp $1 0 skip2<br />
    SectionSetFlags ${secVISreq} 0<br />
    SectionSetFlags ${secVISfull} 0<br />
    SectionSetFlags ${secVISfast} 0<br />
skip2:<br />
<br />
StrCpy $1 ${SF_SELECTED}<br />
SectionGetFlags ${secRADreq} $0<br />
IntOp $1 $1 &amp; $0<br />
SectionGetFlags ${secRADextra} $0<br />
IntOp $1 $1 &amp; $0<br />
SectionGetFlags ${secRADnormal} $0<br />
IntOp $1 $1 &amp; $0<br />
SectionGetFlags ${secRADfast} $0<br />
IntOp $1 $1 &amp; $0<br />
StrCmp $1 0 skip3<br />
    SectionSetFlags ${secRADreq} 0<br />
    SectionSetFlags ${secRADextra} 0<br />
    SectionSetFlags ${secRADnormal} 0<br />
    SectionSetFlags ${secRADfast} 0<br />
skip3:<br />
<br />
	; Turn off old selected section<br />
	SectionGetFlags $R1 $R0<br />
	IntOp $R0 $R0 &amp; ${SECTION_OFF}<br />
	SectionSetFlags $R1 $R0<br />
<br />
	SectionGetFlags ${SecBSPnew} $R0<br />
	IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
	IntCmp $R0 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $R1 ${SecBSPnew}<br />
<br />
	SectionGetFlags ${SecBSPold} $R0<br />
	IntOp $R0 $R0 &amp; ${SF_SELECTED}<br />
	IntCmp $R0 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $R1 ${SecBSPold}<br />
<br />
	StrCmp $R1 $R1 0 +2 ; selection hasn't changed<br />
		SectionGetFlags $R1 $R0<br />
		IntOp $R0 $R0 | ${SF_SELECTED}<br />
		SectionSetFlags $R1 $R0<br />
<br />
<br />
	; Turn off old selected section<br />
	SectionGetFlags $2 $3<br />
	IntOp $3 $3 &amp; ${SECTION_OFF}<br />
	SectionSetFlags $2 $3<br />
<br />
	SectionGetFlags ${SecVISreq} $3<br />
	IntOp $3 $3 &amp; ${SF_SELECTED}<br />
	IntCmp $3 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $2 ${SecVISreq}<br />
<br />
	SectionGetFlags ${SecVISfull} $3<br />
	IntOp $3 $3 &amp; ${SF_SELECTED}<br />
	IntCmp $3 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $2 ${SecVISfull}<br />
<br />
	SectionGetFlags ${SecVISfast} $3<br />
	IntOp $3 $3 &amp; ${SF_SELECTED}<br />
	IntCmp $3 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $2 ${SecVISfast}<br />
<br />
	StrCmp $2 $2 0 +2 ; selection hasn't changed<br />
		SectionGetFlags $2 $3<br />
		IntOp $3 $3 | ${SF_SELECTED}<br />
		SectionSetFlags $2 $3<br />
<br />
<br />
	; Turn off old selected section<br />
	SectionGetFlags $4 $5<br />
	IntOp $5 $5 &amp; ${SECTION_OFF}<br />
	SectionSetFlags $4 $5<br />
<br />
	SectionGetFlags ${SecRADreq} $5<br />
	IntOp $5 $5 &amp; ${SF_SELECTED}<br />
	IntCmp $5 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $4 ${SecRADreq}<br />
<br />
	SectionGetFlags ${SecRADextra} $5<br />
	IntOp $5 $5 &amp; ${SF_SELECTED}<br />
	IntCmp $5 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $4 ${SecRADextra}<br />
<br />
	SectionGetFlags ${SecRADnormal} $5<br />
	IntOp $5 $5 &amp; ${SF_SELECTED}<br />
	IntCmp $5 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $4 ${SecRADnormal}<br />
<br />
	SectionGetFlags ${SecRADfast} $5<br />
	IntOp $5 $5 &amp; ${SF_SELECTED}<br />
	IntCmp $5 ${SF_SELECTED} 0 +2 +2<br />
		StrCpy $4 ${SecRADfast}<br />
<br />
	StrCmp $4 $4 0 +2 ; selection hasn't changed<br />
		SectionGetFlags $4 $5<br />
		IntOp $5 $5 | ${SF_SELECTED}<br />
		SectionSetFlags $4 $5<br />
<br />
<br />
The SecBSPnew should start selected but never does. I then have to click on it twice to select it.<br />
It just started happening, and I have no idea why.<br />
<br />
I just had 2 sections above it that I removed, but they were nothing to do with it.<br />
<br />
-Stuart:cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">8th March 2003, 19:50</div></div><div class="posttext">did you include:<br />
<br />
<br />
!Include &quot;Sections.nsh&quot;<br />
<br />
<br />
At the top of your script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 19:55</div></div><div class="posttext">Also, is it possible to rename directories<br />
<br />
I'd like to rename $7\textures to $7\texturesx<br />
<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 19:58</div></div><div class="posttext">Originally posted by dark_boy <br />
did you include:<br />
<br />
<br />
!Include &quot;Sections.nsh&quot;<br />
<br />
<br />
At the top of your script? <br />
<br />
I don't have NSIS 2.0b3 yet.<br />
That just has the different section defines<br />
I've got them in my script instead...<br />
<br />
!define SF_SELECTED   1<br />
!define SF_RO         16<br />
!define TEMP_SET      16+1<br />
!define SECTION_OFF   0xFFFFFFFE<br />
<br />
It wouldn't make any difference anyway.<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">8th March 2003, 20:25</div></div><div class="posttext">Originally posted by Afrow UK<br />
Also, is it possible to rename directories <br />
<br />
I'd like to rename $7\textures to $7\texturesx <br />
<br />
<br />
Here is the answer:<br />
<br />
[/quote]Quote from documentation<br />
<br />
3.8.1.6 Rename<br />
<br />
Rename source_file to dest_file. Functions just like the Win32 API MoveFile, which means you can move a file from anywhere on the system to anywhere else, and you can move a directory to somewhere else on the same drive. If /REBOOTOK is specified, and the file cannot be overwritten, then the file is moved when the system reboots -- if the file will be moved on a reboot, the reboot flag will be set. The error flag is set if the file cannot be renamed (and /REBOOTOK is not used) or if the source file does not exist.<br />
<br />
Example:<br />
<br />
;Here, $7 is &quot;C:\\Path\\&quot;<br />
<br />
Rename &quot;$7\\textures&quot; &quot;$7\\texturesx&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 20:59</div></div><div class="posttext">Ok thanks, I used that but it never seemed to work.<br />
<br />
Anyhow...<br />
Here is a small script to change the font of the Log Window Text, but it doesn't seem to work...<br />
<br />
<br />
!include &quot;${NSISDIR}\Include\WinMessages.nsh&quot;<br />
<br />
Function .onGUIInit<br />
    FindWindow $1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
    GetDlgItem $1 $HWNDPARENT 1016<br />
    CreateFont $2 &quot;Fixedsys&quot; &quot;8&quot; &quot;700&quot;<br />
    SendMessage $1 ${WM_SETFONT} $2 0<br />
FunctionEnd<br />
<br />
What have a done wrong?<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">8th March 2003, 21:26</div></div><div class="posttext">Hey! I fixed it:<br />
<br />
<br />
!include &quot;MUI.nsh&quot;<br />
!include &quot;WinMessages.nsh&quot;<br />
!define MUI_WELCOMEPAGE<br />
!define MUI_LICENSEPAGE<br />
!define MUI_COMPONENTSPAGE<br />
!define MUI_DIRECTORYPAGE<br />
!define MUI_CUSTOMFUNCTION_INSTFILES_SHOW &quot;LogFont&quot;<br />
!define MUI_FINISHPAGE_NOAUTOCLOSE<br />
!define MUI_FINISHPAGE<br />
<br />
Function &quot;LogFont&quot;<br />
FindWindow $1 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $1 $1 1016<br />
CreateFont $2 &quot;Comic Sans Ms&quot; &quot;8&quot; &quot;700&quot;<br />
SendMessage $1 ${WM_SETFONT} $2 0<br />
FunctionEnd<br />
<br />
<br />
<br />
I'm using the modern UI... <br />
If not, use <br />
<br />
<br />
Page instfiles &quot;&quot; &quot;LogFont&quot; &quot;&quot;<br />
<br />
<br />
helps? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 21:31</div></div><div class="posttext">Thanx dude :)<br />
<br />
I'll put it up on the Archive (written by you of course :))<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">8th March 2003, 21:35</div></div><div class="posttext">I'm going to write the code for the uninstaller log window, too.<br />
Shouldn't be a problem (I hope :igor: )</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 21:42</div></div><div class="posttext">I still can't get the Components problem fixed...<br />
<br />
Just doesn't make sense why it isn't working.<br />
<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">8th March 2003, 21:50</div></div><div class="posttext">Since I removed 2 old sections before it started playing up, I added 2 fake ones back:<br />
<br />
<br />
Section -2<br />
SectionEnd<br />
<br />
Section -1<br />
SectionEnd<br />
<br />
<br />
It has fixed it completely.<br />
<br />
Very strange!<br />
<br />
<br />
-Stuart</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">8th March 2003, 22:21</div></div><div class="posttext">About the LogFont in the uninstaller, done :D<br />
<br />
<br />
Function &quot;un.LogFont&quot;<br />
FindWindow $3 &quot;#32770&quot; &quot;&quot; $HWNDPARENT<br />
GetDlgItem $3 $3 1016<br />
CreateFont $4 &quot;Comic Sans Ms&quot; &quot;8&quot; &quot;700&quot;<br />
SendMessage $3 ${WM_SETFONT} $4 0<br />
FunctionEnd<br />
<br />
Section &quot;Uninstall&quot;<br />
Call un.LogFont<br />
...<br />
SectionEnd<br />
<br />
<br />
yupi :p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">9th March 2003, 00:00</div></div><div class="posttext">I discovered a bug in System.nsh (in folder Modern UI):<br />
<br />
These !defines aren't working:<br />
<br />
!define MUI_UNCUSTOMFUNCTION_INSTFILES_PRE<br />
!define MUI_UNCUSTOMFUNCTION_INSTFILES_SHOW<br />
!define MUI_UNCUSTOMFUNCTION_INSTFILES_LEAVE<br />
<br />
The &quot;{MUI_UNCUSTOMFUNCTION_INSTFILES_PRE}&quot;, &quot;{MUI_UNCUSTOMFUNCTION_INSTFILES_SHOW}&quot; and &quot;{MUI_UNCUSTOMFUNCTION_INSTFILES_LEAVE}&quot; are laking a $ before these, here is the code that have this bug (quote from System.nsh):<br />
<br />
<br />
!macro MUI_UNFUNCTION_INSTFILESPAGE PRE SHOW LEAVE<br />
<br />
  !ifndef MUI_NOVERBOSE<br />
    !ifndef MUI_MANUALVERBOSE<br />
      !verbose 3<br />
    !endif<br />
  !endif<br />
<br />
  Function ${PRE}<br />
    !insertmacro MUI_HEADER_TEXT $(un.MUI_UNTEXT_UNINSTALLING_TITLE) $(un.MUI_UNTEXT_UNINSTALLING_SUBTITLE)<br />
    !ifdef MUI_UNCUSTOMFUNCTION_INSTFILES_PRE<br />
      Call &quot;{MUI_UNCUSTOMFUNCTION_INSTFILES_PRE}&quot;<br />
    !endif<br />
  FunctionEnd<br />
<br />
  Function &quot;${SHOW}&quot;<br />
    !ifdef MUI_UNCUSTOMFUNCTION_INSTFILES_SHOW<br />
      Call &quot;{MUI_UNCUSTOMFUNCTION_INSTFILES_SHOW}&quot;<br />
    !endif<br />
  FunctionEnd<br />
  <br />
  Function &quot;${LEAVE}&quot;<br />
    !ifdef MUI_UNCUSTOMFUNCTION_INSTFILES_LEAVE<br />
      Call &quot;{MUI_UNCUSTOMFUNCTION_INSTFILES_LEAVE}&quot;<br />
    !endif<br />
  FunctionEnd<br />
  <br />
  !ifndef MUI_NOVERBOSE<br />
    !ifndef MUI_MANUALVERBOSE<br />
      !verbose 4<br />
    !endif<br />
  !endif<br />
  <br />
!macroend<br />
<br />
This is the code to fix that:<br />
<br />
<br />
!macro MUI_UNFUNCTION_INSTFILESPAGE PRE SHOW LEAVE<br />
<br />
  !ifndef MUI_NOVERBOSE<br />
    !ifndef MUI_MANUALVERBOSE<br />
      !verbose 3<br />
    !endif<br />
  !endif<br />
<br />
  Function ${PRE}<br />
    !insertmacro MUI_HEADER_TEXT $(un.MUI_UNTEXT_UNINSTALLING_TITLE) $(un.MUI_UNTEXT_UNINSTALLING_SUBTITLE)<br />
    !ifdef MUI_UNCUSTOMFUNCTION_INSTFILES_PRE<br />
      Call &quot;${MUI_UNCUSTOMFUNCTION_INSTFILES_PRE}&quot;<br />
    !endif<br />
  FunctionEnd<br />
<br />
  Function &quot;${SHOW}&quot;<br />
    !ifdef MUI_UNCUSTOMFUNCTION_INSTFILES_SHOW<br />
      Call &quot;${MUI_UNCUSTOMFUNCTION_INSTFILES_SHOW}&quot;<br />
    !endif<br />
  FunctionEnd<br />
  <br />
  Function &quot;${LEAVE}&quot;<br />
    !ifdef MUI_UNCUSTOMFUNCTION_INSTFILES_LEAVE<br />
      Call &quot;${MUI_UNCUSTOMFUNCTION_INSTFILES_LEAVE}&quot;<br />
    !endif<br />
  FunctionEnd<br />
  <br />
  !ifndef MUI_NOVERBOSE<br />
    !ifndef MUI_MANUALVERBOSE<br />
      !verbose 4<br />
    !endif<br />
  !endif<br />
  <br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">9th March 2003, 00:34</div></div><div class="posttext">Thanks. Fixed :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">9th March 2003, 01:52</div></div><div class="posttext">no wonder... :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">9th March 2003, 17:08</div></div><div class="posttext">Afrow and deguix, please attach huge scripts or edit them to show only the relative contents. It's impossible to read forum threads when they are filled with dozens of lines of code.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>