<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Registry functions and variables?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Registry functions and variables? NSIS Discussion" />
	
	<title> Registry functions and variables? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Registry functions and variables?</div>
<hr />
<div class="pda"><a href="t-152822.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=152822">Registry functions and variables?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MathiasSimmack</div><div class="date">16th October 2003, 17:08</div></div><div class="posttext">Hi.<br />
<br />
Is it (or will it be) possible to use real variables for the registry functions? This isn't working<br />
Var RegRoot<br />
<br />
StrCpy $RegRoot HKLM<br />
WriteRegStr $RegRoot &quot;PathToSomewhere&quot; &quot;ValueName&quot; &quot;Value&quot;<br />
but I could need something like this for my version comparison. I save the setup's current version number to prevent that a user can install an older version if a newer version is already installed. The problem is: I have a few setups, you can use without Admin privileges. In this situation, I need to save the version into the HKCU path.<br />
But let's say there are two Administrators: Admin #1 installs my application, Admin #2 removes it. Then Admin #1 still has the version number in his HKCU path. :(<br />
<br />
Therefore I need a way to change the registry root, depending on the logged user's privileges. If he/she is an Admin, I can use HKLM - otherwise I use HKCU.<br />
A work-around: I have to write different macros for saving, comparing and removing the version number, depending on the user's privileges. But this is inefficient, IMHO, because the code is the same. Just the registry root differs.<br />
<br />
Is there a solution for me?<br />
Thanks for reading.<br />
<br />
Mathias.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">16th October 2003, 18:31</div></div><div class="posttext">It's not the user variable. HKLM/HKCU/etc is a compile time setting.<br />
<br />
You should use:<br />
<br />
StrCmp $RegRoot HKLM 0 +2<br />
  WriteRegStr HKLM &quot;PathToSomewhere&quot; &quot;ValueName&quot; &quot;Value&quot;<br />
<br />
StrCmp $RegRoot HKCU 0 +2<br />
  WriteRegStr HKCU &quot;PathToSomewhere&quot; &quot;ValueName&quot; &quot;Value&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MathiasSimmack</div><div class="date">16th October 2003, 21:23</div></div><div class="posttext">Hey, this is a good idea. Why didn't I ... ;)<br />
Thanks for cleaning up my head, man! :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>