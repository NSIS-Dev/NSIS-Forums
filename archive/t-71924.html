<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Refresh with SendMessage, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Refresh with SendMessage NSIS Discussion" />
	
	<title> Refresh with SendMessage [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Refresh with SendMessage</div>
<hr />
<div class="pda"><a href="t-71924.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=71924">Refresh with SendMessage</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">14th January 2002, 17:02</div></div><div class="posttext">Hi all,<br />
<br />
I previously asked questions about SendMessage (for those interested: I have a fight with Matlab: it doesn't understand my messages amd I don't understand it's output so we've broken up and I tried something else to install a plugin into Matlab... and succeeded :)).<br />
<br />
But now: how to refresh the desktop (like F5)? My little program created in NSIS edits some HTML page on the Active Desktop (Windows) and I need to refresh the desktop to load this page.<br />
<br />
Is it possible using SendMessage. How?<br />
<br />
Thx, greetz, Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">14th January 2002, 18:12</div></div><div class="posttext">Nice that you've found a solution for your problem :)<br />
<br />
The refresh thing should work when you send an WM_SETTINGCHANGE with the hwnd HWND_BROADCAST.<br />
<br />
Since WM_SETTINGCHANGE resolves to 26 and HWND_BROADCAST to 0xFFFF a call toSendMessage 65535 26 0 0 should do the job.<br />
<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">14th January 2002, 18:19</div></div><div class="posttext">Florian, thx a lot,<br />
<br />
it works great!!!<br />
<br />
Thx, thx, thx, greetz,<br />
Hendri.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Smile2Me</div><div class="date">14th January 2002, 18:42</div></div><div class="posttext">Florian, sorry,<br />
<br />
for a minnute it appeared to work great, because my screen flashed,<br />
but after implementing this into the HTML editor for my active desktop I saw that only the desktop gets a refresh, except my Active Desktop (the HTML doc).<br />
<br />
How to refresh this one then? (And maybe also ONLY this one if possible...)<br />
<br />
Can you help me, thx, greetz,<br />
Hn3.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nebulus</div><div class="date">1st August 2003, 15:05</div></div><div class="posttext">If NSIS can exec an external vbscript, I've got the answer.<br />
<br />
I did have the script writing to the registry and refreshing the desktop, but it just wasn't updating to display the new page. this code does it. To test, just create a dummy HTML page and set it in your %systemroot%\web\wallpaper directory, then change the script to point to the correctly named page.<br />
<br />
Running the script will set the desktop, open the display properties window, move the selection up/down, then click the OK button. It's dirty, but it gets done!<br />
<br />
****************************************<br />
BEGIN CODE<br />
****************************************<br />
' Create the variables needed<br />
Dim WSHShell<br />
Dim WSHApp<br />
Dim strRegKey<br />
Dim strWallpaper<br />
Dim strOSRoot<br />
Dim strDesktop<br />
Dim strDisplayProp<br />
<br />
' Create the Wscript Shell object<br />
Set WSHShell = WScript.CreateObject(&quot;WScript.Shell&quot;)<br />
Set WSHApp   = CreateObject(&quot;Shell.Application&quot;)<br />
<br />
' Define the wallpaper<br />
strWallpaper   = &quot;%SystemRoot%\Web\Wallpaper\PRWeb.html&quot;<br />
strDesktop     = WSHShell.SpecialFolders(&quot;Desktop&quot;)<br />
strDisplayProp = &quot;Display Properties&quot;<br />
<br />
' Create the wallpaper key<br />
strRegKey =  &quot;HKEY_CURRENT_USER\&quot;<br />
strRegKey = strRegKey &amp; &quot;Software\&quot;<br />
strRegKey = strRegKey &amp; &quot;Microsoft\&quot;<br />
strRegKey = strRegKey &amp; &quot;Internet Explorer\&quot;<br />
strRegKey = strRegKey &amp; &quot;Desktop\&quot;<br />
strRegKey = strRegKey &amp; &quot;General\&quot;<br />
strRegKey = strRegKey &amp; &quot;Wallpaper&quot;<br />
<br />
' Write the key, type, and value<br />
WSHShell.RegWrite strRegKey, strWallpaper, &quot;REG_EXPAND_SZ&quot;<br />
<br />
WSHApp.ControlPanelItem cstr(&quot;desk.cpl&quot;)<br />
Do Until WSHShell.AppActivate (strDisplayProp)<br />
Loop<br />
WSHShell.SendKeys &quot;{down}{up}{tab 3}a~&quot;<br />
****************************************<br />
END CODE<br />
****************************************<br />
<br />
The only problem you might have is with a virus scanner - it'll throw up an alert as soon as you try to run a .vbs file. Hope that helps!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>