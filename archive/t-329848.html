<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Linker for listview subitems, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Linker for listview subitems NSIS Discussion" />
	
	<title> Linker for listview subitems [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Linker for listview subitems</div>
<hr />
<div class="pda"><a href="t-329848.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=329848">Linker for listview subitems</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">20th April 2011, 08:51</div></div><div class="posttext">Hi,<br />
<br />
I wrote a very basic plugin, based on the old linker.dll, that support also listview subitems. I couldn't get it to change the fonts and styles of the subitem (but again, I didn't really try so you are all welcome to fix it :))<br />
<br />
Linker::lvlink /NOUNLOAD ${hwndLV_} ${iItem_} ${iSubItem_} ${url_}<br />
<br />
The original linker:<br />
http://nsis.sourceforge.net/Linker_plug-in<br />
<br />
for some reason I can't upload the attachment... so here it is: <br />
<br />
http://www.mediafire.com/?smb6nz5oarpfmk5</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th April 2011, 08:57</div></div><div class="posttext">Good work. Please post on the Wiki so that it doesn't get lost. Just upload to http://nsis.sf.net/File:Linker.zip.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">20th April 2011, 09:21</div></div><div class="posttext">uploaded to http://nsis.sf.net/File:Linker.zip.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">22nd April 2011, 08:33</div></div><div class="posttext">I only see black text, without underline, and normal cursor when hovering, except it will open browser when I click the text. But after read the source I find that it support underline etc. It is very strange that it displays like normal text on My Windows XP.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">26th April 2011, 09:28</div></div><div class="posttext">I only see black text, without underline, and normal cursor when hovering, except it will open browser when I click the text. But after read the source I find that it support underline etc. It is very strange that it displays like normal text on My Windows XP.<br />
Hi jiake,<br />
<br />
In the code there are two event listeners, one for labels (the original linker) and one for listviews (with _lv_ somewhere in its name). The original *IS* adding the style, cursor, etc. and I didn't change it at all. I removed the style changes for the listview methods as I couldn't get the handle for the text (and I don't think it has one, cause if it had everything would be a lot easier to begin with). Anyway, this is my first attempt to edit/create a plugin and my knowledge in WIN32 programming is below basic. So if any of you WIN32 sharks are willing to take a look at the code and make the desired changes so the text in the subitem will be underlined, blue and with correct cursor when being hovered you are most welcome.<br />
<br />
Thanks,<br />
<br />
J</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">15th May 2011, 16:51</div></div><div class="posttext">Hi,<br />
<br />
I'm trying to change the color of the text of the subitems that are defined as links. But I'm having troubles: I have a handler which:<br />
<br />
case WM_NOTIFY:<br />
		{	switch (((LPNMHDR)lParam)-&gt;code)<br />
			{	case NM_CUSTOMDRAW:<br />
				{	SetWindowLongPtr(hwnd, DWL_MSGRESULT,(LONG_PTR)ProcessCustomDraw(lParam));<br />
					return TRUE;<br />
				}	<br />
			}<br />
			break;<br />
		}<br />
<br />
...<br />
...<br />
<br />
return CallWindowProc(oldproc,hwnd,uMsg,wParam,lParam);<br />
<br />
but when it calls the oldproc (original handler), after changing DWL_MSGRESULT to be CDRF_NOTIFYITEMDRAW (0x20) for example, I get an error saying that there is a read violation when trying to access 0x00000020 (which is the DWL_MSGRESULT) I suspect that there's a bug in the original handler who for some reason tries to read result as a pointer instead of a value, or maybe I'm calling it the wrong way - I think it is part of the nsDialogs, but I'm not sure. If I use instead the DefWindowProc I don't get the error but I also don't see any of the items... any ideas?:(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th May 2011, 16:58</div></div><div class="posttext">http://msdn.microsoft.com/en-us/library/ff919573%28v=vs.85%29.aspx<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">15th May 2011, 20:58</div></div><div class="posttext">Hi Stu,<br />
<br />
Thanks for the reply. It seems now that I tried everything and nothing works. The problem I got earlier was due to returning the result with SetWindowLong which is relevant only for Dialog window.<br />
<br />
I would really (really really) appreciate it if you could take a look in the code and help me out :). <br />
<br />
http://www.mediafire.com/?pd6tf3p1r269d84<br />
<br />
p.s.<br />
<br />
the relevant code is around lines 304 and 279 of URLCtrl.c</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">16th May 2011, 06:42</div></div><div class="posttext">Maybe this tutorial can help you: http://www.codeguru.com/cpp/controls/staticctrl/article.php/c5803</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">16th May 2011, 07:08</div></div><div class="posttext">Hi T.Slappy,<br />
<br />
Thanks for your reply. My current problem is accessing the subitems in the list view - I'm not getting the event (CDDS_ITEMPREPAINT | CDDS_SUBITEM). as a matter of fact I suspect I'm getting the notifications only for the titles and not for the items themselves: If I have 4 colums and 10 rows I get only 5 NM_CUSTOMDRAW events - one is PREPAINT and the other four are ITEMPREPAINTs.<br />
<br />
Anyway, once I'll get notifications for each subitem I would do something like what you sent. But I'm still not there.<br />
<br />
Thanks,<br />
<br />
J</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">17th May 2011, 14:05</div></div><div class="posttext">Hi,<br />
<br />
I've managed to solve all the problems and I now released a new version which better supports subitems in listviews. It now changes the color to blue and after a click it changes to purple (this is the default, but can be changed the same way it is with labels). It also changes the cursor to a hand when hovering on the subitem.<br />
<br />
(it's already updated in http://nsis.sourceforge.net/File:Linker.zip (http://nsis.sourceforge.net/File:Linker.zip))<br />
<br />
J</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">23rd May 2011, 10:19</div></div><div class="posttext">Hi<br />
For some time I am trying to subclass label #1006 on Install page and draw text by myself.<br />
I looked into Linker sources and I found this issue in this plugin:<br />
<br />
Your window procedure looks like this:<br />
LRESULT CALLBACK UrlMainProc(HWND hwnd,UINT uMsg,WPARAM wParam,LPARAM lParam)<br />
case WM_PAINT:<br />
{	PAINTSTRUCT ps;<br />
	HDC hdc=(HDC)wParam;<br />
	if(wParam==0) hdc=BeginPaint(hwnd,&amp;ps);<br />
	if(hdc)<br />
	{	DrawUrl(hwnd,hdc,NULL); // HERE IS THE MAIN DRAWING - YOUR FUNCTION<br />
			if(wParam==0) EndPaint(hwnd,&amp;ps);<br />
	}<br />
	return 0;<br />
}		<br />
case WM_SETTEXT:<br />
{	<br />
	LRESULT result=CallWindowProc(oldproc,hwnd,uMsg,wParam,lParam); // HERE you call standard Win function to draw the text<br />
.....<br />
}<br />
<br />
The problem is that you draw text in WM_SETTEXT by CallWindowProc() and then next in WM_PAINT in your function.<br />
Whole text is drawn twice which produces ugly effect (however it is not visible because you fill area with BTNFACE color)<br />
This problem is visible when I use TRANSPARENT color for background in my plugin.<br />
<br />
How can I reduce this twice writing?<br />
Commenting out LRESULT result=CallWindowProc()... will not help, because text will not be refreshed properly and it will be written over itself (like in layers).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">zenpoy</div><div class="date">23rd May 2011, 12:16</div></div><div class="posttext">Hi,<br />
<br />
The part that changes the text on labels was taken from http://www.catch22.net/tuts/urlctrl, so your answer might lie there.<br />
<br />
For what it worth, I think that WM_SETTEXT is being sent when the text is changed and the handler changes the the url to be placed in the correct position. WM_PAINT does the actual draw of the url.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>