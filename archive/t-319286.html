<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" rename fails in oninit.nsh, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  rename fails in oninit.nsh NSIS Discussion" />
	
	<title> rename fails in oninit.nsh [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  rename fails in oninit.nsh</div>
<hr />
<div class="pda"><a href="t-319286.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=319286">rename fails in oninit.nsh</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kalverson</div><div class="date">19th May 2010, 18:09</div></div><div class="posttext">I have a user who is running into a rename failure on his PC and his alone.  For some odd reason, it has something to do with where the Nullsoft install exe is created.  When an install exe is created on his own PC, both renames works fabously every time.  When the same install exe is created on the build server or any where else, the 2nd rename fails on his PC.  The renames are in the oninit.nsh header and are used to determine if any files in the product install folder are in use (locked).  The first rename works fine, but the rename back to the original does not work.  Has anyone seen this before?  What could cause this?<br />
<br />
  ; check for locked destination folder rename &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME}&quot; &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME}tmp&quot;<br />
  IfFileExists '$STR_JAVAINSTALLPATH\${PRODUCT_NAME}tmp' renameworked renamefailed<br />
...<br />
renameworked:<br />
rename &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME tmp&quot; &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME}&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">19th May 2010, 21:24</div></div><div class="posttext">rename &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME tmp&quot; &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME}&quot;<br />
It might work better if you fix the typo.<br />
<br />
rename &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME} tmp&quot; &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME}&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th May 2010, 22:04</div></div><div class="posttext">And note MSG's typo (the space after the }). If you are wondering why things don't work then throw in some MessageBox's that display the actual instruction and its arguments. It is basic debugging skills.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th May 2010, 05:47</div></div><div class="posttext">And note MSG's typo (the space after the }).<br />
Actually the original had one as well, so I just left it in. Since it's a folder name it can have spaces. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">20th May 2010, 07:58</div></div><div class="posttext">Since it's working on other PC's, I suppose it's a typo in this post, not in the original code.<br />
<br />
Maybe the first rename is not finished when the second rename is called, so the tmp folder is still locked by the first rename action.<br />
I think I read a post before somewhere on the forum that the rename call does return before the rename is really finished.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">20th May 2010, 16:00</div></div><div class="posttext">Actually the original had one as well, so I just left it in. Since it's a folder name it can have spaces. :)<br />
Correct but his correct string (in the comment) does not have a space.<br />
<br />
Another option is to build with logging on. We now use the logging build by default and logs are uploaded to a central server if an install fails.<br />
<br />
See: http://nsis.sf.net/Special_Builds<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">21st May 2010, 05:46</div></div><div class="posttext">Correct but his correct string (in the comment) does not have a space.<br />
I stand corrected. :-)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kalverson</div><div class="date">21st May 2010, 11:40</div></div><div class="posttext">It might work better if you fix the typo.<br />
<br />
rename &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME} tmp&quot; &quot;$STR_JAVAINSTALLPATH\${PRODUCT_NAME}&quot;<br />
<br />
Yes, I noticed the typo as well, but that occurred during the my posting.  The closing } was in the original code which is working well.  I wrote a small c program to do the rename for me and that worked well on the failing PC.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd May 2010, 13:30</div></div><div class="posttext">If you think this is a bug then please submit a bug report. Also to test further you could put in a small Sleep and see if that fixes it.<br />
<br />
Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>