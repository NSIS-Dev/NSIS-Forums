<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to use InstallOptions?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to use InstallOptions? NSIS Discussion" />
	
	<title> How to use InstallOptions? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to use InstallOptions?</div>
<hr />
<div class="pda"><a href="t-187850.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=187850">How to use InstallOptions?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rien</div><div class="date">26th July 2004, 14:23</div></div><div class="posttext">Hello,<br />
<br />
I tried the last three days to find the solution,<br />
but I couldn't managed it.<br />
<br />
I will use a custom finish page for the classic installer.<br />
<br />
I have used follow ini file (finish_page.ini):<br />
<br />
[Settings]<br />
NumFields=3<br />
<br />
[Field 1]<br />
Type=GroupBox<br />
Left=0<br />
Right=-1<br />
Top=0<br />
Bottom=-5<br />
Text=Installation Complete<br />
<br />
[Field 2]<br />
Type=checkbox<br />
Text=Create a shortcut on your desktop?<br />
Left=10<br />
Right=-10<br />
Top=17<br />
Bottom=25<br />
State=1<br />
Flags=GROUP<br />
<br />
[Field 3]<br />
Type=checkbox<br />
Text=Launch MyApp!<br />
Left=10<br />
Right=-10<br />
Top=43<br />
Bottom=51<br />
State=1<br />
Flags=GROUP<br />
<br />
<br />
and this working InstallOption page:<br />
<br />
<br />
!define TEMP1 $R0 ;Temp variable<br />
<br />
;The name of the installer<br />
Name &quot;MyApp&quot;<br />
<br />
;The file to write<br />
OutFile &quot;MyApp.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\MyApp&quot;<br />
; Show install details<br />
ShowInstDetails show<br />
<br />
;Things that need to be extracted on startup<br />
;Only useful for BZIP2 compression<br />
;Use ReserveFile for your own InstallOptions INI files too!<br />
<br />
ReserveFile &quot;${NSISDIR}\Plugins\InstallOptions.dll&quot;<br />
ReserveFile &quot;finish_page.ini&quot;<br />
<br />
;Order of pages<br />
;Custom page. InstallOptions gets called in SetCustom.<br />
Page custom SetCustom ValidateCustom &quot;: Finish Page&quot; <br />
Page instfiles<br />
<br />
Section &quot;Finish_page&quot;<br />
  ;Get Install Options dialog user input<br />
<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  DetailPrint &quot;Create Shortcut=${TEMP1}&quot;<br />
  <br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
  DetailPrint &quot;Start Game=${TEMP1}&quot;<br />
SectionEnd<br />
<br />
Function .onInit<br />
  ;Extract InstallOptions files<br />
  ;$PLUGINSDIR will automatically be removed when the installer closes<br />
  <br />
  InitPluginsDir<br />
  File /oname=$PLUGINSDIR\finish_page.ini &quot;finish_page.ini&quot;<br />
  <br />
FunctionEnd<br />
<br />
Function SetCustom<br />
  ;Display the InstallOptions dialog<br />
<br />
  Push ${TEMP1}<br />
<br />
    InstallOptions::dialog &quot;$PLUGINSDIR\finish_page.ini&quot;<br />
    Pop ${TEMP1}<br />
  <br />
  Pop ${TEMP1}<br />
<br />
FunctionEnd<br />
<br />
Function ValidateCustom<br />
<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  StrCmp ${TEMP1} 1 done<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
  StrCmp ${TEMP1} 1 done<br />
<br />
  done:<br />
 <br />
FunctionEnd<br />
<br />
<br />
Please can somebody add the script for the &quot;Creating DesktopShortcut&quot; and &quot;Launching App&quot;?<br />
I doesn't understand the recognition of the used checkbox and the needed function for the checkbox.<br />
<br />
I think for a profi it couldn't be difficult and perhaps you take a minute to help me.<br />
<br />
Thank you! and best regards.<br />
<br />
Rien</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2004, 15:11</div></div><div class="posttext">You need to compare the ${TEMP1} variable values with 1 (for selected).<br />
<br />
E.g.<br />
Function ValidateCustom<br />
Push ${TEMP1}<br />
<br />
## Create shortcut<br />
ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
StrCmp ${TEMP1} 1 0 +2<br />
 CreateShortcut ...<br />
<br />
## Launch program<br />
ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
StrCmp ${TEMP1} 1 0 +2<br />
 Exec ...<br />
<br />
Pop ${TEMP1}<br />
FunctionEnd<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">26th July 2004, 15:17</div></div><div class="posttext">I can help you with this...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rien</div><div class="date">27th July 2004, 03:34</div></div><div class="posttext">Hi Afrow UK,<br />
<br />
thank you for your help and for the correction of your<br />
script, because first I add your script to this Section:<br />
<br />
<br />
<br />
Section &quot;Finish_page&quot;<br />
  ;Get Install Options dialog user input<br />
<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  DetailPrint &quot;Create Shortcut=${TEMP1}&quot;<br />
  ## Create shortcut<br />
StrCmp ${TEMP1} 1 0 +2<br />
 CreateShortcut ...<br />
.<br />
.<br />
.<br />
<br />
<br />
This works, but I have forgot that I would create a finish page with this options.<br />
So I have change the order of the page list.<br />
<br />
;Order of pages<br />
Page instfiles<br />
;Custom page. InstallOptions gets called in SetCustom.<br />
Page custom SetCustom ValidateCustom &quot;: Finish Page&quot; <br />
...<br />
<br />
-&gt; the result, all files and the options are installed<br />
before I could make a choice!<br />
<br />
After your correction I used your script in the &quot;Function ValidateCustom&quot; Section and this is really better.<br />
:) <br />
<br />
Now, I have only one question. In the detail list of the installer I always see that the options are choiced before the finishpage.<br />
<br />
The reason is this, I think:<br />
<br />
Section &quot;Finish_page&quot;<br />
  ;Get Install Options dialog user input<br />
<br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
  DetailPrint &quot;Create Shortcut=${TEMP1}&quot;<br />
  <br />
  ReadINIStr ${TEMP1} &quot;$PLUGINSDIR\finish_page.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
    DetailPrint &quot;Start Game=${TEMP1}&quot;<br />
SectionEnd<br />
<br />
<br />
Can you tell me how I can correct this?<br />
<br />
@Hello Lobo Lunar! Sorry, that I have not the time to<br />
test your script. It is a bittle late, but I will test it tomorrow.<br />
<br />
Thanks also for your help.<br />
<br />
Good Night!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">27th July 2004, 11:58</div></div><div class="posttext">Sections are executed only on the Instfiles page, before your Custom page. Therefore, how can it see what your user has selected before they have selected it?<br />
<br />
Why don't you just delete the whole &quot;Finish_page&quot; Section, as it isn't necessary.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rien</div><div class="date">28th July 2004, 15:37</div></div><div class="posttext">Hello Afrow UK and Lobo Lunar,<br />
<br />
thanks for your help. The script works now very fine<br />
with all options and the wanted look.<br />
<br />
<br />
@Lobo Lunar, with your script I have one problem.<br />
If I choice &quot;Launch MyApp! the app will run before it is installed!<br />
<br />
io.ini<br />
<br />
[Settings]<br />
NumFields=3<br />
<br />
[Field 1]<br />
Type=GroupBox<br />
Left=0<br />
Right=-1<br />
Top=0<br />
Bottom=-5<br />
Text=Installation Complete<br />
<br />
[Field 2]<br />
Type=checkbox<br />
Text=Create a shortcut on your desktop?<br />
Left=10<br />
Right=-10<br />
Top=17<br />
Bottom=25<br />
State=0<br />
<br />
[Field 3]<br />
Type=checkbox<br />
Text=Launch MyApp!<br />
Left=10<br />
Right=-10<br />
Top=43<br />
Bottom=51<br />
State=0<br />
<br />
<br />
example.nsi<br />
<br />
BesterSetCompressor lzma<br />
XPStyle on<br />
<br />
Name &quot;MyApp&quot;<br />
OutFile &quot;MyApp.exe&quot;<br />
InstallDir &quot;$PROGRAMFILES\MyApp&quot;<br />
ShowInstDetails show<br />
<br />
Page custom &quot;my_own_page&quot; &quot;&quot; &quot;: This is my own page&quot;<br />
Page instfiles &quot;&quot; &quot;inst_show&quot; &quot;&quot;<br />
<br />
Var HWND<br />
<br />
Function .onInit<br />
InitPluginsDir<br />
File /oname=$PLUGINSDIR\io.ini &quot;io.ini&quot;<br />
FunctionEnd<br />
<br />
Function my_own_page<br />
Push $HWND<br />
InstallOptions::dialog &quot;$PLUGINSDIR\io.ini&quot;<br />
Pop $HWND<br />
FunctionEnd<br />
<br />
Function inst_show<br />
ReadINIStr $0 &quot;$PLUGINSDIR\io.ini&quot; &quot;Field 2&quot; &quot;State&quot;<br />
StrCmp $0 1 lnk next<br />
next:<br />
ReadINIStr $1 &quot;$PLUGINSDIR\io.ini&quot; &quot;Field 3&quot; &quot;State&quot;<br />
StrCmp $1 1 runme exit<br />
<br />
lnk:<br />
DetailPrint &quot;I'm creating a  shortcut&quot;<br />
CreateShortCut &quot;$DESKTOP\MyApp.lnk&quot; &quot;$INSTDIR\MyApp.exe&quot;<br />
Goto next<br />
<br />
runme:<br />
DetailPrint &quot;I'm running my self&quot;<br />
Exec &quot;$INSTDIR\MyApp.exe&quot;<br />
Goto exit<br />
<br />
exit:<br />
FunctionEnd<br />
<br />
Section -default<br />
; Set Section properties<br />
	SetOverwrite on<br />
<br />
	; Set Section Files and Shortcuts<br />
	SetOutPath &quot;$INSTDIR\&quot;<br />
	File &quot;C:\Source\MyApp\MyApp.exe&quot;<br />
SectionEnd<br />
<br />
<br />
Only for fun I don't need it any more!<br />
<br />
Best regards!<br />
<br />
Rien</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">28th July 2004, 15:56</div></div><div class="posttext">You'd have to put that code to run MyApp in a Section with no name (Section &quot;&quot;) after all of your sections.<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>