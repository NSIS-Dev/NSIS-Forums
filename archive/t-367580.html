<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS is copying directory and strange files its not asked to, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS is copying directory and strange files its not asked to NSIS Discussion" />
	
	<title> NSIS is copying directory and strange files its not asked to [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS is copying directory and strange files its not asked to</div>
<hr />
<div class="pda"><a href="t-367580.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=367580">NSIS is copying directory and strange files its not asked to</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nawfal</div><div class="date">29th July 2013, 21:30</div></div><div class="posttext">I have strange issue, and I'm not sure if its a bug in the compiler. Please help me with what I'm missing. I have created a simple installer to reproduce it. <br />
<br />
My folder structure looks like this:<br />
<br />
installer script.nsi<br />
bin (folder)       -&gt; main file.txt<br />
                   -&gt; Installer (folder) -&gt; ShellUtil (folder) -&gt; ShellUtil.tlb<br />
ShellUtil (folder) -&gt; ShellUtil.tlb<br />
<br />
It is this script I try to run. What I try to do in the script is: <br />
<br />
1. Copy &quot;main file.txt&quot; in &quot;bin&quot; folder to install directory ($INSTDIR) - works fine<br />
<br />
2. Copy &quot;ShellUtil.tlb&quot; in &quot;ShellUtil&quot; folder to install directory ($INSTDIR) - works fine<br />
<br />
3. Copy whatever is in &quot;ShellUtil&quot; folder to &quot;$INSTDIR\Installer&quot; folder. So in step 3, this should happen after installation (assuming I install to &quot;C:\Program Files\ABC\&quot;)<br />
<br />
C:\Program Files\ABC -&gt; Installer (folder) -&gt; ShellUtil (folder) -&gt; ShellUtil.tlb<br />
<br />
<br />
But what I get is:<br />
<br />
C:\Program Files\ABC -&gt; Installer (folder) -&gt; ShellUtil (folder) -&gt; ShellUtil.tlb #this line is fine<br />
                                           -&gt; bin (folder) -&gt; Installer (folder) -&gt; ShellUtil (folder) -&gt; ShellUtil.tlb<br />
<br />
<br />
That is additionally a &quot;bin&quot; folder is added to &quot;C:\Program Files\ABC\Installer&quot; and certain file goes into it. I do not know what has gone wrong there. I did not ask NSIS to copy folder &quot;Installer&quot; in &quot;bin&quot; folder at the time of compiling.<br />
<br />
This is my code:<br />
<br />
<br />
Section &quot;Install Core Files&quot; Section1<br />
<br />
SectionIn RO <br />
<br />
SetShellVarContext all #important<br />
!insertmacro MUI_HEADER_TEXT &quot;Installation in progress &quot; &quot;Please wait&quot;<br />
<br />
SetOutPath $INSTDIR<br />
File &quot;bin\main file.txt&quot;<br />
<br />
SetOutPath $INSTDIR<br />
File &quot;ShellUtil\ShellUtil.tlb&quot;<br />
<br />
;installer section<br />
SetOutPath &quot;$INSTDIR\Installer&quot;<br />
File /a /r &quot;ShellUtil&quot;<br />
<br />
SectionEnd<br />
<br />
For the complete test case, I have attached a trimmed setup which does exactly this :(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">29th July 2013, 23:44</div></div><div class="posttext">According to the manual it is behaving correctly. You need to use &quot;\*.*&quot; after the ShellUtil in the third file command. File /a /r ShellUtil\*.*<br />
<br />
File /r something<br />
will match the directory named something on the root directory, the file named something in the directory named dir and the directory named something in the directory named another. To match only the directory named something on the root directory, use the following:<br />
<br />
File /r something\*.*</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nawfal</div><div class="date">30th July 2013, 00:38</div></div><div class="posttext">@demiller9, even that wont work because I want whatever is in &quot;ShellUtil&quot; folder to get copied including &quot;ShellUtil&quot; folder. <br />
<br />
So this works:<br />
<br />
SetOutPath &quot;$INSTDIR\Installer\ShellUtil&quot;<br />
<br />
File /a /r &quot;ShellUtil\&quot;<br />
<br />
1. As you see I have to write &quot;ShellUtil&quot; twice. Is there someway I can instruct NSIS to copy &quot;ShellUtil&quot; folder including that folder to some directory?<br />
<br />
2. An additional question: This is what I got from documentation:<br />
<br />
If just one path segment is specified (e.g. File /r something), the current directory will be recursively searched. If more than one segment is specified (e.g. File /r something\*.*), the last path segment will be used as the matching condition and the rest for the directory to search recursively. If a directory name matches, all of its contents is added recursively. Directory structure is preserved.<br />
<br />
In my case, the directory name matches since &quot;ShellUtil&quot; is a folder available in the root directory. Why is it alone not copied recursively?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">30th July 2013, 02:57</div></div><div class="posttext">I'm not sure why you object to putting &quot;ShellUtil&quot; in both the SetOutPath and the File commands, but I found a solution that avoids that.<br />
<br />
First you'll have to change the input directory structure. Create any new directory (I called it CopyThis), and move the ShellUtil folder under that directory. <br />
<br />
Next, the second File command has to change because it was using ShellUtil (this seems like a mistake, as you have a separate ShellUtil.tlb under the bin folder). Change the &quot;File ShellUtil\ShellUtil.tlb&quot; to either File CopyThis\ShellUtil\ShellUtil.tlb or File bin\Installer\ShellUtil\ShellUtil.tlb.<br />
<br />
Last, change the third File command to File /a /r &quot;CopyThis\ShellUtil&quot;<br />
<br />
This works because it doesn't allow the bin folder to be searched, instead the recursive search starts in CopyThis and the ShellUtil folder is a match.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">30th July 2013, 03:05</div></div><div class="posttext">2. An additional question: This is what I got from documentation:<br />
<br />
In my case, the directory name matches since &quot;ShellUtil&quot; is a folder available in the root directory. Why is it alone not copied recursively?<br />
<br />
The current directory is searched recursively, not just the folder that matched. The recursive search goes into bin and matches the ShellUtil inside there, so it duplicates that directory structure. The documentation said this would happen; the piece I quoted mentioned that 'something' would be copied three times because it matched that many times in the directory structure they listed for their example.<br />
File /r something<br />
will match the directory named something on the root directory, the file named something in the directory named dir and the directory named something in the directory named another.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nawfal</div><div class="date">30th July 2013, 07:06</div></div><div class="posttext">@demiller9<br />
<br />
Thanks, that was helpful. It was little annoying to see NSIS behaving this way. &quot;File /r something&quot; copying too many other things from the contained directory?? What would have been obvious would be if it copied just &quot;something&quot; or things within it.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>