<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How 2 set default button on uninstaller ?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How 2 set default button on uninstaller ? NSIS Discussion" />
	
	<title> How 2 set default button on uninstaller ? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How 2 set default button on uninstaller ?</div>
<hr />
<div class="pda"><a href="t-138644.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=138644">How 2 set default button on uninstaller ?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">11th June 2003, 15:48</div></div><div class="posttext">Dear all.<br />
<br />
How can I set the default button of the uninstaller to Cancel ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">11th June 2003, 15:57</div></div><div class="posttext">For info about using custom code in a Modern UI show function, check the Modern UI Readme.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th June 2003, 15:58</div></div><div class="posttext">Use:<br />
<br />
!define IDCANCEL 2<br />
!define DM_SETDEFID 0x401<br />
<br />
GetDlgItem $0 $HWNDPARENT ${IDCANCEL}<br />
SendMessage $HWNDPARENT ${DM_SETDEFID} ${IDCANCEL} 0<br />
System::Call &quot;User32::SetFocus(i) i ($0) .r0&quot;<br />
<br />
in the show function of the uninstall confirmation page. If the borders of the buttons don't come out right you'll have to set the styles of them too using SetWindowLong and GetWindowLong.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">11th June 2003, 16:48</div></div><div class="posttext">10X 4 the quick response,<br />
<br />
I try this:<br />
Function un.onGUIInit<br />
<br />
  !define IDCANCEL 2<br />
  !define DM_SETDEFID 0x401<br />
<br />
  GetDlgItem $0 $HWNDPARENT ${IDCANCEL}<br />
  SendMessage $HWNDPARENT ${DM_SETDEFID} ${IDCANCEL} 0<br />
  System::Call &quot;User32::SetFocus(i) i ($0) .r0&quot;<br />
<br />
FunctionEnd<br />
But I get a strange error: Function named &quot;un.onGUIInit&quot; already exists.<br />
(it does not exist...)<br />
I also try 2 comment the un.onInit and it still dont work<br />
<br />
any idea ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th June 2003, 16:50</div></div><div class="posttext">You're probably using the MUI which uses un.onGUIInit. You should use a MUI define to add un.onGUIInit code. But that won't help you anyway because you need to put this code in the show function of the confirmation page of the uninstaller.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">11th June 2003, 16:57</div></div><div class="posttext">Only now I saw that U R from Holly Land 2 :-)<br />
<br />
what would U suggest me 2 do ?<br />
<br />
Should I change the dialog ? :-(</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th June 2003, 17:07</div></div><div class="posttext">No, you shouldn't change the dialog, that won't work because NSIS sets the default button programmatically. You should put that code in the show function of the confirmation page.<br />
<br />
Yes, I'm from Israel too :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">11th June 2003, 17:37</div></div><div class="posttext">Originally posted by kichik <br />
No, you shouldn't change the dialog, that won't work because NSIS sets the default button programmatically. You should put that code in the show function of the confirmation page.<br />
<br />
Yes, I'm from Israel too :)  <br />
<br />
<br />
I could'nt figure out what is the Show function,<br />
will U tell me some more ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th June 2003, 17:42</div></div><div class="posttext">It's a callback function that is called after the page is created and right before it's shown. Without the MUI it's the third parameter to the Page command (Page type pre_func show_func) and with the MUI you define MUI_UNCUSTOMFUNCTION_CONFIRM_SHOW (for our case. for other cases the define name is different) as your show function name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">11th June 2003, 22:08</div></div><div class="posttext">Hay, Thanks a lot, it works,<br />
<br />
(not perfectly)<br />
<br />
The focus does go to the cancel button,<br />
if you just hit enter it will cancel,<br />
<br />
but for some reason the uninstall button is still marked,<br />
only if I click the cancel button this &quot;mark&quot; goes to cancel button<br />
<br />
do U know how to set it too ?<br />
<br />
(anyway - it's been great help - 10X!)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">12th June 2003, 14:11</div></div><div class="posttext">Well:<br />
<br />
If the borders of the buttons don't come out right you'll have to set the styles of them too using SetWindowLong and GetWindowLong. <br />
<br />
The code for it is (use in the same show function before the other code):<br />
<br />
 !define GWL_STYLE -16<br />
!define BS_DEFPUSHBUTTON 1<br />
 <br />
GetDlgItem $0 $HWNDPARENT 1<br />
System::Call &quot;user32::GetWindowLongA(i $0, i ${GWL_STYLE}) i .s&quot;<br />
Pop $1<br />
IntOp $2 ${BS_DEFPUSHBUTTON} ~<br />
IntOp $1 $1 &amp; $2<br />
System::Call &quot;user32::SetWindowLongA(i $0, i ${GWL_STYLE}, i $1) .s&quot;<br />
Pop $1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">13th June 2003, 00:11</div></div><div class="posttext">Kichik, 10X so much 4 your help,<br />
<br />
I was not able 2 figure out what are the parameters for GetWindowLongA()<br />
<br />
(what is i, what is .s ?)<br />
<br />
<br />
Anyway, my function (below) does get focus on cancel but not &quot;mark&quot; him<br />
if U did not have enough of this matter I love 2 use some more help<br />
<br />
Again, 10X 4 your time.<br />
<br />
<br />
Function un.GuiInit<br />
<br />
  ;http://forums.winamp.com/showthread.php?s=&amp;postid=985362#post985362<br />
<br />
  GetDlgItem $0 $HWNDPARENT ${IDCANCEL}<br />
  SendMessage $HWNDPARENT ${DM_SETDEFID} ${IDCANCEL} 0<br />
  System::Call &quot;User32::SetFocus(i) i ($0) .r0&quot;<br />
<br />
  GetDlgItem $0 $HWNDPARENT 1<br />
  System::Call &quot;user32::GetWindowLongA(i $0, i ${GWL_STYLE}) i .s&quot;<br />
  Pop $1<br />
  IntOp $2 ${BS_DEFPUSHBUTTON} ~<br />
  IntOp $1 $1 &amp; $2<br />
  System::Call &quot;user32::SetWindowLongA(i $0, i ${GWL_STYLE}, i $1) .s&quot;<br />
  Pop $1<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th June 2003, 00:17</div></div><div class="posttext">Is that code in the show callback function or is it in the un.onGUIInit callback? It should be in the show callback function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">13th June 2003, 00:37</div></div><div class="posttext">Originally posted by kichik <br />
Is that code in the show callback function or is it in the un.onGUIInit callback? It should be in the show callback function.  <br />
<br />
Don't U ever sleep :-)<br />
<br />
I put this code on top<br />
  ;Override UnInstall GuiInit function (set focus on Cancel button)<br />
  !define MUI_UNCUSTOMFUNCTION_CONFIRM_SHOW un.GuiInit<br />
<br />
  ;Allow setting the focus on Cancel button<br />
  !define DM_SETDEFID 0x401<br />
  !define IDCANCEL 2<br />
<br />
  ;Allow setting the button style (after got focus)<br />
  !define GWL_STYLE -16<br />
  !define BS_DEFPUSHBUTTON 1<br />
<br />
<br />
(so I guess un.GuiInit is the show function, is it ?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th June 2003, 10:26</div></div><div class="posttext">Sleeping is highly overrated ;)<br />
<br />
The focus code should come after the GetWindowLong code. It works for me that way.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">13th June 2003, 10:41</div></div><div class="posttext">Originally posted by kichik <br />
Sleeping is highly overrated ;)<br />
<br />
The focus code should come after the GetWindowLong code. It works for me that way.  <br />
<br />
Maybe I got some character wrong,<br />
(Cancel does get the focus but not being &quot;marked&quot;)<br />
<br />
This is the exact code I use:  ;Override UnInstall GuiInit function (set focus on Cancel button)<br />
  !define MUI_UNCUSTOMFUNCTION_CONFIRM_SHOW un.GuiInit<br />
<br />
  ;Allow setting the focus on Cancel button<br />
  !define DM_SETDEFID 0x401<br />
  !define IDCANCEL 2<br />
<br />
  ;Allow setting the button style<br />
  !define GWL_STYLE -16<br />
  !define BS_DEFPUSHBUTTON 1<br />
<br />
<br />
Function un.GuiInit<br />
<br />
  ;http://forums.winamp.com/showthread.php?s=&amp;postid=985362#post985362<br />
<br />
  GetDlgItem $0 $HWNDPARENT 1<br />
  System::Call &quot;user32::GetWindowLongA(i $0, i ${GWL_STYLE}) i .s&quot;<br />
  Pop $1<br />
  IntOp $2 ${BS_DEFPUSHBUTTON} ~<br />
  IntOp $1 $1 &amp; $2<br />
  System::Call &quot;user32::SetWindowLongA(i $0, i ${GWL_STYLE}, i $1) .s&quot;<br />
  Pop $1<br />
<br />
  GetDlgItem $0 $HWNDPARENT ${IDCANCEL}<br />
  SendMessage $HWNDPARENT ${DM_SETDEFID} ${IDCANCEL} 0<br />
  System::Call &quot;User32::SetFocus(i) i ($0) .r0&quot;<br />
<br />
FunctionEnd<br />
<br />
<br />
<br />
it would be great if U could paste the code U use for that<br />
(Set style + Focus)<br />
<br />
10X</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th June 2003, 10:53</div></div><div class="posttext">Ah, using XPStyle on shows it... =/<br />
Looking at the code again, you can't set the focus on the right button. NSIS sets it after the show function and the leave function is already too late :(<br />
<br />
I'm sorry for the confusion.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yovav</div><div class="date">13th June 2003, 12:17</div></div><div class="posttext">Originally posted by kichik <br />
Ah, using XPStyle on shows it... =/<br />
Looking at the code again, you can't set the focus on the right button. NSIS sets it after the show function and the leave function is already too late :(<br />
<br />
I'm sorry for the confusion.  <br />
<br />
<br />
Nevermind,<br />
I did accomplish my main goal - set focus on Cancel,<br />
<br />
so 10X 4 all the great tips.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>