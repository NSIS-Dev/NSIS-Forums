<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Silent Install Question..., media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Silent Install Question... NSIS Discussion" />
	
	<title> Silent Install Question... [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Silent Install Question...</div>
<hr />
<div class="pda"><a href="t-211030.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=211030">Silent Install Question...</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">21st March 2005, 17:18</div></div><div class="posttext">Hello all.<br />
<br />
I am in the process of adding Silent Install support to my installer.  I added some functions to allow me to pass the parameter: /COMPS= to my installer.  I have 3 sections (for each component), so /COMPS=1 would just install the first section where as /COMPS=12 would do the first two.  This works just fine.  However if I leave out the /COMPS= parameter or don't set a value for it, the installer runs through, but skips all the sections, which is also fine.  <br />
<br />
Here is my question: I have the below code in place, but when running the installer in Silent mode, with no components selected (/COMPS=), the message box below does not pop up.  I would expect that I would have to deal with this message box with either the IfSilent or /SD commands.  I even tried putting a dummy messagebox at the start of the ComponentsLeave function, but it does not come up either.  Is this function omitted during a silent install?  <br />
<br />
Thanks.<br />
<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE &quot;ComponentsLeave&quot;<br />
!insertmacro MUI_PAGE_COMPONENTS<br />
<br />
Function ComponentsLeave<br />
    SectionGetFlags &quot;${SEC01}&quot; $0<br />
    StrCmp $0 1 End<br />
    SectionGetFlags &quot;${SEC02}&quot; $0<br />
    StrCmp $0 1 End<br />
    SectionGetFlags &quot;${SEC03}&quot; $0<br />
    StrCmp $0 1 End<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;You must select at least one component.&quot;<br />
    Abort<br />
    End:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">21st March 2005, 17:27</div></div><div class="posttext">I noticed this behavior in my DirectoryLeave function too.  I'm thinking since these functions are designed to stop the user, and prompt them to make a correction, they must cause a full abort during a silent install since there is no one there to make the correction, and you would have an infinite loop if a full abort as not called.  Am I correct?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st March 2005, 17:44</div></div><div class="posttext">Are you unchecking all sections then if /COMPS == &quot;&quot; or if /COMPS is ommited? Because sections are always checked as default...<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">21st March 2005, 17:49</div></div><div class="posttext">Afrow UK, thanks for the reply.  My sections are set to /O, so by default they are all unchecked.<br />
<br />
Then after i get the value for the /COMPS parameter, i run this function:<br />
<br />
Function SectionSet<br />
  StrCmp $2 1 0 +3<br />
      SectionSetFlags &quot;${SEC01}&quot; 1<br />
      Goto End<br />
    StrCmp $2 2 0 +3<br />
      SectionSetFlags &quot;${SEC02}&quot; 1<br />
      Goto End<br />
    StrCmp $2 3 0 +3<br />
      SectionSetFlags &quot;${SEC03}&quot; 1<br />
      Goto End<br />
    StrCmp $2 12 0 +4<br />
      SectionSetFlags &quot;${SEC01}&quot; 1<br />
      SectionSetFlags &quot;${SEC02}&quot; 1<br />
      Goto End<br />
    StrCmp $2 13 0 +4<br />
      SectionSetFlags &quot;${SEC01}&quot; 1<br />
      SectionSetFlags &quot;${SEC03}&quot; 1<br />
      Goto End<br />
    StrCmp $2 23 0 +4<br />
      SectionSetFlags &quot;${SEC02}&quot; 1<br />
      SectionSetFlags &quot;${SEC03}&quot; 1<br />
      Goto End<br />
    StrCmp $2 123 0 +4<br />
      SectionSetFlags &quot;${SEC01}&quot; 1<br />
      SectionSetFlags &quot;${SEC02}&quot; 1<br />
      SectionSetFlags &quot;${SEC03}&quot; 1<br />
  End:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st March 2005, 18:03</div></div><div class="posttext">That's not a very effecient way of doing it, say if they use /COMPS=321...<br />
<br />
Loop:<br />
StrCpy $1 $2 1 -1 #get a num<br />
StrCpy $2 $2 -1   #remove it<br />
StrCmp $1 &quot;&quot; Done<br />
 StrCmp $1 1 0 +2<br />
  SectionSetFlags &quot;${SEC01}&quot; 1<br />
 StrCmp $1 2 0 +2<br />
  SectionSetFlags &quot;${SEC02}&quot; 1<br />
 StrCmp $1 3 0 +2<br />
  SectionSetFlags &quot;${SEC03}&quot; 1<br />
Goto Loop<br />
Done:<br />
<br />
<br />
Perhaps with NSIS set to silent, all sections are forced to be selected...<br />
Try unchecking them all again before using the above code.<br />
 SectionSetFlags &quot;${SEC01}&quot; 0<br />
 SectionSetFlags &quot;${SEC02}&quot; 0<br />
 SectionSetFlags &quot;${SEC03}&quot; 0<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">21st March 2005, 18:24</div></div><div class="posttext">Well what i'm finding is that if i run my installer from the command line: Installer.exe /S /COMPS=<br />
<br />
The log says:<br />
Skipping section: &quot;1&quot;<br />
Skipping section: &quot;2&quot;<br />
Skipping section: &quot;3&quot;<br />
<br />
Which is what i would expect with /COMPS=.  But why does the Message box below not pop up?<br />
<br />
Function ComponentsLeave<br />
    SectionGetFlags &quot;${SEC01}&quot; $0<br />
    StrCmp $0 1 End<br />
    SectionGetFlags &quot;${SEC02}&quot; $0<br />
    StrCmp $0 1 End<br />
    SectionGetFlags &quot;${SEC03}&quot; $0<br />
    StrCmp $0 1 End<br />
    MessageBox MB_OK|MB_ICONINFORMATION &quot;You must select at least one component.&quot;<br />
    Abort<br />
    End:<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">21st March 2005, 18:46</div></div><div class="posttext">Oh wait, of course. No page functions are executed on a silent install!<br />
Just put that code into a seperate function, ie Function checkSections, and call that function from both ComponentsLeave and .onInit<br />
Call it in .onInit with IfSilent.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">21st March 2005, 19:11</div></div><div class="posttext">Originally posted by Afrow UK <br />
Oh wait, of course. No page functions are executed on a silent install!-Stu  <br />
<br />
That makes sense, but i'm finding that my DirectoryLeave function below is called when silent...guess I will just have to play with it i bit more.<br />
<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE &quot;DirectoryLeave&quot;<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
<br />
Thanks for you help.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">22nd March 2005, 18:18</div></div><div class="posttext">That's impossible, or at least, shouldn't happen. The only place the leave function is called is inside the main dialog's message handler. The dialog isn't even created on silent installation. If it's reproducible, attach a minimal script reproducing this behavior.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jnuw</div><div class="date">22nd March 2005, 22:21</div></div><div class="posttext">Originally posted by kichik <br />
That's impossible, or at least, shouldn't happen. The only place the leave function is called is inside the main dialog's message handler. The dialog isn't even created on silent installation. If it's reproducible, attach a minimal script reproducing this behavior. <br />
You are correct, I must have been losing it yesterday.  Neither of those leave functions are called when installer is silent. Thanks for your time.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>