<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Building NSIS on Linux, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Building NSIS on Linux NSIS Discussion" />
	
	<title> Building NSIS on Linux [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Building NSIS on Linux</div>
<hr />
<div class="pda"><a href="t-239751.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=239751">Building NSIS on Linux</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Surfboy</div><div class="date">3rd March 2006, 01:26</div></div><div class="posttext">Hi Guys,<br />
<br />
I was immensely pleased to see that I could, in theory,<br />
build NSIS installers under a Linux/POSIX gnu build infrastructure with a mingw cross-compiler... If only...<br />
<br />
I'd appreciate any help:<br />
<br />
SCons v0.96.91.D001 <br />
i386-mingw32msvc-gcc (GCC) 3.4.1 (mingw special)<br />
i386-mingw32msvc-g++ (GCC) 3.4.1 (mingw special)<br />
etc<br />
<br />
So I simply:<br />
<br />
'scons' and fairly immediately a problem:<br />
<br />
i386-mingw32msvc-g++ -s -mwindows -Wl,--file-alignment,512 -Wl,-Map,build/release/BgImage/BgImage.map -Wl,-e_DllMain@12 -nostdlib -Wl,--exclude-libs,msvcrt.a -shared -o build/release/BgImage/BgImage.dll build/release/BgImage/BgImage.o SCons/Config/memcpy.c SCons/Config/memset.c -lkernel32 -luser32 -lgdi32 -lwinmm -Wl,--out-implib,build/release/BgImage/BgImage.lib -Wl,--output-def,build/release/BgImage/BgImage.def<br />
Creating library file: build/release/BgImage/BgImage.lib<br />
build/release/BgImage/BgImage.o(.eh_frame+0x11):BgImage.cpp: undefined reference to `___gxx_personality_v0'<br />
collect2: ld returned 1 exit status<br />
scons: *** [build/release/BgImage/BgImage.dll] Error 1<br />
scons: building terminated because of errors.<br />
<br />
So I see '-nostdlib' (and without really knowing what I'm doing, but knowing it's a symbol that the standard library provides), I remove this switch from SCons/Config/gnu:<br />
<br />
defenv['NODEFLIBS_FLAG'] = '-Wl,--exclude-libs,msvcrt.a'<br />
<br />
Progress... Lots of progress...<br />
<br />
i386-mingw32msvc-gcc -o build/release/System/Source/System.o -c -Os -Wall -DSYSTEM_EXPORTS Contrib/System/Source/System.c<br />
In file included from Contrib/System/Source/System.c:4:<br />
Contrib/System/Source/stdafx.h:13:27: warning: no newline at end of file<br />
Contrib/System/Source/System.c:8:20: crtdbg.h: No such file or directory<br />
Contrib/System/Source/System.c: In function `PrepareProc':<br />
Contrib/System/Source/System.c:372: warning: cast to pointer from integer of different size<br />
Contrib/System/Source/System.c:636: warning: cast to pointer from integer of different size<br />
Contrib/System/Source/System.c:665: warning: cast to pointer from integer of different size<br />
Contrib/System/Source/System.c:688: warning: cast to pointer from integer of different size<br />
Contrib/System/Source/System.c: In function `ParamsIn':<br />
Contrib/System/Source/System.c:770: warning: cast to pointer from integer of different size<br />
Contrib/System/Source/System.c: At top level:<br />
Contrib/System/Source/System.c:872: warning: `naked' attribute directive ignored<br />
Contrib/System/Source/System.c: In function `CallProc':<br />
Contrib/System/Source/System.c:876: error: `_asm' undeclared (first use in this function)<br />
Contrib/System/Source/System.c:876: error: (Each undeclared identifier is reported only once<br />
Contrib/System/Source/System.c:876: error: for each function it appears in.)<br />
<br />
and now lots of asm related warnings, proc undeclared, syntaxt error before push, unexpected tokens, errors before tokens, you get the idea...<br />
<br />
scons: *** [build/release/System/Source/System.o] Error 1<br />
scons: building terminated because of errors.<br />
<br />
Now I'm pretty much stuck. Can anyone shed some light on how I can correctly perform the cross-compile? Do I have a screwed up or partial cross-compile environment (we use it for a seperate C project cross-compile no problems)?<br />
<br />
Any help, greatly, greatly appreciated!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd March 2006, 09:23</div></div><div class="posttext">System can't be built with MinGW because its source code contains assembly code in MSVC syntax. You should use:scons SKIPPLUGINS=SystemI'll add a note about it to the documentation, as it seems it won't be solved (http://forums.winamp.com/showthread.php?s=&amp;threadid=227304) soon.<br />
<br />
Please submit a bug report about ___gxx_personality_v0 and I'll take a look it later, hopefully this week.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Surfboy</div><div class="date">3rd March 2006, 09:45</div></div><div class="posttext">Thanks for the response!<br />
<br />
I'll post the bug report.<br />
<br />
So I only needed System to make a call to allow only a single instance of the installer.<br />
<br />
Function .onInit<br />
 ; Only allow a single instance of the installer<br />
 System::Call 'kernel32::CreateMutexA(...)<br />
<br />
What's the best way round this? If I really need System, should I:<br />
<br />
a) cross-compile entire system but grab System from nightly build and slot that in?<br />
<br />
b) Forget cross-compilation, compile makensis and drop that into the nightly build?<br />
<br />
c) Use WINE<br />
<br />
Many thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd March 2006, 09:54</div></div><div class="posttext">The best option is to forget cross-compilation, compile only makensis from source release (http://prdownloads.sourceforge.net/nsis/nsis-2.14-src.tar.bz2?download) and drop it in the zip release (http://prdownloads.sourceforge.net/nsis/nsis-2.14.zip?download). Release binaries are compiled with MSVC6 which produces smaller results than both MinGW and MSVC Toolkit which is used for the nightly build.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>