<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Can somebody explain me how I can use upx, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Can somebody explain me how I can use upx NSIS Discussion" />
	
	<title> Can somebody explain me how I can use upx [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Can somebody explain me how I can use upx</div>
<hr />
<div class="pda"><a href="t-253529.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=253529">Can somebody explain me how I can use upx</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">UVV</div><div class="date">18th August 2006, 13:05</div></div><div class="posttext">Now I have bat file with next context:<br />
<br />
del Weight.exe<br />
upx --best --crp-ms=999999 --nrv2d -o Weight.exe WareHouse.exe<br />
pause<br />
<br />
I've read the manual, but I don't understand.<br />
Can you explain me, what I have to write instead &quot;$%TEMP%\exehead.tmp&quot; that this commands will be identical?<br />
<br />
!packhdr &quot;$%TEMP%\exehead.tmp&quot; '&quot;C:\Program Files\UPX\upx.exe&quot; &quot;$%TEMP%\exehead.tmp&quot;'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mihasic</div><div class="date">18th August 2006, 13:36</div></div><div class="posttext">Manual says:<br />
[skip]<br />
Specify a temporary file name (such as &quot;temp.dat&quot;) and a command line (such as &quot;C:\program files\upx\upx -9 temp.dat&quot;) to compress the header.<br />
<br />
Russian:<br />
Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¸Ð¼Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð° (Ñ‚Ð°ÐºÐ¾Ðµ ÐºÐ°Ðº &quot;temp.dat&quot;) Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, &quot;C:\program files\upx\upx -9 temp.dat&quot;)<br />
<br />
The temporary name could be any file name (maybe there are some restrictions), you can use the same name as in example (i.e. &quot;temp.dat&quot;).<br />
(Ð˜Ð¼Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð° Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð»ÑŽÐ±Ñ‹Ð¼ (Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ ÐµÑÑ‚ÑŒ ÐºÐ°ÐºÐ¸Ðµ-Ñ‚Ð¾ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ), Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð°ÐºÐ¾Ðµ Ð¶Ðµ Ð¸Ð¼Ñ ÐºÐ°Ðº Ð¸ Ð² Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ (&quot;temp.dat&quot;))</div></div><hr />


<div class="post"><div class="posttop"><div class="username">UVV</div><div class="date">18th August 2006, 13:43</div></div><div class="posttext">I understand this, but where should I write the executable name?<br />
Am I wrong that upx only pack the executables?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mihasic</div><div class="date">18th August 2006, 13:54</div></div><div class="posttext">You should not write executable name (except for OutFile attribute).<br />
As I wrote, you should write name for temporary file, wich will be compressed. And then (in the second parameter) that name is used at command line.<br />
UPX compresses files in several executable formats. Extensions of this files are only used by OS, UPX determines file format by it's header.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">UVV</div><div class="date">18th August 2006, 14:01</div></div><div class="posttext">But when I pack the executable with first script (before compiling nsi-script) installer size is smaller in 15-20%. Why?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mihasic</div><div class="date">18th August 2006, 19:55</div></div><div class="posttext">I suppose it's because UPX packs whole executable, not only header (as it described in manual).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">UVV</div><div class="date">19th August 2006, 17:20</div></div><div class="posttext">This code is more efficient for me<br />
<br />
!define UPXParams '&quot;upx --best --crp-ms=999999 --nrv2d -o ${OutputEXEName} ${InputEXEName}&quot;'<br />
!system ${UPXParams}<br />
<br />
installer size 1.57 MB<br />
then this<br />
<br />
!packhdr &quot;$%TEMP%\exehead.tmp&quot; '&quot;upx --best --crp-ms=999999 --nrv2d&quot; &quot;$%TEMP%\exehead.tmp&quot;'<br />
<br />
installer size 1.89 MB</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th August 2006, 17:38</div></div><div class="posttext">What exactly are you trying to compress? The first piece of code doesn't compress the installer itself. You can't compress the installer before it's created. Even more, you can't use UPX to compress the complete installer because it'll fail the CRC check. The data after the header/stub is compressed anyway.<br />
<br />
What's this ${InputEXEName}? Is it the executable you're distributing? If that's the case, the second piece of code won't change it because it compresses the installer header and not the files the installer extracts.<br />
<br />
If you want to compress the distributed executable, the first piece of code is the way to go. However, know that your installer might be bigger because compressing compressed data doesn't usually give the best results.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">UVV</div><div class="date">19th August 2006, 17:47</div></div><div class="posttext">Originally posted by kichik <br />
<br />
What's this ${InputEXEName}? Is it the executable you're distributing? If that's the case, the second piece of code won't change it because it compresses the installer header and not the files the installer extracts.<br />
 <br />
Yes, this is that I wanted to know.<br />
By the way, if I choose another compressor the first part of code executed every time. How could I change this? Only via version compare?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th August 2006, 17:58</div></div><div class="posttext">The first piece of code will be executed every time, no matter which compressor you use. !system is only conditioned by !if[def]. !system is executed when you build the installer.<br />
<br />
What exactly are you trying to do? What versions do you wish to compare? Do you want to compress the executable only if it's of a certain version? Why not compress it every time?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">UVV</div><div class="date">19th August 2006, 19:40</div></div><div class="posttext">Originally posted by kichik <br />
Why not compress it every time? [/B]<br />
Is there any reason to do it?<br />
e.g. I set &quot;Best Compressor&quot; and every time when installer compressing more and more he will be pack with !system every time!<br />
I think this solution is will be good for me...:<br />
<br />
section PackExecutable<br />
<br />
${GetFileVersion} ${OutputEXEName} $0<br />
${GetFileVersion} ${InputExeName} $1<br />
<br />
${VersionCompare} $0 $1 $2<br />
<br />
${If} $2 == 2<br />
  !delfile ${OutputEXEName}<br />
  !system ${UPXParams}<br />
${EndIf}<br />
<br />
SectionEnd<br />
<br />
... if !delfile don't give compilation error when file isn't exists!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">19th August 2006, 19:49</div></div><div class="posttext">That won't work because GetFileVersion and VersionCompare are run time instructions. Variables such as $2 are also usable only at run time.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">UVV</div><div class="date">19th August 2006, 20:01</div></div><div class="posttext">Originally posted by Afrow UK <br />
That won't work because GetFileVersion and VersionCompare are run time instructions. Variables such as $2 are also usable only at run time.<br />
<br />
-Stu <br />
So, what you advice?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comperio</div><div class="date">19th August 2006, 23:09</div></div><div class="posttext">Going back to what Kichik already pointed out:<br />
<br />
From Kichik:<br />
<br />
You can't compress the installer before it's created. Even more, you can't use UPX to compress the complete installer because it'll fail the CRC check. The data after the header/stub is compressed anyway.<br />
<br />
In other words, UPX can only compress the exe header not the full EXE when used from within your script.  And, if you try to compress the full EXE after it's created, then you'll run into CRC errors when you try to run it.<br />
<br />
In my opinion, the savings you'd gain with UPX (or any other EXE compressor) would be minimal at best, which makes me wonder why you'd even want to bother.  (Consider this: A barebones do nothing script compiled with NSIS compiles to about 34K.  34K is tiny!)<br />
<br />
So my advice would be that if you want to compress the full EXE, then just specify the compression method as solid lzma in your script. (command: SetCompressor /SOLID lzma)  You won't get much better compression than that.  (If you do, it will be very minimal at best.)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>