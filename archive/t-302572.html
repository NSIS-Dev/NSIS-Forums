<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Confused about calling wininet, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Confused about calling wininet NSIS Discussion" />
	
	<title> Confused about calling wininet [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Confused about calling wininet</div>
<hr />
<div class="pda"><a href="t-302572.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=302572">Confused about calling wininet</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ghillerson</div><div class="date">30th January 2009, 00:45</div></div><div class="posttext">I'm trying to call perl scripts on a server using wininet. I can run this code from <br />
<br />
The function below runs from inside VBA; what I'd like to do is craft an NSIS version of it. I know I can call System::wininet, but i'm new to NSIS and struggling to understand how to pass parameters and get results for specific inet functions. Specifically, how to emulate the calls to InternetOpen and InternetOpenUrl below. Any pointers appreciated<br />
<br />
-----<br />
Function GetServerScriptResponse(sUrl As String) As String<br />
    Dim s As String<br />
    Dim hOpen As Long<br />
    Dim hOpenUrl As Long<br />
    Dim bDoLoop As Boolean<br />
    Dim bRet As Boolean<br />
    Dim sReadBuffer As String * 2048<br />
    Dim lNumberOfBytesRead As Long<br />
    <br />
    hOpen = InternetOpen(scUserAgent, INTERNET_OPEN_TYPE_PRECONFIG, vbNullString, vbNullString, 0)<br />
    hOpenUrl = InternetOpenUrl(hOpen, sUrl, vbNullString, 0, INTERNET_FLAG_RELOAD, 0)<br />
    <br />
    bDoLoop = True<br />
    While bDoLoop<br />
        sReadBuffer = vbNullString<br />
        bRet = InternetReadFile(hOpenUrl, sReadBuffer, Len(sReadBuffer), lNumberOfBytesRead)<br />
        s = s &amp; Left$(sReadBuffer, lNumberOfBytesRead)<br />
        If Not CBool(lNumberOfBytesRead) Then bDoLoop = False<br />
    Wend<br />
    <br />
    If hOpenUrl &lt;&gt; 0 Then InternetCloseHandle (hOpenUrl)<br />
    If hOpen &lt;&gt; 0 Then InternetCloseHandle (hOpen)<br />
    GetServerScriptResponse = s<br />
End Function<br />
-----<br />
<br />
Here are the declarations it uses:<br />
Private Const INTERNET_OPEN_TYPE_PRECONFIG = 0<br />
Private Const INTERNET_OPEN_TYPE_DIRECT = 1<br />
Private Const INTERNET_OPEN_TYPE_PROXY = 3<br />
<br />
Private Const scUserAgent = &quot;VB OpenUrl&quot;<br />
Private Const INTERNET_FLAG_RELOAD = &amp;H80000000<br />
<br />
Public Declare Function InternetOpen Lib &quot;wininet.dll&quot; Alias &quot;InternetOpenA&quot; _<br />
(ByVal sAgent As String, ByVal lAccessType As Long, ByVal sProxyName As String, _<br />
 ByVal sProxyBypass As String, ByVal lFlags As Long) As Long<br />
<br />
Public Declare Function InternetOpenUrl Lib &quot;wininet.dll&quot; Alias &quot;InternetOpenUrlA&quot; _<br />
(ByVal hOpen As Long, ByVal sUrl As String, ByVal sHeaders As String, _<br />
 ByVal lLength As Long, ByVal lFlags As Long, ByVal lContext As Long) As Long<br />
<br />
Public Declare Function InternetReadFile Lib &quot;wininet.dll&quot; _<br />
(ByVal hFile As Long, ByVal sBuffer As String, ByVal lNumBytesToRead As Long, _<br />
 lNumberOfBytesRead As Long) As Integer<br />
<br />
Public Declare Function InternetCloseHandle Lib &quot;wininet.dll&quot; _<br />
(ByVal hInet As Long) As Integer</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">30th January 2009, 07:13</div></div><div class="posttext">You can also use 100% wininet.dll based http://nsis.sourceforge.net/Inetc_plug-in plug-in. Just put inetc.dll to your C:\Program Files\NSIS\plugins folder and compile sample for the beginning.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ghillerson</div><div class="date">30th January 2009, 18:05</div></div><div class="posttext">I saw inet::get and inet::put but it looked to me like those were for posting to a form and getting back from a form (and i'm a bit ignorant about these things). From your response, i'm guessing that i can call my perl script with get for functionality equivalent to calling InternetOpen and then reading the results.<br />
<br />
I'll give it a try tonite.  Thanks<br />
<br />
G</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">30th January 2009, 18:13</div></div><div class="posttext">You should call it from NSIS installation script (like this is done in inetc examples), not from perl. Plug-in puts server reply to local file (last parameter), but you can use text handling macros to handle this file directly from NSIS script as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ghillerson</div><div class="date">31st January 2009, 03:15</div></div><div class="posttext">Thanks so much! I called a script and got back the expected response, which puts me well on my way to implementing my registration handler in my first NSIS script.  Way easier than i thought it would be, and thanks again for your help.<br />
<br />
- G</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>