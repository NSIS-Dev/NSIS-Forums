<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Read variable from Batch File after ExecWait, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Read variable from Batch File after ExecWait NSIS Discussion" />
	
	<title> Read variable from Batch File after ExecWait [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Read variable from Batch File after ExecWait</div>
<hr />
<div class="pda"><a href="t-270524.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270524">Read variable from Batch File after ExecWait</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ogreinside</div><div class="date">2nd May 2007, 22:04</div></div><div class="posttext">Hello,<br />
<br />
I am having difficulty in determining a software version that is a dependency for a package I am building an installer for.  Everything else works right now.  Once I can grab the existing version, I plan on using VersionCompare (http://nsis.sourceforge.net/VersionCompare) once I can determine the existing version.<br />
<br />
The main problem is that the company does not provide a Value for the version in the registry, only a Key.  Even then, the key has no Values, and is only called the Major.Minor version, not including the Subverion that I need to test for.<br />
<br />
The software is EMC's Navisphere CLI.  Here is a batch file I am using to grab the version:<br />
<br />
Called from NSIS as:<br />
<br />
ExecWait 'getNaviVer.cmd &quot;$navipath&quot;'<br />
<br />
getNaviVer.cmd<br />
--<br />
<br />
cd %1<br />
for /f &quot;tokens=4&quot; %%i in ('navicli.exe -help ^| findstr &quot;Revision&quot;') do set NaviCLIVersion=%%i<br />
echo Navi Version is [%NaviCLIVersion%]<br />
 <br />
--<br />
<br />
This works, and is the only way I have found to obtain the full version.  However, I have not been able to read the variable set by the batch file for use by NSIS.  This makes sense since this is a child process setting a variable, which would not stick to the parent.  <br />
<br />
I tried: &quot;ReadEnvStr $naviver NaviCLIVersion&quot; with no luck<br />
<br />
Before I went down the path of looking at xset or some other hack, I wanted to check myself and see if there is an easier way to do this, since I'd prefer not to modify their environment anyway.<br />
<br />
Thanks for any assistance.<br />
<br />
Vinny</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">2nd May 2007, 22:18</div></div><div class="posttext">Isn't possible to write %NaviCLIVersion% e.g. in registry and have nsis read it from there?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ogreinside</div><div class="date">2nd May 2007, 22:20</div></div><div class="posttext">What a great, and simple work around :)<br />
<br />
I would prefer not to write anything to their system, but this would definitely work.  In fact, I may write it to the existing Key as a Value, since they don't do it for you ...<br />
<br />
Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">3rd May 2007, 18:51</div></div><div class="posttext">You can execute navicli.exe with nsExec::ExecToLog and parse the output with WordFind (http://nsis.sourceforge.net/Docs/AppendixE.html#E.3.2) and friends.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ogreinside</div><div class="date">7th May 2007, 17:58</div></div><div class="posttext">Thanks for this suggestion, I figured out to use nsExec the hard way, but I like what you suggest about parsing a log.  I may switch to doing that, but for now I am keeping it under a key in my own software entry.  For anyone interested, here is what I ended up doing:<br />
<br />
--setNaviVer.cmd--<br />
  if [%1]==[] (<br />
    cd &quot;c:\program files\emc\navisphere cli&quot;<br />
  ) else (<br />
    cd %1<br />
  )<br />
  for /f &quot;tokens=4&quot; %%i in ('navicli.exe -help ^| findstr &quot;Revision&quot;') do set NaviCLIVersion=%%i<br />
  if defined NaviCLIVersion reg add &quot;HKLM\SOFTWARE\My Company\My Product&quot; /v NaviCLI_Version /d %NaviCLIVersion% /f<br />
--setNaviVer.cmd--<br />
<br />
--inside nsis script--<br />
  nsExec::Exec 'setNaviVer.cmd &quot;$navipath&quot;'<br />
  ReadRegStr $naviVer HKLM &quot;SOFTWARE\My Company\My Product&quot; &quot;NaviCLI_Version&quot;<br />
--inside nsis script--</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Dan9999</div><div class="date">7th May 2007, 18:38</div></div><div class="posttext">The reason that your previous way didn't work is because when execwait runs your batch file, any changes to environment variables are not propagated to the parent (the nsis installer) and this is true for all programming languages.  <br />
<br />
My favorite way out of this is to write batch files that only output the value (nothing else) and use <br />
<br />
var /GLOBAL myvalueinhere<br />
nsExec::ExecToStack 'cmd /c mybatch.cmd'<br />
pop $myvalueinhere<br />
<br />
and in the batch file make sure that no errors can happen so for example if reg.exe has a problem<br />
<br />
re.exe query etc.etc.etc...   2&gt;nul<br />
<br />
just in case errors get into the output because I think ExecToStack retrieves both stdout and stderr.<br />
<br />
Your way works too :-)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>