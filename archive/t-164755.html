<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Memory hole?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Memory hole? NSIS Discussion" />
	
	<title> Memory hole? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Memory hole?</div>
<hr />
<div class="pda"><a href="t-164755.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=164755">Memory hole?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">14th January 2004, 01:03</div></div><div class="posttext">I'm not sure why but this example below will use upwards towards 90MB of memory within 20 mins.  In my test I pointed the download file to something small, around 20K in size.<br />
I've tested this bug(?) with various builds, including the latest CVS release.<br />
<br />
<br />
-------------------------<br />
Name &quot;memoryhole&quot;<br />
OutFile &quot;memoryhole.exe&quot;<br />
Caption &quot;memoryhole&quot;<br />
SilentInstall silent<br />
<br />
Section &quot;&quot;<br />
<br />
foo:<br />
NSISdl::download http://www.noname.com/poo.jpg $EXEDIR\outfile.exe<br />
sleep 25<br />
goto foo<br />
<br />
SectionEnd<br />
-------------------------</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">14th January 2004, 01:22</div></div><div class="posttext">Unless its leaking memory, I don't see a bug since its an infinite loop.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">14th January 2004, 02:08</div></div><div class="posttext">Originally posted by rainwater <br />
Unless its leaking memory, I don't see a bug since its an infinite loop.  <br />
<br />
It uses more and more memory with each loop.  That is a memory leak, is it not?!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">14th January 2004, 20:19</div></div><div class="posttext">No, is not. Like rainwater said, you only have an endless loop, but it'll grab memory.<br />
Leak is when you don't empty the space in the memory. In this case you just loading up.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">15th January 2004, 00:41</div></div><div class="posttext">so why is it gobbling up memory and how can it be freed?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">15th January 2004, 01:10</div></div><div class="posttext">mmm, because there's no exit for the loop.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">15th January 2004, 05:29</div></div><div class="posttext">what you say makes no sense.  I don't see why having &quot;no exit for the loop&quot; is a reason for this example to gobble 90MB+ in less than 20 mins.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">15th January 2004, 12:32</div></div><div class="posttext">that's how IE works, and i think not NSIS is to blame for this ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">15th January 2004, 12:43</div></div><div class="posttext">NSISdl does not use IE.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">15th January 2004, 20:47</div></div><div class="posttext">Originally posted by spanky <br />
what you say makes no sense.  I don't see why having &quot;no exit for the loop&quot; is a reason for this example to gobble 90MB+ in less than 20 mins.  <br />
It's memory &quot;usage&quot;, no leaking, of the Win32 APIs. Since there's no stop in the loop, the OS (Windows) works endless.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">15th January 2004, 23:34</div></div><div class="posttext">ah, so the usage is keeping track of where it is in the loop?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">16th January 2004, 16:04</div></div><div class="posttext">Yes :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th January 2004, 17:44</div></div><div class="posttext">No, that's not supposed to happen. No API call should increase memory usage when used in a loop assuming its freeing function is also called in the loop.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">spanky</div><div class="date">17th January 2004, 01:19</div></div><div class="posttext">Originally posted by kichik <br />
No, that's not supposed to happen. No API call should increase memory usage when used in a loop assuming its freeing function is also called in the loop.  <br />
<br />
so would this mean there is a bug in NSIS?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">17th January 2004, 04:58</div></div><div class="posttext">It's not a NSIS bug. It's the computer working out with an endless loop.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th January 2004, 11:40</div></div><div class="posttext">It is a bug in the NSISdl plug-in.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">17th January 2004, 17:42</div></div><div class="posttext">Lobo, try:<br />
<br />
loop:<br />
sleep 1<br />
goto loop</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joel</div><div class="date">17th January 2004, 19:15</div></div><div class="posttext">Name &quot;memoryleak&quot;<br />
OutFile &quot;memoryleak.exe&quot;<br />
Caption &quot;memoryleak&quot;<br />
SilentInstall silent<br />
<br />
Section &quot;&quot;<br />
Loop:<br />
sleep 1<br />
goto Loop<br />
SectionEnd<br />
<br />
The memory usage of the EXE still 2,188 KB. No overflow of the memory...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">17th January 2004, 22:35</div></div><div class="posttext">Indeed. So there is something wrong with NSISdl.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Koen van de Sande</div><div class="date">18th January 2004, 12:39</div></div><div class="posttext">I stand corrected then. I thought an infinite loop would start eating up the stack, but I guess it doesn't.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st February 2004, 18:56</div></div><div class="posttext">The main leak is in your code. You forgot to Pop the returned value. This leaks 1KB each iteration of the loop. Other than that, there were some problems with NSISdl. Hopefully they were all fixed in the latest CVS version. See the change log (http://nsis.sf.net/changelog.php) for more details.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>