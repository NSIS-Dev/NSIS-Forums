<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" A small redraw issue of MakensisW's SettingsDialog, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  A small redraw issue of MakensisW's SettingsDialog NSIS Discussion" />
	
	<title> A small redraw issue of MakensisW's SettingsDialog [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  A small redraw issue of MakensisW's SettingsDialog</div>
<hr />
<div class="pda"><a href="t-270901.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=270901">A small redraw issue of MakensisW's SettingsDialog</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">9th May 2007, 14:30</div></div><div class="posttext">I want to feed back a small bug in MakensisW. (Maybe it's not MakensisW's fault.)<br />
<br />
When you:<br />
1. run a new instance of Makensisw.exe ...<br />
2. Open the [settings] dialog of the makensisW...<br />
3. (Without any other window-views switching.)Move the [settings] dialog to a right-top position, but here, donnot let the entire dialog region move away from the  display area of it's parent window(the MakensisW main window).<br />
<br />
Then the bug here:<br />
A transparent window area appears, Please just look at my screenshot in the attachment.  <br />
<br />
<br />
Excuse for my poor English description.:p</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">9th May 2007, 14:37</div></div><div class="posttext">Precondition:<br />
Disable the MS-Windows appearance effect [Show Window contents while dragging]...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">13th May 2007, 15:55</div></div><div class="posttext">//global var flag.<br />
static fRedraw = TRUE; //Flag -&gt; only handle at first time.<br />
<br />
//intercept the WM_MOVE message in SettingsProc()...<br />
//and both in SymbolSetProc().<br />
<br />
case WM_MOVE:<br />
			<br />
{<br />
	if(fRedraw)<br />
	{<br />
		fRedraw=FALSE;<br />
<br />
		InvalidateRect(hwndDlg,NULL,TRUE);<br />
		SendMessage(hwndDlg,WM_NCPAINT,1,0);<br />
	}<br />
<br />
	break;<br />
}<br />
<br />
This will be ok, but I don't know why. why do windows need the application ownself handle the redraw?8</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th May 2007, 19:31</div></div><div class="posttext">I can't reproduce this with or without the &quot;Show window contents...&quot; effect. Can you reproduce this on more than one computer? Are you sure it's not a result of a buggy display driver or some other program that might be messing with the display? SettingsProc, which handles all the messages of the settings dialog, always returns FALSE which lets the default Windows dialog procedure handle everything, including drawing, with the defaults.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">13th May 2007, 22:20</div></div><div class="posttext">I reproduced this error the other day on Windows 2000, but it won't do it today (at home) on Windows XP SP2.<br />
<br />
Don</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">13th May 2007, 22:37</div></div><div class="posttext">I can't reproduce on either Windows NT4 or XP and that screenshot was taken on XP.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">14th May 2007, 01:55</div></div><div class="posttext">Originally posted by kichik <br />
I can't reproduce this with or without the &quot;Show window contents...&quot; effect. Can you reproduce this on more than one computer? Are you sure it's not a result of a buggy display driver or some other program that might be messing with the display? <br />
http://logicsmart.bokee.com/inc/win2k3.PNG<br />
In fact, I have reproduced this on severl different computers(Win XP or Win 2003 on my classmates' PCs, and different Windows OS on VM-Virtual PC or MS-VPC), but no problem on Win2k or Win98.<br />
I actually considered it should be no problem and I am still not sure it is MakensisW's fault.<br />
<br />
Originally posted by kichik  SettingsProc, which handles all the messages of the settings dialog, always returns FALSE which lets the default Windows dialog procedure handle everything, including drawing, with the defaults.  <br />
<br />
Yes, I know about this, so I wanna know why error occurs on some computers.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">14th May 2007, 02:44</div></div><div class="posttext">Oh, I think of something.<br />
All those computers with this problem have the UXthemePatcher installed in order to apply third party themes.<br />
Maybe... Can this be the cause?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">14th May 2007, 04:23</div></div><div class="posttext">I am sorry to tell that UXthemePatcher is not the real cause of it.<br />
<br />
I just reproduced the issue on two other computers.<br />
<br />
One with Win2000:  <br />
http://logicsmart.bokee.com/inc/Win2k.png <br />
<br />
<br />
The other with WinXp(without UXthemepatcher): <br />
http://logicsmart.bokee.com/inc/xp-clsthm.png <br />
<br />
<br />
And also, I find some computers which installed WinXP have no problem about it.<br />
<br />
:igor: (Oddly~)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">14th May 2007, 18:50</div></div><div class="posttext">I can't get the pictures you've uploaded. Try using stashbox.org (http://stashbox.org/) instead. Or do they all just show the white rectangles on different OSes?<br />
<br />
Have you tried reproducing this in safe mode on a computer that exhibits the problem? That should narrow down the search.<br />
<br />
I also haven't asked the obvious - does this happen with any other dialogs or programs?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">15th May 2007, 06:53</div></div><div class="posttext">There must be something wrong with my blog server these days.<br />
Yeh, those pictures show the issue on different OSes, <br />
they have been reuploaded to stashbox.org.<br />
one picture at #6 &amp; two pictures at #8<br />
http://stashbox.org/20631/1/win2k3.pnghttp://stashbox.org/20631/win2k3.png<br />
http://stashbox.org/20632/1/Win2k.pnghttp://stashbox.org/20632/Win2k.png<br />
http://stashbox.org/20634/1/xp-clsthm.pnghttp://stashbox.org/20634/xp-clsthm.png<br />
<br />
<br />
<br />
I have reproduced it in the safe mode, and...<br />
as far as I know, there are no other dialogs have the same or similar problem on all those computers.:hang:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">15th May 2007, 18:23</div></div><div class="posttext">what about switching makensisw to wxwidgets, like nsismenu? :)<br />
<br />
it needs some work anyway, because of the lack of support for the new /p switch.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th May 2007, 18:25</div></div><div class="posttext">Try the attached version. It may have redrawing issues with resizing.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">16th May 2007, 03:48</div></div><div class="posttext">Hi, kichik.<br />
<br />
Yeah, thanks.<br />
However, this version still has redrawing issues on that settings dialog.<br />
<br />
Intercept the WM_MOVE message in SettingsProc() and SymbolSetProc(), and do once-redrawing works.<br />
This will be a solution of the very problem.<br />
<br />
<br />
I have attached a single makensisw.cpp file with a little modified.<br />
<br />
<br />
BTW, this issue occurs on quite a number of computers,(absolutely,not few number). <br />
I hope this could be fixed, even though it seems not significant.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">16th May 2007, 03:57</div></div><div class="posttext">And...the compiled makesisw.exe.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th May 2007, 18:12</div></div><div class="posttext">Responding to WM_MOVE with a redraw is not an acceptable solution. It only masks the real problem of improper drawing.<br />
<br />
Try this one.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">engine</div><div class="date">17th May 2007, 00:55</div></div><div class="posttext">I'm sorry. No improvement.:weird:</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>