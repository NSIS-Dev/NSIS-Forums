<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" CreateShortcut / Working Directory Problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  CreateShortcut / Working Directory Problem NSIS Discussion" />
	
	<title> CreateShortcut / Working Directory Problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  CreateShortcut / Working Directory Problem</div>
<hr />
<div class="pda"><a href="t-299421.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=299421">CreateShortcut / Working Directory Problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Red27</div><div class="date">1st November 2008, 05:40</div></div><div class="posttext">Hi there,<br />
<br />
I've having problems trying to amend the Working Directory to be the $INSTDIR for the Start Menu Shortcuts I create.<br />
<br />
I'm using SetOutPath $INSTDIR successfully for the Desktop Shortcut I create ok, but for the Start Menu Short Cuts the Installer either:<br />
<br />
a) fails to create the Shortcut (if I remove the SetOutPath command from the CREATE_SMGROUP_SHORTCUT macro, or change it to $INSTDIR), or<br />
<br />
b) sets the working directory to be the Start Menu Group rather than the INSTDIR (if I leave the SetOutPath $SMPROGRAMS\$StartMenuGroup alone)<br />
<br />
Here are the relevant sections of my script:<br />
<br />
<br />
    SetOutPath $INSTDIR<br />
    CreateShortcut &quot;$DESKTOP\Program1.lnk&quot; $INSTDIR\Program1.exe<br />
<br />
    !insertmacro CREATE_SMGROUP_SHORTCUT &quot;Program 1&quot; $INSTDIR\Program 1.exe<br />
    !insertmacro CREATE_SMGROUP_SHORTCUT &quot;Program 2&quot; $INSTDIR\Program 2.exe<br />
    !insertmacro CREATE_SMGROUP_SHORTCUT &quot;Program 3&quot; $INSTDIR\Program 3.exe<br />
<br />
...<br />
<br />
!macro CREATE_SMGROUP_SHORTCUT NAME PATH<br />
    Push &quot;${NAME}&quot;<br />
    Push &quot;${PATH}&quot;<br />
    Call CreateSMGroupShortcut<br />
!macroend<br />
<br />
...<br />
<br />
Function CreateSMGroupShortcut<br />
    Exch $R0 ;PATH<br />
    Exch<br />
    Exch $R1 ;NAME<br />
    Push $R2<br />
    StrCpy $R2 $StartMenuGroup 1<br />
    StrCmp $R2 &quot;&gt;&quot; no_smgroup<br />
    #SetOutPath $SMPROGRAMS\$StartMenuGroup *** SEEMS TO BE THE PROBLEM - BUT WHAT TO SET TO? ***<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\$R1.lnk&quot; $R0<br />
no_smgroup:<br />
    Pop $R2<br />
    Pop $R1<br />
    Pop $R0<br />
FunctionEnd<br />
<br />
<br />
By the way, the macro was generated by the EclipseNSIS wizard.<br />
<br />
I'd be grateful for suggestions.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kel Solaar</div><div class="date">1st November 2008, 14:58</div></div><div class="posttext">I'm facing the same exact problem and would like to know what is the solution.<br />
<br />
Here is my related section :<br />
<br />
Section -post SEC0001<br />
    WriteRegStr HKLM &quot;${REGKEY}&quot; Path $INSTDIR<br />
    SetOutPath $INSTDIR<br />
    WriteUninstaller $INSTDIR\Uninstall.exe<br />
    !insertmacro MUI_STARTMENU_WRITE_BEGIN Application<br />
    SetOutPath $SMPROGRAMS\$StartMenuGroup<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\$(^Name).lnk&quot; $INSTDIR\$(^Name).exe<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot; $INSTDIR\Uninstall.exe<br />
    !insertmacro MUI_STARTMENU_WRITE_END<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayName &quot;$(^Name)&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayVersion &quot;${VERSION}&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; Publisher &quot;${COMPANY}&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; URLInfoAbout &quot;${URL}&quot;<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; DisplayIcon $INSTDIR\Uninstall.exe<br />
    WriteRegStr HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; UninstallString $INSTDIR\Uninstall.exe<br />
    WriteRegDWORD HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; NoModify 1<br />
    WriteRegDWORD HKLM &quot;SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(^Name)&quot; NoRepair 1<br />
SectionEnd<br />
<br />
<br />
Edit : I found a workaround : copying the Desktop shortcut back to the Startup Menu, not really clean but it works. Hope someone will find a real solution.<br />
<br />
<br />
SetOutPath $INSTDIR<br />
    CreateShortcut &quot;$DESKTOP\$(^Name).lnk&quot; $INSTDIR\$(^Name).exe<br />
    SetOutPath $SMPROGRAMS\$StartMenuGroup<br />
    CopyFiles &quot;$DESKTOP\$(^Name).lnk&quot; &quot;$SMPROGRAMS\$StartMenuGroup\&quot;<br />
    CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot; $INSTDIR\Uninstall.exe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st November 2008, 16:40</div></div><div class="posttext">Why not do:<br />
SetOutPath $SMPROGRAMS\$StartMenuGroup<br />
SetOutPath $INSTDIR<br />
CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\$(^Name).lnk&quot; $INSTDIR\$(^Name).exe<br />
CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot; $INSTDIR\Uninstall.exe<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Kel Solaar</div><div class="date">1st November 2008, 16:52</div></div><div class="posttext">It's working like a charm !<br />
<br />
Btw I don't really understand the code tbh and why it's working<br />
<br />
this alone :<br />
<br />
SetOutPath $INSTDIR<br />
<br />
don't work but this :<br />
<br />
SetOutPath $SMPROGRAMS\$StartMenuGroup<br />
SetOutPath $INSTDIR<br />
<br />
is working, why ?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st November 2008, 19:05</div></div><div class="posttext">You need to create the directory before creating the shortcut in it. SetOutPath recursively creates the directories as well as sets the working directory to it.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red27</div><div class="date">1st November 2008, 20:12</div></div><div class="posttext">Afrow UK - brilliant - that 100% resolved the problem - thanks very much! :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">LoRd_MuldeR</div><div class="date">2nd November 2008, 02:09</div></div><div class="posttext">Instead of changing the OutPath two times, you could simply do:<br />
<br />
CreateDirectory $SMPROGRAMS\$StartMenuGroup<br />
CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\$(^Name).lnk&quot; $INSTDIR\$(^Name).exe<br />
CreateShortcut &quot;$SMPROGRAMS\$StartMenuGroup\Uninstall $(^Name).lnk&quot; $INSTDIR\Uninstall.exe</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>