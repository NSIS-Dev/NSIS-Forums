<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" how to disable custompage, when section selected, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  how to disable custompage, when section selected NSIS Discussion" />
	
	<title> how to disable custompage, when section selected [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  how to disable custompage, when section selected</div>
<hr />
<div class="pda"><a href="t-171349.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=171349">how to disable custompage, when section selected</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">28th February 2004, 09:03</div></div><div class="posttext">Hey all,<br />
I can't find a solution for my problem:<br />
I want to show custompage conditionally (only when section is selected). At the moment my custompage appears always, no mather if section is selected or not. here is my simplified script:<br />
(original script contains more than 1000 lines, several sections and a lot of functions)<br />
<br />
  !include &quot;MUI.nsh&quot;<br />
  Name &quot;Test&quot;<br />
  OutFile &quot;text.exe&quot;<br />
  InstallDir &quot;$PROGRAMFILES\Test&quot;<br />
<br />
  !insertmacro MUI_PAGE_COMPONENTS<br />
  Page custom CustomPage<br />
  !insertmacro MUI_PAGE_DIRECTORY<br />
  !insertmacro MUI_PAGE_INSTFILES<br />
<br />
  ReserveFile &quot;CustomPFile.ini&quot;<br />
  !insertmacro MUI_RESERVEFILE_INSTALLOPTIONS<br />
<br />
Section &quot;Section&quot; SecIndex<br />
  SetOutPath &quot;$INSTDIR&quot;<br />
  WriteRegStr HKCU &quot;Software\Modern UI Test&quot; &quot;&quot; $INSTDIR<br />
  WriteUninstaller &quot;$INSTDIR\Uninstall.exe&quot;<br />
SectionEnd<br />
<br />
Function .onInit<br />
  !insertmacro MUI_INSTALLOPTIONS_EXTRACT &quot;CustomPFile.ini&quot;<br />
FunctionEnd<br />
<br />
Function CustomPage<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;CustomPFile.ini&quot;<br />
FunctionEnd<br />
<br />
I would be very greatful, if someone could tell me how to make custompage disappear when section is not selected</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">28th February 2004, 11:50</div></div><div class="posttext">i used this :<br />
<br />
<br />
Function YourName<br />
 SectionGetFlags ${YourSection} $0<br />
 StrCmp $0 ${SF_SELECTED} 0 skipPage<br />
  !insertmacro MUI_HEADER_TEXT &quot;bla&quot; &quot;bla bla&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;YourINIfile.ini&quot;<br />
 skipPage:<br />
FunctionEnd<br />
<br />
this function dispays the custom page if the section IS SELECTED. just replace<br />
<br />
StrCmp $0 ${SF_SELECTED} 0 skipPage<br />
<br />
with<br />
<br />
StrCmp $0 ${SF_SELECTED} 1 skipPage<br />
<br />
that should work.<br />
<br />
OJi.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">28th February 2004, 17:57</div></div><div class="posttext">big tnx to o_owd,<br />
I got it now working by, editing the code a little.<br />
The replacement(wich o_owd advised didn't work (0 -&gt; 1), It could be +1 or label(i like it more):<br />
StrCmp $0 ${SF_SELECTED} showpage skipPage<br />
<br />
And then i had to !include Sections.nsh to get whole thing working.<br />
I attach my script..Hopefully it helps someone. To get this script working you have to rename some custompage ini file(for example from nsis examples dir) to CustomPFile.ini</div></div><hr />


<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">28th February 2004, 18:01</div></div><div class="posttext">here it is</div></div><hr />


<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">28th February 2004, 20:12</div></div><div class="posttext">it doesn't work, as i thought frist place! :eek:<br />
now that i have tested it with more than one section it seems that it considers only the section, that is the first on the list, not the one, that i have selected with SectionGetFlags. i really need some help. can someone please look and correct my script(this one has 3 sections) :confused:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">29th February 2004, 07:43</div></div><div class="posttext">sorry for that! my mistake. :down: <br />
<br />
replace <br />
<br />
SectionGetFlags Sec2Index $0<br />
StrCmp $0 ${SF_SELECTED} showpage skipPage<br />
 showpage:<br />
  !insertmacro MUI_HEADER_TEXT &quot;bla&quot; &quot;bla bla&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;CustomPFile.ini&quot;<br />
 skipPage:<br />
<br />
with this<br />
<br />
SectionGetFlags ${Sec2Index} $0<br />
StrCmp $0 &quot;0&quot; 0 skipPage<br />
  !insertmacro MUI_HEADER_TEXT &quot;bla&quot; &quot;bla bla&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;CustomPFile.ini&quot;<br />
 skipPage:<br />
<br />
i'm really sorry for the mistake. stupid me! the reply was written in a hurry...<br />
<br />
sorry again.<br />
<br />
OJi.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">29th February 2004, 09:34</div></div><div class="posttext">no problem..tnx</div></div><hr />


<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">29th February 2004, 10:35</div></div><div class="posttext">ok, now i got it working, almost as i wanted. It works great with usual sections, but still don't know how to make it working with subsections. by the way there was still one little mistake in last post:<br />
<br />
change this:<br />
SectionGetFlags ${Sec2Index} $0 <br />
StrCmp $0 &quot;0&quot; 0 skipPage  #shows if not selected<br />
  !insertmacro MUI_HEADER_TEXT &quot;bla&quot; &quot;bla bla&quot; <br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;CustomPFile.ini&quot; <br />
skipPage:<br />
<br />
with:<br />
<br />
SectionGetFlags ${Sec2Index} $0 <br />
StrCmp $0 &quot;0&quot; 1 skipPage   # shows if selected<br />
  !insertmacro MUI_HEADER_TEXT &quot;bla&quot; &quot;bla bla&quot; <br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;CustomPFile.ini&quot; <br />
skipPage:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">o_owd</div><div class="date">29th February 2004, 11:44</div></div><div class="posttext">Originally posted by k2rnkonn <br />
<br />
change this:<br />
StrCmp $0 &quot;0&quot; 0 skipPage  #shows if not selected<br />
<br />
with:<br />
StrCmp $0 &quot;0&quot; 1 skipPage   # shows if selected <br />
<br />
<br />
you must change the number beetween quotes.<br />
<br />
StrCmp $0 &quot;0&quot; 0 skipPage  #shows if not selected<br />
<br />
StrCmp $0 &quot;1&quot; 0 skipPage  # shows if selected<br />
<br />
i don't know how to make it work with subsections. maybe somebody else can help!<br />
<br />
OJi.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">29th February 2004, 12:06</div></div><div class="posttext">my dear.<br />
u didn't read the docs about section-flags.<br />
the command SectionGetFlags return ALL flags as 32bit integer. means, that if the section has more than one flag set (like subsections have, or bold sections, see the docs), the number is different.<br />
this code will extract the needed flag:<br />
!macro	GetSectionSelection  SECTION<br />
	Push	$1<br />
	SectionGetFlags	&quot;${SECTION}&quot;  $1<br />
	IntOp	$1  $1 &amp; 1<br />
	Exch		$1<br />
!macroend<br />
use it like this:<br />
!insertmacro GetSectionSelection ${mysection}<br />
Pop $0<br />
StrCmp $0 1 selected not_selected<br />
selected:<br />
not_selected:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">29th February 2004, 12:28</div></div><div class="posttext">Originally posted by o_owd <br />
you must change the number beetween quotes.<br />
<br />
StrCmp $0 &quot;0&quot; 0 skipPage  #shows if not selected<br />
<br />
StrCmp $0 &quot;1&quot; 0 skipPage  # shows if selected<br />
<br />
i don't know how to make it work with subsections. maybe somebody else can help!<br />
<br />
OJi.  <br />
<br />
it doesn't matter :p , both will work the same way, only solution will change<br />
now i figured out the way how to show page when at least one section from subsection is selected(only don't know, if it is the best solution):<br />
<br />
Function CustomPage<br />
 SectionGetFlags ${s1} $1<br />
 SectionGetFlags ${s2} $2<br />
 SectionGetFlags ${s3} $3<br />
 SectionGetFlags ${s4} $4<br />
 IntOp $0 0 + $1<br />
 IntOp $0 $0 + $2<br />
 IntOp $0 $0 + $3<br />
 IntOp $0 $0 + $4<br />
 messagebox mb_ok &quot;Selected $0 sections from subsection&quot;<br />
 IntCmp $0 0 skipPage skipPage<br />
 #if $0(sum of selected sections)=0 skipPage, if less(can't be possibel) also skipPage,<br />
 # if more, go on with next line<br />
  !insertmacro MUI_HEADER_TEXT &quot;bla&quot; &quot;bla bla&quot;<br />
  !insertmacro MUI_INSTALLOPTIONS_DISPLAY &quot;CustomPFile.ini&quot;<br />
 skipPage:<br />
FunctionEnd<br />
 <br />
s1-s4 are sections in subsection, so if one or more of sections form subsections are selected, then it adds the number of selected sections to $0(original value is 0).<br />
then it will compere $0 with 0, and if result is equal or less, then it goes to skipPage, otherwise goes on with next line:blah: <br />
<br />
whole script attached file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Comm@nder21</div><div class="date">29th February 2004, 12:41</div></div><div class="posttext">why didn't u read my post?<br />
it's much easier, than ur &quot;work-around&quot; ...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">k2rnkonn</div><div class="date">29th February 2004, 12:52</div></div><div class="posttext">ok, after posting my reply i read Comm@nder21's reply. but it didn't work, as i thought(maybe i did something wrong).<br />
$0 is 0 when subsection is not selected, or is partly selected (only some sections inside subsection is selected)<br />
and 1 when whole subsection tree is selected.<br />
<br />
maybe did i something wrong..anyway my script is attached. tnx Comm@nder21, i'm waiting for youre reply</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>