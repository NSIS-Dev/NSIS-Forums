<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" How to close applicatiom, restart windows, run cmd and install dll, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  How to close applicatiom, restart windows, run cmd and install dll NSIS Discussion" />
	
	<title> How to close applicatiom, restart windows, run cmd and install dll [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  How to close applicatiom, restart windows, run cmd and install dll</div>
<hr />
<div class="pda"><a href="t-281477.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281477">How to close applicatiom, restart windows, run cmd and install dll</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">15th November 2007, 06:30</div></div><div class="posttext">Hi at first i need to say that this is my first post and i am newbie in Nsis so i a not pro in it<br />
<br />
i want to do these things but i dont know how:<br />
<br />
1) before finish installation run cmd.exe and write sfc /purgecache in it (i don't want this optional)<br />
<br />
2) after that i want to close cmd.exe and a dialog box that appear<br />
<br />
3) restart the windows<br />
i know there is http://nsis.sourceforge.net/ShutDown_plug-in<br />
for this but i donlt kn ow how to use it<br />
<br />
4) my another qustion is bout installing dll that windows protectet i know i can use<br />
<br />
InstallLib REGDLL NOTSHARED REBOOT_NOTPROTECTED <br />
<br />
is it true this code install my dll after boot? and do nothing befor boot? i just wana sure about it<br />
<br />
please answer for a dummy :p Thanks in advanced</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th November 2007, 18:07</div></div><div class="posttext">Use ExecWait at the end of your last section. It'll close automatically. If not, you can use nsExec or ExecDos instead of ExecWait. Use the built-in Reboot command or use the MUI's finish page. The finish page will ask the user to reboot if the reboot flag is set. Use SetRebootFlag to set the reboot flag. You can't and shouldn't replace protected files.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">15th November 2007, 18:45</div></div><div class="posttext">## Use ExecWait at the end of your last section.<br />
# It'll close automatically. If not, you can use nsExec or ExecDos instead of ExecWait. <br />
<br />
tha nks but i decide to write a bat file and execute it after a section<br />
i think it is better<br />
<br />
about problem number 3 thanks it worked for me :)<br />
<br />
but about number 4 i want to delete default kbdfa.dll it is default Farsi (persian) keyboard and it is not standard so i wana replace it with standard kbdfa.dll<br />
<br />
but it is windowse protected file<br />
<br />
i try these step to do it:<br />
<br />
${registry::KeyExists} &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot; $R0<br />
${registry::Write} &quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot; &quot;SFCDisable&quot; &quot;1&quot; &quot;REG_DWORD&quot; $R0<br />
 <br />
and then<br />
<br />
run sfc /purgecache in cmd<br />
<br />
and after that<br />
<br />
!insertmacro InstallLib REGDLL NOTSHARED REBOOT_NOTPROTECTED kbdfa.dll $SYSDIR\kbdfa.dll $SYSDIR<br />
<br />
<br />
i just wana know what will do this:<br />
<br />
<br />
InstallLib REGDLL NOTSHARED REBOOT_NOTPROTECTED<br />
<br />
<br />
does this code replace kbdfa.dll after reboot or not and if NO what is tha action of this code?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">15th November 2007, 20:01</div></div><div class="posttext">It'd replace it after reboot if it can't replace it immediately.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">16th November 2007, 06:43</div></div><div class="posttext">thanks for answering...<br />
<br />
i found that i need to restart windows 2 time<br />
1) after run bat file (run sfc /purgecache in cmd)<br />
2) after !insertmacro InstallLib REGDLL NOTSHARED REBOOT_NOTPROTECTED kbdfa.dll $SYSDIR\kbdfa.dll $SYSDIR<br />
<br />
is there anyway for this?<br />
<br />
i mean <br />
1)user execute inistaller then<br />
2) inistaller say you need to reboot<br />
3) user choose reboot<br />
4) after reboot instalation continue its work and then say you need to reboot<br />
5) user choose reboot<br />
6) after reboot complete instalation<br />
<br />
is it posible?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th November 2007, 09:05</div></div><div class="posttext">I don't know. Installing over a protected file is not a standard action and it's not recommended. If you have some guide that shows how to do it without rebooting twice, I can help you implement the details.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">16th November 2007, 12:22</div></div><div class="posttext">If you have some guide that shows how to do it without rebooting twice, I can help you implement the details.<br />
<br />
no id don;t have any guide i just know i shuld do these steop<br />
<br />
1) change SFCDisable value fro, 0 tp 1<br />
2) go to start&gt;run and type:sfc /purgecache<br />
3) click cancel if windowse protection file dilog appear<br />
4) click yes<br />
5) restart windows<br />
6) copy kbdfa.dll(this is my file) to system32\kbdfa.dll(original file)<br />
7) click cancel if windowse protection file dilog appear<br />
8) click yes <br />
9) restart windows<br />
<br />
that's it<br />
<br />
but as you see it need reboot twice</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th November 2007, 12:28</div></div><div class="posttext">If you must reboot twice, you can put your installer in the RunOnce registry key before the first reboot. This way, the installer will start itself again and you can continue to step 6.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">16th November 2007, 12:51</div></div><div class="posttext">my installer name is PSK.setup<br />
<br />
do you mean this:?<br />
<br />
<br />
<br />
Section -run PSK<br />
  WriteRegStr HKEY_LOCAL_MACHINE &quot;Software\Microsoft\Windows\CurrentVersion\RunOnce&quot; &quot;PSK&quot; &quot;$INSTDIR\PSK.exe&quot;<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">16th November 2007, 13:25</div></div><div class="posttext">Yes.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mazdakam</div><div class="date">16th November 2007, 14:51</div></div><div class="posttext">no no :(<br />
did not work for me<br />
<br />
how it can call a PSK.exe when there is nothing there?</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>