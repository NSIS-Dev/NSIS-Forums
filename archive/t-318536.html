<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" List of all users, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  List of all users NSIS Discussion" />
	
	<title> List of all users [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  List of all users</div>
<hr />
<div class="pda"><a href="t-318536.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=318536">List of all users</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">20th April 2010, 13:21</div></div><div class="posttext">Hi there.<br />
<br />
I was wondering, for my backup program, if it is possible to get a list of users and use them as variables in cmd or nsis?<br />
<br />
So i can backup all of my users with one click.<br />
<br />
Thanks in advance.<br />
<br />
Rob</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">20th April 2010, 13:31</div></div><div class="posttext">http://nsis.sourceforge.net/User_Management_using_API_calls#Enumerate_all_users</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">20th April 2010, 14:19</div></div><div class="posttext">Only crashing my installer. <br />
Any variables i have to define before executing the macro?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">20th April 2010, 15:05</div></div><div class="posttext">The script mentioned in that wiki page makes uses of the NSISArray plugin and header - make sure the compiler can find those.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">20th April 2010, 15:25</div></div><div class="posttext">yes i'm not getting any error in compiling my script aswell i'm using <br />
!include &quot;NSISArray.nsh&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">20th April 2010, 15:43</div></div><div class="posttext">what if you try this?<br />
<br />
!include &quot;LogicLib.nsh&quot;<br />
<br />
OutFile &quot;test.exe&quot;<br />
<br />
Section<br />
SectionEnd<br />
<br />
RequestExecutionLevel admin<br />
<br />
Function .onInit<br />
  ReadRegStr $0 HKLM &quot;System\CurrentControlSet\Control\ComputerName\ActiveComputerName&quot; &quot;ComputerName&quot;<br />
  System::Call 'netapi32::NetUserEnum(w &quot;\\$0&quot;,i 0,i 2,*i .R0,i ${NSIS_MAX_STRLEN}, *i .R1,*i .R2,*i .r1)i .r2'<br />
  StrCpy $R8 $R0<br />
  IntOp $R2 $R2 - 1<br />
  ${ForEach} $9 0 $R2 + 1<br />
    System::Call &quot;*$R0(w.R9)&quot;<br />
    MessageBox MB_OK &quot;[$R9]&quot;<br />
    IntOp $R0 $R0 + 4<br />
  ${Next}<br />
  System::Call 'netapi32.dll::NetApiBufferFree(i R8)i .R1'<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">20th April 2010, 15:53</div></div><div class="posttext">then i get a popup of all users. Is it also possible to display them in a list?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">20th April 2010, 16:10</div></div><div class="posttext">i got it :)<br />
<br />
Function users<br />
 !insertmacro MUI_HEADER_TEXT &quot;userlist&quot; &quot;overzicht van alle gebruikers&quot;<br />
  ReadRegStr $0 HKLM &quot;System\CurrentControlSet\Control\ComputerName\ActiveComputerName&quot; &quot;ComputerName&quot;<br />
  System::Call 'netapi32::NetUserEnum(w &quot;\\$0&quot;,i 0,i 2,*i .R0,i ${NSIS_MAX_STRLEN}, *i .R1,*i .R2,*i .r1)i .r2'<br />
  StrCpy $R8 $R0<br />
  IntOp $R2 $R2 - 1<br />
  SetOutPath &quot;$INSTDIR\&quot;<br />
  StrCpy &quot;$1&quot; &quot;$INSTDIR&quot;<br />
  FileOpen &quot;$0&quot; &quot;users.bat&quot; &quot;w&quot;<br />
  FileWrite &quot;$0&quot; &quot;$1$\r$\n&quot;<br />
  ${ForEach} $9 0 $R2 + 1<br />
    System::Call &quot;*$R0(w.R9)&quot;<br />
	  FileWrite &quot;$0&quot; &quot;set user$9=[$R9]$\r$\n&quot;<br />
    IntOp $R0 $R0 + 4<br />
  ${Next}<br />
  FileClose &quot;$0&quot;<br />
  System::Call 'netapi32.dll::NetApiBufferFree(i R8)i .R1'<br />
FunctionEnd<br />
<br />
<br />
Ty for the help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">20th April 2010, 16:24</div></div><div class="posttext">Not sure why your installer hung/crashed before.. might have been NSISArray - not really needed.. the macro should use a callback function instead and let the user decide what to do with the info.  I might propose an edit to that wiki page later.<br />
<br />
Anyway - glad it's all sorted :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">20th April 2010, 16:37</div></div><div class="posttext">one more issue...<br />
<br />
i do this now: <br />
<br />
<br />
  ${ForEach} $9 0 $R2 + 1<br />
    System::Call &quot;*$R0(w.R9)&quot;<br />
	  !define user$9 $R9<br />
    IntOp $R0 $R0 + 4<br />
  ${Next}<br />
<br />
<br />
But i cant recall my defined users.<br />
<br />
Is there any workaround?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Animaether</div><div class="date">20th April 2010, 17:06</div></div><div class="posttext">one more issue...<br />
<br />
<br />
	  !define user$9 $R9<br />
<br />
<br />
But i cant recall my defined users.<br />
<br />
Is there any workaround?<br />
<br />
Defines are created at compile-time, rather than runtime.  If you need the list of users the installer is run on, use a variable instead.  Or fall back to the text file output and read from that, or use NSISArray to store each user in an array (which the original macro did) :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">CancerFace</div><div class="date">21st April 2010, 09:04</div></div><div class="posttext">I have not been keeping up with Afro's NSISArray array plugin development, but I am pretty sure that the wiki page macro works with version 1.x ...<br />
<br />
Here is what also works with v.2.3 that I just tested:<br />
First some definitions ...<br />
!define NERR_Success 0<br />
!define NERR_More_Data 234<br />
!define strNET_DISPLAY_USER '(w,w,i,w,i,i)i'<br />
Then the macro:<br />
!macro EnumLocalUsers SERVER_NAME ARRAY_NAME ERRORFLAG<br />
!define Index &quot;Line${__LINE__}&quot;<br />
StrCpy ${ERRORFLAG} 0<br />
; $R0 gets number of entries, $R1 is an array of NET_DISPLAY_USER structures<br />
System::Call /NOUNLOAD 'netapi32::NetQueryDisplayInformation(w &quot;${SERVER_NAME}&quot;,i 1,i 0,i 99, i ${NSIS_MAX_STRLEN},*i .R2,*i .R0)i.r5'<br />
StrCmp $5 ${NERR_Success} ${Index}_No_Error<br />
StrCmp $5 ${NERR_More_Data} ${Index}_No_Error ${Index}_Error<br />
${Index}_Error:<br />
  StrCpy ${ERRORFLAG} 1<br />
  Goto ${Index}_End<br />
${Index}_No_Error:<br />
  StrCpy $R7 $R0<br />
  NSISArray::New /NOUNLOAD ${ARRAY_NAME} $R2 2<br />
  StrCpy $2 0<br />
  ${Index}_Feed:<br />
	  StrCmp $2 $R2 ${Index}_Stop<br />
	  System::Call '*$R0${strNET_DISPLAY_USER}(.R9,,,,,)'<br />
    IntOp $R0 $R0 + 24<br />
    NSISArray::Write /NOUNLOAD ${ARRAY_NAME} $2 '$R9'<br />
    IntOp $2 $2 + 1<br />
    Goto ${Index}_Feed<br />
	${Index}_Stop:<br />
  NSISArray::FreeUnusedMem /NOUNLOAD<br />
${Index}_End:<br />
System::Call /NOUNLOAD 'netapi32::NetApiBufferFree(i R7)i.r5'<br />
!undef Index<br />
!macroend<br />
Call the macro (for the local machine):<br />
StrCpy $1 0<br />
!insertmacro EnumLocalUsers &quot;&quot; LocalUsers $1<br />
${If} $1 = 1<br />
  MessageBox MB_OK|MB_ICONSTOP|MB_TOPMOST &quot;Error on the API call!&quot;<br />
${EndIf}<br />
and if I debug I get all the local users in the array object:<br />
NSISArray::Debug /NOUNLOAD LocalUsers<br />
<br />
Hope this helps,<br />
CF</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">22nd April 2010, 11:33</div></div><div class="posttext">Alright, i got it now, but how can i exclude stuff like SUPPORT_388945a0<br />
?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">22nd April 2010, 14:22</div></div><div class="posttext">v2.3 had a MS VC90 CRT dependency (in its XML manifest) which I've now sorted in v2.4. Let me know if the crashing is fixed.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">xreboot</div><div class="date">22nd April 2010, 14:43</div></div><div class="posttext">got it all fixed :).<br />
<br />
For those with a similar problem:<br />
http://pastebin.com/R4tfTHhW</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>