<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" SMPROGRAMS is acting kinda weird, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  SMPROGRAMS is acting kinda weird NSIS Discussion" />
	
	<title> SMPROGRAMS is acting kinda weird [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  SMPROGRAMS is acting kinda weird</div>
<hr />
<div class="pda"><a href="t-301568.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=301568">SMPROGRAMS is acting kinda weird</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">eagle3386</div><div class="date">31st December 2008, 12:11</div></div><div class="posttext">Hey guys,<br />
<br />
I'm trying to build an installer which (depending on the user's rights) either creates startmenu-shortcuts for all or only for the current user.<br />
That wouldn't be really kinda problem, but my installer only adds functionality to an already installed programm.<br />
Unfortunately, this programm doesn't store it's startmenu-path into the registry), so I came up with this:<br />
<br />
(...)<br />
!define MUI_STARTMENUPAGE_DEFAULTFOLDER &quot;$SMPROGRAMS\My App&quot;<br />
(...)<br />
Var mySMDir<br />
(...)<br />
!insertmacro MUI_PAGE_STARTMENU mySMPage $mySMDir<br />
(...)<br />
Section &quot;Startmenu&quot;<br />
 !insertmacro MUI_STARTMENU_WRITE_BEGIN mySMPage<br />
  SetShellVarContext all<br />
  ClearErrors<br />
<br />
  IfFileExists &quot;$SMPROGRAMS\Company\Product&quot; +1 +3<br />
   StrCpy $mySMDir &quot;$SMPROGRAMS\Company\Product&quot;<br />
   Goto mySMDone<br />
  IfFileExists &quot;$SMPROGRAMS\Company&quot; +1 +3<br />
   StrCpy $mySMDir &quot;$SMPROGRAMS\Company&quot;<br />
   Goto mySMDone<br />
  IfFileExists &quot;$SMPROGRAMS\Product&quot; +1 +2<br />
   StrCpy $mySMDir &quot;$SMPROGRAMS\Product&quot;<br />
<br />
  mySMDone:<br />
   WriteINIStr &quot;$INSTDIR\..\${THREADLINK}.url&quot; &quot;InternetShortcut&quot; &quot;URL&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
   CreateShortCut &quot;$SMPROGRAMS\$mySMDir\${THREADLINK}.lnk&quot; &quot;$INSTDIR\..\${THREADLINK}.url&quot; &quot;&quot; &quot;%SystemRoot%\system32\shell32.dll&quot; &quot;13&quot;<br />
   CreateShortCut &quot;$SMPROGRAMS\$mySMDir\${UNINSTALLER}.lnk&quot; &quot;$INSTDIR\..\${PRODUCT_PUB_SHORT}_${PRODUCT_NAME}_Uninstall.exe&quot;<br />
<br />
  IfErrors 0 myNoSMError<br />
   SetShellVarContext current<br />
   WriteINIStr &quot;$INSTDIR\..\${THREADLINK}.url&quot; &quot;InternetShortcut&quot; &quot;URL&quot; &quot;${PRODUCT_WEB_SITE}&quot;<br />
   CreateShortCut &quot;$SMPROGRAMS\$mySMDir\${THREADLINK}.lnk&quot; &quot;$INSTDIR\..\${THREADLINK}.url&quot; &quot;&quot; &quot;%SystemRoot%\system32\shell32.dll&quot; &quot;13&quot;<br />
   CreateShortCut &quot;$SMPROGRAMS\$mySMDir\${UNINSTALLER}.lnk&quot; &quot;$INSTDIR\..\${PRODUCT_PUB_SHORT}_${PRODUCT_NAME}_Uninstall.exe&quot;<br />
<br />
  myNoSMError:<br />
   SetOutPath &quot;$INSTDIR&quot;<br />
 !insertmacro MUI_STARTMENU_WRITE_END<br />
SectionEnd<br />
<br />
But this doesn't work, because the startmenu-page always shows &quot;C:\Users\&lt;My Username&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\My App&quot; - and it's getting even stranger if you select one of the entries below that input-field (e.g. when selecting the folder &quot;ATI Tray Tools&quot;), because the input-field then changes to &quot;ATI Tray Tools\C:\Users\&lt;My Username&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\My App&quot;<br />
<br />
Setting &quot;MUI_STARTMENUPAGE_DEFAULTFOLDER&quot; to &quot;$SMPROGRAMS\$mySMDir&quot; also doesn't work.. :(<br />
<br />
[-EDIT-]<br />
Also, whenever I use the default (&quot;My App&quot;), I get 3 errors within the log - but the app _always_ requests (and gets) admin-rights?!<br />
[-/EDIT-]<br />
<br />
Any help would be greatly appreciated!<br />
<br />
Best regards,<br />
 Martin :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eagle3386</div><div class="date">31st December 2008, 15:20</div></div><div class="posttext">Okay, fixed the problem myself.. :)<br />
<br />
First problem was: IfFileExists &quot;$SMPROGRAMS\Company\Product&quot; +1 +3<br />
 StrCpy $mySMDir &quot;$SMPROGRAMS\Company\Product&quot;<br />
 Goto mySMDone<br />
IfFileExists &quot;$SMPROGRAMS\Company&quot; +1 +3<br />
 StrCpy $mySMDir &quot;$SMPROGRAMS\Company&quot;<br />
 Goto mySMDone<br />
IfFileExists &quot;$SMPROGRAMS\Product&quot; +1 +2<br />
 StrCpy $mySMDir &quot;$SMPROGRAMS\Product&quot;<br />
Each StrCpy-line includes &quot;$SMPROGRAMS&quot;, so that's surely the reason for the strange behavior on the startmenu-page.<br />
<br />
Additionally, I removed the stuff for the startmenu-page and instead modified the code to create the shortcuts when the section gets processed - this means less possibilities for the user to change the startmenu-folder..<br />
But that's ok, the user installs an add-on, not a standalone program.. ;)<br />
<br />
/Martin.. :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>