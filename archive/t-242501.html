<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS Get System Memory, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS Get System Memory NSIS Discussion" />
	
	<title> NSIS Get System Memory [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS Get System Memory</div>
<hr />
<div class="pda"><a href="t-242501.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=242501">NSIS Get System Memory</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">3rd April 2006, 17:43</div></div><div class="posttext">I am using this to get the system memory:<br />
<br />
# allocate<br />
System::Alloc 32<br />
Pop $1<br />
# call<br />
System::Call &quot;Kernel32::GlobalMemoryStatus(i r1)&quot;<br />
# get<br />
System::Call &quot;*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9)&quot;<br />
# free<br />
System::Free $1<br />
# print<br />
DetailPrint &quot;Structure size: $2 bytes&quot;<br />
DetailPrint &quot;Memory load: $3%&quot;<br />
DetailPrint &quot;Total physical memory: $4 bytes&quot;<br />
DetailPrint &quot;Free physical memory: $5 bytes&quot;<br />
DetailPrint &quot;Total page file: $6 bytes&quot;<br />
DetailPrint &quot;Free page file: $7 bytes&quot;<br />
DetailPrint &quot;Total virtual: $8 bytes&quot;<br />
DetailPrint &quot;Free virtual: $9 bytes&quot;<br />
<br />
But for some reason, it is not showing the correct memory information.  Example, I have a system with 4GB memory.  I ran the code above to get the memory information and I am only getting about 2GB.  Can anyone help me please?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd April 2006, 18:18</div></div><div class="posttext">Probably a stupid question, but does Windows say that you have 4GB under My Computer?<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">3rd April 2006, 18:50</div></div><div class="posttext">Afrow.  That is not a stupid question.<br />
<br />
Yes. The system say 4GB.  I am running this on Windows 2003.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Takhir</div><div class="date">3rd April 2006, 18:55</div></div><div class="posttext">System plug-in vars looks like signed int (or I not found DWORD | unsigned mentioned in it's Readme), so I always have in mind that problems may occure with handles and other unsigned. So may be good to update data types set (or docs if there are some tricks for DWORD)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">3rd April 2006, 21:23</div></div><div class="posttext">When I ran the sample codes above from any Windows 2000, 2003, and XP with memory between 3GB-4GB of memory, I am getting the same number:<br />
<br />
Here is the output for physical memory: 2147483647 bytes (this is about 2GB right - :) if my calculation is correct).<br />
<br />
Is there a limitation with calling this Kernel32::GlobalMemoryStatus?<br />
<br />
The system shows 4GB, but I am getting only 2GB, any other way to get the correct system physical memory information?<br />
<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">3rd April 2006, 21:33</div></div><div class="posttext">Use GlobalMemoryStatusEx instead of GlobalMemoryStatus.<br />
http://www.cygwin.com/ml/cygwin/2004-12/msg00156.html<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">3rd April 2006, 21:42</div></div><div class="posttext">Stu<br />
<br />
Any sample, what parameters do I need to pass in.<br />
<br />
I tried it but it returns with 0s.<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">4th April 2006, 00:45</div></div><div class="posttext">Hello Everyone.  Does anyone have the example for GlobalMemoryStatusEx  which Stu mentioned above.  I tried it but it gave me whole bunch of zeros.  I think I have problem with the output <br />
<br />
   System::Call &quot;Kernel32::GlobalMemoryStatus(i r1)&quot;<br />
   # get<br />
   System::Call &quot;*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9)&quot;<br />
<br />
Thanks in advance.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">4th April 2006, 00:46</div></div><div class="posttext">ooops sorry correction<br />
<br />
System::Call &quot;Kernel32::GlobalMemoryStatusEx(i r1)&quot;<br />
# get<br />
System::Call &quot;*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9)&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">4th April 2006, 08:48</div></div><div class="posttext">GlobalMemoryStatusEx uses the MEMORYSTATUSEX structure which has another parameter that specifies the extended memory (ullAvailExtendedVirtual).<br />
<br />
Try:<br />
System::Call &quot;*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9, i.r10)&quot;<br />
# $R0 = ullAvailExtendedVirtual<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">4th April 2006, 15:06</div></div><div class="posttext">Stu,<br />
<br />
That's what I thought too. This is the code I executed.<br />
<br />
# allocate<br />
System::Alloc 32<br />
Pop $1<br />
# call<br />
System::Call &quot;Kernel32::GlobalMemoryStatusEx(i r1)&quot;<br />
# get<br />
System::Call &quot;*$1(i.r2, i.r3, i.r4, i.r5, i.r6, i.r7, i.r8, i.r9, i.r10)&quot;<br />
# free<br />
System::Free $1<br />
# print<br />
DetailPrint &quot;Structure size: $2 bytes&quot;<br />
DetailPrint &quot;Memory load: $3%&quot;<br />
DetailPrint &quot;Total physical memory: $4 bytes&quot;<br />
DetailPrint &quot;Free physical memory: $5 bytes&quot;<br />
DetailPrint &quot;Total page file: $6 bytes&quot;<br />
DetailPrint &quot;Free page file: $7 bytes&quot;<br />
DetailPrint &quot;Total virtual: $8 bytes&quot;<br />
DetailPrint &quot;Free virtual: $9 bytes&quot;<br />
<br />
And this is what I get for returned:<br />
<br />
Structure size: 0 bytes<br />
Memory load: 0%<br />
Total physical memory: 0 bytes<br />
Free physical memory: 0 bytes<br />
Total page file: 0 bytes<br />
Free page file: 0 bytes<br />
Total virtual: 0 bytes<br />
Free virtual: 0 bytes<br />
Completed<br />
<br />
Is it might have to do what datatypes it is?  I'd tried with different datatypes such as l-large int, t-string, etc.<br />
<br />
--Vinnie</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th April 2006, 15:36</div></div><div class="posttext">Most of the values in MEMORYSTATUSEX are 64-bit unsigned integers. You should use 'l' instead of 'i' in the System plug-in call. You should also allocate more space as the structure is bigger and initialize the first member of the structure with its size.# allocate<br />
System::Alloc 64<br />
Pop $1<br />
# init<br />
System::Call &quot;*$1(i64)&quot;<br />
# call<br />
System::Call &quot;Kernel32::GlobalMemoryStatusEx(i r1)&quot;<br />
# get<br />
System::Call &quot;*$1(i.r2, i.r3, l.r4, l.r5, l.r6, l.r7, l.r8, l.r9, l.r10)&quot;<br />
# free<br />
System::Free $1<br />
# print<br />
DetailPrint &quot;Structure size: $2 bytes&quot;<br />
DetailPrint &quot;Memory load: $3%&quot;<br />
DetailPrint &quot;Total physical memory: $4 bytes&quot;<br />
DetailPrint &quot;Free physical memory: $5 bytes&quot;<br />
DetailPrint &quot;Total page file: $6 bytes&quot;<br />
DetailPrint &quot;Free page file: $7 bytes&quot;<br />
DetailPrint &quot;Total virtual: $8 bytes&quot;<br />
DetailPrint &quot;Free virtual: $9 bytes&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">4th April 2006, 15:44</div></div><div class="posttext">Thank You Very Much Kichik.  You are the GOD.  This worksssssss (well, at least on my box :) ).  Let me go try it on the other system.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">4th April 2006, 19:01</div></div><div class="posttext">How can I convert the Total Physical Memory which is in bytes to Mbytes?<br />
<br />
I tried &quot;IntOp $4 $4 / 1048576 but it is returning 0.<br />
<br />
I guess IntOp can only handle so much.  Is there another way to convert?<br />
<br />
Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">4th April 2006, 19:02</div></div><div class="posttext">System::Int64Op $4 / 1048576<br />
Pop $4</div></div><hr />


<div class="post"><div class="posttop"><div class="username">vinnietran</div><div class="date">4th April 2006, 19:11</div></div><div class="posttext">Thanks.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>