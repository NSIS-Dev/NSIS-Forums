<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS 3.0a0, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS 3.0a0 NSIS Discussion" />
	
	<title> NSIS 3.0a0 [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS 3.0a0</div>
<hr />
<div class="pda"><a href="t-361808.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=361808">NSIS 3.0a0</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th May 2013, 02:28</div></div><div class="posttext">Yep. It's finally here.<br />
<br />
Get your download at the usual place:<br />
<br />
http://nsis.sourceforge.net/Download<br />
<br />
Among many bug fixes and new features, the biggest one is probably Jim Park's Unicode. Wizou and Anders have merged it back to the main version and it's now available as an optional Unicode true command. So thank you Jim, thank you Wizou for merging it back in and thank you Anders for wrapping it all up and making sure NSIS 3 happens.<br />
<br />
Next on plan is fixing whatever we broke (like linux build) and x64 by David Golub (partially already available in SVN (http://nsis.svn.sf.net/viewvc/nsis/NSIS/branches/WIN64/) and on David's BitBucket (https://bitbucket.org/dgolub/nsis64)).<br />
<br />
Please let us know of any broken parts of loose screws :)<br />
<br />
P.S.<br />
<br />
Check out our Twitter feed (https://twitter.com/nsis_tweets) by Yathosho.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">20th May 2013, 08:39</div></div><div class="posttext">Absolutely awesome! Many thanks to the NSIS team for putting in so many hours, and congratulations for reaching this important milestone. I'm hoping to go play with it soon!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">20th May 2013, 10:06</div></div><div class="posttext">Awesoooooooooome!!!<br />
<br />
Quick question for plug-ins: all old plug-ins are now automatically treated as x86, aren't they?<br />
<br />
Second question: Is .chm manual working for you correctly?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">aerDNA</div><div class="date">20th May 2013, 10:43</div></div><div class="posttext">I'm an eternal optimist but I admit I was worried we'd seen the last major build, as the project really seemed to be losing momentum. I love NSIS, this is frelling great news! Thank you devs for all your work! :up:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TaleTN</div><div class="date">20th May 2013, 10:44</div></div><div class="posttext">Cool, thanks! :)<br />
<br />
I have just quickly tried 3.0a0, and a simple project compiled, but another, somewhat larger one wouldn't because !searchparse and !searchreplace failed. I then reinstalled 2.46, and then the project compiles just fine, so it would seem !searchparse and !searchreplace are broken.<br />
<br />
!searchparse error:<br />
!searchparse: starting string &quot;#define VERSIONINFO_VERSION    &quot; not found in file!<br />
<br />
Failing NSIS source code line:<br />
!searchparse /file ../resource.h '#define VERSIONINFO_VERSION    ' VER_MAJR ',' VER_MN ',' VER_BG ','<br />
<br />
Relevant line from ../resource.h:<br />
#define VERSIONINFO_VERSION    1,3,0,0 // 1.3.0<br />
<br />
!searchreplace error:<br />
Usage: !searchreplace [/ignorecase] output_name source_string substring replacestring<br />
<br />
Failing NSIS source code line:<br />
!searchreplace VER_FN &quot;${VER_STR}&quot; &quot;.&quot; &quot;&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">20th May 2013, 12:57</div></div><div class="posttext">Quick question for plug-ins: all old plug-ins are now automatically treated as x86, aren't they?<br />
<br />
If you mean Ansi vs Unicode then yes, everything starts out as Ansi but NSIS\Plugins\*.dll is not searched anymore, you would have to move them into the correct subdirectory...<br />
<br />
<br />
Second question: Is .chm manual working for you correctly?<br />
What do you mean?<br />
<br />
<br />
<br />
I have just quickly tried 3.0a0, and a simple project compiled, but another, somewhat larger one wouldn't because !searchparse and !searchreplace failed. I then reinstalled 2.46, and then the project compiles just fine, so it would seem !searchparse and !searchreplace are broken.<br />
<br />
They are stricter in what they accept but it is of course possible that there is a bug in the new code.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">20th May 2013, 15:19</div></div><div class="posttext">Hmm I cannot edit my previous post so I am adding found issues here, most of them are from manual:<br />
<br />
UnsafeStrCpy command is not documented (however I suppose the same behaviour as StrCpy)<br />
<br />
The 'new' ReserveFile explanation is very vague: Plugins in ${NSISDIR}\Plugins have to be reserved with ReserveFile /plugin<br />
<br />
<br />
Maybe it is better to say &quot;use /plugin switch anytime you use ReserveFile for reserving the .dll file&quot;.<br />
Also plug-ins are now stored in ${NSISDIR}\Plugins\&lt;architecture&gt;-&lt;Charset&gt; so this may be confusing for users.<br />
<br />
And again thanks for the great work!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">20th May 2013, 15:33</div></div><div class="posttext">Great work!<br />
<br />
Maybe it is a good idea to copy already installed plugin's from a NSIS 2.x installation to the new plugin location (at least the ansi plugin's) in the NSIS installer?<br />
<br />
jpderuiter</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TaleTN</div><div class="date">20th May 2013, 19:20</div></div><div class="posttext">They are stricter in what they accept but it is of course possible that there is a bug in the new code.<br />
Then I guess there is a bug in the !searchparse code, because I have this very simple text file (meh.h):<br />
<br />
#define APP_VERSION 1,2,3<br />
#define LONG_VERSION 1,2,3,4<br />
<br />
Which I fails to parse correctly with this equally simple NSIS script:<br />
<br />
!searchparse /file meh.h `#define APP_VERSION ` VER_MAJOR `,` VER_MINOR `,`<br />
# Bug: Found &quot;#define APP_VERSION 1,2,&quot;, so VER_MAJOR should be &quot;1&quot; and<br />
# VER_MINOR &quot;2&quot;. However, VER_MINOR is &quot;2,3&quot;.<br />
<br />
!searchparse /file meh.h `#define LONG_VERSION ` LONG_MAJOR `,` LONG_MINOR `,` LONG_BG `,`<br />
# Bug: Should have found &quot;#define LONG_VERSION 1,2,3,&quot;, but instead says<br />
# &quot;#define LONG_VERSION &quot; not found.<br />
<br />
Name &quot;meh ${VER_MAJOR}.${VER_MINOR} (${LONG_MAJOR}.${LONG_MINOR}.${LONG_BG})&quot;<br />
OutFile &quot;meh.exe&quot;<br />
Section<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">20th May 2013, 22:49</div></div><div class="posttext">didn't think i'd live to see this, good job everybody!<br />
<br />
i'm glad that the anchors for commands in the html help finally changed from chapters to something more readable. would've been better though to use the literal command names - #StrCpy rather than #strcpy, #!ifdef rather than #if. i can think of several scenarios where this could be come useful, for instance a command lookup from an editor.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">21st May 2013, 04:12</div></div><div class="posttext">Great work!!!!!!!!!!!!!!!!<br />
<br />
Maybe able to upgrade LZMA(LZMA2)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">21st May 2013, 08:44</div></div><div class="posttext">Maybe able to upgrade LZMA(LZMA2)?<br />
<br />
there has been a discussion (http://forums.winamp.com/showthread.php?t=326288&amp;highlight=lzma2) about that</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">21st May 2013, 09:26</div></div><div class="posttext">there has been a discussion (http://forums.winamp.com/showthread.php?t=326288&amp;highlight=lzma2) about that<br />
<br />
Thank you.<br />
Compression code does look outdated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">21st May 2013, 20:37</div></div><div class="posttext">I think I fixed searchparse<br />
<br />
<br />
!searchreplace error:<br />
Usage: !searchreplace [/ignorecase] output_name source_string substring replacestring<br />
<br />
Failing NSIS source code line:<br />
!searchreplace VER_FN &quot;${VER_STR}&quot; &quot;.&quot; &quot;&quot;<br />
<br />
<br />
!define VER_STR a.b.c.d<br />
!searchreplace VER_FN &quot;${VER_STR}&quot; &quot;.&quot; &quot;&quot;<br />
!warning &quot;|${VER_FN}|&quot;<br />
<br />
gives me:<br />
<br />
!searchreplace: &quot;VER_FN&quot;=&quot;abcd&quot;<br />
warning: !warning: |abcd| (test.nsi:22)<br />
<br />
so you need to provide a full example that actually fails for me to fix this</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Theresias</div><div class="date">21st May 2013, 22:31</div></div><div class="posttext">Very much appreciated folks, keep up the good work!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TaleTN</div><div class="date">22nd May 2013, 10:43</div></div><div class="posttext">so you need to provide a full example that actually fails for me to fix this<br />
Here you go:<br />
<br />
meh.h:<br />
#define VERSIONINFO_STR &quot;1.3.0&quot;<br />
<br />
meh.nsi:<br />
# Sets VER_STR to &quot;1.3.0&quot;.<br />
!searchparse /file meh.h '#define VERSIONINFO_STR &quot;' VER_STR '&quot;'<br />
<br />
# VER_FN should be &quot;130&quot;, but returns usage error instead.<br />
!searchreplace VER_FN &quot;${VER_STR}&quot; &quot;.&quot; &quot;&quot;<br />
<br />
Name &quot;meh&quot;<br />
OutFile &quot;meh.exe&quot;<br />
Section<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">T.Slappy</div><div class="date">22nd May 2013, 13:40</div></div><div class="posttext">After a short work with NSIS 3 I noticed my favourite feature is still not implemented:<br />
<br />
Var /GLOBAL myVariable &quot;initial value&quot;<br />
<br />
<br />
I think this is often used: &quot;initial value&quot; could be optional parameter.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">22nd May 2013, 21:10</div></div><div class="posttext">After a short work with NSIS 3 I noticed my favourite feature is still not implemented:Var /GLOBAL myVariable &quot;initial value&quot;<br />
I think this is often used: &quot;initial value&quot; could be optional parameter.<br />
<br />
I believe there is a feature request for Var Foo, Bar, Baz but I don't think we found a good syntax to express this, /GLOBAL makes things confusing etc. <br />
<br />
Setting an initial value is probably not going to happen, NSIS currently uses a PE section trick to allocate the variables with no code at runtime. If you want this feature so bad you can just use a macro in .onInit...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">23rd May 2013, 06:04</div></div><div class="posttext">Congrats on finally moving up to version 3 alpha!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">24th May 2013, 14:05</div></div><div class="posttext">Very good to have it all in one place. I like also the streamlining since 2.46. Math.dll -- much smaller. Thanks. :)<br />
<br />
I found a minor problem. (I hope minor.)<br />
<br />
${NSIS_CHAR_SIZE} is always 1.<br />
<br />
So,<br />
<br />
!if &quot;${NSIS_CHAR_SIZE}&quot; = 2<br />
  Unicode true<br />
!endif<br />
<br />
does not work.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">24th May 2013, 14:21</div></div><div class="posttext">Here you go:<br />
<br />
<br />
With !searchparse fixed I get 130 as the result...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">24th May 2013, 14:22</div></div><div class="posttext">${NSIS_CHAR_SIZE} is always 1.<br />
<br />
<br />
This is by design, ${NSIS_CHAR_SIZE} is mainly for code that interacts with the system plugin. ${NSIS_CHAR_SIZE} changes after &quot;Unicode true&quot;...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">TaleTN</div><div class="date">24th May 2013, 15:41</div></div><div class="posttext">With !searchparse fixed I get 130 as the result...<br />
Yay, great! :up: I guess there was nothing wrong with !searchreplace then, but it was also caused by a bug in !searchparse?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">24th May 2013, 16:28</div></div><div class="posttext">${NSIS_CHAR_SIZE} changes after &quot;Unicode true&quot;...<br />
I should have tried it first. It isn't a problem, only different. Thanks.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">24th May 2013, 20:49</div></div><div class="posttext">there's always a warning when a script contains ${NSIS_VERSION}, i guess it doesn't like the &quot;a&quot; in v3.0a0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">25th May 2013, 01:05</div></div><div class="posttext">there's always a warning when a script contains ${NSIS_VERSION}, i guess it doesn't like the &quot;a&quot; in v3.0a0<br />
<br />
Please post code examples and compiler warnings when reporting issues...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">25th May 2013, 10:35</div></div><div class="posttext">Please post code examples and compiler warnings when reporting issues...<br />
<br />
!if ${NSIS_VERSION} &lt; &quot;v3.0&quot;<br />
!endif<br />
<br />
will produce<br />
<br />
1 warning:<br />
  Invalid number: &quot;v3.0a0&quot; (C:\Users\jan\Desktop\test.nsi:1)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th May 2013, 17:17</div></div><div class="posttext">That warning is because it can't parse &quot;v3.0a0&quot; (or &quot;v3.0&quot;) as an integer because it isn't.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">25th May 2013, 18:07</div></div><div class="posttext">!if ${NSIS_VERSION} &lt; &quot;v3.0&quot;<br />
!endif<br />
<br />
<br />
Like Afrow UK said, it gives you a warning because it failed to parse the input as a number. The warning is new but it will fail to parse under 2.46 as well.<br />
<br />
!undef NSIS_VERSION<br />
!define NSIS_VERSION &quot;v3.0&quot; ;a0&quot;<br />
!if ${NSIS_VERSION} &lt; v4.0<br />
!warning &quot;${NSIS_VERSION} &lt;&quot;<br />
!else<br />
!warning &quot;${NSIS_VERSION} &gt;=&quot;<br />
!endif<br />
<br />
You probably want something like:<br />
<br />
!if &quot;${NSIS_PACKEDVERSION}&quot; &gt; 0x2046000<br />
Unicode True<br />
!else<br />
!if &quot;${NSIS_CHAR_SIZE}&quot; &lt; 2 ; This takes care of the Unicode fork?<br />
!warning &quot;Unicode not supported, creating ANSI installer&quot;<br />
!endif<br />
!endif<br />
<br />
<br />
When comparing NSIS_PACKEDVERSION you should check against the last version that did not have the feature you are after, if you do it this way you should be compatible all the way back to v2.15. If you do it the other way with !if ${NSIS_PACKEDVERSION} &gt;= 0x3000000 it will be parsed as 0 &gt;= 0 (true) on older versions!<br />
<br />
It is important to note that unofficial svn builds might not set NSIS_VERSION nor NSIS_PACKEDVERSION at all.<br />
<br />
<br />
!if 0x2046000 &gt;= &quot;${NSIS_PACKEDVERSION}&quot;<br />
!error &quot;You need NSISv3+&quot;<br />
!endif<br />
;Or<br />
!if ! &quot;${NSIS_PACKEDVERSION}&quot; &gt; 0x2046000<br />
!error &quot;You need NSISv3+&quot;<br />
!endif<br />
<br />
I'm not sure what the fork will do in the future, you might even want to use !if ! &quot;${NSIS_PACKEDVERSION}&quot; &gt; 0x2999999<br />
<br />
<br />
 The ${NSIS_VERSION} constant was first introduced in 2.0b4 (http://forums.winamp.com/showthread.php?t=284486)<br />
 !if was added in 2.15 (http://forums.winamp.com/showpost.php?p=1879369&amp;postcount=10)<br />
 NSIS_PACKEDVERSION and hex number parsing (!if) was added after 2.46 IIRC<br />
<br />
<br />
The format of NSIS_VERSION was never set in stone, v3.4.5 would be a legal version and there can be a letter or word suffix etc...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Redo89</div><div class="date">29th May 2013, 18:20</div></div><div class="posttext">Respected developers!<br />
Please, make possibility of translation of the text for &quot;NSIS Error&quot;.<br />
It always in English.... Add opportunity to change the text of this error.<br />
thanks.<br />
<br />
http://i48.tinypic.com/2vljpc8.png</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">29th May 2013, 21:29</div></div><div class="posttext">Please, make possibility of translation of the text for &quot;NSIS Error&quot;.<br />
It always in English.... Add opportunity to change the text of this error.<br />
thanks.<br />
This has been asked before, this string is used before translations have been loaded. If you want to change the string, use a hex editor...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Redo89</div><div class="date">30th May 2013, 22:43</div></div><div class="posttext">what file to edit hex editor? the compiled installer? It will cause CRC error!<br />
I don't want to disable CRC check<br />
<br />
And you are right, about this problem many times wrote. I don't understand why developers can't add opportunity to change this message...<br />
<br />
Sorry for bad English!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">31st May 2013, 09:56</div></div><div class="posttext">in need some advice on how to best debug an installer generated with this alpha version. i have one installer that produces problems: it compiles, but upon running it crashes with no error message whatsoever. i commented out all used plugins (MoreInfo, System and ToolTips) and even the custom UI it uses - no success. a look at process monitor shows a couple of errors/warnings (NAME COLLISION, FILE LOCKED WITH ONLY READERS, FAST IO DISALLOWED and BUFFER OVERFLOW). the installer quits with error code -1073741819 (and google doesn't know about that).  i checked with the last working version and it produces the same results in process monitor, but the installer works as desired.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st May 2013, 17:07</div></div><div class="posttext">in need some advice on how to best debug an installer generated with this alpha version. i have one installer that produces problems: it compiles, but upon running it crashes with no error message whatsoever. i commented out all used plugins (MoreInfo, System and ToolTips) and even the custom UI it uses - no success. a look at process monitor shows a couple of errors/warnings (NAME COLLISION, FILE LOCKED WITH ONLY READERS, FAST IO DISALLOWED and BUFFER OVERFLOW). the installer quits with error code -1073741819 (and google doesn't know about that).  i checked with the last working version and it produces the same results in process monitor, but the installer works as desired.<br />
<br />
Can you create a minimal sample with the same issue? Does MessageBox in .onInit work? Unicode/Ansi?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">31st May 2013, 20:48</div></div><div class="posttext">Can you create a minimal sample with the same issue? Does MessageBox in .onInit work? Unicode/Ansi?<br />
<br />
okay, thanks to your advise i could narrow down the problem<br />
<br />
1. it works when i compile an ansi version<br />
<br />
2. when i compile a unicode version, this segment is causing the problem:<br />
	${If} ${AtLeastWin2000}<br />
		StrCpy &quot;$settingsINI&quot; &quot;$APPDATA\RunWithParameters\settings.ini&quot;<br />
		StrCpy &quot;$historyINI&quot; &quot;$APPDATA\RunWithParameters\history.ini&quot;<br />
		StrCpy &quot;$defaultsINI&quot; &quot;$APPDATA\RunWithParameters\defaults.ini&quot;<br />
		IfFileExists &quot;$APPDATA\RunWithParameters\mydefaults.ini&quot; 0 +2<br />
		StrCpy &quot;$mydefaultsINI&quot; &quot;$APPDATA\RunWithParameters\mydefaults.ini&quot;<br />
	${ElseIf} ${AtMostWinME}<br />
		StrCpy &quot;$settingsINI&quot; &quot;$EXEDIR\settings.ini&quot;<br />
		StrCpy &quot;$historyINI&quot; &quot;$EXEDIR\history.ini&quot;<br />
		StrCpy &quot;$defaultsINI&quot; &quot;$EXEDIR\defaults.ini&quot;<br />
		IfFileExists &quot;$EXEDIR\mydefaults.ini&quot; 0 +2<br />
		StrCpy &quot;$mydefaultsINI&quot; &quot;$EXEDIR\mydefaults.ini&quot;<br />
	${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st May 2013, 23:09</div></div><div class="posttext">2. when i compile a unicode version, this segment is causing the problem:<br />
<br />
Does not crash for me (tested in a section), please provide a full .nsi<br />
<br />
As far as the code goes, what about NT4?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">31st May 2013, 23:24</div></div><div class="posttext">Does not crash for me (tested in a section), please provide a full .nsi<br />
<br />
see attachment, should include everything to compile<br />
<br />
As far as the code goes, what about NT4?<br />
<br />
good point, thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">1st June 2013, 02:56</div></div><div class="posttext">see attachment, should include everything to compile<br />
<br />
<br />
My guess is that the crash is in nsArray, please provide sample code that does not use 3rd-party plugins if you want me to investigate further...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">1st June 2013, 08:28</div></div><div class="posttext">My guess is that the crash is in nsArray, please provide sample code that does not use 3rd-party plugins if you want me to investigate further...<br />
<br />
as i said before, i already tried and commented out all plugins and the ui - to no success</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">1st June 2013, 14:52</div></div><div class="posttext">By using Messageboxes you can narrow it down to the ForEachIn loop in line 318.<br />
<br />
I don't know nsArray, but are you allowed to use StrCpy with it (line 304, 310 and 314)?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">1st June 2013, 15:24</div></div><div class="posttext">i'm getting the same problem with this simple script<br />
<br />
; Settings ---------------------------------<br />
OutFile &quot;installer_name.exe&quot;<br />
RequestExecutionLevel user<br />
Unicode true<br />
!include LogicLib.nsh<br />
!include WinVer.nsh<br />
; Pages ------------------------------------<br />
Page instfiles<br />
; Sections ---------------------------------<br />
Section &quot;section_name&quot;<br />
	Quit<br />
SectionEnd<br />
; Functions --------------------------------<br />
Function .onInit<br />
	${If} ${AtLeastWin2000}<br />
		MessageBox MB_OK &quot;${__LINE__}&quot;<br />
	${EndIf}<br />
FunctionEnd<br />
<br />
seems only to happen on my main windows installation (windows 7 with all patches). works just fine in a vm with windows 2003, on virtualized windows 7 i get as far as the messagebox before the program terminates with an error message (see attachment).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">1st June 2013, 15:58</div></div><div class="posttext">As said in my previous post, I get a crash on your script with nsArray, which you are mixing with StrCpy.<br />
<br />
For the Kernelbase.dll error:<br />
http://answers.microsoft.com/en-us/windows/forum/windows_7-performance/programs-crash-error-fault-module-kernelbasedll/9fe5d2e7-79d0-42c1-b8dc-51ed8d70f749</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st June 2013, 16:45</div></div><div class="posttext">Working on the crash now. It appears to be coming from nsArray.<br />
<br />
I don't know nsArray, but are you allowed to use StrCpy with it (line 304, 310 and 314)?I very much doubt that this would cause a crash - the value passed to the plug-in at run time should be no different when passing it via a variable or a hard coded string.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">1st June 2013, 17:48</div></div><div class="posttext">As said in my previous post, I get a crash on your script with nsArray, which you are mixing with StrCpy<br />
<br />
the executable runs fine when i comment out the first if-statement in onInit, also the ansi version never caused any problems.<br />
<br />
i think the bug is caused by WinVer.nsh. when i comment its line 197, my compiled executable does not crash. this is the line:<br />
System::Call kernel32::GetVersionEx(pr0)i.r3</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st June 2013, 18:07</div></div><div class="posttext">The last example doesn't crash for me either. Can you maybe attach the compiled installer too?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">1st June 2013, 19:21</div></div><div class="posttext">...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">1st June 2013, 19:40</div></div><div class="posttext">Sorry, my crashes happen because I commented out onGUIInit, because I wanted to test it without parameters.<br />
<br />
Yatosho, does your script crash when using /help as parameter?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st June 2013, 19:52</div></div><div class="posttext">Fixed the memory access violation in nsArray which occurred in the ForEachIn loop (nsArray::Iterate). I tested by running with /install and then running subsequent debugging executions with the default INI file as an argument. I don't get any crashes now.<br />
<br />
Edit: I should mention the crash came about because an invalid array name is being used in your ForEachIn loop - it resulted in a NULL pointer in the plug-in and subsequent violation where validation was missing. This should not be an issue now.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">2nd June 2013, 11:07</div></div><div class="posttext">The last example doesn't crash for me either. Can you maybe attach the compiled installer too?<br />
<br />
attached<br />
<br />
Yatosho, does your script crash when using /help as parameter?[/QUOTE]<br />
<br />
yes</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">2nd June 2013, 11:12</div></div><div class="posttext">ok, i did some more testing as getting different results on different windows installations seemed strange. computer is virus free, so i renamed my old nsis directory (i installed nsis 3 over nsis 2) and did a clean install of 3.0a. now everything compiles and runs fine. still find it a bit weird (ANSI worked, WinVer seems to have caused this), but for me it's sorted. thanks for all advice.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bnicer</div><div class="date">2nd June 2013, 13:55</div></div><div class="posttext">I had problem with an installer, where ANSI worked as opposed to UNICODE, that was caused by WinVer. The installer didn't crash, but the ${If} ${AtLeastWin'X'} conditions failed, UNICODE. Though, unlike in Yathosho's example, my script had a mistake. I was including WinVer.nsh before I declared Unicode true/false.<br />
<br />
I thought of posting this earlier in response to Yathosho, but it didn't seem related. Maybe it is (worth looking into)? If the Unicode true declaration comes after an included file, a compiler error message would be in order, even though it's an avoidable mistake. I wonder as well if it should be necessary to declare Unicode when the script file is encoded in UNICODE. Make Unicode an optional command?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">2nd June 2013, 17:18</div></div><div class="posttext">Thanks Yathosho and bnicer for tracking this down.<br />
<br />
The compiler should abort if you use a plugin before switching unicode mode but WinVer does some size calculations when you include it and those are later passed to System::Call, I'll try to come up with a fix for this...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">mariusnegrutiu</div><div class="date">3rd June 2013, 09:55</div></div><div class="posttext">I'm trying to digitally sign the installer using the new !finalize command.<br />
Everything works well as long as I don't use &quot;%1&quot; in the command line. If &quot;%1&quot; is used, makensis.exe crashes...<br />
<br />
My code goes like this:<br />
!finalize '&quot;${__FILEDIR__}\SignTool.exe&quot; sign /s MY_CERTSTORE /t &quot;http://timestamp.globalsign.com/scripts/timstamp.dll&quot; /d &quot;Description&quot; /du &quot;http://www.blahblah.com&quot; /v &quot;%1&quot;'<br />
<br />
Btw, congratulations for reviving NSIS!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th June 2013, 20:35</div></div><div class="posttext">WinVer (http://nsis.svn.sourceforge.net/viewvc/nsis/NSIS/trunk/Include/WinVer.nsh?view=markup&amp;pathrev=6372) should be a able to deal with switching modes now but it really is best if the unicode mode is set before files are !included<br />
<br />
<br />
Everything works well as long as I don't use &quot;%1&quot; in the command line. If &quot;%1&quot; is used, makensis.exe crashes...<br />
Fixed...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">extremecarver</div><div class="date">6th June 2013, 19:49</div></div><div class="posttext">Is there filesize &gt;2GB support in 3.0a?<br />
Or will it come with x64 branch?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">6th June 2013, 20:04</div></div><div class="posttext">Is there filesize &gt;2GB support in 3.0a?<br />
Or will it come with x64 branch?<br />
<br />
No and I'm guessing no, the top bit is already used to store data...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">extremecarver</div><div class="date">11th June 2013, 14:33</div></div><div class="posttext">thanks for the answer. Well then I hope it will be changed/enabled after x64 intregration sometimes. It would be much better than having the installer call external .zip/7z files (which on top can only be bzip/lzma and not lzma2) to unpack because they don't fit into the 2GB limit.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">yoachan</div><div class="date">14th June 2013, 03:51</div></div><div class="posttext">Just want to say thank you for everyone's work. :)<br />
<br />
BTW can I use/install both NSIS 2 and NSIS 3 in one PC?<br />
Would like my project to keep running and be able to test NSIS 3 to tell if I found a bug.<br />
So amazing that NSIS 3 exist. Even NSIS 2 is already amaze me. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">14th June 2013, 08:02</div></div><div class="posttext">BTW can I use/install both NSIS 2 and NSIS 3 in one PC?<br />
Would like my project to keep running and be able to test NSIS 3 to tell if I found a bug.<br />
So amazing that NSIS 3 exist. Even NSIS 2 is already amaze me. :)<br />
<br />
The startmenu and add/remove programs entries will be taken over, other than that it should not be a problem. Makensis itself does not depend on any kind of system configuration...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">9th July 2013, 10:28</div></div><div class="posttext">are there plans to move the examples (and maybe includes) to the user space? on any modern windows version, the examples won't compile due to lack of privileges. just saying.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th July 2013, 13:10</div></div><div class="posttext">are there plans to move the examples (and maybe includes) to the user space? on any modern windows version, the examples won't compile due to lack of privileges. just saying.<br />
<br />
Probably not, who would do the copy to $appdata, MakeNSISw?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">9th July 2013, 13:44</div></div><div class="posttext">Probably not, who would do the copy to $appdata, MakeNSISw?<br />
<br />
the installer, of course!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">9th July 2013, 14:36</div></div><div class="posttext">Yes, on Windows 8 you have to run MakeNSISw as an administrator (even with UAC disabled) otherwise it cannot build the example scripts (cannot open output file). Your best bet is just to move the NSIS install directory and change the registry value (or install to AppData).<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th July 2013, 14:58</div></div><div class="posttext">the installer, of course!<br />
<br />
No, the installer cannot do that, UAC gets in the way (Wrong user) and does not work for other users on the same machine.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">9th July 2013, 16:01</div></div><div class="posttext">considering that nsis 3.0 is a new major release, i guess it's forgivable to demand a clean install from the user (or offer optional migration). then again, i don't see any harm in allowing both app data and program files, even at the same time (app data would override program files, and program files would serve as fallback.) as a side effect, that would allow different users using different nsis setups, though admittedly that's a small target audience.<br />
<br />
one thing is clear: the current situation can be annoying. nobody wants to move scripts all the time or edit the outfile location. a compiler asking for elevation would be equally annoying.<br />
<br />
also, must i remind you how often you have advised users to keep data and program files separate? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th July 2013, 16:13</div></div><div class="posttext">also, must i remind you how often you have advised users to keep data and program files separate? :)<br />
Do as I say, not as I(We) do :)<br />
<br />
I have a rewritten version of the installer that allows per-user installs, not sure if we will adopt it though...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>