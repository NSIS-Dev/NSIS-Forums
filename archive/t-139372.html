<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS or Me?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS or Me? NSIS Discussion" />
	
	<title> NSIS or Me? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS or Me?</div>
<hr />
<div class="pda"><a href="t-139372.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=139372">NSIS or Me?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">tardo0807</div><div class="date">18th June 2003, 01:49</div></div><div class="posttext">One of us is not getting it and I think it's me...<br />
<br />
basically I have a simple function to check if the program being installed has been uninstalled from the same machine. On uninstall, a key is left behind that the installer will check for every time it runs.<br />
<br />
The function works correctly for the first install. I get the messagebox that has a blank value for $R0 when it reaches &quot;done:&quot; which it should since nothing has been uninstalled as of yet.<br />
<br />
The problem is that it also continues to work after the program has been uninstalled. When I install again, it skips the &quot;$R0 inside&quot; messagebox and shows the string value of &quot;un&quot; ( which is correct ) for &quot;$R0&quot; in the messagebox after &quot;done:&quot;. <br />
<br />
I'm thinking that if the installer can see the key and copy the value, there shouldn't be an error and the program should abort.<br />
<br />
The registry key is definitely in place after the uninstall.<br />
<br />
Function checkForUninstall<br />
<br />
   ReadRegStr $R0 HKLM &quot;SOFTWARE\legacy&quot; &quot;name&quot;<br />
   IfErrors done<br />
<br />
   MessageBox MB_OK|MB_ICONINFORMATION &quot;$R0 inside&quot;<br />
       Abort<br />
<br />
   done:<br />
      MessageBox MB_OK|MB_ICONINFORMATION &quot;$R0 pass&quot;<br />
<br />
FunctionEnd<br />
<br />
I also tried it this way with a similar outcome:<br />
<br />
Function checkForUninstall<br />
<br />
   ReadRegStr $R0 HKLM &quot;SOFTWARE\legacy&quot; &quot;name&quot;<br />
   IfErrors done bad<br />
<br />
   bad:<br />
      MessageBox MB_OK|MB_ICONINFORMATION &quot;$R0 inside&quot;<br />
      Abort<br />
<br />
   done:<br />
      MessageBox MB_OK|MB_ICONINFORMATION &quot;$R0 pass&quot;<br />
<br />
FunctionEnd<br />
<br />
Usually this means I'm missing something so simple that it will be painfully obvious to a second set of more savvy NSIS eyes, many thanks for any help<br />
<br />
jonny</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Sunjammer</div><div class="date">18th June 2003, 08:32</div></div><div class="posttext">I tried your function and if the registry key existed (I made it manually using regedit) then the script works fine. See attached script that I tested.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tardo0807</div><div class="date">18th June 2003, 13:47</div></div><div class="posttext">Thanks sunjammer, <br />
I thought I was going nuts because when I isolate the function it does work. What seems to be happening is that another function is causing it not to work properly even though they are not related functions. This code works in my real program when I comment out the function to check for any current installations of the product, but when I reactivate that function this one decides not to work. I'm going to try a few things with the sequence of events to see if that helps, but I appreciate your input.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">18th June 2003, 14:41</div></div><div class="posttext">The other function is probably causing an error and doesn't clear it. Use ClearErrors before the code block that you wish to check for errors.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tardo0807</div><div class="date">18th June 2003, 15:07</div></div><div class="posttext">Thanks Kichik,<br />
<br />
Using ClearErrors did it. I now have a very happy installer that works as it should...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>