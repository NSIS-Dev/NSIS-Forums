<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Run script during uninstall, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Run script during uninstall NSIS Discussion" />
	
	<title> Run script during uninstall [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Run script during uninstall</div>
<hr />
<div class="pda"><a href="t-226069.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=226069">Run script during uninstall</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ewallig</div><div class="date">15th September 2005, 15:49</div></div><div class="posttext">Hi, <br />
Using NSIS to package a home-grown app. This app allows users to add different &quot;profiles&quot; after the initial installation. The process of creating the profiles is not NSIS-related (homespun, HTA-based &quot;profile creator&quot; that can be run at any time) and creates a different desktop icon for each profile. <br />
<br />
During an uninstall, I need to be able to remove all of the desktop icons that are created by the use of the profile creator but since the icons are not referenced in the uninstaller, the NSIS uninstall process leaves them behind (as expected).<br />
<br />
I'd like to run a script during uninstall that searches for and deletes the desktop icons for this app - looking for some guidance on this idea...<br />
<br />
Thanks, killer product by the way!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">15th September 2005, 18:26</div></div><div class="posttext">Use Exec if you already have a script.<br />
You can only delete the shortcuts if they have a fixed prefix or name style. There are no API's that I am aware of that allow you to read the target path for shortcuts.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">15th September 2005, 18:38</div></div><div class="posttext">You can probably do it using the System dll.<br />
Here (http://msdn.microsoft.com/library/en-us/shellcc/platform/shell/programmersguide/shell_int/shell_int_programming/shortcuts/shortcut.asp)   is a MSDN example for working with shortcuts.<br />
If you known in which directory the shortcuts are being created, you can use the FindFirst and FindNext functions to find all files with the .lnk extension. Then you can use the API to check the path of the shortcut target.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">15th September 2005, 23:23</div></div><div class="posttext">read the target path for shortcutsThis plugin might help:<br />
<br />
http://nsis.sourceforge.net/wiki/ShellLink_plugin</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ewallig</div><div class="date">16th September 2005, 12:36</div></div><div class="posttext">Thanks for all of the responses - <br />
<br />
I have a simple script to remove the desktop shortcuts (vbs) as they follow a standard naming pattern. I just need an example on how to run the script during an uninstall.<br />
<br />
<br />
Thanks...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th September 2005, 14:20</div></div><div class="posttext">You will probably need to use ExecShell open &quot;file.vb&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ewallig</div><div class="date">16th September 2005, 14:29</div></div><div class="posttext">Would I put the ExecShell command within the uninstaller section or elsewhere?<br />
<br />
<br />
Thanks...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">16th September 2005, 16:18</div></div><div class="posttext">Well, yes.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ewallig</div><div class="date">16th September 2005, 16:35</div></div><div class="posttext">ok, I guess that was a stupid question - I'll give it a try and get back if I have problems.<br />
<br />
Thanks again....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ewallig</div><div class="date">16th September 2005, 20:02</div></div><div class="posttext">Hi again,<br />
<br />
Ok, I tried to run the script using ExecShell - didn't have any luck running a .vbs file. I tried both directly running the file:<br />
<br />
ExecShell open &quot;$INSTDIR\killDesktopIcons.vbs&quot;<br />
 - nothing happens<br />
<br />
...and tried calling the scripting host like this...<br />
<br />
ExecShell open &quot;$SYSDIR\wscript.exe&quot; &quot;$INSTDIR\killDesktopIcons.vbs&quot;<br />
 - nothing happens<br />
<br />
...and this..<br />
<br />
ExecShell open &quot;$SYSDIR\wscript.exe&quot; &quot;&quot;&quot;$INSTDIR\killDesktopIcons.vbs&quot;&quot;&quot;<br />
 - error during compliation.<br />
<br />
It's not a real big problem at the moment as I was able to wrap the script in an .exe file (runs fine now) but I may have to run scripts in the future so if you have some insight on this it would be helpful.<br />
<br />
Thanks again....</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th September 2005, 10:08</div></div><div class="posttext">Exec '&quot;$SYSDIR\wscript.exe&quot; &quot;$INSTDIR\killDesktopIcons.vbs&quot;'<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ewallig</div><div class="date">17th September 2005, 19:04</div></div><div class="posttext">Thanks Stu, I'll give that a try.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>