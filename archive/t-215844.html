<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" locate function question, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  locate function question NSIS Discussion" />
	
	<title> locate function question [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  locate function question</div>
<hr />
<div class="pda"><a href="t-215844.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=215844">locate function question</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">12th May 2005, 21:12</div></div><div class="posttext">i used instructor's http://nsis.sourceforge.net/archive/viewpage.php?pageid=527 (Locate) function to create a textfile with all files and subdirs of a drive or directory.<br />
<br />
my problem is, that i don't see a way to sort the files as desired. by default i get an alphabetically sorted list, unregarding whether it's a file or a folder.<br />
C:\WINDOWS<br />
C:\WINDOWS\0.log<br />
C:\WINDOWS\addins<br />
C:\WINDOWS\Application Compatibility Scripts<br />
C:\WINDOWS\AppPatch<br />
C:\WINDOWS\aspnetocm.log<br />
my requirement is a script that sorts differently: subdirs shouldn't be accessed until all files in a directory were indexed.<br />
C:\WINDOWS<br />
C:\WINDOWS\0.log<br />
C:\WINDOWS\aspnetocm.log<br />
  (all other files in C:\WINDOWS)<br />
<br />
C:\WINDOWS\addins<br />
  (all files in C:\WINDOWS\addins)<br />
<br />
C:\WINDOWS\Application Compatibility Scripts<br />
  (all files in C:\WINDOWS\Application Compatibility Scripts)<br />
<br />
C:\WINDOWS\Application Compatibility Scripts\Install<br />
  (all files in C:\WINDOWS\Application Compatibility Scripts\Install)<br />
<br />
..<br />
can this be done?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">12th May 2005, 22:05</div></div><div class="posttext">If you need just to make list of files and directories, use command processor (command.com or cmd.exe):<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
Function FileOemToChar<br />
	!define FileOemToChar `!insertmacro FileOemToCharCall`<br />
<br />
	!macro FileOemToCharCall _FILE<br />
		Push `${_FILE}`<br />
		Call FileOemToChar<br />
	!macroend<br />
<br />
	Exch $0<br />
	Push $1<br />
	Push $2<br />
	Push $3<br />
<br />
	FileOpen $1 $0 a<br />
	FileSeek $1 0 END $2<br />
	System::Alloc $2<br />
	Pop $3<br />
<br />
	FileSeek $1 0 SET<br />
	System::Call 'kernel32::ReadFile(i r1, i r3, i $2, t.,)'<br />
	System::Call 'user32::OemToCharBuff(i r3, i r3, i $2)'<br />
	FileSeek $1 0 SET<br />
	System::Call 'kernel32::WriteFile(i r1, i r3, i $2, t.,)'<br />
<br />
	System::Free $3<br />
	FileClose $1<br />
<br />
	Pop $3<br />
	Pop $2<br />
	Pop $1<br />
	Pop $0<br />
FunctionEnd<br />
<br />
Section<br />
	GetTempFileName $0<br />
	ReadEnvStr $1 COMSPEC<br />
	nsExec::Exec '&quot;$1&quot; /C DIR &quot;$STARTMENU&quot; /A /B /S /ON&gt;&quot;$0&quot;'<br />
	${FileOemToChar} &quot;$0&quot;<br />
<br />
	Exec 'Notepad.exe &quot;$0&quot;'<br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">12th May 2005, 22:18</div></div><div class="posttext">well it's not just a list that i need, thought i keep the example simple.<br />
<br />
when the user can specifiy two things in a dialog, the source directory and a target location:<br />
source example:<br />
c:\test<br />
c:\test\file1.txt<br />
c:\test\subdir1\file2.txt<br />
c:\test\subdir1\subdir2\file3.txt<br />
<br />
target example:<br />
http://www.myurl.no<br />
from this information, i want to create textfile of the following scheme.<br />
<br />
http://www.myurl.no/file1.txt<br />
outdir:subdir1<br />
http://www.myurl.no/subdir1/file2.txt<br />
outdir:subdir1\subdir2<br />
http://www.myurl.no/subdir1/subdir2/file3.txt</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Instructor</div><div class="date">12th May 2005, 23:15</div></div><div class="posttext">Fuff:<br />
<br />
Name &quot;Output&quot;<br />
OutFile &quot;Output.exe&quot;<br />
<br />
!include &quot;FileFunc.nsh&quot;<br />
!insertmacro GetParent<br />
<br />
!include &quot;TextFunc.nsh&quot;<br />
!insertmacro LineFind<br />
!insertmacro TrimNewLines<br />
<br />
!include &quot;WordFunc.nsh&quot;<br />
!insertmacro WordReplace<br />
<br />
Section<br />
	StrCpy $R0 &quot;$SMPROGRAMS&quot;<br />
	StrCpy $R1 &quot;http://www.myurl.no&quot;<br />
	StrLen $R2 $R0<br />
	StrCpy $R3 ''<br />
<br />
	GetTempFileName $0<br />
	ReadEnvStr $1 COMSPEC<br />
	nsExec::Exec '&quot;$1&quot; /C DIR &quot;$R0&quot; /A-D /B /S /ON&gt;&quot;$0&quot;'<br />
<br />
	${LineFind} &quot;$0&quot; &quot;&quot; &quot;1:-1&quot; &quot;LineFindCallback&quot;<br />
<br />
	Exec 'Notepad.exe &quot;$0&quot;'<br />
SectionEnd<br />
<br />
Function LineFindCallback<br />
	System::Call 'user32::OemToChar(t R9, t .R9)'<br />
	${TrimNewLines} &quot;$R9&quot; $R9<br />
	StrCpy $R9 $R9 '' $R2<br />
<br />
	${GetParent} &quot;$R9&quot; $1<br />
	StrCpy $1 $1 '' 1<br />
	StrCmp $R3 $1 +3<br />
	FileWrite $R4 &quot;outdir:$1$\r$\n&quot;<br />
	StrCpy $R3 $1<br />
<br />
	${WordReplace} &quot;$R9&quot; &quot; &quot; &quot;%20&quot; &quot;+&quot; $R9<br />
	${WordReplace} &quot;$R9&quot; &quot;\&quot; &quot;/&quot; &quot;+&quot; $R9<br />
	StrCpy $R9 &quot;$R1$R9$\r$\n&quot;<br />
<br />
	Push 0<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">13th May 2005, 00:22</div></div><div class="posttext">wow, that's more than i asked for.. feeling guilty. you're a mad machine, thank you!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>