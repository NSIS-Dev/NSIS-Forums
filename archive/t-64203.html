<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Compile in Borland, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Compile in Borland NSIS Discussion" />
	
	<title> Compile in Borland [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Compile in Borland</div>
<hr />
<div class="pda"><a href="t-64203.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=64203">Compile in Borland</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">30th October 2001, 00:04</div></div><div class="posttext">I was wondering if anyone had a makefile to compile NSIS with Borland's free compiler.  I found one in the archives but it didnt work to well.  Also, it would be nice if makefiles for other compilers were included in the source as well.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">DuaneJeffers</div><div class="date">30th October 2001, 04:47</div></div><div class="posttext">This was asked awhile ago. umm. I believe we couldn't find one.<br />
<br />
sorry.<br />
<br />
-Duane</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">30th October 2001, 20:21</div></div><div class="posttext">Crikey! Can it be so hard to write one? I wrote one for the exe head and makensis for VC++ 4.0. The hardest part on other compilers is getting the size tweaks right. (i.e. /nowin98, /FD etc).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">rainwater</div><div class="date">30th October 2001, 21:06</div></div><div class="posttext">The main problem I was having was compiling the resource file in the exehead.<br />
<br />
The rc file contains the line:<br />
#include &quot;afxres.h&quot; <br />
<br />
This is a mfc include so borland doesnt find it.  After commenting it out, I get the error:<br />
<br />
 - Error resource.rc 100 74: Incomplete expression<br />
<br />
Any ideas?<br />
_</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">4th November 2001, 19:55</div></div><div class="posttext">sounds liek your headers are not up to date..<br />
a quick fix; open resource.rc and add <br />
#define PBS_SMOOTH 0<br />
<br />
I dont know the proper value, neither do I care for the 'smoothing'.<br />
<br />
I just checked it and it compiles fine with Borlands free compiler.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">4th November 2001, 20:04</div></div><div class="posttext">now just to get the size optimisations.. 45.5kb on default options, but new simple 'initialisation module' that simply jumps to winmain (equivalical to setting the entry point on the ms compilers).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">5th November 2001, 11:27</div></div><div class="posttext">Okay. There are a few problems, not with compiling makensis, but with the implementation of finding the icon offset.<br />
<br />
When you use the borland resource compiler, it changes offset 14h (if I remember rightly - I am at school now) from 0x00 to 0x80 in the .res file. Obviously when the application is linked, this change is maintained. When however, you bin2h, the data at 14h is _not_ changed. The result is that at the initialisation of the exe build class, memcpy does not return 0 even when the correct icon offset is reached.<br />
<br />
solutions<br />
<br />
1. (Preferred). Use the structures in winnt.h to load the icon offset from the exe header in memory (I decided it would just be easiest to find the offset of the first bitmap, second bitmap and first icon - so if you do any modifications to the resource script as long as you keep the bitmaps and icon in the right order it should be okay). This will oleviate around 100,000 memcpy calls speeding up the initialisation process alot and will fix the icon problem.<br />
THis can be done quite easily; just cast a pointer of the dos header (struct defined in winnt.h) to the exe header and traverse through the sections until you find 1. the resource directory 2. the bitmap or icon group 3. the first actual icon or bitmaps. In order to get a file offset, remember to consider the RVA(relative virtual address or something).<br />
<br />
2. Easy - after bin2h'ing load the header and change the 14h (or whatever it was) offset from 0 to 0x80.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">5th November 2001, 11:48</div></div><div class="posttext">Another idea I just had would be why not use on the unused fields in the PE header of the exe head to store the size of the exe head. That way on loading the installer, we would not have to cycle through the header in 512 byte increments searching for the NSIS 'neato surprise' thing.<br />
<br />
(just a though, would save space and increase speed).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">5th November 2001, 19:19</div></div><div class="posttext">Nowww.. how do I submit suggestions to Justin?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pjw62</div><div class="date">6th November 2001, 19:46</div></div><div class="posttext">Anyway, Rainwater, here are the makefiles I used to compile the header and makensis.<br />
<br />
Note; you will still need to define PBS_SMOOTH in resource.[h|rc] (either will do).</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>