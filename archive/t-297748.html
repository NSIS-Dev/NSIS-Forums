<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Copying files to the JRE install directory on windows, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Copying files to the JRE install directory on windows NSIS Discussion" />
	
	<title> Copying files to the JRE install directory on windows [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Copying files to the JRE install directory on windows</div>
<hr />
<div class="pda"><a href="t-297748.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297748">Copying files to the JRE install directory on windows</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">acidjazz</div><div class="date">23rd September 2008, 10:54</div></div><div class="posttext">Morning!<br />
<br />
I have been working on an installer for a java application that a friend of mine wrote which requires some extra files to be copied into the current java install folder (the application makes use of the serial port which requires extra libraries to be installed). <br />
<br />
More specifically i would like my application to be installed to C:/program files/my app/application.jar (no problem) and then the extra library files to be copied to<br />
<br />
..\JavaInstallDirectory/MostCurrentVersion/lib/comm.java<br />
..\JavaInstallDirectory/MostCurrentVersion/lib/comm.properties.java<br />
..\JavaInstallDirectory/MostCurrentVersion/bin/wincom32.dll<br />
<br />
on my machine the folder is<br />
C:\Program Files\Java\jre1.6.0_07<br />
<br />
but i know it will differ from machine to machine and user to user.<br />
<br />
I did some reading around and found the Slightly Better Java  Launcher script on the NSIS wiki (and its variants) and have been trying to use it get the current java install directory and then copy in the files that I want.<br />
<br />
The script complies ok but the function call doesn't seem to be working properly or my variable declarations are not right (I inserted a line to show the &quot;found&quot; java path in a msgbox but it comes up blank. <br />
<br />
Alas my inexperience of using NSIS has lead me to failure.<br />
The script file is attached; if I could have a little guidance as to where I am going wrong then I would be most appreciative.<br />
<br />
<br />
Many thanks<br />
A</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pbingel</div><div class="date">23rd September 2008, 14:47</div></div><div class="posttext">Your error is in the label JreFound. Up until then everything is correct and works fine. However you echange $R0 with the top of the stack which is empty. Hence the empty string. I'm not even sure what you are trying to do there. But before that label $R0 is exactly what you want it to be. Read up more on push/pop/exch<br />
<br />
This works<br />
<br />
Function GetJRE<br />
;<br />
;  Find JRE (javaw.exe)<br />
;  1 - in .\jre directory (JRE Installed with application)<br />
;  2 - in JAVA_HOME environment variable<br />
;  3 - in the registry<br />
;  4 - assume javaw.exe in current dir or PATH<br />
<br />
  ;Push $R0<br />
  ;Push $R1<br />
<br />
  ClearErrors<br />
  StrCpy $R0 &quot;$INSTDIR\jre\bin\javaw.exe&quot;<br />
  IfFileExists $R0 JreFound<br />
  StrCpy $R0 &quot;&quot;<br />
<br />
  ClearErrors<br />
  ReadEnvStr $R0 &quot;JAVA_HOME&quot;<br />
  StrCpy $R0 &quot;$R0\bin\javaw.exe&quot;<br />
  IfErrors 0 JreFound<br />
<br />
  ClearErrors<br />
  ReadRegStr $R1 HKLM &quot;SOFTWARE\JavaSoft\Java Runtime Environment&quot; &quot;CurrentVersion&quot;<br />
  MessageBox MB_OK $R1<br />
  ReadRegStr $R0 HKLM &quot;SOFTWARE\JavaSoft\Java Runtime Environment\$R1&quot; &quot;JavaHome&quot;<br />
  StrCpy $R0 &quot;$R0\bin\javaw.exe&quot;<br />
  <br />
  IfErrors 0 JreFound<br />
  StrCpy $R0 &quot;javaw.exe&quot;<br />
<br />
 JreFound:<br />
  ;Pop $R1<br />
  ;Exch $R0<br />
  Push $R0<br />
  messageBox MB_OK &quot;$R0&quot;<br />
FunctionEnd<br />
<br />
<br />
When GetJRE returns and you pop $R0 you get what you expect</div></div><hr />


<div class="post"><div class="posttop"><div class="username">acidjazz</div><div class="date">23rd September 2008, 15:53</div></div><div class="posttext">Ah i think I see what has gone wrong here - i'm a design engineer by trade so this programming lark is not in my comfort zone. Thanks for the tip - i found the push pop tutorial on the wiki; i'll give it a proper going over.<br />
<br />
Thanks again<br />
A</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>