<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" nub needs help adding text, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  nub needs help adding text NSIS Discussion" />
	
	<title> nub needs help adding text [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  nub needs help adding text</div>
<hr />
<div class="pda"><a href="t-179716.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179716">nub needs help adding text</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">docp</div><div class="date">12th May 2004, 09:49</div></div><div class="posttext">I'm totally ignorant of this type of scripting from scratch. The closest thing I can claim is the DOS from 15 yrs ago ('mid 80's?), so please bear with me.<br />
I'm trying to find out if I can add (and erase) text inside of a text document. I write scripts for Half-Life, not engine or mod scripts, just plain old alias scripts, and I need to find a way to add text so that the game will automatically execute them. <br />
I'm going to give an example for ease of understanding:<br />
I have a basic script pack and want to be able to offer &quot;addons&quot; to be downloaded seperately. To have them executed in the game, a text line has to be added to a file.<br />
Example: valve.rc<br />
exec script.cfg<br />
exec buy.cfg<br />
If 2 &quot;addons&quot; were downloaded seperately, I'd have to add an exec line into that file for each script.<br />
I have a .nsi script that I use for the Pack install, which might be able to be modified further to suit my needs, but I don't know the commands to make it happen. <br />
Here's the .nsi I'm using for the pack install (I only modified it to suit my specific files):<br />
# DocPak3 NSIS Source Code<br />
# Rev. 5/5/04 9:20pm cst<br />
# Originally written by esky<br />
# Modified by !Doc<br />
# You may use this code for your own reference<br />
# If you copy any of my functions, please give proper credit<br />
<br />
Name &quot;DocPak3&quot;<br />
OutFile &quot;DocPak3.exe&quot;<br />
ShowInstDetails hide<br />
<br />
# These are custom icons for the installer<br />
# Delete the two lines to use default icons, or point to your own<br />
Icon &quot;C:\Program Files\Scripts\DP3\doc.ico&quot;<br />
UninstallIcon &quot;C:\Program Files\Scripts\DP3\undoc.ico&quot;<br />
<br />
# Aux function to delete elements at the end of a path<br />
# This function is taken from NSIS documentation<br />
Function getParent<br />
  Push $8<br />
  Exch $0<br />
  Push $1<br />
  Push $2<br />
  StrCpy $1 -1<br />
  loop:<br />
    StrCpy $2 $0 1 $1<br />
    StrCmp $2 &quot;&quot; exit<br />
    StrCmp $2 &quot;\&quot; exit<br />
    IntOp $1 $1 - 1<br />
  Goto loop<br />
  exit:<br />
    StrCpy $0 $0 $1<br />
    Pop $2<br />
    Pop $1<br />
    Exch $0<br />
FunctionEnd<br />
<br />
# Find Steam via RegKey, then delete the half-life part, add Counter-Strike<br />
Function findSteam<br />
  ReadRegStr $8 HKCU \<br />
     &quot;Software\Valve\Steam&quot; \<br />
     &quot;ModInstallPath&quot; ;These three lines find the key<br />
  Push $8<br />
  Call getParent ;delete 'half-life' from the end<br />
  Pop $8<br />
  StrCmp $8 &quot;&quot; skip addcs ;make sure a path was indeed copied from the registry<br />
  addcs:<br />
    StrCpy $INSTDIR &quot;$8\Counter-Strike&quot; ;add Counter-Strike on the end<br />
    GoTo skip2<br />
  skip:<br />
    StrCpy $INSTDIR &quot;&quot; ;this only happens if the path read from registry is empty or non-existant<br />
  skip2:<br />
FunctionEnd<br />
<br />
# Using path found in registry, make sure hl.exe exists in the counter-strike folder<br />
# This is to verify that extracting giles to the *path*\cstrike will place script in correct place<br />
Function doubleCheck<br />
  IfFileExists $INSTDIR\hl.exe skip notify<br />
  notify:<br />
    StrCpy $INSTDIR &quot;Unable to find CS.  Please browse manually...&quot;<br />
  skip:<br />
FunctionEnd<br />
<br />
# Stuff to do when installer is started, before actual Install takes place<br />
Function .onInit<br />
  Call findSteam ;attempt to find counter-strike path from registry<br />
  Call doubleCheck ;double check path is correct<br />
FunctionEnd<br />
<br />
# Make sure install path is correct<br />
# This checks both the path auto-detected, and anything the user inputs<br />
# Installer will not continue until the path has hl.exe<br />
Function .onVerifyInstDir<br />
    IfFileExists $INSTDIR\hl.exe PathGood<br />
      Abort<br />
    PathGood:<br />
FunctionEnd<br />
<br />
DirText &quot;Enter your Counter-Strike account location.  Setup will try to detect the correct path.  However, if path cannot be verified (hl.exe is not found), setup cannot continue.&quot;&quot; &quot;<br />
<br />
# This section actually extracts all my stuff, also deletes previous installation if found<br />
Section<br />
  Delete &quot;$INSTDIR\cstrike\DocPak\*.*&quot;<br />
  RMDir &quot;$INSTDIR\cstrike\DocPak&quot;<br />
  Rename $INSTDIR\cstrike\valve.rc $INSTDIR\cstrike\valve.rc.old<br />
  Rename $INSTDIR\cstrike\titles.txt $INSTDIR\cstrike\titles.txt.old<br />
  Rename $INSTDIR\cstrike\commandmenu.txt $INSTDIR\cstrike\commandmenu.txt.old<br />
  Rename $INSTDIR\cstrike\gfx\shell\kb_act.lst $INSTDIR\cstrike\gfx\shell\kb_act.lst.old<br />
  Rename $INSTDIR\cstrike\gfx\shell\kb_def.lst $INSTDIR\cstrike\gfx\shell\kb_def.lst.old<br />
  SetOutPath $INSTDIR\cstrike\DocPak<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\DocPak\buy.cfg&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\DocPak\common.cfg&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\DocPak\default.cfg&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\DocPak\names.cfg&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\DocPak\says.cfg&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\DocPak\scripts.cfg&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\DocPak\DP3.readme.rtf&quot;<br />
  SetOutPath $INSTDIR\cstrike\gfx\shell<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\gfx\shell\kb_act.lst&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\gfx\shell\kb_def.lst&quot;<br />
  SetOutPath $INSTDIR\cstrike<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\valve.rc&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\titles.txt&quot;<br />
  File &quot;C:\Program Files\Scripts\DP3\cstrike\commandmenu.txt&quot;<br />
  WriteUninstaller &quot;$INSTDIR\UninstallDocPak3.exe&quot;<br />
  SetOutPath $SMPROGRAMS\DocPak3<br />
  CreateShortCut &quot;$SMPROGRAMS\DocPak3\DP3.readme.lnk&quot; &quot;$INSTDIR\cstrike\DocPak\DP3.readme.rtf&quot;<br />
  CreateShortCut &quot;$SMPROGRAMS\DocPak3\Uninstall.lnk&quot; &quot;$INSTDIR\UninstallDocPak3.exe&quot;<br />
SectionEnd<br />
<br />
UninstallText &quot;This will uninstall DocPak3. Hit next to continue.&quot;<br />
<br />
# Restore the valve.rc and commandmenu.txt the person had before installing<br />
Function un.Rename<br />
  Rename $INSTDIR\cstrike\valve.rc.old $INSTDIR\cstrike\valve.rc<br />
  Rename $INSTDIR\cstrike\titles.txt.old $INSTDIR\cstrike\titles.txt<br />
  Rename $INSTDIR\cstrike\commandmenu.txt.old $INSTDIR\cstrike\commandmenu.txt<br />
  Rename $INSTDIR\cstrike\gfx\shell\kb_act.lst.old $INSTDIR\cstrike\gfx\shell\kb_act.lst<br />
  Rename $INSTDIR\cstrike\gfx\shell\kb_def.lst.old $INSTDIR\cstrike\gfx\shell\kb_def.lst<br />
FunctionEnd<br />
<br />
Section &quot;Uninstall&quot;<br />
  Delete &quot;$INSTDIR\cstrike\valve.rc&quot;<br />
  Delete &quot;$INSTDIR\cstrike\titles.txt&quot;<br />
  Delete &quot;$INSTDIR\cstrike\commandmenu.txt&quot;<br />
  Delete &quot;$INSTDIR\UninstallDocPak3.exe&quot;<br />
  Delete &quot;$INSTDIR\cstrike\gfx\shell\kb_act.lst&quot;<br />
  Delete &quot;$INSTDIR\cstrike\gfx\shell\kb_def.lst&quot;<br />
  Delete &quot;$INSTDIR\cstrike\DocPak\*.*&quot;<br />
  RMDir &quot;$INSTDIR\cstrike\DocPak&quot;<br />
  Delete &quot;$SMPROGRAMS\DocPak3\*.*&quot;<br />
  RMDir &quot;$SMPROGRAMS\DocPak3&quot;<br />
  Call un.Rename<br />
SectionEnd<br />
<br />
# If install is success, it will ask the user to show the readme.html<br />
Function .onInstSuccess<br />
    MessageBox MB_YESNO|MB_ICONQUESTION \<br />
     &quot;All Done! You can bind controls in Options.  View ReadMe now?&quot; \<br />
     IDNO NoReadme<br />
      ExecShell &quot;open&quot; $INSTDIR\cstrike\DocPak\DP3.readme.rtf<br />
    NoReadme:<br />
FunctionEnd<br />
;eof<br />
<br />
I am curious about adding text into a text document from the installer. The reason I'm not putting all the scripts into one installer is that there are about 30-40 of them, and putting in a components option would be a bit much (to be honest, I wouldn't know how to start that anyway).<br />
Thanks for any help you can give me.<br />
<br />
ps. the adding text would be for installing and deleting text would be for uninstalling, wasn't sure if that was clear. Thanx again.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">12th May 2004, 10:08</div></div><div class="posttext">NSIS has build-in commands for text file modification. There are several examples available in the archive.<br />
<br />
The easiest way is to read the text file, append or remove the data and write everything back.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>