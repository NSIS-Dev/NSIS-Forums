<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" read/write registry version &amp; $INSTDIR, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  read/write registry version &amp; $INSTDIR NSIS Discussion" />
	
	<title> read/write registry version &amp; $INSTDIR [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  read/write registry version &amp; $INSTDIR</div>
<hr />
<div class="pda"><a href="t-274959.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=274959">read/write registry version &amp; $INSTDIR</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bl4d3</div><div class="date">26th July 2007, 18:27</div></div><div class="posttext">hello,<br />
i've created my own nsis installer for my program. but i don't know how to set a registry value with the corresponding version number and installation path.<br />
<br />
i plan to add in future for my program an extension. the installer for the extension should check in the registry the path i have set with the main program installer.<br />
<br />
The main installer should set these entries:<br />
<br />
[HKEY_LOCAL_MACHINE\Software\${APPNAME}\]<br />
&quot;Path&quot;=&quot;C:\Program Files\APPNAME&quot;<br />
&quot;Version&quot;=&quot;1.0&quot; ;for future patches e.g.<br />
<br />
And the installer for the extension should read:<br />
[HKEY_LOCAL_MACHINE\Software\${APPNAME}\]<br />
&quot;Path&quot;=&quot;C:\Program Files\APPNAME&quot;<br />
<br />
and set automatically on installation the path he found in the registry, to avoid mistakes in choosing the correct installation directory.<br />
<br />
cause the customer could choose another install directory in the main installer.<br />
<br />
i think i must use &quot;ReadREGDWORD&quot; and &quot;WriteRegDWORD&quot;, but i'm not very sure about this. the solution shouldn't be very complex. something easier will do it for myself.<br />
<br />
thank you</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">26th July 2007, 18:40</div></div><div class="posttext">That's too short, could you provide some details about your query?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bl4d3</div><div class="date">26th July 2007, 18:59</div></div><div class="posttext">Originally posted by Red Wine <br />
That's too short, could you provide some details about your query?  <br />
ups, sorry for that. when i wrote my text i accidentally press the &quot;enter&quot;-key.<br />
sorry.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bl4d3</div><div class="date">26th July 2007, 19:11</div></div><div class="posttext">hm,<br />
i think in the main installer i should use:<br />
<br />
WriteRegStr HKLM &quot;Software\APPNAME&quot; &quot;Path&quot; &quot;$INSTDIR&quot;<br />
WriteRegStr HKLM &quot;Software\APPNAME&quot; &quot;Version&quot; &quot;${VERSION}&quot;<br />
<br />
and the extension installer should use:<br />
<br />
ReadRegDWORD $0 HKLM Software\APPNAME Path<br />
<br />
this was copied from the nsis user manual<br />
<br />
but if this is correct, how to lock and change in the extension installer the installation directory?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">26th July 2007, 19:31</div></div><div class="posttext">Function .onInit<br />
ReadRegStr $0 HKLM &quot;Software\APPNAME&quot; &quot;Path&quot;<br />
StrCpy $INSTDIR &quot;$0&quot;<br />
........<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">26th July 2007, 20:14</div></div><div class="posttext">No need for using ReadRegStr, you can just use InstallDirRegKey.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bl4d3</div><div class="date">28th July 2007, 05:50</div></div><div class="posttext">hi,<br />
sorry guys, but i do some bugfixing stuff on my program first, before i get time for testing the code posted here.<br />
<br />
the code you guys have written is perfect for me.<br />
<br />
this is how i do it and it is 100% working. i've decided to post the hole code again as i used it, to make it more understandable for others.<br />
<br />
In the main installer write:<br />
<br />
!define VERSION &quot;1.0&quot;<br />
!define APPNAME &quot;Your Programs Name&quot;<br />
<br />
Function .onInstSuccess ;After installation success the installer writes some values to registry<br />
		<br />
WriteRegStr HKLM &quot;Software\${APPNAME}&quot; &quot;Path&quot; &quot;$INSTDIR&quot;<br />
WriteRegStr HKLM &quot;Software\${APPNAME}&quot; &quot;Version&quot; &quot;${VERSION}&quot;<br />
<br />
FunctionEnd<br />
<br />
and in the extension installer:<br />
<br />
Function .onInit<br />
<br />
ReadRegStr $0 HKLM &quot;Software\${APPNAME}&quot; &quot;Path&quot;<br />
StrCpy $INSTDIR &quot;$0&quot;<br />
<br />
FunctionEnd<br />
<br />
<br />
big thanks goes out to all genius guys!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bl4d3</div><div class="date">28th July 2007, 20:45</div></div><div class="posttext">hi,<br />
there's another problem. i want to compare the version, which is stored in registry, for future patches. i've experiment with some possibilities, but ther is always an error on compiling.<br />
<br />
patch installer:<br />
!define NEWVERSION &quot;v1.2&quot;<br />
!define CURRENTVERSION &quot;&quot;<br />
...<br />
...<br />
!include &quot;WordFunc.nsh&quot;<br />
!include &quot;StrFunc.nsh&quot;<br />
${StrStr} ;Activate the StrStr Function<br />
!insertmacro VersionCompare<br />
<br />
Section<br />
	 ReadRegStr $0 HKLM &quot;Software\${APPNAME}&quot; &quot;Version&quot;<br />
 StrCpy $CURENTVERSION &quot;$0&quot;<br />
	${VersionCompare} &quot;${CURENTVERSION}&quot; &quot;${NEWVERSION}&quot; $R0<br />
	${If} $R0 = 0<br />
  MessageBox MB_VER &quot;equal&quot;<br />
Abort<br />
	${If} $R0 = 1<br />
	MessageBox MB_VER &quot;newer&quot;<br />
Abort<br />
	${If} $R0 = 2<br />
	MessageBox MB_VER &quot;newer&quot;<br />
Abort<br />
SectionEnd<br />
<br />
(Example: E.3.16 VersionCompare (http://nsis.sourceforge.net/Docs/AppendixE.html#E.3.16))<br />
<br />
With those code the compiler says:<br />
!insertmacro: end of FUNCTION_STRING_StrStr<br />
!insertmacro: VersionCompare<br />
!insertmacro: end of VersionCompare<br />
Section: &quot;&quot;<br />
ReadRegStr $0 HKLM\Software\APPNAME\Version<br />
Usage: StrCpy $(user_var: output) str [maxlen] [startoffset]<br />
Error in script &quot;stdin&quot; on line 85 -- aborting creation process<br />
<br />
without those lines<br />
ReadRegStr $0 HKLM &quot;Software\${APPNAME}&quot; &quot;Version&quot;<br />
StrCpy $CURENTVERSION &quot;$0&quot;<br />
the compiler says:<br />
!insertmacro: end of FUNCTION_STRING_StrStr<br />
!insertmacro: VersionCompare<br />
!insertmacro: end of VersionCompare<br />
Section: &quot;&quot;<br />
!insertmacro: VersionCompareCall<br />
!insertmacro: end of VersionCompareCall<br />
!insertmacro: _If<br />
!insertmacro: end of _If<br />
Usage: MessageBox mode messagebox_text [/SD return] [return_check label_to_goto_if_equal [return_check2 label2]]<br />
    mode=modeflag[|modeflag[|modeflag[...]]]<br />
    modeflag=(MB_ABORTRETRYIGNORE|MB_OK|MB_OKCANCEL|MB_RETRYCANCEL|MB_YESNO|MB_YESNOCANCEL|MB_ICONEXCLAMATION|MB_ICONINFORMATION|MB_ICONQUESTION|MB_ICONSTOP|MB_USERICON|MB_TOPMOST|MB_SETFOREGROUND|MB_RIGHT<br />
Error in script &quot;stdin&quot; on line 88 -- aborting creation process<br />
<br />
you see there are some bugs, but i don't know how to fix it. i'm not really fit in nsis.<br />
<br />
thanks for help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">28th July 2007, 23:24</div></div><div class="posttext">You missed the distinction between variables (and how they are referenced) and defined constants (and their usage).<br />
<br />
Var something<br />
StrCpy $something &quot;any text&quot;<br />
<br />
!define something &quot;different text&quot;<br />
StrCmp $something ${something} equal<br />
...<br />
equal:<br />
<br />
<br />
!define sets a compile time value and replaces the ${} entry with the defined value during the compilation.<br />
<br />
Var creates a variable which only has a value after the compile, during the execution.<br />
<br />
In addition, I think VersionCompare won't like the &quot;v&quot; you put in ${NEWVERSION}.<br />
<br />
Don</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>