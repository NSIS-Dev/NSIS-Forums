<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" !define and environment variable, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  !define and environment variable NSIS Discussion" />
	
	<title> !define and environment variable [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  !define and environment variable</div>
<hr />
<div class="pda"><a href="t-115629.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=115629">!define and environment variable</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">e-novative</div><div class="date">26th November 2002, 09:14</div></div><div class="posttext">Hi all,<br />
<br />
My installation requires a version number that is !define'd in the NSIS script. Is it possible to read a value from an environment variable (or pass a value to the compiler via command line) *at compile time*?<br />
<br />
This would allow my &quot;create release&quot; batch to pass the version number to the NSIS script, thus freeing me from the need to set the version number there manually (which is rather error-prone).<br />
<br />
Or is it, by some way, possible the other way round? Can the compiler &quot;return&quot; the version number to the calling batch?<br />
<br />
I couldn't find anything useful when searching the forum and the net. Any idea or pointer would be greatly appreciated.<br />
<br />
Regards,<br />
<br />
Steve</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dbareis</div><div class="date">26th November 2002, 09:41</div></div><div class="posttext">I don't know whether NSIS can do it or not, someone else may provide an answer, but there are other preprocessors. My free PPWIZARD will certainly allow you to do this.<br />
<br />
Bye<br />
Dennis</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">26th November 2002, 13:58</div></div><div class="posttext">Use the command line option /D to define you version.<br />
<br />
makensis.exe /DVERSION=2 file.nsi<br />
<br />
Make sure your script doesn't over right it though by doing the following.<br />
<br />
!ifndef VERSION<br />
  !define VERSION 1<br />
!endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">26th November 2002, 14:46</div></div><div class="posttext">I couldn't find anything useful when searching the forum and the net. Any idea or pointer would be greatly appreciated. <br />
<br />
Well, you didn't search hard enough... It's in the FAQ on the top of the page ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">e-novative</div><div class="date">26th November 2002, 14:58</div></div><div class="posttext">Works perfect, thanks a lot.<br />
<br />
I must have been blind, though ... shouldn't have worked so late last night!<br />
<br />
Steve</div></div><hr />


<div class="post"><div class="posttop"><div class="username">dselkirk</div><div class="date">26th November 2002, 15:33</div></div><div class="posttext">no problem and i know the feeling, hehe</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HelluvaEngineer</div><div class="date">11th December 2002, 19:39</div></div><div class="posttext">Originally posted by dselkirk <br />
Use the command line option /D to define you version.<br />
<br />
makensis.exe /DVERSION=2 file.nsi<br />
<br />
Make sure your script doesn't over right it though by doing the following.<br />
<br />
!ifndef VERSION<br />
  !define VERSION 1<br />
!endif <br />
<br />
Ok, you just lost me.  I am using code similar to what you said above, and it's not working.  It shouldn't enter the ifndef unless it's not defined, right?<br />
<br />
Lookie here:<br />
<br />
I call<br />
<br />
Makensis /V3 /NOCONFIG /HDRINFO /CD /DMAJORVER=2 /DMINORVER=2 /DMICROVER=0 TechDemo.nsi<br />
<br />
In the nsi, I have this code:<br />
<br />
!ifndef ${MAJORVER}<br />
  !warning &quot;MAJORVER not defined.&quot;<br />
  !define MAJORVER 0<br />
!endif<br />
<br />
!ifndef ${MINORVER}<br />
  !warning &quot;MINORVER not defined.&quot;<br />
  !define MINORVER 0<br />
!endif<br />
<br />
!ifndef ${MICROVER}<br />
  !warning &quot;MICROVER not defined.&quot;<br />
  !define MICROVER 0<br />
!endif<br />
<br />
But get this error!:<br />
<br />
warning: !warning: MAJORVER not defined. (TechDemo.nsi:35)<br />
<br />
!define: &quot;MAJORVER&quot; already defined!<br />
Error in script &quot;TechDemo.nsi&quot; on line 36 -- aborting creation process<br />
<br />
Am I overlooking something?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">11th December 2002, 19:45</div></div><div class="posttext">You should call the ifndef like this:<br />
<br />
!ifndef MAJORVER<br />
<br />
${MAJORVER} translates to its value and because of that NSIS tries to see if 2 is not defined, which is of course true.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">HelluvaEngineer</div><div class="date">11th December 2002, 19:51</div></div><div class="posttext">OK, in retrospect that should have been obvious.  Thank you!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>