<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" [Search] unknown system call, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  [Search] unknown system call NSIS Discussion" />
	
	<title> [Search] unknown system call [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  [Search] unknown system call</div>
<hr />
<div class="pda"><a href="t-178622.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=178622">[Search] unknown system call</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">1st May 2004, 19:15</div></div><div class="posttext">we have a little problem...<br />
<br />
anyony knows tweaking tools like TuneUp or TweakUI<br />
<br />
now we have this entry<br />
<br />
REGEDIT4<br />
<br />
[HKEY_CURRENT_USER\Control Panel\Desktop]<br />
&quot;MenuShowDelay&quot;=&quot;8&quot;<br />
<br />
(this speeds up the menu open)<br />
<br />
it is very simple to write a script for it, but unfortunately system does not take this value - only after restart.<br />
but tweaking tools do so w/o system restart<br />
<br />
so i suppose an unknown system call to establish those values<br />
<br />
pls help</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">1st May 2004, 20:54</div></div><div class="posttext">You probably need to send WM_WININICHANGE. Try:<br />
<br />
SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 &quot;STR:Control Panel&quot;<br />
/TIMEOUT=5000</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">1st May 2004, 20:59</div></div><div class="posttext">sorry for bringing up confusion in my previous post. it should work when you use<br />
<br />
SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 &quot;STR:MenuShowDelay&quot; /TIMEOUT=500</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd May 2004, 06:19</div></div><div class="posttext">nothing :/<br />
<br />
;--------------------------------<br />
;Configuration<br />
<br />
!define PRODUCT &quot;MenuShowDelay&quot;<br />
!define VERSION &quot;1.0&quot;<br />
<br />
Name &quot;'${PRODUCT}'&quot;<br />
<br />
Caption &quot;MenuShowDelay 1.0&quot;<br />
OutFile &quot;MenuShowDelay.exe&quot;<br />
<br />
!include WinMessages.nsh<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;&quot;<br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Installer Functions<br />
<br />
Function .onInit<br />
  ReadINIStr $R0 &quot;$EXEDIR\MenuShowDelay.ini&quot; MenuShowDelay MenuShowDelay<br />
  WriteRegStr HKCU &quot;Control Panel\Desktop&quot; &quot;MenuShowDelay&quot; $R0<br />
  SendMessage ${HWND_BROADCAST} ${WM_WININICHANGE} 0 &quot;STR:MenuShowDelay&quot; /TIMEOUT=500<br />
  Quit<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">2nd May 2004, 11:29</div></div><div class="posttext">i'm sorry. by trying to take back the confusion of my previous post, i created some more confusion. doesn't work indeed :(<br />
<br />
SendMessage(HWND_BROADCAST, WM_SETTINGCHANGE, 0, (LPARAM) (LPCTSTR)&quot;MenuShowDelay&quot;);<br />
<br />
this is what i got from MSDN, but WM_SETTINGCHANGE is not supported by NSIS</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">2nd May 2004, 14:01</div></div><div class="posttext">never mind, was just a try.<br />
<br />
the damned nview desktop manager resets on startup the delay to 400 and i tried to help my friend...<br />
<br />
thx 4all</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">3rd May 2004, 16:58</div></div><div class="posttext">still i'd love to see a solution :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">3rd May 2004, 17:38</div></div><div class="posttext">WM_SETTINGCHANGE is identical to WM_WININICHANGE.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">3rd May 2004, 19:14</div></div><div class="posttext">&gt;&gt; 1 warning:<br />
&gt;&gt;unknown variable/constant &quot;{WM_SETTINGCHANGE}&quot; detected, ignoring<br />
<br />
:cry:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Joost Verburg</div><div class="date">3rd May 2004, 19:32</div></div><div class="posttext">As I already said, WM_WININICHANGE is the same. But I've added WM_SETTINGCHANGE so you can also use the modern name.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">4th May 2004, 16:40</div></div><div class="posttext">guess that's why it still doesn't work ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">8th May 2004, 01:21</div></div><div class="posttext">would it be possible to do the same by commandline (rundll or anything like that)? does anybody know about such stuff?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">8th June 2004, 16:29</div></div><div class="posttext">Try this:<br />
<br />
<br />
!define PRODUCT &quot;MenuShowDelay&quot;<br />
!define VERSION &quot;1.0&quot;<br />
<br />
Name &quot;'${PRODUCT}'&quot;<br />
<br />
Caption &quot;MenuShowDelay 1.0&quot;<br />
OutFile &quot;MenuShowDelay.exe&quot;<br />
<br />
!include WinMessages.nsh<br />
!define SPI_SETMENUSHOWDELAY 107<br />
!define SPIF_SENDINICHANGE 3<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;&quot;<br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Installer Functions<br />
<br />
Function .onInit<br />
  Push $R0<br />
  Push $R1<br />
  ReadINIStr $R0 &quot;$EXEDIR\MenuShowDelay.ini&quot; MenuShowDelay MenuShowDelay<br />
  System::call &quot;user32::SystemParametersInfo(i ${SPI_SETMENUSHOWDELAY}, i R0 , i 0, i ${SPIF_SENDINICHANGE}) i .R1&quot;<br />
  MessageBox MB_OK &quot;Done: $R1&quot;<br />
  Pop $R1<br />
  Pop $R0<br />
  Quit<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">13th June 2004, 04:12</div></div><div class="posttext">not sure if it's coincidence or if my system went unusuable after trying this. however, i can't tell what made my system unusable and i don't want to claim it was was the script's fault. in any case, i'm now using vmware to test scripts with code i don't understand. :p <br />
<br />
i'd like to know more about this system call. what is SPI_SETMENUSHOWDELAY? is this meant to refresh the MenuDelay setting only? i'd be interested in finding out more about this, since i want to reload other settings from the registry aswell.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">13th June 2004, 15:37</div></div><div class="posttext">Its a documented Windows API call- I don't see why it would mess up your system. Look up MSDN documentation on SystemParametersInfo. It is the same call made by TweakUI.<br />
SPI_SETMENUSHOWDELAY is only for MenuDelay. There are a bunch of other settings, they're all in the API documentation.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">13th June 2004, 16:54</div></div><div class="posttext">thanks for the reference, will look myself into it. <br />
<br />
must've been coincidence, didn't mean to offend you.<br />
<br />
thanks iceman_k!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">13th June 2004, 17:00</div></div><div class="posttext">No offence taken. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">22nd July 2004, 23:35</div></div><div class="posttext">i compiled and ran the script again, my system got kinda unusable.<br />
<br />
whenever i right-click a file, submenus like &quot;Send to..&quot; or &quot;Open with..&quot; take several seconds until they are getting displayed.<br />
<br />
next time i ran RegMon to see what the script does. i thought it just reads a setting (MenuDelay in this case) from the registry and applies it (otherwise one has to reboot to apply the setting). actually MenuShowDelay gets set to &quot;0&quot; (default is &quot;400&quot;). when i set this back to 400 and applied the setting, the menu still take several seconds until they appear.<br />
<br />
this also brings up the question, what these variables are used for, since the &quot;0&quot; is the value, to which the menudelay is getting set.<br />
<br />
any clue how i can reset all the settings made by this script?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">23rd July 2004, 03:03</div></div><div class="posttext">hm, i reinstalled directx and now the problem is fixed.. how weird is that</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">23rd July 2004, 03:30</div></div><div class="posttext">The script is not reading the default value from the registry.<br />
It expects you to have a file called MenuShowDelay.ini in the same directory as the MenuShowDelay.exe executable, with a section called MenuShowDelay and a value called MenuShowDelay.<br />
I just tested the script on 3 different machines, two running Win XP Pro and one running Win 2K Pro. It ran fine on all three.<br />
<br />
I don't know why directx would be an issue at all. SystemParametersInfo is   a standard Windows API. SPI_MENUSHOWDELAY is supported on all versions except Windows 95.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">24th July 2004, 02:11</div></div><div class="posttext">well, i know it sounds odd, but what can i say. it happened before and i was unsure, this time i could be sure. didn't happen on xp, but on a 2003 server, though it has the same registry entries. however, i'm glad i could solve this.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Yathosho</div><div class="date">18th March 2005, 11:36</div></div><div class="posttext">Originally posted by iceman_k <br />
Its a documented Windows API call- I don't see why it would mess up your system. Look up MSDN documentation on SystemParametersInfo. It is the same call made by TweakUI.<br />
<br />
just to clear this up:<br />
<br />
There is a bug in Windows Server 2003 that will cause short bursts of unresponsiveness when loading a sub menu such as SendTo. The cause of this problem is when the MenuShowDelay is set to &quot;0&quot; (which allows sub menus to instantly appear). This tweak is applied by either TweakUI, X-Setup, or by editing the Registry.<br />
<br />
i found this on msfn.org (http://www.msfn.org/win2k3/tweaks.htm)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">iceman_k</div><div class="date">18th March 2005, 13:41</div></div><div class="posttext">OK, so if the MenuShowDelay.ini file is missing, then the $R0 value is probably being set to 0 by default, hence the MenuShowDelay is also being set to 0- which triggers this bug.<br />
The fix would be to modify the script to check that the value is &gt; 0.<br />
<br />
<br />
!define PRODUCT &quot;MenuShowDelay&quot;<br />
!define VERSION &quot;1.0&quot;<br />
<br />
Name &quot;'${PRODUCT}'&quot;<br />
<br />
Caption &quot;MenuShowDelay 1.0&quot;<br />
OutFile &quot;MenuShowDelay.exe&quot;<br />
<br />
!include WinMessages.nsh<br />
!define SPI_SETMENUSHOWDELAY 107<br />
!define SPIF_SENDINICHANGE 3<br />
<br />
;--------------------------------<br />
;Installer Sections<br />
<br />
Section &quot;&quot;<br />
SectionEnd<br />
<br />
;--------------------------------<br />
;Installer Functions<br />
<br />
Function .onInit<br />
  Push $R0<br />
  Push $R1<br />
  ReadINIStr $R0 &quot;$EXEDIR\MenuShowDelay.ini&quot; MenuShowDelay MenuShowDelay<br />
  IntCmp $R0 0 done done 0<br />
  System::call &quot;user32::SystemParametersInfo(i ${SPI_SETMENUSHOWDELAY}, i R0 , i 0, i ${SPIF_SENDINICHANGE}) i .R1&quot;<br />
  MessageBox MB_OK &quot;Done: $R1&quot;<br />
done:<br />
  Pop $R1<br />
  Pop $R0<br />
  Quit<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Brummelchen</div><div class="date">18th March 2005, 16:34</div></div><div class="posttext">wow, after a year passed by this thread is still alive :)<br />
meanwhile i dropped my investigations this way cause nvidia may solved this annoying bug. one of the latest drivers (66.xx).<br />
<br />
&quot;menushowdelay&quot; is 8 here, 0 is too fast and default 400 is lame ;p</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>