<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Terminating string, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Terminating string NSIS Discussion" />
	
	<title> Terminating string [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Terminating string</div>
<hr />
<div class="pda"><a href="t-297103.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=297103">Terminating string</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">ClausG</div><div class="date">9th September 2008, 10:12</div></div><div class="posttext">Hello,<br />
I need to read a string with fix size and compare it:  <br />
   !define SameText     &quot;SameText&quot;<br />
   !define SameTextSize 9<br />
   System::Alloc ${SameTextSize}<br />
   System::Call &quot;MyDll::ReadMem(.r14, ${SameTextSize}-1) .r13&quot;<br />
   StrCmp $R3 0 CallFailed <br />
   ; --&gt;&gt; Terminate $R4 with '\0', BUT HOW? <br />
   StrCmp $R4 &quot;${SameText}&quot; 0 WrongData<br />
<br />
I have no idea how to terminate my $R4. In C I just would do something like $R4[8]='\0'; But, with NSIS? Does anybody know?<br />
<br />
Claus</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">9th September 2008, 12:55</div></div><div class="posttext">err, if $R4 is a normal nsis string you can just do StrCpy $R4 $R4 9 or whatever</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ClausG</div><div class="date">9th September 2008, 14:34</div></div><div class="posttext">Sorry, there's a little bug in my code. i forgot to pop $R4 after allocation:<br />
   !define SameText     &quot;SameText&quot;<br />
   !define SameTextSize 9<br />
   System::Alloc ${SameTextSize}<br />
   Pop $R4<br />
   System::Call &quot;MyDll::ReadMem(.r14, ${SameTextSize}-1) .r13&quot;<br />
   StrCmp $R3 0 CallFailed <br />
   ; --&gt;&gt; Terminate $R4 with '\0', BUT HOW? <br />
   StrCmp $R4 &quot;${SameText}&quot; 0 WrongData<br />
<br />
<br />
So $R4 isn't a normal NSIS string.<br />
<br />
Claus</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ClausG</div><div class="date">10th September 2008, 07:04</div></div><div class="posttext">Mmmh, no answers?<br />
<br />
No, my question isn't answered so far. As you can see, I allocate 9 bytes in $R4 and read the first 8 bytes via MyDLL::ReadMem. To compare with &quot;SameText&quot; the string in $R4 must be null terminated. How can I do this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th September 2008, 11:35</div></div><div class="posttext">you can use the struct handling in system.dll, something like: system::call '*$R4(&amp;t8,&amp;i1 0)' (untested code off the top of my head)<br />
<br />
but that is rather pointless since you need to get it out of the memory pointer and into a nsis var before you can StrCmp it, so get the string with something like system::call '*$R4(&amp;t8 .r0)' and StrCmp $myfoo $r0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ClausG</div><div class="date">10th September 2008, 12:50</div></div><div class="posttext">Originally posted by Anders <br />
you can use the struct handling in system.dll, something like: system::call '*$R4(&amp;t8,&amp;i1 0)' (untested code off the <br />
top of my head)<br />
Okay, I have replaced <br />
System::Alloc ${SameTextSize}<br />
Pop $R4<br />
with <br />
System::Call &quot;*$R4(&amp;t8,i 0)&quot;<br />
<br />
but that is rather pointless since you need to get it out of the memory pointer and into a nsis var before you can StrCmp it, so get the string with something like system::call '*$R4(&amp;t8 .r0)' and StrCmp $myfoo $r0  <br />
I'm not sure if I understand right: I cannot StrCmp my R4? It works (and worked) like a charm if my data is null terminated and if I read the terminating null via MyDll. (There were some changes in other code so it may happen that there is no terminating null. So I like to do it without the null. But this hasn't to do anything with NSIS.)<br />
<br />
Claus</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">10th September 2008, 15:11</div></div><div class="posttext">i did not mean replace, it was just for adding the 0 terminator, but yeah, you can alloc the struct like that, but it would be: System::Call &quot;*(&amp;t8,i 0).R4&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ClausG</div><div class="date">11th September 2008, 06:41</div></div><div class="posttext">Thank you, Anders, for your help. I'm doing now:<br />
!define SameText &quot;SomeText&quot;   <br />
!define SameTextSize 8<br />
System::Alloc ${SameTextSize}+1<br />
Pop $R4<br />
System::Call &quot;MyDll::ReadMem(.r14, ${SameTextSize}) .r13&quot;<br />
   ; fill SameTextSize bytes into $R4<br />
StrCmp $R3 0 CallFailed <br />
System::Call &quot;*$R4(&amp;t${SameTextSize},&amp;i1 0)&quot;<br />
StrCmp $R4 &quot;${SameText}&quot; 0 WrongData<br />
   ; expected data found<br />
Claus</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">11th September 2008, 11:05</div></div><div class="posttext">I don't understand why you want to zero terminate this string when you can just extract it from the struct like i posted in my 2nd example, just stick .r0 after &amp;t${SameTextSize} and use $0 in the strcmp</div></div><hr />


<div class="post"><div class="posttop"><div class="username">ClausG</div><div class="date">11th September 2008, 14:44</div></div><div class="posttext">Do you mean the following?<br />
<br />
!define SameText &quot;SomeText&quot;   <br />
!define SameTextSize 8<br />
System::Alloc ${SameTextSize}<br />
Pop $R4<br />
System::Call &quot;MyDll::ReadMem(.r14, ${SameTextSize}) .r13&quot;<br />
   ; fill SameTextSize bytes into $R4<br />
StrCmp $R3 0 CallFailed <br />
System::Call &quot;*$R4(&amp;t${SameTextSize} .r0)&quot;<br />
StrCmp $0 &quot;${SameText}&quot; 0 WrongData<br />
   ; expected data found<br />
Yes, I can do it, if this works. But I wasn't really sure that $0 is null terminated this way.<br />
<br />
Claus</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>