<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Problem with the $INSTDIR and registry, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Problem with the $INSTDIR and registry NSIS Discussion" />
	
	<title> Problem with the $INSTDIR and registry [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Problem with the $INSTDIR and registry</div>
<hr />
<div class="pda"><a href="t-71028.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=71028">Problem with the $INSTDIR and registry</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Jubijub</div><div class="date">6th January 2002, 19:05</div></div><div class="posttext">I'm currently makin a mappack for CS.<br />
<br />
I need to know the exact path of the cstrike directory.<br />
<br />
So I've coded it that way : <br />
<br />
<br />
;DIF.nsi<br />
;<br />
;Install script by Jubijub<br />
;<br />
;<br />
;<br />
;init numero de version<br />
  !define VER_MAJOR 1<br />
  !define VER_MINOR 1<br />
<br />
;Nom de l'installer<br />
  Name &quot;DIF-Mappack v${VER_MAJOR}.${VER_MINOR}&quot;<br />
  Caption &quot;-=[D.I.F]=- Mappack v${VER_MAJOR}.${VER_MINOR} by Jubijub&quot;<br />
;Nom du fichier<br />
  OutFile &quot;DIF-mappack_v${VER_MAJOR}.${VER_MINOR}.exe&quot;<br />
<br />
;parametres generaux<br />
  Icon main.ico<br />
  MiscButtonText  &quot;Retour&quot; &quot;Suivant&quot; &quot;Annuler&quot; &quot;Fermer&quot;<br />
;Composants<br />
  EnabledBitmap d:\test\three-check.bmp<br />
  DisabledBitmap d:\test\three-nocheck.bmp<br />
  AutoCloseWindow false<br />
  ShowInstDetails show<br />
  ShowUninstDetails show<br />
  SetCompress auto<br />
  SetDatablockOptimize on<br />
  CRCCheck on<br />
  BGGradient 000000 e21c00 FFFFFF<br />
  InstallColors e21c00 000000<br />
  InstProgressFlags smooth colored<br />
  SetOverwrite ifnewer<br />
  DirShow hide<br />
  DirText &quot;&quot;<br />
<br />
;detection rep half-life<br />
 section &quot;&quot;<br />
  ReadRegStr $INSTDIR HKLM &quot;software\Valve\Half-Life&quot; InstallPath<br />
 SectionEnd<br />
  <br />
;licence<br />
  LicenseText &quot;Vous devez accepter ce qui suit avant de continuer:&quot;<br />
  LicenseData license.txt<br />
;caption<br />
  ComponentText &quot;Ceci installera le pack -=[D.I.F]=- dans le repertoire de Counter-strike&quot;<br />
  DetailsButtonText &quot;Details&quot;<br />
  CompletedText &quot;Operation terminée avec succès&quot;<br />
<br />
InstallDir $INSTDIR<br />
InstallDirRegKey HKLM SOFTWARE\DIF &quot;Install_Dir&quot;<br />
<br />
<br />
;INSTALL<br />
 ; Section principale<br />
  Section &quot;Maps (requis)&quot;<br />
   SetOutPath $INSTDIR\cstrike<br />
   file d:\test\*.wad<br />
   SetOutPath $INSTDIR\cstrike\maps<br />
   file d:\test\maps\*.*<br />
   ;SetOutPath $INSTDIR\cstrike\sound<br />
   ;SetOutPath $INSTDIR\cstrike\gfx<br />
   WriteRegStr HKLM SOFTWARE\DIF &quot;Install_Dir&quot; &quot;$INSTDIR\cstrike&quot;<br />
   WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\DIF&quot; &quot;DisplayName&quot; &quot;DIF Mappack (remove only)&quot;<br />
   WriteRegStr HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\DIF&quot; &quot;UninstallString&quot; '&quot;$INSTDIR\uninstall.exe&quot;'<br />
   WriteUninstaller &quot;uninstall.exe&quot;<br />
 SectionEnd<br />
<br />
 ; section bonus<br />
 Section &quot;Bonus sons kevlar+NV&quot;<br />
  SetOutPath $INSTDIR\cstrike\sound\items<br />
  file d:\test\sounds\items\*.wav<br />
 SectionEnd<br />
<br />
 ; section uninstall<br />
 Section &quot;Uninstall&quot;<br />
  DeleteRegKey HKLM &quot;Software\Microsoft\Windows\CurrentVersion\Uninstall\DIF&quot;<br />
  DeleteRegKey HKLM SOFTWARE\DIF<br />
  Delete $INSTDIR\cstrike\porno.wad<br />
  Delete $INSTDIR\cstrike\cs_thunder.wad<br />
  Delete $INSTDIR\cstrike\maps\cs_beirut.bsp<br />
  Delete $INSTDIR\cstrike\maps\cs_beirut.txt<br />
  Delete $INSTDIR\cstrike\maps\cs_docks_v1.bsp<br />
  Delete $INSTDIR\cstrike\maps\cs_docks_v1.txt<br />
  Delete $INSTDIR\cstrike\maps\cs_thunder.bsp<br />
  Delete $INSTDIR\cstrike\maps\cs_vineyard.bsp<br />
  Delete $INSTDIR\cstrike\maps\cs_vineyard.txt<br />
  Delete $INSTDIR\cstrike\maps\de_dust4ever.bsp<br />
  Delete $INSTDIR\cstrike\maps\de_dust4ever.txt<br />
  Delete $INSTDIR\cstrike\maps\de_kaktus.bsp<br />
  Delete $INSTDIR\cstrike\maps\de_kaktus.txt<br />
  Delete $INSTDIR\cstrike\maps\de_rotterdam.bsp<br />
  Delete $INSTDIR\cstrike\maps\de_rotterdam.txt<br />
  Delete $INSTDIR\cstrike\maps\pa_kruncinator(fr).txt<br />
  Delete $INSTDIR\cstrike\maps\pa_krunchinator.bsp<br />
  Delete $INSTDIR\cstrike\maps\pa_krunchinator.txt<br />
  Delete $INSTDIR\cstrike\maps\pa_krunchinator_readme.txt<br />
  Delete $INSTDIR\cstrike\maps\pa_krunchinator_readme(fr).txt<br />
  Delete $INSTDIR\cstrike\sound\items\equip_nvg.wav<br />
  Delete $INSTDIR\cstrike\sound\items\kevlar.wav<br />
  Delete $INSTDIR\cstrike\sound\items\nvg_off.wav<br />
  Delete $INSTDIR\uninstall.exe<br />
  Delete $INSTDIR\cstrike\uninstall.exe<br />
 SectionEnd<br />
<br />
; eof<br />
<br />
<br />
<br />
I had to disable the directory selection page, because when it was enabled, the detected path (that works) wasn't displayed in the editbox...and the browse function was of no use, because whatever directory you choosed, the mappack installed in the righ directory, the $INSTDIR\cstrike.<br />
<br />
I would like to turn this feature back on, so that people could be able to check if the detected path is right or not</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">6th January 2002, 20:34</div></div><div class="posttext">You should replace this:<br />
<br />
;detection rep half-life <br />
section &quot;&quot; <br />
   ReadRegStr $INSTDIR HKLM &quot;software\Valve\Half-Life&quot; InstallPath <br />
SectionEnd <br />
<br />
with this:<br />
InstallDirRegKey HKLM &quot;software\Valve\Half-Life&quot; &quot;InstallPath &quot;<br />
<br />
Notice that this part of the code is not located in any section.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jubijub</div><div class="date">6th January 2002, 22:02</div></div><div class="posttext">InstallDir $INSTDIR <br />
InstallDirRegKey HKLM SOFTWARE\DIF &quot;Install_Dir&quot; <br />
<br />
thanks, my parameters were wrong :D<br />
<br />
yours are too :D<br />
<br />
--&gt;no &quot;&quot; for the string you want to read...<br />
<br />
InstallDirRegKey HKLM &quot;software\Valve\Half-Life&quot; InstallPath <br />
<br />
et not<br />
<br />
InstallDirRegKey HKLM &quot;software\Valve\Half-Life&quot; &quot;InstallPath&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th January 2002, 11:05</div></div><div class="posttext">You do need quotes if you have spaces in the name. I accidently put space after InstallPath, that is what was wrong.<br />
<br />
The InstallDir $INSTDIR is useless. With InstallDir you should set the default install dir if no other found by InstallDirRegKey.<br />
<br />
So it should be:<br />
InstallDir &quot;C:\Half-Life&quot; <br />
InstallDirRegKey HKLM &quot;software\Valve\Half-Life&quot; &quot;InstallPath&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Jubijub</div><div class="date">7th January 2002, 18:21</div></div><div class="posttext">I realised that my instdir system was not implemented...<br />
<br />
that's ok now...I've tested with a fake key : the program follow the changes, and if I delete the key, the default path is activated...</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>