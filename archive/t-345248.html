<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Windows version outside Section or Function, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Windows version outside Section or Function NSIS Discussion" />
	
	<title> Windows version outside Section or Function [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Windows version outside Section or Function</div>
<hr />
<div class="pda"><a href="t-345248.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=345248">Windows version outside Section or Function</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">oldfriend</div><div class="date">30th May 2012, 20:31</div></div><div class="posttext">Hello, everybody.<br />
<br />
Question is in the title. If I understand existing plugins allow to get Windows version is the section or function. <br />
<br />
Is there any macro which allows to do this outside them?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">30th May 2012, 20:51</div></div><div class="posttext">If you're outside a section or function, you're talking about compiletime. So you want to get the windows version of the machine where your installer is being compiled? Why not just harcode it into the script - you should know your own windows version, after all.<br />
<br />
Anyway, you'll have to do it outside of the compiler, for example using the !system command: http://nsis.sourceforge.net/Docs/Chapter5.html#5.1.12</div></div><hr />


<div class="post"><div class="posttop"><div class="username">oldfriend</div><div class="date">30th May 2012, 21:00</div></div><div class="posttext">Well, actually I need to define execution level depending on the Windows version end user runs my installer on.<br />
<br />
For now I can't test but will it work for example like this?<br />
<br />
!ifdef WINVER_7<br />
      RequestexecutionLevel user<br />
!else !ifdef WINVER_VISTA<br />
      RequestexecutionLevel highest<br />
!else WINVER_XP<br />
      RequestexecutionLevel admin<br />
!endif</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">30th May 2012, 21:39</div></div><div class="posttext">No it will not because !ifdef etc. are compile time conditionals. Also RequestExecutionLevel is a compile time instruction - you cannot change it at run time. If you want a different RequestExecutionLevel you will just have to have a different build for targeting that OS.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">oldfriend</div><div class="date">30th May 2012, 21:47</div></div><div class="posttext">Thank you, Stu. <br />
<br />
Sad, but very clear.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">30th May 2012, 23:12</div></div><div class="posttext">But why? Why treat Vista and 7 differently? (And RequestexecutionLevel has no effect pre Vista) And when UAC is off they are both pretty similar to XP...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">oldfriend</div><div class="date">31st May 2012, 00:06</div></div><div class="posttext">If I use UAC plugin I request execution level &quot;user&quot; for Win7 and at the same time I have to use &quot;admin&quot; level for XP. That's why I wanted to choose this level first of all.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st May 2012, 01:50</div></div><div class="posttext">If I use UAC plugin I request execution level &quot;user&quot; for Win7 and at the same time I have to use &quot;admin&quot; level for XP. That's why I wanted to choose this level first of all.<br />
<br />
Well, like I said, it has no effect on XP. You are probably doing something wrong if the OS version is so important. Remember that not everyone is admin on XP either...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">31st May 2012, 05:50</div></div><div class="posttext">You can use the UAC plugin to elevate your installer on any NT version after 2k. Just set executionlevel user like you're supposed to, then elevate your installer at runtime if there's a need for it.<br />
<br />
Setting requestedexecutionlevel to admin on XP does absolutely nothing: Only Vista and newer use the executionlevel setting (and even then, only if UAC is turned on).</div></div><hr />


<div class="post"><div class="posttop"><div class="username">oldfriend</div><div class="date">31st May 2012, 10:00</div></div><div class="posttext">So what is the principal difference between &quot;RequestExecutionLevel admin&quot; and using UAC plug-in except that fact that UAC plug-in could be used and turned on on any stage (almost) of installer execution?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">31st May 2012, 10:06</div></div><div class="posttext">The UAC plugin allows you to execute instructions as the user (not the administrator) but I'm guessing it is not something you should be looking at. IMHO you need to figure out if you are creating a all users (admin) OR a single user installer (user) and go from there.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">31st May 2012, 11:05</div></div><div class="posttext">I agree with Anders, but to answer your question: Using request admin means that Vista and higher (if UAC is enabled on those OSes) will automatically pop an admin request. That's all it does, nothing more, nothing less. But anything older than Vista (and anything with UAC turned off) will not do anything with the request, so you still have to check for admin access manually using the userinfo plugin. This is the proper way to do things: Either make an all-user installer at admin level to $PROGRAMFILES and HKLM (with both request admin and userinfo plugin verification), or make a single-user installer at userlevel to $(LOCAL)APPDATA and HKCU (with request user).<br />
<br />
Like you said, using the UAC plugin will allow you to elevate at any point in the installation process. This allows you to circumvent the above choice, by doing things both at userlevel and adminlevel at the same time. This solution is however both very complex and quite error-prone. It is definitely not something you should be using unless you're A) overzealous, B) a masochist, or C) extremely sure of yourself. Or, preferably, D) all of the above.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">oldfriend</div><div class="date">31st May 2012, 18:00</div></div><div class="posttext">Thank you, guys. Thank you Anders and MSG. You helped me very much. Thank you for your time and attention.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>