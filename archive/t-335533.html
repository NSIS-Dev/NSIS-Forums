<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" LineFind : discovering an existing line that starts with a dedecated string: HOW?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  LineFind : discovering an existing line that starts with a dedecated string: HOW? NSIS Discussion" />
	
	<title> LineFind : discovering an existing line that starts with a dedecated string: HOW? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  LineFind : discovering an existing line that starts with a dedecated string: HOW?</div>
<hr />
<div class="pda"><a href="t-335533.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=335533">LineFind : discovering an existing line that starts with a dedecated string: HOW?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">within</div><div class="date">3rd October 2011, 13:18</div></div><div class="posttext">Hi there,<br />
<br />
I'd wish to modify a text file only if a dedicated string in this file is NOT written there already.<br />
<br />
I'd like to compare each lines in a file to check if this line starts with a dedicated string, let's say a line can be:<br />
'user is defined as blabla'<br />
<br />
and string to use for check is 'user'.<br />
<br />
so, as soon as, within a file, the script does find a line that starts with 'user' it will stop and goto another part of the script that will do 'action 1', or if it does not find any line that starts with the string 'user', it will do 'action 2'.<br />
<br />
I thought I could use ${LineFind} &quot;[File1]&quot; &quot;[File2|/NUL]&quot; &quot;[LineNumbers]&quot; &quot;Function&quot;<br />
<br />
but I have some difficulties for the 'Function', and compare process...</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd October 2011, 13:58</div></div><div class="posttext">ClearErrors<br />
FileOpen $0 $INSTDIR\file.dat r<br />
IfErrors notfound<br />
loop:<br />
FileRead $0 $1<br />
IfErrors goto notfound<br />
StrCpy $2 $1 4<br />
StrCmp $2 &quot;user&quot; bingo<br />
goto loop<br />
end:<br />
FileClose $0<br />
notfound:<br />
MessageBox MB_OK &quot;Not found.&quot;<br />
goto done<br />
bingo:<br />
MessageBox MB_OK &quot;Found.&quot;<br />
goto done<br />
done:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">3rd October 2011, 16:02</div></div><div class="posttext">Thanks very much MSG for your code!<br />
<br />
I'll test it tomorrow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">3rd October 2011, 20:46</div></div><div class="posttext">Oh, and you should always FileClose. So you could move that to below the done label, I guess.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">4th October 2011, 09:30</div></div><div class="posttext">Indeed, the FileClose was not at the best positon. I had to add anothyer one too, depending on conditions.<br />
<br />
here is my code:<br />
<br />
Section SecSetServ<br />
<br />
	; check if Environement variable is already defined<br />
	ClearErrors<br />
	FileOpen $0 &quot;$WINDIR\system32\drivers\etc\services&quot; a		; Open mode is  &quot;a&quot; for append<br />
	IfErrors notfound<br />
	loop:<br />
	FileRead $0 $1<br />
	IfErrors notfound<br />
	StrCpy $2 $1 4<br />
	StrCmp $2 &quot;user&quot; found<br />
	Goto loop<br />
	notfound:<br />
	Goto done<br />
	found:<br />
	Goto finished<br />
	done: <br />
	FileClose $0<br />
  ; Modify system files (&quot;service&quot; files)<br />
  Call SysFiles						<br />
  Goto veryend<br />
<br />
  finished:<br />
  FileClose $0<br />
  ${GetTime} &quot;&quot; &quot;L&quot; $0 $1 $2 $3 $4 $5 $6<br />
  Push &quot;$2/$1/$0 $4:$5:$6 [INSTALL] - Services ports ALREADY defined.$\r$\n $\r$\n&quot; ;text to write to file <br />
  Push &quot;$INSTDIR\_setup.log&quot; ;file to write to <br />
  Call WriteToFile<br />
<br />
  veryend:<br />
  <br />
SectionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">4th October 2011, 10:35</div></div><div class="posttext">tested with success!<br />
<br />
Thanks MSG</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MSG</div><div class="date">4th October 2011, 12:49</div></div><div class="posttext">Next up: Using LogicLib instead of Strcmp and goto's. :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">within</div><div class="date">4th October 2011, 14:10</div></div><div class="posttext">I didn't know about this one; looks cool. Thanks for the tip!</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>