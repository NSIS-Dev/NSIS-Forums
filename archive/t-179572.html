<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Newb needs help with registry, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Newb needs help with registry NSIS Discussion" />
	
	<title> Newb needs help with registry [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Newb needs help with registry</div>
<hr />
<div class="pda"><a href="t-179572.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=179572">Newb needs help with registry</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">10th May 2004, 23:29</div></div><div class="posttext">Alright first of all, sorry that I don't know much, its hard to learn a new code from switching from a completely different installer that does everything 'automatically'.<br />
<br />
I want a registry value to replace the path of $INSTDIR when my installer asks for the directory path. So i'm guessing I'll have to add a StrCpy in my script but I really dont know the commands for all of this.<br />
<br />
Here's what I want to do exactly:<br />
<br />
The installer changes the $INSTDIR according to a directory in the registry value. But the value also has -url %1 at the end that I don't need.<br />
<br />
HKEY_CLASSES_ROOT\http\shell\open\command<br />
String Value: C:\PROGRA~1\FIREFOX\FIREFOX.EXE -url &quot;%1&quot;<br />
<br />
If it displays something that doesn't contain 'Firefox' in the value then the installer will ignore it and continue with the default $INSTDIR<br />
<br />
Now how would I go about doing all of this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">11th May 2004, 03:32</div></div><div class="posttext">First of all welcome to NSIS. <br />
<br />
To read a string from the registry use ReadRegStr command. Once you have the string you can use the StrStr function from the StrFunc.nsh include file to check for 'firefox'.<br />
<br />
!include &quot;StrFunc.nsh&quot;<br />
${StrStr} ;Active the StrStr Function<br />
<br />
Function .onInit<br />
  ReadRegStr $1 HKCR &quot;http\shell\open\command&quot; &quot;&quot;<br />
  ${StrStr} $0 &quot;$1&quot; &quot;firefox&quot;<br />
  StrCmp $0 &quot;&quot; no_firefox<br />
    ;code for firefox<br />
    StrCpy $INSTDIR &quot;whatever you want if firefox exists&quot;<br />
no_firefox:<br />
  ;other code if needed<br />
Function End<br />
 Hope this helps you out.<br />
<br />
Vytautas ;)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">11th May 2004, 05:59</div></div><div class="posttext">Thanks a lot for the work. Well, now when I compile.. it gives me this error:<br />
...&lt;snip&gt;StrCpy $R1 &quot;$R2&quot; () ($R4)<br />
Pop: $R5<br />
Pop: $R4<br />
Pop: $R3<br />
Pop: $R2<br />
Exch($R1,0)<br />
FunctionEnd<br />
!insertmacro: end of FUNCTION_STRING_StrStr<br />
Function: &quot;.onInit&quot;<br />
Error: command Section not valid in function<br />
Error in script &quot;C:\Program Files\NSIS\first.nsi&quot; on line 5 -- aborting creation process<br />
It looks very strange to me.. as I don't know where its getting 'command Section not valid...'</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">11th May 2004, 08:17</div></div><div class="posttext">Could you attach the script for testing.  It appears that you inserted my code into a section, if thats the case you should remove the lines begining with 'function'.  Although it's probably a better idea to configure the $INSTDIR variable in the .onInit function rather than in a section.<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">11th May 2004, 09:06</div></div><div class="posttext">Here ya go.. I don't have it in a section thats why I was confused too. I was thinking maybe to add some Variables but I don't know how to use em.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">11th May 2004, 23:57</div></div><div class="posttext">Sorry, my fault, :igor: The last line in my code should be 'FunctionEnd' and NOT 'Function End'.<br />
<br />
Sorry about all the confusion.<br />
<br />
Vytautas :o</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">12th May 2004, 06:12</div></div><div class="posttext">Ahhh... nice, it works now! :) Thanks man, I really appreciate it.<br />
<br />
Alright I got two more questions<br />
<br />
Is there a way without InstallOptions to add a checkbox to the Finish page and have it perform a function on exit?<br />
<br />
Also, how do I copy a file into a folder thats randomly generated? I want something like:<br />
Find userchrome-example.css inside the [*RANDOM*] folder<br />
IfFileExists thispart<br />
thispart:<br />
File Myfile.css<br />
CopyFiles Myfile.css [*RANDOM*]</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">12th May 2004, 08:30</div></div><div class="posttext">For the finish page you should use this code: !define MUI_FINISHPAGE_RUN<br />
!define MUI_FINISHPAGE_RUN_FUNCTION 'yourfunctionname'<br />
Vytautas :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">13th May 2004, 01:57</div></div><div class="posttext">alright. one last question, i'm using the following code to convert my short path names (PROGRA~1 = PROGRAM FILES) StrCpy $0 &quot;C:\Progra~1&quot;<br />
StrCpy $1 &quot;&quot;<br />
System::Call &quot;Kernel32::GetLongPathNameA(t '$0', &amp;t .r1, i \<br />
  ${NSIS_MAX_STRLEN}) i .s&quot;<br />
Pop $0<br />
IntCmp $0 ${NSIS_MAX_STRLEN} +2 +2 0<br />
  Abort &quot;failed!&quot;<br />
DetailPrint &quot;$0 - $1&quot; but it doesn't seem to work.<br />
<br />
I'm trying to grab the value of my registry which is $5 to convert that to a long file name. Then using the result as my $INSTDIR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">13th May 2004, 02:08</div></div><div class="posttext">GetFullPathName /short user_var(output) path_or_file</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">13th May 2004, 02:16</div></div><div class="posttext">Originally posted by deguix <br />
GetFullPathName /short user_var(output) path_or_file <br />
but thats to Shorten a Long File name.. I'm talking about Expanding a Short Name</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">13th May 2004, 03:23</div></div><div class="posttext">Oh, sorry, I didn't read all... But I can help you, see this line you posted above?<br />
<br />
System::Call &quot;Kernel32::GetLongPathNameA(t '$0', &amp;t .r1, i \<br />
${NSIS_MAX_STRLEN}) i .s&quot;<br />
<br />
The result is returned to variable $1, as you specified on that bold part I marked.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">13th May 2004, 12:10</div></div><div class="posttext">You can use GetFullPathName to convert short file names to long file names:<br />
StrCpy $0 &quot;C:\PROGRA~1&quot;<br />
GetFullPathName $1 $0<br />
<br />
; $1 = &quot;C:\Program Files&quot;</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">13th May 2004, 22:04</div></div><div class="posttext">Still doesnt work.. all I need is it to convert my $5 to a long folder value and $7 will be the result<br />
<br />
$5 is a ReadRegStr command btw<br />
<br />
so now when im finished the $INSTLDIR will be $7</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">14th May 2004, 03:20</div></div><div class="posttext">Do the folder you're trying to transform to long path form exists in your computer? It only works when exists the folder especified. Localizated Windows versions contain different folder names.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">14th May 2004, 04:46</div></div><div class="posttext">Alright so it works.. kinda<br />
<br />
It spit out the C:\Program Files part but it removed the extra stuff after it :(<br />
<br />
The registry key was like C:\PROGRA~1\FIREFOX<br />
<br />
How would I make it display the text after Program Files?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Vytautas</div><div class="date">14th May 2004, 06:05</div></div><div class="posttext">Have you tried adding a \ to the end of the path?<br />
<br />
Vytautas</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">14th May 2004, 13:14</div></div><div class="posttext">GetFullPathName does not seem to work properly on my Win98SE system.<br />
<br />
GetFullPathName $1 &quot;C:\PROGRA~1&quot;<br />
<br />
; $1 = &quot;C:\Program Files&quot;<br />
<br />
GetFullPathName $2 &quot;C:\PROGRA~1\MOZILL~2&quot;<br />
<br />
; $2 = &quot;C:\PROGRA~1\Mozilla Firefox&quot;<br />
<br />
I expected $2 to hold &quot;C:\Program Files\Mozilla Firefox&quot;<br />
<br />
I can use GetParent to split the path up, convert each component and put them back together again but this is more work than I expected.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">15th May 2004, 03:16</div></div><div class="posttext">It's not your fault, it's NSIS fault. This a reproducable BUG. Thanks pengyou.<br />
<br />
Using the System Plugin code above returns the correct result. Why doesn't GetFullPathName return the right value as it should?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">15th May 2004, 05:07</div></div><div class="posttext">Hmm.. how bout an easier way<br />
<br />
Is there a faster way to just like copy and change the strings:<br />
<br />
change from $1(my registry which contains short names)<br />
PROGRA~ = Program Files<br />
MOZILL~ = Mozilla<br />
to $INSTDIR</div></div><hr />


<div class="post"><div class="posttop"><div class="username">darkstar559</div><div class="date">16th May 2004, 11:29</div></div><div class="posttext">what about my random folder idea? anyone know how I would do that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">16th May 2004, 11:59</div></div><div class="posttext">Use ${StrRep} from StrFun.nsh, or see the Archive for String Replacer.<br />
<br />
About random, use nsRandom plugin from Archive downloads.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>