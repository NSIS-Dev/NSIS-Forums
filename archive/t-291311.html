<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Handling a variable number of sections?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Handling a variable number of sections? NSIS Discussion" />
	
	<title> Handling a variable number of sections? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Handling a variable number of sections?</div>
<hr />
<div class="pda"><a href="t-291311.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=291311">Handling a variable number of sections?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Lone Shepherd</div><div class="date">5th May 2008, 15:07</div></div><div class="posttext">The installer I am working on has the primary function of copying over some library files and creating a couple of scripts based on user input during the install.<br />
<br />
The installer will:<br />
<br />
 Install the new version in folder My App\Version 1.4<br />
 Optionally install common library in My App\Common<br />
  Optionally remove older versions (My App\Version 1.3, My App\Version 1.2, etc).<br />
<br />
<br />
I have the first couple down.  For the second, I understand that I need to use locate in the install directory to find all the versions that are currently installed, and then put those on the components page, and then during the install do an RMDir on the Version (whatever) folder if the user wants to remove the old version.<br />
<br />
But I'm not quite sure how to set up displaying a variable number of sections and then handling those sections during install.<br />
<br />
Can anyone help walk me through this?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Anders</div><div class="date">5th May 2008, 15:17</div></div><div class="posttext">the number of sections is hardcoded at compile time, you could probably add x number of hidden sections and use those, or you could use something other than a components page; a custom page with checkboxes or a listview</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lone Shepherd</div><div class="date">5th May 2008, 15:33</div></div><div class="posttext">Thanks for the quick reply; that seems like it would be fine.  So I would have say, 5 hidden sections with a tag for each so I can address it in a function to show it?<br />
<br />
I'm not clear on how I would iterate on a list of X old versions to enable these sections, though.<br />
<br />
I'll play with it, but some sample code would be great if anyone feels the inclination.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Lone Shepherd</div><div class="date">12th May 2008, 20:22</div></div><div class="posttext">Any thoughts?  What I need to do:<br />
<br />
Create 5 hidden sections.<br />
Search the directory My App for subdirs starting with &quot;Version&quot;<br />
<br />
Populate a components page with each of those found folder names (ie, the hidden sections)<br />
<br />
Version 1.3<br />
Version 1.2<br />
<br />
etc. where checking the section / component will remove that subdir during the install.<br />
<br />
Any pointers, the more specific the better, appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Red Wine</div><div class="date">12th May 2008, 21:43</div></div><div class="posttext">I guess you mean something like this, change the plugins with a folder name which does not exist and see the difference.<br />
<br />
outfile test.exe<br />
showinstdetails show<br />
InstallDir &quot;$PROGRAMFILES\My app&quot;<br />
<br />
!include logiclib.nsh<br />
<br />
page components func_pre<br />
page directory<br />
page instfiles<br />
<br />
section &quot;Main App&quot; sec1<br />
<br />
 sectionin ro<br />
 detailprint &quot;now installing&quot;<br />
<br />
sectionend<br />
<br />
<br />
<br />
section /o &quot;&quot; sec2<br />
<br />
 detailprint &quot;now removing plugins directory&quot;<br />
<br />
sectionend<br />
<br />
<br />
<br />
Function .oninit<br />
<br />
Readregstr $0 HKLM &quot;Software\NSIS&quot; &quot;&quot;<br />
${Unless} ${Errors}<br />
${If} ${FileExists} &quot;$0\plugins\*.*&quot;<br />
  SectionSetText ${sec2} &quot;Remove plugins directory&quot;<br />
  SectionGetFlags ${sec2} $0<br />
  Intop $0 $0 | 1<br />
  SectionSetflags ${sec2} $0<br />
  Strcpy $R0 &quot;Showpage&quot;<br />
${Endif}<br />
${Endunless}<br />
<br />
FunctionEnd<br />
<br />
Function func_pre<br />
<br />
${IfThen} $R0 != &quot;Showpage&quot; ${|} Abort ${|}<br />
<br />
Functionend</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>