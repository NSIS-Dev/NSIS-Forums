<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" small problem with DotNET.nsh, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  small problem with DotNET.nsh NSIS Discussion" />
	
	<title> small problem with DotNET.nsh [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  small problem with DotNET.nsh</div>
<hr />
<div class="pda"><a href="t-304135.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=304135">small problem with DotNET.nsh</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">casioclave</div><div class="date">13th March 2009, 14:20</div></div><div class="posttext">I think you know this script<br />
<br />
<br />
# DotNET version checking macro.<br />
# Written by AnarkiNet(AnarkiNet@gmail.com) originally, modified by eyal0 (for use in http://www.sourceforge.net/projects/itwister)<br />
# Downloads and runs the Microsoft .NET Framework version 2.0 Redistributable and runs it if the user does not have the correct version.<br />
# To use, call the macro with a string:<br />
# !insertmacro CheckDotNET &quot;2&quot;<br />
# !insertmacro CheckDotNET &quot;2.0.9&quot;<br />
# (Version 2.0.9 is less than version 2.0.10.)<br />
# All register variables are saved and restored by CheckDotNet<br />
# No output<br />
 <br />
!macro CheckDotNET DotNetReqVer<br />
  !define DOTNET_URL &quot;http://www.microsoft.com/downloads/info.aspx?na=90&amp;p=&amp;SrcDisplayLang=en&amp;SrcCategoryId=&amp;SrcFamilyId=0856eacb-4362-4b0d-8edd-aab15c5e04f5&amp;u=http%3a%2f%2fdownload.microsoft.com%2fdownload%2f5%2f6%2f7%2f567758a3-759e-473e-bf8f-52154438565a%2fdotnetfx.exe&quot;<br />
  DetailPrint &quot;Checking your .NET Framework version...&quot;<br />
  ;callee register save<br />
  Push $0<br />
  Push $1<br />
  Push $2<br />
  Push $3<br />
  Push $4<br />
  Push $5<br />
  Push $6 ;backup of intsalled ver<br />
  Push $7 ;backup of DoNetReqVer<br />
 <br />
  StrCpy $7 ${DotNetReqVer}<br />
 <br />
  System::Call &quot;mscoree::GetCORVersion(w .r0, i ${NSIS_MAX_STRLEN}, *i r2r2) i .r1 ?u&quot;<br />
 <br />
  ${If} $0 == 0<br />
  	DetailPrint &quot;.NET Framework not found, download is required for program to run.&quot;<br />
    Goto NoDotNET<br />
  ${EndIf}<br />
 <br />
  ;at this point, $0 has maybe v2.345.678.<br />
  StrCpy $0 $0 $2 1 ;remove the starting &quot;v&quot;, $0 has the installed version num as a string<br />
  StrCpy $6 $0<br />
  StrCpy $1 $7 ;$1 has the requested verison num as a string<br />
 <br />
  ;MessageBox MB_OKCANCEL &quot;found $0&quot; IDCANCEL GiveUpDotNET<br />
    <br />
  ;MessageBox MB_OKCANCEL &quot;looking for $1&quot; IDCANCEL GiveUpDotNET<br />
 <br />
  ;now let's compare the versions, installed against required &lt;part0&gt;.&lt;part1&gt;.&lt;part2&gt;.<br />
  ${Do}<br />
    StrCpy $2 &quot;&quot; ;clear out the installed part<br />
    StrCpy $3 &quot;&quot; ;clear out the required part<br />
 <br />
    ${Do}<br />
      ${If} $0 == &quot;&quot; ;if there are no more characters in the version<br />
        StrCpy $4 &quot;.&quot; ;fake the end of the version string<br />
      ${Else}<br />
        StrCpy $4 $0 1 0 ;$4 = character from the installed ver<br />
        ${If} $4 != &quot;.&quot;<br />
          StrCpy $0 $0 ${NSIS_MAX_STRLEN} 1 ;remove that first character from the remaining<br />
        ${EndIf}<br />
      ${EndIf}<br />
      <br />
      ${If} $1 == &quot;&quot;  ;if there are no more characters in the version<br />
        StrCpy $5 &quot;.&quot; ;fake the end of the version string<br />
      ${Else}<br />
        StrCpy $5 $1 1 0 ;$5 = character from the required ver<br />
        ${If} $5 != &quot;.&quot;<br />
          StrCpy $1 $1 ${NSIS_MAX_STRLEN} 1 ;remove that first character from the remaining<br />
        ${EndIf}<br />
      ${EndIf}<br />
      ;MessageBox MB_OKCANCEL &quot;installed $2,$4,$0 required $3,$5,$1&quot; IDCANCEL GiveUpDotNET<br />
      ${If} $4 == &quot;.&quot;<br />
      ${AndIf} $5 == &quot;.&quot;<br />
        ${ExitDo} ;we're at the end of the part<br />
      ${EndIf}<br />
 <br />
      ${If} $4 == &quot;.&quot; ;if we're at the end of the current installed part<br />
        StrCpy $2 &quot;0$2&quot; ;put a zero on the front<br />
      ${Else} ;we have another character<br />
        StrCpy $2 &quot;$2$4&quot; ;put the next character on the back<br />
      ${EndIf}<br />
      ${If} $5 == &quot;.&quot; ;if we're at the end of the current required part<br />
        StrCpy $3 &quot;0$3&quot; ;put a zero on the front<br />
      ${Else} ;we have another character<br />
        StrCpy $3 &quot;$3$5&quot; ;put the next character on the back<br />
      ${EndIf}<br />
    ${Loop}<br />
    ;MessageBox MB_OKCANCEL &quot;finished parts: installed $2,$4,$0 required $3,$5,$1&quot; IDCANCEL GiveUpDotNET<br />
 <br />
    ${If} $0 != &quot;&quot; ;let's remove the leading period on installed part if it exists<br />
      StrCpy $0 $0 ${NSIS_MAX_STRLEN} 1<br />
    ${EndIf}<br />
    ${If} $1 != &quot;&quot; ;let's remove the leading period on required part if it exists<br />
      StrCpy $1 $1 ${NSIS_MAX_STRLEN} 1<br />
    ${EndIf}<br />
 <br />
    ;$2 has the installed part, $3 has the required part<br />
    ${If} $2 S&lt; $3<br />
      IntOp $0 0 - 1 ;$0 = -1, installed less than required<br />
      ${ExitDo}<br />
    ${ElseIf} $2 S&gt; $3<br />
      IntOp $0 0 + 1 ;$0 = 1, installed greater than required<br />
      ${ExitDo}<br />
    ${ElseIf} $2 == &quot;&quot;<br />
    ${AndIf} $3 == &quot;&quot;<br />
      IntOp $0 0 + 0 ;$0 = 0, the versions are identical<br />
      ${ExitDo}<br />
    ${EndIf} ;otherwise we just keep looping through the parts<br />
  ${Loop}<br />
 <br />
  ${If} $0 &lt; 0<br />
    DetailPrint &quot;.NET Framework Version found: $6, but is older than the required version: $7&quot;<br />
    Goto OldDotNET<br />
  ${Else}<br />
    DetailPrint &quot;.NET Framework Version found: $6, equal or newer to required version: $7.&quot;<br />
    Goto NewDotNET<br />
  ${EndIf}<br />
 <br />
NoDotNET:<br />
    MessageBox MB_YESNOCANCEL|MB_ICONEXCLAMATION \<br />
    &quot;.NET Framework not installed.$\nRequired Version: $7 or greater.$\nDownload .NET Framework version from www.microsoft.com?&quot; \<br />
    /SD IDYES IDYES DownloadDotNET IDNO NewDotNET<br />
    goto GiveUpDotNET ;IDCANCEL<br />
OldDotNET:<br />
    MessageBox MB_YESNOCANCEL|MB_ICONEXCLAMATION \<br />
    &quot;Your .NET Framework version: $6.$\nRequired Version: $7 or greater.$\nDownload .NET Framework version from www.microsoft.com?&quot; \<br />
    /SD IDYES IDYES DownloadDotNET IDNO NewDotNET<br />
    goto GiveUpDotNET ;IDCANCEL<br />
 <br />
DownloadDotNET:<br />
  DetailPrint &quot;Beginning download of required .NET Framework version.&quot;<br />
  NSISDL::download ${DOTNET_URL} &quot;$TEMP\dotnetfx.exe&quot;<br />
  DetailPrint &quot;Completed download.&quot;<br />
  Pop $0<br />
  ${If} $0 == &quot;cancel&quot;<br />
    MessageBox MB_YESNO|MB_ICONEXCLAMATION \<br />
    &quot;Download cancelled.  Continue Installation?&quot; \<br />
    IDYES NewDotNET IDNO GiveUpDotNET<br />
  ${ElseIf} $0 != &quot;success&quot;<br />
    MessageBox MB_YESNO|MB_ICONEXCLAMATION \<br />
    &quot;Download failed:$\n$0$\n$\nContinue Installation?&quot; \<br />
    IDYES NewDotNET IDNO GiveUpDotNET<br />
  ${EndIf}<br />
  DetailPrint &quot;Pausing installation while downloaded .NET Framework installer runs.&quot;<br />
  ExecWait '$TEMP\dotnetfx.exe /q /c:&quot;install /q&quot;'<br />
  DetailPrint &quot;Completed .NET Framework install/update. Removing .NET Framework installer.&quot;<br />
  Delete &quot;$TEMP\dotnetfx.exe&quot;<br />
  DetailPrint &quot;.NET Framework installer removed.&quot;<br />
  goto NewDotNet<br />
 <br />
GiveUpDotNET:<br />
  Abort &quot;Installation cancelled by user.&quot;<br />
 <br />
NewDotNET:<br />
  DetailPrint &quot;Proceeding with remainder of installation.&quot;<br />
  Pop $0<br />
  Pop $1<br />
  Pop $2<br />
  Pop $3<br />
  Pop $4<br />
  Pop $5<br />
  Pop $6 ;backup of intsalled ver<br />
  Pop $7 ;backup of DoNetReqVer<br />
!macroend<br />
<br />
<br />
The problem is:<br />
I've got a message when my dotNET is older when required<br />
<br />
&quot;Your .NET Framework version: . <br />
 Required version: 2 or greater&quot;<br />
<br />
So why &quot;Your .NET Framework version: . &quot; is empty?<br />
Where is an error?<br />
I whant to show my current version of .NET<br />
For example &quot;Your .NET Framework version: 1.1&quot;<br />
And if I have not got .NET at all, I want to show<br />
&quot;Your .NET Framework version: NOT FOUND &quot; for example</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tossnet</div><div class="date">22nd January 2011, 15:08</div></div><div class="posttext">+1<br />
I have the same problem on an old Windows 2000 without Framework.NET<br />
And on a Windows 7 with all framework the message<br />
  Your .NET Framework version: 2.0.50727<br />
  Required Version 3.5sp1 or greater<br />
  ...<br />
Some help please :rolleyes:<br />
(Maybe is there anothere plug in to detect/install/download FrameWork.net ?)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">tossnet</div><div class="date">24th January 2011, 16:58</div></div><div class="posttext">I found. If it helps someone one days : http://stochfit.svn.sourceforge.net/viewvc/stochfit/trunk/StochFitMain/Installer.nsi?revision=108&amp;view=markup</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>