<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" pass a variable to a macro, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  pass a variable to a macro NSIS Discussion" />
	
	<title> pass a variable to a macro [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  pass a variable to a macro</div>
<hr />
<div class="pda"><a href="t-327482.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=327482">pass a variable to a macro</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">nadigo</div><div class="date">17th February 2011, 15:47</div></div><div class="posttext">Hi, <br />
<br />
I am trying to pass a variable to a macro and have the macro have a condition based on that variable.<br />
I tried usign VAR and !define and it didnt work.<br />
<br />
I need to have the macro do different things based on the variables sent to it.<br />
how can I do it ?<br />
<br />
this will not work:<br />
<br />
Var /GLOBAL XYZ<br />
StrCpy $XYZ &quot;New&quot;<br />
MessageBox MB_OK &quot;$XYZ&quot; ; I get &quot;New&quot;<br />
!define CONST_XYZ  &quot;$XYZ&quot; ; not working <br />
<br />
<br />
insertmacro MACRO_TEST $XYZ ; Not working <br />
<br />
!insertmacro MACRO_TEST &quot;${$XYZ}&quot; ; not wokring <br />
<br />
<br />
<br />
!macro MACRO_TEST varXYZ<br />
<br />
!If ${varXYZ}  != &quot;New&quot; <br />
<br />
;....<br />
!endif<br />
<br />
!macroend</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">17th February 2011, 15:59</div></div><div class="posttext">I've said this countless times and no doubt I will have to carry on saying it. You are confusing run time (variables) with compile time (macros, defines etc). Hopefully I need not say any more...<br />
<br />
Edit: Tip; ${If} not !if.<br />
<br />
Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">nadigo</div><div class="date">17th February 2011, 16:19</div></div><div class="posttext">the problem is that I have a VAR and I want to pass it to the macro.<br />
<br />
VAR XYZ &quot;New&quot;<br />
!define XYZ_CON &quot;$XYZ&quot;<br />
<br />
!insertmacro SEARCH_OFFERING &quot;${XYZ_CON}&quot;<br />
!insertmacro SEARCH_OFFERING &quot;$XYZ&quot;<br />
!insertmacro SEARCH_OFFERING $XYZ<br />
<br />
none of the above will compile as <br />
<br />
!insertmacro SEARCH_OFFERING &quot;New&quot;<br />
<br />
why ???</div></div><hr />


<div class="post"><div class="posttop"><div class="username">demiller9</div><div class="date">17th February 2011, 17:20</div></div><div class="posttext">Why?? Because the macro is compiled long before the code is run. The variable doesn't have a value until the code is run; the macro cannot be compiled with a value that does not exist.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">18th February 2011, 02:12</div></div><div class="posttext">I thought that you are abusing or misapplying some commands. Like Afrow UK &amp; demiller9 said, the commands start with an exclamation are compiling commands. They are only used to tell compiler which lines to compile. The macro is similar, it will be expanded. Thought you see maro is short when using in script, but in fact the script is the same.<br />
<br />
Example 1:<br />
!define VAR1 AAA<br />
!define VAR2 ${VAR1}BBB<br />
Equals to you !define VAR2 AAABBB<br />
<br />
Example 2:<br />
!macro MYMACRO PARAM1 PARAM2 PARAM3<br />
 MessageBox MB_OK `${PARAM1}`<br />
 MessageBox MB_YESNO `${PARAM2}`<br />
 MessageBox MB_OKCANCEL `${PARAM3}`<br />
!macroend<br />
When using:<br />
!insertmacro MYMACRO A B C<br />
!insertmacro MYMACRO D E F<br />
It completely equals to 6 lines:<br />
 MessageBox MB_OK `A`<br />
 MessageBox MB_YESNO `B`<br />
 MessageBox MB_OKCANCEL `C`<br />
 MessageBox MB_OK `D`<br />
 MessageBox MB_YESNO `E`<br />
 MessageBox MB_OKCANCEL `F`<br />
<br />
In NSIS script, !define and !macro command only replace the text simplely, except some especial pre-defined constants, like !define a constant to %x with &quot;/date&quot; option. The command !define is commonly used to define a name to a fixed constant value, so that you can remember it easily rather than an irregular value, or define a value that used in your script mutiple times. This is almost the same to C++.<br />
<br />
Define a easy-remembered name:<br />
!define WM_CLOSE 0x0010<br />
Modify this line will change all values of ${PI} in script rather than modify every one:<br />
!define PI 3.14<br />
<br />
Fisrt, &quot;var&quot; command can't assign a value.<br />
VAR XYZ &quot;New&quot;<br />
Second, you define XYZ_CON to $XYZ means tell the compiler that the value of constant ${XYZ_CON} is $XYZ.<br />
!define XYZ_CON &quot;$XYZ&quot;<br />
<br />
So when compiling the !insertmacro SEARCH_OFFERING &quot;${XYZ_CON}&quot; line, ${XYZ_CON} would be replaced with $XYZ simplely. That is the following 3 lines are the same.<br />
!insertmacro SEARCH_OFFERING &quot;${XYZ_CON}&quot;<br />
!insertmacro SEARCH_OFFERING &quot;$XYZ&quot;<br />
!insertmacro SEARCH_OFFERING $XYZ</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jiake</div><div class="date">18th February 2011, 06:22</div></div><div class="posttext">To pass variables to a macro, you can use CallArtificialFunciton macro in Util.nsh, or use a function call, and you must use NSIS stack for exchange values.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>