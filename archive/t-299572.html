<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" NSIS, XP Embedded and EWF, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  NSIS, XP Embedded and EWF NSIS Discussion" />
	
	<title> NSIS, XP Embedded and EWF [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  NSIS, XP Embedded and EWF</div>
<hr />
<div class="pda"><a href="t-299572.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=299572">NSIS, XP Embedded and EWF</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">MrK2</div><div class="date">5th November 2008, 11:52</div></div><div class="posttext">I'm using NSIS to install software in a XP embedded system which has the EWF (a filesystem protection system) enabled.<br />
<br />
Even when I disable EWF, the installer acts weird, specially with files to be copied on reboot: They usually don't get copied. Has anyone found a similar problem so that I can have a look at it? (the forum shows nothng about EWF)<br />
<br />
The installer works flawlessly on a normal XP with no EWF.<br />
<br />
TIA,<br />
Jordi</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">7th November 2008, 22:40</div></div><div class="posttext">What exactly does EWF do and is it an official Microsoft product?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MrK2</div><div class="date">18th November 2008, 18:42</div></div><div class="posttext">Originally posted by kichik <br />
What exactly does EWF do and is it an official Microsoft product?  <br />
<br />
Hi kichik,<br />
<br />
sorry for the delay. EWF is a &quot;Write Filter&quot;. It basically protects the hard disk by using a memory overlay, and every write done to the hard  disk is &quot;redirected&quot; to memory, so that you don't really modify your HD and can boot exactly the same way across reboots (it's widely used for embedded devices).<br />
<br />
There are tools to commit changes (of course, otherwise you couldn't write to HD), but sometimes NSIS just doesn't write those files even when you've commited the overlay :?<br />
<br />
It is indeed an official Microsoft product, although (afaik) it is only available to XP embedded.<br />
<br />
<br />
EDIT: I think it might be related to the MoveFileEx Function (supposing that NSIS is using it to delete &amp; copy the final name).Is the 'move' of MoveFileEx effective before the reboot or just after the system boots?<br />
<br />
EDIT2: I'm having a look at the windows event viewer. When I reboot under the circumstances that make the files disappear, I get an event 1524 and 1517, but I don't know if those could be the cause.<br />
<br />
EDIT3: I think I've found the problem. All my software is installed to d:\, and the TEMP &amp; TMP are pointing to e:\temp. If I change it to d:\temp then everything works... does that make sense???? D and E are obviously different primary partitions.<br />
<br />
The thing is I don't want to have the swap in the d:, as it could be a CF (although it isn't now) and I'd prefer to avoid all writes to it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MrK2</div><div class="date">19th November 2008, 08:44</div></div><div class="posttext">OK, I think it's really a MoveFileEX behaviour problem. From MSDN's documentation <br />
<br />
<br />
<br />
MOVEFILE_COPY_ALLOWED<br />
<br />
If the file is to be moved to a different volume, the function simulates the move by using the CopyFile and DeleteFile functions.<br />
<br />
This value cannot be used with MOVEFILE_DELAY_UNTIL_REBOOT.<br />
<br />
<br />
So, if I want to move the file to another volume I'd have to specify MOVEFILE_COPY_ALLOWED, but I can't because it must be done on reboot.<br />
<br />
Does anybody has a clever idea about how to do that? I'm really lost and the deadline is here :confused: :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">19th November 2008, 18:56</div></div><div class="posttext">You should create the temporary file right next to the file you want to overwrite. Use GetTempFilename for that. The second parameter specifies the base directory.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">MrK2</div><div class="date">20th November 2008, 11:14</div></div><div class="posttext">Originally posted by kichik <br />
You should create the temporary file right next to the file you want to overwrite. Use GetTempFilename for that. The second parameter specifies the base directory.  <br />
<br />
That's it, lots of thanks! :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>