<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Refreshing the desktop background - possible?, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Refreshing the desktop background - possible? NSIS Discussion" />
	
	<title> Refreshing the desktop background - possible? [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Refreshing the desktop background - possible?</div>
<hr />
<div class="pda"><a href="t-144300.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=144300">Refreshing the desktop background - possible?</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Nebulus</div><div class="date">1st August 2003, 03:01</div></div><div class="posttext">Ok, I'm making an installer for an embeded flash desktop, which is basically a very formatted HTML page with a flash file in it. When set to the desktop background, it can make for some very nice desktop apps.<br />
<br />
Anyway, I can edit the registry entry for the wallpaper, and I can get the files into %systemroot%\web\wallpaper like they need to be. However, just setting the registry value isn't enough - the desktop background has to be refreshed.<br />
<br />
Has anyone done this, or do you know how to? Any help would be appreciated. Thanks!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 13:41</div></div><div class="posttext">You could do a Reboot, or you could use the System DLL.<br />
I'd help you but I don't know where to start [System DLL side] :p<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 13:43</div></div><div class="posttext">There is a &quot;Change resolution&quot; Plugin on the NSIS Archive downloads page (http://nsis.sourceforge.net/archive/download.php).<br />
Maybe that could help (source)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nebulus</div><div class="date">1st August 2003, 13:45</div></div><div class="posttext">Thanks, I'll check it out!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 14:17</div></div><div class="posttext">I have found the solution here:<br />
http://forums.winamp.com/showthread.php?s=&amp;threadid=71924&amp;highlight=desktop<br />
<br />
-Stu :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nebulus</div><div class="date">1st August 2003, 14:25</div></div><div class="posttext">Nah, I tried that as well. Like that thread mentions, the desktop refreshes, but the active desktop/wallpaper doesn't update. This is a weird thing that I just don't get. Any reason the deasktop refreshes without sending an update to the wallpaper/active desktop?<br />
<br />
Thanks for the help!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 14:35</div></div><div class="posttext">Hmm looking at my Registry, once the string setting the path to my desktop image is changed, I have to go to desktop properties to apply it.<br />
<br />
I think that a while ago, somone wrote a System dll call which opened up the desktop properties dialog box...<br />
<br />
Try searching for that<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 14:40</div></div><div class="posttext">Ok, this should open desktop properties<br />
<br />
ExecShell open &quot;rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,3&quot;<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nebulus</div><div class="date">1st August 2003, 15:02</div></div><div class="posttext">If NSIS can exec an external vbscript, I've got the answer.<br />
<br />
I did have the script writing to the registry and refreshing the desktop, but it just wasn't updating to display the new page. this code does it. To test, just create a dummy HTML page and set it in your %systemroot%\web\wallpaper directory, then change the script to point to the correctly named page.<br />
<br />
Running the script will set the desktop, open the display properties window, move the selection up/down, then click the OK button. It's dirty, but it gets done!<br />
<br />
****************************************<br />
BEGIN CODE<br />
****************************************<br />
' Create the variables needed<br />
Dim WSHShell<br />
Dim WSHApp<br />
Dim strRegKey<br />
Dim strWallpaper<br />
Dim strOSRoot<br />
Dim strDesktop<br />
Dim strDisplayProp<br />
<br />
' Create the Wscript Shell object<br />
Set WSHShell = WScript.CreateObject(&quot;WScript.Shell&quot;)<br />
Set WSHApp   = CreateObject(&quot;Shell.Application&quot;)<br />
<br />
' Define the wallpaper<br />
strWallpaper   = &quot;%SystemRoot%\Web\Wallpaper\PRWeb.html&quot;<br />
strDesktop     = WSHShell.SpecialFolders(&quot;Desktop&quot;)<br />
strDisplayProp = &quot;Display Properties&quot;<br />
<br />
' Create the wallpaper key<br />
strRegKey =  &quot;HKEY_CURRENT_USER\&quot;<br />
strRegKey = strRegKey &amp; &quot;Software\&quot;<br />
strRegKey = strRegKey &amp; &quot;Microsoft\&quot;<br />
strRegKey = strRegKey &amp; &quot;Internet Explorer\&quot;<br />
strRegKey = strRegKey &amp; &quot;Desktop\&quot;<br />
strRegKey = strRegKey &amp; &quot;General\&quot;<br />
strRegKey = strRegKey &amp; &quot;Wallpaper&quot;<br />
<br />
' Write the key, type, and value<br />
WSHShell.RegWrite strRegKey, strWallpaper, &quot;REG_EXPAND_SZ&quot;<br />
<br />
WSHApp.ControlPanelItem cstr(&quot;desk.cpl&quot;)<br />
Do Until WSHShell.AppActivate (strDisplayProp)<br />
Loop<br />
WSHShell.SendKeys &quot;{down}{up}{tab 3}a~&quot;<br />
****************************************<br />
END CODE<br />
****************************************</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 15:08</div></div><div class="posttext">If the vb script is compiled into a basic command-line program, then you can use<br />
<br />
nsExec::Exec &quot;path_to\myvbapp.exe&quot;<br />
<br />
to execute it unseen.<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 15:10</div></div><div class="posttext">Btw, that topic you posted in was created before NSIS 2.0b0 came out :)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Nebulus</div><div class="date">1st August 2003, 15:12</div></div><div class="posttext">Cool, so it could exec the vbs - as long as the user has windows scripting host installed.... <br />
<br />
Is there a function out there for NSIS that'll check for that?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">1st August 2003, 15:30</div></div><div class="posttext">This may be useful:<br />
<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=162<br />
<br />
-Stu</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>