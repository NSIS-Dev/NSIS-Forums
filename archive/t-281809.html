<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" MUI_PAGE_CUSTOMFUNCTION on Windows Vista, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  MUI_PAGE_CUSTOMFUNCTION on Windows Vista NSIS Discussion" />
	
	<title> MUI_PAGE_CUSTOMFUNCTION on Windows Vista [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  MUI_PAGE_CUSTOMFUNCTION on Windows Vista</div>
<hr />
<div class="pda"><a href="t-281809.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=281809">MUI_PAGE_CUSTOMFUNCTION on Windows Vista</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">RegShoe</div><div class="date">20th November 2007, 10:31</div></div><div class="posttext">Hi all,<br />
I've created an installer which has a custom function call upon leaving a page in the installation progress.<br />
This is to check if the chosen directory exists already and/or is empty.<br />
<br />
This works fine on Windows XP, but on Vista the function is called and executed, but then the installation does not continue. Without this custom function the installation does work on Vista, too.<br />
<br />
Here is my code:<br />
<br />
<br />
!insertmacro MUI_PAGE_WELCOME<br />
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE &quot;DirectoryLeave&quot;<br />
!insertmacro MUI_PAGE_DIRECTORY<br />
!insertmacro MUI_PAGE_INSTFILES<br />
!insertmacro MUI_PAGE_FINISH<br />
<br />
[...]<br />
<br />
Function DirectoryLeave<br />
<br />
	${DirState} &quot;$INSTDIR&quot; $R0<br />
	StrCmp $R0 1 0 +2<br />
		MessageBox MB_OKCANCEL|MB_ICONQUESTION &quot;Installation directory $INSTDIR is not empty. Setup will delete all existing files.$\n$\nPress OK to continue anyway, or press CANCEL to choose another directory.&quot; IDOK _ok<br />
	Abort<br />
<br />
	_ok:<br />
	Delete &quot;$INSTDIR\*.*&quot;<br />
<br />
FunctionEnd<br />
<br />
<br />
<br />
Any help would be appreciated.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">20th November 2007, 19:26</div></div><div class="posttext">+2 skips to the next instruction which is Abort. Abort causes the user to stay on the page. I don't see how that'd work even on XP. Use the LogicLib for easier code.${If} $Ro == 1<br />
MessageBox MB_OK blah<br />
Abort<br />
${Else}<br />
Delete ...<br />
${EndIf}</div></div><hr />


<div class="post"><div class="posttop"><div class="username">RegShoe</div><div class="date">21st November 2007, 10:35</div></div><div class="posttext">Hi,<br />
thanks for your help. It seems I had a logical error in my script. ;)<br />
<br />
Also the LogicLib did help me a lot. So, thanks again.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>