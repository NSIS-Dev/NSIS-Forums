<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" Audio Track, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  Audio Track NSIS Discussion" />
	
	<title> Audio Track [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  Audio Track</div>
<hr />
<div class="pda"><a href="t-68034.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=68034">Audio Track</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">8th December 2001, 10:58</div></div><div class="posttext">Can I somehow check with my installer if audio track exist on cd?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">8th December 2001, 11:09</div></div><div class="posttext">Hi Napek,<br />
<br />
if you know the full path to the audio track you could use the IfFileExists command, if you don't know the full path you probably could use the depth-first scan mentioned in this (http://forums.winamp.com/showthread.php?s=&amp;threadid=67601) article.<br />
<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">8th December 2001, 21:03</div></div><div class="posttext">I got a cd with data and audio track and i want installer to check if data track exist if is this possible</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">11th December 2001, 03:50</div></div><div class="posttext">Hi Napek,<br />
<br />
You should be able to check for your data track by checking if certain files exist on the CD.<br />
<br />
If you are familiar with a programming language, you can use MCI to count the number of tracks on a CD. You would need to write a small app to do this though.<br />
<br />
I reckon it would be real cool if someone wrote a small app that allows you to pass an MCI command as a parameter, and the output was written to a small file. Any takers? :D</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">11th December 2001, 19:56</div></div><div class="posttext">I don't want to check for data track w want to my instaler to check if exist audio track on cd with installer. I want it for some kind of primitive protection i want change TOC of cd that you can't copy audio track and if cou copy cd file by file it wont be work if audio track doesn't exist.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">13th December 2001, 10:32</div></div><div class="posttext">Originally posted by Napek<br />
i want installer to check if data track existOriginally posted by Napek<br />
I don't want to check for data trackJust use MCI to check how many tracks exist on the CD. If only one track exists on it then the CD has been improperly copied, because there are no audio tracks.<br />
<br />
If you want even better protection, you can use MCI to measure the length of each and every (data and audio) track, and if one of them differs, you know the CD has been copied.<br />
<br />
Which programming languages are you familiar with? Pretty much every language supports MCI.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">13th December 2001, 18:55</div></div><div class="posttext">Amos on Amiga &amp; scripts for Flash :) If yo can write for me that something you talking about and i can put it in NSIS script i'll be very happy :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">13th December 2001, 22:08</div></div><div class="posttext">Napek, I quickhacked a NSIS extension DLL for you, which pushes the number of audio tracks of the CD in drive $0 on top of the stack - please note that it's a quick hack - source is included ;).<br />
<br />
Use it, modify it and let me know if someone has any improvements or additions to it.<br />
<br />
Regards,<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">14th December 2001, 13:01</div></div><div class="posttext">At petersas suggestion I improved the nsisext_mci.dll a little bit to take any mci command string from stack and execute it. Sources and a small example is included. Error strings or result strings are copied to $0.<br />
<br />
Have Fun :) <br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">14th December 2001, 20:58</div></div><div class="posttext">Thanks :) I'll check what i can do with this and reply tommorow.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">15th December 2001, 10:05</div></div><div class="posttext">Thanks to Florian's excellent work, people are now able to use video files (AVIs, MPEGs, ...) as splash screens!<br />
<br />
If anyone's interested, let me know and I'll post the MCI code.<br />
<br />
I reckon this deserves its own thread.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">15th December 2001, 20:14</div></div><div class="posttext">Ok now i got number of audio tracks and its very good but you say that lenght of audio track can be checked too. Is it possible to add something like this to nsisext_mci?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">16th December 2001, 12:28</div></div><div class="posttext">It's already possible with nsisext_mci :) Try this:<br />
<br />
Name &quot;nsisext_mci&quot;<br />
OutFile &quot;nsisext_mci.exe&quot;<br />
AutoCloseWindow true<br />
<br />
Function .onInit<br />
  SetOutPath $TEMP<br />
  File nsisext_mci.dll<br />
  CallInstDLL nsisext_mci.dll nsisGetFirstCDROMDrive<br />
  StrCpy $2 &quot;open $0 type cdaudio alias nsis wait&quot;<br />
  StrCpy $1 &quot;status nsis number of tracks wait&quot;<br />
  StrCpy $0 &quot;status nsis length track 1&quot;<br />
  Push $0<br />
  Push $1<br />
  Push $2<br />
  CallInstDLL nsisext_mci.dll nsisMCISendString<br />
  MessageBox MB_OK &quot;Length of track 1: $0&quot;<br />
FunctionEnd<br />
<br />
Section<br />
  ; Rest of the setup...<br />
SectionEnd<br />
<br />
Function .onInstSuccess<br />
  Delete nsisext_mci.dll<br />
FunctionEnd<br />
<br />
<br />
For more mci command see the mci reference at MSDN (http://msdn.microsoft.com/library/default.asp?url=/library/en-us/multimed/mmcmdstr_4nub.asp)<br />
<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">18th December 2001, 15:31</div></div><div class="posttext">I try to use something like this:<br />
<br />
StrCpy $6 x (or reading value from registry where x is number of tracks)<br />
StrCmp $0 $6 OK BAD<br />
OK:<br />
MessageBox............<br />
BAD:<br />
MessageBox............<br />
<br />
And it wont work why?<br />
<br />
And how to compare lenght of track on cd with lenght of track that i give as a variable for example track on cd has 30 sec and on my install cd that skould be 28 sec and installer goto BAD: or OK:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">18th December 2001, 21:15</div></div><div class="posttext">It works ;) <br />
<br />
Have a look at this small script and change the numbers I'm comparing to, to your specific requests:<br />
<br />
<br />
Name &quot;nsisext_mci&quot;<br />
OutFile &quot;nsisext_mci.exe&quot;<br />
AutoCloseWindow true<br />
<br />
Function .onInit<br />
  SetOutPath $TEMP<br />
  File nsisext_mci.dll<br />
<br />
# getting information from nsisext_mci<br />
# get the first CD-ROM  drive<br />
  CallInstDLL nsisext_mci.dll nsisGetFirstCDROMDrive<br />
# copy drive to $R0<br />
  StrCpy $R0 $0<br />
# do the track thing<br />
  StrCpy $1 &quot;open $R0 type cdaudio alias nsis wait&quot;<br />
  StrCpy $0 &quot;status nsis number of tracks wait&quot;<br />
  Push $0<br />
  Push $1<br />
  CallInstDLL nsisext_mci.dll nsisMCISendString<br />
  MessageBox MB_OK &quot;Number of tracks: $0&quot;<br />
  StrCpy $R1 $0<br />
# do the length thing in milliseconds<br />
  StrCpy $1 &quot;set nsis time format milliseconds wait&quot;<br />
  StrCpy $0 &quot;status nsis length track 1 wait&quot;<br />
  Push $0<br />
  Push $1<br />
  CallInstDLL nsisext_mci.dll nsisMCISendString<br />
  MessageBox MB_OK &quot;Length of track 1: $0 ms&quot;<br />
  StrCpy $R2 $0<br />
# close the device<br />
  StrCpy $0 &quot;close nsis&quot;<br />
  Push $0<br />
  CallInstDLL nsisext_mci.dll nsisMCISendString<br />
<br />
# proove number of tracks<br />
# 18 or what ever your track count is<br />
  IntCmp $R1 18 lblTrackOK lblTrackBAD<br />
  lblTrackBAD:<br />
    MessageBox MB_OK &quot;BAD CD!&quot;<br />
    Abort<br />
  lblTrackOK:<br />
    MessageBox MB_OK &quot;GOOD CD!&quot;<br />
<br />
# prove track length<br />
# 321294 or what ever your length of track 1 is (in ms)<br />
  IntCmp $R2 321294 lblLengthOK lblLengthBAD<br />
  lblLengthBAD:<br />
    MessageBox MB_OK &quot;BAD length!&quot;<br />
    Abort<br />
  lblLengthOK:<br />
    MessageBox MB_OK &quot;GOOD length!&quot;<br />
FunctionEnd<br />
<br />
Section<br />
  ; Rest of the setup...<br />
SectionEnd<br />
<br />
Function .onInstSuccess<br />
  Delete &quot;$TEMP\nsisext_mci.dll&quot;<br />
FunctionEnd<br />
<br />
<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">eccles</div><div class="date">19th December 2001, 00:10</div></div><div class="posttext">btw, you can simplify some of that e.g. by changing   StrCpy $1 &quot;open $R0 type cdaudio alias nsis wait&quot;<br />
  StrCpy $0 &quot;status nsis number of tracks wait&quot;<br />
  Push $0<br />
  Push $1<br />
  CallInstDLL nsisext_mci.dll nsisMCISendString to   Push &quot;status nsis number of tracks wait&quot;<br />
  Push &quot;open $R0 type cdaudio alias nsis wait&quot;<br />
  CallInstDLL nsisext_mci.dll nsisMCISendString -- <br />
Dave.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">19th December 2001, 09:06</div></div><div class="posttext">Thanks Dave, - it was my first time on NSIS stack :) <br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">19th December 2001, 20:17</div></div><div class="posttext">Everything working fine BUT if no cd in cd-rom there is an error message mybe you can do something with this and one more thing secconds will be better to check lenght of the track. I got hope that us work will be added to NSIS :). F. Heidenreich you great :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">19th December 2001, 20:32</div></div><div class="posttext">You could comment out the MessageBox calls - no error messages will pop up.<br />
And to compare to seconds simply divide the milliseconds by 1000 (IntOp $R2 $R2 / 1000 in the sample script).<br />
<br />
~ Florian<br />
<br />
And thanks for your praise :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">20th December 2001, 16:54</div></div><div class="posttext">:) HOW? :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">F. Heidenreich</div><div class="date">20th December 2001, 17:08</div></div><div class="posttext">Quote from documentation: Lines beginning with ; or # are comments. <br />
<br />
See http://www.firehose.net/free/nsis/makensis.htm#IntOp for IntOp documentation.<br />
<br />
I've included my last sample script for this thread. And for the next time: please have a look in the NSIS documentation before you post a question. Thanks in advance.<br />
<br />
~ Florian</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Napek</div><div class="date">23rd December 2001, 21:15</div></div><div class="posttext">Hmmm everything was ok but i've was got old version of NSIS and on NSIS v1.91 everything works fine :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">petersa</div><div class="date">24th December 2001, 11:09</div></div><div class="posttext">Actually, you can even check if there's a CD in the drive using MCI. Not sure how, but it's possible! So you can even throw up a box like 'Please insert the CD.' or something.</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>