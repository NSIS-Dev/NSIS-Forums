<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" I make a script to convert .reg to .nsi, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  I make a script to convert .reg to .nsi NSIS Discussion" />
	
	<title> I make a script to convert .reg to .nsi [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  I make a script to convert .reg to .nsi</div>
<hr />
<div class="pda"><a href="t-194686.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=194686">I make a script to convert .reg to .nsi</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">25th September 2004, 13:59</div></div><div class="posttext">Simple to use.<br />
I don't known how to read a Unicode file. FileRead onlu return a ANSI string. May be MultiByteToWideChar, WideCharToMultiByte and System plugins can do this. But I don't known how to use it.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">25th September 2004, 18:35</div></div><div class="posttext">You can use FileReadByte<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">26th September 2004, 08:38</div></div><div class="posttext">But how to convert binary to character?</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">26th September 2004, 12:45</div></div><div class="posttext">Use IntFmt with &quot;%c&quot; as the format string:<br />
<br />
IntFmt $1 &quot;%c&quot; $2<br />
<br />
will convert the binary value in $2 into a character in $1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">27th September 2004, 05:51</div></div><div class="posttext">Originally posted by pengyou <br />
Use IntFmt with &quot;%c&quot; as the format string:<br />
<br />
IntFmt $1 &quot;%c&quot; $2<br />
<br />
will convert the binary value in $2 into a character in $1  <br />
<br />
ASCII is OK. But I try to convert &quot;604F7D59&quot; (in Chinese is ÄãºÃ), return &quot;\&quot;. <br />
<br />
:rolleyes:</div></div><hr />


<div class="post"><div class="posttop"><div class="username">pengyou</div><div class="date">27th September 2004, 13:52</div></div><div class="posttext">IntFmt $1 &quot;%c&quot; $2<br />
<br />
just converts a single byte into an ASCII character. NSIS uses MBCS instead of Unicode (so it can be used on Win9x systems).<br />
<br />
Have you tried a forum search for &quot;Unicode&quot; references?<br />
<br />
There is something in the Archive which converts registry data or .reg files but I do not know if it will do what you want:<br />
http://nsis.sourceforge.net/archive/viewpage.php?pageid=296</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kichik</div><div class="date">28th September 2004, 18:46</div></div><div class="posttext">FileOpen $0 unicode-file r<br />
# don't forget to skip marker here<br />
FileReadByte $0 $2<br />
FileReadByte $0 $1<br />
FileClose $0<br />
IntOp $1 $1 &lt;&lt; 8<br />
IntOp $1 $1 | $2<br />
IntFmt $1 %lc $1</div></div><hr />


<div class="post"><div class="posttop"><div class="username">deguix</div><div class="date">28th September 2004, 22:21</div></div><div class="posttext">IntOp $1 $1 &lt;&lt; 8Ahnnn, kichik. I don't think this ever appeared on the docs. That's why only the developer knows totally his/her program features.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">29th September 2004, 02:19</div></div><div class="posttext">Oh kichik, you are great, this code can read a Unicode file, ASCII and Chinese character.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">14th January 2005, 12:17</div></div><div class="posttext">Hola a Tod@s<br />
<br />
In this function:<br />
<br />
FileOpen $0 unicode-file r<br />
# don't forget to skip marker here<br />
FileReadByte $0 $2<br />
FileReadByte $0 $1<br />
FileClose $0<br />
IntOp $1 $1 &lt;&lt; 8<br />
IntOp $1 $1 | $2<br />
IntFmt $1 %lc $1<br />
<br />
<br />
What does this line ?<br />
<br />
IntOp $1 $1 &lt;&lt; 8 <br />
<br />
I search in the manual but i don´t found the &lt;&lt; operator.<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Afrow UK</div><div class="date">14th January 2005, 15:53</div></div><div class="posttext">See deguix post (above)<br />
<br />
-Stu</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">15th January 2005, 00:56</div></div><div class="posttext">&lt;&lt; is bit shift, you can see NSIS.chm</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">17th January 2005, 09:01</div></div><div class="posttext">Hola a Tod@s  <br />
<br />
The problem was that i was worked with the version 2.00.<br />
I updated my version of nsis to the last (2.04) and there´s no problem with the documentation.<br />
<br />
Thanks a lot</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">17th January 2005, 09:15</div></div><div class="posttext">Hola a Tod@s<br />
<br />
Hello Bluenet ¡¡ I updated your function CheckFileEncoding a little and i add some documentation :<br />
<br />
;        Usage : Push file<br />
;                Call CheckFileEncoding<br />
;                Pop $R0<br />
;<br />
;                At this moment $R0 is:<br />
;                   EBCDIC (the encoding declaration must be read)<br />
;                   UCS-4 (little-endian)<br />
;                   UCS-4 (big-endian)<br />
;                   UTF-16 (big-endian:the encoding declaration must be read)<br />
;                   UTF-16 (little-endian:the encoding declaration must be read)<br />
;                   UTF-16BE<br />
;                   UTF-16LE<br />
;                   UTF-8 (BOM)<br />
;                   UTF-8<br />
;                 UTF-8 (Is the default value)<br />
Function CheckFileEncoding<br />
<br />
;        This fuction is based on the read of the Byte Order Mark (BOM) : a file<br />
;        signature that indicates the file encode (see XML Spec Appendices F1).<br />
;        (This function is a variation of the ChekFileEncoding made for Bluenet,).<br />
         <br />
;        NOTE :<br />
;        - Little-endian ::: Describes a computer architecture . The PDP-11 and VAX<br />
;       families of computers and Intel microprocessors are little-endian.<br />
<br />
;        - Big-endian ::: Describes a computer architecture .The IBM 370 family,<br />
;        the PDP-10, the Motorola microprocessor families, and most of the various<br />
;        RISC designs are big-endian<br />
<br />
;        - The term ANSI is used to collectively refer to all the non-Unicode single<br />
;        and multi-byte character sets used in Windows operating systems. These include<br />
;        the single-byte systems for Europe and the &quot;double-byte&quot; systems for Chinese<br />
;        and Japanese which actually use one or two bytes per character<br />
<br />
;        - UCS ::: Universal Character Set (UCS-2 =&gt; 2 bytes ; UCS-4 =&gt; 4 bytes)<br />
<br />
;        - UTF ::: Unicode transformation Format (UTF-8 , UTF-16 )<br />
<br />
	Exch $R5 ; $R5 have the name of the file<br />
	Push $R0<br />
	Push $R1<br />
	Push $R2<br />
	Push $R3<br />
	Push $R4<br />
<br />
	FileOpen $R0 $R5 r<br />
	FileReadByte $R0 $R1        ;$R1 have the first byte of the file<br />
	FileSeek $R0 1<br />
	FileReadByte $R0 $R2        ;$R2 have the second byte of the file<br />
	FileSeek $R0 2<br />
	FileReadByte $R0 $R3        ;$R3 have the third byte of the file<br />
	FileSeek $R0 3<br />
	FileReadByte $R0 $R4        ;$R4 have the fourth byte of the file<br />
	<br />
	FileClose $R0<br />
	<br />
	StrCpy $R0 $R1$R2$R3$R4<br />
	StrCmp $R0 76111167148 0 +3           ;hex = 4C 6F A7 94<br />
	StrCpy $R0 &quot;EBCDIC (the encoding declaration must be read)&quot;<br />
	Goto end<br />
	StrCmp $R0 25525400 0 +3              ;hex = FF FE 00 00 (BOM)<br />
	StrCpy $R0 &quot;UCS-4 (little-endian)&quot;<br />
	Goto end<br />
	StrCmp $R0 00254255 0 +3              ;hex = 00 00 FE FF (BOM)<br />
	StrCpy $R0 &quot;UCS-4 (big-endian)&quot;<br />
	Goto end<br />
	StrCmp $R0 060063 0 +3                ;hex = 00 3C 00 3F<br />
	StrCpy $R0 &quot;UTF-16 (big-endian:the encoding declaration must be read)&quot;<br />
	Goto end<br />
	StrCmp $R0 600630 0 +3                ;hex = 3C 00 3F 00<br />
	StrCpy $R0 &quot;UTF-16 (little-endian:the encoding declaration must be read)&quot;<br />
	Goto end<br />
 	StrCpy $R0 $R1$R2<br />
	StrCmp $R0 255254 0 +3                ;hex = FF FE (BOM)<br />
	StrCpy $R0 &quot;UTF-16LE&quot;                 ;In Windows Unicode =&gt; UTF-16 ?                 ;<br />
	Goto end<br />
	StrCmp $R0 254255 0 +3                ;hex = FE FF  (BOM)<br />
	StrCpy $R0 &quot;UTF-16BE&quot;                 ;In Windows Unicode =&gt; UTF-16 ?<br />
	Goto end<br />
	StrCpy $R0 $R1$R2$R3<br />
	StrCmp $R0 239187191 0 +3             ;hex = EF BB BF  (BOM)<br />
	StrCpy $R0 &quot;UTF-8 (BOM)&quot;<br />
	Goto end<br />
	StrCpy $R0 &quot;UTF-8&quot;                   ;Default value acording to the XML spec (the encoding declaration must be read)<br />
	end:<br />
<br />
        Pop $R5<br />
        Pop $R4<br />
	Pop $R3<br />
	Pop $R2<br />
	Pop $R1<br />
	Push $R0<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">17th January 2005, 10:16</div></div><div class="posttext">Thanks kike_velez for improvement. <br />
And may be some problem in this function, the Var you pop order not incorrect. Rewrite here:<br />
<br />
Exch $R0 ; $R0 have the name of the file<br />
Push $R1<br />
Push $R2<br />
Push $R3<br />
Push $R4<br />
<br />
FileOpen $R0 $R0 r ;the name of the file not using<br />
<br />
...........<br />
<br />
Pop $R4<br />
Pop $R3<br />
Pop $R2<br />
Pop $R1<br />
Exch $R0</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">17th January 2005, 10:23</div></div><div class="posttext">The Default value should be ANSI, because in ASCII character ANSI = UTF-8, but in Asia language ANSI != UTF-8.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">17th January 2005, 11:41</div></div><div class="posttext">Thanks Bluenet<br />
<br />
I make the variations that you say to me . But the last mail i don´t understand. Can you explain a little ?<br />
<br />
The Default value should be ANSI, because in ASCII character ANSI = UTF-8, but in Asia language ANSI != UTF-8. <br />
<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">17th January 2005, 13:44</div></div><div class="posttext">Hola a Tod@s:<br />
<br />
The updated funcion <br />
<br />
;        Usage : Push file<br />
;                Call CheckFileEncoding<br />
;                Pop $R0<br />
;<br />
;                At this moment $R0 is:<br />
;                   EBCDIC (the encoding declaration must be read)<br />
;                   UCS-4 (little-endian)<br />
;                   UCS-4 (big-endian)<br />
;                   UTF-16 (big-endian:the encoding declaration must be read)<br />
;                   UTF-16 (little-endian:the encoding declaration must be read)<br />
;                   UTF-16BE<br />
;                   UTF-16LE<br />
;                   UTF-8 (BOM)<br />
;                   UTF-8<br />
;                 UTF-8 (Is the default value)<br />
Function CheckFileEncoding<br />
<br />
;        This fuction is based on the read of the Byte Order Mark (BOM) : a file<br />
;        signature that indicates the file encode (see XML Spec Appendices F1).<br />
;        (This function is a variation of the ChekFileEncoding made for Bluenet,<br />
;        it´s part of his reg2nsis utility).<br />
         <br />
;        NOTE :<br />
;        - Little-endian ::: Describes a computer architecture . The PDP-11 and VAX<br />
;       families of computers and Intel microprocessors are little-endian.<br />
<br />
;        - Big-endian ::: Describes a computer architecture .The IBM 370 family,<br />
;        the PDP-10, the Motorola microprocessor families, and most of the various<br />
;        RISC designs are big-endian<br />
<br />
;        - The term ANSI is used to collectively refer to all the non-Unicode single<br />
;        and multi-byte character sets used in Windows operating systems. These include<br />
;        the single-byte systems for Europe and the &quot;double-byte&quot; systems for Chinese<br />
;        and Japanese which actually use one or two bytes per character<br />
<br />
;        - UCS ::: Universal Character Set (UCS-2 =&gt; 2 bytes ; UCS-4 =&gt; 4 bytes)<br />
<br />
;        - UTF ::: Unicode transformation Format (UTF-8 , UTF-16 )<br />
<br />
	<br />
	Exch $R0<br />
	Push $R1<br />
	Push $R2<br />
	Push $R3<br />
	Push $R4<br />
<br />
	<br />
	FileOpen $R0 $R0 r          ; the name of the file is not using<br />
	FileReadByte $R0 $R1        ;$R1 have the first byte of the file<br />
	FileSeek $R0 1<br />
	FileReadByte $R0 $R2        ;$R2 have the second byte of the file<br />
	FileSeek $R0 2<br />
	FileReadByte $R0 $R3        ;$R3 have the third byte of the file<br />
	FileSeek $R0 3<br />
	FileReadByte $R0 $R4        ;$R4 have the fourth byte of the file<br />
	<br />
	FileClose $R0<br />
	<br />
	StrCpy $R0 $R1$R2$R3$R4<br />
	StrCmp $R0 76111167148 0 +3           ;hex = 4C 6F A7 94<br />
	StrCpy $R0 &quot;EBCDIC (the encoding declaration must be read)&quot;<br />
	Goto end<br />
	StrCmp $R0 25525400 0 +3              ;hex = FF FE 00 00 (BOM)<br />
	StrCpy $R0 &quot;UCS-4 (little-endian)&quot;<br />
	Goto end<br />
	StrCmp $R0 00254255 0 +3              ;hex = 00 00 FE FF (BOM)<br />
	StrCpy $R0 &quot;UCS-4 (big-endian)&quot;<br />
	Goto end<br />
	StrCmp $R0 060063 0 +3                ;hex = 00 3C 00 3F<br />
	StrCpy $R0 &quot;UTF-16 (big-endian:the encoding declaration must be read)&quot;<br />
	Goto end<br />
	StrCmp $R0 600630 0 +3                ;hex = 3C 00 3F 00<br />
	StrCpy $R0 &quot;UTF-16 (little-endian:the encoding declaration must be read)&quot;<br />
	Goto end<br />
 	StrCpy $R0 $R1$R2<br />
	StrCmp $R0 255254 0 +3                ;hex = FF FE (BOM)<br />
	StrCpy $R0 &quot;UTF-16LE&quot;                 ;In Windows Unicode =&gt; UTF-16 ? . Least significant byte is written first.                ;<br />
	Goto end<br />
	StrCmp $R0 254255 0 +3                ;hex = FE FF  (BOM)<br />
	StrCpy $R0 &quot;UTF-16BE&quot;                 ;In Windows Unicode =&gt; UTF-16 ? . Most significant byte is written first.<br />
	Goto end<br />
	StrCpy $R0 $R1$R2$R3<br />
	StrCmp $R0 239187191 0 +3             ;hex = EF BB BF  (BOM)<br />
	StrCpy $R0 &quot;UTF-8 (BOM)&quot;              ;A character could be written in one, two or three bytes<br />
	Goto end<br />
	StrCpy $R0 &quot;ANSI&quot;                   ;The Default value should be ANSI, because  <br />
                                            ;in ASCII character ANSI = UTF-8, <br />
                                            ;but in Asia language ANSI != UTF-8.<br />
        end:<br />
<br />
        Pop $R4<br />
	Pop $R3<br />
	Pop $R2<br />
	Pop $R1<br />
	Exch $R0<br />
<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">18th January 2005, 08:32</div></div><div class="posttext">Hola<br />
<br />
Another question . If a unicode file is for exemple a sequence of this type :<br />
<br />
       3C 00 EF 00 ....<br />
<br />
Why this function ?<br />
<br />
FileReadByte $0 $2<br />
FileReadByte $0 $1<br />
FileClose $0<br />
IntOp $1 $1 &lt;&lt; 8<br />
IntOp $1 $1 | $2<br />
IntFmt $1 %lc $1<br />
<br />
And not this ?<br />
<br />
FileReadByte $0 $2<br />
FileReadByte $0 $1<br />
FileClose $0<br />
IntFmt $1 %lc $2<br />
<br />
The problem is to jump the 00s or there is something more ?<br />
<br />
Thanks in advance</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">18th January 2005, 10:16</div></div><div class="posttext">See the picture, the English character Unicode format is xx00xx00, but Chinese isn't.<br />
And English character in ANSI same as UTF-8, but Chinese isn't.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">18th January 2005, 11:12</div></div><div class="posttext">Thanks Bluenet for your explanation . I was ignorant about this . :eek: <br />
<br />
I think that is more complicated for you to do programs that for me. I am wrong ?<br />
<br />
Best regards</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">18th January 2005, 11:17</div></div><div class="posttext">Please Bluenet , can you atach a sample of file in unicode chinese to play with it.<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">18th January 2005, 14:33</div></div><div class="posttext">What sample? In this code<br />
<br />
FileReadByte $0 $2<br />
FileReadByte $0 $1<br />
FileClose $0<br />
IntOp $1 $1 &lt;&lt; 8<br />
IntOp $1 $1 | $2<br />
IntFmt $1 %lc $1<br />
<br />
$1 is a ANSI character convert from Unicode</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">19th January 2005, 08:41</div></div><div class="posttext">Thanks bluenet for your reply.<br />
<br />
The problem is that i don´t understand this :<br />
<br />
FileReadByte $0 $2   <br />
FileReadByte $0 $1<br />
FileClose $0<br />
IntOp $1 $1 &lt;&lt; 8       *1 <br />
IntOp $1 $1 | $2       *2   <br />
IntFmt $1 %lc $1<br />
<br />
If for exemple we have this sequence of the file :<br />
<br />
          60 4F 7D 59<br />
<br />
$2 = 60 and $1 =  4F after the two sentences (*1 y *2)<br />
we have (i think) $1 = 4F 60 .<br />
<br />
I think that only change the sequence of bytes. And why is this ansi?<br />
<br />
Thanks</div></div><hr />


<div class="post"><div class="posttop"><div class="username">bluenet</div><div class="date">19th January 2005, 09:14</div></div><div class="posttext">IntFmt is same as C++ wsprintf function.<br />
I don't known why. But after convert to ANSI you can deal with FileWrite or StrCpy and so on.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">kike_velez</div><div class="date">19th January 2005, 09:59</div></div><div class="posttext">Hello Bluenet<br />
<br />
<br />
Thanks a lot for you patience</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>