<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content=" A newbie with a slightly complex problem, media player, mp3 player, music player, ipod sync, multimedia player, player, winamp, audio player" />
	<meta name="description" content="[Archive]  A newbie with a slightly complex problem NSIS Discussion" />
	
	<title> A newbie with a slightly complex problem [Archive]  - Winamp Forums</title>
	<link rel="stylesheet" type="text/css" href="archive.css" />
</head>
<body>
<div class="pagebody">
<div id="navbar">Winamp Forums &gt; Developer Center &gt; <a href="f-65.html">NSIS Discussion</a> &gt;  A newbie with a slightly complex problem</div>
<hr />
<div class="pda"><a href="t-362832.html?login=1" rel="nofollow">Log in</a></div>
<p class="largefont">Try the Internet Archive: <a href="http://web.archive.org/web/*/forums.winamp.com/showthread.php?t=362832">A newbie with a slightly complex problem</a></p>
<hr />

<div class="post"><div class="posttop"><div class="username">Saleck</div><div class="date">3rd June 2013, 07:50</div></div><div class="posttext">Hello all :)<br />
I've been having a problem that I'm hoping someone could help me with.<br />
I have 3 checkboxes in my menu. Lets call them 'abc', 'mno' and 'xyz'<br />
<br />
'abc' is selected when the installer starts. 'mno' and 'xyz' BOTH start unselected.<br />
'mno' and 'xyz' should de-select each other when one is selected but can both be unselected at the same time.<br />
If 'abc' is unselected, 'xyz' needs to unselect AND disable itself.<br />
If 'abc' is reselected again, 'xyz' should re-enable itself for selection.<br />
<br />
I've had a good go at this but I've been beaten. Here is my current code on the<br />
Function .onSelChange section. I have no idea how 'right' or 'wrong' this code is.<br />
<br />
===============================================================<br />
<br />
Function .onSelChange<br />
<br />
${If} ${SectionIsSelected} ${xyz}<br />
	 !insertmacro UnselectSection ${mno}<br />
${EndIf}<br />
<br />
${If} ${SectionIsSelected} ${mno}<br />
	!insertmacro UnselectSection ${xyz}<br />
${EndIf}<br />
<br />
; Works wierd. nmo will uncheck xyz but not the other way round :(<br />
<br />
<br />
${If} ${SectionIsSelected} ${abc}<br />
<br />
	SectionSetFlags ${xyz} ${SECTION_ON}<br />
	<br />
	${Else}<br />
	!insertmacro UnselectSection ${xyz}<br />
	SectionSetFlags ${xyz} ${SF_RO}<br />
	<br />
${EndIf}<br />
<br />
===============================================================<br />
<br />
If anyone can help me with this, I'd appreciate it very much :) I've tried to make this as easy as possible to understand<br />
Thank you!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">3rd June 2013, 09:28</div></div><div class="posttext">That is because the second if statement is influenced by the first (which deselects mno).<br />
<br />
You will have to create global variables to store the current section selection, and check in .onSelChange which checkbox has changed.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">3rd June 2013, 09:54</div></div><div class="posttext">OK, here is a working example:Name &quot;Test&quot;<br />
OutFile &quot;Test.exe&quot;<br />
!include LogicLib.nsh<br />
Page components<br />
Page instfiles<br />
Var Last_abc<br />
Var Last_mno<br />
Var Last_xyz<br />
Section &quot;abc&quot; abc<br />
SectionEnd<br />
Section /o &quot;mno&quot; mno<br />
SectionEnd<br />
Section /o &quot;xyz&quot; xyz<br />
SectionEnd<br />
Function .oninit<br />
	StrCpy $Last_abc ${SF_SELECTED}<br />
	StrCpy $Last_mno 0<br />
	StrCpy $Last_xyz 0<br />
FunctionEnd<br />
Function .onSelChange<br />
	# remove all but SF_SELECTED flag<br />
	IntOp $Last_abc $Last_abc &amp; ${SF_SELECTED}<br />
	IntOp $Last_mno $Last_mno &amp; ${SF_SELECTED}<br />
	IntOp $Last_xyz $Last_xyz &amp; ${SF_SELECTED}<br />
	${If} ${SectionIsSelected} ${xyz}<br />
	${AndIf} $Last_xyz != ${SF_SELECTED}<br />
		!insertmacro UnselectSection ${mno}<br />
	${EndIf}<br />
	${If} ${SectionIsSelected} ${mno}<br />
	${AndIf} $Last_mno != ${SF_SELECTED}<br />
		!insertmacro UnselectSection ${xyz}<br />
	${EndIf}<br />
	${If} ${SectionIsSelected} ${abc}<br />
		${If} $Last_abc != ${SF_SELECTED}<br />
			SectionSetFlags ${xyz} ${SF_SELECTED}<br />
		${EndIf}<br />
	${Else}<br />
		${If} $Last_abc == ${SF_SELECTED}<br />
			!insertmacro UnselectSection ${xyz}<br />
			SectionSetFlags ${xyz} ${SF_RO}<br />
		${EndIf}<br />
	${EndIf}	<br />
	SectionGetFlags ${abc} $Last_abc<br />
	SectionGetFlags ${mno} $Last_mno<br />
	SectionGetFlags ${xyz} $Last_xyz<br />
FunctionEnd</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Saleck</div><div class="date">3rd June 2013, 15:19</div></div><div class="posttext">Thank you so much jpderuiter :) this code worked a treat.<br />
<br />
I found something I forgot to state in my Original Post though but was able to fix it.<br />
<br />
${If} ${SectionIsSelected} ${abc}<br />
<br />
		${If} $Last_abc != ${SF_SELECTED}<br />
		<br />
			SectionSetFlags ${xyz} ${SF_SELECTED}<br />
<br />
		${EndIf}<br />
<br />
	${Else}<br />
<br />
I found that this code was making the checkbox selected on re-enabling it. The user is then able to select mno without xyz getting unchecked.<br />
<br />
I just added this line to it under the SectionSetFlags<br />
<br />
        !insertmacro UnselectSection ${xyz}<br />
<br />
And now whenever the checkbox is re-enabled, it deselects itself and can no longer be installed along with xyz<br />
<br />
Thank you very much for your time :)</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Saleck</div><div class="date">5th June 2013, 16:40</div></div><div class="posttext">Back again with a very small problem this time.<br />
<br />
I have the exact same kind of code as before but this time, how would I go about having XYZ unchecked and disabled immediately on arriving to the Components page? ABC is still selected and checked at the start.<br />
<br />
Thank you!</div></div><hr />


<div class="post"><div class="posttop"><div class="username">jpderuiter</div><div class="date">5th June 2013, 21:56</div></div><div class="posttext">AddSectionSetFlags ${xyz} ${SF_RO} in the .oninit function.</div></div><hr />


<div class="post"><div class="posttop"><div class="username">Saleck</div><div class="date">6th June 2013, 04:45</div></div><div class="posttext">That did the trick thank you again :)</div></div><hr />


<div id="copyright">2001-2013 <a href="http://creativecommons.org/publicdomain/mark/1.0/" target="_blank">Public Domain Mark 1.0</a></div>
</div>
</body>
</html>